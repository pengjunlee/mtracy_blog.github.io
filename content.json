{"meta":{"title":"ææœ‹å†›çš„ä¸ªäººåšå®¢","subtitle":"å­¦ä¹ æ˜¯ä¸€ç§ç”Ÿæ´»æ–¹å¼","description":"æˆ‘è¿˜æ˜¯ä»å‰é‚£ä¸ªå°‘å¹´ï¼Œæ²¡æœ‰ä¸€ä¸ä¸æ”¹å˜ã€‚","author":"pengjunlee","url":""},"pages":[{"title":"about","date":"2018-12-12T14:14:36.000Z","updated":"2023-04-30T10:21:41.374Z","comments":false,"path":"about/index.html","permalink":"/about/index.html","excerpt":"","text":"[ã•ãã‚‰è˜ã®hojun] ä¸&nbsp; Mashiro&nbsp; ï¼ˆ çœŸï¼ˆã¾ï¼‰ç™½ï¼ˆã—ã‚ï¼‰ ï¼‰ å¯¹è¯ä¸­... bot_ui_ini()","keywords":"å…³äº"},{"title":"bangumi","date":"2019-02-10T13:32:48.000Z","updated":"2023-04-30T10:21:41.375Z","comments":false,"path":"bangumi/index.html","permalink":"/bangumi/index.html","excerpt":"","text":"","keywords":null},{"title":"client","date":"2018-12-20T15:13:35.000Z","updated":"2023-04-30T10:21:41.375Z","comments":false,"path":"client/index.html","permalink":"/client/index.html","excerpt":"","text":"ç›´æ¥ä¸‹è½½ or æ‰«ç ä¸‹è½½ï¼š","keywords":"Androidå®¢æˆ·ç«¯"},{"title":"comment","date":"2018-12-20T15:13:48.000Z","updated":"2023-04-30T10:21:41.376Z","comments":true,"path":"comment/index.html","permalink":"/comment/index.html","excerpt":"","text":"å¿µä¸¤å¥è¯— å™åˆ«æ¢¦ã€æ‰¬å·ä¸€è§‰ã€‚ ã€å®‹ä»£ã€‘å´æ–‡è‹±ã€Šå¤œæ¸¸å®«Â·äººå»è¥¿æ¥¼é›æ³ã€‹","keywords":"ç•™è¨€æ¿"},{"title":"lab","date":"2019-01-05T13:47:59.000Z","updated":"2023-04-30T10:21:41.377Z","comments":false,"path":"lab/index.html","permalink":"/lab/index.html","excerpt":"","text":"sakuraä¸»é¢˜balabala","keywords":"Labå®éªŒå®¤"},{"title":"donate","date":"2018-12-20T15:13:05.000Z","updated":"2023-04-30T10:21:41.376Z","comments":false,"path":"donate/index.html","permalink":"/donate/index.html","excerpt":"","text":"","keywords":"è°¢è°¢é¥²ä¸»äº†å–µ~"},{"title":"links","date":"2018-12-19T15:11:06.000Z","updated":"2023-04-30T10:21:41.377Z","comments":true,"path":"links/index.html","permalink":"/links/index.html","excerpt":"","text":"","keywords":"å‹äººå¸"},{"title":"music","date":"2018-12-20T15:14:28.000Z","updated":"2023-04-30T10:21:41.377Z","comments":false,"path":"music/index.html","permalink":"/music/index.html","excerpt":"","text":"","keywords":"å–œæ¬¢çš„éŸ³ä¹"},{"title":"rss","date":"2018-12-20T15:09:03.000Z","updated":"2023-04-30T10:21:41.378Z","comments":true,"path":"rss/index.html","permalink":"/rss/index.html","excerpt":"","text":""},{"title":"Are U Happy","date":"2020-05-31T03:56:03.000Z","updated":"2023-04-30T10:21:41.378Z","comments":true,"path":"tags/Are U Happy.html","permalink":"/tags/Are U Happy.html","excerpt":"","text":"","keywords":"Happy"},{"title":"tags","date":"2018-12-12T14:14:16.000Z","updated":"2023-04-30T10:21:41.378Z","comments":true,"path":"tags/index.html","permalink":"/tags/index.html","excerpt":"","text":""},{"title":"theme-sakura","date":"2019-01-04T14:53:25.000Z","updated":"2023-04-30T10:21:41.379Z","comments":false,"path":"theme-sakura/index.html","permalink":"/theme-sakura/index.html","excerpt":"","text":"Hexoä¸»é¢˜Sakuraä¿®æ”¹è‡ªWordPressä¸»é¢˜Sakuraï¼Œæ„Ÿè°¢åŸä½œè€…Mashiro","keywords":"Hexo ä¸»é¢˜ Sakura ğŸŒ¸"},{"title":"video","date":"2018-12-20T15:14:38.000Z","updated":"2023-04-30T10:21:41.379Z","comments":false,"path":"video/index.html","permalink":"/video/index.html","excerpt":"","text":"var videos = [ { img: 'https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg', title: 'æœèŠ±å¤•èª“â€”â€”äºç¦»åˆ«ä¹‹æœæŸèµ·çº¦å®šä¹‹èŠ±', status: 'å·²è¿½å®Œ', progress: 100, jp: 'ã•ã‚ˆãªã‚‰ã®æœã«ç´„æŸã®èŠ±ã‚’ã‹ã–ã‚ã†', time: 'æ”¾é€æ—¶é—´: 2018-02-24 SUN.', desc: ' ä½åœ¨è¿œç¦»å°˜åš£çš„åœŸåœ°ï¼Œä¸€è¾¹å°†æ¯å¤©çš„äº‹æƒ…ç¼–ç»‡æˆåä¸ºå¸Œæ¯”æ¬§çš„å¸ƒï¼Œä¸€è¾¹é™é™ç”Ÿæ´»çš„ä¼Šæ¬§å¤«äººæ°‘ã€‚åœ¨15å²å·¦å³å¤–è¡¨å°±åœæ­¢æˆé•¿ï¼Œæ‹¥æœ‰æ•°ç™¾å¹´å¯¿å‘½çš„ä»–ä»¬ï¼Œè¢«ç§°ä¸ºâ€œç¦»åˆ«çš„ä¸€æ—â€ï¼Œå¹¶è¢«è§†ä¸ºæ´»ç€çš„ä¼ è¯´ã€‚æ²¡æœ‰åŒäº²çš„ä¼Šæ¬§å¤«å°‘å¥³ç›å¥‡äºšï¼Œè¿‡ç€è¢«ä¼™ä¼´åŒ…å›´çš„å¹³ç¨³æ—¥å­ï¼Œå´æ€»æ„Ÿè§‰â€œå­¤èº«ä¸€äººâ€ã€‚ä»–ä»¬çš„è¿™ç§æ—¥å¸¸ï¼Œä¸€ç¬é—´å°±å´©æºƒæ¶ˆå¤±ã€‚è¿½æ±‚ä¼Šæ¬§å¤«çš„é•¿å¯¿ä¹‹è¡€ï¼Œæ¢…è¨è’‚å†›ä¹˜åç€åä¸ºé›·çº³ç‰¹çš„å¤ä»£å…½å‘åŠ¨äº†è¿›æ”»ã€‚åœ¨ç»æœ›ä¸æ··ä¹±ä¹‹ä¸­ï¼Œä¼Šæ¬§å¤«çš„ç¬¬ä¸€ç¾å¥³è•¾è‰äºšè¢«æ¢…è¨è’‚å¸¦èµ°ï¼Œè€Œç›å¥‡äºšæš—æ‹çš„å°‘å¹´å…‹é‡Œå§†ä¹Ÿå¤±è¸ªäº†ã€‚ç›å¥‡äºšè™½ç„¶æ€»ç®—é€ƒè„±äº†ï¼Œå´å¤±å»äº†ä¼™ä¼´å’Œå½’å»ä¹‹åœ°â€¦â€¦ã€‚' }, { img : 'https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg', title: 'æœèŠ±å¤•èª“â€”â€”äºç¦»åˆ«ä¹‹æœæŸèµ·çº¦å®šä¹‹èŠ±', status: 'å·²è¿½å®Œ', progress: 100, jp: 'ã•ã‚ˆãªã‚‰ã®æœã«ç´„æŸã®èŠ±ã‚’ã‹ã–ã‚ã†', time: '2018-02-24 SUN.', desc: ' ä½åœ¨è¿œç¦»å°˜åš£çš„åœŸåœ°ï¼Œä¸€è¾¹å°†æ¯å¤©çš„äº‹æƒ…ç¼–ç»‡æˆåä¸ºå¸Œæ¯”æ¬§çš„å¸ƒï¼Œä¸€è¾¹é™é™ç”Ÿæ´»çš„ä¼Šæ¬§å¤«äººæ°‘ã€‚åœ¨15å²å·¦å³å¤–è¡¨å°±åœæ­¢æˆé•¿ï¼Œæ‹¥æœ‰æ•°ç™¾å¹´å¯¿å‘½çš„ä»–ä»¬ï¼Œè¢«ç§°ä¸ºâ€œç¦»åˆ«çš„ä¸€æ—â€ï¼Œå¹¶è¢«è§†ä¸ºæ´»ç€çš„ä¼ è¯´ã€‚æ²¡æœ‰åŒäº²çš„ä¼Šæ¬§å¤«å°‘å¥³ç›å¥‡äºšï¼Œè¿‡ç€è¢«ä¼™ä¼´åŒ…å›´çš„å¹³ç¨³æ—¥å­ï¼Œå´æ€»æ„Ÿè§‰â€œå­¤èº«ä¸€äººâ€ã€‚ä»–ä»¬çš„è¿™ç§æ—¥å¸¸ï¼Œä¸€ç¬é—´å°±å´©æºƒæ¶ˆå¤±ã€‚è¿½æ±‚ä¼Šæ¬§å¤«çš„é•¿å¯¿ä¹‹è¡€ï¼Œæ¢…è¨è’‚å†›ä¹˜åç€åä¸ºé›·çº³ç‰¹çš„å¤ä»£å…½å‘åŠ¨äº†è¿›æ”»ã€‚åœ¨ç»æœ›ä¸æ··ä¹±ä¹‹ä¸­ï¼Œä¼Šæ¬§å¤«çš„ç¬¬ä¸€ç¾å¥³è•¾è‰äºšè¢«æ¢…è¨è’‚å¸¦èµ°ï¼Œè€Œç›å¥‡äºšæš—æ‹çš„å°‘å¹´å…‹é‡Œå§†ä¹Ÿå¤±è¸ªäº†ã€‚ç›å¥‡äºšè™½ç„¶æ€»ç®—é€ƒè„±äº†ï¼Œå´å¤±å»äº†ä¼™ä¼´å’Œå½’å»ä¹‹åœ°â€¦â€¦ã€‚' } ] .should-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:95%;}.should-ellipsis-full{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;}.should-ellipsis i{position:absolute;right:24px;}.grey-text{color:#9e9e9e !important}.grey-text.text-darken-4{color:#212121 !important}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}img{border-style:none}progress{display:inline-block;vertical-align:baseline}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}*,*:before,*:after{-webkit-box-sizing:inherit;box-sizing:inherit}ul:not(.browser-default){padding-left:0;list-style-type:none}ul:not(.browser-default)>li{list-style-type:none}.card{-webkit-box-shadow:0 2px 2px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12),0 1px 5px 0 rgba(0,0,0,0.2);box-shadow:0 2px 2px 0 rgba(0,0,0,0.14),0 3px 1px -2px rgba(0,0,0,0.12),0 1px 5px 0 rgba(0,0,0,0.2)}.hoverable{-webkit-transition:-webkit-box-shadow .25s;transition:-webkit-box-shadow .25s;transition:box-shadow .25s;transition:box-shadow .25s,-webkit-box-shadow .25s}.hoverable:hover{-webkit-box-shadow:0 8px 17px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);box-shadow:0 8px 17px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}i{line-height:inherit}i.right{float:right;margin-left:15px}.bangumi .right{float:right !important}.material-icons{text-rendering:optimizeLegibility;-webkit-font-feature-settings:'liga';-moz-font-feature-settings:'liga';font-feature-settings:'liga'}.row{margin-left:auto;margin-right:auto;margin-bottom:20px}.row:after{content:\"\";display:table;clear:both}.row .col{float:left;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0 .75rem;min-height:1px}.row .col.s12{width:100%;margin-left:auto;left:auto;right:auto}@media only screen and (min-width:601px){.row .col.m6{width:50%;margin-left:auto;left:auto;right:auto}}html{line-height:1.5;font-family:-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Oxygen-Sans,Ubuntu,Cantarell,\"Helvetica Neue\",sans-serif;font-weight:normal;color:rgba(0,0,0,0.87)}@media only screen and (min-width:0){html{font-size:14px}}@media only screen and (min-width:992px){html{font-size:14.5px}}@media only screen and (min-width:1200px){html{font-size:15px}}.card{position:relative;margin:.5rem 0 1rem 0;background-color:#fff;-webkit-transition:-webkit-box-shadow .25s;transition:-webkit-box-shadow .25s;transition:box-shadow .25s;transition:box-shadow .25s,-webkit-box-shadow .25s;border-radius:2px}.card .card-title{font-size:24px;font-weight:300}.card .card-title.activator{cursor:pointer}.card .card-image{position:relative}.card .card-image img{display:block;border-radius:2px 2px 0 0;position:relative;left:0;right:0;top:0;bottom:0;width:100%}.card .card-content{padding:24px;border-radius:0 0 2px 2px}.card .card-content p{margin:0}.card .card-content .card-title{display:block;line-height:32px;margin-bottom:8px}.card .card-content .card-title i{line-height:32px}.card .card-reveal{padding:24px;position:absolute;background-color:#fff;width:100%;overflow-y:auto;left:0;top:100%;height:100%;z-index:3;display:none}.card .card-reveal .card-title{cursor:pointer;display:block}.waves-effect{position:relative;cursor:pointer;display:inline-block;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;vertical-align:middle;z-index:1;-webkit-transition:.3s ease-out;transition:.3s ease-out}.waves-effect img{position:relative;z-index:-1}.waves-block{display:block}::-webkit-input-placeholder{color:#d1d1d1}::-moz-placeholder{color:#d1d1d1}:-ms-input-placeholder{color:#d1d1d1}::-ms-input-placeholder{color:#d1d1d1}[type=\"radio\"]:not(:checked){position:absolute;opacity:0;pointer-events:none}[type=\"radio\"]:not(:checked)+span{position:relative;padding-left:35px;cursor:pointer;display:inline-block;height:25px;line-height:25px;font-size:1rem;-webkit-transition:.28s ease;transition:.28s ease;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[type=\"radio\"]:not(:checked)+span:before,[type=\"radio\"]:not(:checked)+span:after{border-radius:50%}[type=\"radio\"]:not(:checked)+span:before,[type=\"radio\"]:not(:checked)+span:after{border:2px solid #5a5a5a}[type=\"radio\"]:not(:checked)+span:after{-webkit-transform:scale(0);transform:scale(0)}[type=\"checkbox\"]:not(:checked){position:absolute;opacity:0;pointer-events:none}[type=\"checkbox\"]:not(:checked):disabled+span:not(.lever):before{border:none;background-color:rgba(0,0,0,0.42)}[type=\"checkbox\"].filled-in:not(:checked)+span:not(.lever):before{width:0;height:0;border:3px solid transparent;left:6px;top:10px;-webkit-transform:rotateZ(37deg);transform:rotateZ(37deg);-webkit-transform-origin:100% 100%;transform-origin:100% 100%}[type=\"checkbox\"].filled-in:not(:checked)+span:not(.lever):after{height:20px;width:20px;background-color:transparent;border:2px solid #5a5a5a;top:0px;z-index:0}input[type=checkbox]:not(:disabled) ~ .lever:active:before,input[type=checkbox]:not(:disabled).tabbed:focus ~ .lever::before{-webkit-transform:scale(2.4);transform:scale(2.4);background-color:rgba(0,0,0,0.08)}input[type=range].focused:focus:not(.active)::-webkit-slider-thumb{-webkit-box-shadow:0 0 0 10px rgba(38,166,154,0.26);box-shadow:0 0 0 10px rgba(38,166,154,0.26)}input[type=range].focused:focus:not(.active)::-moz-range-thumb{box-shadow:0 0 0 10px rgba(38,166,154,0.26)}input[type=range].focused:focus:not(.active)::-ms-thumb{box-shadow:0 0 0 10px rgba(38,166,154,0.26)} ç•ªç»„è®¡åˆ’ è¿™é‡Œå°†æ˜¯æ°¸è¿œçš„å›å¿† window.onload = function(){ videos.forEach(function(video, i){ $('#rootRow').append(` ${video.title} ${video.jp} ${video.status} ${video.title} ${video.jp} æ”¾é€æ—¶é—´: ${video.time} ${video.desc} ${video.status} `) }) }","keywords":"Bç«™"}],"posts":[{"title":"å­—ç¬¦ç¼–ç ","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--å­—ç¬¦ç¼–ç ","date":"2020-06-06T09:24:10.000Z","updated":"2023-04-30T10:21:41.351Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--å­—ç¬¦ç¼–ç /","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--å­—ç¬¦ç¼–ç /","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹•ï¼ˆä¿®è®¢ç‰ˆï¼‰ã€‹â€”-è®¸ä»¤æ³¢è‘— ç¼–ç é—®é¢˜ä¸€ç›´åœ¨å›°æ‰°ç€ç¨‹åºå¼€å‘äººå‘˜ï¼Œè¿™åœ¨Javaä¸­å°¤å…¶çªå‡ºï¼Œå› ä¸ºJavaæ˜¯è·¨å¹³å°è¯­è¨€ï¼Œå­—ç¬¦åœ¨ä¸åŒå¹³å°ä¹‹é—´è¿›è¡Œä¼ è¾“æ—¶ç»å¸¸éœ€è¦è¿›è¡Œç¼–ç åˆ‡æ¢ã€‚ ä¸ºä»€ä¹ˆè¦ç¼–ç ï¼Ÿä¼—æ‰€å‘¨çŸ¥ï¼Œè®¡ç®—æœºå…¶å®æ˜¯å¾ˆç¬¨çš„ï¼Œå®ƒåªè¯†åˆ«æ•°å­—0å’Œ1ï¼Œæ‰€ä»¥ï¼Œæ— è®ºä»€ä¹ˆå†…å®¹åœ¨è®¡ç®—æœºå†…æœ€ç»ˆéƒ½å¿…é¡»ä»¥01ä¸²çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œå­—ç¬¦ä¹Ÿä¸ä¾‹å¤–ã€‚åœ¨è®¡ç®—æœºä¸­å­˜å‚¨ä¿¡æ¯çš„æœ€å°å•å…ƒæ˜¯1ä¸ªå­—èŠ‚ï¼Œå³8ä¸ªbitï¼Œä¸€ä¸ªå­—èŠ‚æ‰€èƒ½è¡¨ç¤ºçš„å­—ç¬¦ä¸ªæ•°æœ€å¤šä¸º256ä¸ªï¼ˆ0~255ï¼ŒäºŒè¿›åˆ¶11111111=åè¿›åˆ¶255ï¼‰ã€‚ä½†æ˜¯ï¼Œäººç±»è¦è¡¨ç¤ºçš„ç¬¦å·å¤ªå¤šäº†ï¼Œç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºæ˜¾ç„¶æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œå¿…é¡»ç”¨æ›´å¤šçš„å­—èŠ‚æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼šç”¨ä¸¤ä¸ªå­—èŠ‚æœ€å¤šå¯ä»¥è¡¨ç¤º65535ä¸ªå­—ç¬¦ï¼Œç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºçš„å­—ç¬¦æ•°å¯å¤šè¾¾4294967295ä¸ªã€‚ä¸€ä¸ªå­—ç¬¦ç©¶ç«Ÿåº”è¯¥ç”¨å¤šå°‘ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºæ‰åˆé€‚å‘¢ï¼Ÿè¿™å°±æ˜¯ç¼–ç æ‰€å®ç°çš„åŠŸèƒ½ï¼Œä¸åŒçš„ç¼–ç ä½¿ç”¨ä¸åŒçš„å­—èŠ‚æ•°æˆ–æ•°å€¼æ¥è¡¨ç¤ºå­—ç¬¦ã€‚ å¸¸ç”¨ç¼–ç æ ¼å¼ASCIIç ç”±äºè®¡ç®—æœºæ˜¯ç¾å›½äººå‘æ˜çš„ï¼Œå› æ­¤ï¼Œæœ€æ—©åªæœ‰128ä¸ªå­—æ¯è¢«ç¼–ç åˆ°è®¡ç®—æœºé‡Œï¼Œä¹Ÿå°±æ˜¯å¤§å°å†™è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸€äº›ç¬¦å·ï¼Œè¿™ä¸ªç¼–ç è¡¨è¢«ç§°ä¸ºASCIIï¼ˆAmerican Standard Code for Information Interchangeï¼Œç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ç ï¼‰ï¼Œé‡‡ç”¨ä¸€ä¸ªå­—èŠ‚çš„ä½7ä½æ¥è¡¨ç¤ºï¼Œ0~31æ˜¯æ§åˆ¶å­—ç¬¦ï¼Œå¦‚æ¢è¡Œã€å›è½¦ã€åˆ é™¤ç­‰ï¼Œ32~127æ˜¯æ‰“å°å­—ç¬¦ï¼ŒåŒ…æ‹¬é‚£äº›å¯ä»¥é€šè¿‡é”®ç›˜è¾“å…¥å¹¶ä¸”èƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ¥çš„å­—ç¬¦ï¼Œæ¯”å¦‚å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—ç­‰ã€‚ ISO-8859-1128ä¸ªå­—ç¬¦æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ï¼Œäºæ˜¯ISOç»„ç»‡åœ¨ASCIIç åŸºç¡€ä¸Šåˆåˆ¶å®šäº†ä¸€ç³»åˆ—æ ‡å‡†æ¥æ‰©å±•ASCIIç¼–ç ï¼Œå®ƒä»¬æ˜¯ISO-8859-1è‡³ISO-8859-15ï¼Œå…¶ä¸­ISO-8859-1æ¶µç›–äº†å¤§å¤šæ•°è¥¿æ¬§è¯­è¨€å­—ç¬¦ï¼Œæ‰€ä»¥åº”ç”¨å¾—æœ€å¹¿æ³›ã€‚ISO-8859-1ä»ç„¶æ˜¯å•å­—èŠ‚ç¼–ç ï¼Œå®ƒæ€»å…±èƒ½è¡¨ç¤º256ä¸ªå­—ç¬¦ã€‚ GB2312å¦‚æœè¦å¤„ç†ä¸­æ–‡çš„è¯ï¼Œä¸€ä¸ªå­—èŠ‚æ˜¾ç„¶è¿˜æ˜¯ä¸å¤Ÿç”¨ï¼Œæ‰€ä»¥ï¼Œä¸­å›½åˆ¶å®šäº†GB2312ç¼–ç ï¼Œç”¨æ¥æŠŠä¸­æ–‡ç¼–è¿›å»ã€‚GB2312æ˜¯åŒå­—èŠ‚ç¼–ç ï¼Œæ€»çš„ç¼–ç èŒƒå›´æ˜¯A1~F7ï¼Œå…¶ä¸­A1~A9æ˜¯ç¬¦å·åŒºï¼Œæ€»å…±åŒ…å«682ä¸ªç¬¦å·ï¼›B0~F7æ˜¯æ±‰å­—åŒºï¼ŒåŒ…å«6763ä¸ªæ±‰å­—ã€‚ GBKGBKå…¨ç§°æ˜¯ã€Šæ±‰å­—å†…ç æ‰©å±•è§„èŒƒã€‹ï¼Œæ˜¯å›½å®¶æŠ€æœ¯ç›‘ç£å±€ä¸ºWindows 95æ‰€åˆ¶å®šçš„æ–°çš„æ±‰å­—å†…ç è§„èŒƒï¼Œå®ƒçš„å‡ºç°æ˜¯ä¸ºäº†æ‰©å±•GB2312ï¼Œå¹¶åŠ å…¥æ›´å¤šçš„æ±‰å­—ã€‚å®ƒçš„ç¼–ç èŒƒå›´æ˜¯8140~FEFEï¼ˆå»æ‰XX7Fï¼‰ï¼Œæ€»å…±æœ‰23940ä¸ªç ä½ï¼Œå®ƒèƒ½è¡¨ç¤º21003ä¸ªæ±‰å­—ï¼Œå®ƒçš„ç¼–ç æ˜¯å’ŒGB2312å…¼å®¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨GB2312ç¼–ç çš„æ±‰å­—å¯ä»¥ç”¨GBKæ¥è§£ç ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰ä¹±ç ã€‚ UTF-16è¯´åˆ°UTF-16å¿…é¡»æåˆ°Unicodeï¼ˆUniversal Code ç»Ÿä¸€ç ï¼‰ï¼Œå…¨ä¸–ç•Œæœ‰ä¸Šç™¾ç§è¯­è¨€ï¼Œæ—¥æœ¬æŠŠæ—¥æ–‡ç¼–åˆ°Shift_JISé‡Œï¼ŒéŸ©å›½æŠŠéŸ©æ–‡ç¼–åˆ°Euc-kré‡Œï¼Œå¦‚æ­¤ï¼Œå‡å¦‚å„å›½éƒ½æŒ‰ç…§å„å›½å„è‡ªçš„æ ‡å‡†æ¥è®¾è®¡ç¼–ç ï¼Œåœ¨æŸäº›å¤šè¯­è¨€æ··ç”¨çš„åœºæ™¯ä¸‹ï¼Œå°±ä¼šä¸å¯é¿å…åœ°å‡ºç°ç¼–ç å†²çªã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒISOæå‡ºäº†Unicodeæ ‡å‡†ï¼Œå®ƒè¯•å›¾å°†ä¸–ç•Œä¸Šæ‰€æœ‰è¯­è¨€éƒ½ç»Ÿä¸€åˆ°ä¸€å¥—ç¼–ç é‡Œã€‚è€Œå®é™…ä¸ŠUnicodeä»…ä»…åªæ˜¯ä¸€ä¸ªè§„èŒƒï¼Œå®ƒä½¿ç”¨0~65535ä¹‹é—´çš„æ•°å­—æ¥è¡¨ç¤ºæ‰€æœ‰å­—ç¬¦ï¼Œå…¶ä¸­0~127è¿™128ä¸ªæ•°å­—è¡¨ç¤ºçš„å­—ç¬¦ä¸ASCIIå®Œå…¨ä¸€æ ·ã€‚è‡³äºè¦æŠŠ0~65535è¿™äº›æ•°å­—ä»¥æ€æ ·çš„å½¢å¼è½¬æ¢ä¸º01ä¸²ä¿å­˜åˆ°è®¡ç®—æœºä¸­ï¼ŒUnicodeå¹¶æœªå£°æ˜å…¶å…·ä½“çš„å®ç°æ–¹å¼ï¼Œäºæ˜¯å°±å‡ºç°äº†UTFï¼ˆUnicode Transformation Formatï¼‰ï¼ŒåŒ…æ‹¬ï¼šUTF-16å’ŒUTF-8ã€‚ UTF-16å…·ä½“å®šä¹‰äº†Unicodeå­—ç¬¦åœ¨è®¡ç®—æœºä¸­çš„å­˜å–æ–¹æ³•ï¼Œå®ƒç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºUnicodeçš„è½¬åŒ–æ ¼å¼ï¼Œé‡‡ç”¨å®šé•¿çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå³ä¸è®ºä»€ä¹ˆå­—ç¬¦éƒ½ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¸¤ä¸ªå­—èŠ‚å°±æ˜¯16ä¸ªbitï¼Œæ‰€ä»¥å«UTF-16ã€‚ UTF-8UTF-16ç»Ÿä¸€é‡‡ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè™½ç„¶åœ¨è¡¨ç¤ºä¸Šéå¸¸ç®€å•ã€æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼Œæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†å­—ç¬¦ç”¨ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºçš„ç°åœ¨è¦ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå­˜å‚¨ç©ºé—´æ”¾å¤§äº†ä¸€å€ï¼Œåœ¨ç°åœ¨çš„ç½‘ç»œå¸¦å®½è¿˜éå¸¸æœ‰é™çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·ä¼šå¢å¤§ç½‘ç»œä¼ è¾“çš„æµé‡ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å¿…è¦ã€‚ UTF-8é‡‡ç”¨ä¸€ç§å˜é•¿æŠ€æœ¯ï¼Œæ¯ä¸ªç¼–ç åŒºåŸŸæœ‰ä¸åŒçš„å­—ç é•¿åº¦ã€‚ä¸åŒçš„å­—ç¬¦å¯ä»¥ç”±1~6ä¸ªå­—èŠ‚ç»„æˆã€‚ UTF-8æœ‰ä»¥ä¸‹ç¼–ç è§„åˆ™ï¼š å¦‚æœæ˜¯1ä¸ªå­—èŠ‚ï¼Œæœ€é«˜ä½ï¼ˆç¬¬8ä½ï¼‰ä¸º0ï¼Œåˆ™è¡¨ç¤ºè¿™æ˜¯1ä¸ªASCIIå­—ç¬¦ï¼ˆ00~7Fï¼‰ã€‚å¯è§ï¼Œæ‰€æœ‰ASCIIç¼–ç å·²ç»æ˜¯UTF-8äº†ã€‚ å¦‚æœæ˜¯1ä¸ªå­—èŠ‚ï¼Œä»¥11å¼€å¤´ï¼Œåˆ™è¿ç»­çš„1çš„ä¸ªæ•°æš—ç¤ºè¿™ä¸ªå­—ç¬¦çš„å­—èŠ‚æ•°ï¼Œä¾‹å¦‚;110xxxxxä»£è¡¨å®ƒæ˜¯åŒå­—èŠ‚UTF-8å­—ç¬¦çš„é¦–å­—èŠ‚ã€‚ å¦‚æœæ˜¯1ä¸ªå­—èŠ‚ï¼Œä»¥10å¼€å§‹ï¼Œè¡¨ç¤ºå®ƒä¸æ˜¯é¦–å­—èŠ‚ï¼Œåˆ™éœ€è¦å‘å‰æŸ¥æ‰¾æ‰èƒ½å¾—åˆ°å½“å‰å­—ç¬¦çš„é¦–å­—èŠ‚ã€‚ åœ¨I/Oæ“ä½œä¸­å­˜åœ¨çš„ç¼–ç InputStreamReaderç±»å¯ä»¥å°†I/Oæ“ä½œä¸­è¯»å–åˆ°çš„å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œå…¶éƒ¨åˆ†æºä»£ç å¦‚ä¸‹: package java.io; import java.nio.charset.Charset; import java.nio.charset.CharsetDecoder; import sun.nio.cs.StreamDecoder; public class InputStreamReader extends Reader { private final StreamDecoder sd; /** * Creates an InputStreamReader that uses the default charset. * * @param in An InputStream */ public InputStreamReader(InputStream in) { super(in); try { sd = StreamDecoder.forInputStreamReader(in, this, (String)null); // ## check lock object } catch (UnsupportedEncodingException e) { // The default encoding should always be available throw new Error(e); } } /** * Creates an InputStreamReader that uses the named charset. * * @param in * An InputStream * * @param charsetName * The name of a supported * {@link java.nio.charset.Charset &lt;/code&gt;charset&lt;code&gt;} * * @exception UnsupportedEncodingException * If the named charset is not supported */ public InputStreamReader(InputStream in, String charsetName) throws UnsupportedEncodingException { super(in); if (charsetName == null) throw new NullPointerException(&quot;charsetName&quot;); sd = StreamDecoder.forInputStreamReader(in, this, charsetName); } /** * Creates an InputStreamReader that uses the given charset. &lt;/p&gt; * * @param in An InputStream * @param cs A charset * * @since 1.4 * @spec JSR-51 */ public InputStreamReader(InputStream in, Charset cs) { super(in); if (cs == null) throw new NullPointerException(&quot;charset&quot;); sd = StreamDecoder.forInputStreamReader(in, this, cs); } /** * Creates an InputStreamReader that uses the given charset decoder. &lt;/p&gt; * * @param in An InputStream * @param dec A charset decoder * * @since 1.4 * @spec JSR-51 */ public InputStreamReader(InputStream in, CharsetDecoder dec) { super(in); if (dec == null) throw new NullPointerException(&quot;charset decoder&quot;); sd = StreamDecoder.forInputStreamReader(in, this, dec); } } InputStreamReaderå†…éƒ¨åŒ…å«ä¸€ä¸ªStreamDecoderå®ä¾‹å¼•ç”¨ï¼Œå¯¹å…·ä½“å­—èŠ‚åˆ°å­—ç¬¦çš„è§£ç å®ç°ï¼Œå…¶å®æ˜¯ç”±StreamDecoderæ¥å®Œæˆçš„ï¼Œåœ¨StreamDecoderè§£ç è¿‡ç¨‹ä¸­å¿…é¡»ç”±ç”¨æˆ·æŒ‡å®šCharsetç¼–ç æ ¼å¼ï¼Œè‹¥ç”¨æˆ·æœªæŒ‡å®šCharsetï¼Œåˆ™å°†ä½¿ç”¨æœ¬åœ°ç¯å¢ƒä¸­çš„é»˜è®¤å­—ç¬¦é›†ï¼Œå¦‚åœ¨ä¸­æ–‡ç¯å¢ƒä¸­å°†ä½¿ç”¨GBKç¼–ç ã€‚ å†™çš„æƒ…å†µä¹Ÿç±»ä¼¼ï¼ŒOutputStreamWriterå§”æ‰˜StreamEncoderå°†å­—ç¬¦ç¼–ç æˆå­—èŠ‚ã€‚ package java.io; import java.nio.charset.Charset; import java.nio.charset.CharsetEncoder; import sun.nio.cs.StreamEncoder; public class OutputStreamWriter extends Writer { private final StreamEncoder se; /** * Creates an OutputStreamWriter that uses the named charset. * * @param out * An OutputStream * * @param charsetName * The name of a supported * {@link java.nio.charset.Charset &lt;/code&gt;charset&lt;code&gt;} * * @exception UnsupportedEncodingException * If the named encoding is not supported */ public OutputStreamWriter(OutputStream out, String charsetName) throws UnsupportedEncodingException { super(out); if (charsetName == null) throw new NullPointerException(&quot;charsetName&quot;); se = StreamEncoder.forOutputStreamWriter(out, this, charsetName); } /** * Creates an OutputStreamWriter that uses the default character encoding. * * @param out An OutputStream */ public OutputStreamWriter(OutputStream out) { super(out); try { se = StreamEncoder.forOutputStreamWriter(out, this, (String)null); } catch (UnsupportedEncodingException e) { throw new Error(e); } } /** * Creates an OutputStreamWriter that uses the given charset. &lt;/p&gt; * * @param out * An OutputStream * * @param cs * A charset * * @since 1.4 * @spec JSR-51 */ public OutputStreamWriter(OutputStream out, Charset cs) { super(out); if (cs == null) throw new NullPointerException(&quot;charset&quot;); se = StreamEncoder.forOutputStreamWriter(out, this, cs); } /** * Creates an OutputStreamWriter that uses the given charset encoder. &lt;/p&gt; * * @param out * An OutputStream * * @param enc * A charset encoder * * @since 1.4 * @spec JSR-51 */ public OutputStreamWriter(OutputStream out, CharsetEncoder enc) { super(out); if (enc == null) throw new NullPointerException(&quot;charset encoder&quot;); se = StreamEncoder.forOutputStreamWriter(out, this, enc); } } ä»¥ä¸‹æ˜¯ä½¿ç”¨InputStreamReaderå’ŒOutputStreamWriterè¿›è¡Œå­—èŠ‚æµåˆ°å­—ç¬¦æµçš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚ public static void main(String[] args) throws IOException { String file = &quot;d:/stream.txt&quot;; String charset = &quot;UTF-8&quot;; String string = &quot;è¿™æ˜¯è¦ä¿å­˜çš„ä¸­æ–‡å­—ç¬¦&quot;; FileOutputStream fos = new FileOutputStream(file); OutputStreamWriter osw = new OutputStreamWriter(fos, charset); try { osw.write(string); } finally { osw.close(); } FileInputStream fis = new FileInputStream(file); InputStreamReader isr = new InputStreamReader(fis, charset); StringBuffer sb = new StringBuffer(); char[] buf = new char[64]; int count = 0; try { while ((count = isr.read(buf)) != -1) { sb.append(buf, 0, count); } } finally { isr.close(); } System.out.println(sb.toString()); } åœ¨å†…å­˜æ“ä½œä¸­çš„ç¼–ç Stringç±»æä¾›äº†è½¬æ¢åˆ°å­—èŠ‚çš„æ–¹æ³•ï¼Œä¹Ÿæ”¯æŒå°†å­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ„é€ å‡½æ•°ã€‚ public static void main(String[] args) throws UnsupportedEncodingException { String s=&quot;è¿™æ˜¯ä¸€æ®µä¸­æ–‡å­—ç¬¦ä¸²&quot;; byte[] bytes=s.getBytes(&quot;UTF-8&quot;); String string=new String(bytes,&quot;UTF-8&quot;); } Charsetç±»æä¾›encode()ä¸decode()ï¼Œåˆ†åˆ«å¯¹åº”char[]åˆ°byte[]çš„ç¼–ç å’Œbyte[]åˆ°char[]çš„è§£ç ã€‚ public static void main(String[] args) { Charset cs = Charset.forName(&quot;UTF-8&quot;); ByteBuffer byteBuffer = cs.encode(&quot;è¿™æ˜¯è¦ç¼–ç çš„å­—ç¬¦ä¸²&quot;); CharBuffer charBuffer = cs.decode(byteBuffer); } ByteBufferæä¾›ä¸€ç§charå’Œbyteä¹‹é—´çš„è½¯è½¬æ¢ï¼Œå®ƒä»¬ä¹‹é—´è½¬æ¢ä¸éœ€è¦ç¼–ç å’Œè§£ç ï¼Œåªæ˜¯æŠŠä¸€ä¸ª16bitçš„charæ‹†åˆ†ä¸º2ä¸ª8bitçš„byteè¡¨ç¤ºï¼Œå®ƒä»¬çš„å®é™…å€¼å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œä»…ä»…æ˜¯æ•°æ®çš„ç±»å‹åšäº†è½¬æ¢ã€‚ public static void main(String[] args) { ByteBuffer heapByteBuffer = ByteBuffer.allocate(1024); ByteBuffer buffer = heapByteBuffer.putChar(&#39;ä¸­&#39;); System.out.print(Integer.toBinaryString(buffer.get(0)) + &quot; &quot;); System.out.print(Integer.toBinaryString(buffer.get(1))); } æ‰“å°ç»“æœï¼š1001110 101101 ç¼–ç é—®é¢˜ï¼ˆchar-encoding-problemï¼‰å…¸å‹ç¤ºä¾‹ï¼š public class EncodeTest { static String toHexString(byte[] bytes) { StringBuilder sb = new StringBuilder(&quot;&quot;); if (bytes == null || bytes.length == 0) { return null; } for (int i = 0; i &lt; bytes.length; i++) { int v = bytes[i] &amp; 0xFF; String hv = Integer.toHexString(v); sb.append(hv + &quot; &quot;); } return sb.toString(); } static String toHexString(char[] chars) { StringBuilder sb = new StringBuilder(&quot;&quot;); if (chars == null || chars.length == 0) { return null; } for (int i = 0; i &lt; chars.length; i++) { String hv = Integer.toHexString((int) chars[i]); sb.append(hv + &quot; &quot;); } return sb.toString(); } public static void main(String[] args) { String string = &quot;I am æ&quot;; // Unicodeåè¿›åˆ¶æ•°å€¼ä¸ºï¼š 73 32 97 109 32 26446 // Unicodeåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼š 49 20 61 6d 20 674e // UnicodeäºŒè¿›å­—ç¬¦ä¸²ï¼š 01001001 00100000 01100001 01101101 00100000 0110011101001110 try { byte[] iso8859 = string.getBytes(&quot;ISO-8859-1&quot;); byte[] gb2312 = string.getBytes(&quot;GB2312&quot;); byte[] gbk = string.getBytes(&quot;GBK&quot;); byte[] utf16 = string.getBytes(&quot;UTF-16&quot;); byte[] utf8 = string.getBytes(&quot;UTF-8&quot;); System.out.println(toHexString(string.toCharArray())); // è¾“å‡ºç»“æœï¼š49 20 61 6d 20 674e /** * ISO-8859-1ç¼–ç ä¼šå°†ä¸æ”¯æŒçš„å­—ç¬¦ç¼–ç ä¸º3fï¼Œå³&quot;?&quot;å­—ç¬¦ã€‚ */ System.out.println(toHexString(iso8859)); // è¾“å‡ºç»“æœï¼š49 20 61 6d 20 3f /** * GB2312å­—ç¬¦é›†æœ‰ä¸€ä¸ªä»charåˆ°byteçš„ç è¡¨ï¼Œä¸åŒçš„å­—ç¬¦ç¼–ç å°±æ˜¯ä»è¿™ä¸ªç è¡¨æ‰¾åˆ°ä¸æ¯ä¸ªå­—ç¬¦å¯¹åº”çš„å­—èŠ‚ï¼Œç„¶åæ‹¼è£…æˆbyteæ•°ç»„ã€‚ */ System.out.println(toHexString(gb2312)); // è¾“å‡ºç»“æœï¼š49 20 61 6d 20 c0 ee /** * GBKç¼–ç å…¼å®¹GB2312ç¼–ç ï¼Œä¸”GBKåŒ…å«çš„æ±‰å­—å­—ç¬¦æ›´å¤šã€‚ */ System.out.println(toHexString(gbk)); // è¾“å‡ºç»“æœï¼š49 20 61 6d 20 c0 ee /** * UTF-16ä»…å°†å­—ç¬¦çš„é«˜ä½ä¸ä½ä½è¿›è¡Œæ‹†åˆ†å˜æˆä¸¤ä¸ªå­—èŠ‚ï¼Œç‰¹ç‚¹æ˜¯ç¼–ç æ•ˆç‡éå¸¸é«˜ï¼Œè§„åˆ™å¾ˆç®€å• * å‰é¢ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥ä¿å­˜BYTE_ORDER_MARKå€¼ï¼Œç”¨æ¥åŒºåˆ†æ˜¯é«˜ä½å­—èŠ‚åœ¨å‰ï¼Œæˆ–è€…ä½ä½å­—èŠ‚åœ¨å‰ã€‚ */ System.out.println(toHexString(utf16)); // è¾“å‡ºç»“æœï¼šfe ff 0 49 0 20 0 61 0 6d 0 20 67 4e /** * UTF-8ç¼–ç ä¹Ÿä¸ç”¨æŸ¥è¡¨ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œå˜é•¿å­˜å‚¨èŠ‚çœç©ºé—´ã€‚ */ System.out.println(toHexString(utf8)); // è¾“å‡ºç»“æœï¼š49 20 61 6d 20 e6 9d 8e } catch (Exception e) { e.printStackTrace(); } } } åœ¨Java Webä¸­æ¶‰åŠçš„ç¼–è§£ç URLçš„ç¼–è§£ç ç”¨æˆ·æäº¤ä¸€ä¸ªURLï¼Œåœ¨è¿™ä¸ªURLä¸­å¯èƒ½å­˜åœ¨ä¸­æ–‡ï¼Œå› æ­¤éœ€è¦ç¼–ç ã€‚ Apache Tomcatå¯¹URLçš„URIéƒ¨åˆ†è¿›è¡Œè§£ç çš„å­—ç¬¦é›†æ˜¯åœ¨Connectorçš„&lt;Connector URIEncoding=&quot;UTF-8&quot;/&gt;ä¸­å®šä¹‰çš„ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œé‚£ä¹ˆå°†ä»¥é»˜è®¤ç¼–ç ISO-8859-1è§£æã€‚æ‰€ä»¥æœ‰ä¸­æ–‡URLæ—¶æœ€å¥½æŠŠURIEncodingè®¾ç½®æˆUTF-8ç¼–ç ã€‚ CATALINA_HOME\\conf\\server.xmlä¸­ä¿®æ”¹Connector é…ç½®å¦‚ä¸‹ï¼š &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8483&quot; URIEncoding=&quot;UTF-8&quot;/&gt; URLä¸­ä»¥Getæ–¹å¼è¯·æ±‚çš„QueryStringçš„è§£ç æ˜¯åœ¨request.getParameter()æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶è¿›è¡Œçš„ï¼Œè§£ç å­—ç¬¦é›†è¦ä¹ˆæ˜¯Headerä¸­ContentTypeå®šä¹‰çš„Charsetï¼Œè¦ä¹ˆæ˜¯é»˜è®¤çš„ISO-8859-1ï¼Œè¦ä½¿ç”¨ContentTypeä¸­å®šä¹‰çš„ç¼–ç ï¼Œå°±è¦å°†Connectorçš„&lt;Connector URIEncoding=&quot;UTF-8&quot; useBodyEncodingForURI=&quot;true&quot;/&gt;ä¸­çš„useBodyEncodingForURIè®¾ç½®ä¸ºtrueï¼Œå¯¹QueryStringä½¿ç”¨BodyEncodingè§£ç ã€‚ CATALINA_HOME\\conf\\server.xmlä¸­ä¿®æ”¹Connector é…ç½®å¦‚ä¸‹ï¼š &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8483&quot; URIEncoding=&quot;UTF-8&quot; useBodyEncodingForURI=&quot;true&quot;/&gt; HTTP Headerçš„ç¼–è§£ç å½“å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚æ—¶ï¼Œåœ¨Headerä¸­å¯èƒ½ä¼šä¼ é€’å…¶ä»–å‚æ•°ï¼Œå¦‚Cookieã€redirectPathç­‰ï¼Œå¯¹äºè¿™äº›å‚æ•°Tomcaté»˜è®¤ä½¿ç”¨ISO-8859-1è§£ç ï¼Œå¹¶ä¸”ä¸èƒ½è®¾ç½®æˆå…¶ä»–çš„è§£ç æ ¼å¼ã€‚å› æ­¤ï¼Œå¦‚æœä½ è®¾ç½®çš„Headerä¸­å«æœ‰éASCIIå­—ç¬¦ï¼Œè§£ç ä¸­è‚¯å®šä¼šæœ‰ä¹±ç ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³åŠæ³•ï¼šå¯ä»¥å…ˆå°†è¿™äº›å­—ç¬¦ç”¨org.apache.catalina.util.URLEncoderç¼–ç ï¼Œå†æ·»åŠ åˆ°Headerä¸­ï¼Œä½¿ç”¨è¿™äº›é¡¹æ—¶å†æŒ‰ç…§ç›¸åº”çš„å­—ç¬¦é›†è§£ç å³å¯ã€‚ POSTè¡¨å•çš„ç¼–è§£ç POSTè¡¨å•æäº¤çš„å‚æ•°çš„è§£ç ä¹Ÿæ˜¯åœ¨request.getParameter()æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶å‘ç”Ÿçš„ï¼ŒPOSTè¡¨å•çš„å‚æ•°ä¼ é€’æ–¹æ³•ä¸QueryStringä¸åŒï¼Œå®ƒæ˜¯é€šè¿‡HTTPçš„BODYä¼ é€’åˆ°æœåŠ¡ç«¯çš„ã€‚å½“æˆ‘ä»¬åœ¨é¡µé¢ä¸Šå•å‡»æäº¤æŒ‰é’®æ—¶æµè§ˆå™¨é¦–å…ˆå°†æ ¹æ®ContentTypeçš„Charsetç¼–ç æ ¼å¼å¯¹åœ¨è¡¨å•ä¸­å¡«å…¥çš„å‚æ•°è¿›è¡Œç¼–ç ï¼Œç„¶åæäº¤åˆ°æœåŠ¡å™¨ç«¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯åŒæ ·ä¹Ÿæ˜¯ç”¨ContentTypeä¸­çš„å­—ç¬¦é›†è¿›è¡Œè§£ç çš„ã€‚æ‰€ä»¥é€šè¿‡POSTè¡¨å•æäº¤çš„å‚æ•°ä¸€èˆ¬ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œè€Œä¸”è¿™ä¸ªå­—ç¬¦é›†ç¼–ç æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„ï¼Œå¯ä»¥é€šè¿‡request.setCharacterEncoding(charset)æ¥è®¾ç½®ã€‚ æ³¨æ„ï¼šè¦åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨request.getParameter()æ–¹æ³•ä¹‹å‰å°±è®¾ç½®request.setCharacterEncoding(charset)ï¼Œå¦åˆ™POSTè¡¨å•æäº¤ä¸Šæ¥çš„æ•°æ®å¯èƒ½å‡ºç°ä¹±ç ã€‚ HTTP BODYçš„ç¼–è§£ç å½“ç”¨æˆ·è¯·æ±‚çš„èµ„æºå·²ç»æˆåŠŸè·å–åï¼Œè¿™äº›å†…å®¹å°†é€šè¿‡Responseè¿”å›ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹è¦å…ˆç»è¿‡ç¼–ç ï¼Œå†åˆ°æµè§ˆå™¨è¿›è¡Œè§£ç ã€‚ç¼–è§£ç å­—ç¬¦é›†å¯ä»¥é€šè¿‡response.setCharacterEncodingæ¥è®¾ç½®ï¼Œå®ƒå°†ä¼šè¦†ç›–request.getCharacterencodingçš„å€¼ï¼Œå¹¶ä¸”é€šè¿‡Headerçš„Content-Typeè¿”å›å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°è¿”å›çš„Socketæµæ—¶å°†é€šè¿‡Content-Typeçš„charsetæ¥è§£ç ã€‚å¦‚æœè¿”å›çš„HTTP Headerä¸­Content-Typeæ²¡æœ‰è®¾ç½®charsetï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†æ ¹æ®HTMLçš„&lt;meta HTTP-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=GBK&quot; /&gt;ä¸­çš„charsetæ¥è§£ç ã€‚å¦‚æœä¹Ÿæ²¡æœ‰å®šä¹‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°†ä½¿ç”¨é»˜è®¤çš„ç¼–ç æ¥è§£ç ã€‚ è®¿é—®æ•°æ®åº“éƒ½æ˜¯é€šè¿‡å®¢æˆ·ç«¯JDBCé©±åŠ¨æ¥å®Œæˆçš„ï¼Œç”¨JDBCæ¥å­˜å–æ•°æ®æ—¶è¦å’Œæ•°æ®çš„å†…ç½®ç¼–ç ä¿æŒä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®JDBC URLæ¥æŒ‡å®šï¼Œå¦‚MYSQLï¼šurl=â€œjdbc:mysql://localhost:3306/DB?useUnicode=true&amp;characterEncoding=GBKâ€ã€‚ åœ¨JSä¸­çš„ç¼–ç é—®é¢˜å¤–éƒ¨å¼•å…¥JSæ–‡ä»¶åœ¨ä¸€ä¸ªå•ç‹¬çš„JSæ–‡ä»¶ä¸­åŒ…å«å­—ç¬¦ä¸²è¾“å…¥ çš„æƒ…å†µï¼Œå¦‚ï¼š &lt;html&gt; &lt;head&gt; &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;/&gt; &lt;script src=&quot;script.js&quot; charset=&quot;gbk&quot;&gt;&lt;/script&gt; &lt;/head&gt; &lt;/html&gt; å¦‚æœå¼•å…¥çš„script.jsè„šæœ¬ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š document.write(&quot;è¿™æ˜¯ä¸€æ®µä¸­æ–‡&quot;); è¿™æ—¶å¦‚æœscriptæ²¡æœ‰è®¾ç½®cahrsetï¼Œæµè§ˆå™¨å°±ä¼šä»¥å½“å‰è¿™ä¸ªé¡µé¢çš„é»˜è®¤å­—ç¬¦é›†è§£æè¿™ä¸ªJSæ–‡ä»¶ã€‚å½“script.jsæ–‡ä»¶ä¸å½“å‰é¡µé¢çš„ç¼–ç æ ¼å¼ä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šå‡ºç°ä¹±ç ã€‚ JSçš„URLç¼–ç åœ¨JSä¸­å¤„ç†URLç¼–ç çš„å‡½æ•°æœ‰ä¸‰ä¸ªï¼šescape()ã€encodeURI()å’ŒencodeURIComponent()ã€‚ escape()è¿™ä¸ªå‡½æ•°æ˜¯å°†ASCIIå­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ï¼ˆ* + - . / @ _ï¼‰ä¹‹å¤–çš„å…¶ä»–å­—ç¬¦è½¬åŒ–æˆUnicodeç¼–ç å€¼ï¼Œå¹¶ä¸”åœ¨ç¼–ç å€¼å‰åŠ ä¸Šâ€œ%uâ€ï¼Œé€šè¿‡unescape()å‡½æ•°è§£ç ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ æ³¨æ„ï¼šescape()å’Œunescape()å·²ç»ä»ECMAScript V3 æ ‡å‡†ä¸­åˆ é™¤äº†ï¼ŒURLçš„ç¼–ç å¯ä»¥ç”¨encodeURIå’ŒencodeURIComponentæ¥ä»£æ›¿ã€‚ encodeURI()ä¸escap()ç›¸æ¯”ï¼ŒencodeURI()æ˜¯çœŸæ­£çš„JSç”¨æ¥å¯¹URLç¼–ç çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥å°†æ•´ä¸ªURLä¸­çš„å­—ç¬¦ï¼ˆä¸€äº›ç‰¹æ®Šå­—ç¬¦é™¤å¤–ï¼Œå¦‚ï¼šï¼ # $ &amp; &#39; ( ) * + , - . / : ; = ? @ _ ~ 0-9 a-z A-Zï¼‰è¿›è¡ŒUTF-8ç¼–ç ï¼Œåœ¨æ¯ä¸ªç å€¼å‰åŠ ä¸Šâ€œ%â€ï¼Œè§£ç é€šè¿‡decodeURI()å‡½æ•°ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ encodeURIComponent()encodeURIComponent()è¿™ä¸ªå‡½æ•°æ¯”encodeURI()ç¼–ç è¿˜è¦å½»åº•ï¼Œå®ƒé™¤äº†å¯¹ ! â€˜ ( ) * - . _ ~ 0-9 a-z A-Zè¿™å‡ ä¸ªå­—ç¬¦ä¸ç¼–ç ï¼Œå¯¹å…¶ä»–æ‰€æœ‰å­—ç¬¦éƒ½ç¼–ç ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºå°†ä¸€ä¸ªURLå½“ä½œä¸€ä¸ªå‚æ•°æ”¾åœ¨å¦ä¸€ä¸ªURLä¸­ï¼Œè§£ç é€šè¿‡decodeURIComponent()å‡½æ•°ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ Javaä¸JSç¼–è§£ç é—®é¢˜åœ¨Javaç«¯å¤„ç†URLç¼–è§£ç æœ‰ä¸¤ä¸ªç±»ï¼Œåˆ†åˆ«æ˜¯ java.net.URLEncoderå’Œjava.net.URLDecoderã€‚è¿™ä¸¤ä¸ªç±»å¯ä»¥å°†æ‰€æœ‰â€œ%â€åŠ UTF-8ç å€¼ç”¨UFT-8è§£ç ï¼Œä»è€Œå¾—åˆ°åŸå§‹å­—ç¬¦ã€‚Javaç«¯çš„URLEncoderå’ŒURLDecoderä¸å‰ç«¯JSå¯¹åº”çš„æ˜¯encodeURIComponentå’ŒdecodeURIComponentã€‚ æ³¨æ„ï¼šå¯ä»¥ç”¨encodeURIComponentä¸¤æ¬¡ç¼–ç ï¼Œå¦‚encodeURIComponent(encodeURIComponent(str))ï¼Œè¿™æ ·åœ¨Javaç«¯é€šè¿‡request.getParameter()ç”¨GBKè§£ç åå–å¾—çš„å°±æ˜¯UTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœJavaç«¯éœ€è¦ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å†ç”¨UTF-8è§£ç ä¸€æ¬¡ï¼›å¦‚æœæ˜¯å°†è¿™ä¸ªç»“æœç›´æ¥é€šè¿‡JSè¾“å‡ºåˆ°å‰ç«¯ï¼Œé‚£ä¹ˆè¿™ä¸ªUTF-8å­—ç¬¦ä¸²å¯ä»¥ç›´æ¥åœ¨å‰ç«¯æ­£å¸¸æ˜¾ç¤ºã€‚ å…¶ä»–éœ€è¦ç¼–ç çš„åœ°æ–¹XMLæ–‡ä»¶å¯ä»¥é€šè¿‡è®¾ç½®å¤´æ¥æŒ‡å®šç¼–ç æ ¼å¼ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; Velocityæ¨¡æ¿è®¾ç½®ç¼–ç çš„æ ¼å¼å¦‚ä¸‹ï¼š services.VelocityService.input.encoding=UTF-8 JSPè®¾ç½®ç¼–ç çš„æ ¼å¼å¦‚ä¸‹ï¼š &lt;%@page contentType=&quot;text/html;charset=UTF-8&quot;%&gt;","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,å­—ç¬¦ç¼–ç ","slug":"Java-å­—ç¬¦ç¼–ç ","permalink":"/tags/Java-å­—ç¬¦ç¼–ç /"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"å…ƒæ³¨è§£è¯¦è§£","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--å…ƒæ³¨è§£è¯¦è§£","date":"2020-06-06T09:23:10.000Z","updated":"2023-04-30T10:21:41.350Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--å…ƒæ³¨è§£è¯¦è§£/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--å…ƒæ³¨è§£è¯¦è§£/","excerpt":"","text":"Annotation(æ³¨è§£)ä»JDK 1.5å¼€å§‹, Javaå¢åŠ äº†å¯¹å…ƒæ•°æ®(MetaData)çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯ Annotation(æ³¨è§£)ã€‚ æ³¨è§£å…¶å®å°±æ˜¯ä»£ç é‡Œçš„ç‰¹æ®Šæ ‡è®°ï¼Œå®ƒç”¨äºæ›¿ä»£é…ç½®æ–‡ä»¶ï¼šä¼ ç»Ÿæ–¹å¼é€šè¿‡é…ç½®æ–‡ä»¶å‘Šè¯‰ç±»å¦‚ä½•è¿è¡Œï¼Œæœ‰äº†æ³¨è§£æŠ€æœ¯åï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ³¨è§£å‘Šè¯‰ç±»å¦‚ä½•è¿è¡Œã€‚åœ¨JavaæŠ€æœ¯é‡Œæ³¨è§£çš„å…¸å‹åº”ç”¨æ˜¯ï¼šå¯ä»¥é€šè¿‡åå°„æŠ€æœ¯å»å¾—åˆ°ç±»é‡Œé¢çš„æ³¨è§£ï¼Œä»¥å†³å®šæ€ä¹ˆå»è¿è¡Œç±»ã€‚ æ³¨è§£å¯ä»¥æ ‡è®°åœ¨åŒ…ã€ç±»ã€å±æ€§ã€æ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¸Šï¼Œä¸”åŒä¸€ä¸ªåœ°æ–¹å¯ä»¥åŒæ—¶æ ‡è®°å¤šä¸ªæ³¨è§£ã€‚ // æŠ‘åˆ¶ç¼–è¯‘æœŸçš„æœªæŒ‡å®šæ³›å‹ã€æœªä½¿ç”¨å’Œè¿‡æ—¶è­¦å‘Š @SuppressWarnings({ &quot;rawtypes&quot;, &quot;unused&quot;, &quot;deprecation&quot; }) // é‡å†™ @Override meta-annotationï¼ˆå…ƒæ³¨è§£ï¼‰ é™¤äº†ç›´æ¥ä½¿ç”¨JDK å®šä¹‰å¥½çš„æ³¨è§£ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰æ³¨è§£ï¼Œåœ¨JDK 1.5ä¸­æä¾›äº†4ä¸ªæ ‡å‡†çš„ç”¨æ¥å¯¹æ³¨è§£ç±»å‹è¿›è¡Œæ³¨è§£çš„æ³¨è§£ç±»ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º meta-annotationï¼ˆå…ƒæ³¨è§£ï¼‰ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯ï¼š @Target @Retention @Documented @Inherited æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™4ä¸ªå…ƒæ³¨è§£æ¥å¯¹æˆ‘ä»¬è‡ªå®šä¹‰çš„æ³¨è§£ç±»å‹è¿›è¡Œæ³¨è§£ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ¨ä¸ªå¯¹è¿™4ä¸ªå…ƒæ³¨è§£çš„ä½œç”¨è¿›è¡Œä»‹ç»ã€‚ @Targetæ³¨è§£Targetæ³¨è§£çš„ä½œç”¨æ˜¯ï¼šæè¿°æ³¨è§£çš„ä½¿ç”¨èŒƒå›´ï¼ˆå³ï¼šè¢«ä¿®é¥°çš„æ³¨è§£å¯ä»¥ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹ï¼‰ ã€‚ Targetæ³¨è§£ç”¨æ¥è¯´æ˜é‚£äº›è¢«å®ƒæ‰€æ³¨è§£çš„æ³¨è§£ç±»å¯ä¿®é¥°çš„å¯¹è±¡èŒƒå›´ï¼šæ³¨è§£å¯ä»¥ç”¨äºä¿®é¥° packagesã€typesï¼ˆç±»ã€æ¥å£ã€æšä¸¾ã€æ³¨è§£ç±»ï¼‰ã€ç±»æˆå‘˜ï¼ˆæ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆå‘˜å˜é‡ã€æšä¸¾å€¼ï¼‰ã€æ–¹æ³•å‚æ•°å’Œæœ¬åœ°å˜é‡ï¼ˆå¦‚å¾ªç¯å˜é‡ã€catchå‚æ•°ï¼‰ï¼Œåœ¨å®šä¹‰æ³¨è§£ç±»æ—¶ä½¿ç”¨äº†@Target èƒ½å¤Ÿæ›´åŠ æ¸…æ™°çš„çŸ¥é“å®ƒèƒ½å¤Ÿè¢«ç”¨æ¥ä¿®é¥°å“ªäº›å¯¹è±¡ï¼Œå®ƒçš„å–å€¼èŒƒå›´å®šä¹‰åœ¨ElementType æšä¸¾ä¸­ã€‚ public enum ElementType { TYPE, // ç±»ã€æ¥å£ã€æšä¸¾ç±» FIELD, // æˆå‘˜å˜é‡ï¼ˆåŒ…æ‹¬ï¼šæšä¸¾å¸¸é‡ï¼‰ METHOD, // æˆå‘˜æ–¹æ³• PARAMETER, // æ–¹æ³•å‚æ•° CONSTRUCTOR, // æ„é€ æ–¹æ³• LOCAL_VARIABLE, // å±€éƒ¨å˜é‡ ANNOTATION_TYPE, // æ³¨è§£ç±» PACKAGE, // å¯ç”¨äºä¿®é¥°ï¼šåŒ… TYPE_PARAMETER, // ç±»å‹å‚æ•°ï¼ŒJDK 1.8 æ–°å¢ TYPE_USE // ä½¿ç”¨ç±»å‹çš„ä»»ä½•åœ°æ–¹ï¼ŒJDK 1.8 æ–°å¢ } @Retentionæ³¨è§£Retenitonæ³¨è§£çš„ä½œç”¨æ˜¯ï¼šæè¿°æ³¨è§£ä¿ç•™çš„æ—¶é—´èŒƒå›´ï¼ˆå³ï¼šè¢«æè¿°çš„æ³¨è§£åœ¨å®ƒæ‰€ä¿®é¥°çš„ç±»ä¸­å¯ä»¥è¢«ä¿ç•™åˆ°ä½•æ—¶ï¼‰ ã€‚ Retenitonæ³¨è§£ç”¨æ¥é™å®šé‚£äº›è¢«å®ƒæ‰€æ³¨è§£çš„æ³¨è§£ç±»åœ¨æ³¨è§£åˆ°å…¶ä»–ç±»ä¸Šä»¥åï¼Œå¯è¢«ä¿ç•™åˆ°ä½•æ—¶ï¼Œä¸€å…±æœ‰ä¸‰ç§ç­–ç•¥ï¼Œå®šä¹‰åœ¨RetentionPolicyæšä¸¾ä¸­ã€‚ public enum RetentionPolicy { SOURCE, // æºæ–‡ä»¶ä¿ç•™ CLASS, // ç¼–è¯‘æœŸä¿ç•™ï¼Œé»˜è®¤å€¼ RUNTIME // è¿è¡ŒæœŸä¿ç•™ï¼Œå¯é€šè¿‡åå°„å»è·å–æ³¨è§£ä¿¡æ¯ } ä¸ºäº†éªŒè¯åº”ç”¨äº†è¿™ä¸‰ç§ç­–ç•¥çš„æ³¨è§£ç±»æœ‰ä½•åŒºåˆ«ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸‰ç§ç­–ç•¥å„å®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»åšæµ‹è¯•ã€‚ @Retention(RetentionPolicy.SOURCE) public @interface SourcePolicy { } @Retention(RetentionPolicy.CLASS) public @interface ClassPolicy { } @Retention(RetentionPolicy.RUNTIME) public @interface RuntimePolicy { } ç”¨å®šä¹‰å¥½çš„ä¸‰ä¸ªæ³¨è§£ç±»åˆ†åˆ«å»æ³¨è§£ä¸€ä¸ªæ–¹æ³•ã€‚ public class RetentionTest { @SourcePolicy public void sourcePolicy() { } @ClassPolicy public void classPolicy() { } @RuntimePolicy public void runtimePolicy() { } } å¦‚å›¾æ‰€ç¤ºï¼Œé€šè¿‡æ‰§è¡Œ javap -verbose RetentionTest å‘½ä»¤è·å–åˆ°çš„RetentionTest çš„ class å­—èŠ‚ç å†…å®¹å¦‚ä¸‹ã€‚ { public retention.RetentionTest(); flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return LineNumberTable: line 3: 0 public void sourcePolicy(); flags: ACC_PUBLIC Code: stack=0, locals=1, args_size=1 0: return LineNumberTable: line 7: 0 public void classPolicy(); flags: ACC_PUBLIC Code: stack=0, locals=1, args_size=1 0: return LineNumberTable: line 11: 0 RuntimeInvisibleAnnotations: 0: #11() public void runtimePolicy(); flags: ACC_PUBLIC Code: stack=0, locals=1, args_size=1 0: return LineNumberTable: line 15: 0 RuntimeVisibleAnnotations: 0: #14() } ä» RetentionTest çš„å­—èŠ‚ç å†…å®¹æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ä¸¤ç‚¹ç»“è®ºï¼š ç¼–è¯‘å™¨å¹¶æ²¡æœ‰è®°å½•ä¸‹ sourcePolicy() æ–¹æ³•çš„æ³¨è§£ä¿¡æ¯ï¼› ç¼–è¯‘å™¨åˆ†åˆ«ä½¿ç”¨äº† RuntimeInvisibleAnnotations å’Œ RuntimeVisibleAnnotations å±æ€§å»è®°å½•äº†classPolicy()æ–¹æ³• å’Œ runtimePolicy()æ–¹æ³• çš„æ³¨è§£ä¿¡æ¯ï¼› @Documentedæ³¨è§£Documentedæ³¨è§£çš„ä½œç”¨æ˜¯ï¼šæè¿°åœ¨ä½¿ç”¨ javadoc å·¥å…·ä¸ºç±»ç”Ÿæˆå¸®åŠ©æ–‡æ¡£æ—¶æ˜¯å¦è¦ä¿ç•™å…¶æ³¨è§£ä¿¡æ¯ã€‚ ä¸ºäº†éªŒè¯Documentedæ³¨è§£çš„ä½œç”¨åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ @Documented çš„è‡ªå®šä¹‰æ³¨è§£ç±»ã€‚ import java.lang.annotation.Documented; import java.lang.annotation.ElementType; import java.lang.annotation.Target; @Documented @Target({ElementType.TYPE,ElementType.METHOD}) public @interface MyDocumentedtAnnotation { public String value() default &quot;è¿™æ˜¯@Documentedæ³¨è§£ä¸ºæ–‡æ¡£æ·»åŠ çš„æ³¨é‡Š&quot;; } å†åˆ›å»ºä¸€ä¸ª MyDocumentedTest ç±»ã€‚ @MyDocumentedtAnnotation public class MyDocumentedTest { @Override @MyDocumentedtAnnotation public String toString() { return this.toString(); } } æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸º MyDocumentedTest ç±»ç”Ÿæˆå¸®åŠ©æ–‡æ¡£ã€‚ å‘½ä»¤æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª doc æ–‡ä»¶å¤¹ï¼Œå…¶å†…åŒ…å«ä»¥ä¸‹æ–‡ä»¶ã€‚ æŸ¥çœ‹ index.html å¸®åŠ©æ–‡æ¡£ï¼Œå¯ä»¥å‘ç°åœ¨ç±»å’Œæ–¹æ³•ä¸Šéƒ½ä¿ç•™äº† MyDocumentedtAnnotation æ³¨è§£ä¿¡æ¯ã€‚ ä¿®æ”¹ MyDocumentedtAnnotation æ³¨è§£ç±»ï¼Œå»æ‰ä¸Šé¢çš„ @Documented æ³¨è§£ã€‚ import java.lang.annotation.ElementType; import java.lang.annotation.Target; @Target({ElementType.TYPE,ElementType.METHOD}) public @interface MyDocumentedtAnnotation { public String value() default &quot;è¿™æ˜¯@Documentedæ³¨è§£ä¸ºæ–‡æ¡£æ·»åŠ çš„æ³¨é‡Š&quot;; } é‡æ–°ç”Ÿæˆå¸®åŠ©æ–‡æ¡£ï¼Œæ­¤æ—¶ç±»å’Œæ–¹æ³•ä¸Šçš„ MyDocumentedtAnnotation æ³¨è§£ä¿¡æ¯éƒ½ä¸è§äº†ã€‚ @Inheritedæ³¨è§£Inheritedæ³¨è§£çš„ä½œç”¨æ˜¯ï¼šä½¿è¢«å®ƒä¿®é¥°çš„æ³¨è§£å…·æœ‰ç»§æ‰¿æ€§ï¼ˆå¦‚æœæŸä¸ªç±»ä½¿ç”¨äº†è¢«@Inheritedä¿®é¥°çš„æ³¨è§£ï¼Œåˆ™å…¶å­ç±»å°†è‡ªåŠ¨å…·æœ‰è¯¥æ³¨è§£ï¼‰ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ä»£ç æ¥è¿›è¡Œæµ‹è¯•ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªè¢«@Inheritedä¿®é¥°çš„æ³¨è§£ç±»MyInheritedAnnotationã€‚ import java.lang.annotation.ElementType; import java.lang.annotation.Inherited; import java.lang.annotation.Retention; import java.lang.annotation.RetentionPolicy; import java.lang.annotation.Target; @Inherited @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) public @interface MyInheritedAnnotation { public String name() default &quot;pengjunlee&quot;; } åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ MyInheritedAnnotation æ³¨è§£çš„çˆ¶ç±»å’Œä¸€ä¸ªæ— ä»»ä½•æ³¨è§£çš„å­ç±»ã€‚ @MyInheritedAnnotation(name=&quot;parent&quot;) public class Parent { } public class Child extends Parent{ public static void main(String[] args) { Class&lt;Child&gt; child=Child.class; MyInheritedAnnotation annotation = child.getAnnotation(MyInheritedAnnotation.class); System.out.println(annotation.name()); } } è¿è¡Œç¨‹åºï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š parent æ³¨è§£åº”ç”¨ä¸¾ä¾‹é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»ã€‚ package com.pengjunlee; import java.lang.annotation.ElementType; import java.lang.annotation.Inherited; import java.lang.annotation.Retention; import java.lang.annotation.RetentionPolicy; import java.lang.annotation.Target; @Target({ ElementType.TYPE, ElementType.METHOD }) @Retention(RetentionPolicy.RUNTIME) @Inherited public @interface MyAnnotation { public String name() default &quot;pengjunlee&quot;; } åœ¨ AnnotationTest ä¸­ä½¿ç”¨åå°„è·å–æ³¨è§£ä¿¡æ¯ã€‚ package com.pengjunlee; import java.lang.annotation.Annotation; import java.lang.reflect.Method; @MyAnnotation(name = &quot;name of type&quot;) public class AnnotationTest { @MyAnnotation(name = &quot;name of method&quot;) public String hello() { return &quot;hello&quot;; } public static void main(String[] args) throws NoSuchMethodException, SecurityException { Class&lt;AnnotationTest&gt; annotationTest = AnnotationTest.class; // è·å–ç±»ä¸Šçš„æ‰€æœ‰æ³¨è§£ Annotation[] annotations = annotationTest.getAnnotations(); for (Annotation annotation : annotations) { // è·å–æ³¨è§£çš„å…¨ç±»å System.out.println(annotation.annotationType().getName()); } // è·å– hello() æ–¹æ³• Method method = annotationTest.getMethod(&quot;hello&quot;, new Class[] {}); // hello() æ–¹æ³•ä¸Šæ˜¯å¦æœ‰ MyAnnotation æ³¨è§£ if (method.isAnnotationPresent(MyAnnotation.class)) { // è·å¾—æ³¨è§£ MyAnnotation annotation = method.getAnnotation(MyAnnotation.class); // è·å–æ³¨è§£çš„å†…å®¹ System.out.println(annotation.name()); } } } è¿è¡Œç¨‹åºï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š com.pengjunlee.MyAnnotationname of method","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,å…ƒæ³¨è§£,Annotation","slug":"Java-å…ƒæ³¨è§£-Annotation","permalink":"/tags/Java-å…ƒæ³¨è§£-Annotation/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä¸ºå›¾ç‰‡æ·»åŠ æ°´å°","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä¸ºå›¾ç‰‡æ·»åŠ æ°´å°","date":"2020-06-06T09:22:10.000Z","updated":"2023-04-30T10:21:41.346Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä¸ºå›¾ç‰‡æ·»åŠ æ°´å°/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä¸ºå›¾ç‰‡æ·»åŠ æ°´å°/","excerpt":"","text":"åœ¨å®é™…é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šéœ€è¦ç»™å›¾ç‰‡æ·»åŠ ä¸Šæ°´å°ï¼Œä¿—è¯è¯´çš„å¥½ï¼šâ€œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´â€œï¼Œåœ¨æ­¤å¯¹å…¶å®ç°æ–¹æ³•åšä¸‹ç¬”è®°ã€‚ package com.pengjunlee.watermark; import java.awt.AlphaComposite; import java.awt.Color; import java.awt.Font; import java.awt.Graphics2D; import java.awt.Image; import java.awt.RenderingHints; import java.awt.image.BufferedImage; import java.io.File; import java.io.FileOutputStream; import java.io.IOException; import java.io.InputStream; import java.io.OutputStream; import java.util.logging.Level; import java.util.logging.Logger; import javax.imageio.ImageIO; import com.sun.image.codec.jpeg.JPEGCodec; import com.sun.image.codec.jpeg.JPEGImageEncoder; /** * ä¸ºå›¾ç‰‡æ·»åŠ æ°´å° * * @author pengjunlee * */ public class WaterMarkUtils { private static final Logger logger = Logger.getLogger(&quot;watermark&quot;); // æ°´å°é€æ˜åº¦ private static Float ALPHA_NONE = 0.5f; // æ°´å°æ–‡å­—å­—ä½“ private static Font FONT_SONG = new Font(&quot;å®‹ä½“&quot;, Font.BOLD, 28); // æ°´å°æ–‡å­—é¢œè‰² private static Color COLOR_BLACK = Color.BLACK; /** * ä¸ºå›¾ç‰‡æ·»åŠ æ–‡æœ¬æ°´å° * * @param srcImgPath * æºå›¾ç‰‡è·¯å¾„ * @param targetImgPath * ç›®æ ‡å›¾ç‰‡è·¯å¾„ * @param text * æ°´å°æ–‡å­— * @param font * æ°´å°æ–‡å­—å­—ä½“ * @param color * æ°´å°æ–‡å­—é¢œè‰² * @param alpha * æ°´å°é€æ˜åº¦ * @param degree * æ°´å°æ—‹è½¬è§’åº¦ */ public static void addTextWaterMark(String srcImgPath, String targetImgPath, String text, Font font, Color color, Float alpha, Integer degree) { if (isEmptyStr(srcImgPath) || isEmptyStr(targetImgPath)) { logger.log(Level.WARNING, &quot;invalid watermark file path parameters...&quot;); return; } File srcImgFile = new File(srcImgPath); File targetImgFile = new File(targetImgPath); addTextWaterMark(srcImgFile, targetImgFile, text, font, color, alpha, degree); } /** * ä¸ºå›¾ç‰‡æ·»åŠ æ–‡æœ¬æ°´å° * * @param srcImgFile * æºå›¾ç‰‡æ–‡ä»¶ * @param targetImgFile * ç›®æ ‡å›¾ç‰‡æ–‡ä»¶ * @param text * æ°´å°æ–‡å­— * @param font * æ°´å°æ–‡å­—å­—ä½“ * @param color * æ°´å°æ–‡å­—é¢œè‰² * @param alpha * æ°´å°é€æ˜åº¦ * @param degree * æ°´å°æ—‹è½¬è§’åº¦ */ public static void addTextWaterMark(File srcImgFile, File targetImgFile, String text, Font font, Color color, Float alpha, Integer degree) { if (!isFileReadable(srcImgFile) || null == targetImgFile) { logger.log(Level.WARNING, &quot;invalid watermark file parameters...&quot;); return; } File targetParentFile = targetImgFile.getParentFile(); if (!targetParentFile.exists()) { targetParentFile.mkdirs(); } FileOutputStream outImgStream = null; try { Image srcImg = ImageIO.read(srcImgFile); // è¯»å–å›¾ç‰‡ int srcImgWidth = srcImg.getWidth(null); // å›¾ç‰‡å®½åº¦ int srcImgHeight = srcImg.getHeight(null); // å›¾ç‰‡é«˜åº¦ BufferedImage bufferedImg = new BufferedImage(srcImgWidth, srcImgHeight, BufferedImage.TYPE_INT_RGB); Graphics2D g = bufferedImg.createGraphics(); // å¼€å¯æ–‡æœ¬ç€è‰²æŠ—é”¯é½¿ g.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_ON); // æ§åˆ¶æ˜¾ç¤ºæ–‡æœ¬çš„è´¨é‡ g.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS, RenderingHints.VALUE_FRACTIONALMETRICS_OFF); // æ§åˆ¶ç€è‰²æŠ€æœ¯ g.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_SPEED); g.drawImage(srcImg, 0, 0, srcImgWidth, srcImgHeight, null); // è®¾ç½®è¾¹ç™½ // g.setColor(Color.WHITE); // g.fillRect(0, srcImgHeight - 30, srcImgWidth, srcImgHeight); // è®¾ç½®æ°´å°æ—‹è½¬è§’åº¦ if (null != degree) { g.rotate(Math.toRadians(degree), (double) bufferedImg.getWidth() / 2, (double) bufferedImg.getHeight() / 2); } // è®¾ç½®æ°´å°æ–‡å­—é¢œè‰² g.setColor(null == color ? COLOR_BLACK : color); // è®¾ç½®æ°´å°é€æ˜åº¦ g.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP, null == alpha ? ALPHA_NONE : alpha)); // è®¾ç½®æ°´å°æ–‡å­—å­—ä½“ if (null == font) { font = FONT_SONG; } g.setFont(font); // è®¾ç½®æ°´å°çš„åæ ‡ int x = srcImgWidth - getTextWidth(text, g) - 10; int y = srcImgHeight - 10; // ç»˜åˆ¶æ°´å° g.drawString(text, x, y); g.dispose(); outImgStream = new FileOutputStream(targetImgFile); // ImageIO.write(bufferedImg, &quot;jpg&quot;, outImgStream); JPEGImageEncoder encoder = JPEGCodec.createJPEGEncoder(outImgStream); encoder.encode(bufferedImg); outImgStream.flush(); outImgStream.close(); logger.log(Level.INFO, &quot;add text watermark success...&quot;); } catch (IOException e) { logger.log(Level.SEVERE, e.getMessage()); } finally { if (null != outImgStream) { try { outImgStream.close(); } catch (IOException e) { logger.log(Level.SEVERE, e.getMessage()); } } } } /** * ä¸ºå›¾ç‰‡æ·»åŠ æ–‡æœ¬æ°´å° * * @param srcImgStream * @param targetImgStream * @param text * æ°´å°æ–‡å­— * @param font * æ°´å°æ–‡å­—å­—ä½“ * @param color * æ°´å°æ–‡å­—é¢œè‰² * @param alpha * æ°´å°é€æ˜åº¦ * @param degree * æ°´å°æ—‹è½¬è§’åº¦ */ public static void addTextWaterMark(InputStream srcImgStream, OutputStream targetImgStream, String text, Font font, Color color, Float alpha, Integer degree) { if (null == srcImgStream || null == targetImgStream) { logger.log(Level.WARNING, &quot;invalid watermark file parameters...&quot;); return; } try { Image srcImg = ImageIO.read(srcImgStream); // æ–‡ä»¶è½¬åŒ–ä¸ºå›¾ç‰‡ int srcImgWidth = srcImg.getWidth(null); // å›¾ç‰‡å®½åº¦ int srcImgHeight = srcImg.getHeight(null); // å›¾ç‰‡é«˜åº¦ BufferedImage bufferedImg = new BufferedImage(srcImgWidth, srcImgHeight, BufferedImage.TYPE_INT_RGB); Graphics2D g = bufferedImg.createGraphics(); // å¼€å¯æ–‡æœ¬ç€è‰²æŠ—é”¯é½¿ g.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_ON); // æ§åˆ¶æ˜¾ç¤ºæ–‡æœ¬çš„è´¨é‡ g.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS, RenderingHints.VALUE_FRACTIONALMETRICS_OFF); // æ§åˆ¶ç€è‰²æŠ€æœ¯ g.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_SPEED); g.drawImage(srcImg, 0, 0, srcImgWidth, srcImgHeight, null); // è®¾ç½®è¾¹ç™½ // g.setColor(Color.WHITE); // g.fillRect(0, srcImgHeight - 30, srcImgWidth, srcImgHeight); // è®¾ç½®æ°´å°æ—‹è½¬è§’åº¦ if (null != degree) { g.rotate(Math.toRadians(degree), (double) bufferedImg.getWidth() / 2, (double) bufferedImg.getHeight() / 2); } // è®¾ç½®æ°´å°æ–‡å­—é¢œè‰² g.setColor(null == color ? COLOR_BLACK : color); // è®¾ç½®æ°´å°é€æ˜åº¦ g.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP, null == alpha ? ALPHA_NONE : alpha)); // è®¾ç½®æ°´å°æ–‡å­—å­—ä½“ if (null == font) { font = FONT_SONG; } g.setFont(font); // è®¾ç½®æ°´å°çš„åæ ‡ int x = srcImgWidth - getTextWidth(text, g) - 10; int y = srcImgHeight - 10; // ç»˜åˆ¶æ°´å° g.drawString(text, x, y); g.dispose(); ImageIO.write(bufferedImg, &quot;png&quot;, targetImgStream); targetImgStream.flush(); targetImgStream.close(); logger.log(Level.INFO, &quot;add text watermark success...&quot;); } catch (IOException e) { logger.log(Level.SEVERE, e.getMessage()); } finally { if (null != targetImgStream) { try { targetImgStream.close(); } catch (IOException e) { logger.log(Level.SEVERE, e.getMessage()); } } } } /** * ä¸ºå›¾ç‰‡æ·»åŠ å›¾ç‰‡æ°´å° * * @param srcImgPath * æºå›¾ç‰‡è·¯å¾„ * @param waterImgPath * æ°´å°å›¾ç‰‡è·¯å¾„ * @param targetImgPath * ç›®æ ‡å›¾ç‰‡è·¯å¾„ * @param x * æ°´å°xåæ ‡ * @param y * æ°´å°yåæ ‡ * @param alpha * æ°´å°é€æ˜åº¦ * @param degree * æ°´å°æ—‹è½¬è§’åº¦ */ public static void addImageWaterMark(String srcImgPath, String waterImgPath, String targetImgPath, int x, int y, Float alpha, Integer degree) { if (isEmptyStr(srcImgPath) || isEmptyStr(waterImgPath) || isEmptyStr(targetImgPath)) { logger.log(Level.WARNING, &quot;invalid watermark file path parameters...&quot;); return; } File srcImgFile = new File(srcImgPath); File waterImgFile = new File(waterImgPath); File targetImgFile = new File(targetImgPath); addImageWaterMark(srcImgFile, waterImgFile, targetImgFile, x, y, alpha, degree); } /** * ä¸ºå›¾ç‰‡æ·»åŠ å›¾ç‰‡æ°´å° * * @param srcImgFile * æºå›¾ç‰‡æ–‡ä»¶ * @param waterImgFile * æ°´å°å›¾ç‰‡æ–‡ä»¶ * @param targetImgFile * ç›®æ ‡å›¾ç‰‡æ–‡ä»¶ * @param x * æ°´å°xåæ ‡ * @param y * æ°´å°yåæ ‡ * @param alpha * æ°´å°é€æ˜åº¦ * @param degree * æ°´å°æ—‹è½¬è§’åº¦ */ public static void addImageWaterMark(File srcImgFile, File waterImgFile, File targetImgFile, int x, int y, Float alpha, Integer degree) { if (!isFileReadable(srcImgFile) || !isFileReadable(srcImgFile) || null == targetImgFile) { logger.log(Level.WARNING, &quot;invalid watermark file parameters...&quot;); return; } File targetParentFile = targetImgFile.getParentFile(); if (!targetParentFile.exists()) { targetParentFile.mkdirs(); } FileOutputStream outImgStream = null; try { Image srcImg = ImageIO.read(srcImgFile); // è¯»å–å›¾ç‰‡ int srcImgWidth = srcImg.getWidth(null); // å›¾ç‰‡å®½åº¦ int srcImgHeight = srcImg.getHeight(null); // å›¾ç‰‡é«˜åº¦ BufferedImage bufferedImg = new BufferedImage(srcImgWidth, srcImgHeight, BufferedImage.TYPE_INT_RGB); Graphics2D g = bufferedImg.createGraphics(); // å¼€å¯å›¾å½¢ç€è‰²æŠ—é”¯é½¿ g.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON); // æ§åˆ¶é¢œè‰²ç€è‰²çš„æ–¹å¼ g.setRenderingHint(RenderingHints.KEY_COLOR_RENDERING, RenderingHints.VALUE_COLOR_RENDER_QUALITY); // æ§åˆ¶å¦‚ä½•å¤„ç†æŠ–åŠ¨ g.setRenderingHint(RenderingHints.KEY_DITHERING, RenderingHints.VALUE_DITHER_ENABLE); // æ§åˆ¶å†…æ’æ–¹å¼ g.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BICUBIC); // æ§åˆ¶ç€è‰²æŠ€æœ¯ g.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_SPEED); // ç»˜åˆ¶ç›®æ ‡å›¾ç‰‡ g.drawImage(srcImg, 0, 0, srcImgWidth, srcImgHeight, null); // è®¾ç½®æ°´å°æ—‹è½¬è§’åº¦ if (null != degree) { g.rotate(Math.toRadians(degree), (double) bufferedImg.getWidth() / 2, (double) bufferedImg.getHeight() / 2); } // ç»˜åˆ¶æ°´å°å›¾ç‰‡ Image targetImg = ImageIO.read(waterImgFile); // SRCã€DSTã€SRC_INã€DST_INã€SRC_OUTã€DST_OUTï¼ˆäº¤é›†ä¿ç•™å…¶ä¸€ï¼‰ / CLEARï¼ˆäº¤é›†éƒ½ä¸ä¿ç•™ï¼‰ // SRC_OVERã€DST_OVERã€SRC_ATOPã€DST_ATOPï¼ˆäº¤é›†ä¸€ä¸ªåœ¨ä¸Šï¼‰/ XORï¼ˆå·®é›†ï¼‰ g.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, null == alpha ? ALPHA_NONE : alpha)); g.drawImage(targetImg, x, y, null); g.dispose(); outImgStream = new FileOutputStream(targetImgFile); // ImageIO.write(bufferedImg, &quot;jpg&quot;, outImgStream); JPEGImageEncoder encoder = JPEGCodec.createJPEGEncoder(outImgStream); encoder.encode(bufferedImg); outImgStream.flush(); outImgStream.close(); logger.log(Level.INFO, &quot;add text watermark success...&quot;); } catch (IOException e) { logger.log(Level.SEVERE, e.getMessage()); } finally { if (null != outImgStream) { try { outImgStream.close(); } catch (IOException e) { logger.log(Level.SEVERE, e.getMessage()); } } } } /** * åˆ¤æ–­æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸² * * @param str * @return */ private static boolean isEmptyStr(String str) { return str == null || str.length() == 0; } /** * åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯è¯» * * @param file * @return */ private static boolean isFileReadable(File file) { return file != null &amp;&amp; file.exists() &amp;&amp; file.isFile() &amp;&amp; file.canRead(); } /** * è·å–æ–‡æœ¬åœ¨å›¾ç‰‡å½“å‰å­—ä½“ä¸‹çš„å®½åº¦ * * @param text * @param g * @return */ public static int getTextWidth(String text, Graphics2D g) { return g.getFontMetrics(g.getFont()).charsWidth(text.toCharArray(), 0, text.length()); } public static void main(String[] args) { addTextWaterMark(&quot;D:/src/Yao1.jpg&quot;, &quot;D:/src/target/Yao1.jpg&quot;, &quot;ä½œè€…ï¼špengjunlee&quot;, new Font(&quot;å¾®è½¯é›…é»‘&quot;, Font.BOLD, 25), Color.white, null, null); addImageWaterMark(&quot;D:/src/Yao2.jpg&quot;, &quot;D:/src/watermark.png&quot;, &quot;D:/src/target/Yao2.jpg&quot;, 300, 60, 1f, null); } } ç¨‹åºæ‰§è¡Œåçš„ç»“æœï¼Œå·¦ä¾§ä¸ºåŸå›¾ï¼Œå³ä¾§ä¸ºæ·»åŠ æ°´å°åçš„å›¾ç‰‡ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,æ°´å°","slug":"Java-æ°´å°","permalink":"/tags/Java-æ°´å°/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨Quartzè¿›è¡Œä½œä¸šä»»åŠ¡è°ƒåº¦","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Quartzè¿›è¡Œä½œä¸šä»»åŠ¡è°ƒåº¦","date":"2020-06-06T09:21:10.000Z","updated":"2023-04-30T10:21:41.348Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Quartzè¿›è¡Œä½œä¸šä»»åŠ¡è°ƒåº¦/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Quartzè¿›è¡Œä½œä¸šä»»åŠ¡è°ƒåº¦/","excerpt":"","text":"Quartzæ˜¯ä¸€ä¸ªå®Œå…¨ç”±javaç¼–å†™çš„å¼€æºä½œä¸šè°ƒåº¦æ¡†æ¶ï¼Œä¸ºåœ¨Javaåº”ç”¨ç¨‹åºä¸­è¿›è¡Œä½œä¸šè°ƒåº¦æä¾›äº†ç®€å•å´å¼ºå¤§çš„æœºåˆ¶ã€‚ Quartzå…è®¸å¼€å‘äººå‘˜æ ¹æ®æ—¶é—´é—´éš”ï¼ˆæˆ–å¤©æ•°ï¼‰æ¥è°ƒåº¦ä½œä¸šã€‚å®ƒå®ç°äº†ä½œä¸šå’Œè§¦å‘å™¨çš„å¤šå¯¹å¤šå…³ç³»ï¼Œè¿˜èƒ½æŠŠå¤šä¸ªä½œä¸šä¸ä¸åŒçš„è§¦å‘å™¨å…³è”ã€‚æ•´åˆäº† Quartz çš„åº”ç”¨ç¨‹åºå¯ä»¥é‡ç”¨æ¥è‡ªä¸åŒäº‹ä»¶çš„ä½œä¸šï¼Œè¿˜å¯ä»¥ä¸ºä¸€ä¸ªäº‹ä»¶ç»„åˆå¤šä¸ªä½œä¸šã€‚ ç”± James House åˆ›å»ºå¹¶æœ€åˆäº2001å¹´æ˜¥å¤©è¢«åŠ å…¥sourceforgeå·¥ç¨‹ã€‚ä¹‹åå½’å…¥OpenSymphonyå¼€æºç»„ç»‡(2010å¹´11æœˆä»½å…³é—­)ã€‚Terracottaå…¬å¸åœ¨2009å¹´æ”¶è´­äº†è‘—åçš„Javaå¼€æºç¼“å­˜é¡¹ç›®Ehcacheä»¥åŠJavaä»»åŠ¡è°ƒåº¦é¡¹ç›®Quartzã€‚ å®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttp://www.quartz-scheduler.org/downloads/ 1ã€è®¾ç½®å¼€å§‹æ—¶é—´import org.quartz.Job; import org.quartz.JobExecutionContext; import org.quartz.JobExecutionException; public class MyJob implements Job { @Override public void execute(JobExecutionContext arg0) throws JobExecutionException { System.out.println(&quot;æ‰§è¡Œå®šæ—¶ä»»åŠ¡:MyJob.execute()...ï¼Œå½“å‰æ—¶é—´ï¼š&quot;+System.currentTimeMillis()); } } public static void testStartAt() throws SchedulerException { SchedulerFactory sf = new StdSchedulerFactory(); Scheduler sched = sf.getScheduler(); Date runTime = DateBuilder.evenSecondDate(new Date()); JobDetail job = JobBuilder.newJob(MyJob.class).withIdentity(&quot;jobName1&quot;, &quot;jobGroup1&quot;).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName1&quot;, &quot;triggerGroup1&quot;).startAt(runTime) .build(); sched.scheduleJob(job, trigger); sched.start(); } 2ã€è®¾ç½®ç»“æŸæ—¶é—´public static void testEndAt() throws SchedulerException { SchedulerFactory sf = new StdSchedulerFactory(); Scheduler sched = sf.getScheduler(); Date runTime = DateBuilder.evenSecondDate(new Date()); Date endTime = DateBuilder.evenMinuteDate(new Date()); JobDetail job = JobBuilder.newJob(MyJob.class).withIdentity(&quot;jobName2&quot;, &quot;jobGroup2&quot;).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName2&quot;, &quot;triggerGroup2&quot;).startAt(runTime) .withSchedule(SimpleScheduleBuilder.simpleSchedule().withIntervalInSeconds(1).repeatForever()) .endAt(endTime).build(); sched.scheduleJob(job, trigger); sched.start(); } 3ã€ç®€å•è§¦å‘å™¨SimpleScheduleBuilder.simpleSchedule() å¯ä»¥è®¾ç½®ä½œä¸šæ‰§è¡Œçš„æ—¶é—´é—´éš”å’Œé‡å¤æ‰§è¡Œçš„æ¬¡æ•°ã€‚ public static void testSimJob() throws SchedulerException { SchedulerFactory sf = new StdSchedulerFactory(); Scheduler sched = sf.getScheduler(); JobDetail job = JobBuilder.newJob(MyJob.class).withIdentity(&quot;jobName3&quot;, &quot;jobGroup3&quot;).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName3&quot;, &quot;triggerGroup3&quot;) .withSchedule(SimpleScheduleBuilder.simpleSchedule().withIntervalInSeconds(1).repeatForever()).build(); sched.scheduleJob(job, trigger); sched.start(); } 4ã€Cronè§¦å‘å™¨CronScheduleBuilder.cronSchedule(&quot;0/5 * * * * ?&quot;) ä½¿ç”¨Unix cronè¡¨è¾¾å¼å¯¹ä½œä¸šæ‰§è¡Œå‘¨æœŸè¿›è¡Œè®¾ç½®ã€‚ public static void testCronJob() throws SchedulerException { SchedulerFactory sf = new StdSchedulerFactory(); Scheduler sched = sf.getScheduler(); JobDetail job = JobBuilder.newJob(MyJob.class).withIdentity(&quot;jobName4&quot;, &quot;jobGroup4&quot;).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName4&quot;, &quot;triggerGroup4&quot;) .withSchedule(CronScheduleBuilder.cronSchedule(&quot;0/5 * * * * ?&quot;)).build(); sched.scheduleJob(job, trigger); sched.start(); } 5ã€ä½œä¸šç›‘å¬å™¨import org.quartz.JobDataMap; import org.quartz.JobExecutionContext; import org.quartz.JobExecutionException; import org.quartz.JobKey; import org.quartz.JobListener; public class MyJobListener implements JobListener { @Override public String getName() { return &quot;MyJobListener&quot;; } /** * (1) ä»»åŠ¡æ‰§è¡Œä¹‹å‰æ‰§è¡Œ Called by the Scheduler when a JobDetail is about to be * executed (an associated Trigger has occurred). */ @Override public void jobToBeExecuted(JobExecutionContext context) { System.out.println(&quot;MyJobListener.jobToBeExecuted()&quot;); // è·å–usingJobDataä¸­ä¼ å…¥çš„æ•°æ® JobKey key = context.getJobDetail().getKey(); JobDataMap dataMap = context.getJobDetail().getJobDataMap(); String jobSays = dataMap.getString(&quot;jobSays&quot;); int currentYear = dataMap.getInt(&quot;currentYear&quot;); System.err.println(&quot;Instance &quot; + key + &quot; of DumbJob says: &quot; + jobSays + &quot;, and currentYear is: &quot; + currentYear); } /** * (2) * è¿™ä¸ªæ–¹æ³•æ­£å¸¸æƒ…å†µä¸‹ä¸æ‰§è¡Œ,ä½†æ˜¯å¦‚æœå½“TriggerListenerä¸­çš„vetoJobExecutionæ–¹æ³•è¿”å›trueæ—¶,é‚£ä¹ˆæ‰§è¡Œè¿™ä¸ªæ–¹æ³•. * éœ€è¦æ³¨æ„çš„æ˜¯ å¦‚æœæ–¹æ³•(2)æ‰§è¡Œ é‚£ä¹ˆ(1),(3)è¿™ä¸ªä¿©ä¸ªæ–¹æ³•ä¸ä¼šæ‰§è¡Œ,å› ä¸ºä»»åŠ¡è¢«ç»ˆæ­¢äº†å˜›. Called by the Scheduler * when a JobDetail was about to be executed (an associated Trigger has * occurred), but a TriggerListener vetoed it&#39;s execution. */ @Override public void jobExecutionVetoed(JobExecutionContext context) { System.out.println(&quot;MyJobListener.jobExecutionVetoed()&quot;); } /** * (3) ä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰§è¡Œ,jobExceptionå¦‚æœå®ƒä¸ä¸ºç©ºåˆ™è¯´æ˜ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ Called by the Scheduler * after a JobDetail has been executed, and be for the associated Trigger&#39;s * triggered(xx) method has been called. */ @Override public void jobWasExecuted(JobExecutionContext context, JobExecutionException jobException) { System.out.println(&quot;MyJobListener.jobWasExecuted()&quot;); // è·å–usingJobDataä¸­ä¼ å…¥çš„æ•°æ® JobKey key = context.getJobDetail().getKey(); JobDataMap dataMap = context.getJobDetail().getJobDataMap(); String jobSays = dataMap.getString(&quot;jobSays&quot;); int currentYear = dataMap.getInt(&quot;currentYear&quot;); System.out.println(&quot;Instance &quot; + key + &quot; of DumbJob says: &quot; + jobSays + &quot; and current year is &quot; + currentYear); } } public static void testJobListener() throws SchedulerException { JobKey jobKey = new JobKey(&quot;jobName5&quot;, &quot;jobGroup5&quot;); JobDetail job = JobBuilder.newJob(MyJob.class).withIdentity(jobKey).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName5&quot;, &quot;triggerGroup5&quot;) .withSchedule(CronScheduleBuilder.cronSchedule(&quot;0/5 * * * * ?&quot;)).build(); Scheduler scheduler = new StdSchedulerFactory().getScheduler(); // Listener attached to jobKey // scheduler.getListenerManager().addJobListener(new MyJobListener(), // KeyMatcher.keyEquals(jobKey)); // Listener attached to group scheduler.getListenerManager().addJobListener(new MyJobListener(), GroupMatcher.jobGroupEquals(&quot;jobGroup5&quot;)); scheduler.start(); scheduler.scheduleJob(job, trigger); } 6ã€å¯åŠ¨å¤šä¸ªä½œä¸šimport org.quartz.Job; import org.quartz.JobExecutionContext; import org.quartz.JobExecutionException; public class YourJob implements Job { @Override public void execute(JobExecutionContext arg0) throws JobExecutionException { System.out.println(&quot;æ‰§è¡Œå®šæ—¶ä»»åŠ¡:YourJob.execute()...ï¼Œå½“å‰æ—¶é—´ï¼š&quot; + System.currentTimeMillis()); } } public static void testMultiJobs() throws SchedulerException { JobKey jobKeyA = new JobKey(&quot;jobName6A&quot;, &quot;jobGroup6&quot;); JobDetail jobA = JobBuilder.newJob(MyJob.class).withIdentity(jobKeyA).build(); JobKey jobKeyB = new JobKey(&quot;jobName6B&quot;, &quot;jobGroup6&quot;); JobDetail jobB = JobBuilder.newJob(YourJob.class).withIdentity(jobKeyB).build(); Trigger trigger1 = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName6A&quot;, &quot;triggerGroup6&quot;) .withSchedule(CronScheduleBuilder.cronSchedule(&quot;0/5 * * * * ?&quot;)).build(); Trigger trigger2 = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName6B&quot;, &quot;triggerGroup6&quot;) .withSchedule(CronScheduleBuilder.cronSchedule(&quot;0/5 * * * * ?&quot;)).build(); Scheduler scheduler = new StdSchedulerFactory().getScheduler(); scheduler.start(); scheduler.scheduleJob(jobA, trigger1); scheduler.scheduleJob(jobB, trigger2); } 7ã€æŸ¥çœ‹æ‰€æœ‰ä½œä¸š@SuppressWarnings(&quot;unchecked&quot;) public static void testQueryJobs() throws SchedulerException { Scheduler scheduler = new StdSchedulerFactory().getScheduler(); for (String groupName : scheduler.getJobGroupNames()) { for (JobKey jobKey : scheduler.getJobKeys(GroupMatcher.jobGroupEquals(groupName))) { String jobName = jobKey.getName(); String jobGroup = jobKey.getGroup(); List&lt;Trigger&gt; triggers = (List&lt;Trigger&gt;) scheduler.getTriggersOfJob(jobKey); Date nextFireTime = triggers.get(0).getNextFireTime(); System.out.println(&quot;[jobName] : &quot; + jobName + &quot; [groupName] : &quot; + jobGroup + &quot; - &quot; + nextFireTime); } } } 8ã€æ‰‹åŠ¨è§¦å‘ä½œä¸špublic static void testTriggerJob() throws SchedulerException, InterruptedException { SchedulerFactory sf = new StdSchedulerFactory(); Scheduler sched = sf.getScheduler(); Date runTime = DateBuilder.evenSecondDate(new Date()); JobDetail job = JobBuilder.newJob(MyJob.class).withIdentity(&quot;jobName8&quot;, &quot;jobGroup8&quot;).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName8&quot;, &quot;triggerGroup8&quot;).startAt(runTime) .build(); sched.scheduleJob(job, trigger); sched.start(); // æ‰‹åŠ¨è§¦å‘ä¸¤æ¬¡ sched.triggerJob(new JobKey(&quot;jobName8&quot;, &quot;jobGroup8&quot;)); sched.triggerJob(new JobKey(&quot;jobName8&quot;, &quot;jobGroup8&quot;)); } 9ã€ä¼ é€’å‚æ•°public static void testJobData() throws SchedulerException { SchedulerFactory sf = new StdSchedulerFactory(); Scheduler sched = sf.getScheduler(); Date runTime = DateBuilder.evenSecondDate(new Date()); JobDetail job = JobBuilder.newJob(MyJob.class).withIdentity(&quot;jobName9&quot;, &quot;jobGroup9&quot;) .usingJobData(&quot;jobSays&quot;, &quot;Hello Quartz!&quot;).usingJobData(&quot;currentYear&quot;, 2017).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName9&quot;, &quot;triggerGroup9&quot;).startAt(runTime) .build(); sched.scheduleJob(job, trigger); sched.start(); sched.getListenerManager().addJobListener(new MyJobListener(), GroupMatcher.jobGroupEquals(&quot;jobGroup9&quot;)); } 10ã€å–æ¶ˆ/åˆ é™¤ä½œä¸špublic static void testCancelJob(Scheduler sched) throws SchedulerException { // removes the given trigger sched.unscheduleJob(new TriggerKey(&quot;triggerName10&quot;, &quot;triggerGroup10&quot;)); // removes all triggers to the given job sched.deleteJob(new JobKey(&quot;jobName10&quot;, &quot;jobGroup10&quot;)); } 11ã€ä½œä¸šå‡ºé”™æ—¶è‡ªåŠ¨å†æ‰§è¡Œimport org.quartz.Job; import org.quartz.JobExecutionContext; import org.quartz.JobExecutionException; import org.quartz.JobKey; public class ErrorJob implements Job { private int count = 0; @Override public void execute(JobExecutionContext context) throws JobExecutionException { JobKey jobKey = context.getJobDetail().getKey(); try { int zero = 0; @SuppressWarnings(&quot;unused&quot;) int calculation = 1 / zero; } catch (Exception e) { System.out.println(&quot;Instance &quot; + jobKey + &quot;æ‰§è¡Œå‡ºé”™äº†!!!&quot;); JobExecutionException e2 = new JobExecutionException(e); // allow 5 retries if ((++count) &gt;= 5) { // make sure it doesn&#39;t run again e2.setUnscheduleAllTriggers(true); } else { // fire it again e2.setRefireImmediately(true); } throw e2; } } } public static void testJobRetry() throws SchedulerException { try { SchedulerFactory sf = new StdSchedulerFactory(); Scheduler sched = sf.getScheduler(); Date runTime = DateBuilder.evenSecondDate(new Date()); JobDetail job = JobBuilder.newJob(ErrorJob.class).withIdentity(&quot;jobName11&quot;, &quot;jobGroup11&quot;).build(); Trigger trigger = TriggerBuilder.newTrigger().withIdentity(&quot;triggerName11&quot;, &quot;triggerGroup11&quot;) .startAt(runTime).build(); sched.scheduleJob(job, trigger); sched.start(); } catch (JobExecutionException e) { } } 12ã€JWatch - A Quartz MonitorJWatchå®˜ç½‘åœ°å€ï¼šhttp://code.google.com/p/jwatch/ 13ã€CronMaker - Cronè¡¨è¾¾å¼ç”Ÿæˆå™¨CronMakerç½‘å€ï¼šhttp://www.cronmaker.com/ 14ã€ç›¸å…³èµ„æºä¸‹è½½JWatchç®¡ç†å·¥å…·ï¼šhttp://download.csdn.net/download/pengjunlee/10145202 Quartzä¸­æ–‡APIï¼šhttp://download.csdn.net/download/pengjunlee/10142840 æœ¬æ–‡é¡¹ç›®æºç ï¼šhttp://download.csdn.net/download/pengjunlee/10142832 Quartzè‹±æ–‡APIï¼šhttp://download.csdn.net/download/pengjunlee/10142674","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Quartz","slug":"Java-Quartz","permalink":"/tags/Java-Quartz/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨org.json.JSONObjectå¤„ç†Jsonæ•°æ®","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨org.json.JSONObjectå¤„ç†Jsonæ•°æ®","date":"2020-06-06T09:20:10.000Z","updated":"2023-04-30T10:21:41.350Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨org.json.JSONObjectå¤„ç†Jsonæ•°æ®/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨org.json.JSONObjectå¤„ç†Jsonæ•°æ®/","excerpt":"","text":"å¼•å…¥org.jsonä¾èµ–åœ¨ maven é¡¹ç›®ä¸­ä½¿ç”¨ org.json ï¼Œéœ€å¼•å…¥ä¾èµ–ï¼š &lt;!-- å¼•å…¥org.jsonæ‰€éœ€ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.json&lt;/groupId&gt; &lt;artifactId&gt;json&lt;/artifactId&gt; &lt;version&gt;20160810&lt;/version&gt; &lt;/dependency&gt; æ„å»ºJSONObjectç›´æ¥æ„å»ºå¯ä»¥ç›´æ¥ä½¿ç”¨ new å…³é”®å­—å®ä¾‹åŒ–ä¸€ä¸ªJSONObjectå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å®ƒçš„ put() æ–¹æ³•å¯¹å…¶å­—æ®µå€¼è¿›è¡Œè®¾ç½®ã€‚ èŒƒä¾‹ï¼š JSONObject jsonObj = new JSONObject(); jsonObj.put(&quot;female&quot;, true); jsonObj.put(&quot;hobbies&quot;, Arrays.asList(new String[] { &quot;yoga&quot;, &quot;swimming&quot; })); jsonObj.put(&quot;discount&quot;, 9.5); jsonObj.put(&quot;age&quot;, &quot;26&quot;); jsonObj.put(&quot;features&quot;, new HashMap&lt;String, Integer&gt;() { private static final long serialVersionUID = 1L; { put(&quot;height&quot;, 175); put(&quot;weight&quot;, 70); } }); System.out.println(jsonObj); ç»“æœï¼š { &quot;features&quot;: { &quot;weight&quot;: 70, &quot;height&quot;: 175 }, &quot;hobbies&quot;: [&quot;yoga&quot;, &quot;swimming&quot;], &quot;discount&quot;: 9.5, &quot;female&quot;: true, &quot;age&quot;: 26 } ä½¿ç”¨Mapæ„å»ºèŒƒä¾‹ï¼š Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put(&quot;female&quot;, true); map.put(&quot;hobbies&quot;, Arrays.asList(new String[] { &quot;yoga&quot;, &quot;swimming&quot; })); map.put(&quot;discount&quot;, 9.5); map.put(&quot;age&quot;, &quot;26&quot;); map.put(&quot;features&quot;, new HashMap&lt;String, Integer&gt;() { private static final long serialVersionUID = 1L; { put(&quot;height&quot;, 175); put(&quot;weight&quot;, 70); } }); JSONObject jsonObj = new JSONObject(map); System.out.println(jsonObj); ç¨‹åºæ‰§è¡Œç»“æœä¸ä¸Šä¾‹ç›¸åŒã€‚ ä½¿ç”¨JavaBeanæ„å»ºèŒƒä¾‹ï¼š import java.util.Map; public class UserInfo { private Boolean female; private String[] hobbies; private Double discount; private Integer age; private Map&lt;String, Integer&gt; features; public Boolean getFemale() { return female; } public void setFemale(Boolean female) { this.female = female; } public String[] getHobbies() { return hobbies; } public void setHobbies(String[] hobbies) { this.hobbies = hobbies; } public Double getDiscount() { return discount; } public void setDiscount(Double discount) { this.discount = discount; } public Integer getAge() { return age; } public void setAge(Integer age) { this.age = age; } public Map&lt;String, Integer&gt; getFeatures() { return features; } public void setFeatures(Map&lt;String, Integer&gt; features) { this.features = features; } } UserInfo userInfo = new UserInfo(); userInfo.setFemale(true); userInfo.setHobbies(new String[] { &quot;yoga&quot;, &quot;swimming&quot; }); userInfo.setDiscount(9.5); userInfo.setAge(26); userInfo.setFeatures(new HashMap&lt;String, Integer&gt;() { private static final long serialVersionUID = 1L; { put(&quot;height&quot;, 175); put(&quot;weight&quot;, 70); } }); JSONObject jsonObj = new JSONObject(userInfo); System.out.println(jsonObj); ç¨‹åºæ‰§è¡Œç»“æœä¸ä¸Šä¾‹ç›¸åŒã€‚ è§£æJSONObjectJSONObjectä¸ºæ¯ä¸€ç§æ•°æ®ç±»å‹éƒ½æä¾›äº†ä¸€ä¸ªgetXXX(key)æ–¹æ³•ï¼Œä¾‹å¦‚ï¼šè·å–å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µå€¼å°±ä½¿ç”¨getString()æ–¹æ³•ï¼Œè·å–æ•°ç»„ç±»å‹çš„å­—æ®µå€¼å°±ä½¿ç”¨getJSONArray()æ–¹æ³•ã€‚ èŒƒä¾‹ï¼š // è·å–åŸºæœ¬ç±»å‹æ•°æ® System.out.println(&quot;Female: &quot; + jsonObj.getBoolean(&quot;female&quot;)); System.out.println(&quot;Discount: &quot; + jsonObj.getDouble(&quot;discount&quot;)); System.out.println(&quot;Age: &quot; + jsonObj.getLong(&quot;age&quot;)); // è·å–JSONObjectç±»å‹æ•°æ® JSONObject features = jsonObj.getJSONObject(&quot;features&quot;); String[] names = JSONObject.getNames(features); System.out.println(&quot;Features: &quot;); for (int i = 0; i &lt; names.length; i++) { System.out.println(&quot;\\t&quot;+features.get(names[i])); } // è·å–æ•°ç»„ç±»å‹æ•°æ® JSONArray hobbies = jsonObj.getJSONArray(&quot;hobbies&quot;); System.out.println(&quot;Hobbies: &quot;); for (int i = 0; i &lt; hobbies.length(); i++) { System.out.println(&quot;\\t&quot;+hobbies.get(i)); } ç»“æœï¼š Female: true Discount: 9.5 Age: 26 Features: 70 175 Hobbies: yoga swimming","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,json,JSONObject","slug":"Java-json-JSONObject","permalink":"/tags/Java-json-JSONObject/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨net.sf.jsonéå†Jsonæ•°ç»„","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨net.sf.jsonéå†Jsonæ•°ç»„","date":"2020-06-06T09:19:10.000Z","updated":"2023-04-30T10:21:41.349Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨net.sf.jsonéå†Jsonæ•°ç»„/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨net.sf.jsonéå†Jsonæ•°ç»„/","excerpt":"","text":"ä½¿ç”¨net.sf.jsonéå†Jsonæ•°ç»„import org.junit.Test; import java.util.Iterator; import net.sf.json.JSONArray; import net.sf.json.JSONObject; public class JsonArrayTest { @SuppressWarnings(&quot;unchecked&quot;) @Test public void test1() { String arrStr = &quot;[{key:&#39;a&#39;,value:&#39;1&#39;},{key:&#39;b&#39;,value:&#39;2&#39;},{key:&#39;c&#39;,value:&#39;3&#39;}]&quot;; JSONArray jsonArray = JSONArray.fromObject(arrStr); for (int i = 0; i &lt; jsonArray.size(); i++) { JSONObject jsonObj = jsonArray.getJSONObject(i); Iterator&lt;String&gt; iterator = jsonObj.keys(); while (iterator.hasNext()) { String key = iterator.next(); System.out.println(key + &quot;:&quot; + jsonObj.getString(key) + &quot; &quot;); } } } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,json","slug":"Java-json","permalink":"/tags/Java-json/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨lombokæ¶ˆé™¤å†—ä½™ä»£ç ","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨lombokæ¶ˆé™¤å†—ä½™ä»£ç ","date":"2020-06-06T09:18:10.000Z","updated":"2023-04-30T10:21:41.349Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨lombokæ¶ˆé™¤å†—ä½™ä»£ç /","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨lombokæ¶ˆé™¤å†—ä½™ä»£ç /","excerpt":"","text":"è½¬è½½è‡ªï¼šlombokçš„ä½¿ç”¨å’ŒåŸç† ä¸€ã€é¡¹ç›®èƒŒæ™¯åœ¨å†™Javaç¨‹åºçš„æ—¶å€™ç»å¸¸ä¼šé‡åˆ°å¦‚ä¸‹æƒ…å½¢ï¼š æ–°å»ºäº†ä¸€ä¸ªClassç±»ï¼Œç„¶ååœ¨å…¶ä¸­è®¾ç½®äº†å‡ ä¸ªå­—æ®µï¼Œæœ€åè¿˜éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´æ¥å»ºç«‹getterå’Œsetteræ–¹æ³•ã€‚ lomboké¡¹ç›®çš„äº§ç”Ÿå°±æ˜¯ä¸ºäº†çœå»æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºgetterå’Œsetteræ–¹æ³•çš„éº»çƒ¦ï¼Œå®ƒèƒ½å¤Ÿåœ¨æˆ‘ä»¬ç¼–è¯‘æºç çš„æ—¶å€™è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆgetterå’Œsetteræ–¹æ³•ã€‚å³å®ƒæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼šåœ¨æºç ä¸­æ²¡æœ‰getterå’Œsetteræ–¹æ³•ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­æœ‰getterå’Œsetteræ–¹æ³•ã€‚ æ¯”å¦‚æºç æ–‡ä»¶ï¼š import java.io.Serializable; import lombok.Data; @Data public class BasicClusterInfo implements Serializable { private static final long serialVersionUID = 3478135817352393604L; private String hbaseKey; private int receiverCount; } ä»¥ä¸‹æ˜¯ç¼–è¯‘ä¸Šè¿°æºç æ–‡ä»¶å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå¯¹å…¶åç¼–è¯‘å¾—åˆ°çš„ç»“æœ public class BasicClusterInfo extends java.lang.Object implements java.io.Serializable{ public BasicClusterInfo(); public java.lang.String getHbaseKey(); public int getReceiverCount(); public void setHbaseKey(java.lang.String); public void setReceiverCount(int); public boolean equals(java.lang.Object); public boolean canEqual(java.lang.Object); public int hashCode(); public java.lang.String toString(); } äºŒã€eclipseå®‰è£…lombokä¸ºIDEå®‰è£…lombokæ’ä»¶éå¸¸ç®€å•ï¼Œä»¥eclipseç¯å¢ƒä¸ºä¾‹ï¼Œå…¶å®‰è£…è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š 1) ä¸‹è½½lombok.jaråŒ… lombokçš„å®˜ç½‘åœ°å€ï¼šhttps://projectlombok.org/ lombokçš„ä¸‹è½½åœ°å€ï¼šhttps://projectlombok.org/download.html lomboké¡¹ç›®çš„Githubåœ°å€ï¼šhttps://github.com/rzwitserloot/lombok 2) è¿è¡Œlombok.jar åœ¨windowså‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š java -jar D:\\software\\lombok.jar å…¶ä¸­ D:\\software\\lombok.jar è¿™æ˜¯windowsä¸‹lombok.jaræ‰€åœ¨çš„ä½ç½®ï¼Œ æ•°ç§’åå°†å¼¹å‡ºä»¥ä¸‹å¯¹è¯æ¡†ï¼Œä»¥æŒ‡å®šeclipseçš„å®‰è£…è·¯å¾„ã€‚ 3) ç¡®è®¤å®Œeclipseçš„å®‰è£…è·¯å¾„åï¼Œç‚¹å‡» install/update æŒ‰é’®ï¼Œå³å¯å®Œæˆå®‰è£…ã€‚ 4) å®‰è£…å®Œæˆä¹‹åï¼Œè¯·ç¡®è®¤eclipseå®‰è£…è·¯å¾„ä¸‹æ˜¯å¦å¤šäº†ä¸€ä¸ªlombok.jaråŒ…ï¼Œå¹¶ä¸”å…¶é…ç½®æ–‡ä»¶eclipse.iniä¸­æ˜¯å¦æ·»åŠ äº†å¦‚ä¸‹å†…å®¹: -javaagent:lombok.jar-Xbootclasspath/a:lombok.jar é‚£ä¹ˆæ­å–œä½ å·²ç»å®‰è£…æˆåŠŸï¼Œå¦åˆ™å°†ç¼ºå°‘çš„éƒ¨åˆ†æ·»åŠ åˆ°ç›¸åº”çš„ä½ç½®å³å¯ ã€‚ 5)é‡å¯eclipseã€‚ ä¸‰ã€é¡¹ç›®ä¸­ä½¿ç”¨lombokåœ¨é¡¹ç›®ä¸­ä½¿ç”¨lombokçš„æ–¹æ³•å¾ˆç®€å•ï¼Œåˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆgetterå’Œsetteræ–¹æ³•çš„ç±»ä¸Šï¼ŒåŠ ä¸Š@Dataæ³¨è§£ã€‚ åœ¨ç¼–è¯‘ç±»è·¯å¾„ä¸­åŠ å…¥lombok.jaråŒ…ï¼Œè‹¥æ˜¯mavenå·¥ç¨‹ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–å³å¯ã€‚ &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.16.18&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; ä½¿ç”¨æ”¯æŒlombokçš„ç¼–è¯‘å·¥å…·ç¼–è¯‘æºä»£ç ï¼ˆå…³äºæ”¯æŒlombokçš„ç¼–è¯‘å·¥å…·ï¼Œè§â€œäº”ã€æ”¯æŒlombokçš„ç¼–è¯‘å·¥å…·â€ï¼‰ã€‚ ç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶ä¸­è‡ªåŠ¨ç”Ÿæˆäº†getterå’Œsetteræ–¹æ³•ã€‚ å››ã€åŸç†åˆ†ææ¥ä¸‹æ¥å¯¹lombokçš„å·¥ä½œåŸç†è¿›è¡Œåˆ†æï¼Œä»¥Oracleçš„javacç¼–è¯‘å·¥å…·ä¸ºä¾‹ã€‚ è‡ªä»Java 6èµ·ï¼Œjavacå°±æ”¯æŒJSR 269 Pluggable Annotation Processing APIè§„èŒƒï¼Œåªè¦ç¨‹åºå®ç°äº†è¯¥APIï¼Œå°±èƒ½åœ¨javacè¿è¡Œçš„æ—¶å€™å¾—åˆ°è°ƒç”¨ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œç°åœ¨æœ‰ä¸€ä¸ªå®ç°äº†JSR 269 APIçš„ç¨‹åºA,é‚£ä¹ˆä½¿ç”¨javacç¼–è¯‘æºç çš„æ—¶å€™å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š javacå¯¹æºä»£ç è¿›è¡Œåˆ†æï¼Œç”Ÿæˆä¸€æ£µæŠ½è±¡è¯­æ³•æ ‘(AST)ã€‚ è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨å®ç°äº†â€JSR 269 APIâ€çš„Aç¨‹åºã€‚ æ­¤æ—¶Aç¨‹åºå°±å¯ä»¥å®Œæˆå®ƒè‡ªå·±çš„é€»è¾‘ï¼ŒåŒ…æ‹¬ä¿®æ”¹ç¬¬ä¸€æ­¥éª¤å¾—åˆ°çš„æŠ½è±¡è¯­æ³•æ ‘(AST)ã€‚ javacä½¿ç”¨ä¿®æ”¹åçš„æŠ½è±¡è¯­æ³•æ ‘(AST)ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ã€‚ è¯¦ç»†çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š äº”ã€æ”¯æŒlombokçš„ç¼–è¯‘å·¥å…· ç”±â€œå››ã€åŸç†åˆ†æâ€å¯çŸ¥ï¼ŒOracle javacç›´æ¥æ”¯æŒlombokã€‚ å¸¸ç”¨çš„é¡¹ç›®ç®¡ç†å·¥å…·Mavenæ‰€ä½¿ç”¨çš„javaç¼–è¯‘å·¥å…·æ¥æºäºé…ç½®çš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚æœæˆ‘ä»¬é…ç½®è¿™ä¸ªç¬¬ä¸‰æ–¹å·¥å…·ä¸ºOracle javacçš„è¯ï¼Œé‚£ä¹ˆMavenä¹Ÿå°±ç›´æ¥æ”¯æŒlombokäº†ã€‚ Intellij Ideaé…ç½®çš„ç¼–è¯‘å·¥å…·ä¸ºOracle javacçš„è¯ï¼Œä¹Ÿå°±ç›´æ¥æ”¯æŒlombokäº†ã€‚ Eclipseä¸­ä½¿ç”¨çš„ä¸æ˜¯Oracle javacè¿™ä¸ªç¼–è¯‘å·¥å…·ï¼Œè€Œæ˜¯è‡ªå·±å®ç°çš„Eclipse Compiler for Java (ECJ).è¦æƒ³ä½¿ECJæ”¯æŒlombokï¼Œå¾—è¿›è¡Œè®¾ç½®ï¼Œå…·ä½“æ˜¯åœ¨Eclipseç¨‹åºç›®å½•ä¸­çš„eclipse.iniæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¸¤è¡Œè®¾ç½®ï¼š -javaagent:[lombok.jaræ‰€åœ¨è·¯å¾„] -Xbootclasspath/a:[lombok.jaræ‰€åœ¨è·¯å¾„] å…­ã€å¸¸ç”¨lombokæ³¨è§£lombok æä¾›çš„æ³¨è§£ä¸å¤šï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹è§†é¢‘çš„è®²è§£å’Œå®˜æ–¹æ–‡æ¡£ã€‚ Lombok æ³¨è§£åœ¨çº¿å¸®åŠ©æ–‡æ¡£ï¼šhttp://projectlombok.org/features/index ä¸‹é¢æ˜¯å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ lombok æ³¨è§£ï¼š @Data ï¼šæ³¨è§£åœ¨ç±»ä¸Šï¼›æä¾›ç±»æ‰€æœ‰å±æ€§çš„ getting å’Œ setting æ–¹æ³•ï¼Œæ­¤å¤–è¿˜æä¾›äº†equalsã€canEqualã€hashCodeã€toString æ–¹æ³• @Setterï¼šæ³¨è§£åœ¨å±æ€§ä¸Šï¼›ä¸ºå±æ€§æä¾› setting æ–¹æ³• @Getterï¼šæ³¨è§£åœ¨å±æ€§ä¸Šï¼›ä¸ºå±æ€§æä¾› getting æ–¹æ³• @Log4j ï¼šæ³¨è§£åœ¨ç±»ä¸Šï¼›ä¸ºç±»æä¾›ä¸€ä¸ª å±æ€§åä¸ºlog çš„ log4j æ—¥å¿—å¯¹è±¡ @NoArgsConstructorï¼šæ³¨è§£åœ¨ç±»ä¸Šï¼›ä¸ºç±»æä¾›ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³• @AllArgsConstructorï¼šæ³¨è§£åœ¨ç±»ä¸Šï¼›ä¸ºç±»æä¾›ä¸€ä¸ªå…¨å‚çš„æ„é€ æ–¹æ³• ä¸ƒã€å…¶ä»–é—®é¢˜ç°åœ¨ä½¿ç”¨Intellij Ideaä½œä¸ºJavaé¡¹ç›®çš„IDEï¼Œé…ç½®Oracle javacä½œä¸ºç¼–è¯‘å·¥å…·ã€‚ ç°åœ¨æœ‰ä¸€ä¸ªAç±»ï¼Œå…¶ä¸­æœ‰ä¸€äº›å­—æ®µï¼Œæ²¡æœ‰åˆ›å»ºå®ƒä»¬çš„setterå’Œgetteræ–¹æ³•ï¼Œä½¿ç”¨äº†lombokçš„@Dataæ³¨è§£ï¼Œå¦å¤–æœ‰ä¸€ä¸ªBç±»ï¼Œå®ƒè°ƒç”¨äº†Aç±»å®ä¾‹çš„ç›¸åº”å­—æ®µçš„setterå’Œgetteræ–¹æ³•ã€‚ ç¼–è¯‘Aç±»å’ŒBç±»æ‰€åœ¨çš„é¡¹ç›®ï¼Œå¹¶ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºæœ€ç»ˆç”Ÿæˆçš„Aç±»å­—èŠ‚ç æ–‡ä»¶ä¸­å­˜åœ¨ç›¸åº”å­—æ®µçš„setterå’Œgetteræ–¹æ³•ã€‚ä½†æ˜¯ï¼ŒIDEå‘ç°Bç±»æºä»£ç ä¸­æ‰€ä½¿ç”¨çš„Aç±»å®ä¾‹çš„setterå’Œgetteræ–¹æ³•åœ¨Aç±»æºä»£ç ä¸­æ‰¾ä¸åˆ°å®šä¹‰ï¼ŒIDEä¼šè®¤ä¸ºè¿™æ˜¯é”™è¯¯ã€‚ è¦è§£å†³ä»¥ä¸Šè¿™ä¸ªä¸æ˜¯çœŸæ­£é”™è¯¯çš„é”™è¯¯ï¼Œå¯ä»¥ä¸‹è½½å®‰è£…Intellij Ideaä¸­çš„â€Lombok pluginâ€ã€‚ å…«ã€lombokçš„ç½ªæ¶ä½¿ç”¨lombokè™½ç„¶èƒ½å¤Ÿçœå»æ‰‹åŠ¨åˆ›å»ºsetterå’Œgetteræ–¹æ³•çš„éº»çƒ¦ï¼Œä½†æ˜¯å´å¤§å¤§é™ä½äº†æºä»£ç æ–‡ä»¶çš„å¯è¯»æ€§å’Œå®Œæ•´æ€§ï¼Œé™ä½äº†é˜…è¯»æºä»£ç çš„èˆ’é€‚åº¦ã€‚ å‚è€ƒæ–‡çŒ®[1] http://stackoverflow.com/questions/6107197/how-does-lombok-work[2] https://projectlombok.org/download.html[3] http://stackoverflow.com/questions/3061654/what-is-the-difference-between-javac-and-the-eclipse-compiler[4] http://www.ibm.com/developerworks/library/j-lombok/[5] http://notatube.blogspot.com/2010/12/project-lombok-creating-custom.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,lombok","slug":"Java-lombok","permalink":"/tags/Java-lombok/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨HttpURLConnectionè¯·æ±‚webserviceæ¥å£","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨HttpURLConnectionè¯·æ±‚webserviceæ¥å£","date":"2020-06-06T09:17:10.000Z","updated":"2023-04-30T10:21:41.348Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨HttpURLConnectionè¯·æ±‚webserviceæ¥å£/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨HttpURLConnectionè¯·æ±‚webserviceæ¥å£/","excerpt":"","text":"æœ¬æ–‡ä»¥è·å–å¤©æ°”é¢„æŠ¥webserviceæ¥å£ä¸ºä¾‹ï¼Œä½¿ç”¨Â·HttpURLConnectionÂ·é€šè¿‡å‘é€SOAPæ¶ˆæ¯æ ¼å¼å†…å®¹æ¥è¯·æ±‚webserviceæ¥å£ã€‚ å¤©æ°”é¢„æŠ¥æ¥å£åœ°å€ï¼šhttp://www.webxml.com.cn/WebServices/WeatherWebService.asmx?wsdl import java.io.BufferedReader; import java.io.InputStreamReader; import java.io.OutputStream; import java.net.HttpURLConnection; import java.net.URL; public class HttpUtil { public static String sendSoapPost(String url, String xml, String contentType, String soapAction) { String urlString = url; HttpURLConnection httpConn = null; OutputStream out = null; String returnXml = &quot;&quot;; try { httpConn = (HttpURLConnection) new URL(urlString).openConnection(); httpConn.setRequestProperty(&quot;Content-Type&quot;, contentType); if (null != soapAction) { httpConn.setRequestProperty(&quot;SOAPAction&quot;, soapAction); } httpConn.setRequestMethod(&quot;POST&quot;); httpConn.setDoOutput(true); httpConn.setDoInput(true); httpConn.connect(); out = httpConn.getOutputStream(); // è·å–è¾“å‡ºæµå¯¹è±¡ httpConn.getOutputStream().write(xml.getBytes(&quot;UTF-8&quot;)); // å°†è¦æäº¤æœåŠ¡å™¨çš„SOAPè¯·æ±‚å­—ç¬¦æµå†™å…¥è¾“å‡ºæµ out.flush(); out.close(); int code = httpConn.getResponseCode(); // ç”¨æ¥è·å–æœåŠ¡å™¨å“åº”çŠ¶æ€ String tempString = null; StringBuffer sb1 = new StringBuffer(); if (code == HttpURLConnection.HTTP_OK) { BufferedReader reader = new BufferedReader( new InputStreamReader(httpConn.getInputStream(), &quot;UTF-8&quot;)); while ((tempString = reader.readLine()) != null) { sb1.append(tempString); } if (null != reader) { reader.close(); } } else { BufferedReader reader = new BufferedReader( new InputStreamReader(httpConn.getErrorStream(), &quot;UTF-8&quot;)); // ä¸€æ¬¡è¯»å…¥ä¸€è¡Œï¼Œç›´åˆ°è¯»å…¥nullä¸ºæ–‡ä»¶ç»“æŸ while ((tempString = reader.readLine()) != null) { sb1.append(tempString); } if (null != reader) { reader.close(); } } // å“åº”æŠ¥æ–‡ returnXml = sb1.toString(); } catch (Exception e) { e.printStackTrace(); } return returnXml; } public static void main(String[] args) { String url = &quot;http://www.webxml.com.cn/WebServices/WeatherWebService.asmx&quot;; StringBuilder sb = new StringBuilder(&quot;&quot;); sb.append( &quot;&lt;soapenv:Envelope xmlns:soapenv=\\&quot;http://schemas.xmlsoap.org/soap/envelope/\\&quot; &quot;) .append(&quot;xmlns:web=\\&quot;http://WebXml.com.cn/\\&quot;&gt;&lt;soapenv:Header/&gt;&lt;soapenv:Body&gt;&quot;) .append(&quot;&lt;web:getSupportProvince/&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;&quot;); /* * sb.append( * &quot;&lt;soapenv:Envelope xmlns:soapenv=\\&quot;http://schemas.xmlsoap.org/soap/envelope/\\&quot; &quot; * ) .append( * &quot;xmlns:web=\\&quot;http://WebXml.com.cn/\\&quot;&gt;&lt;soapenv:Header/&gt;&lt;soapenv:Body&gt;&lt;web:getSupportCity&gt;&quot; * ) .append( * &quot;&lt;web:byProvinceName&gt;æ²³åŒ—&lt;/web:byProvinceName&gt;&lt;/web:getSupportCity&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;&quot; * ); */ String dataXml = sb.toString(); String contentType = &quot;text/xml; charset=utf-8&quot;; String soapAction = &quot;http://WebXml.com.cn/getSupportProvince&quot;; // String soapAction = // &quot;\\&quot;document/http://pengjunnlee.com/CustomUI:GetWeatherById\\&quot;&quot;; String resultXml = HttpUtil.sendSoapPost(url, dataXml, contentType, soapAction); System.out.println(resultXml); } } æ‰§è¡Œç¨‹åºï¼Œæ§åˆ¶å°æ‰“å°ç»“æœã€‚ &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;&lt;soap:Body&gt;&lt;getSupportProvinceResponse xmlns=&quot;http://WebXml.com.cn/&quot;&gt;&lt;getSupportProvinceResult&gt;&lt;string&gt;ç›´è¾–å¸‚&lt;/string&gt;&lt;string&gt;ç‰¹åˆ«è¡Œæ”¿åŒº&lt;/string&gt;&lt;string&gt;é»‘é¾™æ±Ÿ&lt;/string&gt;&lt;string&gt;å‰æ—&lt;/string&gt;&lt;string&gt;è¾½å®&lt;/string&gt;&lt;string&gt;å†…è’™å¤&lt;/string&gt;&lt;string&gt;æ²³åŒ—&lt;/string&gt;&lt;string&gt;æ²³å—&lt;/string&gt;&lt;string&gt;å±±ä¸œ&lt;/string&gt;&lt;string&gt;å±±è¥¿&lt;/string&gt;&lt;string&gt;æ±Ÿè‹&lt;/string&gt;&lt;string&gt;å®‰å¾½&lt;/string&gt;&lt;string&gt;é™•è¥¿&lt;/string&gt;&lt;string&gt;å®å¤&lt;/string&gt;&lt;string&gt;ç”˜è‚ƒ&lt;/string&gt;&lt;string&gt;é’æµ·&lt;/string&gt;&lt;string&gt;æ¹–åŒ—&lt;/string&gt;&lt;string&gt;æ¹–å—&lt;/string&gt;&lt;string&gt;æµ™æ±Ÿ&lt;/string&gt;&lt;string&gt;æ±Ÿè¥¿&lt;/string&gt;&lt;string&gt;ç¦å»º&lt;/string&gt;&lt;string&gt;è´µå·&lt;/string&gt;&lt;string&gt;å››å·&lt;/string&gt;&lt;string&gt;å¹¿ä¸œ&lt;/string&gt;&lt;string&gt;å¹¿è¥¿&lt;/string&gt;&lt;string&gt;äº‘å—&lt;/string&gt;&lt;string&gt;æµ·å—&lt;/string&gt;&lt;string&gt;æ–°ç–†&lt;/string&gt;&lt;string&gt;è¥¿è—&lt;/string&gt;&lt;string&gt;å°æ¹¾&lt;/string&gt;&lt;string&gt;äºšæ´²&lt;/string&gt;&lt;string&gt;æ¬§æ´²&lt;/string&gt;&lt;string&gt;éæ´²&lt;/string&gt;&lt;string&gt;åŒ—ç¾æ´²&lt;/string&gt;&lt;string&gt;å—ç¾æ´²&lt;/string&gt;&lt;string&gt;å¤§æ´‹æ´²&lt;/string&gt;&lt;/getSupportProvinceResult&gt;&lt;/getSupportProvinceResponse&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,HttpURLConnection,webservice","slug":"Java-HttpURLConnection-webservice","permalink":"/tags/Java-HttpURLConnection-webservice/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨HttpClientå‘é€è¯·æ±‚","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨HttpClientå‘é€è¯·æ±‚","date":"2020-06-06T09:16:10.000Z","updated":"2023-04-30T10:21:41.348Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨HttpClientå‘é€è¯·æ±‚/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨HttpClientå‘é€è¯·æ±‚/","excerpt":"","text":"ç®€ä»‹HTTP åè®®å¯èƒ½æ˜¯ç°åœ¨ Internetä¸Šä½¿ç”¨å¾—æœ€å¤šã€æœ€é‡è¦çš„åè®®äº†ï¼Œè¶Šæ¥è¶Šå¤šçš„ Java åº”ç”¨ç¨‹åºéœ€è¦ç›´æ¥é€šè¿‡ HTTP åè®®æ¥è®¿é—®ç½‘ç»œèµ„æºã€‚ åœ¨ JDK çš„ java.net åŒ…ä¸­å·²ç»æä¾›äº†è®¿é—® HTTP åè®®çš„åŸºæœ¬åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥åŒ…ä¸­çš„ URLConnection ç±»æ¥å‘é€GETå’ŒPOSTè¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºæ¥è¯´ï¼ŒJDK åº“æœ¬èº«æä¾›çš„åŠŸèƒ½è¿˜ä¸å¤Ÿä¸°å¯Œå’Œçµæ´»ã€‚ HttpClient æ˜¯ Apache Jakarta Common ä¸‹çš„å­é¡¹ç›®ï¼Œç”¨æ¥æä¾›é«˜æ•ˆçš„ã€æœ€æ–°çš„ã€åŠŸèƒ½ä¸°å¯Œçš„æ”¯æŒ HTTP åè®®çš„å®¢æˆ·ç«¯ç¼–ç¨‹å·¥å…·åŒ…ï¼Œå¹¶ä¸”å®ƒæ”¯æŒ HTTP åè®®æœ€æ–°çš„ç‰ˆæœ¬å’Œå»ºè®®ã€‚ ç°åœ¨ HttpClient æœ€æ–°ç‰ˆæœ¬ä¸º HttpClient 4.5 (GA) ï¼ˆ2015-09-11ï¼‰ï¼Œä¸‹è½½åœ°å€ï¼šhttp://hc.apache.org/downloads.cgi ã€‚ HttpClient æä¾›äº†ä»¥ä¸‹ä¸»è¦çš„åŠŸèƒ½ï¼š å®ç°äº†æ‰€æœ‰ HTTP çš„æ–¹æ³•ï¼ˆGET,POST,PUT,HEAD ç­‰ï¼‰ æ”¯æŒè‡ªåŠ¨è½¬å‘ æ”¯æŒ HTTPS åè®® æ”¯æŒä»£ç†æœåŠ¡å™¨ç­‰ ä½¿ç”¨æ–¹æ³•ä½¿ç”¨ HttpClient å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ä¸€èˆ¬éœ€è¦ä»¥ä¸‹ å›› ä¸ªæ­¥éª¤ï¼š åˆ›å»º HttpClient çš„å®ä¾‹ã€‚ åˆ›å»ºè¯·æ±‚æ–¹æ³•çš„å®ä¾‹ï¼Œå¹¶æŒ‡å®šè¯·æ±‚URLï¼Œå¦‚æœéœ€è¦å‘é€GETè¯·æ±‚ï¼Œåˆ›å»ºHttpGetå¯¹è±¡ï¼›å¦‚æœéœ€è¦å‘é€POSTè¯·æ±‚ï¼Œåˆ›å»ºHttpPostå¯¹è±¡ã€‚ è°ƒç”¨åˆ›å»ºå¥½çš„ HttpClient å®ä¾‹çš„HttpClient.execute(HttpUriRequest request) æ–¹æ³•æ¥æ‰§è¡Œè¯·æ±‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå°è£…äº†æœåŠ¡å™¨å“åº”ä¿¡æ¯çš„HttpResponseå¯¹è±¡ã€‚ é‡Šæ”¾è¿æ¥ï¼Œæ— è®ºæ‰§è¡Œæ–¹æ³•æ˜¯å¦æˆåŠŸï¼Œéƒ½å¿…é¡»é‡Šæ”¾è¿æ¥ã€‚ å°è£…å·¥å…·ç±»import java.io.IOException; import java.io.UnsupportedEncodingException; import java.security.KeyManagementException; import java.security.KeyStoreException; import java.security.NoSuchAlgorithmException; import java.security.cert.CertificateException; import java.security.cert.X509Certificate; import java.util.ArrayList; import java.util.List; import javax.net.ssl.SSLContext; import org.apache.http.Header; import org.apache.http.HttpEntity; import org.apache.http.HttpResponse; import org.apache.http.HttpStatus; import org.apache.http.client.ClientProtocolException; import org.apache.http.client.config.RequestConfig; import org.apache.http.client.entity.UrlEncodedFormEntity; import org.apache.http.client.methods.CloseableHttpResponse; import org.apache.http.client.methods.HttpGet; import org.apache.http.client.methods.HttpPost; import org.apache.http.conn.ssl.SSLConnectionSocketFactory; import org.apache.http.conn.ssl.TrustStrategy; import org.apache.http.entity.StringEntity; import org.apache.http.impl.client.CloseableHttpClient; import org.apache.http.impl.client.HttpClients; import org.apache.http.message.BasicHeader; import org.apache.http.message.BasicNameValuePair; import org.apache.http.ssl.SSLContextBuilder; import org.apache.http.util.EntityUtils; import org.apache.log4j.Logger; /** * Httpè¯·æ±‚å·¥å…·ç±» * * @author pengjunlee */ public class HttpUtil { private static Logger log = Logger.getLogger(HttpUtil.class); /** * å‘é€GETè¯·æ±‚ * @param isHttps æ˜¯å¦https * @param url è¯·æ±‚åœ°å€ * @return å“åº”ç»“æœ */ public static String get(boolean isHttps, String url) { CloseableHttpClient httpClient = null; try { if (!isHttps) { httpClient = HttpClients.createDefault(); } else { httpClient = createSSLInsecureClient(); } HttpGet httpget = new HttpGet(url); // HttpGetè®¾ç½®è¯·æ±‚å¤´çš„ä¸¤ç§ç§æ–¹å¼ // httpget.addHeader(new BasicHeader(&quot;Connection&quot;, &quot;Keep-Alive&quot;)); // httpget.addHeader(&quot;Connection&quot;, &quot;Keep-Alive&quot;); Header[] heads = httpget.getAllHeaders(); for (int i = 0; i &lt; heads.length; i++) { System.out.println(heads[i].getName() + &quot;--&gt;&quot; + heads[i].getValue()); } CloseableHttpResponse response = httpClient.execute(httpget); // åˆ¤æ–­çŠ¶æ€è¡Œ if (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) { HttpEntity entity = response.getEntity(); if (entity != null) { String out = EntityUtils.toString(entity, &quot;UTF-8&quot;); return out; } } } catch (ClientProtocolException e) { e.printStackTrace(); return null; } catch (IOException e) { e.printStackTrace(); return null; } finally { try { if (null != httpClient) { httpClient.close(); } } catch (IOException e) { log.error(&quot;httpClient.close()å¼‚å¸¸&quot;); } } return null; } /** * å‘é€POSTè¯·æ±‚ * @param isHttps æ˜¯å¦https * @param url è¯·æ±‚åœ°å€ * @param data è¯·æ±‚å®ä½“å†…å®¹ * @param contentType è¯·æ±‚å®ä½“å†…å®¹çš„ç±»å‹ * @return å“åº”ç»“æœ */ public static String post(boolean isHttps, String url, String data, String contentType) { CloseableHttpClient httpClient = null; try { if (!isHttps) { httpClient = HttpClients.createDefault(); } else { httpClient = createSSLInsecureClient(); } HttpPost httpPost = new HttpPost(url); // HttpPostè®¾ç½®è¯·æ±‚å¤´çš„ä¸¤ç§ç§æ–¹å¼ //httpPost.addHeader(new BasicHeader(&quot;Connection&quot;, &quot;Keep-Alive&quot;)); //httpPost.addHeader(&quot;Connection&quot;, &quot;Keep-Alive&quot;); // UrlEncodedFormEntityå¤„ç†é”®å€¼å¯¹æ ¼å¼è¯·æ±‚å‚æ•° //List&lt;BasicNameValuePair&gt; list = new ArrayList&lt;BasicNameValuePair&gt;(); //new UrlEncodedFormEntity(list, &quot;UTF-8&quot;); if (null != data) { // StringEntityå¤„ç†ä»»æ„æ ¼å¼å­—ç¬¦ä¸²è¯·æ±‚å‚æ•° StringEntity stringEntity = new StringEntity(data, &quot;UTF-8&quot;); stringEntity.setContentEncoding(&quot;UTF-8&quot;); if (null != contentType) { stringEntity.setContentType(contentType); } else { stringEntity.setContentType(&quot;application/json&quot;); } httpPost.setEntity(stringEntity); } // è®¾ç½®è¯·æ±‚å’Œä¼ è¾“è¶…æ—¶æ—¶é—´ RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(2000).setConnectTimeout(2000).build(); httpPost.setConfig(requestConfig); HttpResponse response = httpClient.execute(httpPost); if (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) { HttpEntity entity = response.getEntity(); if (entity != null) { String out = EntityUtils.toString(entity, &quot;UTF-8&quot;); return out; } } } catch (UnsupportedEncodingException e) { log.error(e); } catch (ClientProtocolException e) { e.printStackTrace(); log.error(&quot;è¿æ¥è¶…æ—¶ï¼š&quot; + url); } catch (IOException e) { e.printStackTrace(); log.error(&quot;IOå¼‚å¸¸:&quot; + url); } finally { try { if (null != httpClient) { httpClient.close(); } } catch (IOException e) { log.error(&quot;httpClient.close()å¼‚å¸¸&quot;); } } return null; } /** * Httpsè¯·æ±‚å¯¹è±¡ï¼Œä¿¡ä»»æ‰€æœ‰è¯ä¹¦ * * @return CloseableHttpClient */ public static CloseableHttpClient createSSLInsecureClient() { try { SSLContext sslContext = new SSLContextBuilder().loadTrustMaterial(null, new TrustStrategy() { // ä¿¡ä»»æ‰€æœ‰ public boolean isTrusted(X509Certificate[] chain, String authType) throws CertificateException { return true; } }).build(); SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory(sslContext); return HttpClients.custom().setSSLSocketFactory(sslsf).build(); } catch (KeyManagementException e) { e.printStackTrace(); } catch (NoSuchAlgorithmException e) { e.printStackTrace(); } catch (KeyStoreException e) { e.printStackTrace(); } return HttpClients.createDefault(); } public static void main(String[] args) { String restu = get(true, &quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=wx169c72abdb70cdab&amp;secret=55a4b77eda664e183881e5ed9cce189a&quot;); System.out.println(restu); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,HttpClient","slug":"Java-HttpClient","permalink":"/tags/Java-HttpClient/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨Gsonå¤„ç†Jsonæ•°æ®","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Gsonå¤„ç†Jsonæ•°æ®","date":"2020-06-06T09:15:10.000Z","updated":"2023-04-30T10:21:41.347Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Gsonå¤„ç†Jsonæ•°æ®/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Gsonå¤„ç†Jsonæ•°æ®/","excerpt":"","text":"Gsonç®€ä»‹Gsonï¼ˆåˆç§°Google Jsonï¼‰æ˜¯Googleå…¬å¸å‘å¸ƒçš„ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„Javaåº“ï¼Œç”¨äºåºåˆ—åŒ–Javaå¯¹è±¡ä¸ºJSONå­—ç¬¦ä¸²ï¼Œæˆ–ååºåˆ—åŒ–JSONå­—ç¬¦ä¸²æˆJavaå¯¹è±¡ã€‚ ç›®å‰ï¼Œåœ¨Javaä¸­å¤„ç†JSONæ•°æ®çš„ç±»åº“ä¸­æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ¯”è¾ƒæµè¡Œï¼šFastJSONã€Gsonå’ŒJacksonã€‚ä¸FastJSONå’ŒJacksonç›¸æ¯”ï¼ŒGsonè™½ç„¶åœ¨æ€§èƒ½æ–¹é¢ç•¥æ˜¾ä¸è¶³ï¼Œä½†åœ¨åŠŸèƒ½ä¸Šï¼Œå®ƒæ— ç–‘æ˜¯ä¸‰è€…ä¹‹ä¸­åŠŸèƒ½æœ€å¼ºå¤§çš„ï¼ˆä½¿ç”¨Gsonæˆ‘ä»¬å¯ä»¥æ›´åŠ çµæ´»åœ°é…ç½®å¯¹è±¡çš„å“ªäº›å­—æ®µéœ€è¦åºåˆ—åŒ–ï¼‰ã€‚ Gsonçš„ç”¨æ³•Gson.jarçš„MVNä¸‹è½½åœ°å€ï¼šhttp://mvnrepository.com/artifact/com.google.code.gson/gson åœ¨Gsonç±»åº“ä¸­æœ‰ä¸€ä¸ªGsonç±»ï¼Œè¿™ä¸ªGsonç±»æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼štoJson() å’Œ fromJson()ï¼Œæˆ‘ä»¬ä¸»è¦å°±æ˜¯è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åˆ†åˆ«å®ç°Javaå¯¹è±¡çš„åºåˆ—åŒ–å’ŒJSONå­—ç¬¦ä¸²çš„ååºåˆ—åŒ–ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹æ¥å¯¹Gsonç±»çš„å¸¸ç”¨æ–¹æ³•åšä¸€ä¸ªç®€å•ä»‹ç»ã€‚ é¦–å…ˆï¼Œåˆ›å»ºä¸¤ä¸ªJavaBeanç±»ï¼šStudentå’ŒTeacherï¼Œæ¥å……å½“éœ€è¦è¢«è½¬æ¢çš„Javaå¯¹è±¡ã€‚ import java.io.Serializable; import java.util.Date; import com.google.gson.annotations.Expose; import com.google.gson.annotations.SerializedName; import com.google.gson.annotations.Since; import com.google.gson.annotations.Until; public class Student implements Serializable { private static final long serialVersionUID = 6L; @SerializedName(&quot;number&quot;) @Expose(serialize = true, deserialize = true) private int id; @Expose(serialize = true, deserialize = true) private String name; @Expose(serialize = true, deserialize = true) private int age; @Expose(serialize = true, deserialize = true) private Gender gender; @Until(1.1) private Date enrollmentDate; @Since(1.8) private Date graduationDate; public Student(int id, String name, int age) { super(); this.id = id; this.name = name; this.age = age; } public int getId() { return id; } public void setId(int id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } public Gender getGender() { return gender; } public Date getEnrollmentDate() { return enrollmentDate; } public void setEnrollmentDate(Date enrollmentDate) { this.enrollmentDate = enrollmentDate; } public Date getGraduationDate() { return graduationDate; } public void setGraduationDate(Date graduationDate) { this.graduationDate = graduationDate; } public void setGender(Gender gender) { this.gender = gender; } public String toString() { return &quot;{number:&quot; + this.id + &quot;,name:&quot; + this.name + &quot;,age:&quot; + this.age + (null == this.gender ? &quot;&quot; : &quot;,gender:&quot;+this.gender+&quot;,&quot;) + &quot;}&quot;; } } import java.util.List; import com.google.gson.annotations.SerializedName; public class Teacher { @SerializedName(&quot;teacherId&quot;) private int id; private String name; private List&lt;Student&gt; students; public Teacher(int id, String name, List&lt;Student&gt; students) { super(); this.id = id; this.name = name; this.students = students; } public int getId() { return id; } public void setId(int id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } public List&lt;Student&gt; getStudents() { return students; } public void setStudents(List&lt;Student&gt; students) { this.students = students; } public String toString() { return &quot;{teacherId:&quot; + this.id + &quot;,name:&quot; + this.name + &quot;,students:&quot; + this.students + &quot;}&quot;; } } å…¶ä¸­ï¼ŒGenderï¼ˆæ€§åˆ¥ï¼‰æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œå®šä¹‰å¦‚ä¸‹ã€‚ public enum Gender { MALE/* ç”· */, FEMALE/* å¥³ */ } åœ¨ä½¿ç”¨Gsonå‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªGsonå¯¹è±¡ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼š private static final Gson gson1 = new Gson(); //æ–¹å¼ä¸€ private static final Gson gson2 = new GsonBuilder().create(); //æ–¹å¼äºŒ ä½¿ç”¨æ–¹å¼ä¸€ï¼šåˆ›å»ºçš„Gsonå¯¹è±¡ä¸€èˆ¬å¤šç”¨åœ¨é‚£äº›ä¸éœ€è¦å¯¹åºåˆ—åŒ–çš„å­—æ®µè¿›è¡Œè¯¦ç»†é…ç½®çš„æƒ…å†µï¼› ä½¿ç”¨æ–¹å¼äºŒï¼šåˆ›å»ºçš„Gsonå¯¹è±¡èƒ½å¤Ÿæ ¹æ®å­—æ®µçš„ç±»å‹ã€å­—æ®µåç§°ã€ç‰ˆæœ¬ã€æ³¨è§£ç­‰ä¿¡æ¯å»å†³å®šå“ªäº›å­—æ®µéœ€è¦è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ŒåŒæ—¶è¿˜èƒ½å®ç°è®¸å¤šå…¶ä»–çš„ä¸ªæ€§åŒ–é…ç½®åŠŸèƒ½ï¼Œé…ç½®æ–¹æ³•è¯¦è§GsonTestã€‚ ä»¥ä¸‹æ˜¯GsonTestæµ‹è¯•ç±»çš„å®Œæ•´ä»£ç ã€‚ import java.util.ArrayList; import java.util.Date; import java.util.HashMap; import java.util.LinkedHashMap; import java.util.List; import java.util.Map; import java.util.Map.Entry; import org.junit.Test; import com.google.gson.FieldNamingPolicy; import com.google.gson.Gson; import com.google.gson.GsonBuilder; import com.google.gson.reflect.TypeToken; public class GsonTest { private static final Gson gson1 = new Gson(); private static final Gson gson2 = new GsonBuilder() // ç¾åŒ–è¾“å‡ºç»“æœ .setPrettyPrinting() // è®¾ç½®æ—¥æœŸæ ¼å¼ .setDateFormat(&quot;yyyyå¹´MMæœˆddæ—¥-HHæ—¶mmåˆ†ssç§’&quot;) // ä¸ºStudentç±»æ³¨å†ŒStudentTypeAdapter,å®šåˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–è§„åˆ™ .registerTypeAdapter(Student.class, new StudentTypeAdapter()) // è®¾ç½®å­—æ®µçš„å‘½åè§„åˆ™ï¼Œå¯¹ä½¿ç”¨@SerializedNameæ³¨è§£çš„å­—æ®µæ— æ•ˆ .setFieldNamingPolicy(FieldNamingPolicy.UPPER_CAMEL_CASE) // è®¾ç½®æ’é™¤ç­–ç•¥ .setExclusionStrategies(new MyExclusionStrategy(Gender.class)) // ä»…åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¸¦æœ‰@Exposeæ³¨è§£çš„å­—æ®µ // æ³¨è§£æ ¼å¼ï¼š@Expose (serialize = false, deserialize = false) // .excludeFieldsWithoutExposeAnnotation() // åºåˆ—åŒ–ç©ºå€¼ï¼Œé»˜è®¤ç©ºå€¼ä¸ä¼šåºåˆ—åŒ– // .serializeNulls() // å¼€å¯ç‰ˆæœ¬æ§åˆ¶ï¼Œä¸@Untilã€@Sinceæ³¨è§£é…åˆä½¿ç”¨ .setVersion(1.7) // å¯ç”¨å¯¹Mapä¸­å¤æ‚å¯¹è±¡çš„åºåˆ—åŒ–æ”¯æŒ .enableComplexMapKeySerialization().create(); private static final Gson gson3 = new GsonBuilder() // ç¾åŒ–è¾“å‡ºç»“æœ .setPrettyPrinting() // è®¾ç½®æ—¥æœŸæ ¼å¼ .setDateFormat(&quot;yyyyå¹´MMæœˆddæ—¥-HHæ—¶mmåˆ†ssç§’&quot;).registerTypeAdapter(Gender.class, new GenderSerializer()) // ä»…åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¸¦æœ‰@Exposeæ³¨è§£çš„å­—æ®µ // æ³¨è§£æ ¼å¼ï¼š@Expose (serialize = false, deserialize = false) .excludeFieldsWithoutExposeAnnotation().create(); @Test public void testGson1() { Student user1 = new Student(9527, &quot;ç“¦åŠ›&quot;, 16); Student user2 = new Student(89757, &quot;é›ªè‰&quot;, 14); // å°†å¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String userStr = gson1.toJson(user1); System.out.println(userStr); List&lt;Student&gt; userList = new ArrayList&lt;Student&gt;(); userList.add(user1); userList.add(user2); // å°†å¯¹è±¡é›†åˆè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String listStr = gson1.toJson(userList); System.out.println(listStr); Teacher teacher = new Teacher(200802, &quot;æ½®æ­Œ&quot;, userList); // å°†å¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String jsonStr = gson1.toJson(teacher); System.out.println(jsonStr); // å°†jsonå­—ç¬¦ä¸²è¿˜åŸä¸ºå¯¹è±¡ Student user = gson1.fromJson(userStr, Student.class); System.out.println(user); // å°†jsonå­—ç¬¦ä¸²è¿˜åŸä¸ºå¯¹è±¡é›†åˆ List&lt;Student&gt; users = gson1.fromJson(listStr, new TypeToken&lt;List&lt;Student&gt;&gt;() { }.getType()); System.out.println(users); } @Test public void testGson2() { Student user1 = new Student(9527, &quot;ç“¦åŠ›&quot;, 16); Student user2 = new Student(89757, &quot;é›ªè‰&quot;, 14); user1.setEnrollmentDate(new Date()); user1.setGraduationDate(new Date()); // å°†å¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String userStr = gson2.toJson(user1); System.out.println(userStr); List&lt;Student&gt; userList = new ArrayList&lt;Student&gt;(); userList.add(user1); userList.add(user2); // å°†å¯¹è±¡é›†åˆè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String listStr = gson2.toJson(userList); System.out.println(listStr); // ä¸ºä¿è¯å¯¹è±¡åºåˆ—åŒ–æ—¶çš„é¡ºåºï¼Œæ­¤å¤„ä½¿ç”¨LinkedHashMap Map&lt;String, Student&gt; map = new LinkedHashMap&lt;String, Student&gt;(); map.put(user1.getName(), user1); map.put(user2.getName(), user2); // å°†å¯¹è±¡Mapè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String mapStr = gson2.toJson(map); System.out.println(mapStr); Map&lt;String, Student&gt; retMap = gson2.fromJson(mapStr, new TypeToken&lt;Map&lt;String, Student&gt;&gt;() { }.getType()); for (Entry&lt;String, Student&gt; entry : retMap.entrySet()) { System.out.println(entry.getKey() + &quot;:&quot; + entry.getValue()); } } @Test public void testGson3() { Student user1 = new Student(9527, &quot;ç“¦åŠ›&quot;, 16); Student user2 = new Student(89757, &quot;é›ªè‰&quot;, 14); user1.setGender(Gender.MALE); user2.setGender(Gender.FEMALE); // å°†å¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String userStr = gson3.toJson(user1); System.out.println(userStr); List&lt;Student&gt; userList = new ArrayList&lt;Student&gt;(); userList.add(user1); userList.add(user2); // å°†å¯¹è±¡é›†åˆè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String listStr = gson3.toJson(userList); System.out.println(listStr); Map&lt;String, Student&gt; map = new HashMap&lt;String, Student&gt;(); map.put(user1.getName(), user1); map.put(user2.getName(), user2); // å°†å¯¹è±¡Mapè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸² String mapStr = gson3.toJson(map); System.out.println(mapStr); Map&lt;String, Student&gt; retMap = gson3.fromJson(mapStr, new TypeToken&lt;Map&lt;String, Student&gt;&gt;() { }.getType()); for (Entry&lt;String, Student&gt; entry : retMap.entrySet()) { System.out.println(entry.getKey() + &quot;:&quot; + entry.getValue()); } } } å…¶ä¸­StudentTypeAdapterç”¨æ¥è‡ªå®šä¹‰Studentå¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ã€‚ import java.io.IOException; import java.util.regex.Matcher; import java.util.regex.Pattern; import com.google.gson.TypeAdapter; import com.google.gson.stream.JsonReader; import com.google.gson.stream.JsonToken; import com.google.gson.stream.JsonWriter; public class StudentTypeAdapter extends TypeAdapter&lt;Student&gt; { private static Pattern pattern = Pattern.compile(&quot;:{1}([^\\\\{]*?)(,{1}|\\\\}{1})&quot;); @Override public Student read(JsonReader reader) throws IOException { if (reader.peek() == JsonToken.NULL) { reader.nextNull(); return null; } String jsonStr = reader.nextString(); Matcher m = pattern.matcher(jsonStr); String[] arr = new String[3]; int i = 0; while (m.find()) { arr[i++] = m.group(1); } Student student = new Student(Integer.parseInt(arr[0]), arr[1], Integer.parseInt(arr[2])); return student; } @Override public void write(JsonWriter writer, Student student) throws IOException { if (null == student) { writer.nullValue(); return; } String jsonStr = &quot;{student:{number:&quot; + student.getId() + &quot;,name:&quot; + student.getName() + &quot;,age:&quot; + student.getAge() + &quot;}}&quot;; writer.value(jsonStr); } } MyExclusionStrategyé€šè¿‡shouldSkipClass()å’ŒshouldSkipField()ä¸¤ä¸ªæ–¹æ³•æ¥æŒ‡å®šæŸä¸ªç±»æˆ–è€…å­—æ®µæ˜¯å¦éœ€è¦è¢«åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–ã€‚ import com.google.gson.ExclusionStrategy; import com.google.gson.FieldAttributes; public class MyExclusionStrategy implements ExclusionStrategy { private Class&lt;?&gt; excludedClass; public MyExclusionStrategy(Class&lt;?&gt; clazz) { this.excludedClass = clazz; } @Override public boolean shouldSkipClass(Class&lt;?&gt; clazz) { return excludedClass.equals(clazz); } @Override public boolean shouldSkipField(FieldAttributes f) { return f.getName().equalsIgnoreCase(&quot;age&quot;); } } GenderSerializeré€šè¿‡GenderSerializer()å’Œdeserialize()ä¸¤ä¸ªæ–¹æ³•æ¥å¯¹Genderæšä¸¾ç±»å‹çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹è¿›è¡Œè®¾ç½®ã€‚ import java.lang.reflect.Type; import com.google.gson.JsonDeserializationContext; import com.google.gson.JsonDeserializer; import com.google.gson.JsonElement; import com.google.gson.JsonParseException; import com.google.gson.JsonPrimitive; import com.google.gson.JsonSerializationContext; import com.google.gson.JsonSerializer; public class GenderSerializer implements JsonSerializer&lt;Gender&gt;, JsonDeserializer&lt;Gender&gt; { @Override public JsonElement serialize(Gender gender, Type genderType, JsonSerializationContext context) { if (null == gender) { return new JsonPrimitive(&quot;&quot;); } return new JsonPrimitive(gender.equals(Gender.MALE) ? &quot;ç”·&quot; : &quot;å¥³&quot;); } @Override public Gender deserialize(JsonElement gender, Type genderType, JsonDeserializationContext context) throws JsonParseException { if (&quot;ç”·&quot;.equals(gender.getAsString())) { return Gender.MALE; } else if (&quot;å¥³&quot;.equals(gender.getAsString())) { return Gender.FEMALE; } else { return null; } } } testGson1()çš„æ‰§è¡Œç»“æœï¼š {&quot;number&quot;:9527,&quot;name&quot;:&quot;ç“¦åŠ›&quot;,&quot;age&quot;:16} [{&quot;number&quot;:9527,&quot;name&quot;:&quot;ç“¦åŠ›&quot;,&quot;age&quot;:16},{&quot;number&quot;:89757,&quot;name&quot;:&quot;é›ªè‰&quot;,&quot;age&quot;:14}] {&quot;teacherId&quot;:200802,&quot;name&quot;:&quot;æ½®æ­Œ&quot;,&quot;students&quot;:[{&quot;number&quot;:9527,&quot;name&quot;:&quot;ç“¦åŠ›&quot;,&quot;age&quot;:16},{&quot;number&quot;:89757,&quot;name&quot;:&quot;é›ªè‰&quot;,&quot;age&quot;:14}]} {number:9527,name:ç“¦åŠ›,age:16} [{number:9527,name:ç“¦åŠ›,age:16}, {number:89757,name:é›ªè‰,age:14}] testGson2()çš„æ‰§è¡Œç»“æœï¼š &quot;{student:{number:9527,name:ç“¦åŠ›,age:16}}&quot; [ &quot;{student:{number:9527,name:ç“¦åŠ›,age:16}}&quot;, &quot;{student:{number:89757,name:é›ªè‰,age:14}}&quot; ] { &quot;ç“¦åŠ›&quot;: &quot;{student:{number:9527,name:ç“¦åŠ›,age:16}}&quot;, &quot;é›ªè‰&quot;: &quot;{student:{number:89757,name:é›ªè‰,age:14}}&quot; } ç“¦åŠ›:{number:9527,name:ç“¦åŠ›,age:16} é›ªè‰:{number:89757,name:é›ªè‰,age:14} testGson3()çš„æ‰§è¡Œç»“æœï¼š { &quot;number&quot;: 9527, &quot;name&quot;: &quot;ç“¦åŠ›&quot;, &quot;age&quot;: 16, &quot;gender&quot;: &quot;ç”·&quot; } [ { &quot;number&quot;: 9527, &quot;name&quot;: &quot;ç“¦åŠ›&quot;, &quot;age&quot;: 16, &quot;gender&quot;: &quot;ç”·&quot; }, { &quot;number&quot;: 89757, &quot;name&quot;: &quot;é›ªè‰&quot;, &quot;age&quot;: 14, &quot;gender&quot;: &quot;å¥³&quot; } ] { &quot;é›ªè‰&quot;: { &quot;number&quot;: 89757, &quot;name&quot;: &quot;é›ªè‰&quot;, &quot;age&quot;: 14, &quot;gender&quot;: &quot;å¥³&quot; }, &quot;ç“¦åŠ›&quot;: { &quot;number&quot;: 9527, &quot;name&quot;: &quot;ç“¦åŠ›&quot;, &quot;age&quot;: 16, &quot;gender&quot;: &quot;ç”·&quot; } } é›ªè‰:{number:89757,name:é›ªè‰,age:14,gender:FEMALE,} ç“¦åŠ›:{number:9527,name:ç“¦åŠ›,age:16,gender:MALE,}","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Gson,Json","slug":"Java-Gson-Json","permalink":"/tags/Java-Gson-Json/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"ä½¿ç”¨Dom4jè§£æXML","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Dom4jè§£æXML","date":"2020-06-06T09:14:10.000Z","updated":"2023-04-30T10:21:41.347Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Dom4jè§£æXML/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--ä½¿ç”¨Dom4jè§£æXML/","excerpt":"","text":"ä¸€ã€Dom4jç®€ä»‹dom4jæ˜¯ä¸€ä¸ªJavaçš„XML APIï¼Œæ˜¯jdomçš„å‡çº§å“ï¼Œç”¨æ¥è¯»å†™XMLæ–‡ä»¶çš„ã€‚dom4jæ˜¯ä¸€ä¸ªååˆ†ä¼˜ç§€çš„JavaXML APIï¼Œå…·æœ‰æ€§èƒ½ä¼˜å¼‚ã€åŠŸèƒ½å¼ºå¤§å’Œæå…¶æ˜“ä½¿ç”¨çš„ç‰¹ç‚¹ï¼Œå®ƒçš„æ€§èƒ½è¶…è¿‡sunå…¬å¸å®˜æ–¹çš„domæŠ€æœ¯ï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è½¯ä»¶ï¼Œå¯ä»¥åœ¨SourceForgeä¸Šæ‰¾åˆ°å®ƒã€‚åœ¨IBM developerWorksä¸Šé¢è¿˜å¯ä»¥æ‰¾åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œå¯¹ä¸»æµçš„Java XML APIè¿›è¡Œçš„æ€§èƒ½ã€åŠŸèƒ½å’Œæ˜“ç”¨æ€§çš„è¯„æµ‹ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“dom4jæ— è®ºåœ¨å“ªä¸ªæ–¹é¢éƒ½æ˜¯éå¸¸å‡ºè‰²çš„ã€‚å¦‚ä»Šå¯ä»¥çœ‹åˆ°è¶Šæ¥è¶Šå¤šçš„Javaè½¯ä»¶éƒ½åœ¨ä½¿ç”¨dom4jæ¥è¯»å†™XMLï¼Œç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯è¿Sunçš„JAXMä¹Ÿåœ¨ç”¨dom4jã€‚è¿™å·²ç»æ˜¯å¿…é¡»ä½¿ç”¨çš„jaråŒ…ï¼Œ Hibernateä¹Ÿç”¨å®ƒæ¥è¯»å†™é…ç½®æ–‡ä»¶ã€‚ äºŒã€æ–‡ä»¶ä¸‹è½½å®˜ç½‘åœ°å€ï¼šhttp://www.dom4j.org/dom4j-1.6.1/ ä¸‰ã€åœ¨Javaä¸­ä½¿ç”¨Dom4jè§£æXMLåˆ›å»ºDocumentå¯¹è±¡åœ¨DOM4jä¸­ï¼ŒDocumentå¯¹è±¡å°±ä»£è¡¨äº†æ•´ä¸ªXMLæ–‡æ¡£ï¼Œå…¶å†…éƒ¨å°†XMLçš„æ•°æ®ä¿¡æ¯ä»¥Dom4jæ ‘çš„å½¢å¼è¿›è¡Œå‚¨å­˜ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥è·å¾—Documentå¯¹è±¡ï¼š // è¯»å–XMLæ–‡ä»¶,è·å¾—documentå¯¹è±¡ SAXReader saxReader = new SAXReader(); Document document1 = saxReader.read(new File(&quot;D:\\\\dom4j\\\\dom.xml&quot;)); // è§£æXMLå½¢å¼çš„å­—ç¬¦ä¸²,å¾—åˆ°documentå¯¹è±¡. String xmlText = &quot;&lt;response&gt;&lt;result&gt;1&lt;/result&gt;&lt;desc&gt;ä¿å­˜æˆåŠŸ&lt;/desc&gt;&lt;/response&gt;&quot;; Document document2 = DocumentHelper.parseText(xmlText); //ä¸»åŠ¨åˆ›å»ºdocumentå¯¹è±¡ Document document3 =DocumentHelper.createDocument(DocumentHelper.createElement(&quot;root&quot;).addAttribute(&quot;id&quot;, &quot;1&quot;)); System.out.println(document3.getRootElement().attributeValue(&quot;id&quot;)); //æ‰“å°ç»“æœï¼š1 æ“ä½œèŠ‚ç‚¹å¯¹è±¡åœ¨DOM4jä¸­ï¼Œä½¿ç”¨Elementå¯¹è±¡æ¥è¡¨ç¤ºDom4jæ ‘ä¸­çš„å„ä¸ªèŠ‚ç‚¹ï¼ŒElementå¯¹è±¡å¯ä»¥åŒ…å«æœ‰å±æ€§ã€æ–‡æœ¬å†…å®¹ã€å‘½åç©ºé—´ã€å­èŠ‚ç‚¹ç­‰å†…å®¹ã€‚ æˆ‘ä»¬é€šè¿‡ä»¥å¯¹ä¸€ä¸ªåä¸ºâ€œdom.xmlâ€çš„XMLæ–‡ä»¶çš„æ“ä½œä¸ºä¾‹ï¼Œæ¥å¯¹DOM4jèŠ‚ç‚¹æ“ä½œçš„å¸¸ç”¨æ–¹æ³•è¿›è¡Œç®€è¦ç¤ºèŒƒï¼Œè¯¥â€œdom.xmlâ€çš„å†…å®¹å¦‚ä¸‹ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;response&gt; &lt;result&gt;1&lt;/result&gt; &lt;errorDesc&gt;æ— é”™è¯¯ä¿¡æ¯&lt;/errorDesc&gt; &lt;errorCode&gt;E000&lt;/errorCode&gt; &lt;assignIds&gt; &lt;assignId&gt;TEST106608821&lt;/assignId&gt; &lt;assignId&gt;TEST106608822&lt;/assignId&gt; &lt;assignId&gt;TEST106608823&lt;/assignId&gt; &lt;/assignIds&gt; &lt;/response&gt; é€šè¿‡Javaä»£ç æ¥æ“ä½œDOM4jçš„èŠ‚ç‚¹å¯¹è±¡ï¼Œå…¶å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚ import java.io.FileOutputStream; import java.io.IOException; import java.io.OutputStreamWriter; import java.util.Iterator; import java.util.List; import org.dom4j.Document; import org.dom4j.DocumentException; import org.dom4j.Element; import org.dom4j.io.SAXReader; import org.dom4j.io.XMLWriter; public class HelloDom4j { @SuppressWarnings(&quot;unchecked&quot;) public static void main(String[] args) throws DocumentException, IOException { SAXReader saxReader = new SAXReader(); Document document = saxReader.read(&quot;D:\\\\dom4j\\\\dom.xml&quot;); // è·å–Documentå¯¹è±¡çš„æ ¹èŠ‚ç‚¹ Element root = document.getRootElement(); System.out.println(root.getName()); // å–å¾—æ ¹èŠ‚ç‚¹ä¸‹çš„&quot;assignIds&quot;å­èŠ‚ç‚¹ Element assignIds = root.element(&quot;assignIds&quot;); System.out.println(assignIds.getName()); // å–å¾—&quot;assignIds&quot;èŠ‚ç‚¹ä¸‹æ‰€æœ‰åä¸º&quot;assignId&quot;çš„å­èŠ‚ç‚¹ï¼Œå¹¶è¿›è¡Œéå† List&lt;Element&gt; elements = assignIds.elements(&quot;assignId&quot;); Iterator&lt;Element&gt; it = elements.iterator(); while (it.hasNext()) { Element element = it.next(); // æ‰“å°èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ System.out.println(element.getText()); } // åœ¨&quot;assignIds&quot;èŠ‚ç‚¹ä¸‹å†æ·»åŠ ä¸€ä¸ª&quot;assignId&quot;å­èŠ‚ç‚¹ Element element = assignIds.addElement(&quot;assignId&quot;); // è®¾ç½®æ–°èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ element.setText(&quot;TEST106608824&quot;); // åˆ é™¤&quot;assignIds&quot;èŠ‚ç‚¹ä¸‹ç¬¬ä¸€ä¸ªåä¸º&quot;assignId&quot;çš„å­èŠ‚ç‚¹ Element firstAssingId = assignIds.element(&quot;assignId&quot;); assignIds.remove(firstAssingId); // æ·»åŠ ä¸€ä¸ªCDATAèŠ‚ç‚¹ Element cddataElement = root.addElement(&quot;content&quot;); cddataElement.addCDATA(&quot;æˆ‘æ˜¯CDATAçš„å†…å®¹!&quot;); // å°†Documentå¯¹è±¡å†…å®¹ä¿å­˜åˆ°XMLæ–‡ä»¶ XMLWriter xmlWriter = new XMLWriter(new OutputStreamWriter(new FileOutputStream(&quot;D:\\\\dom4j\\\\dom4j_dom.xml&quot;), &quot;UTF-8&quot;)); xmlWriter.write(document); xmlWriter.close(); } } ç¨‹åºæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œåœ¨è®¡ç®—æœºâ€œD:\\dom4jâ€ç›®å½•ä¸‹ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸ºâ€œdom4j_dom.xmlâ€çš„XMLæ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;response&gt; &lt;result&gt;1&lt;/result&gt; &lt;errorDesc&gt;æ— é”™è¯¯ä¿¡æ¯&lt;/errorDesc&gt; &lt;errorCode&gt;E000&lt;/errorCode&gt; &lt;assignIds&gt; &lt;assignId&gt;TEST106608822&lt;/assignId&gt; &lt;assignId&gt;TEST106608823&lt;/assignId&gt; &lt;assignId&gt;TEST106608824&lt;/assignId&gt; &lt;/assignIds&gt; &lt;content&gt;&lt;![CDATA[æˆ‘æ˜¯CDATAçš„å†…å®¹!]]&gt;&lt;/content&gt; &lt;/response&gt; æ“ä½œèŠ‚ç‚¹å¯¹è±¡çš„å±æ€§æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡å¯¹ä¸€ä¸ªXMLæ–‡ä»¶çš„å®é™…æ“ä½œä¸ºä¾‹ï¼Œæ¥å¯¹DOM4jèŠ‚ç‚¹å¯¹è±¡çš„å±æ€§æ“ä½œçš„å¸¸ç”¨æ–¹æ³•è¿›è¡Œç®€è¦ç¤ºèŒƒã€‚åœ¨è®¡ç®—æœºâ€œD:\\dom4jâ€ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸ºâ€œattribute.xmlâ€çš„XMLæ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;Request service=&#39;OrderSearchService&#39; lang=&#39;zh-CN&#39;&gt; &lt;Head name=&#39;head&#39;&gt;Hello Dom4j&lt;/Head&gt; &lt;Body name=&#39;body&#39; class=&quot;content&quot;&gt; &lt;OrderSearch name=&#39;orderSearch&#39; orderid=&#39;2019586321&#39;/&gt; &lt;/Body&gt; &lt;/Request&gt; é€šè¿‡Javaä»£ç æ¥æ“ä½œDOM4jèŠ‚ç‚¹å¯¹è±¡çš„å±æ€§ï¼Œå…¶å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚ import java.io.FileWriter; import java.io.IOException; import java.util.Iterator; import org.dom4j.Attribute; import org.dom4j.Document; import org.dom4j.DocumentException; import org.dom4j.Element; import org.dom4j.io.SAXReader; import org.dom4j.io.XMLWriter; public class HelloDom4j { @SuppressWarnings(&quot;unchecked&quot;) public static void main(String[] args) throws DocumentException, IOException { SAXReader saxReader = new SAXReader(); Document document = saxReader.read(&quot;D:\\\\dom4j\\\\attribute.xml&quot;); // è·å–æ ¹èŠ‚ç‚¹ Element root = document.getRootElement(); System.out.println(root.getName()); // æ‰“å°ç»“æœï¼šRequest // è·å–æ ¹èŠ‚ç‚¹çš„&quot;service&quot;å±æ€§ Attribute attribute = root.attribute(&quot;service&quot;); // è·å–å¹¶æ‰“å°å±æ€§çš„å€¼ System.out.println(attribute.getText()); // æ‰“å°ç»“æœï¼šOrderSearchService System.out.println(attribute.getData()); // æ‰“å°ç»“æœï¼šOrderSearchService System.out.println(attribute.getValue()); // æ‰“å°ç»“æœï¼šOrderSearchService // åˆ é™¤æ ¹èŠ‚ç‚¹çš„&quot;lang&quot;å±æ€§ Attribute lang = root.attribute(&quot;lang&quot;); System.out.println(lang.getData()); // æ‰“å°ç»“æœï¼šzh-CN root.remove(attribute); // ä¸ºæ ¹èŠ‚ç‚¹æ·»åŠ &quot;id&quot;å±æ€§ï¼Œå¹¶è®¾ç½®å€¼ä¸º&quot;request&quot; root.addAttribute(&quot;id&quot;, &quot;request&quot;); // è·å–&quot;Head&quot;èŠ‚ç‚¹ Element head = root.element(&quot;Head&quot;); // ä¿®æ”¹&quot;Head&quot;èŠ‚ç‚¹çš„&quot;name&quot;å±æ€§å€¼ä¸º&quot;dom4j&quot; Attribute nameAttr = head.attribute(&quot;name&quot;); System.out.println(nameAttr.getData());// æ‰“å°ç»“æœï¼šhead nameAttr.setValue(&quot;dom4j&quot;); System.out.println(nameAttr.getData());// æ‰“å°ç»“æœï¼šdom4j // è·å–&quot;OrderSearch&quot;èŠ‚ç‚¹ Element orderSearch = root.element(&quot;Body&quot;).element(&quot;OrderSearch&quot;); // éå†&quot;OrderSearch&quot;èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§ Iterator&lt;Attribute&gt; it = orderSearch.attributeIterator(); while (it.hasNext()) { Attribute attr = it.next(); System.out.println(attr.getText()); // æ‰“å°ç»“æœï¼šorderSearch 2019586321 } // å°†Documentå¯¹è±¡å†…å®¹ä¿å­˜åˆ°XMLæ–‡ä»¶ XMLWriter xmlWriter = new XMLWriter(new FileWriter(&quot;D:\\\\dom4j\\\\dom4j_attribute.xml&quot;)); xmlWriter.write(document); xmlWriter.close(); } } ç¨‹åºæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œåœ¨è®¡ç®—æœºâ€œD:\\dom4jâ€ç›®å½•ä¸‹ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸ºâ€œdom4j_attribute.xmlâ€çš„XMLæ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;Request lang=&quot;zh-CN&quot; id=&quot;request&quot;&gt; &lt;Head name=&quot;dom4j&quot;&gt;Hello Dom4j&lt;/Head&gt; &lt;Body name=&quot;body&quot; class=&quot;content&quot;&gt; &lt;OrderSearch name=&quot;orderSearch&quot; orderid=&quot;2019586321&quot;/&gt; &lt;/Body&gt; &lt;/Request&gt; ä¿å­˜Documentå¯¹è±¡åˆ°XMLæ–‡ä»¶// æ— éœ€è®¾ç½®å­—ç¬¦é›†ç¼–ç  XMLWriter xmlWriter = new XMLWriter(new FileWriter(&quot;D:\\\\dom4j\\\\dom4j_attribute.xml&quot;)); xmlWriter.write(document); xmlWriter.close(); // éœ€è¦è®¾ç½®å­—ç¬¦é›†ç¼–ç  OutputFormat format=OutputFormat.createPrettyPrint(); //createPrettyPrint()è‡ªåŠ¨ç¼©è¿›,createCompactFormat()è‡ªåŠ¨å‹ç¼© format.setEncoding(&quot;UTF-8&quot;); XMLWriter xmlWriter = new XMLWriter(new FileWriter(&quot;D:\\\\dom4j\\\\dom4j_attribute.xml&quot;),format); xmlWriter.write(document); xmlWriter.close(); å­—ç¬¦ä¸²ä¸XMLè½¬æ¢æˆ‘ä»¬ç»§ç»­ä»¥å‰ä¾‹ä¸­çš„â€œattribute.xmlâ€æ–‡ä»¶ä¸ºä¾‹ï¼Œå¯¹å…¶è¿›è¡Œè½¬æ¢ç¤ºèŒƒã€‚ import org.dom4j.Document; import org.dom4j.DocumentException; import org.dom4j.DocumentHelper; import org.dom4j.Element; import org.dom4j.io.SAXReader; public class HelloDom4j { public static void main(String[] args) throws DocumentException { // å°†XMLè½¬æ¢ä¸ºå­—ç¬¦ä¸² SAXReader saxReader = new SAXReader(); Document document = saxReader.read(&quot;D:\\\\dom4j\\\\attribute.xml&quot;); String documentStr = document.asXML(); System.out.println(documentStr); /* * æ‰“å°ç»“æœï¼š * &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; * &lt;Request service=&quot;OrderSearchService&quot; lang=&quot;zh-CN&quot;&gt; * &lt;Head name=&quot;head&quot;&gt;Hello Dom4j&lt;/Head&gt; * &lt;Body name=&quot;body&quot; class=&quot;content&quot;&gt; * &lt;OrderSearch name=&quot;orderSearch&quot; orderid=&quot;2019586321&quot;/&gt; * &lt;/Body&gt; * &lt;/Request&gt; */ Element root = document.getRootElement(); String rootStr = root.asXML(); System.out.println(rootStr); /* * æ‰“å°ç»“æœï¼š * &lt;Request service=&quot;OrderSearchService&quot; lang=&quot;zh-CN&quot;&gt; * &lt;Head name=&quot;head&quot;&gt;Hello Dom4j&lt;/Head&gt; * &lt;Body name=&quot;body&quot; class=&quot;content&quot;&gt; * &lt;OrderSearch name=&quot;orderSearch&quot; orderid=&quot;2019586321&quot;/&gt; * &lt;/Body&gt; * &lt;/Request&gt; */ // å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºXML String xmlStr = &quot;&lt;Head name=&#39;head&#39;&gt;Hello Dom4j&lt;/Head&gt;&quot;; Document xmlDoc = DocumentHelper.parseText(xmlStr); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Dom4j,XML","slug":"Java-Dom4j-XML","permalink":"/tags/Java-Dom4j-XML/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ¸…ç©ºæ•´ä¸ªæ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ¸…ç©ºæ•´ä¸ªæ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰","date":"2020-06-06T09:13:10.000Z","updated":"2023-04-30T10:21:41.353Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ¸…ç©ºæ•´ä¸ªæ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ¸…ç©ºæ•´ä¸ªæ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰/","excerpt":"","text":"ç›®æ ‡ï¼šæ¸…ç©ºæ•´ä¸ªæ–‡ä»¶å¤¹ æ¡ä»¶ï¼šfileç±»ã€é€’å½’æ–¹æ³• å¤‡æ³¨ï¼šåœ¨Javaä¸­ï¼Œå¦‚æœæƒ³è¦åˆ é™¤ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿è¯¥æ–‡ä»¶ä¸‹å·²è¢«æ¸…ç©ºä»£ç  package May.Eighth.File; import java.io.File; /** * åˆ é™¤æ–‡ä»¶å’Œç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰ * @author Jia * */ public class DeleteFileAndDirectory { public static void main(String[] args) { //è°ƒç”¨deleteæ–¹æ³• new DeleteFileAndDirectory().delete(&quot;E:/Javatest/test&quot;); System.out.println(&quot;è¯¥æ–‡ä»¶å¤¹å·²æ¸…ç©ºå®Œæ¯•&quot;); } // åˆ›å»ºç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰åˆ é™¤çš„æ–¹æ³• public void delete(String path) { // ä¸ºä¼ è¿›æ¥çš„è·¯å¾„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ File file = new File(path); // å¦‚æœç›®æ ‡è·¯å¾„æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨deleteæ–¹æ³•åˆ é™¤å³å¯ // file.delete(); // å¦‚æœæ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆå¿…é¡»æŠŠè¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•å…¨éƒ¨åˆ é™¤ï¼Œæ‰èƒ½åˆ é™¤è¯¥ç›®æ ‡ç›®å½•ï¼Œè¿™é‡Œè¦ç”¨åˆ°é€’å½’å‡½æ•° // åˆ›å»ºä¸€ä¸ªfilesæ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾ç›®æ ‡ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å’Œç›®å½•çš„fileå¯¹è±¡ File[] files = new File[50]; // å°†ç›®æ ‡ç›®å½•ä¸‹æ‰€æœ‰çš„fileå¯¹è±¡å­˜å…¥filesæ•°ç»„ä¸­ files = file.listFiles(); // å¾ªç¯éå†filesæ•°ç»„ for(File temp : files){. // åˆ¤æ–­è¯¥tempå¯¹è±¡æ˜¯å¦ä¸ºæ–‡ä»¶å¯¹è±¡ if (temp.isFile()) { temp.delete(); } // åˆ¤æ–­è¯¥tempå¯¹è±¡æ˜¯å¦ä¸ºç›®å½•å¯¹è±¡ if (temp.isDirectory()) { // å°†è¯¥tempç›®å½•çš„è·¯å¾„ç»™deleteæ–¹æ³•ï¼ˆè‡ªå·±ï¼‰ï¼Œè¾¾åˆ°é€’å½’çš„ç›®çš„ delete(temp.getAbsolutePath()); // ç¡®ä¿è¯¥tempç›®å½•ä¸‹å·²è¢«æ¸…ç©ºåï¼Œåˆ é™¤è¯¥tempç›®å½• temp.delete(); } } } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,æ¸…ç©º,æ–‡ä»¶å¤¹","slug":"Java-æ¸…ç©º-æ–‡ä»¶å¤¹","permalink":"/tags/Java-æ¸…ç©º-æ–‡ä»¶å¤¹/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--é¡¹ç›®è·¯å¾„çš„è·å–","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--é¡¹ç›®è·¯å¾„çš„è·å–","date":"2020-06-06T09:12:10.000Z","updated":"2023-04-30T10:21:41.354Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--é¡¹ç›®è·¯å¾„çš„è·å–/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--é¡¹ç›®è·¯å¾„çš„è·å–/","excerpt":"","text":"ä¸€ã€ç›¸å¯¹è·¯å¾„çš„è·å¾—è¯´æ˜:ç›¸å¯¹è·¯å¾„(å³ä¸å†™æ˜åˆ°åº•ç›¸å¯¹è°)å‡å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å¾—ï¼ˆä¸è®ºæ˜¯ä¸€èˆ¬çš„javaé¡¹ç›®è¿˜æ˜¯webé¡¹ç›®ï¼‰ String relativelyPath=System.getProperty(&quot;user.dir&quot;); ä¸Šè¿°ç›¸å¯¹è·¯å¾„ä¸­ï¼Œjavaé¡¹ç›®ä¸­çš„æ–‡ä»¶æ˜¯ç›¸å¯¹äºé¡¹ç›®çš„æ ¹ç›®å½•ï¼›webé¡¹ç›®ä¸­çš„æ–‡ä»¶è·¯å¾„è§†ä¸åŒçš„webæœåŠ¡å™¨ä¸åŒè€Œä¸åŒï¼ˆtomcatæ˜¯ç›¸å¯¹äº tomcatå®‰è£…ç›®å½•\\binï¼‰ã€‚ äºŒã€ç±»åŠ è½½ç›®å½•çš„è·å¾—ç±»åŠ è½½ç›®å½•å³å½“è¿è¡ŒæŸä¸€ç±»æ—¶è·å¾—å…¶è£…è½½ç›®å½•ã€‚ 1.1) é€šç”¨çš„æ–¹æ³•ä¸€(ä¸è®ºæ˜¯ä¸€èˆ¬çš„javaé¡¹ç›®è¿˜æ˜¯webé¡¹ç›®,å…ˆå®šä½åˆ°èƒ½çœ‹åˆ°åŒ…è·¯å¾„çš„ç¬¬ä¸€çº§ç›®å½•) InputStream is=TestAction.class.getClassLoader().getResourceAsStream(&quot;test.txt&quot;); (test.txtæ–‡ä»¶çš„è·¯å¾„ä¸ºé¡¹ç›®å\\src\\test.txt;ç±»TestActionæ‰€åœ¨åŒ…çš„ç¬¬ä¸€çº§ç›®å½•ä½äºsrcç›®å½•ä¸‹)ï¼Œä¸Šå¼ä¸­å°†TestActionï¼Œtest.txtæ›¿æ¢æˆå¯¹åº”æˆç›¸åº”çš„ç±»åå’Œæ–‡ä»¶åå­—å³å¯ã€‚ 1.2) é€šç”¨æ–¹æ³•äºŒ(æ­¤æ–¹æ³•å’Œ1.1ä¸­çš„æ–¹æ³•ç±»ä¼¼,ä¸åŒçš„æ˜¯æ­¤æ–¹æ³•å¿…é¡»ä»¥â€™/â€˜å¼€å¤´,å‚è€ƒhttp://riddickbryant.iteye.com/blog/436693) InputStream is=Test1.class.getResourceAsStream(&quot;/test.txt&quot;); (test.txtæ–‡ä»¶çš„è·¯å¾„ä¸ºé¡¹ç›®å\\src\\test.txt,ç±»Test1æ‰€åœ¨åŒ…çš„ç¬¬ä¸€çº§ç›®å½•ä½äºsrcç›®å½•ä¸‹) ä¸‰ã€webé¡¹ç›®æ ¹ç›®å½•çš„è·å¾—(å‘å¸ƒä¹‹å)1 ä»servletå‡ºå‘å¯å»ºç«‹ä¸€ä¸ªservletåœ¨å…¶çš„initæ–¹æ³•ä¸­å†™å…¥å¦‚ä¸‹è¯­å¥ ServletContext s1=this.getServletContext(); String temp=s1.getRealPath(&quot;/&quot;); (å…³é”®) ç»“æœå½¢å¦‚ï¼šD:\\å·¥å…·\\Tomcat-6.0\\webapps\\002_ext\\ (002_extä¸ºé¡¹ç›®åå­—) å¦‚æœæ˜¯è°ƒç”¨äº†s1.getRealPath(&quot;&quot;)åˆ™è¾“å‡ºD:\\å·¥å…·\\Tomcat-6.0\\webapps\\002_ext(å°‘äº†ä¸€ä¸ªâ€\\â€) 2 ä»httpServletRequestå‡ºå‘String cp11111=request.getSession().getServletContext().getRealPath(&quot;/&quot;); ç»“æœå½¢å¦‚:D:\\å·¥å…·\\Tomcat-6.0\\webapps\\002_ext\\ å››ã€classpathçš„è·å–(åœ¨Eclipseä¸­ä¸ºè·å¾—srcæˆ–è€…classesç›®å½•çš„è·¯å¾„)æ–¹æ³•ä¸€Thread.currentThread().getContextClassLoader().getResource(&quot;&quot;).getPath() eg: String t=Thread.currentThread().getContextClassLoader().getResource(&quot;&quot;).getPath(); System.out.println(&quot;t---&quot;+t); è¾“å‡º:t---/E:/order/002_ext/WebRoot/WEB-INF/classes/ æ–¹æ³•äºŒJdomParse.class.getClassLoader().getResource(&quot;&quot;).getPath() // JdomParseä¸ºsrcæŸä¸€ä¸ªåŒ…ä¸­çš„ç±»,ä¸‹åŒ eg: String p1=JdomParse.class.getClassLoader().getResource(&quot;&quot;).getPath(); System.out.println(&quot;JdomParse.class.getClassLoader().getResource--&quot;+p1); è¾“å‡º: JdomParse.class.getClassLoader().getResource--/E:/order/002_ext/WebRoot/WEB-INF/classes/ å¦å¤–,å¦‚æœæƒ³æŠŠæ–‡ä»¶æ”¾åœ¨æŸä¸€åŒ…ä¸­,åˆ™å¯ä»¥ é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å¾—åˆ°æ–‡ä»¶(å…ˆå®šä½åˆ°è¯¥åŒ…çš„æœ€åä¸€çº§ç›®å½•) String p2=JdomParse.class.getResource(&quot;&quot;).getPath(); System.out.println(&quot;JdomParse.class.getResource---&quot;+p2); è¾“å‡º: JdomParse.class.getResource---/E:/order/002_ext/WebRoot/WEB-INF/classes/jdom/ (JdomParseä¸ºsrcç›®å½•ä¸‹jdomåŒ…ä¸­çš„ç±») äº”ã€å±æ€§æ–‡ä»¶çš„è¯»å–æ–¹æ³•ä¸€InputStream in = lnew BufferedInputStream( new FileInputStream(name)); Properties p = new Properties(); p.load(in); æ³¨æ„è·¯å¾„çš„é—®é¢˜,åšæ‰§è¡Œä¹‹åå°±å¯ä»¥è°ƒç”¨p.getProperty(&quot;name&quot;)å¾—åˆ°å¯¹åº”å±æ€§çš„å€¼ æ–¹æ³•äºŒLocale locale = Locale.getDefault(); ResourceBundle localResource = ResourceBundle.getBundle(&quot;test/propertiesTest&quot;, locale); String value = localResource.getString(&quot;test&quot;); System.out.println(&quot;ResourceBundle: &quot; + value); å·¥ç¨‹srcç›®å½•ä¸‹propertiesTest.properties(åå­—åç¼€å¿…é¡»ä¸ºproperties)æ–‡ä»¶å†…å®¹å¦‚ä¸‹:test=hello word","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,è·¯å¾„","slug":"Java-è·¯å¾„","permalink":"/tags/Java-è·¯å¾„/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--åˆ©ç”¨ShutdownHooké‡Šæ”¾ç³»ç»Ÿèµ„æº","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--åˆ©ç”¨ShutdownHooké‡Šæ”¾ç³»ç»Ÿèµ„æº","date":"2020-06-06T09:11:10.000Z","updated":"2023-04-30T10:21:41.350Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--åˆ©ç”¨ShutdownHooké‡Šæ”¾ç³»ç»Ÿèµ„æº/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--åˆ©ç”¨ShutdownHooké‡Šæ”¾ç³»ç»Ÿèµ„æº/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€ŠJavaç‰¹ç§å…µï¼ˆä¸Šå†Œï¼‰ã€‹ å½“å‘ç”Ÿ System.exit(int status) æ—¶ï¼Œå¸Œæœ›åœ¨ç³»ç»Ÿé€€å‡ºå‰ï¼Œæ‰§è¡Œä¸€ç‚¹ä»»åŠ¡æ¥åšä¸€äº›èµ„æºæ–¹é¢çš„å›æ”¶æ“ä½œï¼ŒShutdownHook å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå®ƒåˆ©ç”¨ hook çš„æ€è·¯æ¥å®ç°ï¼Œæœ‰äº›æ—¶å€™ä¹ŸæŠŠå®ƒå«ä½œâ€œé’©å­â€ã€‚ å‡å¦‚åœ¨ç³»ç»Ÿä¸­é€šè¿‡ Runtime.getRuntime().exec(String command) æˆ– new ProcessBuilder(List&lt;String&gt; command) å¯åŠ¨äº†å­è¿›ç¨‹ï¼ˆProcessï¼‰ï¼Œè¿™ä¸ªå­è¿›ç¨‹ä¸€ç›´åœ¨è¿è¡Œä¸­ï¼Œåœ¨å½“å‰è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå­è¿›ç¨‹æœªå¿…ä¼šé€€å‡ºï¼Œä½†æ­¤æ—¶ä¸šåŠ¡ä¸Šå¸Œæœ›å°†å®ƒé€€å‡ºï¼Œå°±å¯ä»¥åˆ©ç”¨ ShutdownHook ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªæµ‹è¯•æ ·ä¾‹ï¼š public class ShutdownHookTest { public static void main(String[] args) { Runtime.getRuntime().addShutdownHook(new Thread(new Runnable() { public void run() { System.out.println(&quot;æ‰§è¡ŒShutdownHooké’©å­æ“ä½œï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æº...&quot;); } })); Runtime.getRuntime().removeShutdownHook(new Thread()); System.exit(1); System.out.println(&quot;ä¸»è¿›ç¨‹ç»“æŸ...&quot;); } } æ‰§è¡Œç»“æœï¼š ä¸»è¿›ç¨‹ç»“æŸ...æ‰§è¡ŒShutdownHooké’©å­æ“ä½œï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æº... æ³¨æ„ï¼šä¼ å…¥å‚æ•°æ˜¯é€šè¿‡ new Thread() åˆ›å»ºçš„çº¿ç¨‹å¯¹è±¡ï¼Œåœ¨Javaè¿›ç¨‹è°ƒç”¨ exit() æ—¶ï¼Œä¼šè°ƒç”¨è¯¥çº¿ç¨‹å¯¹è±¡çš„ start()æ–¹æ³•å°†å…¶è¿è¡Œèµ·æ¥ï¼Œæ‰€ä»¥ä¸è¦æ‰‹å·¥å…ˆå¯åŠ¨äº†ã€‚å¦å¤–ï¼Œè¿™ç§å›è°ƒçº¿ç¨‹å°±ä¸è¦è®¾å®šä¸ºæ­»å¾ªç¯ç¨‹åºï¼Œå¦åˆ™å°±æ— æ³•é€€å‡ºäº†ã€‚ ShutdownHookæ‰§è¡ŒåŸç†java.langåŒ…ä¸‹æœ‰ä¸€ä¸ªShutdown ç±»ï¼Œæä¾›äº†ä¸€ä¸ª Runnable[] hooks æ•°ç»„ï¼Œæ•°ç»„çš„é•¿åº¦ä¸º10ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šå®šä¹‰10ä¸ªhookï¼ˆè¿™ä¸ç¨‹åºå†™å…¥å¤šå°‘ä¸ªçº¿ç¨‹å›è°ƒæ²¡æœ‰å…³ç³»ï¼‰ï¼Œæä¾› add() æ–¹æ³•æ¥æ³¨å†Œæ–°çš„ hook å¯¹è±¡ã€‚ // The system shutdown hooks are registered with a predefined slot. // The list of shutdown hooks is as follows: // (0) Console restore hook // (1) Application hooks // (2) DeleteOnExit hook private static final int MAX_SYSTEM_HOOKS = 10; private static final Runnable[] hooks = new Runnable[MAX_SYSTEM_HOOKS]; /* Add a new shutdown hook. Checks the shutdown state and the hook itself, * but does not do any security checks. */ static void add(int slot, Runnable hook) { synchronized (lock) { if (state &gt; RUNNING) throw new IllegalStateException(&quot;Shutdown in progress&quot;); if (hooks[slot] != null) throw new InternalError(&quot;Shutdown hook at slot &quot; + slot + &quot; already registered&quot;); hooks[slot] = hook; } } åœ¨java.lang.ApplicationShutdownHooks çš„ static åŒ¿åå—ä¸­ï¼Œé€šè¿‡ add() æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ªhook ï¼Œåœ¨ run() æ–¹æ³•å†…éƒ¨è¿è¡Œå†…éƒ¨çš„é™æ€æ–¹æ³• runHooks() ï¼Œå®ƒå†…éƒ¨ç”¨ä¸€ä¸ª IdentityHashMap æ¥å­˜æ”¾ hook ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ add() æ–¹æ³•æ¥æ·»åŠ ï¼Œè€Œç¨‹åºä¸­å®šä¹‰çš„å›è°ƒçº¿ç¨‹éƒ½æ”¾åœ¨äº†è¿™é‡Œï¼Œå®ƒè‡ªèº«ç”¨ hook çš„å½¢å¼å­˜åœ¨äº hooks åˆ—è¡¨å½“ä¸­ã€‚ package java.lang; import java.util.*; /* * Class to track and run user level shutdown hooks registered through * &lt;tt&gt;{@link Runtime#addShutdownHook Runtime.addShutdownHook}&lt;/tt&gt;. * * @see java.lang.Runtime#addShutdownHook * @see java.lang.Runtime#removeShutdownHook */ class ApplicationShutdownHooks { static { Shutdown.add(1 /* shutdown hook invocation order */, new Runnable() { public void run() { runHooks(); } }); } /* The set of registered hooks */ private static IdentityHashMap&lt;Thread, Thread&gt; hooks = new IdentityHashMap&lt;Thread, Thread&gt;(); private void ApplicationShutdownHooks() {} /* Add a new shutdown hook. Checks the shutdown state and the hook itself, * but does not do any security checks. */ static synchronized void add(Thread hook) { if(hooks == null) throw new IllegalStateException(&quot;Shutdown in progress&quot;); if (hook.isAlive()) throw new IllegalArgumentException(&quot;Hook already running&quot;); if (hooks.containsKey(hook)) throw new IllegalArgumentException(&quot;Hook previously registered&quot;); hooks.put(hook, hook); } /* Remove a previously-registered hook. Like the add method, this method * does not do any security checks. */ static synchronized boolean remove(Thread hook) { if(hooks == null) throw new IllegalStateException(&quot;Shutdown in progress&quot;); if (hook == null) throw new NullPointerException(); return hooks.remove(hook) != null; } /* Iterates over all application hooks creating a new thread for each * to run in. Hooks are run concurrently and this method waits for * them to finish. */ static void runHooks() { Collection&lt;Thread&gt; threads; synchronized(ApplicationShutdownHooks.class) { threads = hooks.keySet(); hooks = null; } for (Thread hook : threads) { hook.start(); } for (Thread hook : threads) { try { hook.join(); } catch (InterruptedException x) { } } } } å½“è°ƒç”¨ Runtime.getRuntime().addShutdownHook(Thread hook)æ–¹æ³•æ—¶ï¼Œä¼šé—´æ¥è°ƒç”¨ ApplicationShutdownHooks.add(Thread hook)å°†çº¿ç¨‹æ”¾åˆ°IdentityHashMap ä¸­ï¼ŒRuntime.getRuntime().removeShutdownHook(Thread)ç”¨äºåˆ é™¤ä¸€ä¸ªé’©å­çº¿ç¨‹ã€‚ public void addShutdownHook(Thread hook) { SecurityManager sm = System.getSecurityManager(); if (sm != null) { sm.checkPermission(new RuntimePermission(&quot;shutdownHooks&quot;)); } ApplicationShutdownHooks.add(hook); } public boolean removeShutdownHook(Thread hook) { SecurityManager sm = System.getSecurityManager(); if (sm != null) { sm.checkPermission(new RuntimePermission(&quot;shutdownHooks&quot;)); } return ApplicationShutdownHooks.remove(hook); } å½“è°ƒç”¨ System.exit(int status)æ–¹æ³•æ—¶ï¼Œä¼šé—´æ¥è°ƒç”¨ Shutdown.exit(int status)æ–¹æ³•ï¼Œå†è°ƒç”¨sequence()--&gt;runHooks() æ–¹æ³•ã€‚ /* Invoked by Runtime.exit, which does all the security checks. * Also invoked by handlers for system-provided termination events, * which should pass a nonzero status code. */ static void exit(int status) { boolean runMoreFinalizers = false; synchronized (lock) { if (status != 0) runFinalizersOnExit = false; switch (state) { case RUNNING: /* Initiate shutdown */ state = HOOKS; break; case HOOKS: /* Stall and halt */ break; case FINALIZERS: if (status != 0) { /* Halt immediately on nonzero status */ halt(status); } else { /* Compatibility with old behavior: * Run more finalizers and then halt */ runMoreFinalizers = runFinalizersOnExit; } break; } } if (runMoreFinalizers) { runAllFinalizers(); halt(status); } synchronized (Shutdown.class) { /* Synchronize on the class object, causing any other thread * that attempts to initiate shutdown to stall indefinitely */ sequence(); halt(status); } } /* The actual shutdown sequence is defined here. * * If it weren&#39;t for runFinalizersOnExit, this would be simple -- we&#39;d just * run the hooks and then halt. Instead we need to keep track of whether * we&#39;re running hooks or finalizers. In the latter case a finalizer could * invoke exit(1) to cause immediate termination, while in the former case * any further invocations of exit(n), for any n, simply stall. Note that * if on-exit finalizers are enabled they&#39;re run iff the shutdown is * initiated by an exit(0); they&#39;re never run on exit(n) for n != 0 or in * response to SIGINT, SIGTERM, etc. */ private static void sequence() { synchronized (lock) { /* Guard against the possibility of a daemon thread invoking exit * after DestroyJavaVM initiates the shutdown sequence */ if (state != HOOKS) return; } runHooks(); boolean rfoe; synchronized (lock) { state = FINALIZERS; rfoe = runFinalizersOnExit; } if (rfoe) runAllFinalizers(); } /* Run all registered shutdown hooks */ private static void runHooks() { /* We needn&#39;t bother acquiring the lock just to read the hooks field, * since the hooks can&#39;t be modified once shutdown is in progress */ for (Runnable hook : hooks) { try { if (hook != null) hook.run(); } catch(Throwable t) { if (t instanceof ThreadDeath) { ThreadDeath td = (ThreadDeath)t; throw td; } } } } å¾ªç¯ä¸­çš„ä¸€ä¸ªhookå¯¹è±¡å°±æ˜¯ç”± ApplicationShutdownHooks çš„åŒ¿åå—å®šä¹‰çš„ï¼Œå› æ­¤ä¼šè°ƒç”¨ ApplicationShutdownHooks ç±»çš„ run() æ–¹æ³•ï¼Œå†è°ƒç”¨å®ƒçš„runHooks()æ–¹æ³•ï¼Œè¿™ä¸ª runHooks()æ–¹æ³•å†…å®¹å¦‚ä¸‹ã€‚ /* Iterates over all application hooks creating a new thread for each * to run in. Hooks are run concurrently and this method waits for * them to finish. */ static void runHooks() { Collection&lt;Thread&gt; threads; synchronized(ApplicationShutdownHooks.class) { threads = hooks.keySet(); hooks = null; } for (Thread hook : threads) { hook.start(); } for (Thread hook : threads) { try { hook.join(); } catch (InterruptedException x) { } } } ä»è¿™ä¸ªæ–¹æ³•ä¸­å–å‡ºæ‰€æœ‰çš„Thread ï¼Œç„¶åå°†çº¿ç¨‹å¯åŠ¨èµ·æ¥ï¼Œæœ€åé€šè¿‡ join() æ–¹æ³•ç­‰å¾…å„ä¸ªçº¿ç¨‹ç»“æŸçš„åŠ¨ä½œï¼Œæ¢å¥è¯è¯´ï¼Œåœ¨è¿›ç¨‹å…³é—­å‰ï¼Œå¯¹å¤šä¸ªå›è°ƒä»»åŠ¡çš„å¤„ç†æ–¹å¼æ˜¯æ¯ä¸ªä»»åŠ¡å•ç‹¬æœ‰ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„ä»»åŠ¡åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¸²è¡Œå¤„ç†ã€‚ ShutdownHooké€‚ç”¨åœºæ™¯ ç¨‹åºæ­£å¸¸é€€å‡º ä½¿ç”¨System.exit() ç»ˆç«¯ä½¿ç”¨Ctrl+Cè§¦å‘çš„ä¸­æ–­ ç³»ç»Ÿå…³é—­ OutOfMemoryå®•æœº ä½¿ç”¨Kill pidå‘½ä»¤å¹²æ‰è¿›ç¨‹ï¼ˆæ³¨ï¼šåœ¨ä½¿ç”¨kill -9 pidæ—¶ï¼Œæ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„ï¼‰","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,ShutdownHook","slug":"Java-ShutdownHook","permalink":"/tags/Java-ShutdownHook/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–HttpServletRequestè¯·æ±‚Body","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–HttpServletRequestè¯·æ±‚Body","date":"2020-06-06T09:10:10.000Z","updated":"2023-04-30T10:21:41.353Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–HttpServletRequestè¯·æ±‚Body/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–HttpServletRequestè¯·æ±‚Body/","excerpt":"","text":"åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦ä» HttpServletRequest ä¸­è¯»å–HTTPè¯·æ±‚çš„bodyå†…å®¹ï¼Œä¿—è¯è¯´çš„å¥½â€å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´â€œï¼Œç‰¹åœ¨æ­¤å°†å…¶è¯»å–æ–¹æ³•è®°å½•ä¸€ä¸‹ã€‚ import java.io.BufferedReader; import java.io.IOException; import java.io.InputStream; import javax.servlet.ServletInputStream; import javax.servlet.http.HttpServletRequest; public class HttpServletRequestReader { // å­—ç¬¦ä¸²è¯»å– // æ–¹æ³•ä¸€ public static String ReadAsChars(HttpServletRequest request) { BufferedReader br = null; StringBuilder sb = new StringBuilder(&quot;&quot;); try { br = request.getReader(); String str; while ((str = br.readLine()) != null) { sb.append(str); } br.close(); } catch (IOException e) { e.printStackTrace(); } finally { if (null != br) { try { br.close(); } catch (IOException e) { e.printStackTrace(); } } } return sb.toString(); } // æ–¹æ³•äºŒ public static void ReadAsChars2(HttpServletRequest request) { InputStream is = null; try { is = request.getInputStream(); StringBuilder sb = new StringBuilder(); byte[] b = new byte[4096]; for (int n; (n = is.read(b)) != -1;) { sb.append(new String(b, 0, n)); } } catch (IOException e) { e.printStackTrace(); } finally { if (null != is) { try { is.close(); } catch (IOException e) { e.printStackTrace(); } } } } // äºŒè¿›åˆ¶è¯»å– public static byte[] readAsBytes(HttpServletRequest request) { int len = request.getContentLength(); byte[] buffer = new byte[len]; ServletInputStream in = null; try { in = request.getInputStream(); in.read(buffer, 0, len); in.close(); } catch (IOException e) { e.printStackTrace(); } finally { if (null != in) { try { in.close(); } catch (IOException e) { e.printStackTrace(); } } } return buffer; } } æ³¨æ„ï¼šHttpServletRequest è¯·æ±‚ä¸­çš„ body å†…å®¹ä»…èƒ½è°ƒç”¨ request.getInputStream()ï¼Œ request.getReader()å’Œrequest.getParameter(â€œkeyâ€) æ–¹æ³•è¯»å–ä¸€æ¬¡ï¼Œé‡å¤è¯»å–ä¼šæŠ¥ java.io.IOException: Stream closed å¼‚å¸¸ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,HttpServletRequest,Body","slug":"Java-HttpServletRequest-Body","permalink":"/tags/Java-HttpServletRequest-Body/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--äºŒè¿›åˆ¶æ–‡ä»¶ä¸åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬åŒ–","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--äºŒè¿›åˆ¶æ–‡ä»¶ä¸åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬åŒ–","date":"2020-06-06T09:09:10.000Z","updated":"2023-04-30T10:21:41.346Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--äºŒè¿›åˆ¶æ–‡ä»¶ä¸åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬åŒ–/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--äºŒè¿›åˆ¶æ–‡ä»¶ä¸åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬åŒ–/","excerpt":"","text":"æœ¬å·¥å…·ç±»ä¸»è¦ç”¨æ¥å°†äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–å¹¶è½¬æ¢æˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¹¶æä¾›äº†å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è¿˜åŸä¸ºäºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹æ³•ã€‚ import java.io.ByteArrayOutputStream; import java.io.File; import java.io.FileInputStream; import java.io.FileNotFoundException; import java.io.FileOutputStream; import java.io.IOException; import java.io.InputStream; import java.nio.ByteBuffer; import java.nio.channels.FileChannel; import org.apache.log4j.Logger; public class HexStringUtils { private static final Logger logger = Logger.getLogger(HexStringUtils.class); private static final char[] hexChars = { &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39; }; private static final String hexString = &quot;0123456789ABCDEF&quot;; public static String toHexString(String filePath) throws FileNotFoundException, IOException { if (isEmptyStr(filePath)) { logger.error(&quot;invalid filePath parameter...&quot;); } return toHexString(new File(filePath)); } public static String toHexString(File file) throws FileNotFoundException, IOException { if (null == file || !file.exists() || file.isDirectory()) { logger.error(&quot;invalid file parameter...&quot;); } return toHexString(new FileInputStream(file)); } public static String toHexString(InputStream inputStream) throws IOException { byte[] bytes = inputStream2ByteArray(inputStream); return toHexString(bytes); } private static byte[] inputStream2ByteArray(InputStream in) throws IOException { ByteArrayOutputStream out = new ByteArrayOutputStream(); byte[] buffer = new byte[1024 * 4]; int n = 0; while ((n = in.read(buffer)) != -1) { out.write(buffer, 0, n); } return out.toByteArray(); } /* * Converts a byte array to hex string */ private static String toHexString(byte[] bytes) { StringBuffer buf = new StringBuffer(); int len = bytes.length; for (int i = 0; i &lt; len; i++) { byte2hex(bytes[i], buf); } return buf.toString(); } /* * Converts a byte to hex digit and writes to the supplied buffer */ private static void byte2hex(byte b, StringBuffer buf) { int high = ((b &amp; 0xf0) &gt;&gt; 4); int low = (b &amp; 0x0f); buf.append(hexChars[high]); buf.append(hexChars[low]); } /* * Converts a hex string to byte array */ private static byte[] convert2bytes(String stringOfHex) { if (isEmptyStr(stringOfHex)) { logger.error(&quot;invalid hex string parameter...&quot;); return null; } stringOfHex = stringOfHex.trim().toUpperCase(); if (stringOfHex.length() % 2 == 1) return null; int length = stringOfHex.length() / 2; byte[] bytes = new byte[length]; char[] charArray = stringOfHex.toCharArray(); for (int i = 0; i &lt; length; i++) { int pos = i * 2; bytes[i] = (byte) (charToByte(charArray[pos]) &lt;&lt; 4 | charToByte(charArray[pos + 1])); } return bytes; } /* * Converts a character to byte */ private static byte charToByte(char c) { return (byte) hexString.indexOf(c); } /* * Converts a byte array to file */ @SuppressWarnings(&quot;resource&quot;) public static void writeBytes2File(String filePath, byte[] bytes) throws IOException { File outputFile = new File(filePath); File parentFile = outputFile.getParentFile(); if (!parentFile.exists()) { parentFile.mkdirs(); } ByteBuffer bb = ByteBuffer.wrap(bytes); FileChannel fc = new FileOutputStream(outputFile).getChannel(); fc.write(bb); fc.close(); } /* * Determine whether a string is empty */ private static boolean isEmptyStr(String str) { return str == null || str.length() == 0; } public static void main(String[] args) throws FileNotFoundException, IOException { // è·å–å­—ä½“æ–‡ä»¶3D.TTFçš„16è¿›åˆ¶å­—ç¬¦ä¸² String filePath = &quot;D:/3D.TTF&quot;; long start = System.currentTimeMillis(); String hexStr = toHexString(filePath); System.out.println(hexStr); long end = System.currentTimeMillis(); System.out.println(end - start); // å°†3D.TTFçš„16è¿›åˆ¶å­—ç¬¦ä¸²è¿˜åŸä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ String newFilePath = &quot;D:/3Då‰¯æœ¬.TTF&quot;; start = System.currentTimeMillis(); byte[] bytes = convert2bytes(hexStr); writeBytes2File(newFilePath, bytes); end = System.currentTimeMillis(); System.out.println(end - start); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,äºŒè¿›åˆ¶,åå…­è¿›åˆ¶","slug":"Java-äºŒè¿›åˆ¶-åå…­è¿›åˆ¶","permalink":"/tags/Java-äºŒè¿›åˆ¶-åå…­è¿›åˆ¶/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ•°ç»„åˆå§‹åŒ–å¡«å……","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ•°ç»„åˆå§‹åŒ–å¡«å……","date":"2020-06-06T09:08:10.000Z","updated":"2023-04-30T10:21:41.352Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ•°ç»„åˆå§‹åŒ–å¡«å……/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ•°ç»„åˆå§‹åŒ–å¡«å……/","excerpt":"","text":"å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–å¡«å……import java.util.Arrays; public class ArrayFilling { public static void main(String[] args) { int[] scoreArr = new int[8]; // åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º8çš„æ•°ç»„ Arrays.fill(scoreArr, 0); // å°†æ•°ç»„ä½¿ç”¨æ•°å­— 0 è¿›è¡Œå¡«å…… for (int i = 0; i &lt; scoreArr.length; i++) { System.out.print(scoreArr[i] + &quot; &quot;); } System.out.print(&quot;&quot;); Arrays.fill(scoreArr, 2, 6, 1);// å°†ç´¢å¼•ä» 2 åˆ° 6 ä½¿ç”¨æ•°å­— 1 è¿›è¡Œå¡«å…… for (int i = 0; i &lt; scoreArr.length; i++) { System.out.print(scoreArr[i] + &quot; &quot;); } } } æ‰“å°ç»“æœï¼š 0 0 0 0 0 0 0 00 0 1 1 1 1 0 0","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,æ•°ç»„,åˆå§‹åŒ–","slug":"Java-æ•°ç»„-åˆå§‹åŒ–","permalink":"/tags/Java-æ•°ç»„-åˆå§‹åŒ–/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰“åŒ… FatJaræ–¹æ³•å°ç»“","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰“åŒ… FatJaræ–¹æ³•å°ç»“","date":"2020-06-06T09:07:10.000Z","updated":"2023-04-30T10:21:41.351Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰“åŒ… FatJaræ–¹æ³•å°ç»“/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰“åŒ… FatJaræ–¹æ³•å°ç»“/","excerpt":"","text":"è½¬è½½è‡ªï¼šhttps://yq.aliyun.com/articles/630208?utm_content=m_1000014409 åœ¨å‡½æ•°è®¡ç®—(Aliyun FC)ä¸­å‘å¸ƒä¸€ä¸ª Java å‡½æ•°ï¼Œå¾€å¾€éœ€è¦å°†å‡½æ•°æ‰“åŒ…æˆä¸€ä¸ª all-in-one çš„ zip åŒ…æˆ–è€… jar åŒ…ã€‚Java ä¸­è¿™ç§æ‰“åŒ… all-in-one çš„æŠ€æœ¯å¸¸ç§°ä¹‹ä¸º Fatjar æŠ€æœ¯ã€‚æœ¬æ–‡å°ç»“ä¸€ä¸‹ Java é‡Œæ‰“åŒ… FatJar çš„è‹¥å¹²ç§æ–¹æ³•ã€‚ ä»€ä¹ˆæ˜¯FatJarFatJar åˆç§°ä½œ uber-Jarï¼Œæ˜¯åŒ…å«æ‰€æœ‰ä¾èµ–çš„ Jar åŒ…ã€‚ Jar åŒ…ä¸­åµŒå…¥äº†é™¤ java è™šæ‹Ÿæœºä»¥å¤–çš„æ‰€æœ‰ä¾èµ–ã€‚æˆ‘ä»¬çŸ¥é“ Java çš„ä¾èµ–åˆ†ä¸ºä¸¤ç§ï¼Œ é›¶æ•£çš„ .class æ–‡ä»¶å’ŒæŠŠå¤šä¸ª .class æ–‡ä»¶ä»¥ zip æ ¼å¼æ‰“åŒ…è€Œæˆ jar æ–‡ä»¶ã€‚FatJar æ˜¯ä¸€ä¸ª all-in-one Jar åŒ…ã€‚FatJar æŠ€æœ¯å¯ä»¥è®©é‚£äº›ç”¨äºæœ€ç»ˆå‘å¸ƒçš„ Jar ä¾¿äºéƒ¨ç½²å’Œè¿è¡Œã€‚ ä¸‰ç§æ‰“åŒ…æ–¹æ³•æˆ‘ä»¬çŸ¥é“ .java æºç æ–‡ä»¶ä¼šè¢«ç¼–è¯‘å™¨ç¼–è¯‘æˆå­—èŠ‚ç .class æ–‡ä»¶ã€‚Java è™šæ‹Ÿæœºæ‰§è¡Œçš„æ˜¯ .class æ–‡ä»¶ã€‚ä¸€ä¸ª java ç¨‹åºå¯ä»¥æœ‰å¾ˆå¤šä¸ª .class æ–‡ä»¶ã€‚è¿™äº› .class æ–‡ä»¶å¯ä»¥ç”± java è™šæ‹Ÿæœºçš„ç±»è£…è½½å™¨è¿è¡ŒæœŸè£…è½½åˆ°å†…å­˜é‡Œã€‚java è™šæ‹Ÿæœºå¯ä»¥ä»æŸä¸ªç›®å½•è£…è½½æ‰€æœ‰çš„ .class æ–‡ä»¶ï¼Œä½†æ˜¯è¿™äº›é›¶æ•£çš„.class æ–‡ä»¶å¹¶ä¸ä¾¿äºåˆ†å‘ã€‚æ‰€æœ‰ java æ”¯æŒæŠŠé›¶æ•£çš„.class æ–‡ä»¶æ‰“åŒ…æˆ zip æ ¼å¼çš„ .jar æ–‡ä»¶ï¼Œå¹¶ä¸”è™šæ‹Ÿæœºçš„ç±»è£…è½½å™¨æ”¯æŒç›´æ¥è£…è½½ .jar æ–‡ä»¶ã€‚ ä¸€ä¸ªæ­£å¸¸çš„ java ç¨‹åºä¼šæœ‰è‹¥å¹²ä¸ª.class æ–‡ä»¶å’Œæ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“çš„ jar æ–‡ä»¶ç»„æˆã€‚ éé®è”½æ–¹æ³•ï¼ˆUnshadedï¼‰éé®è”½æ˜¯ç›¸å¯¹äºé®è”½è€Œè¯´çš„ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç§æœ´ç´ çš„åŠæ³•ã€‚è§£å‹æ‰€æœ‰ jar æ–‡ä»¶ï¼Œå†é‡æ–°æ‰“åŒ…æˆä¸€ä¸ªæ–°çš„å•ç‹¬çš„ jar æ–‡ä»¶ã€‚ å€ŸåŠ© Maven Assembly Plugin æˆ– Gradle Java plugin éƒ½å¯ä»¥è½»æ¾å®ç°éé®è”½æ–¹æ³•çš„æ‰“åŒ…ã€‚ Maven Assembly PluginMaven Assembly Plugin æ˜¯ä¸€ä¸ªæ‰“åŒ…èšåˆæ’ä»¶ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æŠŠé¡¹ç›®çš„ç¼–è¯‘è¾“å‡ºååŒä¾èµ–ï¼Œæ¨¡å—ï¼Œæ–‡æ¡£å’Œå…¶ä»–æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„å‘å¸ƒåŒ…ã€‚ä½¿ç”¨æè¿°ç¬¦ï¼ˆdescriptorï¼‰æ¥é…ç½®éœ€è¦æ‰“åŒ…çš„ç‰©æ–™ç»„åˆã€‚å¹¶é¢„å®šä¹‰äº†å¸¸ç”¨çš„æè¿°ç¬¦ï¼Œå¯ä¾›ç›´æ¥ä½¿ç”¨ã€‚ é¢„å®šä¹‰æè¿°ç¬¦å¦‚ä¸‹ï¼š bin åªæ‰“åŒ…ç¼–è¯‘ç»“æœï¼Œå¹¶åŒ…å« README, LICENSE å’Œ NOTICE æ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶æ ¼å¼ä¸º tar.gz, tar.bz2 å’Œ zipã€‚ jar-with-dependencies æ‰“åŒ…ç¼–è¯‘ç»“æœï¼Œå¹¶å¸¦ä¸Šæ‰€æœ‰çš„ä¾èµ–ï¼Œå¦‚æœä¾èµ–çš„æ˜¯ jar åŒ…ï¼Œjar åŒ…ä¼šè¢«è§£å‹å¼€ï¼Œå¹³é“ºåˆ°æœ€ç»ˆçš„ uber-jar é‡Œå»ã€‚è¾“å‡ºæ ¼å¼ä¸º jarã€‚ src æ‰“åŒ…æºç æ–‡ä»¶ã€‚è¾“å‡ºæ ¼å¼ä¸º tar.gz, tar.bz2 å’Œ zipã€‚ project æ‰“åŒ…æ•´ä¸ªé¡¹ç›®ï¼Œé™¤äº†éƒ¨ç½²è¾“å‡ºç›®å½• target ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•éƒ½ä¼šè¢«æ‰“åŒ…ã€‚è¾“å‡ºæ ¼å¼ä¸º tar.gz, tar.bz2 å’Œ zipã€‚ é™¤äº†é¢„å®šä¹‰çš„æè¿°ç¬¦ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥æŒ‡å®šæè¿°ç¬¦ï¼Œä»¥æ»¡è¶³ä¸åŒçš„æ‰“åŒ…éœ€æ±‚ã€‚ æ‰“åŒ…æˆ uber-jarï¼Œéœ€è¦ä½¿ç”¨é¢„å®šä¹‰çš„ jar-with-dependencies æè¿°ç¬¦ï¼š åœ¨ pom.xml ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;version&gt;CHOOSE LATEST VERSION HERE&lt;/version&gt; &lt;configuration&gt; &lt;descriptorRefs&gt; &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt; &lt;/descriptorRefs&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;assemble-all&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;single&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; Gradle Java plugingradle ä¸‹æ‰“åŒ…ä¸€ä¸ªéé®è”½çš„ jar åŒ…ï¼Œæœ‰ä¸å°‘æ’ä»¶å¯ä»¥ç”¨ï¼Œä½†æ˜¯ç”±äº gradle è‡ªèº«çš„çµæ´»æ€§ï¼Œå¯ä»¥ç›´æ¥ç”¨ groove çš„ dsl å®ç°ã€‚ apply plugin: &#39;java&#39; jar { from { (configurations.runtime).collect { it.isDirectory() ? it : zipTree(it) } } } æ³¨æ„ï¼šéé®è”½æ–¹æ³•ä¼šæŠŠæ‰€æœ‰çš„ jar åŒ…é‡Œçš„æ–‡ä»¶éƒ½è§£å‹åˆ°ä¸€ä¸ªç›®å½•é‡Œï¼Œç„¶ååœ¨æ‰“åŒ…åŒä¸€ä¸ª fatjar ä¸­ã€‚å¯¹äºå¤æ‚åº”ç”¨å¾ˆå¯èƒ½ä¼šç¢°åˆ°åŒåç±»ç›¸äº’è¦†ç›–é—®é¢˜ã€‚ é®è”½æ–¹æ³•ï¼ˆShadedï¼‰é®è”½æ–¹æ³•ä¼šæŠŠä¾èµ–åŒ…é‡Œçš„ç±»è·¯å¾„è¿›è¡Œä¿®æ”¹åˆ°æŸä¸ªå­è·¯å¾„ä¸‹ï¼Œè¿™æ ·å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé¿å…åŒåç±»ç›¸äº’è¦†ç›–çš„é—®é¢˜ã€‚æœ€ç»ˆå‘å¸ƒçš„ jar ä¹Ÿä¸ä¼šå¸¦å…¥ä¼ é€’ä¾èµ–å†²çªé—®é¢˜ç»™ä¸‹æ¸¸ã€‚ Maven Shade Pluginåœ¨ pom.xml ä¸­åŠ å…¥å¦‚ä¸‹é…ç½® &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.1&lt;/version&gt; &lt;configuration&gt; &lt;!-- put your configurations here --&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;shade&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; Gradle Shadow pluginGradle shadow plugin ä½¿ç”¨éå¸¸ç®€å•ï¼Œç®€å•å£°æ˜æ’ä»¶åå°±å¯ä»¥ç”Ÿæ•ˆã€‚ plugins { id &#39;com.github.johnrengelman.shadow&#39; version &#39;2.0.4&#39; id &#39;java&#39; } shadowJar { include &#39;*.jar&#39; include &#39;*.properties&#39; exclude &#39;a2.properties&#39; } æ³¨æ„ï¼šé®è”½æ–¹æ³•ä¾èµ–ä¿®æ”¹ class çš„å­—èŠ‚ç ï¼Œæ›´æ–°ä¾èµ–æ–‡ä»¶çš„åŒ…è·¯å¾„è¾¾åˆ°è§„é¿åŒååŒåŒ…ç±»å†²çªçš„é—®é¢˜ï¼Œä½†æ˜¯æ”¹åä¹Ÿä¼šå¸¦æ¥å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚ä»£ç ä¸­ä½¿ç”¨ Class.forName æˆ– ClassLoader.loadClass è£…è½½çš„ç±»ï¼ŒShade Plugin æ˜¯æ„ŸçŸ¥ä¸åˆ°çš„ã€‚åŒåæ–‡ä»¶è¦†ç›–é—®é¢˜ä¹Ÿæ²¡æ³•æœç»ï¼Œæ¯”å¦‚ META-INF/services/javax.script.ScriptEngineFactoryä¸å±äºç±»æ–‡ä»¶ï¼Œä½†æ˜¯è¢«è¦†ç›–åä¼šå‡ºç°é—®é¢˜ã€‚ åµŒå¥—æ–¹æ³•ï¼ˆJar of Jarsï¼‰è¿˜æ˜¯ä¸€ç§åŠæ³•å°±æ˜¯åœ¨ jar åŒ…é‡ŒåµŒå¥—å…¶ä»– jarï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å½»åº•é¿å…è§£å‹åŒåè¦†ç›–çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸è¢« JVM åŸç”Ÿæ”¯æŒï¼Œå› ä¸º JDK æä¾›çš„ ClassLoader ä»…æ”¯æŒè£…è½½åµŒå¥— jar åŒ…çš„ class æ–‡ä»¶ã€‚æ‰€ä»¥è¿™ç§æ–¹æ³•éœ€è¦è‡ªå®šä¹‰ ClassLoader ä»¥æ”¯æŒåµŒå¥— jarã€‚ Onejar Maven PluginOne-JAR å°±æ˜¯ä¸€ä¸ªåŸºäºä¸Šé¢åµŒå¥— jar å®ç°çš„å·¥å…·ã€‚onejar-maven-plugin æ˜¯ç¤¾åŒºåŸºäº onejar å®ç°çš„ maven æ’ä»¶ã€‚ &lt;plugin&gt; &lt;groupId&gt;com.jolira&lt;/groupId&gt; &lt;artifactId&gt;onejar-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.4.4&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;one-jar&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; Spring boot pluginOne-JAR æœ‰ç‚¹å¹´ä¹…å¤±ä¿®ï¼Œå¥½ä¹…æ²¡æœ‰ç»´æŠ¤äº†ï¼ŒSpring Boot æä¾›çš„ Maven Plugin ä¹Ÿå¯ä»¥æ‰“åŒ… Fatjarï¼Œæ”¯æŒéé®è”½å’ŒåµŒå¥—çš„æ··åˆæ¨¡å¼ï¼Œå¹¶ä¸”æ”¯æŒ maven å’Œ gradle ã€‚ &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;layout&gt;ZIP&lt;/layout&gt; &lt;requiresUnpack&gt; &lt;dependency&gt; &lt;groupId&gt;org.jruby&lt;/groupId&gt; &lt;artifactId&gt;jruby-complete&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/requiresUnpack&gt; &lt;/configuration&gt; &lt;/plugin&gt; plugins { id &#39;org.springframework.boot&#39; version &#39;2.0.4.RELEASE&#39; } bootJar { requiresUnpack &#39;**/jruby-complete-*.jar&#39; } requiresUnpack å‚æ•°å¯ä»¥å®šåˆ¶é‚£äº› jar ä¸å¸Œæœ›è¢«è§£å‹ï¼Œé‡‡ç”¨åµŒå¥—çš„æ–¹å¼æ‰“åŒ…åˆ° Fatjar å†…éƒ¨ã€‚ å…¶æ‰“åŒ…åçš„å†…éƒ¨ç»“æ„ä¸ºï¼š example.jar | +-META-INF | +-MANIFEST.MF +-org | +-springframework | +-boot | +-loader | +-&lt;spring boot loader classes&gt; +-BOOT-INF +-classes | +-mycompany | +-project | +-YourClasses.class +-lib +-dependency1.jar +-dependency2.jar åº”ç”¨çš„ç±»æ–‡ä»¶è¢«æ”¾ç½®åˆ° BOOT-INF/classes ç›®å½•ï¼Œä¾èµ–åŒ…è¢«æ”¾ç½®åˆ° BOOT-INF/lib ç›®å½•ã€‚ æŸ¥çœ‹ META-INF/MANIFEST.MF æ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸ºï¼š Main-Class: org.springframework.boot.loader.JarLauncher Start-Class: com.mycompany.project.MyApplication å¯åŠ¨ç±»æ˜¯å›ºå®šçš„ org.springframework.boot.loader.JarLauncherï¼Œåº”ç”¨ç¨‹åºçš„å…¥å£ç±»éœ€è¦é…ç½®æˆ Start-Classã€‚è¿™æ ·åšçš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒåµŒå¥— jar åŒ…çš„ç±»è£…è½½ï¼Œæ›¿æ¢æ‰é»˜è®¤çš„ ClassLoaderã€‚ æ³¨æ„ï¼šä½†æ˜¯å‡½æ•°è®¡ç®— Java Runtime éœ€è¦çš„ jar åŒ…æ˜¯ä¸€ç§æ‰“åŒ…ç»“æ„ï¼Œåœ¨æœåŠ¡ç«¯è¿è¡Œæ—¶ä¼šè§£å‹å¼€ï¼Œ./lib ç›®å½•åŠ åˆ° classpath ä¸­ï¼Œå•ä¸ä¼šè°ƒç”¨ Main-Classã€‚æ‰€ä»¥è‡ªå®šä¹‰ ClassLoader æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥ä¸è¦ä½¿ç”¨åµŒå¥— jar ç»“æ„ï¼Œé™¤éåœ¨å…¥å£å‡½æ•°æŒ‡å®šé‡æ–°å®šä¹‰ ClassLoader æˆ–è€… classpath ä»¥æ”¯æŒ BOOT-INF/classes å’Œ BOOT-INF/lib è¿™æ ·çš„å®šåˆ¶åŒ–çš„ç±»è·¯å¾„ã€‚ å°ç»“ å•ä» Fatjar çš„è§’åº¦çœ‹ï¼Œ Spring boot maven/gradle åšå¾—æœ€ç²¾è‡´ã€‚ä½†æ˜¯ jar åŒ…å†…éƒ¨çš„è‡ªå®šä¹‰è·¯å¾„è§£å‹å¼€ä»¥åå’Œå‡½æ•°è®¡ç®—æ˜¯ä¸å…¼å®¹çš„ã€‚æ‰€ä»¥å¦‚æœç”¨äºå‡½æ•°è®¡ç®—æ‰“åŒ…ï¼Œå»ºè®®ä½¿ç”¨ Unshaded æˆ–è€… Shared çš„æ‰“åŒ…æ–¹å¼ï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æ³¨æ„æ–‡ä»¶è¦†ç›–é—®é¢˜ã€‚ å‚è€ƒé˜…è¯»https://imagej.net/Uber-JARhttps://softwareengineering.stackexchange.com/questions/297276/what-is-a-shaded-java-dependencyhttps://docs.spring.io/spring-boot/docs/current/reference/html/executable-jar.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,æ‰“åŒ…,FatJar","slug":"Java-æ‰“åŒ…-FatJar","permalink":"/tags/Java-æ‰“åŒ…-FatJar/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æœ¬åœ°æ–¹æ³•","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æœ¬åœ°æ–¹æ³•","date":"2020-06-06T09:06:10.000Z","updated":"2023-04-30T10:21:41.352Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æœ¬åœ°æ–¹æ³•/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æœ¬åœ°æ–¹æ³•/","excerpt":"","text":"ä¸€. ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ç®€å•åœ°è®²ï¼Œä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰å°±æ˜¯ä¸€ä¸ªJavaè°ƒç”¨éjavaä»£ç çš„æ¥å£ã€‚ ä¸€ä¸ªæœ¬åœ°æ–¹æ³•æ˜¯è¿™æ ·ä¸€ä¸ªjavaæ–¹æ³•ï¼šè¯¥æ–¹æ³•çš„å®ç°ç”±éjavaè¯­è¨€å®ç°ï¼Œæ¯”å¦‚Cã€‚è¿™ä¸ªç‰¹å¾å¹¶éjavaæ‰€ç‰¹æœ‰ï¼Œå¾ˆå¤šå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚åœ¨C++ä¸­ï¼Œä½ å¯ä»¥ç”¨extern â€œCâ€å‘ŠçŸ¥C++ç¼–è¯‘å™¨å»è°ƒç”¨ä¸€ä¸ªCçš„å‡½æ•°ã€‚ &quot;A native method is a Java method whose implementation is provided by non-java code.&quot; åœ¨å®šä¹‰ä¸€ä¸ªæœ¬åœ°æ–¹æ³•æ—¶ï¼Œå¹¶ä¸æä¾›å®ç°ä½“ï¼ˆæœ‰äº›åƒå®šä¹‰ä¸€ä¸ªjava interfaceï¼‰ï¼Œå› ä¸ºå…¶å®ç°ä½“æ˜¯ç”±éjavaè¯­è¨€åœ¨å¤–é¢å®ç°çš„ã€‚ä¸‹é¢ç»™äº†ä¸€ä¸ªç¤ºä¾‹ï¼š public class IHaveNatives { native public void Native1( int x ) ; native static public long Native2() ; native synchronized private float Native3( Object o ) ; native void Native4( int[] ary ) throws Exception ; } è¿™äº›æ–¹æ³•çš„å£°æ˜æè¿°äº†ä¸€äº›éjavaè¯­éŸ³å£°æ˜çš„æ–¹æ³•åœ¨javaä»£ç é‡Œçœ‹èµ·æ¥åƒä»€ä¹ˆæ ·å­ã€‚ æ ‡è¯†ç¬¦nativeå¯ä»¥ä¸æ‰€æœ‰å…¶å®ƒçš„javaæ ‡è¯†ç¬¦è¿ç”¨ï¼Œä½†æ˜¯abstracté™¤å¤–ã€‚è¿™æ˜¯åˆç†çš„ï¼Œå› ä¸ºnativeæš—ç¤ºè¿™äº›æ–¹æ³•æ˜¯æœ‰å®ç°ä½“çš„ï¼Œåªä¸è¿‡è¿™äº›å®ç°ä½“æ˜¯éjavaçš„ï¼Œä½†æ˜¯abstractå´æ˜¾ç„¶çš„æŒ‡æ˜è¿™äº›æ–¹æ³•æ— å®ç°ä½“ã€‚nativeä¸å…¶å®ƒjavaæ ‡è¯†ç¬¦è¿ç”¨æ—¶ï¼Œå…¶æ„ä¹‰åŒéæœ¬åœ°æ–¹æ³•å¹¶æ— å·®åˆ«ï¼Œæ¯”å¦‚native staticè¡¨æ˜è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸äº§ç”Ÿç±»çš„å®ä¾‹æ—¶ç›´æ¥è°ƒç”¨ï¼Œè¿™éå¸¸æ–¹ä¾¿ï¼Œæ¯”å¦‚å½“ä½ æƒ³ç”¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•å»è°ƒç”¨ä¸€ä¸ªCçš„ç±»åº“æ—¶ã€‚ä¸Šé¢çš„ç¬¬ä¸‰ä¸ªæ–¹æ³•ç”¨åˆ°äº†native synchronizedï¼ŒJVMåœ¨è¿›å…¥è¿™ä¸ªæ–¹æ³•çš„å®ç°ä½“ä¹‹å‰ä¼šæ‰§è¡ŒåŒæ­¥é”æœºåˆ¶ï¼ˆå°±åƒjavaçš„å¤šçº¿ç¨‹ï¼‰ã€‚ ä¸€ä¸ªæœ¬åœ°æ–¹æ³•å¯ä»¥è¿”å›ä»»ä½•javaç±»å‹ï¼ŒåŒ…æ‹¬éåŸºæœ¬ç±»å‹ï¼Œè€Œä¸”åŒæ ·å¯ä»¥è¿›è¡Œå¼‚å¸¸æ§åˆ¶ã€‚è¿™äº›æ–¹æ³•çš„å®ç°ä½“å¯ä»¥åˆ¶ä¸€ä¸ªå¼‚å¸¸å¹¶ä¸”å°†å…¶æŠ›å‡ºï¼Œè¿™ä¸€ç‚¹ä¸javaçš„æ–¹æ³•éå¸¸ç›¸ä¼¼ã€‚å½“ä¸€ä¸ªæœ¬åœ°æ–¹æ³•æ¥æ”¶åˆ°ä¸€äº›éåŸºæœ¬ç±»å‹æ—¶å¦‚Objectæˆ–ä¸€ä¸ªæ•´å‹æ•°ç»„æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è®¿é—®è¿™éäº›åŸºæœ¬å‹çš„å†…éƒ¨ï¼Œä½†æ˜¯è¿™å°†ä½¿è¿™ä¸ªnativeæ–¹æ³•ä¾èµ–äºä½ æ‰€è®¿é—®çš„javaç±»çš„å®ç°ã€‚æœ‰ä¸€ç‚¹è¦ç‰¢ç‰¢è®°ä½ï¼šæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•çš„æœ¬åœ°å®ç°ä¸­è®¿é—®æ‰€æœ‰çš„javaç‰¹æ€§ï¼Œä½†æ˜¯è¿™è¦ä¾èµ–äºä½ æ‰€è®¿é—®çš„javaç‰¹æ€§çš„å®ç°ï¼Œè€Œä¸”è¿™æ ·åšè¿œè¿œä¸å¦‚åœ¨javaè¯­è¨€ä¸­ä½¿ç”¨é‚£äº›ç‰¹æ€§æ–¹ä¾¿å’Œå®¹æ˜“ã€‚ æœ¬åœ°æ–¹æ³•çš„å­˜åœ¨å¹¶ä¸ä¼šå¯¹å…¶ä»–ç±»è°ƒç”¨è¿™äº›æœ¬åœ°æ–¹æ³•äº§ç”Ÿä»»ä½•å½±å“ï¼Œå®é™…ä¸Šè°ƒç”¨è¿™äº›æ–¹æ³•çš„å…¶ä»–ç±»ç”šè‡³ä¸çŸ¥é“å®ƒæ‰€è°ƒç”¨çš„æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ã€‚JVMå°†æ§åˆ¶è°ƒç”¨æœ¬åœ°æ–¹æ³•çš„æ‰€æœ‰ç»†èŠ‚ã€‚éœ€è¦æ³¨æ„å½“æˆ‘ä»¬å°†ä¸€ä¸ªæœ¬åœ°æ–¹æ³•å£°æ˜ä¸ºfinalçš„æƒ…å†µã€‚ç”¨javaå®ç°çš„æ–¹æ³•ä½“åœ¨è¢«ç¼–è¯‘æ—¶å¯èƒ½ä¼šå› ä¸ºå†…è”è€Œäº§ç”Ÿæ•ˆç‡ä¸Šçš„æå‡ã€‚ä½†æ˜¯ä¸€ä¸ªnative finalæ–¹æ³•æ˜¯å¦ä¹Ÿèƒ½è·å¾—è¿™æ ·çš„å¥½å¤„å´æ˜¯å€¼å¾—æ€€ç–‘çš„ï¼Œä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªä»£ç ä¼˜åŒ–æ–¹é¢çš„é—®é¢˜ï¼Œå¯¹åŠŸèƒ½å®ç°æ²¡æœ‰å½±å“ã€‚ å¦‚æœä¸€ä¸ªå«æœ‰æœ¬åœ°æ–¹æ³•çš„ç±»è¢«ç»§æ‰¿ï¼Œå­ç±»ä¼šç»§æ‰¿è¿™ä¸ªæœ¬åœ°æ–¹æ³•å¹¶ä¸”å¯ä»¥ç”¨javaè¯­è¨€é‡å†™è¿™ä¸ªæ–¹æ³•ï¼ˆè¿™ä¸ªä¼¼ä¹çœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªï¼‰ï¼ŒåŒæ ·çš„å¦‚æœä¸€ä¸ªæœ¬åœ°æ–¹æ³•è¢«fianlæ ‡è¯†ï¼Œå®ƒè¢«ç»§æ‰¿åä¸èƒ½è¢«é‡å†™ã€‚ æœ¬åœ°æ–¹æ³•éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæœ‰æ•ˆåœ°æ‰©å……äº†jvm.äº‹å®ä¸Šï¼Œæˆ‘ä»¬æ‰€å†™çš„javaä»£ç å·²ç»ç”¨åˆ°äº†æœ¬åœ°æ–¹æ³•ï¼Œåœ¨sunçš„javaçš„å¹¶å‘ï¼ˆå¤šçº¿ç¨‹ï¼‰çš„æœºåˆ¶å®ç°ä¸­ï¼Œè®¸å¤šä¸æ“ä½œç³»ç»Ÿçš„æ¥è§¦ç‚¹éƒ½ç”¨åˆ°äº†æœ¬åœ°æ–¹æ³•ï¼Œè¿™ä½¿å¾—javaç¨‹åºèƒ½å¤Ÿè¶…è¶Šjavaè¿è¡Œæ—¶çš„ç•Œé™ã€‚æœ‰äº†æœ¬åœ°æ–¹æ³•ï¼Œjavaç¨‹åºå¯ä»¥åšä»»ä½•åº”ç”¨å±‚æ¬¡çš„ä»»åŠ¡ã€‚ äºŒ.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æœ¬åœ°æ–¹æ³•javaä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œç„¶è€Œæœ‰äº›å±‚æ¬¡çš„ä»»åŠ¡ç”¨javaå®ç°èµ·æ¥ä¸å®¹æ˜“ï¼Œæˆ–è€…æˆ‘ä»¬å¯¹ç¨‹åºçš„æ•ˆç‡å¾ˆåœ¨æ„æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ã€‚ ä¸javaç¯å¢ƒå¤–äº¤äº’æœ‰æ—¶javaåº”ç”¨éœ€è¦ä¸javaå¤–é¢çš„ç¯å¢ƒäº¤äº’ã€‚è¿™æ˜¯æœ¬åœ°æ–¹æ³•å­˜åœ¨çš„ä¸»è¦åŸå› ï¼Œä½ å¯ä»¥æƒ³æƒ³javaéœ€è¦ä¸ä¸€äº›åº•å±‚ç³»ç»Ÿå¦‚æ“ä½œç³»ç»Ÿæˆ–æŸäº›ç¡¬ä»¶äº¤æ¢ä¿¡æ¯æ—¶çš„æƒ…å†µã€‚æœ¬åœ°æ–¹æ³•æ­£æ˜¯è¿™æ ·ä¸€ç§äº¤æµæœºåˆ¶ï¼šå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸ç®€æ´çš„æ¥å£ï¼Œè€Œä¸”æˆ‘ä»¬æ— éœ€å»äº†è§£javaåº”ç”¨ä¹‹å¤–çš„ç¹ççš„ç»†èŠ‚ã€‚ ä¸æ“ä½œç³»ç»Ÿäº¤äº’JVMæ”¯æŒç€javaè¯­è¨€æœ¬èº«å’Œè¿è¡Œæ—¶åº“ï¼Œå®ƒæ˜¯javaç¨‹åºèµ–ä»¥ç”Ÿå­˜çš„å¹³å°ï¼Œå®ƒç”±ä¸€ä¸ªè§£é‡Šå™¨ï¼ˆè§£é‡Šå­—èŠ‚ç ï¼‰å’Œä¸€äº›è¿æ¥åˆ°æœ¬åœ°ä»£ç çš„åº“ç»„æˆã€‚ç„¶è€Œä¸ç®¡æ€ æ ·ï¼Œå®ƒæ¯•ç«Ÿä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿï¼Œå®ƒç»å¸¸ä¾èµ–äºä¸€äº›åº•å±‚ï¼ˆunderneathåœ¨ä¸‹é¢çš„ï¼‰ç³»ç»Ÿçš„æ”¯æŒã€‚è¿™äº›åº•å±‚ç³»ç»Ÿå¸¸å¸¸æ˜¯å¼ºå¤§çš„æ“ä½œç³»ç»Ÿã€‚é€šè¿‡ä½¿ç”¨æœ¬åœ°æ–¹æ³•ï¼Œæˆ‘ä»¬å¾—ä»¥ç”¨javaå®ç°äº†jreçš„ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ï¼Œç”šè‡³JVMçš„ä¸€äº›éƒ¨åˆ†å°±æ˜¯ç”¨Cå†™çš„ï¼Œè¿˜æœ‰ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ä¸€äº›javaè¯­è¨€æœ¬èº«æ²¡æœ‰æä¾›å°è£…çš„æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚ Sunâ€™s JavaSunçš„è§£é‡Šå™¨æ˜¯ç”¨Cå®ç°çš„ï¼Œè¿™ä½¿å¾—å®ƒèƒ½åƒä¸€äº›æ™®é€šçš„Cä¸€æ ·ä¸å¤–éƒ¨äº¤äº’ã€‚jreå¤§éƒ¨åˆ†æ˜¯ç”¨javaå®ç°çš„ï¼Œå®ƒä¹Ÿé€šè¿‡ä¸€äº›æœ¬åœ°æ–¹æ³•ä¸å¤–ç•Œäº¤äº’ã€‚ä¾‹å¦‚ï¼šç±»java.lang.Thread çš„ setPriority()æ–¹æ³•æ˜¯ç”¨javaå®ç°çš„ï¼Œä½†æ˜¯å®ƒå®ç°è°ƒç”¨çš„æ˜¯è¯¥ç±»é‡Œçš„æœ¬åœ°æ–¹æ³•setPriority0()ã€‚è¿™ä¸ªæœ¬åœ°æ–¹æ³•æ˜¯ç”¨Cå®ç°çš„ï¼Œå¹¶è¢«æ¤å…¥JVMå†…éƒ¨ï¼Œåœ¨Windows 95çš„å¹³å°ä¸Šï¼Œè¿™ä¸ªæœ¬åœ°æ–¹æ³•æœ€ç»ˆå°†è°ƒç”¨Win32 SetPriority() APIã€‚è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•çš„å…·ä½“å®ç°ç”±JVMç›´æ¥æä¾›ï¼Œæ›´å¤šçš„æƒ…å†µæ˜¯æœ¬åœ°æ–¹æ³•ç”±å¤–éƒ¨çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆexternal dynamic link libraryï¼‰æä¾›ï¼Œç„¶åè¢«JVMè°ƒç”¨ã€‚ ä¸‰.JVMæ€æ ·ä½¿æœ¬åœ°æ–¹æ³•è·‘èµ·æ¥æˆ‘ä»¬çŸ¥é“ï¼Œå½“ä¸€ä¸ªç±»ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨åˆ°æ—¶ï¼Œè¿™ä¸ªç±»çš„å­—èŠ‚ç ä¼šè¢«åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶ä¸”åªä¼šåŠ è½½ä¸€æ¬¡ã€‚åœ¨è¿™ä¸ªè¢«åŠ è½½çš„å­—èŠ‚ç çš„å…¥å£ç»´æŒç€ä¸€ä¸ªè¯¥ç±»æ‰€æœ‰æ–¹æ³•æè¿°ç¬¦çš„listï¼Œè¿™äº›æ–¹æ³•æè¿°ç¬¦åŒ…å«è¿™æ ·ä¸€äº›ä¿¡æ¯ï¼šæ–¹æ³•ä»£ç å­˜äºä½•å¤„ï¼Œå®ƒæœ‰å“ªäº›å‚æ•°ï¼Œæ–¹æ³•çš„æè¿°ç¬¦ï¼ˆpublicä¹‹ç±»ï¼‰ç­‰ç­‰ã€‚ å¦‚æœä¸€ä¸ªæ–¹æ³•æè¿°ç¬¦å†…æœ‰nativeï¼Œè¿™ä¸ªæè¿°ç¬¦å—å°†æœ‰ä¸€ä¸ªæŒ‡å‘è¯¥æ–¹æ³•çš„å®ç°çš„æŒ‡é’ˆã€‚è¿™äº›å®ç°åœ¨ä¸€äº›DLLæ–‡ä»¶å†…ï¼Œä½†æ˜¯å®ƒä»¬ä¼šè¢«æ“ä½œç³»ç»ŸåŠ è½½åˆ°javaç¨‹åºçš„åœ°å€ç©ºé—´ã€‚å½“ä¸€ä¸ªå¸¦æœ‰æœ¬åœ°æ–¹æ³•çš„ç±»è¢«åŠ è½½æ—¶ï¼Œå…¶ç›¸å…³çš„DLLå¹¶æœªè¢«åŠ è½½ï¼Œå› æ­¤æŒ‡å‘æ–¹æ³•å®ç°çš„æŒ‡é’ˆå¹¶ä¸ä¼šè¢«è®¾ç½®ã€‚å½“æœ¬åœ°æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰ï¼Œè¿™äº›DLLæ‰ä¼šè¢«åŠ è½½ï¼Œè¿™æ˜¯é€šè¿‡è°ƒç”¨java.system.loadLibrary()å®ç°çš„ã€‚ æœ€åéœ€è¦æç¤ºçš„æ˜¯ï¼Œä½¿ç”¨æœ¬åœ°æ–¹æ³•æ˜¯æœ‰å¼€é”€çš„ï¼Œå®ƒä¸§å¤±äº†javaçš„å¾ˆå¤šå¥½å¤„ã€‚å¦‚æœåˆ«æ— é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,æœ¬åœ°æ–¹æ³•,native","slug":"Java-æœ¬åœ°æ–¹æ³•-native","permalink":"/tags/Java-æœ¬åœ°æ–¹æ³•-native/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸€ï¼‰","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸€ï¼‰","date":"2020-06-06T09:05:10.000Z","updated":"2023-04-30T10:21:41.344Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸€ï¼‰/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸€ï¼‰/","excerpt":"","text":"åœ¨Javaé¡¹ç›®ä¸­éœ€è¦å¯¹æ–‡ä»¶å¤¹çš„å†…å®¹è¿›è¡ŒZipå‹ç¼©ï¼Œå‚è€ƒäº†ç½‘ä¸Šçš„ä»£ç å¹¶ä¿®å¤äº†é‡Œé¢çš„ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼šä¸­æ–‡ä¹±ç ã€åª’ä½“æ–‡ä»¶è§£å‹åæŸåã€‚ æ‰€ä½¿ç”¨çš„JaråŒ…ï¼šant-*.*.*.jar å’Œ log4j-*.*.*.jar ã€‚ ZipUtilå·¥å…·ç±»æºç import java.io.BufferedInputStream; import java.io.BufferedOutputStream; import java.io.File; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.IOException; import java.io.InputStream; import java.io.OutputStream; import java.util.ArrayList; import java.util.Enumeration; import java.util.List; import org.apache.log4j.Logger; import org.apache.tools.zip.ZipEntry; import org.apache.tools.zip.ZipFile; import org.apache.tools.zip.ZipOutputStream; /* * ZIPå‹ç¼©å·¥å…·ç±» */ public class ZipUtil { private static final Logger logger = Logger.getLogger(ZipUtil.class); /** * æ‰“åŒ…æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹ * * @param sourceFolder * è¦æ‰“åŒ…çš„æ–‡ä»¶ç›®å½• * @param targetFolder * ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶å­˜æ”¾ç›®å½• * @param zipFileName * ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶å * @param encoding * å‹ç¼©æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ * @throws IOException */ public static void zipFolder(String sourceFolder, String targetFolder, String zipFileName, String encoding) { if (isEmptyStr(sourceFolder) || isEmptyStr(targetFolder) || isEmptyStr(zipFileName)) { logger.error(&quot;invalid compress parameters...&quot;); return; } sourceFolder = formatFilePath(sourceFolder); targetFolder = formatFilePath(targetFolder); List&lt;String&gt; fileList = generatefileList(sourceFolder); zipfileList(fileList, sourceFolder, targetFolder, zipFileName, encoding); } /** * æ‰“åŒ…æŒ‡å®šçš„æ–‡ä»¶ã€‚è¦æ‰“åŒ…çš„æ–‡ä»¶åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­æŒ‡å®š * * @param fileList * è¦æ‰“åŒ…çš„æ–‡ä»¶åˆ—è¡¨ï¼Œè¿™äº›æ–‡ä»¶æ˜¯ç›¸å¯¹è·¯å¾„ * @param sourceFolder * è¦æ‰“åŒ…çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„ * @param targetFolder * ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶å­˜æ”¾çš„ç›®å½• * @param zipFileName * ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶å * @param encoding * å‹ç¼©æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ * @throws IOException */ public static void zipfileList(List&lt;String&gt; fileList, String sourceFolder, String targetFolder, String zipFileName, String encoding) { if (fileList == null || fileList.isEmpty()) { logger.error(&quot;no files to be zip. fileList is null or empty...&quot;); return; } if (isEmptyStr(targetFolder) || isEmptyStr(zipFileName)) { logger.error(&quot;targetFolder and zipFileName are unspecified...&quot;); return; } sourceFolder = formatFilePath(sourceFolder); targetFolder = formatFilePath(targetFolder); if (isEmptyStr(encoding)) { encoding = &quot;UTF-8&quot;; } File outputDir = new File(targetFolder); if (!outputDir.exists()) { outputDir.mkdirs(); } byte[] buffer = new byte[1024 * 1024]; String outputFullFileName = (targetFolder + &quot;/&quot; + zipFileName); ZipOutputStream zos = null; try { zos = new ZipOutputStream(new FileOutputStream(outputFullFileName)); zos.setEncoding(encoding); logger.info(&quot;Output to Zip : &quot; + outputFullFileName); for (String file : fileList) { if (isEmptyStr(file)) { continue; } logger.info(&quot;File Added : &quot; + file); ZipEntry ze = new ZipEntry(file); // è¿™é‡Œç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ zos.putNextEntry(ze); FileInputStream in = new FileInputStream(sourceFolder + &quot;/&quot; + file); // è¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ int len; while ((len = in.read(buffer)) &gt; 0) { zos.write(buffer, 0, len); } in.close(); } zos.closeEntry(); logger.info(&quot;Compress Done!!!&quot;); } catch (IOException e) { logger.error(&quot;Compress Wrong!!!&quot;); } finally { // remember close it if (null != zos) { try { zos.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } /** * è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼ŒåŒ…å«å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œå¿½ç•¥ç©ºæ–‡ä»¶å¤¹ * * @param fileFolder * æ–‡ä»¶æˆ–ç›®å½• * @return ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ */ public static List&lt;String&gt; generatefileList(String fileFolder) { List&lt;String&gt; fileList = null; if (!isEmptyStr(fileFolder)) { fileFolder = formatFilePath(fileFolder); fileList = new ArrayList&lt;String&gt;(); File node = new File(fileFolder); generateFileListHelper(fileFolder, node, fileList); } return fileList; } private static void generateFileListHelper(String sourceFolder, File node, List&lt;String&gt; fileList) { // add file only if (node.isFile()) { String absoluteFile = node.getAbsoluteFile().toString(); String filepath = generateZipEntry(sourceFolder, absoluteFile); fileList.add(filepath); } if (node.isDirectory()) { String[] subNodes = node.list(); for (String subNode : subNodes) { File subFile = new File(node, subNode); generateFileListHelper(sourceFolder, subFile, fileList); } } } /** * æ ¼å¼åŒ–è¢«å‹ç¼©æ–‡ä»¶çš„è·¯å¾„,åˆ é™¤æ–‡ä»¶çš„sourceFolderè·¯å¾„ ä¾‹å¦‚ï¼š d:\\ziptest\\tmpty.txt --&gt; tmpty.txt * d:\\ziptest\\sub\\t.xls --&gt; sub\\t.xls * * @param file * è¢«å‹ç¼©æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ * @return æ ¼å¼åŒ–åçš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œæ˜¯ä¸sourceFolderçš„ç›¸å¯¹è·¯å¾„ */ private static String generateZipEntry(String sourceFolder, String file) { logger.debug(&quot;sourceFolder=&quot; + sourceFolder); logger.debug(&quot;file=&quot; + file); String formattedPath = file.substring(sourceFolder.length() + 1); formattedPath = formatFilePath(formattedPath); logger.debug(&quot;formattedPath=&quot; + formattedPath); return formattedPath; } /** * å°†æ–‡ä»¶è·¯å¾„ä¸­çš„åˆ†éš”ç¬¦&quot;\\&quot;è½¬æ¢æˆ&quot;/&quot;,å¹¶å»æ‰æœ€åçš„åˆ†éš”ç¬¦ï¼ˆå¦‚æœæœ‰ï¼‰ * * @param filePath * æ–‡ä»¶è·¯å¾„ * @return æ ¼å¼åŒ–åçš„æ–‡ä»¶è·¯å¾„ */ public static String formatFilePath(String filePath) { if (filePath != null &amp;&amp; filePath.length() != 0) { filePath = filePath.replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;); } if (filePath.endsWith(&quot;/&quot;)) { filePath = filePath.substring(0, filePath.length() - 1); } return filePath; } private static boolean isEmptyStr(String str) { return str == null || str.length() == 0; } /** * è§£å‹zipæ–‡ä»¶ï¼Œæ”¯æŒå­æ–‡ä»¶å¤¹å’Œä¸­æ–‡ * * @param zipFileFullName * è¦è§£å‹çš„zipæ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ * @param targetFolder * è§£å‹åˆ°æŒ‡å®šç›®å½•ã€‚è¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ï¼Œä¸ºç©ºåˆ™é»˜è®¤è§£å‹åˆ°å‹ç¼©æ–‡ä»¶æ‰€åœ¨ç›®å½• * @param encoding * è§£å‹æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ */ @SuppressWarnings(&quot;rawtypes&quot;) public static void unzip(String zipFileFullName, String targetFolder, String encoding) { if (zipFileFullName == null || zipFileFullName.length() == 0) { return; } if (!zipFileFullName.endsWith(&quot;.zip&quot;)) { logger.error(zipFileFullName + &quot; is not a zip file...&quot;); return; } if (isEmptyStr(encoding)) { encoding = &quot;UTF-8&quot;; } // å°†æ–‡ä»¶è·¯å¾„ä¸­çš„åˆ†éš”ç¬¦&quot;\\&quot;è½¬æ¢æˆ&quot;/&quot; zipFileFullName = zipFileFullName.replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;); // è·å–å‹ç¼©æ–‡ä»¶æ‰€åœ¨ç›®å½• String zipFolder = zipFileFullName.replaceAll(&quot;/[^/]+\\\\.zip&quot;, &quot;&quot;); if (targetFolder == null || targetFolder.length() == 0) { targetFolder = zipFolder; } targetFolder = targetFolder.replaceAll(&quot;\\\\\\\\&quot;, &quot;/&quot;); File targetFolderFile = new File(targetFolder); if (!targetFolderFile.exists()) { targetFolderFile.mkdirs(); } OutputStream outStream = null; InputStream inStream = null; try { ZipFile zip = new ZipFile(zipFileFullName, encoding); Enumeration zipFileEntries = zip.getEntries(); while (zipFileEntries.hasMoreElements()) { ZipEntry entry = (ZipEntry) zipFileEntries.nextElement(); String entryName = entry.getName(); logger.debug(&quot;Extracting,entryName=&quot; + entryName); int lastSlashPos = entryName.lastIndexOf(&quot;/&quot;); /* * ç”¨æœ¬ç¨‹åºä¸­ZipUtil.zipFolderæˆ–è€…ZipUtil.zipfileListç”Ÿæˆçš„zipæ–‡ä»¶ï¼Œ * å¦‚æœæœ‰å­æ–‡ä»¶å¤¹ï¼Œentry.getName()ä¼šç›´æ¥å¾—åˆ°å­æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶è€Œç•¥è¿‡å­æ–‡ä»¶å¤¹ * æ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆç”Ÿæˆæ–‡ä»¶æ‰€åœ¨çš„å„çº§å­æ–‡ä»¶å¤¹ç›®å½• */ if (lastSlashPos != -1) { String folderStr = targetFolder + &quot;/&quot; + entryName.substring(0, lastSlashPos); File folder = new File(folderStr); if (!folder.exists()) { folder.mkdirs(); } } if (!entryName.endsWith(&quot;/&quot;)) { File outFile = new File(targetFolder + &quot;/&quot; + entryName); outStream = new BufferedOutputStream(new FileOutputStream( outFile)); byte[] buffer = new byte[1024 * 1024]; inStream = new BufferedInputStream( zip.getInputStream(entry)); int len; while ((len = inStream.read(buffer)) &gt; 0) { outStream.write(buffer, 0, len); } outStream.flush(); } } } catch (Exception e) { logger.error(&quot;errors occur when decompressing...&quot;); e.printStackTrace(); } finally { if (null != outStream) { try { outStream.close(); } catch (IOException e) { logger.error(e.getMessage()); } } if (null != inStream) { try { inStream.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } public static void main(String[] argv) { String sourceFolder = &quot;D:\\\\sourceFolder&quot;;// è¦æ‰“åŒ…å‹ç¼©çš„æ–‡ä»¶å¤¹ String targetFolder = &quot;D:\\\\targetFolder&quot;; String outputFileName = &quot;test.zip&quot;; zipFolder(sourceFolder, targetFolder, outputFileName, &quot;GB2312&quot;); String zipFileFullName = &quot;D:\\\\targetFolder\\\\test.zip&quot;; unzip(zipFileFullName, &quot;D:\\\\test&quot;, &quot;GB2312&quot;); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Zip","slug":"Java-Zip","permalink":"/tags/Java-Zip/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸‰ï¼‰","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸‰ï¼‰","date":"2020-06-06T09:04:10.000Z","updated":"2023-04-30T10:21:41.344Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸‰ï¼‰/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆä¸‰ï¼‰/","excerpt":"","text":"åœ¨Javaé¡¹ç›®ä¸­éœ€è¦å¯¹æ–‡ä»¶å¤¹çš„å†…å®¹è¿›è¡ŒZipå‹ç¼©ï¼Œå‚è€ƒäº†ç½‘ä¸Šçš„ä»£ç å¹¶ä¿®å¤äº†é‡Œé¢çš„ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼šä¸­æ–‡ä¹±ç ã€åª’ä½“æ–‡ä»¶è§£å‹åæŸåã€‚ æ‰€ä½¿ç”¨çš„JaråŒ…ï¼šant-*.*.*.jar å’Œ log4j-*.*.*.jar ã€‚ ZipUtilå·¥å…·ç±»æºç import java.io.File; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.IOException; import java.io.InputStream; import java.util.Enumeration; import org.apache.log4j.Logger; import org.apache.tools.zip.ZipEntry; import org.apache.tools.zip.ZipFile; import org.apache.tools.zip.ZipOutputStream; public class ZipUtil { private static final Logger logger = Logger.getLogger(ZipUtil.class); /** * ç”±äºå‹ç¼©æ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œæ— é¡»åˆ›å»ºå·¥å…·ç±»å®ä¾‹ï¼Œæ•…å°†æ„é€ æ–¹æ³•å£°æ˜ä¸ºç§æœ‰ */ private ZipUtil() { } /** * å‹ç¼©æ–‡ä»¶æˆ–ç›®å½• * * @param srcPath * è¦å‹ç¼©çš„æºæ–‡ä»¶æˆ–ç›®å½• * @param destPath * ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶å…¨åï¼Œè¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ * @param encoding * å‹ç¼©æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ */ public static void zip(String srcPath, String destPath, String encoding){ if (isEmptyStr(srcPath) || isEmptyStr(destPath)) { logger.error(&quot;invalid zip parameters...&quot;); return; } if (isEmptyStr(encoding)) { encoding = &quot;UTF-8&quot;; } zip(new File(srcPath), new File(destPath), encoding); } /** * å‹ç¼©æ–‡ä»¶æˆ–ç›®å½• * * @param srcFile * ç›®å½•æˆ–è€…å•ä¸ªæ–‡ä»¶ * @param destFile * å‹ç¼©åçš„ZIPæ–‡ä»¶ * @param encoding * å‹ç¼©æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ */ public static void zip(File srcFile, File destFile, String encoding) { File parentFile = destFile.getParentFile(); if (!parentFile.exists()) { parentFile.mkdirs(); } ZipOutputStream out = null; try { out = new ZipOutputStream(new FileOutputStream(destFile)); out.setEncoding(encoding); zip(srcFile, out); } catch (Exception e) { logger.error(e.getMessage()); } finally { if (null != out) { try { out.close();// è®°å¾—å…³é—­èµ„æº } catch (IOException e) { logger.error(e.getMessage()); } } } } /** * å‹ç¼©æ–‡ä»¶æˆ–ç›®å½• * * @param srcFile * ç›®å½•æˆ–è€…å•ä¸ªæ–‡ä»¶ * @param out * å‹ç¼©æ–‡ä»¶è¾“å‡ºæµ */ public static void zip(File srcFile, ZipOutputStream out) { zip(srcFile, out, &quot;&quot;); } /** * å‹ç¼©æ–‡ä»¶æˆ–ç›®å½• * * @param srcFile * ç›®å½•æˆ–è€…å•ä¸ªæ–‡ä»¶ * @param out * å‹ç¼©æ–‡ä»¶è¾“å‡ºæµ * @param curPaht * æ­£åœ¨å‹ç¼©çš„å½“å‰æ–‡ä»¶ä¸srcPathçš„ç›¸å¯¹è·¯å¾„ */ public static void zip(File srcFile, ZipOutputStream out, String curPaht) { if (srcFile.isDirectory()) { File[] files = srcFile.listFiles(); if (files != null &amp;&amp; files.length &gt; 0) { for (File file : files) { String name = srcFile.getName(); if (!&quot;&quot;.equals(curPaht)) { name = curPaht + File.separator + name; } ZipUtil.zip(file, out, name); } } } else { doZip(srcFile, out, curPaht); } } /** * å‹ç¼©æ–‡ä»¶ * * @param file * è¦å‹ç¼©çš„æ–‡ä»¶ * @param out * å‹ç¼©æ–‡ä»¶è¾“å‡ºæµ * @param curPath * æ­£åœ¨å‹ç¼©çš„å½“å‰æ–‡ä»¶ä¸srcPathçš„ç›¸å¯¹è·¯å¾„ */ public static void doZip(File file, ZipOutputStream out, String curPath) { String entryName = null; if (!&quot;&quot;.equals(curPath)) { entryName = curPath + File.separator + file.getName(); } else { entryName = file.getName(); } ZipEntry entry = new ZipEntry(entryName); FileInputStream fis = null; try { out.putNextEntry(entry); fis = new FileInputStream(file); int len = 0; byte[] buffer = new byte[1024]; while ((len = fis.read(buffer)) &gt; 0) { out.write(buffer, 0, len); out.flush(); } out.closeEntry(); } catch (IOException e) { logger.error(e.getMessage()); } finally { if (null != fis) { try { fis.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } /** * åˆ¤æ–­æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸² * * @param str * @return */ private static boolean isEmptyStr(String str) { return str == null || str.length() == 0; } /** * è§£å‹ç¼© * * @param zipFilePath * å‹ç¼©æ–‡ä»¶è·¯å¾„ * @param outputDirectory * è§£å‹ç¼©åæ–‡ä»¶å­˜æ”¾çš„ç›®å½• * @param encoding * è§£å‹ç¼©æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ */ public static void unzip(String zipFilePath, String outputDirectory,String encoding){ if (isEmptyStr(zipFilePath) || isEmptyStr(outputDirectory)) { logger.error(&quot;invalid unzip parameters...&quot;); return; } if (isEmptyStr(encoding)) { encoding = &quot;UTF-8&quot;; } ZipFile zipFile=null; try { zipFile = new ZipFile(zipFilePath, encoding); } catch (IOException e) { logger.error(e.getMessage()); } unzip(zipFile, outputDirectory,encoding); } /** * è§£å‹ç¼© * * @param zipFile * æºå‹ç¼©æ–‡ä»¶ * @param outputDirectory * è§£å‹ç¼©åæ–‡ä»¶å­˜æ”¾ç›®å½• * @param encoding * è§£å‹ç¼©æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ */ @SuppressWarnings(&quot;rawtypes&quot;) private static void unzip(ZipFile zipFile, String outputDirectory,String encoding) { File outputFile=new File(outputDirectory); if (!outputFile.exists()) { outputFile.mkdirs(); } try { Enumeration zipEntries = zipFile.getEntries(); ZipEntry zipEntry = null; while (zipEntries.hasMoreElements()) { zipEntry = (ZipEntry) zipEntries.nextElement(); String entryName = new String(zipEntry.getName().getBytes( encoding), encoding); InputStream in = null; FileOutputStream out = null; try { if (zipEntry.isDirectory()) { String name = zipEntry.getName(); name = name.substring(0, name.length() - 1); File f = new File(outputDirectory + File.separator + name); f.mkdirs(); } else { int index = entryName.lastIndexOf(&quot;\\\\&quot;); if (index != -1) { File df = new File(outputDirectory + File.separator + entryName.substring(0, index)); df.mkdirs(); } index = entryName.lastIndexOf(&quot;/&quot;); if (index != -1) { File df = new File(outputDirectory + File.separator + entryName.substring(0, index)); df.mkdirs(); } File f = new File(outputDirectory + File.separator + zipEntry.getName()); // f.createNewFile(); in = zipFile.getInputStream(zipEntry); out = new FileOutputStream(f); int len; byte[] buffer = new byte[1024 * 1024]; while ((len = in.read(buffer)) != -1) { out.write(buffer, 0, len); } out.flush(); } } catch (IOException e) { logger.error(&quot;è§£å‹å¤±è´¥...&quot;); logger.error(e.getMessage()); } finally { if (null != in) { try { in.close(); } catch (IOException e) { logger.error(e.getMessage()); } } if (null != out) { try { out.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } } catch (IOException e) { logger.error(&quot;è§£å‹å¤±è´¥...&quot;); logger.error(e.getMessage()); } finally { if (null != zipFile) { try { zipFile.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } public static void main(String[] args) { ZipUtil.zip(&quot;D:\\\\sourceFolder&quot;, &quot;D:\\\\targetFolder\\\\test.zip&quot;, &quot;GBK&quot;); ZipUtil.unzip(&quot;D:\\\\targetFolder\\\\test.zip&quot;, &quot;D:\\\\test&quot;, &quot;GBK&quot;); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Zip","slug":"Java-Zip","permalink":"/tags/Java-Zip/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆäºŒï¼‰","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆäºŒï¼‰","date":"2020-06-06T09:03:10.000Z","updated":"2023-04-30T10:21:41.344Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆäºŒï¼‰/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Zipå‹ç¼©å·¥å…·ç±»ï¼ˆäºŒï¼‰/","excerpt":"","text":"åœ¨Javaé¡¹ç›®ä¸­éœ€è¦å¯¹æ–‡ä»¶å¤¹çš„å†…å®¹è¿›è¡ŒZipå‹ç¼©ï¼Œå‚è€ƒäº†ç½‘ä¸Šçš„ä»£ç å¹¶ä¿®å¤äº†é‡Œé¢çš„ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼šä¸­æ–‡ä¹±ç ã€ç›®å½•ä¸å­˜åœ¨å¼‚å¸¸ã€‚ æ‰€ä½¿ç”¨çš„JaråŒ…ï¼šant-*.*.*.jar å’Œ log4j-*.*.*.jarã€‚ ZipUtilå·¥å…·ç±»æºç import java.io.File; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.IOException; import java.io.InputStream; import java.util.Enumeration; import org.apache.log4j.Logger; import org.apache.tools.zip.ZipEntry; import org.apache.tools.zip.ZipFile; import org.apache.tools.zip.ZipOutputStream; public class ZipUtil { private static final Logger logger = Logger.getLogger(ZipUtil.class); /** * å‹ç¼©æ–‡ä»¶æˆ–ç›®å½• * * @param src * è¦å‹ç¼©çš„æºæ–‡ä»¶æˆ–ç›®å½• * @param dest * ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶å…¨åï¼Œè¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ * @param encoding * å‹ç¼©æ—¶é‡‡ç”¨çš„ç¼–ç æ ¼å¼ * @throws IOException */ public static void zip(String src, String dest, String encoding) { ZipOutputStream out = null; if (isEmptyStr(src) || isEmptyStr(dest)) { logger.error(&quot;invalid compress parameters...&quot;); return; } if (isEmptyStr(encoding)) { encoding = &quot;UTF-8&quot;; } try { File outFile = new File(dest); File parentFile = outFile.getParentFile(); if (!parentFile.exists()) { parentFile.mkdirs(); } out = new ZipOutputStream(outFile); out.setEncoding(encoding); File fileOrDirectory = new File(src); if (fileOrDirectory.isFile()) { zipFileOrDirectory(out, fileOrDirectory, &quot;&quot;); } else { File[] entries = fileOrDirectory.listFiles(); for (int i = 0; i &lt; entries.length; i++) { // é€’å½’å‹ç¼©ï¼Œæ›´æ–°curPaths zipFileOrDirectory(out, entries[i], &quot;&quot;); } } } catch (IOException e) { logger.error(e.getMessage()); } finally { if (null != out) { try { out.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } private static boolean isEmptyStr(String str) { return str == null || str.length() == 0; } /** * é€’å½’å‹ç¼©æ–‡ä»¶æˆ–ç›®å½• * * @param out * å‹ç¼©è¾“å‡ºæµå¯¹è±¡ * @param file * è¦å‹ç¼©çš„æ–‡ä»¶æˆ–ç›®å½•å¯¹è±¡ * @param curPath * å½“å‰å‹ç¼©æ¡ç›®çš„è·¯å¾„ï¼Œç”¨äºæŒ‡å®šæ¡ç›®åç§°çš„å‰ç¼€ * @throws IOException */ private static void zipFileOrDirectory(ZipOutputStream out, File file, String curPath) { FileInputStream in = null; try { if (!file.isDirectory()) { // å‹ç¼©æ–‡ä»¶ byte[] buffer = new byte[1024 * 1024]; int len; in = new FileInputStream(file); ZipEntry entry = new ZipEntry(curPath + file.getName()); out.putNextEntry(entry); while ((len = in.read(buffer)) != -1) { out.write(buffer, 0, len); } out.closeEntry(); } else { // å‹ç¼©ç›®å½• File[] entries = file.listFiles(); for (int i = 0; i &lt; entries.length; i++) { // é€’å½’å‹ç¼©ï¼Œæ›´æ–°curPath zipFileOrDirectory(out, entries[i], curPath + file.getName() + &quot;/&quot;); } } } catch (IOException e) { logger.error(e.getMessage()); } finally { if (null != in) { try { in.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } /** * è§£å‹ç¼© * * @param zipFileName * æºæ–‡ä»¶ * @param outputDirectory * è§£å‹ç¼©åæ–‡ä»¶å­˜æ”¾çš„ç›®å½• * @throws IOException */ @SuppressWarnings({ &quot;rawtypes&quot; }) public static void unzip(String zipFileName, String outputDirectory, String encoding) { ZipFile zipFile = null; if (isEmptyStr(encoding)) { encoding = &quot;UTF-8&quot;; } try { zipFile = new ZipFile(zipFileName, encoding); Enumeration zipEntries = zipFile.getEntries(); ZipEntry zipEntry = null; File dest = new File(outputDirectory); if (!dest.exists()) { dest.mkdirs(); } while (zipEntries.hasMoreElements()) { zipEntry = (ZipEntry) zipEntries.nextElement(); String entryName = new String(zipEntry.getName().getBytes( encoding), encoding); InputStream in = null; FileOutputStream out = null; try { if (zipEntry.isDirectory()) { String name = zipEntry.getName(); name = name.substring(0, name.length() - 1); File f = new File(outputDirectory + File.separator + name); f.mkdirs(); } else { int index = entryName.lastIndexOf(&quot;\\\\&quot;); if (index != -1) { File df = new File(outputDirectory + File.separator + entryName.substring(0, index)); df.mkdirs(); } index = entryName.lastIndexOf(&quot;/&quot;); if (index != -1) { File df = new File(outputDirectory + File.separator + entryName.substring(0, index)); df.mkdirs(); } File f = new File(outputDirectory + File.separator + zipEntry.getName()); // f.createNewFile(); in = zipFile.getInputStream(zipEntry); out = new FileOutputStream(f); int len; byte[] buffer = new byte[1024 * 1024]; while ((len = in.read(buffer)) != -1) { out.write(buffer, 0, len); } out.flush(); } } catch (IOException e) { logger.error(&quot;è§£å‹å¤±è´¥...&quot;); logger.error(e.getMessage()); } finally { if (null != in) { try { in.close(); } catch (IOException e) { logger.error(e.getMessage()); } } if (null != out) { try { out.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } } catch (IOException e) { logger.error(&quot;è§£å‹å¤±è´¥...&quot;); logger.error(e.getMessage()); } finally { if (null != zipFile) { try { zipFile.close(); } catch (IOException e) { logger.error(e.getMessage()); } } } } public static void main(String[] args) { ZipUtil.zip(&quot;D:\\\\sourceFolder&quot;, &quot;D:\\\\targetFolder\\\\test.zip&quot;, &quot;GBK&quot;); ZipUtil.unzip(&quot;D:\\\\targetFolder\\\\test.zip&quot;, &quot;D:\\\\test&quot;, &quot;GBK&quot;); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Zip","slug":"Java-Zip","permalink":"/tags/Java-Zip/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--tryè¯­å¥å—ä¸­çš„returnè¯­å¥","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--tryè¯­å¥å—ä¸­çš„returnè¯­å¥","date":"2020-06-06T09:02:10.000Z","updated":"2023-04-30T10:21:41.345Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--tryè¯­å¥å—ä¸­çš„returnè¯­å¥/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--tryè¯­å¥å—ä¸­çš„returnè¯­å¥/","excerpt":"","text":"å¯¹äºåšJavaå¼€å‘çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œå¼‚å¸¸æ•è·ä¼¼ä¹å·²ç»æ˜¯å†ç¨€æ¾å¹³å¸¸ä¸è¿‡çš„äº‹æƒ…äº†ã€‚æˆ‘ä»¬éƒ½å·²ç»æ¸…æ¥šçš„äº†è§£åˆ°ï¼šåœ¨try-catch-finallyè¯­æ³•ç»“æ„ä¸­æ— è®ºå¼‚å¸¸æ˜¯å¦å‘ç”Ÿï¼Œfinallyè¯­å¥å—ä¸­çš„å†…å®¹éƒ½ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹ æƒ¯æŠŠä¸€äº›å ç”¨èµ„æºè¾ƒå¤šçš„å¯¹è±¡çš„é‡Šæ”¾æ“ä½œæ”¾åˆ°finallyè¯­å¥å—ä¸­æ¥åšï¼Œä¾‹å¦‚ï¼šå…³é—­æ•°æ®åº“è¿æ¥ã€å…³é—­æ–‡ä»¶æµã€‚ ä½†å½“try-catch-finallyè¯­å¥å—ä¸­åŒ…å«returnè¯­å¥æ—¶ï¼Œæƒ…å†µå°±ä¼šå˜å¾—å¤æ‚ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µå€¼å¾—æ³¨æ„ã€‚ æƒ…å†µä¸€ï¼štryä¸­æœ‰returnï¼Œcatchå’Œfinallyä¸­æ²¡æœ‰returnpublic class Test { public static void main(String[] args) { System.out.println(&quot;è¿”å›ç»“æœ num = &quot; + test()); } private static int test() { int num = 10; try { System.out.println(&quot;è¿›å…¥tryè¯­å¥å—&quot;); System.out.println(&quot;tryè¯­å¥å—ä¸­num = &quot; + num); return num; } catch (Exception e) { System.out.println(&quot;è¿›å…¥catchè¯­å¥å—&quot;); } finally { num += 10; System.out.println(&quot;è¿›å…¥finallyè¯­å¥å—&quot;); System.out.println(&quot;finallyè¯­å¥å—ä¸­num = &quot; + num); } return num; } } æ‰§è¡Œç»“æœï¼š è¿›å…¥tryè¯­å¥å— tryè¯­å¥å—ä¸­num = 10 è¿›å…¥finallyè¯­å¥å— finallyè¯­å¥å—ä¸­num = 20 è¿”å›ç»“æœ num = 10 ç»“æœåˆ†æï¼š ç¨‹åºå…ˆè¿›å…¥tryè¯­å¥å—ï¼Œåœ¨æ‰§è¡Œreturn num;è¯­å¥ä¹‹å‰ï¼Œå‘ç°ç¨‹åºåé¢è¿˜æœ‰finallyè¯­å¥å—ï¼Œäºæ˜¯ï¼Œå…ˆå°†è¦è¿”å›çš„å€¼num=10ç¼“å­˜èµ·æ¥ï¼Œç„¶åç¨‹åºè·³è½¬åˆ°finallyè¯­å¥å—æ‰§è¡Œï¼Œåœ¨finallyè¯­å¥å—ä¸­numå€¼è¢«ä¿®æ”¹ä¸ºäº†20ï¼Œè€Œæœ€ç»ˆè¿”å›çš„ç»“æœå´æ˜¯10ï¼Œè¿™è¯´æ˜finallyè¯­å¥å—æ‰§è¡Œå®Œæ¯•åï¼Œç¨‹åºç›´æ¥å°†ä¹‹å‰tryè¯­å¥å—ç¼“å­˜çš„å€¼è¿”å›äº†ã€‚ æƒ…å†µäºŒï¼štryå’Œfinallyä¸­éƒ½æœ‰returnpublic class Test { public static void main(String[] args) { System.out.println(&quot;è¿”å›ç»“æœ num = &quot; + test()); } private static int test() { int num = 10; try { System.out.println(&quot;è¿›å…¥tryè¯­å¥å—&quot;); System.out.println(&quot;tryè¯­å¥å—ä¸­num = &quot; + num); return num; } catch (Exception e) { System.out.println(&quot;è¿›å…¥catchè¯­å¥å—&quot;); } finally { num += 10; System.out.println(&quot;è¿›å…¥finallyè¯­å¥å—&quot;); System.out.println(&quot;finallyè¯­å¥å—ä¸­num = &quot; + num); return num; } } } æ‰§è¡Œç»“æœï¼š è¿›å…¥tryè¯­å¥å— tryè¯­å¥å—ä¸­num = 10 è¿›å…¥finallyè¯­å¥å— finallyè¯­å¥å—ä¸­num = 20 è¿”å›ç»“æœ num = 20 ç»“æœåˆ†æï¼š tryè¯­å¥å—çš„æ‰§è¡Œè¿‡ç¨‹ä¸æƒ…æ™¯ä¸€ç›¸åŒï¼Œæ‰€ä¸åŒçš„æ˜¯finallyè¯­å¥å—ä¸­çš„return num;ç›´æ¥å°†finallyè¯­å¥å—ä¸­çš„numå€¼è¿”å›äº†ã€‚ æ³¨ï¼šSUNå®˜æ–¹å¹¶ä¸æ¨èåœ¨finallyè¯­å¥å—ä¸­å†™returnè¯­å¥ï¼Œå¦åˆ™ï¼Œä¼šæç¤ºè­¦å‘Šï¼šfinally block does not complete normallyã€‚ æƒ…å†µä¸‰ï¼šå°†æƒ…æ™¯ä¸€ä¸­çš„è¿”å›å€¼ç±»å‹æ”¹ä¸ºå¼•ç”¨ç±»å‹public class Test { public static void main(String[] args) { System.out.println(&quot;è¿”å›ç»“æœNum.num = &quot; + test().num); } private static Num test() { Num num = new Num(); try { System.out.println(&quot;è¿›å…¥tryè¯­å¥å—&quot;); System.out.println(&quot;tryè¯­å¥å—ä¸­Num.num = &quot; + num.num); return num; } catch (Exception e) { System.out.println(&quot;è¿›å…¥catchè¯­å¥å—&quot;); } finally { num.num += 10; System.out.println(&quot;è¿›å…¥finallyè¯­å¥å—&quot;); System.out.println(&quot;finallyè¯­å¥å—ä¸­Num.num = &quot; + num.num); } return num; } } class Num { public int num = 10; } æ‰§è¡Œç»“æœï¼š è¿›å…¥tryè¯­å¥å— tryè¯­å¥å—ä¸­Num.num = 10 è¿›å…¥finallyè¯­å¥å— finallyè¯­å¥å—ä¸­Num.num = 20 è¿”å›ç»“æœNum.num = 20 ç»“æœåˆ†æï¼š tryè¯­å¥å—çš„æ‰§è¡Œè¿‡ç¨‹ä¸æƒ…æ™¯ä¸€ç±»ä¼¼ï¼Œåªæ˜¯æ­¤æ—¶ç¼“å­˜çš„æ˜¯ä¸€ä¸ªNumå¼•ç”¨ç±»å‹å¯¹è±¡ï¼Œfinallyè¯­å¥å—ä¸­çš„num.num += 10;ä¿®æ”¹äº†Numå¯¹è±¡çš„numå€¼ï¼Œå¹¶ä½œä¸ºæœ€ç»ˆçš„ç»“æœè¿”å›ã€‚ ç»“è®ºå½“try-catch-finallyè¯­å¥å—ä¸­åŒ…å«returnè¯­å¥æ—¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ç»“è®ºï¼š å¦‚æœfinallyä¸­æœ‰returnè¯­å¥ï¼Œfinallyä¸­çš„returnè¯­å¥ä¼šâ€è¦†ç›–â€œæ‰tryä¸­çš„returnè¯­å¥ï¼Œç›´æ¥å°†finallyä¸­çš„å€¼ä½œä¸ºç»“æœè¿”å›ã€‚ å¦‚æœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œä¹Ÿæ²¡æœ‰æ”¹å˜è¦è¿”å›çš„ç»“æœå€¼ï¼Œåˆ™æ‰§è¡Œå®Œfinallyä¸­çš„è¯­å¥åï¼Œä¼šæ¥ç€æ‰§è¡Œtryä¸­çš„returnè¯­å¥ï¼Œè¿”å›tryä¹‹å‰ä¿ç•™çš„ç»“æœå€¼ã€‚ å¦‚æœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œä½†æ˜¯æ”¹å˜äº†è¦è¿”å›çš„ç»“æœå€¼ï¼Œè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼ä¸å¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’çš„åŒºåˆ«ï¼Œåˆ†ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š å¦‚æœè¿”å›å€¼æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–å­—ç¬¦ä¸²ï¼Œtryä¸­çš„returnè¯­å¥ä¾ç„¶ä¼šè¿”å›è¿›å…¥finallyå—ä¹‹å‰ä¿ç•™çš„ç»“æœå€¼ã€‚ å¦‚æœè¿”å›å€¼æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œtryä¸­çš„returnè¯­å¥è¿”å›çš„å°±æ˜¯åœ¨finallyä¸­æ”¹å˜åçš„è¯¥å¯¹è±¡çš„å€¼ã€‚ å‚è€ƒæ–‡ç« http://blog.sina.com.cn/s/blog_6aefe42501018wmw.html http://blog.csdn.net/ns_code/article/details/17485221","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Stack","slug":"Java-Stack","permalink":"/tags/Java-Stack/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Thread","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Thread","date":"2020-06-06T09:01:10.000Z","updated":"2023-04-30T10:21:41.344Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Thread/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Thread/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿçº¿ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºçš„å¤šä¸ªæ‰§è¡Œè·¯å¾„ï¼Œæ‰§è¡Œè°ƒåº¦çš„å•ä½ï¼Œä¾æ‰˜äºè¿›ç¨‹è€Œå­˜åœ¨ã€‚ çº¿ç¨‹ä¸ä»…å¯ä»¥å…±äº«è¿›ç¨‹çš„å†…å­˜ï¼Œè€Œä¸”è¿˜æ‹¥æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œè¿™æ®µå†…å­˜ç©ºé—´ä¹Ÿå«åšçº¿ç¨‹æ ˆï¼Œæ˜¯åœ¨å»ºç«‹çº¿ç¨‹æ—¶ç”±ç³»ç»Ÿåˆ†é…çš„ï¼Œä¸»è¦ç”¨æ¥ä¿å­˜çº¿ç¨‹å†…éƒ¨æ‰€ä½¿ç”¨çš„æ•°æ®ï¼Œå¦‚çº¿ç¨‹æ‰§è¡Œå‡½æ•°ä¸­æ‰€å®šä¹‰çš„å˜é‡ã€‚ æ³¨æ„ï¼šJavaä¸­çš„å¤šçº¿ç¨‹æ˜¯ä¸€ç§æŠ¢å æœºåˆ¶è€Œä¸æ˜¯åˆ†æ—¶æœºåˆ¶ã€‚æŠ¢å æœºåˆ¶æŒ‡çš„æ˜¯æœ‰å¤šä¸ªçº¿ç¨‹å¤„äºå¯è¿è¡ŒçŠ¶æ€ï¼Œä½†æ˜¯åªå…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œä»–ä»¬é€šè¿‡ç«äº‰çš„æ–¹å¼æŠ¢å CPUã€‚ äºŒã€çº¿ç¨‹çš„åˆ›å»ºåœ¨Javaä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä¹‰çº¿ç¨‹ï¼š ç»§æ‰¿java.lang.Threadç±» ã€‚ å®ç°java.lang.Runnableæ¥å£ã€‚ ç»§æ‰¿java.lang.Threadç±»/** * é€šè¿‡ç»§æ‰¿java.lang.Threadç±»æ¥å®šä¹‰çº¿ç¨‹ */ public class MyThread extends Thread { private boolean flag = true; public MyThread(String threadName) { super(threadName); } @Override public void run() { while (flag) { System.out.println(Thread.currentThread().getName() + &quot; Is Running...&quot;); } } public void shutDown() { this.flag = false; } public static void main(String[] args) throws InterruptedException { MyThread myThread = new MyThread(&quot;MyThread&quot;); myThread.start(); Thread.sleep(1000); myThread.shutDown(); } } å®ç°java.lang.Runnableæ¥å£/** * é€šè¿‡å®ç°Runnableæ¥å£æ¥å®šä¹‰çº¿ç¨‹ */ public class MyThread implements Runnable { private boolean flag = true; @Override public void run() { while (flag) { System.out.println(Thread.currentThread().getName() + &quot; Is Running...&quot;); } } public void shutDown() { this.flag = false; } public static void main(String[] args) throws InterruptedException { MyThread myThread = new MyThread(); Thread thread = new Thread(myThread, &quot;MyThread&quot;); thread.start(); Thread.sleep(1000); myThread.shutDown(); } } åœ¨çº¿ç¨‹çš„start()æ–¹æ³•è¢«è°ƒç”¨åï¼ŒJVMä¼šè‡ªåŠ¨è°ƒç”¨çº¿ç¨‹çš„run()æ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ã€‚start()æ–¹æ³•ç»“æŸï¼Œçº¿ç¨‹ä¹Ÿå°±ç»ˆæ­¢äº†ã€‚ æ³¨æ„ï¼šæ¨èä½¿ç”¨å®ç°Runnableæ¥å£çš„æ–¹å¼æ¥å®šä¹‰çº¿ç¨‹ï¼Œå› ä¸ºJavaä¸­çš„ç±»åªæ”¯æŒå•ç»§æ‰¿ï¼Œä½ ä¸€æ—¦ç»§æ‰¿äº†Threadç±»å°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–çš„ç±»äº†ï¼Œä¼šå¤§å¤§é™ä½ç¨‹åºçš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚ ä¸‰ã€çº¿ç¨‹çš„çŠ¶æ€ å››ã€çº¿ç¨‹çš„åŸºæœ¬æ–¹æ³•å’Œå±æ€§1ï¼‰ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§(ç”¨1-10çš„æ•´æ•°è¡¨ç¤º,é»˜è®¤ä¼˜å…ˆçº§æ˜¯5ï¼Œé«˜ä¼˜å…ˆçº§çº¿ç¨‹çš„æ‰§è¡Œä¼˜å…ˆäºä½ä¼˜å…ˆçº§çº¿ç¨‹ã€‚é»˜è®¤ä¸€ä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§å’Œåˆ›å»ºä»–çš„çº¿ç¨‹ä¼˜å…ˆçº§ç›¸åŒã€‚ ä»¥ä¸‹æ˜¯Threadå®šä¹‰çš„ä¸‰ä¸ªä¸ä¼˜å…ˆçº§ç›¸å…³çš„é™æ€å¸¸é‡ï¼š MAX_PRIORITY =10NORM_PRIORITY =5MIN_PRIORITY=1 2ï¼‰Thread.sleepä½¿å½“å‰çº¿ç¨‹ä¼‘çœ ï¼ˆæš‚åœæ‰§è¡Œï¼‰millisæ¯«ç§’çš„æ—¶é—´ï¼ˆmillisæŒ‡å®šçš„ä¼‘çœ æ—¶é—´æ˜¯å…¶æœ€å°çš„ä¸æ‰§è¡Œæ—¶é—´ï¼Œå› ä¸ºåœ¨sleep()ä¼‘çœ æ—¶é—´æœŸæ»¡åï¼Œè¯¥çº¿ç¨‹ä¸ä¸€å®šä¼šç«‹å³æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºå…¶å®ƒçº¿ç¨‹å¯èƒ½æ­£åœ¨è¿è¡Œè€Œä¸”æ²¡æœ‰è¢«è°ƒåº¦ä¸ºæ”¾å¼ƒæ‰§è¡Œï¼Œé™¤éæ­¤çº¿ç¨‹å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼‰ï¼›sleep()æ˜¯Threadç±»çš„static(é™æ€)çš„æ–¹æ³•ï¼›å› æ­¤ä»–ä¸èƒ½æ”¹å˜å¯¹è±¡çš„æœºé”ï¼Œæ‰€ä»¥å½“åœ¨ä¸€ä¸ªSynchronizedå—ä¸­è°ƒç”¨sleep()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹è™½ç„¶ä¼‘çœ äº†ï¼Œä½†æ˜¯å¯¹è±¡çš„æœºé”å¹¶æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼ˆå³ä½¿ç¡ç€ä¹ŸæŒæœ‰å¯¹è±¡é”ï¼‰ã€‚ ä½œç”¨ï¼šä¿æŒå¯¹è±¡é”ï¼Œè®©å‡ºCPUï¼Œè°ƒç”¨ç›®çš„æ˜¯ä¸è®©å½“å‰çº¿ç¨‹ç‹¬è‡ªéœ¸å è¯¥è¿›ç¨‹æ‰€è·å–çš„CPUèµ„æºï¼Œä»¥ç•™ä¸€å®šçš„æ‰§è¡Œæœºä¼šç»™å…¶ä»–çº¿ç¨‹ï¼› 3ï¼‰Thread.yield()è®©å‡ºCPUçš„ä½¿ç”¨æƒï¼Œè®©å…¶ä»–åŒç­‰ä¼˜å…ˆçº§æˆ–æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹å¯ä»¥è·å–åˆ°è¿è¡Œæœºä¼šï¼Œçº¿ç¨‹yield()æ—¶ä¹Ÿä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚ sleep()å’Œyield()çš„åŒºåˆ«ï¼š sleep()æ–¹æ³•ä¼šç»™å…¶ä»–çº¿ç¨‹è¿è¡Œçš„æœºä¼šï¼Œè€Œä¸è€ƒè™‘å…¶ä»–çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå› æ­¤ä¼šç»™è¾ƒä½ä¼˜å…ˆçº§çº¿ç¨‹ä¸€ä¸ªè¿è¡Œçš„æœºä¼šï¼›yield()æ–¹æ³•åªä¼šç»™ç›¸åŒä¼˜å…ˆçº§æˆ–è€…æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¸€ä¸ªè¿è¡Œçš„æœºä¼šã€‚ å½“çº¿ç¨‹æ‰§è¡Œäº†sleep(long millis)æ–¹æ³•åï¼Œå°†è½¬åˆ°é˜»å¡çŠ¶æ€ï¼Œå‚æ•°millisæŒ‡å®šä¼‘çœ æ—¶é—´ï¼›å½“çº¿ç¨‹æ‰§è¡Œäº†yield()æ–¹æ³•åï¼Œå°†è½¬åˆ°å°±ç»ªçŠ¶æ€ã€‚ sleep()æ–¹æ³•å£°æ˜æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œè€Œyield()æ–¹æ³•æ²¡æœ‰å£°æ˜æŠ›å‡ºä»»ä½•å¼‚å¸¸ ã€‚ 4ï¼‰thread.join()çº¿ç¨‹åˆå¹¶ï¼Œä½¿ç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ä¼šåœ¨æ­¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åæ‰å¾€ä¸‹ç»§ç»­æ‰§è¡Œï¼Œå¯ä½¿å¼‚æ­¥çº¿ç¨‹å˜ä¸ºåŒæ­¥çº¿ç¨‹ã€‚ 5ï¼‰object.wait()wait()æ–¹æ³•æ˜¯Objectç±»é‡Œçš„æ–¹æ³•ï¼›å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°wait()æ–¹æ³•æ—¶ï¼Œå®ƒå°±è¿›å…¥åˆ°ä¸€ä¸ªå’Œè¯¥å¯¹è±¡ç›¸å…³çš„ç­‰å¾…æ± ä¸­ï¼ŒåŒæ—¶å¤±å»ï¼ˆé‡Šæ”¾ï¼‰äº†å¯¹è±¡çš„æœºé”ï¼ˆæš‚æ—¶å¤±å»æœºé”ï¼Œwait(long timeout)è¶…æ—¶æ—¶é—´åˆ°åè¿˜éœ€è¦è¿”è¿˜å¯¹è±¡é”ï¼‰ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è®¿é—®ã€‚æ‰§è¡Œwait()æ–¹æ³•çš„çº¿ç¨‹å¿…é¡»æ‹¥æœ‰å½“å‰å¯¹è±¡çš„é”ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯æ­¤é”çš„æ‹¥æœ‰è€…ï¼Œä¼šæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸,æ‰€ä»¥wait()å¿…é¡»åœ¨synchronized blockä¸­è°ƒç”¨ã€‚ wait()ä½¿ç”¨notifyæˆ–è€…notifyAlllæˆ–è€…æŒ‡å®šç¡çœ æ—¶é—´æ¥å”¤é†’å½“å‰ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹ã€‚ 6ï¼‰object.notify()å”¤é†’åœ¨å½“å‰å¯¹è±¡ç­‰å¾…æ± ä¸­ç­‰å¾…çš„ä¸€ä¸ªçº¿ç¨‹/æ‰€æœ‰çº¿ç¨‹ã€‚notify()/notifyAll()ä¹Ÿå¿…é¡»æ‹¥æœ‰ç›¸åŒå¯¹è±¡é”ï¼Œå¦åˆ™ä¹Ÿä¼šæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸ã€‚ 7ï¼‰Synchronized BlockJavaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ªå†…ç½®çš„é”ï¼Œæ¯ä¸ªSynchronized Blockæˆ–åŒæ­¥çš„æ–¹æ³•åªæœ‰æŒæœ‰è°ƒç”¨è¯¥æ–¹æ³•è¢«é”å®šå¯¹è±¡çš„é”çš„çº¿ç¨‹æ‰å¯ä»¥è®¿é—®ï¼Œå¦åˆ™æ‰€å±çº¿ç¨‹é˜»å¡ï¼›æœºé”å…·æœ‰ç‹¬å æ€§ã€ä¸€æ—¦è¢«ä¸€ä¸ªThreadæŒæœ‰ï¼Œå…¶ä»–çš„Threadå°±ä¸èƒ½å†æ‹¥æœ‰ï¼ˆä¸èƒ½è®¿é—®å…¶ä»–åŒæ­¥æ–¹æ³•ï¼‰ï¼Œæ–¹æ³•ä¸€æ—¦æ‰§è¡Œï¼Œå°±ç‹¬å è¯¥é”ï¼Œç›´åˆ°ä»è¯¥æ–¹æ³•è¿”å›æ—¶æ‰å°†é”é‡Šæ”¾ï¼Œæ­¤åè¢«é˜»å¡çš„çº¿ç¨‹æ–¹èƒ½è·å¾—è¯¥é”ï¼Œé‡æ–°è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ã€‚ äº”ã€çº¿ç¨‹èµ„æºå…±äº«ç¤ºä¾‹/** * è½¦ç«™å”®ç¥¨ç¤ºä¾‹ */ public class TicketsThread implements Runnable { // è½¦ç¥¨æ€»æ•° private Integer tickets = 100; private boolean flag = true; private Object object = new Object(); @Override public void run() { while (flag) { /* synchronized (object) { if (tickets &gt; 0) { try { Thread.sleep(100); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + &quot;å”®å‡ºç¬¬&quot; + tickets + &quot;å¼ è½¦ç¥¨&quot;); tickets--; } else { System.out.println(Thread.currentThread().getName() + &quot;æé†’å¹¿å¤§ä¹˜å®¢ï¼šè½¦ç¥¨å·²ç»å”®å®Œï¼Œåœæ­¢å”®ç¥¨ï¼&quot;); this.flag = false; } }*/ sell(); } } private synchronized void sell(){ if (tickets &gt; 0) { try { Thread.sleep(100); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + &quot;å”®å‡ºç¬¬&quot; + tickets + &quot;å¼ è½¦ç¥¨&quot;); tickets--; } else { System.out.println(Thread.currentThread().getName() + &quot;æé†’å¹¿å¤§ä¹˜å®¢ï¼šè½¦ç¥¨å·²ç»å”®å®Œï¼Œåœæ­¢å”®ç¥¨ï¼&quot;); this.flag = false; } } public void shutDown() { this.flag = false; } public static void main(String[] args) { TicketsThread ticketsThread = new TicketsThread(); Thread thread1 = new Thread(ticketsThread, &quot;å”®ç¥¨å¤„1&quot;); Thread thread2 = new Thread(ticketsThread, &quot;å”®ç¥¨å¤„2&quot;); Thread thread3 = new Thread(ticketsThread, &quot;å”®ç¥¨å¤„3&quot;); thread1.start(); thread2.start(); thread3.start(); } } /** * æ­»é”ç¤ºä¾‹ */ public class DeadThread implements Runnable { private Object obj1 = new Object(); private Object obj2 = new Object(); private boolean flag = true; @Override public void run() { if (flag) { synchronized (obj1) { try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); } synchronized (obj2) { } } } else { synchronized (obj2) { try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); } synchronized (obj1) { } } } } public static void main(String[] args) throws InterruptedException { DeadThread deadThread = new DeadThread(); Thread thread1 = new Thread(deadThread); Thread thread2 = new Thread(deadThread); thread1.start(); Thread.sleep(100); deadThread.flag = false; thread2.start(); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Stack","slug":"Java-Stack","permalink":"/tags/Java-Stack/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Stack","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Stack","date":"2020-06-06T09:00:10.000Z","updated":"2023-04-30T10:21:41.343Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Stack/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Stack/","excerpt":"","text":"åœ¨Javaä¸­Stackç±»è¡¨ç¤ºåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„å¯¹è±¡å †æ ˆã€‚æ ˆæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œå®ƒé‡‡ç”¨å…¸å‹çš„å…ˆè¿›åå‡ºçš„æ“ä½œæ–¹å¼å®Œæˆçš„ã€‚æ¯ä¸€ä¸ªæ ˆéƒ½åŒ…å«ä¸€ä¸ªæ ˆé¡¶ï¼Œæ¯æ¬¡å‡ºæ ˆæ˜¯å°†æ ˆé¡¶çš„æ•°æ®å–å‡ºï¼Œå¦‚ä¸‹ï¼š Stacké€šè¿‡äº”ä¸ªæ“ä½œå¯¹Vectorè¿›è¡Œæ‰©å±•ï¼Œå…è®¸å°†å‘é‡è§†ä¸ºå †æ ˆã€‚è¿™ä¸ªäº”ä¸ªæ“ä½œå¦‚ä¸‹ï¼š Stackç»§æ‰¿Vectorï¼Œä»–å¯¹Vectorè¿›è¡Œäº†ç®€å•çš„æ‰©å±•ï¼š public class Stack&lt;E&gt; extends Vector&lt;E&gt; Stackçš„å®ç°éå¸¸ç®€å•ï¼Œä»…æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œäº”ä¸ªå®ç°æ–¹æ³•ï¼ˆä»Vectorç»§æ‰¿è€Œæ¥çš„æ–¹æ³•ä¸ç®—ä¸å…¶ä¸­ï¼‰ï¼ŒåŒæ—¶å…¶å®ç°çš„æºç éå¸¸ç®€å•ã€‚ /** * æ„é€ å‡½æ•° */ public Stack() { } /** * pushå‡½æ•°ï¼šå°†å…ƒç´ å­˜å…¥æ ˆé¡¶ */ public E push(E item) { // å°†å…ƒç´ å­˜å…¥æ ˆé¡¶ã€‚ // addElement()çš„å®ç°åœ¨Vector.javaä¸­ addElement(item); return item; } /** * popå‡½æ•°ï¼šè¿”å›æ ˆé¡¶å…ƒç´ ï¼Œå¹¶å°†å…¶ä»æ ˆä¸­åˆ é™¤ */ public synchronized E pop() { E obj; int len = size(); obj = peek(); // åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼ŒremoveElementAt()çš„å®ç°åœ¨Vector.javaä¸­ removeElementAt(len - 1); return obj; } /** * peekå‡½æ•°ï¼šè¿”å›æ ˆé¡¶å…ƒç´ ï¼Œä¸æ‰§è¡Œåˆ é™¤æ“ä½œ */ public synchronized E peek() { int len = size(); if (len == 0) throw new EmptyStackException(); // è¿”å›æ ˆé¡¶å…ƒç´ ï¼ŒelementAt()å…·ä½“å®ç°åœ¨Vector.javaä¸­ return elementAt(len - 1); } /** * æ ˆæ˜¯å¦ä¸ºç©º */ public boolean empty() { return size() == 0; } /** * æŸ¥æ‰¾â€œå…ƒç´ oâ€åœ¨æ ˆä¸­çš„ä½ç½®ï¼šç”±æ ˆåº•å‘æ ˆé¡¶æ–¹å‘æ•° */ public synchronized int search(Object o) { // è·å–å…ƒç´ ç´¢å¼•ï¼ŒelementAt()å…·ä½“å®ç°åœ¨Vector.javaä¸­ int i = lastIndexOf(o); if (i &gt;= 0) { return size() - i; } return -1; }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Stack","slug":"Java-Stack","permalink":"/tags/Java-Stack/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--MD5åŠ å¯†","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--MD5åŠ å¯†","date":"2020-06-06T08:59:10.000Z","updated":"2023-04-30T10:21:41.342Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--MD5åŠ å¯†/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--MD5åŠ å¯†/","excerpt":"","text":"MD5ç®€ä»‹MD5å³Message-Digest Algorithm 5ï¼ˆä¿¡æ¯-æ‘˜è¦ç®—æ³•ç¬¬äº”ç‰ˆï¼‰ï¼Œæ˜¯ä¸€ç§åœ¨è®¡ç®—æœºå®‰å…¨é¢†åŸŸè¢«å¹¿æ³›ä½¿ç”¨çš„æ•£åˆ—å‡½æ•°ï¼ˆåˆè¯‘æ‚å‡‘ç®—æ³•ã€æ‘˜è¦ç®—æ³•ã€å“ˆå¸Œç®—æ³•ï¼‰ï¼Œç”¨äºç¡®ä¿æ‰€åŠ å¯†çš„æ•°æ®çš„ä¿¡æ¯å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚å°†æ•°æ®ï¼ˆå¦‚æ–‡æœ¬ã€å‹ç¼©åŒ…ç­‰ï¼‰è¿ç®—ä¸ºå¦ä¸€å›ºå®šé•¿åº¦å€¼ï¼Œæ˜¯æ‚å‡‘ç®—æ³•çš„åŸºç¡€åŸç†ï¼ŒMD5çš„å‰èº«æœ‰MD2ã€MD3å’ŒMD4ã€‚ MD5çš„ä½œç”¨æ˜¯è®©å¤§å®¹é‡ä¿¡æ¯åœ¨ç”¨æ•°å­—ç­¾åè½¯ä»¶ç­¾ç½²ç§äººå¯†é’¥å‰è¢«â€å‹ç¼©â€æˆä¸€ç§ä¿å¯†çš„æ ¼å¼ï¼ˆå°±æ˜¯æŠŠä¸€ä¸ªä»»æ„é•¿åº¦çš„å­—èŠ‚ä¸²å˜æ¢æˆä¸€å®šé•¿çš„åå…­è¿›åˆ¶æ•°å­—ä¸²ï¼‰ï¼Œå®ƒå¸¸è¢«ç”¨æ¥åšä¸€è‡´æ€§æ£€éªŒã€æ•°å­—ç­¾åã€å®‰å…¨æ€§è®¤è¯ç­‰ã€‚é™¤äº†MD5ä»¥å¤–ï¼Œæ¯”è¾ƒæœ‰åçš„åŒç±»ç®—æ³•è¿˜æœ‰sha-1ã€RIPEMDä»¥åŠHavalç­‰ã€‚ å¤§å®¶éƒ½çŸ¥é“ï¼Œåœ°çƒä¸Šä»»ä½•äººéƒ½æœ‰è‡ªå·±ç‹¬ä¸€æ— äºŒçš„æŒ‡çº¹ï¼Œè¿™å¸¸å¸¸æˆä¸ºå¸æ³•æœºå…³é‰´åˆ«ç½ªçŠ¯èº«ä»½æœ€å€¼å¾—ä¿¡èµ–çš„æ–¹æ³•ï¼›ä¸ä¹‹ç±»ä¼¼ï¼ŒMD5å¯ä»¥ä¸ºä»»ä½•æ–‡ä»¶ï¼ˆä¸ç®¡å…¶å¤§å°ã€æ ¼å¼ã€æ•°é‡ï¼‰äº§ç”Ÿä¸€ä¸ªåŒæ ·ç‹¬ä¸€æ— äºŒçš„â€œæ•°å­—æŒ‡çº¹â€ï¼Œä¸€æ—¦æœ‰äººå¯¹è¯¥æ–‡ä»¶åšäº†ä»»ä½•æ”¹åŠ¨ï¼Œå…¶MD5å€¼ä¹Ÿå°±æ˜¯å¯¹åº”çš„â€œæ•°å­—æŒ‡çº¹â€éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ æˆ‘ä»¬å¸¸å¸¸åœ¨æŸäº›è½¯ä»¶ä¸‹è½½ç«™ç‚¹çš„æŸè½¯ä»¶ä¿¡æ¯ä¸­çœ‹åˆ°å…¶MD5å€¼ï¼Œå®ƒçš„ä½œç”¨å°±åœ¨äºæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹è½½è¯¥è½¯ä»¶åï¼Œå¯¹ä¸‹è½½å›æ¥çš„æ–‡ä»¶ç”¨ä¸“é—¨çš„è½¯ä»¶ï¼ˆå¦‚Windows MD5 Checkç­‰ï¼‰åšä¸€æ¬¡MD5æ ¡éªŒï¼Œä»¥ç¡®ä¿æˆ‘ä»¬è·å¾—çš„æ–‡ä»¶ä¸è¯¥ç«™ç‚¹æä¾›çš„æ–‡ä»¶ä¸ºåŒä¸€æ–‡ä»¶ã€‚ MD5åŠ å¯†ç®—æ³•å¯ä»¥åˆ†ä¸º16ä½åŠ å¯†å’Œ32åŠ å¯†çš„ï¼Œå…¶å®æ‰€è°“çš„16ä½çš„åŠ å¯†ç®—æ³•åªæ˜¯åœ¨32ä½çš„åŠ å¯†ç®—æ³•ä¸­æˆªå–äº†ç¬¬8ä½åˆ°ç¬¬24ä½å­—ç¬¦ä¸²ï¼Œæ€»å…±16ä½çš„å­—ç¬¦ä¸²ï¼Œæ•…è€Œå«åšæ˜¯16ä½çš„MD5åŠ å¯†ç®—æ³•ã€‚ MD5ç®—æ³•å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å‹ç¼©æ€§ï¼šä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œç®—å‡ºçš„MD5å€¼é•¿åº¦éƒ½æ˜¯å›ºå®šçš„ã€‚ å®¹æ˜“è®¡ç®—ï¼šä»åŸæ•°æ®è®¡ç®—å‡ºMD5å€¼å¾ˆå®¹æ˜“ã€‚ æŠ—ä¿®æ”¹æ€§ï¼šå¯¹åŸæ•°æ®è¿›è¡Œä»»ä½•æ”¹åŠ¨ï¼Œå“ªæ€•åªä¿®æ”¹1ä¸ªå­—èŠ‚ï¼Œæ‰€å¾—åˆ°çš„MD5å€¼éƒ½æœ‰å¾ˆå¤§åŒºåˆ«ã€‚ å¼ºæŠ—ç¢°æ’ï¼šå·²çŸ¥åŸæ•°æ®å’Œå…¶MD5å€¼ï¼Œæƒ³æ‰¾åˆ°ä¸€ä¸ªå…·æœ‰ç›¸åŒMD5å€¼çš„æ•°æ®ï¼ˆå³ä¼ªé€ æ•°æ®ï¼‰æ˜¯éå¸¸å›°éš¾çš„ã€‚ ä¸å¯è§£å¯†ï¼šæ ¹æ®åŠ å¯†åçš„md5å€¼ï¼Œæ— æ³•é€†å‘å¾—åˆ°å…¶åŸå§‹æ•°æ®ã€‚ åœ¨javaä¸­ä½¿ç”¨MD5å¯¹å­—èŠ‚æ•°ç»„å’Œå­—ç¬¦ä¸²çš„MD5åŠ å¯†å®ç°ä»£ç å¦‚ä¸‹ï¼š // åˆ©ç”¨MD5å¯¹å­—èŠ‚æ•°ç»„è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°128ä½çš„å­—èŠ‚æ•°ç»„ public static byte[] encryptByMD5(byte[] input) { byte[] output = null; try { MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;); output = md5.digest(input); } catch (NoSuchAlgorithmException e) { e.printStackTrace(); } return output; } // åˆ©ç”¨MD5å¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°128ä½çš„å­—èŠ‚æ•°ç»„ public static byte[] encryptByMD5(String input) { byte[] output = null; try { MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;); output = md5.digest(input.getBytes(&quot;utf-8&quot;)); } catch (Exception e) { e.printStackTrace(); } return output; } åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä¼šå°†MD5åŠ å¯†åçš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨ï¼Œå…¶ä»£ç å®ç°å¦‚ä¸‹ã€‚ public static String encryptByMD5(String message) { String output = null; try { // 1 åˆ›å»ºä¸€ä¸ªæä¾›ä¿¡æ¯æ‘˜è¦ç®—æ³•çš„å¯¹è±¡ï¼Œåˆå§‹åŒ–ä¸ºmd5ç®—æ³•å¯¹è±¡ MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;); // 2 å°†æ¶ˆæ¯è½¬æ¢ä¸ºbyteæ•°ç»„ byte[] input = message.getBytes(&quot;utf-8&quot;); // 3 è®¡ç®—åè·å¾—sizeä¸º16ï¼ˆ128ä½ï¼‰çš„å­—èŠ‚æ•°ç»„ byte[] buff = md5.digest(input); // 4 æŠŠæ•°ç»„æ¯ä¸€å­—èŠ‚ï¼ˆä¸€ä¸ªå­—èŠ‚å å…«ä½ï¼‰è½¬æ¢æˆä¸¤ä¸ª16è¿›åˆ¶å­—ç¬¦å¹¶è¿æ¥èµ·æ¥ output = toHexString(buff); } catch (Exception e) { e.printStackTrace(); } return output; } public static String toHexString(byte[] bytes) { StringBuffer buffer = new StringBuffer(); // æŠŠæ•°ç»„æ¯ä¸€å­—èŠ‚è½¬æ¢æˆä¸¤ä¸ª16è¿›åˆ¶çš„å­—ç¬¦ï¼Œå¹¶è¿æ¥èµ·æ¥ int digital; for (int i = 0; i &lt; bytes.length; i++) { digital = bytes[i]; if (digital &lt; 0) { digital += 256; } if (digital &lt; 16) { buffer.append(&quot;0&quot;); } buffer.append(Integer.toHexString(digital)); } return buffer.toString().toUpperCase(); } toHexString(byte[] bytes)æ–¹æ³•çš„ä½œç”¨æ˜¯å°†128ä½ï¼ˆsize=16*8ï¼‰çš„å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºä¸€ä¸ªé•¿åº¦32çš„16è¿›åˆ¶å­—ç¬¦ä¸²ã€‚å¦‚æœå¯¹æ­¤æ–¹æ³•çš„å®ç°ç†è§£èµ·æ¥æœ‰å›°éš¾ï¼Œå¯ä»¥å‚ç…§ä¸‹é¢è¿™æ®µä»£ç ï¼Œä¸¤è€…å®ç°æ•ˆæœç›¸åŒã€‚ /* * Converts a byte to hex digit and writes to the supplied buffer */ private static void byte2hex(byte b, StringBuffer buf) { char[] hexChars = { &#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39; }; int high = ((b &amp; 0xf0) &gt;&gt; 4); int low = (b &amp; 0x0f); buf.append(hexChars[high]); buf.append(hexChars[low]); } /* * Converts a byte array to hex string */ private static String toHexString(byte[] block) { StringBuffer buf = new StringBuffer(); int len = block.length; for (int i = 0; i &lt; len; i++) { byte2hex(block[i], buf); } return buf.toString(); } å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸ä¼šç›´æ¥ä½¿ç”¨MD5åŠ å¯†å¾—åˆ°çš„ç»“æœï¼Œè€Œæ˜¯å°†MD5åŠ å¯†å¾—åˆ°çš„ç»“æœä½¿ç”¨BASE64å†åŠ å¯†ä¸€æ¬¡ï¼Œå¾—åˆ°ç›¸åº”çš„å­—ç¬¦ä¸²ã€‚ public static String encryptByMD5(String message) { String output = null; try { // 1 åˆ›å»ºä¸€ä¸ªæä¾›ä¿¡æ¯æ‘˜è¦ç®—æ³•çš„å¯¹è±¡ï¼Œåˆå§‹åŒ–ä¸ºmd5ç®—æ³•å¯¹è±¡ MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;); // 2 å°†æ¶ˆæ¯è½¬æ¢ä¸ºbyteæ•°ç»„ byte[] input = message.getBytes(&quot;utf-8&quot;); // 3 è®¡ç®—åè·å¾—sizeä¸º16ï¼ˆ128ä½ï¼‰çš„å­—èŠ‚æ•°ç»„ byte[] buff = md5.digest(input); BASE64Encoder base64en = new BASE64Encoder(); // 4 å°†MD5åŠ å¯†è·å¾—çš„å­—èŠ‚æ•°ç»„ä½¿ç”¨BASE64è¿›è¡Œç¬¬äºŒæ¬¡åŠ å¯† output = base64en.encode(buff); } catch (Exception e) { e.printStackTrace(); } return output; }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,MD5,åŠ å¯†","slug":"Java-MD5-åŠ å¯†","permalink":"/tags/Java-MD5-åŠ å¯†/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--RMI","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--RMI","date":"2020-06-06T08:59:10.000Z","updated":"2023-04-30T10:21:41.343Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--RMI/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--RMI/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€ŠHead First Java ï¼ˆä¸­æ–‡ç‰ˆï¼‰ã€‹ç¬¬äºŒç‰ˆ Javaçš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ (Remote Method Invocation,RMI)æŠ€æœ¯ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®ç°ï¼šæŸä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸Šçš„å¯¹è±¡å¯ä»¥è°ƒç”¨å¦ä¸€å°è®¡ç®—æœºã€å¦ä¸€ä¸ªJavaè™šæ‹Ÿæœºä¸Šé¢çš„å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°å¯¹è±¡çš„æ–¹æ³•ä¸€æ ·ã€‚ ä½¿ç”¨RMIæ—¶ï¼Œéœ€è¦æŒ‡å®šåè®®ï¼šJRMPï¼ˆJavaè¿œç¨‹æ¶ˆæ¯äº¤æ¢åè®®JRMPï¼ŒJava Remote Messaging Protocolï¼‰æˆ–æ˜¯IIOPï¼ˆäº’è”ç½‘å†…éƒ¨å¯¹è±¡è¯·æ±‚ä»£ç†åè®®ï¼ŒInternet Inter-ORB Protocolï¼‰ã€‚JRMPæ˜¯RMIåŸç”Ÿçš„åè®®ï¼Œå®ƒæ˜¯ä¸ºäº†Javaå¯¹Javaé—´çš„è¿œç¨‹è°ƒç”¨è€Œè®¾è®¡çš„ã€‚å¦ä¸€æ–¹é¢ï¼ŒIIOPæ˜¯ä¸ºäº†CORBAï¼ˆCommon Object Request Broker Architectureï¼‰è€Œäº§ç”Ÿçš„ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿè°ƒç”¨Javaå¯¹è±¡æˆ–å…¶å®ƒç±»å‹çš„è¿œç¨‹æ–¹æ³•ã€‚ RMIè¿œç¨‹æ–¹æ³•è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åˆ›å»ºè¿œç¨‹æœåŠ¡åˆ›å»ºè¿œç¨‹æœåŠ¡åŒ…å«ä»¥ä¸‹5ä¸ªæ­¥éª¤ï¼š åˆ›å»ºè¿œç¨‹æœåŠ¡æ¥å£è¿œç¨‹çš„æœåŠ¡æ¥å£è¦ç»§æ‰¿java.rmi.Remoteï¼Œç”¨æ¥å®šä¹‰å®¢æˆ·ç«¯å¯ä»¥è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ï¼Œstubå’Œskeletonéƒ½è¦å®ç°æ­¤æ¥å£ã€‚å®ƒæ˜¯ä¸ªä½œä¸ºæœåŠ¡çš„å¤šæ€åŒ–ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯ä¼šè°ƒç”¨å®ç°æ­¤æ¥å£çš„stubï¼Œè€Œæ­¤stubå› ä¸ºä¼šæ‰§è¡Œç½‘ç»œå’Œè¾“å…¥/è¾“å‡ºå·¥ä½œï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‘ç”Ÿå„ç§é—®é¢˜ï¼Œå®¢æˆ·ç«¯å¿…é¡»å¤„ç†æˆ–å£°æ˜å¼‚å¸¸æ¥è®¤çŸ¥è¿™ä¸€ç±»é£é™©ã€‚å¹¶ä¸”ï¼Œè¿œç¨‹æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼å¿…é¡»éƒ½æ˜¯primitiveåŸºæœ¬æ•°æ®ç±»å‹æˆ–Serializableçš„ã€‚ package rmi; import java.rmi.Remote; import java.rmi.RemoteException; /** * è¿œç¨‹æœåŠ¡æ¥å£ */ public interface IRemoteService extends Remote { public String sayHello() throws RemoteException; } å®ç°è¿œç¨‹æœåŠ¡æ¥å£è¿™æ˜¯çœŸæ­£æ‰§è¡Œçš„ç±»ï¼Œå®ƒå®ç°äº†å®šä¹‰åœ¨è¿œç¨‹æœåŠ¡æ¥å£ä¸­çš„æ–¹æ³•ï¼Œå®ƒæ˜¯å®¢æˆ·ç«¯ä¼šè°ƒç”¨çš„å¯¹è±¡ã€‚ä¸ºäº†è¦æˆä¸ºè¿œç¨‹æœåŠ¡å¯¹è±¡ï¼Œè¿™ä¸ªå®ç°ç±»å¿…é¡»è¦åŒ…å«ä¸è¿œç¨‹æœ‰å…³çš„åŠŸèƒ½ã€‚å…¶ä¸­æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç»§æ‰¿java.rim.server.UnicastRemoteObjectï¼Œä»¥è°ƒç”¨çˆ¶ç±»çš„è¿œç¨‹åŠŸèƒ½æ¥å¤„ç†è¿™äº›å·¥ä½œã€‚UnicastRemoteObjectæœ‰ä¸ªå°é—®é¢˜ï¼šå®ƒçš„æ„é€ å‡½æ•°ä¼šæŠ›å‡ºRemoteExceptionå¼‚å¸¸ï¼Œå› æ­¤éœ€è¦ä¸ºä½ çš„å®ç°ç±»å£°æ˜ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶åœ¨å…¶ä¸­æŠ›å‡ºRemoteExceptionå¼‚å¸¸ã€‚ package rmi; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; /** * è¿œç¨‹æœåŠ¡å®ç° */ public class RemoteServiceImpl extends UnicastRemoteObject implements IRemoteService { // æ— éœ€å£°æ˜RemoteExceptionå¼‚å¸¸ public String sayHello() { return &quot;Server syas , &#39;Hey&#39;&quot;; } // çˆ¶ç±»çš„æ„é€ å‡½æ•°å£°æ˜äº†å¼‚å¸¸ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¾—åœ¨æ„é€ å‡½æ•°ä¸­å£°æ˜å¼‚å¸¸ public RemoteServiceImpl() throws RemoteException { } } æ³¨æ„ï¼šè¦è®°å¾—å½“ç±»è¢«åˆå§‹åŒ–çš„æ—¶å€™ï¼Œçˆ¶ç±»çš„æ„é€ å‡½æ•°ä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœçˆ¶ç±»çš„æ„é€ å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œä½ ä¹Ÿå¾—å£°æ˜ä½ çš„æ„é€ å‡½æ•°ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ ä½¿ç”¨rmicäº§ç”Ÿstubå’Œskeletonä¼´éšJava Software Development Kitè€Œæ¥çš„rmicå·¥å…·ä¼šä»¥è¿œç¨‹æœåŠ¡çš„å®ç°ç±»ï¼ˆä¸æ˜¯è¿œç¨‹æœåŠ¡æ¥å£ï¼‰äº§ç”Ÿå‡ºä¸¤ä¸ªæ–°çš„ç±»ï¼šstubå’Œskeletonã€‚å®ƒä¼šæŒ‰ç…§å‘½åè§„åˆ™åœ¨ä½ çš„è¿œç¨‹æœåŠ¡å®ç°ç±»åç§°åé¢åŠ ä¸Š_Stubæˆ–_Skelï¼ˆJDK 1.2ä»¥åå°†åªéœ€è¦_Stubæ–‡ä»¶ï¼‰ã€‚ æ‰§è¡Œrmicå‘½ä»¤æ—¶éœ€è¦è€ƒè™‘åˆ°åŒ…ç›®å½•ç»“æ„å’Œå®Œæ•´åç§°ï¼Œæˆ‘çš„æ‰€æœ‰ç¤ºä¾‹ä»£ç çš„.classæ–‡ä»¶å‡æ”¾ç½®åœ¨D:\\bin\\rmiç›®å½•ä¸‹ï¼ŒRemoteServiceImplç±»çš„å®Œæ•´åç§°ä¸ºrmiï¼ˆåŒ…è·¯å¾„ï¼‰.RemoteServiceImplã€‚ ç”±äºæœªæŒ‡å®šrmicçš„ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶çš„å­˜æ”¾ä½ç½®ï¼Œæ‰€ä»¥ä¼šå°†ç”Ÿæˆçš„stubæ–‡ä»¶å’Œskeletonæ–‡ä»¶æ”¾ç½®åœ¨RemoteServiceImpl.classæ–‡ä»¶æ‰€åœ¨ç›®å½•(D:\\bin\\rmi)ä¸‹ã€‚ å¯åŠ¨RMI registryï¼ˆæ‰§è¡Œrmiregistryï¼‰rmiregistryå°±åƒæ˜¯ç”µè¯ç°¿ï¼Œç”¨æˆ·ä¼šä»æ­¤å¤„å–å¾—ä»£ç†ï¼ˆå®¢æˆ·ç«¯çš„stubå¯¹è±¡ï¼‰ï¼Œå› æ­¤éœ€è¦åœ¨è¿œç¨‹æœåŠ¡å¯åŠ¨å‰å…ˆå¯åŠ¨RMI registryã€‚ å¯åŠ¨è¿œç¨‹æœåŠ¡è¿œç¨‹æœåŠ¡å®ç°ç±»å®šä¹‰å®Œæˆä¹‹åè¿˜éœ€è¦ä½¿ç”¨java.rmi.Namingçš„bind()æ–¹æ³• æ¥å‘RMI registryæ³¨å†ŒæœåŠ¡ï¼Œå½“ä½ æ³¨å†Œå¯¹è±¡æ—¶ï¼ŒRMIç³»ç»Ÿä¼šæŠŠstubåŠ åˆ°RMI registryä¸­ã€‚ package rmi; import java.rmi.Naming; public class Server { public static void main(String[] args) { try { // åˆ›å»ºå‡ºè¿œç¨‹å¯¹è±¡ï¼Œç„¶åä½¿ç”¨é™æ€çš„Naming.bind()æ¥äº§ç”Ÿå…³è” // æ‰€æ³¨å†Œçš„åç§°ä¼šä¾›å®¢æˆ·ç«¯æŸ¥è¯¢ IRemoteService service = new RemoteServiceImpl(); Naming.bind(&quot;RemoteHello&quot;, service); //Naming.rebind(&quot;Remote Hello&quot;, service); } catch (Exception e) { e.printStackTrace(); } } } å®¢æˆ·ç«¯å¦‚ä½•å–å¾—stubå¯¹è±¡ï¼Ÿå®¢æˆ·ç«¯å¿…é¡»å–å¾—stubå¯¹è±¡ï¼Œå› ä¸ºå®¢æˆ·ç«¯å¿…é¡»è¦è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼Œè¿™å°±å¾—é RMI registryäº†ã€‚å®¢æˆ·ç«¯ä¼šåƒæŸ¥è¯¢ç”µè¯ç°¿ä¸€æ ·åœ°æœç´¢ï¼Œæ‰¾å‡ºä¸Šé¢æœ‰ç›¸ç¬¦åç§°çš„æœåŠ¡ã€‚ RMIä¼šè‡ªåŠ¨å°†stubè§£åºåˆ—åŒ–ï¼Œè¿™å°±è¦æ±‚å®¢æˆ·ç«¯åœ¨æŸ¥è¯¢æœåŠ¡æ—¶ä¸€å®šè¦æœ‰stubç±»æ–‡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´stubä¸èƒ½è¢«è§£åºåˆ—åŒ–ã€‚ package rmi; import java.rmi.Naming; public class Client { public static void main(String[] args) { new Client().go(); } public void go() { try { //å®¢æˆ·ç«¯å¿…é¡»ä½¿ç”¨ä¸æœåŠ¡ç›¸åŒçš„ç±»å‹ //äº‹å®ä¸Šï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“æœåŠ¡å®é™…ä¸Šçš„ç±»å‹ IRemoteService service = (IRemoteService) Naming.lookup(&quot;rmi://127.0.0.1/RemoteHello&quot;); String s = service.sayHello(); System.out.println(s); } catch (Exception e) { e.printStackTrace(); } } } æ³¨æ„äº‹é¡¹ï¼šå®¢æˆ·ç«¯æ˜¯ä½¿ç”¨æ¥å£æ¥è°ƒç”¨stubä¸Šçš„æ–¹æ³•ï¼Œå®¢æˆ·ç«¯çš„Javaè™šæ‹Ÿæœºå¿…é¡»è¦æœ‰stubç±»ï¼Œä½†å®¢æˆ·ç«¯ä¸ä¼šåœ¨ç¨‹åºä»£ç ä¸­å¼•ç”¨stubç±»ï¼Œå®¢æˆ·ç«¯æ€»æ˜¯é€šè¿‡æ¥å£æ¥æ“ä½œçœŸæ­£çš„è¿œç¨‹å¯¹è±¡ã€‚æœåŠ¡å™¨ä¸Šå¿…é¡»è¦æœ‰stubå’Œskeletonï¼Œä»¥åŠæœåŠ¡äºè¿œç¨‹çš„æ¥å£ï¼Œå®ƒä¼šéœ€è¦stubç±»æ˜¯å› ä¸ºstubä¼šè¢«ä»£æ¢æˆè¿æ¥åœ¨RMI registryä¸ŠçœŸæ­£çš„æœåŠ¡ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,RMI","slug":"Java-RMI","permalink":"/tags/Java-RMI/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Mavenå¼•å…¥org.apache.tools.zip","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Mavenå¼•å…¥org.apache.tools.zip","date":"2020-06-06T08:58:10.000Z","updated":"2023-04-30T10:21:41.343Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Mavenå¼•å…¥org.apache.tools.zip/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Mavenå¼•å…¥org.apache.tools.zip/","excerpt":"","text":"å¯ä»¥çœ‹å‡º org.apache.tools.zip æ˜¯ ant-**.jar é‡Œé¢çš„ã€‚ æ‰€ä»¥è¦å¼•å…¥org.apache.tools.zipï¼Œç›´æ¥mavenå¼•å…¥antå³å¯ã€‚ &lt;!-- https://mvnrepository.com/artifact/org.apache.ant/ant --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.ant&lt;/groupId&gt; &lt;artifactId&gt;ant&lt;/artifactId&gt; &lt;version&gt;1.10.5&lt;/version&gt; &lt;/dependency&gt;","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,maven","slug":"Java-maven","permalink":"/tags/Java-maven/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--JDK1.8ä¸­çš„æ—¥æœŸå¤„ç†","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--JDK1.8ä¸­çš„æ—¥æœŸå¤„ç†","date":"2020-06-06T08:57:10.000Z","updated":"2023-04-30T10:21:41.342Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--JDK1.8ä¸­çš„æ—¥æœŸå¤„ç†/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--JDK1.8ä¸­çš„æ—¥æœŸå¤„ç†/","excerpt":"","text":"ä¼´éšlambdaè¡¨è¾¾å¼ã€streamsä»¥åŠä¸€ç³»åˆ—å°ä¼˜åŒ–ï¼ŒJava 8 æ¨å‡ºäº†å…¨æ–°çš„æ—¥æœŸæ—¶é—´APIï¼Œåœ¨æ•™ç¨‹ä¸­æˆ‘ä»¬å°†é€šè¿‡ä¸€äº›ç®€å•çš„å®ä¾‹æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨æ–°APIã€‚Javaå¤„ç†æ—¥æœŸã€æ—¥å†å’Œæ—¶é—´çš„æ–¹å¼ä¸€ç›´ä¸ºç¤¾åŒºæ‰€è¯Ÿç—…ï¼Œå°†java.util.Dateè®¾å®šä¸ºå¯å˜ç±»å‹ï¼Œä»¥åŠSimpleDateFormatçš„éçº¿ç¨‹å®‰å…¨ä½¿å…¶åº”ç”¨éå¸¸å—é™ã€‚Javaä¹Ÿæ„è¯†åˆ°éœ€è¦ä¸€ä¸ªæ›´å¥½çš„ APIæ¥æ»¡è¶³ç¤¾åŒºä¸­å·²ç»ä¹ æƒ¯äº†ä½¿ç”¨JodaTime APIçš„äººä»¬ã€‚å…¨æ–°APIçš„ä¼—å¤šå¥½å¤„ä¹‹ä¸€å°±æ˜¯ï¼Œæ˜ç¡®äº†æ—¥æœŸæ—¶é—´æ¦‚å¿µï¼Œä¾‹å¦‚ï¼šç¬æ—¶ï¼ˆinstantï¼‰ã€ é•¿çŸ­ï¼ˆdurationï¼‰ã€æ—¥æœŸã€æ—¶é—´ã€æ—¶åŒºå’Œå‘¨æœŸã€‚åŒæ—¶ç»§æ‰¿äº†Jodaåº“æŒ‰äººç±»è¯­è¨€å’Œè®¡ç®—æœºå„è‡ªè§£æçš„æ—¶é—´å¤„ç†æ–¹å¼ã€‚ä¸åŒäºè€ç‰ˆæœ¬,æ–°APIåŸºäºISOæ ‡å‡†æ—¥å†ç³»ç»Ÿï¼Œjava.timeåŒ…ä¸‹çš„æ‰€æœ‰ç±»éƒ½æ˜¯ä¸å¯å˜ç±»å‹è€Œä¸”çº¿ç¨‹å®‰å…¨ã€‚ä¸‹é¢æ˜¯æ–°ç‰ˆAPIä¸­java.timeåŒ…é‡Œçš„ä¸€äº›å…³é”®ç±»ï¼š Instantï¼šç¬æ—¶å®ä¾‹ã€‚ LocalDateï¼šæœ¬åœ°æ—¥æœŸï¼Œä¸åŒ…å«å…·ä½“æ—¶é—´ ä¾‹å¦‚ï¼š2014-01-14 å¯ä»¥ç”¨æ¥è®°å½•ç”Ÿæ—¥ã€çºªå¿µæ—¥ã€åŠ ç›Ÿæ—¥ç­‰ã€‚ LocalTimeï¼šæœ¬åœ°æ—¶é—´ï¼Œä¸åŒ…å«æ—¥æœŸã€‚ LocalDateTimeï¼šç»„åˆäº†æ—¥æœŸå’Œæ—¶é—´ï¼Œä½†ä¸åŒ…å«æ—¶å·®å’Œæ—¶åŒºä¿¡æ¯ã€‚ ZonedDateTimeï¼šæœ€å®Œæ•´çš„æ—¥æœŸæ—¶é—´ï¼ŒåŒ…å«æ—¶åŒºå’Œç›¸å¯¹UTCæˆ–æ ¼æ—å¨æ²»çš„æ—¶å·®ã€‚ æ–°APIè¿˜å¼•å…¥äº†ZoneOffSetå’ŒZoneIdç±»ï¼Œä½¿å¾—è§£å†³æ—¶åŒºé—®é¢˜æ›´ä¸ºç®€ä¾¿ã€‚è§£æã€æ ¼å¼åŒ–æ—¶é—´çš„DateTimeFormatterç±»ä¹Ÿå…¨éƒ¨é‡æ–°è®¾è®¡ã€‚æ³¨æ„ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘åœ¨ä¸€å¹´å‰Java 8å³å°†å‘å¸ƒæ—¶å†™çš„ï¼Œä»¥ä¸‹ç¤ºä¾‹ä»£ç ä¸­çš„æ—¶é—´éƒ½æ˜¯é‚£ä¸€å¹´çš„ï¼Œå½“è¿è¡Œè¿™äº›ä¾‹å­æ—¶ä¼šè¿”å›ä½ å½“å‰çš„æ—¶é—´ã€‚ ä½¿ç”¨æ–°åº“å¤„ç†æ—¥æœŸå’Œæ—¶é—´å¸¸æœ‰äººé—®æˆ‘å­¦ä¹ ä¸€ä¸ªæ–°åº“çš„æœ€å¥½æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘çš„ç­”æ¡ˆæ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚é¡¹ç›®ä¸­æœ‰å¾ˆå¤šçœŸæ­£çš„éœ€æ±‚é©±ä½¿å¼€å‘è€…å»å‘æ˜å¹¶å­¦ä¹ æ–°åº“ã€‚ç®€å•å¾—è¯´å°±æ˜¯ä»»åŠ¡é©±åŠ¨å­¦ä¹ æ¢ ç´¢ã€‚è¿™å¯¹Java 8æ–°æ—¥æœŸæ—¶é—´APIä¹Ÿä¸ä¾‹å¤–ã€‚æˆ‘åˆ›å»ºäº†20ä¸ªåŸºäºä»»åŠ¡çš„å®ä¾‹æ¥å­¦ä¹ Java 8çš„æ–°ç‰¹æ€§ã€‚ä»æœ€ç®€å•åˆ›å»ºå½“å¤©çš„æ—¥æœŸå¼€å§‹ï¼Œç„¶ååˆ›å»ºæ—¶é—´åŠæ—¶åŒºï¼Œæ¥ç€æ¨¡æ‹Ÿä¸€ä¸ªæ—¥æœŸæé†’åº”ç”¨ä¸­çš„ä»»åŠ¡â€”â€”è®¡ç®—é‡è¦æ—¥æœŸçš„åˆ°æœŸå¤©æ•°ï¼Œä¾‹å¦‚ç”Ÿæ—¥ã€çºªå¿µæ—¥ã€è´¦å• æ—¥ã€ä¿è´¹åˆ°æœŸæ—¥ã€ä¿¡ç”¨å¡è¿‡æœŸæ—¥ç­‰ã€‚ 1ã€è·å–ä»Šå¤©çš„æ—¥æœŸJava 8 ä¸­çš„ LocalDate ç”¨äºè¡¨ç¤ºå½“å¤©æ—¥æœŸã€‚å’Œjava.util.Dateä¸åŒï¼Œå®ƒåªæœ‰æ—¥æœŸï¼Œä¸åŒ…å«æ—¶é—´ã€‚å½“ä½ ä»…éœ€è¦è¡¨ç¤ºæ—¥æœŸæ—¶å°±ç”¨è¿™ä¸ªç±»ã€‚ LocalDate today = LocalDate.now(); System.out.println(&quot;Today&#39;s Local date : &quot; + today); è¾“å‡ºï¼š Today&#39;s Local date : 2014-01-14 ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†å½“å¤©çš„æ—¥æœŸï¼Œä¸å«æ—¶é—´ä¿¡æ¯ã€‚æ‰“å°å‡ºçš„æ—¥æœŸæ ¼å¼éå¸¸å‹å¥½ï¼Œä¸åƒè€çš„Dateç±»æ‰“å°å‡ºä¸€å †æ²¡æœ‰æ ¼å¼åŒ–çš„ä¿¡æ¯ã€‚ 2ã€è·å–å¹´/æœˆ/æ—¥ä¿¡æ¯LocalDateç±»æä¾›äº†è·å–å¹´ã€æœˆã€æ—¥çš„å¿«æ·æ–¹æ³•ï¼Œå…¶å®ä¾‹è¿˜åŒ…å«å¾ˆå¤šå…¶å®ƒçš„æ—¥æœŸå±æ€§ã€‚é€šè¿‡è°ƒç”¨è¿™äº›æ–¹æ³•å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°éœ€è¦çš„æ—¥æœŸä¿¡æ¯ï¼Œä¸ç”¨åƒä»¥å‰ä¸€æ ·éœ€è¦ä¾èµ–java.util.Calendarç±»äº†ã€‚ LocalDate today = LocalDate.now(); int year = today.getYear(); int month = today.getMonthValue(); int day = today.getDayOfMonth(); System.out.printf(&quot;Year : %d Month : %d day : %d t %n&quot;, year, month, day); è¾“å‡ºï¼š Today&#39;s Local date : 2014-01-14Year : 2014 Month : 1 day : 14 çœ‹åˆ°äº†å§ï¼Œåœ¨Java 8 ä¸­å¾—åˆ°å¹´ã€æœˆã€æ—¥ä¿¡æ¯æ˜¯è¿™ä¹ˆç®€å•ç›´è§‚ï¼Œæƒ³ç”¨å°±ç”¨ï¼Œæ²¡ä»€ä¹ˆéœ€è¦è®°çš„ã€‚å¯¹æ¯”çœ‹çœ‹ä»¥å‰Javaæ˜¯æ€ä¹ˆå¤„ç†å¹´æœˆæ—¥ä¿¡æ¯çš„å§ã€‚ 3ã€å¤„ç†ç‰¹å®šæ—¥æœŸåœ¨ç¬¬ä¸€ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬é€šè¿‡é™æ€å·¥å‚æ–¹æ³•now()éå¸¸å®¹æ˜“åœ°åˆ›å»ºäº†å½“å¤©æ—¥æœŸï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªæœ‰ç”¨çš„å·¥å‚æ–¹æ³•LocalDate.of()åˆ›å»ºä»»æ„æ—¥æœŸï¼Œ è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥å¹´ã€æœˆã€æ—¥åšå‚æ•°ï¼Œè¿”å›å¯¹åº”çš„LocalDateå®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„æ˜¯æ²¡å†çŠ¯è€APIçš„è®¾è®¡é”™è¯¯ï¼Œæ¯”å¦‚å¹´åº¦èµ·å§‹äº1900ï¼Œæœˆä»½æ˜¯ä»0å¼€ å§‹ç­‰ç­‰ã€‚æ—¥æœŸæ‰€è§å³æ‰€å¾—ï¼Œå°±åƒä¸‹é¢è¿™ä¸ªä¾‹å­è¡¨ç¤ºäº†1æœˆ14æ—¥ï¼Œæ²¡æœ‰ä»»ä½•éšè—æœºå…³ã€‚ LocalDate dateOfBirth = LocalDate.of(2010, 01, 14); System.out.println(&quot;Your Date of birth is : &quot; + dateOfBirth); è¾“å‡º: Output : Your Date of birth is : 2010-01-14 å¯ä»¥çœ‹åˆ°åˆ›å»ºçš„æ—¥æœŸå®Œå…¨ç¬¦åˆé¢„æœŸï¼Œä¸ä½ å†™å…¥çš„2010å¹´1æœˆ14æ—¥å®Œå…¨ä¸€è‡´ã€‚ 4ã€åˆ¤æ–­ä¸¤ä¸ªæ—¥æœŸæ˜¯å¦ç›¸ç­‰ç°å®ç”Ÿæ´»ä¸­æœ‰ä¸€ç±»æ—¶é—´å¤„ç†å°±æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ—¥æœŸæ˜¯å¦ç›¸ç­‰ã€‚ä½ å¸¸å¸¸ä¼šæ£€æŸ¥ä»Šå¤©æ˜¯ä¸æ˜¯ä¸ªç‰¹æ®Šçš„æ—¥å­ï¼Œæ¯”å¦‚ç”Ÿæ—¥ã€çºªå¿µæ—¥æˆ–éäº¤æ˜“æ—¥ã€‚è¿™æ—¶å°±éœ€è¦æŠŠæŒ‡å®šçš„æ—¥æœŸä¸æŸä¸ªç‰¹å®š æ—¥æœŸåšæ¯”è¾ƒï¼Œä¾‹å¦‚åˆ¤æ–­è¿™ä¸€å¤©æ˜¯å¦æ˜¯å‡æœŸã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¼šå¸®åŠ©ä½ ç”¨Java 8çš„æ–¹å¼å»è§£å†³ï¼Œä½ è‚¯å®šå·²ç»æƒ³åˆ°äº†ï¼ŒLocalDateé‡è½½äº†equalæ–¹æ³•ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š LocalDate date1 = LocalDate.of(2014, 01, 14); if(date1.equals(today)){ System.out.printf(&quot;Today %s and date1 %s are same date %n&quot;, today, date1); } è¾“å‡ºï¼š today 2014-01-14 and date1 2014-01-14 are same date è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬æ¯”è¾ƒçš„ä¸¤ä¸ªæ—¥æœŸç›¸åŒã€‚æ³¨æ„ï¼Œå¦‚æœæ¯”è¾ƒçš„æ—¥æœŸæ˜¯å­—ç¬¦å‹çš„ï¼Œéœ€è¦å…ˆè§£ææˆæ—¥æœŸå¯¹è±¡å†ä½œåˆ¤æ–­ã€‚å¯¹æ¯”Javaè€çš„æ—¥æœŸæ¯”è¾ƒæ–¹å¼ï¼Œä½ ä¼šæ„Ÿåˆ°æ¸…é£æ‹‚é¢ã€‚ 5ã€å‘¨æœŸæ€§æ—¥æœŸåˆ¤æ–­Java ä¸­å¦ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„å¤„ç†å°±æ˜¯æ£€æŸ¥ç±»ä¼¼æ¯æœˆè´¦å•ã€ç»“å©šçºªå¿µæ—¥ã€EMIæ—¥æˆ–ä¿é™©ç¼´è´¹æ—¥è¿™äº›å‘¨æœŸæ€§äº‹ä»¶ã€‚å¦‚æœä½ åœ¨ç”µå­å•†åŠ¡ç½‘ç«™å·¥ä½œï¼Œé‚£ä¹ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªæ¨¡å—ç”¨æ¥åœ¨ åœ£è¯èŠ‚ã€æ„Ÿæ©èŠ‚è¿™ç§èŠ‚æ—¥æ—¶å‘å®¢æˆ·å‘é€é—®å€™é‚®ä»¶ã€‚Javaä¸­å¦‚ä½•æ£€æŸ¥è¿™äº›èŠ‚æ—¥æˆ–å…¶å®ƒå‘¨æœŸæ€§äº‹ä»¶å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯MonthDayç±»ã€‚è¿™ä¸ªç±»ç»„åˆäº†æœˆä»½å’Œæ—¥ï¼Œå»æ‰ äº†å¹´ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨å®ƒåˆ¤æ–­æ¯å¹´éƒ½ä¼šå‘ç”Ÿäº‹ä»¶ã€‚å’Œè¿™ä¸ªç±»ç›¸ä¼¼çš„è¿˜æœ‰ä¸€ä¸ªYearMonthç±»ã€‚è¿™äº›ç±»ä¹Ÿéƒ½æ˜¯ä¸å¯å˜å¹¶ä¸”çº¿ç¨‹å®‰å…¨çš„å€¼ç±»å‹ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ MonthDayæ¥æ£€æŸ¥å‘¨æœŸæ€§äº‹ä»¶ï¼š LocalDate dateOfBirth = LocalDate.of(2010, 01, 14); MonthDay birthday = MonthDay.of(dateOfBirth.getMonth(), dateOfBirth.getDayOfMonth()); MonthDay currentMonthDay = MonthDay.from(today); if(currentMonthDay.equals(birthday)){ System.out.println(&quot;Many Many happy returns of the day !!&quot;); }else{ System.out.println(&quot;Sorry, today is not your birthday&quot;); } è¾“å‡ºï¼š Many Many happy returns of the day !! åªè¦å½“å¤©çš„æ—¥æœŸå’Œç”Ÿæ—¥åŒ¹é…ï¼Œæ— è®ºæ˜¯å“ªä¸€å¹´éƒ½ä¼šæ‰“å°å‡ºç¥è´ºä¿¡æ¯ã€‚ä½ å¯ä»¥æŠŠç¨‹åºæ•´åˆè¿›ç³»ç»Ÿæ—¶é’Ÿï¼Œçœ‹çœ‹ç”Ÿæ—¥æ—¶æ˜¯å¦ä¼šå—åˆ°æé†’ï¼Œæˆ–è€…å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¥æ£€æµ‹ä»£ç æ˜¯å¦è¿è¡Œæ­£ç¡®ã€‚ 6ã€è·å–å½“å‰æ—¶é—´ä¸Java 8è·å–æ—¥æœŸçš„ä¾‹å­å¾ˆåƒï¼Œè·å–æ—¶é—´ä½¿ç”¨çš„æ˜¯LocalTimeç±»ï¼Œä¸€ä¸ªåªæœ‰æ—¶é—´æ²¡æœ‰æ—¥æœŸçš„LocalDateè¿‘äº²ã€‚å¯ä»¥è°ƒç”¨é™æ€å·¥å‚æ–¹æ³•now()æ¥è·å–å½“å‰æ—¶é—´ã€‚é»˜è®¤çš„æ ¼å¼æ˜¯hh:mm:ss:nnnã€‚å¯¹æ¯”ä¸€ä¸‹Java 8ä¹‹å‰è·å–å½“å‰æ—¶é—´çš„æ–¹å¼ã€‚ LocalTime time = LocalTime.now(); System.out.println(&quot;local time now : &quot; + time); è¾“å‡ºï¼š local time now : 16:33:33.369 // in hour, minutes, seconds, nano seconds å¯ä»¥çœ‹åˆ°å½“å‰æ—¶é—´å°±åªåŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œæ²¡æœ‰æ—¥æœŸã€‚ 7ã€åœ¨å½“å‰æ—¶é—´ä¸Šå¢åŠ å°æ—¶é€šè¿‡å¢åŠ å°æ—¶ã€åˆ†ã€ç§’æ¥è®¡ç®—å°†æ¥çš„æ—¶é—´å¾ˆå¸¸è§ã€‚Java 8é™¤äº†ä¸å˜ç±»å‹å’Œçº¿ç¨‹å®‰å…¨çš„å¥½å¤„ä¹‹å¤–ï¼Œè¿˜æä¾›äº†æ›´å¥½çš„plusHours()æ–¹æ³•æ›¿æ¢add()ï¼Œå¹¶ä¸”æ˜¯å…¼å®¹çš„ã€‚æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªå…¨æ–°çš„LocalTimeå®ä¾‹ï¼Œç”±äºå…¶ä¸å¯å˜æ€§ï¼Œè¿”å›åä¸€å®šè¦ç”¨å˜é‡èµ‹å€¼ã€‚ LocalTime time = LocalTime.now(); LocalTime newTime = time.plusHours(2); // adding two hours System.out.println(&quot;Time after 2 hours : &quot; + newTime); è¾“å‡ºï¼š Time after 2 hours : 18:33:33.369 å¯ä»¥çœ‹åˆ°ï¼Œæ–°çš„æ—¶é—´åœ¨å½“å‰æ—¶é—´16:33:33.369çš„åŸºç¡€ä¸Šå¢åŠ äº†2ä¸ªå°æ—¶ã€‚å’Œæ—§ç‰ˆJavaçš„å¢å‡æ—¶é—´çš„å¤„ç†æ–¹å¼å¯¹æ¯”ä¸€ä¸‹ï¼Œçœ‹çœ‹å“ªç§æ›´å¥½ã€‚ 8ã€è®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸå’Œä¸Šä¸ªä¾‹å­è®¡ç®—ä¸¤å°æ—¶ä»¥åçš„æ—¶é—´ç±»ä¼¼ï¼Œè¿™ä¸ªä¾‹å­ä¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸã€‚LocalDateæ—¥æœŸä¸åŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œå®ƒçš„plus()æ–¹æ³•ç”¨æ¥å¢åŠ å¤©ã€å‘¨ã€æœˆï¼ŒChronoUnitç±»å£°æ˜äº†è¿™äº›æ—¶é—´å•ä½ã€‚ç”±äºLocalDateä¹Ÿæ˜¯ä¸å˜ç±»å‹ï¼Œè¿”å›åä¸€å®šè¦ç”¨å˜é‡èµ‹å€¼ã€‚ LocalDate nextWeek = today.plus(1, ChronoUnit.WEEKS); System.out.println(&quot;Today is : &quot; + today); System.out.println(&quot;Date after 1 week : &quot; + nextWeek); è¾“å‡ºï¼š Today is : 2014-01-14Date after 1 week : 2014-01-21 å¯ä»¥çœ‹åˆ°æ–°æ—¥æœŸç¦»å½“å¤©æ—¥æœŸæ˜¯7å¤©ï¼Œä¹Ÿå°±æ˜¯ä¸€å‘¨ã€‚ä½ å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•å¢åŠ 1ä¸ªæœˆã€1å¹´ã€1å°æ—¶ã€1åˆ†é’Ÿç”šè‡³ä¸€ä¸ªä¸–çºªï¼Œæ›´å¤šé€‰é¡¹å¯ä»¥æŸ¥çœ‹Java 8 APIä¸­çš„ChronoUnitç±»ã€‚ 9ã€è®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œä¸Šä¸ªä¾‹å­ä¸­æˆ‘ä»¬é€šè¿‡LocalDateçš„plus()æ–¹æ³•å¢åŠ å¤©æ•°ã€å‘¨æ•°æˆ–æœˆæ•°ï¼Œè¿™ä¸ªä¾‹å­æˆ‘ä»¬åˆ©ç”¨minus()æ–¹æ³•è®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸã€‚ LocalDate previousYear = today.minus(1, ChronoUnit.YEARS); System.out.println(&quot;Date before 1 year : &quot; + previousYear); LocalDate nextYear = today.plus(1, YEARS); System.out.println(&quot;Date after 1 year : &quot; + nextYear); è¾“å‡ºï¼š Date before 1 year : 2013-01-14Date after 1 year : 2015-01-14 ä¾‹å­ç»“æœå¾—åˆ°äº†ä¸¤ä¸ªæ—¥æœŸï¼Œä¸€ä¸ª2013å¹´ã€ä¸€ä¸ª2015å¹´ã€åˆ†åˆ«æ˜¯2014å¹´çš„å‰ä¸€å¹´å’Œåä¸€å¹´ã€‚ 10ã€ä½¿ç”¨Clockæ—¶é’Ÿç±»Java 8å¢åŠ äº†ä¸€ä¸ªClockæ—¶é’Ÿç±»ç”¨äºè·å–å½“æ—¶çš„æ—¶é—´æˆ³ï¼Œæˆ–å½“å‰æ—¶åŒºä¸‹çš„æ—¥æœŸæ—¶é—´ä¿¡æ¯ã€‚ä»¥å‰ç”¨åˆ°System.currentTimeMillis()å’ŒTimeZone.getDefault()çš„åœ°æ–¹éƒ½å¯ç”¨Clockæ›¿æ¢ã€‚ // Returns the current time based on your system clock and set to UTC. Clock clock = Clock.systemUTC(); System.out.println(&quot;Clock : &quot; + clock); // Returns time based on system clock zone Clock defaultClock = Clock.systemDefaultZone(); System.out.println(&quot;Clock : &quot; + clock); è¾“å‡ºï¼š Clock : SystemClock[Z]Clock : SystemClock[Z] è¿˜å¯ä»¥é’ˆå¯¹clockæ—¶é’Ÿåšæ¯”è¾ƒï¼Œåƒä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š public class MyClass { private Clock clock; // dependency inject ... public void process(LocalDate eventDate) { if (eventDate.isBefore(LocalDate.now(clock)) { ... } } } è¿™ç§æ–¹å¼åœ¨ä¸åŒæ—¶åŒºä¸‹å¤„ç†æ—¥æœŸæ—¶ä¼šéå¸¸ç®¡ç”¨ã€‚ 11ã€æ¯”è¾ƒæ—¥æœŸå¦ä¸€ä¸ªå·¥ä½œä¸­å¸¸è§çš„æ“ä½œå°±æ˜¯å¦‚ä½•åˆ¤æ–­ç»™å®šçš„ä¸€ä¸ªæ—¥æœŸæ˜¯å¤§äºæŸå¤©è¿˜æ˜¯å°äºæŸå¤©ï¼Ÿåœ¨Java 8ä¸­ï¼ŒLocalDateç±»æœ‰ä¸¤ç±»æ–¹æ³•isBefore()å’ŒisAfter()ç”¨äºæ¯”è¾ƒæ—¥æœŸã€‚è°ƒç”¨isBefore()æ–¹æ³•æ—¶ï¼Œå¦‚æœç»™å®šæ—¥æœŸå°äºå½“å‰æ—¥æœŸåˆ™è¿”å›trueã€‚ LocalDate tomorrow = LocalDate.of(2014, 1, 15); if(tommorow.isAfter(today)){ System.out.println(&quot;Tomorrow comes after today&quot;); } LocalDate yesterday = today.minus(1, DAYS); if(yesterday.isBefore(today)){ System.out.println(&quot;Yesterday is day before today&quot;); } è¾“å‡ºï¼š Tomorrow comes after todayYesterday is day before today åœ¨Java 8ä¸­æ¯”è¾ƒæ—¥æœŸéå¸¸æ–¹ä¾¿ï¼Œä¸éœ€è¦ä½¿ç”¨é¢å¤–çš„Calendarç±»æ¥åšè¿™äº›åŸºç¡€å·¥ä½œäº†ã€‚ 12ã€å¤„ç†æ—¶åŒºJava 8ä¸ä»…åˆ†ç¦»äº†æ—¥æœŸå’Œæ—¶é—´ï¼Œä¹ŸæŠŠæ—¶åŒºåˆ†ç¦»å‡ºæ¥äº†ã€‚ç°åœ¨æœ‰ä¸€ç³»åˆ—å•ç‹¬çš„ç±»å¦‚ZoneIdæ¥å¤„ç†ç‰¹å®šæ—¶åŒºï¼ŒZoneDateTimeç±»æ¥è¡¨ç¤ºæŸæ—¶åŒºä¸‹çš„æ—¶é—´ã€‚è¿™åœ¨Java 8ä»¥å‰éƒ½æ˜¯ GregorianCalendarç±»æ¥åšçš„ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•æŠŠæœ¬æ—¶åŒºçš„æ—¶é—´è½¬æ¢æˆå¦ä¸€ä¸ªæ—¶åŒºçš„æ—¶é—´ã€‚ // Date and time with timezone in Java 8 ZoneId america = ZoneId.of(&quot;America/New_York&quot;); LocalDateTime localtDateAndTime = LocalDateTime.now(); ZonedDateTime dateAndTimeInNewYork = ZonedDateTime.of(localtDateAndTime, america ); System.out.println(&quot;Current date and time in a particular timezone : &quot; + dateAndTimeInNewYork); è¾“å‡ºï¼š Current date and time in a particular timezone : 2014-01-14T16:33:33.373-05:00[America/New_York] å’Œä»¥å‰ä½¿ç”¨GMTçš„æ–¹å¼è½¬æ¢æœ¬åœ°æ—¶é—´å¯¹æ¯”ä¸€ä¸‹ã€‚æ³¨æ„ï¼Œåœ¨Java 8ä»¥å‰ï¼Œä¸€å®šè¦ç‰¢ç‰¢è®°ä½æ—¶åŒºçš„åç§°ï¼Œä¸ç„¶å°±ä¼šæŠ›å‡ºä¸‹é¢çš„å¼‚å¸¸ï¼š Exception in thread &quot;main&quot; java.time.zone.ZoneRulesException: Unknown time-zone ID: ASIA/Tokyo at java.time.zone.ZoneRulesProvider.getProvider(ZoneRulesProvider.java:272) at java.time.zone.ZoneRulesProvider.getRules(ZoneRulesProvider.java:227) at java.time.ZoneRegion.ofId(ZoneRegion.java:120) at java.time.ZoneId.of(ZoneId.java:403) at java.time.ZoneId.of(ZoneId.java:351) 13ã€å¦‚ä½•è¡¨ç¤ºåˆ°æœŸæ—¥æœŸç­”æ¡ˆå°±æ˜¯ä½¿ç”¨YearMonthï¼Œä¸ MonthDayæ£€æŸ¥é‡å¤äº‹ä»¶çš„ä¾‹å­ç›¸ä¼¼ï¼ŒYearMonthæ˜¯å¦ä¸€ä¸ªç»„åˆç±»ï¼Œç”¨äºè¡¨ç¤ºä¿¡ç”¨å¡åˆ°æœŸæ—¥ã€FDåˆ°æœŸæ—¥ã€æœŸè´§æœŸæƒåˆ°æœŸæ—¥ç­‰ã€‚è¿˜å¯ä»¥ç”¨è¿™ä¸ªç±»å¾—åˆ° å½“æœˆå…±æœ‰å¤šå°‘å¤©ï¼ŒYearMonthå®ä¾‹çš„lengthOfMonth()æ–¹æ³•å¯ä»¥è¿”å›å½“æœˆçš„å¤©æ•°ï¼Œåœ¨åˆ¤æ–­2æœˆæœ‰28å¤©è¿˜æ˜¯29å¤©æ—¶éå¸¸æœ‰ç”¨ã€‚ YearMonth currentYearMonth = YearMonth.now(); System.out.printf(&quot;Days in month year %s: %d%n&quot;, currentYearMonth, currentYearMonth.lengthOfMonth()); YearMonth creditCardExpiry = YearMonth.of(2018, Month.FEBRUARY); System.out.printf(&quot;Your credit card expires on %s %n&quot;, creditCardExpiry); è¾“å‡ºï¼š Days in month year 2014-01: 31Your credit card expires on 2018-02 æ ¹æ®ä¸Šè¿°æ•°æ®ï¼Œä½ å¯ä»¥æé†’å®¢æˆ·ä¿¡ç”¨å¡å¿«è¦åˆ°æœŸäº†ï¼Œä¸ªäººè®¤ä¸ºè¿™ä¸ªç±»éå¸¸æœ‰ç”¨ã€‚ 14ã€æ£€æŸ¥æ˜¯å¦æ˜¯é—°å¹´LocalDateç±»æœ‰ä¸€ä¸ªå¾ˆå®ç”¨çš„æ–¹æ³•isLeapYear()åˆ¤æ–­è¯¥å®ä¾‹æ˜¯å¦æ˜¯ä¸€ä¸ªé—°å¹´ï¼Œå¦‚æœä½ è¿˜æ˜¯æƒ³é‡æ–°å‘æ˜è½®å­ï¼Œè¿™æœ‰ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼Œçº¯Javaé€»è¾‘ç¼–å†™çš„åˆ¤æ–­é—°å¹´çš„ç¨‹åºã€‚ if(today.isLeapYear()){ System.out.println(&quot;This year is Leap year&quot;); }else { System.out.println(&quot;2014 is not a Leap year&quot;); } è¾“å‡ºï¼š 2014 is not a Leap year ä½ å¯ä»¥å¤šå†™å‡ ä¸ªæ—¥æœŸæ¥éªŒè¯æ˜¯å¦æ˜¯é—°å¹´ï¼Œæœ€å¥½æ˜¯å†™JUnitå•å…ƒæµ‹è¯•åšåˆ¤æ–­ã€‚ 15ã€æ±‚ä¸¤ä¸ªæ—¥æœŸé—´éš”å¤©æ•°æœ‰ä¸€ä¸ªå¸¸è§æ—¥æœŸæ“ä½œæ˜¯è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°ã€å‘¨æ•°æˆ–æœˆæ•°ã€‚åœ¨Java 8ä¸­å¯ä»¥ç”¨java.time.Periodç±»æ¥åšè®¡ç®—ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¡ç®—äº†å½“å¤©å’Œå°†æ¥æŸä¸€å¤©ä¹‹é—´çš„æœˆæ•°ã€‚ LocalDate java8Release = LocalDate.of(2014, Month.MARCH, 14); Period periodToNextJavaRelease = Period.between(today, java8Release); System.out.println(&quot;Months left between today and Java 8 release : &quot; + periodToNextJavaRelease.getMonths() ); è¾“å‡ºï¼š Months left between today and Java 8 release : 2 ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ç°åœ¨æ˜¯ä¸€æœˆï¼ŒJava 8çš„å‘å¸ƒæ—¥æœŸæ˜¯3æœˆï¼Œä¸­é—´ç›¸éš”ä¸¤ä¸ªæœˆã€‚ 16ã€è·å–æ—¶åŒºçš„æ—¶å·®åœ¨Java 8ä¸­ï¼ŒZoneOffsetç±»ç”¨æ¥è¡¨ç¤ºæ—¶åŒºï¼Œä¸¾ä¾‹æ¥è¯´å°åº¦ä¸GMTæˆ–UTCæ ‡å‡†æ—¶åŒºç›¸å·®+05:30ï¼Œå¯ä»¥é€šè¿‡ZoneOffset.of()é™æ€æ–¹æ³•æ¥ è·å–å¯¹åº”çš„æ—¶åŒºã€‚ä¸€æ—¦å¾—åˆ°äº†æ—¶å·®å°±å¯ä»¥é€šè¿‡ä¼ å…¥LocalDateTimeå’ŒZoneOffsetæ¥åˆ›å»ºä¸€ä¸ªOffSetDateTimeå¯¹è±¡ã€‚ LocalDateTime datetime = LocalDateTime.of(2014, Month.JANUARY, 14, 19, 30); ZoneOffset offset = ZoneOffset.of(&quot;+05:30&quot;); OffsetDateTime date = OffsetDateTime.of(datetime, offset); System.out.println(&quot;Date and Time with timezone offset in Java : &quot; + date); è¾“å‡ºï¼š Date and Time with timezone offset in Java : 2014-01-14T19:30+05:30 ç°åœ¨çš„æ—¶é—´ä¿¡æ¯é‡Œå·²ç»åŒ…å«äº†æ—¶åŒºä¿¡æ¯äº†ã€‚æ³¨æ„ï¼šOffSetDateTimeæ˜¯å¯¹è®¡ç®—æœºå‹å¥½çš„ï¼ŒZoneDateTimeåˆ™å¯¹äººæ›´å‹å¥½ã€‚ 17ã€è·å–å½“å‰çš„æ—¶é—´æˆ³å¦‚æœä½ è¿˜è®°å¾—Java 8ä»¥å‰æ˜¯å¦‚ä½•è·å¾—å½“å‰æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆç°åœ¨ä½ ç»ˆäºè§£è„±äº†ã€‚Instantç±»æœ‰ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•now()ä¼šè¿”å›å½“å‰çš„æ—¶é—´æˆ³ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Instant timestamp = Instant.now(); System.out.println(&quot;What is value of this instant &quot; + timestamp); è¾“å‡ºï¼š What is value of this instant 2014-01-14T08:33:33.379Z æ—¶é—´æˆ³ä¿¡æ¯é‡ŒåŒæ—¶åŒ…å«äº†æ—¥æœŸå’Œæ—¶é—´ï¼Œè¿™å’Œjava.util.Dateå¾ˆåƒã€‚å®é™…ä¸ŠInstantç±»ç¡®å®ç­‰åŒäº Java 8ä¹‹å‰çš„Dateç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨Dateç±»å’ŒInstantç±»å„è‡ªçš„è½¬æ¢æ–¹æ³•äº’ç›¸è½¬æ¢ï¼Œä¾‹å¦‚ï¼šDate.from(Instant) å°†Instantè½¬æ¢æˆjava.util.Dateï¼ŒDate.toInstant()åˆ™æ˜¯å°†Dateç±»è½¬æ¢æˆInstantç±»ã€‚ 18ã€æ—¥æœŸæ ¼å¼åŒ–åœ¨Java 8ä»¥å‰çš„ä¸–ç•Œé‡Œï¼Œæ—¥æœŸå’Œæ—¶é—´çš„æ ¼å¼åŒ–éå¸¸è¯¡å¼‚ï¼Œå”¯ä¸€çš„å¸®åŠ©ç±»SimpleDateFormatä¹Ÿæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”ç”¨ä½œå±€éƒ¨å˜é‡è§£æå’Œæ ¼å¼åŒ–æ—¥æœŸæ—¶æ˜¾å¾—å¾ˆç¬¨é‡ã€‚å¹¸å¥½çº¿ç¨‹å±€éƒ¨å˜é‡èƒ½ä½¿å®ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å˜å¾—å¯ç”¨ï¼Œä¸è¿‡è¿™éƒ½æ˜¯è¿‡å»æ—¶äº†ã€‚Java 8å¼•å…¥äº†å…¨æ–°çš„æ—¥æœŸæ—¶é—´æ ¼å¼å·¥å…·ï¼Œçº¿ç¨‹å®‰å…¨è€Œä¸”ä½¿ç”¨æ–¹ä¾¿ã€‚å®ƒè‡ªå¸¦äº†ä¸€äº›å¸¸ç”¨çš„å†…ç½®æ ¼å¼åŒ–å·¥å…·ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†BASIC_ISO_DATEæ ¼å¼åŒ–å·¥å…·å°†2014å¹´1æœˆ14æ—¥æ ¼å¼åŒ–æˆ20140114ã€‚ String dayAfterTommorrow = &quot;20140116&quot;; LocalDate formatted = LocalDate.parse(dayAfterTommorrow, DateTimeFormatter.BASIC_ISO_DATE); System.out.printf(&quot;Date generated from String %s is %s %n&quot;, dayAfterTommorrow, formatted); è¾“å‡ºï¼š Date generated from String 20140116 is 2014-01-16 å¾ˆæ˜æ˜¾çš„çœ‹å‡ºå¾—åˆ°çš„æ—¥æœŸå’Œç»™å‡ºçš„æ—¥æœŸæ˜¯åŒä¸€å¤©ï¼Œä½†æ˜¯æ ¼å¼ä¸åŒã€‚ 19ã€æ—¥æœŸè§£æä¸Š ä¸ªä¾‹å­ä½¿ç”¨äº†Javaå†…ç½®çš„æ ¼å¼åŒ–å·¥å…·å»è§£ææ—¥æœŸå­—ç¬¦ä¸²ã€‚å°½ç®¡å†…ç½®æ ¼å¼åŒ–å·¥å…·å¾ˆå¥½ç”¨ï¼Œæœ‰æ—¶è¿˜æ˜¯éœ€è¦å®šä¹‰ç‰¹å®šçš„æ—¥æœŸæ ¼å¼ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰ æ—¥æœŸæ ¼å¼åŒ–å·¥å…·ã€‚ä¾‹å­ä¸­çš„æ—¥æœŸæ ¼å¼æ˜¯â€œMMM dd yyyyâ€ã€‚å¯ä»¥è°ƒç”¨DateTimeFormatterçš„ ofPattern()é™æ€æ–¹æ³•å¹¶ä¼ å…¥ä»»æ„æ ¼å¼è¿”å›å…¶å®ä¾‹ï¼Œæ ¼å¼ä¸­çš„å­—ç¬¦å’Œä»¥å‰ä»£è¡¨çš„ä¸€æ ·ï¼ŒM ä»£è¡¨æœˆï¼Œmä»£è¡¨åˆ†ã€‚å¦‚æœæ ¼å¼ä¸è§„èŒƒä¼šæŠ›å‡º DateTimeParseExceptionå¼‚å¸¸ï¼Œä¸è¿‡å¦‚æœåªæ˜¯æŠŠMå†™æˆmè¿™ç§é€»è¾‘é”™è¯¯æ˜¯ä¸ä¼šæŠ›å¼‚å¸¸çš„ã€‚ String goodFriday = &quot;Apr 18 2014&quot;; try { DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;MMM dd yyyy&quot;); LocalDate holiday = LocalDate.parse(goodFriday, formatter); System.out.printf(&quot;Successfully parsed String %s, date is %s%n&quot;, goodFriday, holiday); } catch (DateTimeParseException ex) { System.out.printf(&quot;%s is not parsable!%n&quot;, goodFriday); ex.printStackTrace(); } è¾“å‡ºï¼š Successfully parsed String Apr 18 2014, date is 2014-04-18 æ—¥æœŸå€¼ä¸ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯åŒ¹é…çš„ï¼Œåªæ˜¯æ ¼å¼ä¸åŒè€Œå·²ã€‚ 20ã€æŠŠæ—¥æœŸè½¬æ¢æˆå­—ç¬¦ä¸²ä¸Š ä¸¤ä¸ªä¾‹å­éƒ½ç”¨åˆ°äº†DateTimeFormatterç±»ï¼Œä¸»è¦æ˜¯ä»å­—ç¬¦ä¸²è§£ææ—¥æœŸã€‚ç°åœ¨æˆ‘ä»¬åè¿‡æ¥ï¼ŒæŠŠLocalDateTimeæ—¥æœŸå®ä¾‹è½¬æ¢æˆç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚è¿™æ˜¯è¿„ä»Šä¸ºæ­¢Javaæ—¥æœŸè½¬å­—ç¬¦ä¸²æœ€ä¸ºç®€å•çš„æ–¹å¼äº†ã€‚ä¸‹é¢çš„ä¾‹å­å°†è¿”å›ä¸€ä¸ªä»£è¡¨æ—¥æœŸçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å’Œå‰é¢ç±»ä¼¼ï¼Œè¿˜æ˜¯éœ€è¦åˆ›å»º DateTimeFormatterå®ä¾‹å¹¶ä¼ å…¥æ ¼å¼ï¼Œä½†è¿™å›è°ƒç”¨çš„æ˜¯format()æ–¹æ³•ï¼Œè€Œéparse()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæŠŠä¼ å…¥çš„æ—¥æœŸè½¬åŒ–æˆæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ LocalDateTime arrivalDate = LocalDateTime.now(); try { DateTimeFormatter format = DateTimeFormatter.ofPattern(&quot;MMM dd yyyy hh:mm a&quot;); String landing = arrivalDate.format(format); System.out.printf(&quot;Arriving at : %s %n&quot;, landing); } catch (DateTimeException ex) { System.out.printf(&quot;%s can&#39;t be formatted!%n&quot;, arrivalDate); ex.printStackTrace(); } è¾“å‡ºï¼š Arriving at : Jan 14 2014 04:33 PM å½“å‰æ—¶é—´è¢«æŒ‡å®šçš„â€œMMM dd yyyy hh:mm aâ€æ ¼å¼æ ¼å¼åŒ–ï¼Œæ ¼å¼åŒ…å«3ä¸ªä»£è¡¨æœˆçš„å­—ç¬¦ä¸²ï¼Œæ—¶é—´åé¢å¸¦æœ‰AMå’ŒPMæ ‡è®°ã€‚ Java 8æ—¥æœŸæ—¶é—´APIçš„é‡ç‚¹é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ è‚¯å®šå·²ç»æŒæ¡äº†Java 8æ—¥æœŸæ—¶é—´APIçš„æ–°çŸ¥è¯†ç‚¹ã€‚ç°åœ¨æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹è¿™ä¸ªä¼˜é›…APIçš„ä½¿ç”¨è¦ç‚¹ï¼š æä¾›äº†javax.time.ZoneId è·å–æ—¶åŒºã€‚ æä¾›äº†LocalDateå’ŒLocalTimeç±»ã€‚ Java 8 çš„æ‰€æœ‰æ—¥æœŸå’Œæ—¶é—´APIéƒ½æ˜¯ä¸å¯å˜ç±»å¹¶ä¸”çº¿ç¨‹å®‰å…¨ï¼Œè€Œç°æœ‰çš„Dateå’ŒCalendar APIä¸­çš„java.util.Dateå’ŒSimpleDateFormatæ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚ ä¸»åŒ…æ˜¯ java.time,åŒ…å«äº†è¡¨ç¤ºæ—¥æœŸã€æ—¶é—´ã€æ—¶é—´é—´éš”çš„ä¸€äº›ç±»ã€‚é‡Œé¢æœ‰ä¸¤ä¸ªå­åŒ…java.time.formatç”¨äºæ ¼å¼åŒ–ï¼Œ java.time.temporalç”¨äºæ›´åº•å±‚çš„æ“ä½œã€‚ æ—¶åŒºä»£è¡¨äº†åœ°çƒä¸ŠæŸä¸ªåŒºåŸŸå†…æ™®éä½¿ç”¨çš„æ ‡å‡†æ—¶é—´ã€‚æ¯ä¸ªæ—¶åŒºéƒ½æœ‰ä¸€ä¸ªä»£å·ï¼Œæ ¼å¼é€šå¸¸ç”±åŒºåŸŸ/åŸå¸‚æ„æˆï¼ˆAsia/Tokyoï¼‰ï¼Œåœ¨åŠ ä¸Šä¸æ ¼æ—å¨æ²»æˆ– UTCçš„æ—¶å·®ã€‚ä¾‹å¦‚ï¼šä¸œäº¬çš„æ—¶å·®æ˜¯+09:00ã€‚ OffsetDateTimeç±»å®é™…ä¸Šç»„åˆäº†LocalDateTimeç±»å’ŒZoneOffsetç±»ã€‚ç”¨æ¥è¡¨ç¤ºåŒ…å«å’Œæ ¼æ—å¨æ²»æˆ–UTCæ—¶å·®çš„å®Œæ•´æ—¥æœŸï¼ˆå¹´ã€æœˆã€æ—¥ï¼‰å’Œæ—¶é—´ï¼ˆæ—¶ã€åˆ†ã€ç§’ã€çº³ç§’ï¼‰ä¿¡æ¯ã€‚ DateTimeFormatter ç±»ç”¨æ¥æ ¼å¼åŒ–å’Œè§£ææ—¶é—´ã€‚ä¸SimpleDateFormatä¸åŒï¼Œè¿™ä¸ªç±»ä¸å¯å˜å¹¶ä¸”çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦æ—¶å¯ä»¥ç»™é™æ€å¸¸é‡èµ‹å€¼ã€‚ DateTimeFormatterç±»æä¾›äº†å¤§é‡çš„å†…ç½®æ ¼å¼åŒ–å·¥å…·ï¼ŒåŒæ—¶ä¹Ÿå…è®¸ä½ è‡ªå®šä¹‰ã€‚åœ¨è½¬æ¢æ–¹é¢ä¹Ÿæä¾›äº†parse()å°†å­—ç¬¦ä¸²è§£ææˆæ—¥æœŸï¼Œå¦‚æœè§£æå‡ºé”™ä¼šæŠ›å‡ºDateTimeParseExceptionã€‚DateTimeFormatterç±»åŒæ—¶è¿˜æœ‰format()ç”¨æ¥æ ¼å¼åŒ–æ—¥æœŸï¼Œå¦‚æœå‡ºé”™ä¼šæŠ›å‡ºDateTimeExceptionå¼‚å¸¸ã€‚ å†è¡¥å……ä¸€ç‚¹ï¼Œæ—¥æœŸæ ¼å¼â€œMMM d yyyyâ€å’Œâ€œMMM dd yyyyâ€æœ‰ä¸€äº›å¾®å¦™çš„ä¸åŒï¼Œç¬¬ä¸€ä¸ªæ ¼å¼å¯ä»¥è§£æâ€œJan 2 2014â€å’Œâ€œJan 14 2014â€ï¼Œè€Œç¬¬äºŒä¸ªåœ¨è§£æâ€œJan 2 2014â€å°±ä¼šæŠ›å¼‚å¸¸ï¼Œå› ä¸ºç¬¬äºŒä¸ªæ ¼å¼é‡Œè¦æ±‚æ—¥å¿…é¡»æ˜¯ä¸¤ä½çš„ã€‚å¦‚æœæƒ³ä¿®æ­£ï¼Œä½ å¿…é¡»åœ¨æ—¥æœŸåªæœ‰ä¸ªä½æ•°æ—¶åœ¨å‰é¢è¡¥é›¶ï¼Œå°±æ˜¯è¯´â€œJan 2 2014â€åº”è¯¥å†™æˆ â€œJan 02 2014â€ã€‚ å¦‚ä½•ä½¿ç”¨Java 8çš„å…¨æ–°æ—¥æœŸæ—¶é—´APIå°±ä»‹ç»åˆ°è¿™äº†ã€‚è¿™äº›ç®€å•çš„ä¾‹å­å¯¹å¸®åŠ©ç†è§£æ–°APIéå¸¸æœ‰ç”¨ã€‚ç”±äºè¿™äº›ä¾‹å­éƒ½åŸºäºçœŸå®ä»»åŠ¡ï¼Œä½ åœ¨åšJavaæ—¥æœŸç¼–ç¨‹æ—¶ä¸ç”¨å†ä¸œå¼ è¥¿æœ›äº†ã€‚æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•åˆ›å»ºå¹¶æ“ä½œæ—¥æœŸå®ä¾‹ï¼Œå­¦ä¹ äº†çº¯æ—¥æœŸã€ä»¥åŠåŒ…å«æ—¶é—´ä¿¡æ¯å’Œæ—¶å·®ä¿¡æ¯çš„æ—¥æœŸã€å­¦ä¼šäº†æ€æ ·è®¡ç®—ä¸¤ä¸ªæ—¥æœŸçš„é—´éš”ï¼Œè¿™äº›åœ¨è®¡ç®—å½“å¤©ä¸æŸä¸ªç‰¹å®šæ—¥æœŸé—´éš”çš„ä¾‹å­ä¸­éƒ½æœ‰æ‰€å±•ç¤ºã€‚ æˆ‘ä»¬è¿˜å­¦åˆ°äº†åœ¨Java 8ä¸­å¦‚ä½•çº¿ç¨‹å®‰å…¨åœ°è§£æå’Œæ ¼å¼åŒ–æ—¥æœŸï¼Œä¸ç”¨å†ä½¿ç”¨è¹©è„šçš„çº¿ç¨‹å±€éƒ¨å˜é‡æŠ€å·§ï¼Œä¹Ÿä¸ç”¨ä¾èµ–Joda Timeç¬¬ä¸‰æ–¹åº“ã€‚æ–°APIå¯ä»¥ä½œä¸ºå¤„ç†æ—¥æœŸæ—¶é—´æ“ä½œçš„æ ‡å‡†ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,æ—¥æœŸ","slug":"Java-æ—¥æœŸ","permalink":"/tags/Java-æ—¥æœŸ/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰§è¡Œbatå’Œshell&å‚æ•°å¤„ç†","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰§è¡Œbatå’Œshell&å‚æ•°å¤„ç†","date":"2020-06-06T08:56:10.000Z","updated":"2023-04-30T10:21:41.352Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰§è¡Œbatå’Œshell&å‚æ•°å¤„ç†/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--æ‰§è¡Œbatå’Œshell&å‚æ•°å¤„ç†/","excerpt":"","text":"ä¹‹å‰æƒ³ç€åœ¨windowsä¸‹å’Œlinuxä¸‹è°ƒç”¨ä¸€äº›python Scrapyçš„æ¥å£ï¼Œå‘ç°è·¯å¾„é—®é¢˜ï¼Œä¼ å‚æ•°é—®é¢˜éƒ½æŒºéº»çƒ¦ï¼Œé‚æ”¹ä¸ºåœ¨batæ–‡ä»¶å’Œshellä¸­å…·ä½“å†™æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œä»–ä»¬å°±å¥½äº† 1.æ‰§è¡Œbatè„šæœ¬(1)ä¼ å…¥å‚æ•°batå¤„ç†æ–‡ä»¶ä¸­å¯å¼•ç”¨çš„å‚æ•°ä¸º%0~%9ï¼Œ%0æ˜¯æŒ‡æ‰¹å¤„ç†æ–‡ä»¶çš„æœ¬èº«ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¤–éƒ¨å‘½ä»¤ï¼›%1~%9æ˜¯æ‰¹å¤„ç†å‚æ•°ï¼Œä¹Ÿç§°å½¢å‚ï¼Œä¾‹å¦‚ï¼šæ–°å»ºä¸€ä¸ªæ–‡ä»¶test_argv.batï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š @echo off echo param[0] = %0 echo param[1] = %1 echo param[2] = %2 echo param[3] = %3 echo param[4] = %4 echo param[5] = %5 echo ... pause è°ƒç”¨æ—¶åªéœ€è¦åœ¨æ‰§è¡Œbatæ–‡ä»¶ååŠ ä¸Šå‚æ•°å³å¯ï¼Œè®°å¾—å‚æ•°é—´æœ‰ç©ºæ ¼ test_argv.bat 1 game test what æ­¤æ—¶è¾“å‡ºï¼š param[0] = test_argv.bat param[1] = 1 param[2] = game param[3] = test param[4] = what param[5] = â€¦ è¯·æŒ‰ä»»æ„é”®ç»§ç»­â€¦ (2)è°ƒç”¨æœ€ç®€å•çš„è°ƒç”¨ Runtime.getRuntime().exec(&quot;D:\\\\aaa\\\\remoteDesktop\\\\remoteConnection.bat&quot;); è¿™æ ·è°ƒç”¨æ˜¯ä¸ä¼šæœ‰å›æ˜¾çš„ï¼Œå¦‚æœä½ éœ€è¦çœ‹åˆ°è¿”å›ç»“æœï¼Œå°±éœ€è¦è¿™æ ·ï¼š try { // æ‰§è¡Œpingå‘½ä»¤ Process process = Runtime.getRuntime().exec(&quot;cmd /c e:&amp;dir&quot;); BufferedReader br = new BufferedReader(new InputStreamReader(process.getInputStream(), Charset.forName(&quot;GBK&quot;))); String line = null; while ((line = br.readLine()) != null) { System.out.println(line); } } catch (IOException e) { e.printStackTrace(); } æ³¨æ„åˆ°äº†å—ï¼Œè¿™æ¬¡çš„execå‡½æ•°ä¸æ˜¯ç®€å•çš„é€‰æ‹©batæ–‡ä»¶çš„è·¯å¾„ï¼Œå¤šäº†â€œcmd /câ€ è¿™ä¸ªå‰ç¼€æœ‰ä»¥ä¸‹ä½¿ç”¨æ–¹å¼ï¼š cmd /c dir æ˜¯æ‰§è¡Œå®Œdirå‘½ä»¤åå…³é—­å‘½ä»¤çª—å£ã€‚ cmd /k dir æ˜¯æ‰§è¡Œå®Œdirå‘½ä»¤åä¸å…³é—­å‘½ä»¤çª—å£ã€‚ cmd /c start dir ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çª—å£åæ‰§è¡ŒdiræŒ‡ä»¤ï¼ŒåŸçª—å£ä¼šå…³é—­ã€‚ cmd /k start dir ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çª—å£åæ‰§è¡ŒdiræŒ‡ä»¤ï¼ŒåŸçª—å£ä¸ä¼šå…³é—­ã€‚ æ³¨æ„ï¼šç¬¬äºŒä¸ªè°ƒç”¨æ–¹å¼åœ¨batçš„è¾“å‡ºå†…å®¹è¿‡é•¿æ—¶ï¼Œä¼šå¡æ­»ï¼ï¼ï¼T_T ç½‘ä¸Šçš„è§£é‡Šè¯´â€œå› ä¸ºæœ¬åœ°è¿›ç¨‹è¾“å…¥è¾“å‡ºç¼“å­˜æœ‰é™ï¼Œä½ ä¸å¿«ç‚¹è¯»å–çš„è¯Processå°±æŒ‚åœ¨é‚£äº†ã€‚â€ æ‰€ä»¥éœ€è¦å¼€ä¸€ä¸ªè¿›ç¨‹å»ä¸æ–­çš„å–æ•°æ®ï¼Œå…·ä½“å®ç°æ–¹å¼è§ ï¼šhttps://blog.csdn.net/aerchi/article/details/7669215 ã€‚è¿™ä¸ªæˆ‘æ²¡æœ‰æ£€æµ‹ï¼Œå› ä¸ºæˆ‘å‘ç°ï¼Œå¦‚æœbatè¾“å‡ºçš„å†…å®¹è¿‡é•¿æ—¶ï¼Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼Œä¸ä¼šå¡æ­»ï¼Œè‹¥æ˜¯æƒ³çœ‹åˆ°è¾“å‡º å¯ä»¥åŠ å‰ç¼€cmd /k startï¼Œè‹¥æ˜¯æƒ³æŠŠè¾“å‡ºå­˜èµ·æ¥ å°±åŠ ä¸Šåç¼€&gt;&gt; 1.txtï¼Œå°±å¥½äº†ï¼Œæ¯•ç«Ÿè¿˜è¦å¼€çº¿ç¨‹å¤ªç¹çã€‚ 2.æ‰§è¡Œshellæ–‡ä»¶(1)ä¼ å…¥å‚æ•°shellè„šæœ¬ä¼ å…¥å‚æ•°ä¸batåŸºæœ¬ä¸€è‡´ï¼Œåªä¸è¿‡å½¢å‚å˜æˆäº†$1,,$2,$3â€¦.. ä¾‹å¦‚ï¼Œè„šæœ¬test.shçš„å†…å®¹å¦‚ä¸‹ï¼š name=$1 echo &quot;the ${name} are great man!&quot; æ‰§è¡Œ./test.sh Xiao Mingå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è‡ªå·±ç¼–å†™è„šæœ¬çš„ç»“æœ `the Xiao Ming are great man! (2)è°ƒç”¨linuxç¯å¢ƒæœç„¶å‹å¥½å¾—å¤šï¼Œå°è£…å¥½äº†ä»¥ä¸‹ä»£ç ï¼Œä¼ å…¥shellæ–‡ä»¶çš„è·¯å¾„å°±å¥½äº† public static String linuxShellexec(String shellPath) { String result=&quot;&quot;; try { Process ps = Runtime.getRuntime().exec(shellPath); ps.waitFor(); BufferedReader br = new BufferedReader(new InputStreamReader(ps.getInputStream())); StringBuffer sb = new StringBuffer(); String line; while ((line = br.readLine()) != null) { sb.append(line).append(&quot;\\n&quot;); } result = sb.toString(); } catch (Exception e) { e.printStackTrace(); result=&quot;linuxä¸‹è¿è¡Œå®Œæ¯•&quot;; } return result; } å‚è€ƒæ–‡ç« https://www.cnblogs.com/happyPawpaw/p/3740903.html https://blog.csdn.net/zyf_balance/article/details/51692065 https://blog.csdn.net/aerchi/article/details/7669215 https://blog.csdn.net/a1010256340/article/details/76187353 https://www.cnblogs.com/abel-hefei/p/7284256.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,bat,shell,å‚æ•°","slug":"Java-bat-shell-å‚æ•°","permalink":"/tags/Java-bat-shell-å‚æ•°/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--floatä¿ç•™å¤šä½å°æ•°","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--floatä¿ç•™å¤šä½å°æ•°","date":"2020-06-06T08:55:10.000Z","updated":"2023-04-30T10:21:41.345Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--floatä¿ç•™å¤šä½å°æ•°/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--floatä¿ç•™å¤šä½å°æ•°/","excerpt":"","text":"æ–¹æ³•1ç”¨Math.roundè®¡ç®—,è¿™é‡Œè¿”å›çš„æ•°å­—æ ¼å¼çš„ã€‚ float price=89.89; int itemNum=3; float totalPrice=price*itemNum; float num=(float)(Math.round(totalPrice*100)/100);//å¦‚æœè¦æ±‚ç²¾ç¡®4ä½å°±*10000ç„¶å/10000 æ–¹æ³•2ç”¨DecimalFormat è¿”å›çš„æ˜¯Stringæ ¼å¼çš„.è¯¥ç±»å¯¹åè¿›åˆ¶è¿›è¡Œå…¨é¢çš„å°è£…ã€‚åƒ%å·,åƒåˆ†ä½ï¼Œå°æ•°ç²¾åº¦ï¼Œç§‘å­¦è®¡ç®—ã€‚ float price=1.2; DecimalFormat decimalFormat=new DecimalFormat(&quot;.00&quot;);//æ„é€ æ–¹æ³•çš„å­—ç¬¦æ ¼å¼è¿™é‡Œå¦‚æœå°æ•°ä¸è¶³2ä½,ä¼šä»¥0è¡¥è¶³. String p=decimalFomat.format(price);//format è¿”å›çš„æ˜¯å­—ç¬¦ä¸² ä¸ªäººè§‰å¾—åœ¨å‰å°æ˜¾ç¤ºé‡‘é¢æ–¹é¢çš„è¿˜æ˜¯ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚ç†ç”±å¾ˆç®€å•æ˜¯å­—ç¬¦ä¸²æ ¼å¼çš„ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,float,ä¿ç•™å°æ•°","slug":"Java-float-ä¿ç•™å°æ•°","permalink":"/tags/Java-float-ä¿ç•™å°æ•°/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--IOæµ","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--IOæµ","date":"2020-06-06T08:54:10.000Z","updated":"2023-04-30T10:21:41.341Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--IOæµ/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--IOæµ/","excerpt":"","text":"åœ¨Javaä¸­ï¼Œå¯¹äºæ•°æ®çš„è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰æ“ä½œä»¥â€œæµâ€ï¼ˆstreamï¼‰æ–¹å¼è¿›è¡Œï¼Œæ•°æ®çš„æ¥æºå¯ä»¥æ˜¯æ–‡ä»¶ã€ç½‘ç»œã€å†…å­˜ç¼“å­˜ç­‰ã€‚ ä¸€ã€JavaIOæµçš„åˆ†ç±»J2SDKæä¾›äº†å„ç§å„æ ·çš„â€œæµâ€ï¼Œç”¨ä»¥æ“ä½œä¸åŒç§ç±»çš„æ•°æ®ï¼ŒJ2SDKæ‰€æä¾›çš„æ‰€æœ‰æµéƒ½ä½äºjava.ioåŒ…å†…ï¼Œä»ä¸åŒçš„è§’åº¦å¯¹è¿™äº›æµè¿›è¡Œå½’ç±»ï¼š æŒ‰æ•°æ®æµå‘ä¸åŒå¯ä»¥åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµã€‚ æŒ‰å¤„ç†æ•°æ®å•ä½ä¸åŒå¯ä»¥åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚ æŒ‰ç…§æµç±»çš„åŠŸèƒ½ä¸åŒå¯ä»¥åˆ†ä¸ºèŠ‚ç‚¹æµå’Œå¤„ç†æµã€‚ è¾“å…¥æµå’Œè¾“å‡ºæµæµå…·æœ‰æ–¹å‘æ€§ï¼Œè‡³äºæ˜¯è¾“å…¥æµè¿˜æ˜¯è¾“å‡ºæµåˆ™æ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ¦‚å¿µï¼Œä¸€èˆ¬æ˜¯ç«™åœ¨ç¨‹åºçš„è§’åº¦å»åˆ¤æ–­ï¼Œä»æ•°æ®æºè¯»å–æ•°æ®åˆ°ç¨‹åºä¸­çš„æ˜¯è¾“å…¥æµï¼Œç›¸åä»ç¨‹åºä¸­å‘å¤–å†™æ•°æ®çš„æ˜¯è¾“å‡ºæµã€‚ å­—èŠ‚æµå’Œå­—ç¬¦æµ å­—èŠ‚æµä»¥å­—èŠ‚ï¼ˆbyteï¼Œ1byte=8bitï¼‰ä¸ºå•ä½ï¼Œä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»å†™æ•°æ®ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„å­—èŠ‚æµå‡ç»§æ‰¿è‡ªæŠ½è±¡ç±»InputStream/OutputStreamã€‚ å­—ç¬¦æµä»¥å­—ç¬¦ï¼ˆJavaä¸­ï¼Œä¸€ä¸ªå­—ç¬¦ä¸º2byte=16bitï¼‰ä¸ºå•ä½ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦çš„è¯»å†™æ•°æ®ã€‚æ‰€æœ‰çš„å­—ç¬¦æµå‡ç»§æ‰¿è‡ªæŠ½è±¡ç±»Reader/Writerã€‚ èŠ‚ç‚¹æµå’Œå¤„ç†æµ èŠ‚ç‚¹æµä¸ºç›´æ¥ä¸æ•°æ®æºï¼ˆèŠ‚ç‚¹ï¼‰ç›¸è¿ï¼Œå¯ä»¥ä»æ•°æ®æºè¯»å†™æ•°æ®çš„æµã€‚ å¤„ç†æµæ˜¯â€œè¿æ¥â€åœ¨å·²å­˜åœ¨çš„æµï¼ˆèŠ‚ç‚¹æµæˆ–å¤„ç†æµï¼‰ä¹‹ä¸Šï¼Œå¯ä»¥ä¸ºç¨‹åºæä¾›æ›´åŠ å¼ºå¤§çš„è¯»å†™æ“ä½œåŠŸèƒ½çš„æµã€‚ äºŒã€InputStreamï¼ŒOutputStreamï¼ŒReaderå’ŒWriterInputStreamæ˜¯æ‰€æœ‰å­—èŠ‚è¾“å…¥æµçš„è¶…ç±»ï¼Œå…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•å¦‚ä¸‹ã€‚ // ä»è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ã€‚å¹¶ä»¥æ•´æ•°çš„å½¢å¼è¿”å›ï¼ˆ0-255ï¼‰ã€‚ // å¦‚æœè¯»å–å‰å·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾è¿”å›-1ã€‚ int read() throws IOException; // ä»è¾“å…¥æµä¸­è¯»å–ä¸€å®šæ•°é‡çš„å­—èŠ‚ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç¼“å†²åŒºæ•°ç»„ bä¸­ã€‚ä»¥æ•´æ•°å½¢å¼è¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚ // å¦‚æœè¯»å–å‰å·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾è¿”å›-1ã€‚ int read(byte[] b) throws IOException; // è¯»å–è¾“å…¥æµä¸­lenä¸ªå­—èŠ‚åˆ°æ•°ç»„ bä¸­ï¼Œå¹¶å°†è¯»å–çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å­˜å‚¨åœ¨å…ƒç´  b[off] ä¸­ï¼Œä¸‹ä¸€ä¸ªå­˜å‚¨åœ¨ b[off+1] ä¸­ï¼Œä¾æ¬¡ç±»æ¨ã€‚ // è¯»å–çš„å­—èŠ‚æ•°æœ€å¤šç­‰äº lenï¼Œä¹Ÿå¯èƒ½å°äºè¯¥å€¼ã€‚ä»¥æ•´æ•°å½¢å¼è¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚ // å¦‚æœè¯»å–å‰å·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾è¿”å›-1ã€‚ int read(byte[] b, int off, int len) throws IOException; // è·³è¿‡å’Œä¸¢å¼ƒæ­¤è¾“å…¥æµä¸­æ•°æ®çš„ nä¸ªå­—èŠ‚ã€‚è¿”å›è·³è¿‡çš„å®é™…å­—èŠ‚æ•°ã€‚ // å¦‚æœ nä¸ºè´Ÿæ•°ï¼Œåˆ™ä¸è·³è¿‡ä»»ä½•å­—èŠ‚ã€‚ long skip(long n) throws IOException; // è¿”å›æ­¤è¾“å…¥æµä¸‹ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¯ä»¥ä¸å—é˜»å¡åœ°ä»æ­¤è¾“å…¥æµè¯»å–ï¼ˆæˆ–è·³è¿‡ï¼‰çš„ä¼°è®¡å­—èŠ‚æ•°ã€‚ // å¦‚æœåˆ°è¾¾è¾“å…¥æµæœ«å°¾ï¼Œåˆ™è¿”å› 0ã€‚ int available() throws IOException; // å…³é—­æ­¤è¾“å…¥æµå¹¶é‡Šæ”¾ä¸è¯¥æµå…³è”çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚ void close() throws IOException; // åœ¨æ­¤è¾“å…¥æµä¸­æ ‡è®°å½“å‰çš„ä½ç½®ã€‚è°ƒç”¨reset()æ–¹æ³•ä¼šæ ¹æ®æ­¤æ ‡è®°çš„ä½ç½®é‡æ–°å®šä½æ­¤æµï¼Œä»¥ä¾¿åç»­é‡æ–°è¯»å–ç›¸åŒçš„å­—èŠ‚ã€‚ // readlimitå‚æ•°å‘ŠçŸ¥æ­¤è¾“å…¥æµåœ¨æ ‡è®°ä½ç½®å¤±æ•ˆä¹‹å‰å…è®¸è¯»å–çš„å­—èŠ‚æ•°ã€‚ void mark(int readlimit); // å°†æ­¤æµé‡æ–°å®šä½åˆ°æœ€åä¸€æ¬¡å¯¹æ­¤è¾“å…¥æµè°ƒç”¨ mark()æ–¹æ³•æ—¶çš„ä½ç½®ã€‚ void reset() throws IOException; // æµ‹è¯•æ­¤è¾“å…¥æµæ˜¯å¦æ”¯æŒ mark()å’Œ reset() æ–¹æ³•ã€‚ // æ˜¯å¦æ”¯æŒ mark()å’Œ reset()æ˜¯ç‰¹å®šè¾“å…¥æµå®ä¾‹çš„ä¸å˜å±æ€§ã€‚ boolean markSupported(); OutputStreamæ˜¯æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµçš„è¶…ç±»ï¼Œå…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•å¦‚ä¸‹ã€‚ // å°†æŒ‡å®šçš„å­—èŠ‚å†™å…¥æ­¤è¾“å‡ºæµã€‚ // è¦å†™å…¥çš„å­—èŠ‚æ˜¯å‚æ•° bçš„ä½8ä½ï¼Œbçš„ 24 ä¸ªé«˜ä½å°†è¢«å¿½ç•¥ã€‚ void write(int b) throws IOException; // å°†ä¸€ä¸ªå­—èŠ‚æ•°ç»„ä¸­çš„æ•°æ®å†™å…¥è¾“å‡ºæµã€‚ void write(byte[] b) throws IOException; // å°†æŒ‡å®š byteæ•°ç»„ä¸­ä»åç§»é‡ off å¼€å§‹çš„ len ä¸ªå­—èŠ‚å†™å…¥æ­¤è¾“å‡ºæµã€‚ void write(byte[] b, int off, int len) throws IOException; // åˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶å°†è¾“å‡ºæµä¸­ç¼“å­˜çš„æ•°æ®å†™å‡ºã€‚ void flush() throws IOException; // å…³é—­æ­¤è¾“å‡ºæµå¹¶é‡Šæ”¾ä¸æ­¤æµæœ‰å…³çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚ void close() throws IOException; Readeræ˜¯æ‰€æœ‰å­—ç¬¦è¾“å…¥æµçš„è¶…ç±»ï¼Œå…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•å¦‚ä¸‹ã€‚ // è¯•å›¾å°†å­—ç¬¦è¯»å…¥æŒ‡å®šçš„å­—ç¬¦ç¼“å†²åŒºã€‚ // è¿”å›æ·»åŠ åˆ°ç¼“å†²åŒºä¸­çš„å­—ç¬¦æ•°é‡ã€‚ int read(CharBuffer target) throws IOException; // è¯»å–å•ä¸ªå­—ç¬¦ï¼Œå¹¶ä»¥æ•´æ•°çš„å½¢å¼è¿”è¿˜ï¼ŒèŒƒå›´åœ¨ 0 åˆ° 65535 ä¹‹é—´ã€‚ // å¦‚æœè¯»å–å‰å·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾è¿”å›-1. int read() throws IOException; // å°†å­—ç¬¦è¯»å…¥æ•°ç»„cbufï¼Œå¹¶è¿”å›è¯»å–çš„å­—ç¬¦æ•°ã€‚ // å¦‚æœè¯»å–å‰å·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾è¿”å›-1. int read(char[] cbuf) throws IOException; // è¯»å–è¾“å…¥æµä¸­lenä¸ªå­—ç¬¦åˆ°æ•°ç»„ cbufä¸­,å¹¶å°†è¯»å–çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å­˜å‚¨åœ¨å…ƒç´ cbuf[off]ä¸­ï¼Œä¸‹ä¸€ä¸ªå­˜å‚¨åœ¨ cbuf[off+1]ä¸­ï¼Œä¾æ¬¡ç±»æ¨ã€‚ // è¯»å–çš„å­—ç¬¦æ•°æœ€å¤šç­‰äº lenï¼Œä¹Ÿå¯èƒ½å°äºè¯¥å€¼ã€‚ä»¥æ•´æ•°å½¢å¼è¿”å›å®é™…è¯»å–çš„å­—ç¬¦æ•°ã€‚ // å¦‚æœè¯»å–å‰å·²ç»åˆ°äº†è¾“å…¥æµçš„æœ«å°¾è¿”å›-1. int read(char[] cbuf, int off, int len) throws IOException; // è·³è¿‡å’Œä¸¢å¼ƒæ­¤è¾“å…¥æµä¸­æ•°æ®çš„ nä¸ªå­—ç¬¦ã€‚è¿”å›è·³è¿‡çš„å®é™…å­—ç¬¦æ•°ã€‚ // å¦‚æœ n ä¸ºè´Ÿæ•°ï¼Œåˆ™ä¸è·³è¿‡ä»»ä½•å­—ç¬¦ã€‚ long skip(long n) throws IOException; // åˆ¤æ–­æ˜¯å¦å‡†å¤‡è¯»å–æ­¤æµã€‚ boolean ready() throws IOException; // å…³é—­æ­¤è¾“å…¥æµå¹¶é‡Šæ”¾ä¸è¯¥æµå…³è”çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚ void close() throws IOException; // åœ¨æ­¤è¾“å…¥æµä¸­æ ‡è®°å½“å‰çš„ä½ç½®ã€‚è°ƒç”¨reset()æ–¹æ³•ä¼šæ ¹æ®æ­¤æ ‡è®°çš„ä½ç½®é‡æ–°å®šä½æ­¤æµï¼Œä»¥ä¾¿åç»­é‡æ–°è¯»å–ç›¸åŒçš„å­—ç¬¦ã€‚ // readlimitå‚æ•°å‘ŠçŸ¥æ­¤è¾“å…¥æµåœ¨æ ‡è®°ä½ç½®å¤±æ•ˆä¹‹å‰å…è®¸è¯»å–çš„å­—ç¬¦æ•°ã€‚ void mark(int readlimit); // å°†æ­¤æµé‡æ–°å®šä½åˆ°æœ€åä¸€æ¬¡å¯¹æ­¤è¾“å…¥æµè°ƒç”¨ mark()æ–¹æ³•æ—¶çš„ä½ç½®ã€‚ void reset() throws IOException; // æµ‹è¯•æ­¤è¾“å…¥æµæ˜¯å¦æ”¯æŒ mark()å’Œ reset() æ–¹æ³•ã€‚ // æ˜¯å¦æ”¯æŒ mark()å’Œ reset()æ˜¯ç‰¹å®šè¾“å…¥æµå®ä¾‹çš„ä¸å˜å±æ€§ã€‚ boolean markSupported(); Writeræ˜¯æ‰€æœ‰å­—ç¬¦è¾“å‡ºæµçš„è¶…ç±»ï¼Œå…¶åŒ…å«çš„åŸºæœ¬æ–¹æ³•å¦‚ä¸‹ã€‚ // å°†æŒ‡å®šçš„å­—ç¬¦å†™å…¥æ­¤è¾“å‡ºæµã€‚ // è¦å†™å…¥çš„å­—ç¬¦æ˜¯å‚æ•° cçš„ä½16ä½ã€‚cçš„ 16 ä¸ªé«˜ä½å°†è¢«å¿½ç•¥ã€‚ void write(int c) throws IOException; // å°†ä¸€å­—ç¬¦æ•°ç»„ä¸­çš„æ•°æ®å†™å…¥è¾“å‡ºæµã€‚ void write(char[] cbuf) throws IOException; // å°†æŒ‡å®š cbufæ•°ç»„ä¸­ä»åç§»é‡ off å¼€å§‹çš„ len ä¸ªå­—ç¬¦å†™å…¥æ­¤è¾“å‡ºæµã€‚ void write(char[] cbuf, int off, int len) throws IOException; // å°†å­—ç¬¦ä¸²strå†™å…¥æ­¤è¾“å‡ºæµã€‚ void write(String str) throws IOException; // å°†å­—ç¬¦ä¸²strä¸­ä»offå¼€å§‹çš„lenä¸ªå­—ç¬¦å†™å…¥æ­¤è¾“å‡ºæµã€‚ void write(String str, int off, int len) throws IOException; // å°†æŒ‡å®šå­—ç¬¦åºåˆ—æ·»åŠ åˆ°æ­¤ writerã€‚ Writer append(CharSequence csq) throws IOException; // å°†æŒ‡å®šå­—ç¬¦åºåˆ—ä¸­ç´¢å¼•ä»startåˆ°endä¹‹é—´çš„å­—ç¬¦å†™å…¥åˆ°æ­¤è¾“å‡ºæµã€‚ Writer append(CharSequence csq, int start, int end) throws IOException; // å°†æŒ‡å®šå­—ç¬¦æ·»åŠ åˆ°æ­¤ writerã€‚ Writer append(char c) throws IOException; // åˆ·æ–°æ­¤è¾“å‡ºæµå¹¶å¼ºåˆ¶å°†è¾“å‡ºæµä¸­ç¼“å†²çš„æ•°æ®å†™å‡ºã€‚ void flush() throws IOException; // å…³é—­æ­¤è¾“å‡ºæµå¹¶é‡Šæ”¾ä¸æ­¤æµæœ‰å…³çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚ void close() throws IOException; ä¸‰ã€èŠ‚ç‚¹æµæ ¹æ®æ•°æ®æ¥æºä¸åŒå¯¹èŠ‚ç‚¹æµè¿›è¡Œåˆ†ç±»å¦‚ä¸‹å›¾ã€‚ å››ã€å¤„ç†æµç¼“å†²æµJ2SDKæä¾›äº†å››ç§ç¼“å†²æµï¼šBufferedReaderã€BufferedWriterã€BufferedInputStreamå’ŒBufferedOutputStreamã€‚ç¼“å†²æµå¯¹è¯»å†™çš„æ•°æ®æä¾›äº†ç¼“å†²çš„åŠŸèƒ½ï¼Œå¯ä»¥æé«˜è¯»å†™çš„æ•ˆç‡ï¼ŒåŒæ—¶è¿˜å¢åŠ äº†ä¸€äº›æ–°çš„æ–¹æ³•ã€‚ BufferedReaderæ–°å¢äº†readLine()æ–¹æ³•ç”¨äºè¯»å–ä¸€è¡Œå­—ç¬¦ä¸²ï¼ˆä»¥\\ræˆ–\\nåˆ†éš”ï¼‰ã€‚ BufferedWriteræ–°å¢äº†newLine()æ–¹æ³•ç”¨äºå†™å…¥ä¸€ä¸ªåˆ†éš”ç¬¦ã€‚ public static void main(String[] args) { try { BufferedWriter bw = new BufferedWriter(new FileWriter( &quot;D:\\\\io\\\\bufferedTest.txt&quot;)); String s; for (int i = 0; i &lt; 10; i++) { s = String.valueOf(Math.random()); bw.write(s); bw.newLine(); } bw.flush(); bw.close(); Reader reader = new FileReader(&quot;D:\\\\io\\\\bufferedTest.txt&quot;); BufferedReader br = new BufferedReader(reader); while ((s = br.readLine()) != null) { System.out.println(s); } br.close(); } catch (FileNotFoundException e) { System.out.println(&quot;æ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶!&quot;); System.exit(-1); } catch (IOException e) { System.out.println(&quot;ç³»ç»Ÿé”™è¯¯ï¼&quot;); System.exit(-1); } } è½¬æ¢æµJ2SDKæä¾›äº†InputStreamReaderå’ŒOutputStreamWriterä¸¤ä¸ªè½¬æ¢æµï¼Œç”¨äºå°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµã€‚ public static void main(String[] args) { try { OutputStream outStream = new FileOutputStream( &quot;D:\\\\io\\\\transformIo.txt&quot;); OutputStreamWriter outWriter = new OutputStreamWriter(outStream); outWriter.write(&quot;2017å¹´3æœˆ25æ—¥é£é›¨å¤§ä½œã€‚ã€‚ã€‚&quot;); outWriter.close(); outWriter = new OutputStreamWriter(new FileOutputStream( &quot;D:\\\\io\\\\transformIo.txt&quot;, true), &quot;GBK&quot;); outWriter.write(&quot;2017å¹´3æœˆ26æ—¥ç”µé—ªé›·é¸£ã€‚ã€‚ã€‚&quot;); outWriter.close(); } catch (FileNotFoundException e) { System.out.println(&quot;æ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶!&quot;); System.exit(-1); } catch (UnsupportedEncodingException e) { System.out.println(&quot;ç¼–ç å¼‚å¸¸ï¼&quot;); System.exit(-1); } catch (IOException e) { System.out.println(&quot;å†™å…¥é”™è¯¯ï¼&quot;); System.exit(-1); } System.out.println(&quot;å†™å…¥æˆåŠŸï¼&quot;); } æ•°æ®æµJ2SDKæä¾›äº†DataInputStreamå’ŒDataOutputStreamä¸¤ä¸ªæ•°æ®æµï¼Œç”¨ä»¥æä¾›å­˜å–ä¸æœºå™¨æ— å…³çš„JavaåŸå§‹æ•°æ®ç±»å‹æ•°æ®ï¼ˆå¦‚ï¼šintï¼Œdoubleç­‰ï¼‰çš„æ–¹æ³•ã€‚ public static void main(String[] args) { try { ByteArrayOutputStream byteOut = new ByteArrayOutputStream(); DataOutputStream dataOut = new DataOutputStream(byteOut); dataOut.writeChar(65); dataOut.writeUTF(&quot;B&quot;); dataOut.writeBoolean(false); dataOut.writeChars(&quot;CD&quot;); dataOut.writeFloat(0.1111f); dataOut.close(); DataInputStream dataIn = new DataInputStream( new ByteArrayInputStream(byteOut.toByteArray())); System.out.println(dataIn.readChar()); System.out.println(dataIn.readUTF()); System.out.println(dataIn.readBoolean()); System.out.println(dataIn.readChar()); System.out.println(dataIn.readChar()); System.out.println(dataIn.readFloat()); } catch (IOException e) { System.out.println(&quot;å†™å…¥é”™è¯¯ï¼&quot;); System.exit(-1); } } PrintæµJ2SDKæä¾›äº†PrintWriterå’ŒPrintStreamä¸¤ä¸ªPrintæµï¼Œæä¾›äº†é‡è½½çš„print()å’Œprintln()æ–¹æ³•ç”¨äºå¤šç§æ•°æ®ç±»å‹çš„è¾“å‡ºã€‚ public static void main(String[] args) { try { FileOutputStream in = new FileOutputStream( &quot;D:\\\\io\\\\PrintIoTest.txt&quot;); PrintStream printer = new PrintStream(in); System.setOut(printer); BufferedReader br = new BufferedReader(new InputStreamReader( System.in)); String s; while ((s = br.readLine()) != null) { if (s.equalsIgnoreCase(&quot;exit&quot;)) { break; } System.out.println(s); } } catch (IOException e) { System.out.println(&quot;ç³»ç»Ÿé”™è¯¯ï¼&quot;); System.exit(-1); } } ObjectæµJ2SDKæä¾›äº†ObjectInputStreamå’ŒObjectOutputStreamä¸¤ä¸ªObjectæµï¼Œç”¨äºå°†å®ç°äº†Serializableæ¥å£çš„å¯¹è±¡å®ä¾‹ç›´æ¥ä»¥äºŒè¿›åˆ¶çš„å½¢å¼è¿›è¡Œå­˜å–çš„æ–¹æ³•ã€‚ import java.io.Serializable; class User implements Serializable { private static final long serialVersionUID = 1L; String userName; int userAge; transient String phoneNum; } public static void main(String[] args) { User user = new User(); user.phoneNum = &quot;0756-8888888&quot;; user.userAge = 17; user.userName = &quot;å¼„ç‰&quot;; OutputStream os; try { os = new FileOutputStream(&quot;D:\\\\io\\\\ObjectIoTest.txt&quot;); ObjectOutputStream oos = new ObjectOutputStream(os); oos.writeObject(user); oos.flush(); oos.close(); FileInputStream fis = new FileInputStream( &quot;D:\\\\io\\\\ObjectIoTest.txt&quot;); ObjectInputStream ois = new ObjectInputStream(fis); user = (User) ois.readObject(); System.out.println(user.userName + &quot; &quot; + user.userAge + &quot; &quot; + user.phoneNum); ois.close(); } catch (FileNotFoundException e) { System.out.println(&quot;æ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶!&quot;); System.exit(-1); } catch (ClassNotFoundException e) { System.out.println(&quot;ç±»å‹é”™è¯¯!&quot;); System.exit(-1); } catch (IOException e) { System.out.println(&quot;ç³»ç»Ÿé”™è¯¯ï¼&quot;); System.exit(-1); } } å¯¹äºå¯¹è±¡ä¸­ä½¿ç”¨transientå…³é”®å­—ä¿®é¥°çš„å±æ€§åœ¨åºåˆ—åŒ–æ—¶å°†è¢«å¿½ç•¥ã€‚å¯¹è±¡è¿˜å¯ä»¥é€šè¿‡å®ç°Externalizableæ¥å£ï¼Œå¹¶å®ç°writeExternal()å’ŒreadExternal()æ–¹æ³•æ¥è‡ªå·±æŒ‡å®šåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å®ç°è¿‡ç¨‹ã€‚ äº”ã€æµæ“ä½œçš„å…¸å‹ç¤ºä¾‹import java.io.File; import java.io.FileInputStream; import java.io.FileNotFoundException; import java.io.FileOutputStream; import java.io.IOException; import java.io.InputStream; import java.io.OutputStream; public class FileOperator { private static final int bytes = 1024 * 1024; /** * æ–‡ä»¶å¤åˆ¶ * @param sourcePath æ–‡ä»¶æºè·¯å¾„ï¼Œä¾‹å¦‚ï¼šâ€œD:\\\\IO\\text.txtâ€ * @param targetPath ç›®æ ‡æ–‡ä»¶è·¯å¾„ */ public static void copyFile(String sourcePath, String targetPath) { File sourceFile = new File(sourcePath); long targetSize = 0; try { byte[] buffer = new byte[bytes]; InputStream inStream = new FileInputStream(sourceFile); // è¯»å…¥æºæ–‡ä»¶ OutputStream outStream = new FileOutputStream(targetPath); int len; while ((len = inStream.read(buffer)) &gt; 0) { outStream.write(buffer, 0, len); targetSize += len; } outStream.close(); inStream.close(); } catch (FileNotFoundException e) { System.out.println(&quot;ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šæ–‡ä»¶ï¼š&quot; + sourcePath); System.exit(-1); } catch (IOException e) { System.out.println(&quot;æ–‡ä»¶å¤åˆ¶å‘ç”Ÿé”™è¯¯ï¼Œå¤åˆ¶å¤±è´¥ï¼&quot;); System.exit(-1); } System.out.println(&quot;å¤åˆ¶å®Œæˆï¼š&quot;); System.out.println(&quot;æºæ–‡ä»¶å¤§å°ï¼š&quot; + sourceFile.length()); System.out.println(&quot;å¤åˆ¶å¤§å°ï¼š&quot; + targetSize); } public static void main(String[] args) { String sourcePath = &quot;D:\\\\io\\\\&quot;; String targetPath = &quot;D:\\\\a&quot;; File file=new File(sourcePath); System.out.println(file.getAbsolutePath()); System.out.println(file.getPath()); System.out.println(file.getName()); System.out.println(file.getParent()); copyFolder(sourcePath, targetPath); } /** * å¤åˆ¶æ–‡ä»¶å¤¹ * @param sourcePath æ–‡ä»¶å¤¹æºè·¯å¾„ï¼Œä¾‹å¦‚:â€œD:\\\\IOâ€ * @param targetPath ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„ */ public static void copyFolder(String sourcePath, String targetPath) { File sourceFile = new File(sourcePath); File targetFolder=new File(targetPath); if(!targetFolder.exists()){ targetFolder.mkdirs(); } if(sourceFile.isDirectory()){ File[] files=sourceFile.listFiles(); for(File file:files){ if(file.isDirectory()){ copyFolder(file.getAbsolutePath(), targetPath+File.separator+file.getName());} else{ copyFile(file.getAbsolutePath(),targetPath+File.separator+file.getName()); } } } else{ copyFile(sourcePath,targetPath+File.separator+sourceFile.getName()); } } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,IO,æµ","slug":"Java-IO-æµ","permalink":"/tags/Java-IO-æµ/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Instrumentation","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Instrumentation","date":"2020-06-06T08:53:10.000Z","updated":"2023-04-30T10:21:41.342Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Instrumentation/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Instrumentation/","excerpt":"","text":"åˆ©ç”¨ Java ä»£ç ï¼Œå³ java.lang.instrument åšåŠ¨æ€Instrumentation æ˜¯ Java SE 5 çš„æ–°ç‰¹æ€§ï¼Œå®ƒæŠŠ Java çš„ instrument åŠŸèƒ½ä»æœ¬åœ°ä»£ç ä¸­è§£æ”¾å‡ºæ¥ï¼Œä½¿ä¹‹å¯ä»¥ç”¨ Java ä»£ç çš„æ–¹å¼è§£å†³é—®é¢˜ã€‚ä½¿ç”¨ Instrumentationï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºä¸€ä¸ªç‹¬ç«‹äºåº”ç”¨ç¨‹åºçš„ä»£ç†ç¨‹åºï¼ˆAgentï¼‰ï¼Œç”¨æ¥ç›‘æµ‹å’ŒååŠ©è¿è¡Œåœ¨ JVM ä¸Šçš„ç¨‹åºï¼Œç”šè‡³èƒ½å¤Ÿæ›¿æ¢å’Œä¿®æ”¹æŸäº›ç±»çš„å®šä¹‰ã€‚æœ‰äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œå¼€å‘è€…å°±å¯ä»¥å®ç°æ›´ä¸ºçµæ´»çš„è¿è¡Œæ—¶è™šæ‹Ÿæœºç›‘æ§å’ŒJava ç±»æ“ä½œäº†ï¼Œè¿™æ ·çš„ç‰¹æ€§å®é™…ä¸Šæä¾›äº†ä¸€ç§è™šæ‹Ÿæœºçº§åˆ«æ”¯æŒçš„ AOP å®ç°æ–¹å¼ï¼Œä½¿å¾—å¼€å‘è€…æ— éœ€å¯¹ JDK åšä»»ä½•å‡çº§å’Œæ”¹åŠ¨ï¼Œå°±å¯ä»¥å®ç°æŸäº› AOP çš„åŠŸèƒ½äº†ã€‚ åœ¨ Java SE 6 é‡Œé¢ï¼Œinstrumentation åŒ…è¢«èµ‹äºˆäº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼šå¯åŠ¨åçš„ instrumentã€æœ¬åœ°ä»£ç ï¼ˆnative codeï¼‰instrumentï¼Œä»¥åŠåŠ¨æ€æ”¹å˜ classpathç­‰ç­‰ã€‚è¿™äº›æ”¹å˜ï¼Œæ„å‘³ç€ Java å…·æœ‰äº†æ›´å¼ºçš„åŠ¨æ€æ§åˆ¶ã€è§£é‡Šèƒ½åŠ›ï¼Œå®ƒä½¿å¾— Java è¯­è¨€å˜å¾—æ›´åŠ çµæ´»å¤šå˜ã€‚ åœ¨ Java SE6 é‡Œé¢ï¼Œæœ€å¤§çš„æ”¹å˜ä½¿è¿è¡Œæ—¶çš„ Instrumentation æˆä¸ºå¯èƒ½ã€‚åœ¨ Java SE 5 ä¸­ï¼ŒInstrument è¦æ±‚åœ¨è¿è¡Œå‰åˆ©ç”¨å‘½ä»¤è¡Œå‚æ•°æˆ–è€…ç³»ç»Ÿå‚æ•°æ¥è®¾ç½®ä»£ç†ç±»ï¼Œåœ¨å®é™…çš„è¿è¡Œä¹‹ä¸­ï¼Œè™šæ‹Ÿæœºåœ¨åˆå§‹åŒ–ä¹‹æ—¶ï¼ˆåœ¨ç»å¤§å¤šæ•°çš„ Java ç±»åº“è¢«è½½å…¥ä¹‹å‰ï¼‰ï¼Œinstrumentation çš„è®¾ç½®å·²ç»å¯åŠ¨ï¼Œå¹¶åœ¨è™šæ‹Ÿæœºä¸­è®¾ç½®äº†å›è°ƒå‡½æ•°ï¼Œæ£€æµ‹ç‰¹å®šç±»çš„åŠ è½½æƒ…å†µï¼Œå¹¶å®Œæˆå®é™…å·¥ä½œã€‚ä½†æ˜¯åœ¨å®é™…çš„å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨è™šæ‹Ÿæœºå¯åŠ¨ä¹‹æ—¶å°±ä¸ºå…¶è®¾å®šä»£ç†ï¼Œè¿™æ ·å®é™…ä¸Šé™åˆ¶äº† instrument çš„åº”ç”¨ã€‚è€Œ Java SE 6 çš„æ–°ç‰¹æ€§æ”¹å˜äº†è¿™ç§æƒ…å†µï¼Œé€šè¿‡ Java Tool API ä¸­çš„ attach æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åœ°è®¾ç½®åŠ è½½ä»£ç†ç±»ï¼Œä»¥è¾¾åˆ° instrumentation çš„ç›®çš„ã€‚ å¦å¤–ï¼Œå¯¹native çš„ Instrumentationä¹Ÿæ˜¯ Java SE 6 çš„ä¸€ä¸ªå´­æ–°çš„åŠŸèƒ½ï¼Œè¿™ä½¿ä»¥å‰æ— æ³•å®Œæˆçš„åŠŸèƒ½ â€”â€” å¯¹ native æ¥å£çš„ instrumentation å¯ä»¥åœ¨ Java SE 6 ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªæˆ–è€…ä¸€ç³»åˆ—çš„ prefix æ·»åŠ è€Œå¾—ä»¥å®Œæˆã€‚ æœ€åï¼ŒJava SE 6 é‡Œçš„ Instrumentation ä¹Ÿå¢åŠ äº†åŠ¨æ€æ·»åŠ  class pathçš„åŠŸèƒ½ã€‚æ‰€æœ‰è¿™äº›æ–°çš„åŠŸèƒ½ï¼Œéƒ½ä½¿å¾— instrument åŒ…çš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œä»è€Œä½¿ Java è¯­è¨€æœ¬èº«æ›´åŠ å¼ºå¤§ã€‚ Instrumentation çš„åŸºæœ¬åŠŸèƒ½å’Œç”¨æ³•â€œjava.lang.instrumentâ€åŒ…çš„å…·ä½“å®ç°ï¼Œä¾èµ–äº JVMTIã€‚JVMTIï¼ˆJava Virtual Machine Tool Interfaceï¼‰æ˜¯ä¸€å¥—ç”± Java è™šæ‹Ÿæœºæä¾›çš„ï¼Œä¸º JVM ç›¸å…³çš„å·¥å…·æä¾›çš„æœ¬åœ°ç¼–ç¨‹æ¥å£é›†åˆã€‚JVMTI æ˜¯ä» Java SE 5 å¼€å§‹å¼•å…¥ï¼Œæ•´åˆå’Œå–ä»£äº†ä»¥å‰ä½¿ç”¨çš„ Java Virtual Machine Profiler Interface(JVMPI)å’Œ the Java Virtual Machine Debug Interface(JVMDI)ï¼Œè€Œåœ¨ Java SE 6 ä¸­ï¼ŒJVMPI å’Œ JVMDI å·²ç»æ¶ˆå¤±äº†ã€‚JVMTI æä¾›äº†ä¸€å¥—â€ä»£ç†â€ç¨‹åºæœºåˆ¶ï¼Œå¯ä»¥æ”¯æŒç¬¬ä¸‰æ–¹å·¥å…·ç¨‹åºä»¥ä»£ç†çš„æ–¹å¼è¿æ¥å’Œè®¿é—® JVMï¼Œå¹¶åˆ©ç”¨ JVMTI æä¾›çš„ä¸°å¯Œçš„ç¼–ç¨‹æ¥å£ï¼Œå®Œæˆå¾ˆå¤šè·Ÿ JVM ç›¸å…³çš„åŠŸèƒ½ã€‚äº‹å®ä¸Šï¼Œjava.lang.instrument åŒ…çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯åŸºäºè¿™ç§æœºåˆ¶çš„ï¼šåœ¨ Instrumentation çš„å®ç°å½“ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ª JVMTI çš„ä»£ç†ç¨‹åºï¼Œé€šè¿‡è°ƒç”¨ JVMTI å½“ä¸­ Java ç±»ç›¸å…³çš„å‡½æ•°æ¥å®ŒæˆJava ç±»çš„åŠ¨æ€æ“ä½œã€‚é™¤å¼€ Instrumentation åŠŸèƒ½å¤–ï¼ŒJVMTI è¿˜åœ¨è™šæ‹Ÿæœºå†…å­˜ç®¡ç†ï¼Œçº¿ç¨‹æ§åˆ¶ï¼Œæ–¹æ³•å’Œå˜é‡æ“ä½œç­‰ç­‰æ–¹é¢æä¾›äº†å¤§é‡æœ‰ä»·å€¼çš„å‡½æ•°ã€‚å…³äº JVMTI çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ Java SE 6 æ–‡æ¡£ä¸­çš„ä»‹ç»ã€‚ Instrumentation çš„æœ€å¤§ä½œç”¨ï¼Œå°±æ˜¯ç±»å®šä¹‰åŠ¨æ€æ”¹å˜å’Œæ“ä½œã€‚åœ¨ Java SE 5 åŠå…¶åç»­ç‰ˆæœ¬å½“ä¸­ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ä¸€ä¸ªæ™®é€š Java ç¨‹åºï¼ˆå¸¦æœ‰ main å‡½æ•°çš„ Java ç±»ï¼‰è¿è¡Œæ—¶ï¼Œé€šè¿‡ -javaagentå‚æ•°æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„ jar æ–‡ä»¶ï¼ˆåŒ…å« Instrumentation ä»£ç†ï¼‰æ¥å¯åŠ¨ Instrumentation çš„ä»£ç†ç¨‹åºã€‚ åœ¨ Java SE 5 å½“ä¸­ï¼Œå¼€å‘è€…å¯ä»¥è®© Instrumentation ä»£ç†åœ¨ main å‡½æ•°è¿è¡Œå‰æ‰§è¡Œã€‚ç®€è¦è¯´æ¥å°±æ˜¯å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š (1) ç¼–å†™ premain å‡½æ•°ç¼–å†™ä¸€ä¸ª Java ç±»ï¼ŒåŒ…å«å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•å½“ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼š public static void premain(String agentArgs, Instrumentation inst); // [1] public static void premain(String agentArgs); // [2] å…¶ä¸­ï¼Œ[1] çš„ä¼˜å…ˆçº§æ¯” [2] é«˜ï¼Œå°†ä¼šè¢«ä¼˜å…ˆæ‰§è¡Œï¼ˆ[1] å’Œ [2] åŒæ—¶å­˜åœ¨æ—¶ï¼Œ[2] è¢«å¿½ç•¥ï¼‰ã€‚åœ¨è¿™ä¸ª premain å‡½æ•°ä¸­ï¼Œå¼€å‘è€…å¯ä»¥è¿›è¡Œå¯¹ç±»çš„å„ç§æ“ä½œã€‚ agentArgs æ˜¯ premain å‡½æ•°å¾—åˆ°çš„ç¨‹åºå‚æ•°ï¼ŒéšåŒ â€œ-javaagentâ€ä¸€èµ·ä¼ å…¥ã€‚ä¸ main å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œå¦‚æœç¨‹åºå‚æ•°æœ‰å¤šä¸ªï¼Œç¨‹åºå°†è‡ªè¡Œè§£æè¿™ä¸ªå­—ç¬¦ä¸²ã€‚ Inst æ˜¯ä¸€ä¸ª java.lang.instrument.Instrumentation çš„å®ä¾‹ï¼Œç”± JVM è‡ªåŠ¨ä¼ å…¥ã€‚java.lang.instrument.Instrumentation æ˜¯ instrument åŒ…ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œä¹Ÿæ˜¯è¿™ä¸ªåŒ…çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé›†ä¸­äº†å…¶ä¸­å‡ ä¹æ‰€æœ‰çš„åŠŸèƒ½æ–¹æ³•ï¼Œä¾‹å¦‚ç±»å®šä¹‰çš„è½¬æ¢å’Œæ“ä½œç­‰ç­‰ã€‚ (2) jar æ–‡ä»¶æ‰“åŒ…å°†è¿™ä¸ª Java ç±»æ‰“åŒ…æˆä¸€ä¸ª jar æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­çš„ manifest å±æ€§å½“ä¸­åŠ å…¥â€ Premain-Classâ€æ¥æŒ‡å®šæ­¥éª¤ 1 å½“ä¸­ç¼–å†™çš„é‚£ä¸ªå¸¦æœ‰ premain çš„ Java ç±»ã€‚ï¼ˆå¯èƒ½è¿˜éœ€è¦æŒ‡å®šå…¶ä»–å±æ€§ä»¥å¼€å¯æ›´å¤šåŠŸèƒ½ï¼‰ (3) è¿è¡Œç”¨å¦‚ä¸‹æ–¹å¼è¿è¡Œå¸¦æœ‰ Instrumentation çš„ Java ç¨‹åºï¼š java -javaagent:jar æ–‡ä»¶çš„ä½ç½® [= ä¼ å…¥ premain çš„å‚æ•° ] å¯¹ Java ç±»æ–‡ä»¶çš„æ“ä½œï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹ä¸€ä¸ª byte æ•°ç»„çš„æ“ä½œï¼ˆå°†ç±»æ–‡ä»¶çš„äºŒè¿›åˆ¶å­—èŠ‚æµè¯»å…¥ä¸€ä¸ª byte æ•°ç»„ï¼‰ã€‚å¼€å‘è€…å¯ä»¥åœ¨â€œClassFileTransformerâ€çš„ transform æ–¹æ³•å½“ä¸­å¾—åˆ°ï¼Œæ“ä½œå¹¶æœ€ç»ˆè¿”å›ä¸€ä¸ªç±»çš„å®šä¹‰ï¼ˆä¸€ä¸ª byte æ•°ç»„ï¼‰ã€‚è¿™æ–¹é¢ï¼ŒApache çš„ BCEL å¼€æºé¡¹ç›®æä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æŒï¼Œå…·ä½“çš„å­—èŠ‚ç æ“ä½œå¹¶éæœ¬æ–‡çš„é‡ç‚¹ï¼Œæ‰€ä»¥ï¼Œæœ¬æ–‡ä¸­æ‰€ä¸¾çš„ä¾‹å­ï¼Œåªæ˜¯é‡‡ç”¨ç®€å•çš„ç±»æ–‡ä»¶æ›¿æ¢çš„æ–¹å¼æ¥æ¼”ç¤º Instrumentation çš„ä½¿ç”¨ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ç®€å•çš„ä¸¾ä¾‹ï¼Œæ¥è¯´æ˜ Instrumentation çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç±»ï¼ŒTransClassï¼Œ å¯ä»¥é€šè¿‡ä¸€ä¸ªé™æ€æ–¹æ³•è¿”å›ä¸€ä¸ªæ•´æ•° 1ã€‚ public class TransClass { public int getNumber() { return 1; } } æˆ‘ä»¬è¿è¡Œå¦‚ä¸‹ç±»ï¼Œå¯ä»¥å¾—åˆ°è¾“å‡º â€1â€œã€‚ public class TestMainInJar { public static void main(String[] args) { System.out.println(new TransClass().getNumber()); } } ç„¶åï¼Œæˆ‘ä»¬å°† TransClass çš„ getNumber æ–¹æ³•æ”¹æˆå¦‚ä¸‹ : public int getNumber() { return 2; } å†å°†è¿™ä¸ªè¿”å› 2 çš„ Java æ–‡ä»¶ç¼–è¯‘æˆç±»æ–‡ä»¶ï¼Œä¸ºäº†åŒºåˆ«å¼€åŸæœ‰çš„è¿”å› 1 çš„ç±»ï¼Œæˆ‘ä»¬å°†è¿”å› 2 çš„è¿™ä¸ªç±»æ–‡ä»¶å‘½åä¸º TransClass2.class.2ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å»ºç«‹ä¸€ä¸ª Transformer ç±»ï¼š import java.lang.instrument.ClassFileTransformer; import java.io.FileInputStream; import java.io.IOException; import java.io.InputStream; import java.lang.instrument.ClassFileTransformer; import java.lang.instrument.IllegalClassFormatException; import java.security.ProtectionDomain; class Transformer implements ClassFileTransformer { public static final String classNumberReturns2 = &quot;TransClass.class.2&quot;; public static byte[] getBytesFromFile(String fileName) { try { // precondition File file = new File(fileName); InputStream is = new FileInputStream(file); long length = file.length(); byte[] bytes = new byte[(int) length]; // Read in the bytes int offset = 0; int numRead = 0; while (offset &lt;bytes.length &amp;&amp; (numRead = is.read(bytes, offset, bytes.length - offset)) &gt;= 0) { offset += numRead; } if (offset &lt; bytes.length) { throw new IOException(&quot;Could not completely read file &quot; + file.getName()); } is.close(); return bytes; } catch (Exception e) { System.out.println(&quot;error occurs in _ClassTransformer!&quot; + e.getClass().getName()); return null; } } public byte[] transform(ClassLoader l, String className, Class&lt;?&gt; c, ProtectionDomain pd, byte[] b) throws IllegalClassFormatException { if (!className.equals(&quot;TransClass&quot;)) { return null; } return getBytesFromFile(classNumberReturns2); } } è¿™ä¸ªç±»å®ç°äº† ClassFileTransformer æ¥å£ã€‚å…¶ä¸­ï¼ŒgetBytesFromFile æ–¹æ³•æ ¹æ®æ–‡ä»¶åè¯»å…¥äºŒè¿›åˆ¶å­—ç¬¦æµï¼Œè€Œ ClassFileTransformer å½“ä¸­è§„å®šçš„ transform æ–¹æ³•åˆ™å®Œæˆäº†ç±»å®šä¹‰çš„æ›¿æ¢è½¬æ¢ã€‚ æœ€åï¼Œæˆ‘ä»¬å»ºç«‹ä¸€ä¸ª Premain ç±»ï¼Œå†™å…¥ Instrumentation çš„ä»£ç†æ–¹æ³• premainï¼š public class Premain { public static void premain(String agentArgsï¼Œ Instrumentation inst) throws ClassNotFoundExceptionï¼Œ UnmodifiableClassException { inst.addTransformer(new Transformer()); } } å¯ä»¥çœ‹å‡ºï¼ŒaddTransformer æ–¹æ³•å¹¶æ²¡æœ‰æŒ‡æ˜è¦è½¬æ¢å“ªä¸ªç±»ã€‚è½¬æ¢å‘ç”Ÿåœ¨ premain å‡½æ•°æ‰§è¡Œä¹‹åï¼Œmain å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œè¿™æ—¶æ¯è£…è½½ä¸€ä¸ªç±»ï¼Œtransform æ–¹æ³•å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œçœ‹çœ‹æ˜¯å¦éœ€è¦è½¬æ¢ï¼Œæ‰€ä»¥ï¼Œåœ¨ transformï¼ˆTransformer ç±»ä¸­ï¼‰æ–¹æ³•ä¸­ï¼Œç¨‹åºç”¨ className.equals(â€œTransClassâ€) æ¥åˆ¤æ–­å½“å‰çš„ç±»æ˜¯å¦éœ€è¦è½¬æ¢ã€‚ ä»£ç å®Œæˆåï¼Œæˆ‘ä»¬å°†ä»–ä»¬æ‰“åŒ…ä¸º TestInstrument1.jarã€‚è¿”å› 1 çš„é‚£ä¸ª TransClass çš„ç±»æ–‡ä»¶ä¿ç•™åœ¨ jar åŒ…ä¸­ï¼Œè€Œè¿”å› 2 çš„é‚£ä¸ª TransClass.class.2 åˆ™æ”¾åˆ° jar çš„å¤–é¢ã€‚åœ¨ manifest é‡Œé¢åŠ å…¥å¦‚ä¸‹å±æ€§æ¥æŒ‡å®š premain æ‰€åœ¨çš„ç±»ï¼š Manifest-Version: 1.0 Premain-Class: Premain åœ¨è¿è¡Œè¿™ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬ç”¨æ™®é€šæ–¹å¼è¿è¡Œè¿™ä¸ª jar ä¸­çš„ main å‡½æ•°ï¼Œå¯ä»¥å¾—åˆ°è¾“å‡ºâ€œ1â€ã€‚å¦‚æœç”¨ä¸‹åˆ—æ–¹å¼è¿è¡Œ : java -javaagent:TestInstrument1.jar -cp TestInstrument1.jar TestMainInJar åˆ™ä¼šå¾—åˆ°è¾“å‡ºâ€œ2â€ã€‚ å½“ç„¶ï¼Œç¨‹åºè¿è¡Œçš„ main å‡½æ•°ä¸ä¸€å®šè¦æ”¾åœ¨ premain æ‰€åœ¨çš„è¿™ä¸ª jar æ–‡ä»¶é‡Œé¢ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ä¾‹å­ç¨‹åºæ‰“åŒ…çš„æ–¹ä¾¿è€Œæ”¾åœ¨ä¸€èµ·çš„ã€‚ é™¤äº†ç”¨ addTransformer çš„æ–¹å¼ï¼ŒInstrumentation å½“ä¸­è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ–¹æ³•â€œredefineClassesâ€æ¥å®ç° premain å½“ä¸­æŒ‡å®šçš„è½¬æ¢ã€‚ç”¨æ³•ç±»ä¼¼ï¼Œå¦‚ä¸‹ï¼š public class Premain { public static void premain(String agentArgsï¼Œ Instrumentation inst) throws ClassNotFoundExceptionï¼Œ UnmodifiableClassException { ClassDefinition def = new ClassDefinition(TransClass.classï¼Œ Transformer.getBytesFromFile(Transformer.classNumberReturns2)); inst.redefineClasses(new ClassDefinition[] { def }); System.out.println(&quot;success&quot;); } } redefineClasses çš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œå¯ä»¥æ‰¹é‡è½¬æ¢å¾ˆå¤šç±»ã€‚ Java SE 6 çš„æ–°ç‰¹æ€§ï¼šè™šæ‹Ÿæœºå¯åŠ¨åçš„åŠ¨æ€ instrumentåœ¨ Java SE 5 å½“ä¸­ï¼Œå¼€å‘è€…åªèƒ½åœ¨ premain å½“ä¸­æ–½å±•æƒ³è±¡åŠ›ï¼Œæ‰€ä½œçš„ Instrumentation ä¹Ÿä»…é™ä¸ main å‡½æ•°æ‰§è¡Œå‰ï¼Œè¿™æ ·çš„æ–¹å¼å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ã€‚ åœ¨ Java SE 5 çš„åŸºç¡€ä¸Šï¼ŒJava SE 6 é’ˆå¯¹è¿™ç§çŠ¶å†µåšå‡ºäº†æ”¹è¿›ï¼Œå¼€å‘è€…å¯ä»¥åœ¨main å‡½æ•°å¼€å§‹æ‰§è¡Œä»¥åï¼Œå†å¯åŠ¨è‡ªå·±çš„ Instrumentation ç¨‹åºã€‚ åœ¨ Java SE 6 çš„ Instrumentation å½“ä¸­ï¼Œæœ‰ä¸€ä¸ªè·Ÿ premainâ€œå¹¶é©¾é½é©±â€çš„â€œagentmainâ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨ main å‡½æ•°å¼€å§‹è¿è¡Œä¹‹åå†è¿è¡Œã€‚è·Ÿ premain å‡½æ•°ä¸€æ ·ï¼Œ å¼€å‘è€…å¯ä»¥ç¼–å†™ä¸€ä¸ªå«æœ‰â€œagentmainâ€å‡½æ•°çš„ Java ç±»ï¼š public static void agentmain (String agentArgs, Instrumentation inst); //[1] public static void agentmain (String agentArgs); //[2] åŒæ ·ï¼Œ[1] çš„ä¼˜å…ˆçº§æ¯” [2] é«˜ï¼Œå°†ä¼šè¢«ä¼˜å…ˆæ‰§è¡Œã€‚è·Ÿ premain å‡½æ•°ä¸€æ ·ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ agentmain ä¸­è¿›è¡Œå¯¹ç±»çš„å„ç§æ“ä½œã€‚å…¶ä¸­çš„ agentArgs å’Œ Inst çš„ç”¨æ³•è·Ÿ premain ç›¸åŒã€‚ ä¸â€œPremain-Classâ€ç±»ä¼¼ï¼Œå¼€å‘è€…å¿…é¡»åœ¨ manifest æ–‡ä»¶é‡Œé¢è®¾ç½®â€œAgent-Classâ€æ¥æŒ‡å®šåŒ…å« agentmain å‡½æ•°çš„ç±»ã€‚å¯æ˜¯ï¼Œè·Ÿ premain ä¸åŒçš„æ˜¯ï¼Œagentmain éœ€è¦åœ¨ main å‡½æ•°å¼€å§‹è¿è¡Œåæ‰å¯åŠ¨ï¼Œè¿™æ ·çš„æ—¶æœºåº”è¯¥å¦‚ä½•ç¡®å®šå‘¢ï¼Œè¿™æ ·çš„åŠŸèƒ½åˆå¦‚ä½•å®ç°å‘¢ï¼Ÿ åœ¨ Java SE 6 æ–‡æ¡£å½“ä¸­ï¼Œå¼€å‘è€…ä¹Ÿè®¸æ— æ³•åœ¨ java.lang.instrument åŒ…ç›¸å…³çš„æ–‡æ¡£éƒ¨åˆ†çœ‹åˆ°æ˜ç¡®çš„ä»‹ç»ï¼Œæ›´åŠ æ— æ³•çœ‹åˆ°å…·ä½“çš„åº”ç”¨ agnetmain çš„ä¾‹å­ã€‚ä¸è¿‡ï¼Œåœ¨ Java SE 6 çš„æ–°ç‰¹æ€§é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªä¸å¤ªèµ·çœ¼çš„åœ°æ–¹ï¼Œæ­ç¤ºäº† agentmain çš„ç”¨æ³•ã€‚è¿™å°±æ˜¯Java SE 6 å½“ä¸­æä¾›çš„ Attach APIã€‚ Attach API ä¸æ˜¯ Java çš„æ ‡å‡† APIï¼Œè€Œæ˜¯ Sun å…¬å¸æä¾›çš„ä¸€å¥—æ‰©å±• APIï¼Œç”¨æ¥å‘ç›®æ ‡ JVM â€é™„ç€â€ï¼ˆAttachï¼‰ä»£ç†å·¥å…·ç¨‹åºçš„ã€‚æœ‰äº†å®ƒï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿çš„ç›‘æ§ä¸€ä¸ª JVMï¼Œè¿è¡Œä¸€ä¸ªå¤–åŠ çš„ä»£ç†ç¨‹åºã€‚ Attach API å¾ˆç®€å•ï¼Œåªæœ‰ 2 ä¸ªä¸»è¦çš„ç±»ï¼Œéƒ½åœ¨ com.sun.tools.attach åŒ…é‡Œé¢ï¼šVirtualMachine ä»£è¡¨ä¸€ä¸ª Java è™šæ‹Ÿæœºï¼Œä¹Ÿå°±æ˜¯ç¨‹åºéœ€è¦ç›‘æ§çš„ç›®æ ‡è™šæ‹Ÿæœºï¼Œæä¾›äº† JVM æšä¸¾ï¼ŒAttach åŠ¨ä½œå’Œ Detach åŠ¨ä½œï¼ˆAttach åŠ¨ä½œçš„ç›¸åè¡Œä¸ºï¼Œä» JVM ä¸Šé¢è§£é™¤ä¸€ä¸ªä»£ç†ï¼‰ç­‰ç­‰ ;VirtualMachineDescriptor åˆ™æ˜¯ä¸€ä¸ªæè¿°è™šæ‹Ÿæœºçš„å®¹å™¨ç±»ï¼Œé…åˆ VirtualMachine ç±»å®Œæˆå„ç§åŠŸèƒ½ã€‚ ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä¸¾ä¾‹ç®€åŒ–å¦‚ä¸‹ï¼šä¾ç„¶ç”¨ç±»æ–‡ä»¶æ›¿æ¢çš„æ–¹å¼ï¼Œå°†ä¸€ä¸ªè¿”å› 1 çš„å‡½æ•°æ›¿æ¢æˆè¿”å› 2 çš„å‡½æ•°ï¼ŒAttach API å†™åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œé¢ï¼Œç”¨ç¡çœ ç­‰å¾…çš„æ–¹å¼ï¼Œæ¯éš”åŠç§’æ—¶é—´æ£€æŸ¥ä¸€æ¬¡æ‰€æœ‰çš„ Java è™šæ‹Ÿæœºï¼Œå½“å‘ç°æœ‰æ–°çš„è™šæ‹Ÿæœºå‡ºç°çš„æ—¶å€™ï¼Œå°±è°ƒç”¨ attach å‡½æ•°ï¼Œéšåå†æŒ‰ç…§ Attach API æ–‡æ¡£é‡Œé¢æ‰€è¯´çš„æ–¹å¼è£…è½½ Jar æ–‡ä»¶ã€‚ç­‰åˆ° 5 ç§’é’Ÿçš„æ—¶å€™ï¼Œattach ç¨‹åºè‡ªåŠ¨ç»“æŸã€‚è€Œåœ¨ main å‡½æ•°é‡Œé¢ï¼Œç¨‹åºæ¯éš”åŠç§’é’Ÿè¾“å‡ºä¸€æ¬¡è¿”å›å€¼ï¼ˆæ˜¾ç¤ºå‡ºè¿”å›å€¼ä» 1 å˜æˆ 2ï¼‰ã€‚ TransClass ç±»å’Œ Transformer ç±»çš„ä»£ç ä¸å˜ï¼Œå‚çœ‹ä¸Šä¸€èŠ‚ä»‹ç»ã€‚ å«æœ‰ main å‡½æ•°çš„ TestMainInJar ä»£ç ä¸ºï¼š public class TestMainInJar { public static void main(String[] args) throws InterruptedException { System.out.println(new TransClass().getNumber()); int count = 0; while (true) { Thread.sleep(500); count++; int number = new TransClass().getNumber(); System.out.println(number); if (3 == number || count &gt;= 10) { break; } } } } å«æœ‰ agentmain çš„ AgentMain ç±»çš„ä»£ç ä¸ºï¼š import java.lang.instrument.ClassDefinition; import java.lang.instrument.Instrumentation; import java.lang.instrument.UnmodifiableClassException; public class AgentMain { public static void agentmain(String agentArgs, Instrumentation inst) throws ClassNotFoundException, UnmodifiableClassException, InterruptedException { inst.addTransformer(new Transformer (), true); inst.retransformClasses(TransClass.class); System.out.println(&quot;Agent Main Done&quot;); } } å…¶ä¸­ï¼ŒretransformClasses æ˜¯ Java SE 6 é‡Œé¢çš„æ–°æ–¹æ³•ï¼Œå®ƒè·Ÿ redefineClasses ä¸€æ ·ï¼Œå¯ä»¥æ‰¹é‡è½¬æ¢ç±»å®šä¹‰ï¼Œå¤šç”¨äº agentmain åœºåˆã€‚ Jar æ–‡ä»¶è·Ÿ Premain é‚£ä¸ªä¾‹å­é‡Œé¢çš„ Jar æ–‡ä»¶å·®ä¸å¤šï¼Œä¹Ÿæ˜¯æŠŠ main å’Œ agentmain çš„ç±»ï¼ŒTransClassï¼ŒTransformer ç­‰ç±»æ”¾åœ¨ä¸€èµ·ï¼Œæ‰“åŒ…ä¸ºâ€œTestInstrument1.jarâ€ï¼Œè€Œ Jar æ–‡ä»¶å½“ä¸­çš„ Manifest æ–‡ä»¶ä¸º : Manifest-Version: 1.0 Agent-Class: AgentMain å¦å¤–ï¼Œä¸ºäº†è¿è¡Œ Attach APIï¼Œæˆ‘ä»¬å¯ä»¥å†å†™ä¸€ä¸ªæ§åˆ¶ç¨‹åºæ¥æ¨¡æ‹Ÿç›‘æ§è¿‡ç¨‹ï¼šï¼ˆä»£ç ç‰‡æ®µï¼‰ import com.sun.tools.attach.VirtualMachine; import com.sun.tools.attach.VirtualMachineDescriptor; â€¦â€¦ // ä¸€ä¸ªè¿è¡Œ Attach API çš„çº¿ç¨‹å­ç±» static class AttachThread extends Thread { private final List&lt;VirtualMachineDescriptor&gt; listBefore; private final String jar; AttachThread(String attachJar, List&lt;VirtualMachineDescriptor&gt; vms) { listBefore = vms; // è®°å½•ç¨‹åºå¯åŠ¨æ—¶çš„ VM é›†åˆ jar = attachJar; } public void run() { VirtualMachine vm = null; List&lt;VirtualMachineDescriptor&gt; listAfter = null; try { int count = 0; while (true) { listAfter = VirtualMachine.list(); for (VirtualMachineDescriptor vmd : listAfter) { if (!listBefore.contains(vmd)) { // å¦‚æœ VM æœ‰å¢åŠ ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯è¢«ç›‘æ§çš„ VM å¯åŠ¨äº† // è¿™æ—¶ï¼Œæˆ‘ä»¬å¼€å§‹ç›‘æ§è¿™ä¸ª VM vm = VirtualMachine.attach(vmd); break; } } Thread.sleep(500); count++; if (null != vm || count &gt;= 10) { break; } } vm.loadAgent(jar); vm.detach(); } catch (Exception e) { ignore } } } â€¦â€¦ public static void main(String[] args) throws InterruptedException { new AttachThread(&quot;TestInstrument1.jar&quot;, VirtualMachine.list()).start(); } } è¿è¡Œæ—¶ï¼Œå¯ä»¥é¦–å…ˆè¿è¡Œä¸Šé¢è¿™ä¸ªå¯åŠ¨æ–°çº¿ç¨‹çš„ main å‡½æ•°ï¼Œç„¶åï¼Œåœ¨ 5 ç§’é’Ÿå†…ï¼ˆä»…ä»…ç®€å•æ¨¡æ‹Ÿ JVM çš„ç›‘æ§è¿‡ç¨‹ï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨æµ‹è¯• Jar æ–‡ä»¶ : java â€“ javaagent:TestInstrument2.jar â€“ cp TestInstrument2.jar TestMainInJar å¦‚æœæ—¶é—´æŒæ¡å¾—ä¸å¤ªå·®çš„è¯ï¼Œç¨‹åºé¦–å…ˆä¼šåœ¨å±å¹•ä¸Šæ‰“å‡º 1ï¼Œè¿™æ˜¯æ”¹åŠ¨å‰çš„ç±»çš„è¾“å‡ºï¼Œç„¶åä¼šæ‰“å‡ºä¸€äº› 2ï¼Œè¿™ä¸ªè¡¨ç¤º agentmain å·²ç»è¢« Attach API æˆåŠŸé™„ç€åˆ° JVM ä¸Šï¼Œä»£ç†ç¨‹åºç”Ÿæ•ˆäº†ï¼Œå½“ç„¶ï¼Œè¿˜å¯ä»¥çœ‹åˆ°â€œAgent Main Doneâ€å­—æ ·çš„è¾“å‡ºã€‚ ä»¥ä¸Šä¾‹å­ä»…ä»…åªæ˜¯ç®€å•ç¤ºä¾‹ï¼Œç®€å•è¯´æ˜è¿™ä¸ªç‰¹æ€§è€Œå·²ã€‚çœŸå®çš„ä¾‹å­å¾€å¾€æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”å¯èƒ½è¿è¡Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒçš„å¤šä¸ª JVM ä¹‹ä¸­ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Java,Instrumentation","slug":"Java-Instrumentation","permalink":"/tags/Java-Instrumentation/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–302å“åº”ä¸­çš„Locationä¿¡æ¯","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–302å“åº”ä¸­çš„Locationä¿¡æ¯","date":"2020-06-06T08:52:10.000Z","updated":"2023-04-30T10:21:41.353Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–302å“åº”ä¸­çš„Locationä¿¡æ¯/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--è·å–302å“åº”ä¸­çš„Locationä¿¡æ¯/","excerpt":"","text":"HttpClientè·å–302å“åº”ä¸­çš„Locationå¤´ä¿¡æ¯public static String getLocationUrl(String url) { RequestConfig config = RequestConfig.custom().setConnectTimeout(50000).setConnectionRequestTimeout(10000).setSocketTimeout(50000) .setRedirectsEnabled(false).build();//ä¸å…è®¸é‡å®šå‘ CloseableHttpClient httpClient = HttpClients.custom().setDefaultRequestConfig(config).build(); String location = null; int responseCode = 0; HttpResponse response; try { response = httpClient.execute(new HttpGet(url)); responseCode = response.getStatusLine().getStatusCode(); if (responseCode == 302) { Header locationHeader = response.getFirstHeader(&quot;Location&quot;); location = locationHeader.getValue(); } } catch (Exception e) { e.printStackTrace(); } return location; }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"302,Java,Location","slug":"302-Java-Location","permalink":"/tags/302-Java-Location/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Future","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Future","date":"2020-06-06T08:51:10.000Z","updated":"2023-04-30T10:21:41.341Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Future/","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Future/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€ŠJavaç‰¹ç§å…µï¼ˆä¸Šå†Œï¼‰ã€‹ æ¥å£ Future&lt;V&gt; å¯ç”¨äºè·å–å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚å®ƒæä¾›äº†æ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•ï¼Œä»¥ç­‰å¾…è®¡ç®—çš„å®Œæˆï¼Œå¹¶è·å–è®¡ç®—çš„ç»“æœã€‚è®¡ç®—å®Œæˆååªèƒ½ä½¿ç”¨ get() æ–¹æ³•æ¥è·å–ç»“æœï¼Œå¦‚æœ‰å¿…è¦ï¼Œè®¡ç®—å®Œæˆå‰å¯ä»¥é˜»å¡æ­¤æ–¹æ³•ã€‚å–æ¶ˆåˆ™ç”± cancel() æ–¹æ³•æ¥æ‰§è¡Œã€‚è¿˜æä¾›äº†å…¶ä»–æ–¹æ³•ï¼Œä»¥ç¡®å®šä»»åŠ¡æ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯è¢«å–æ¶ˆäº†ã€‚ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å†å–æ¶ˆè®¡ç®—ã€‚å¦‚æœä¸ºäº†å¯å–æ¶ˆæ€§è€Œä½¿ç”¨ Future ä½†åˆä¸æä¾›å¯ç”¨çš„ç»“æœï¼Œåˆ™å¯ä»¥å£°æ˜ Future&lt;?&gt; å½¢å¼ç±»å‹ï¼Œå¹¶è¿”å› null ä½œä¸ºåº•å±‚ä»»åŠ¡çš„ç»“æœã€‚ package java.util.concurrent; import java.util.concurrent.ExecutionException; import java.util.concurrent.TimeUnit; import java.util.concurrent.TimeoutException; public interface Future&lt;V&gt; { /* * å°è¯•å°†ä»»åŠ¡çš„çŠ¶æ€ä¿®æ”¹ä¸ºCANCELLED * è¯¥åŠ¨ä½œè‹¥å°†çŠ¶æ€æˆåŠŸä¿®æ”¹ä¸ºCANCELLEDï¼Œåˆ™ä¼šé‡Šæ”¾AQSçš„é”ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false * ä¼ å…¥çš„booleanå‚æ•°å¦‚æœä¸ºtrueï¼Œåˆ™åˆ¤å®šå¦‚æœæœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ runnerï¼Œåˆ™ä¼šå°†å…¶ä¸­æ–­ */ boolean cancel(boolean mayInterruptIfRunning); /* * åˆ¤å®šä»»åŠ¡çš„çŠ¶æ€æ˜¯å¦ä¸ºCANCELLED */ boolean isCancelled(); /* * åˆ¤å®šä»»åŠ¡æ˜¯å¦ç»“æŸ * è¯¥æ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œè‹¥è¿”å›trueï¼Œåˆ™è¡¨ç¤ºä»»åŠ¡å·²ç»ç»“æŸ */ boolean isDone(); /* * å°è¯•è·å–ä»»åŠ¡ç»“æŸçš„è¿”å›å€¼ * å¦‚æœæ˜¯Runnable åˆ™é€šå¸¸è¿”å›nullï¼Œå¦‚æœæ˜¯Callable åˆ™è¿”å›å¯¹åº”çš„returnå€¼ * è‹¥ä»»åŠ¡å°šæœªç»“æŸï¼Œåˆ™å½“å‰çº¿ç¨‹å°†ä¼šç­‰å¾…ç›´åˆ°ä»»åŠ¡ç»“æŸæ‰è¿”å› */ V get() throws InterruptedException, ExecutionException; /* * å°è¯•è·å–ä»»åŠ¡ç»“æŸçš„è¿”å›å€¼ * è¾¾åˆ°è®¾ç½®çš„è¶…æ—¶æ—¶é—´åï¼Œåˆ™ä¼šè‡ªåŠ¨æ”¾å¼ƒç­‰å¾…ï¼Œå¹¶æŠ›å‡ºTimeoutExceptionå¼‚å¸¸ */ V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException; } Future æ¥å£æœ‰å¾ˆå¤šå®ç°ç±»ï¼Œç”¨å¾—è¾ƒå¤šçš„æ˜¯FutureTaskï¼Œç”¨äºå®ç°å¯å–æ¶ˆçš„å¼‚æ­¥è®¡ç®—åŠŸèƒ½ï¼šåˆ©ç”¨å¼€å§‹å’Œå–æ¶ˆè®¡ç®—çš„æ–¹æ³•ã€æŸ¥è¯¢è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•å’Œè·å–è®¡ç®—ç»“æœçš„æ–¹æ³•ã€‚æ­¤ç±»æä¾›äº†å¯¹ Future çš„åŸºæœ¬å®ç°ï¼Œä»…åœ¨è®¡ç®—å®Œæˆæ—¶æ‰èƒ½è·å–ç»“æœï¼Œå¦‚æœè®¡ç®—å°šæœªå®Œæˆï¼Œåˆ™é˜»å¡ get æ–¹æ³•ã€‚ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å†é‡æ–°å¼€å§‹æˆ–å–æ¶ˆè®¡ç®—ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨FutureTaskè¿›è¡Œå¼‚æ­¥è®¡ç®—çš„ç®€å•æ ·ä¾‹ã€‚ package com.pengjunlee; import java.util.concurrent.Callable; import java.util.concurrent.ExecutionException; import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class FutureTaskTest { static class CallableImpl implements Callable&lt;Integer&gt; { private int[] addends; public CallableImpl(int[] addends) { this.addends = addends; } public Integer call() throws Exception { int sum = 0; // ç®€å•çš„æ•°å­¦è®¡ç®—ï¼Œæ±‚å‡ºaddendsæ•°ç»„å†…çš„æ•°å­—æ€»å’Œ for (int i = 0; i &lt; addends.length; i++) { sum += addends[i]; } return sum; } } public static void main(String[] args) throws InterruptedException, ExecutionException { ExecutorService executorService = Executors.newFixedThreadPool(3); // ä»¥æ•°å­¦è®¡ç®—è·å–(1+2+3)*(4+5+6)*(7+8+9+10)çš„ç»“æœä¸ºä¾‹ int sum1 = executorService.submit( new CallableImpl(new int[] { 1, 2, 3 })).get(); int sum2 = executorService.submit( new CallableImpl(new int[] { 4, 5, 6 })).get(); int sum3 = executorService.submit( new CallableImpl(new int[] { 7, 8, 9, 10 })).get(); int result = sum1 * sum2 * sum3; System.out.println(&quot;(1+2+3)*(4+5+6)*(7+8+9+10)= &quot; + result); } } è¿ç®—ç»“æœï¼š (1+2+3)*(4+5+6)*(7+8+9+10)= 3060 FutureTaskå†…éƒ¨æœ‰ä¸€ä¸ªsyncå±æ€§ï¼Œè¿™ä¸ªå±æ€§æ‰€åœ¨çš„ç±»æ˜¯AQSï¼ˆAbstractQueuedSynchronizerï¼‰çš„å­ç±»ï¼Œå³å®ƒæ˜¯åŸºäºAQSæ¥å®ç°çš„ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Future,Java","slug":"Future-Java","permalink":"/tags/Future-Java/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Base64ç¼–ç ä¸è§£ç ","slug":"Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Base64ç¼–ç ä¸è§£ç ","date":"2020-06-06T08:50:10.000Z","updated":"2023-04-30T10:21:41.341Z","comments":true,"path":"2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Base64ç¼–ç ä¸è§£ç /","link":"","permalink":"/2020/06/06/Javaæ ¸å¿ƒåŸºç¡€ä¹‹--Base64ç¼–ç ä¸è§£ç /","excerpt":"","text":"Base64ç®€ä»‹Base64æ˜¯ç½‘ç»œä¸Šæœ€å¸¸è§çš„ç”¨äºä¼ è¾“8Bitå­—èŠ‚ç çš„ç¼–ç æ–¹å¼ä¹‹ä¸€ï¼ŒBase64å°±æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„æ–¹æ³•ã€‚Base64ç¼–ç æ˜¯ä»äºŒè¿›åˆ¶åˆ°å­—ç¬¦çš„è¿‡ç¨‹ï¼Œå¯ç”¨äºåœ¨HTTPç¯å¢ƒä¸‹ä¼ é€’è¾ƒé•¿çš„æ ‡è¯†ä¿¡æ¯ã€‚ æŒ‰ç…§RFC2045çš„å®šä¹‰ï¼ŒBase64è¢«å®šä¹‰ä¸ºï¼šBase64å†…å®¹ä¼ é€ç¼–ç è¢«è®¾è®¡ç”¨æ¥æŠŠä»»æ„åºåˆ—çš„8ä½å­—èŠ‚æè¿°ä¸ºä¸€ç§ä¸æ˜“è¢«äººç›´æ¥è¯†åˆ«çš„å½¢å¼ã€‚ï¼ˆThe Base64 Content-Transfer-Encoding is designed to represent arbitrary sequences of octets in a form that need not be humanly readable.ï¼‰ BASE64ç¼–ç åŸç†Base64è¦æ±‚æŠŠæ¯ä¸‰ä¸ª8Bitçš„å­—èŠ‚è½¬æ¢ä¸ºå››ä¸ª6Bitçš„å­—èŠ‚ï¼ˆ3*8 = 4*6 = 24ï¼‰ï¼Œç„¶åæŠŠ6Bitå†æ·»ä¸¤ä½é«˜ä½0ï¼Œç»„æˆå››ä¸ª8Bitçš„å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè½¬æ¢åçš„å­—ç¬¦ä¸²ç†è®ºä¸Šå°†è¦æ¯”åŸæ¥çš„é•¿1/3ã€‚ Base64ç¼–ç éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š æŠŠ3ä¸ªå­—ç¬¦å˜æˆ4ä¸ªå­—ç¬¦ã€‚ æ¯76ä¸ªå­—ç¬¦åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ æœ€åçš„ç»“æŸç¬¦ä¹Ÿè¦å¤„ç†ã€‚ è½¬ç è¿‡ç¨‹ç¤ºä¾‹ï¼š 3*8=4*6 å†…å­˜1ä¸ªå­—èŠ‚å 8ä½ è½¬å‰ï¼š s 1 3 å…ˆè½¬æˆasciiï¼šå¯¹åº” 115 49 51 å†è½¬æˆ2è¿›åˆ¶ï¼š01110011 00110001 00110011 3*8ã€å…±24ä½ï¼š 01110011 00110001 00110011 6ä½ä¸€ç»„ã€åˆ†ä¸º4ç»„ï¼š011100 110011 000100 110011 ç„¶è€Œè®¡ç®—æœºæ˜¯ä»¥byteï¼ˆ1byte=8ä½ï¼‰ä¸ºæœ€å°å•ä½è¿›è¡Œæ•°æ®å­˜å‚¨çš„ï¼Œ6ä½ä¸å¤Ÿ8ä½ï¼Œé«˜ä½éœ€è¡¥0 æ¯ä¸€ç»„é«˜ä½è¡¥ä¸¤ä¸ª0ï¼š 00011100 00110011 00000100 00110011 å¾—åˆ°4ä¸ªæ•´æ•°å€¼ï¼š 28 51 4 51 å¯¹ç…§è½¬æ¢è¡¨ï¼šç»“æœc z E z ä»ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼ŒBASE64ç¼–ç ç®—æ³•å¹¶ä¸ç®—æ˜¯çœŸæ­£çš„åŠ å¯†ç®—æ³•ï¼Œå®ƒåªæ˜¯å°†æºæ•°æ®è½¬ç æˆä¸ºäº†ä¸€ç§ä¸æ˜“é˜…è¯»çš„å½¢å¼ï¼Œè€Œè½¬ç çš„è§„åˆ™æ˜¯å…¬å¼€çš„ï¼ˆè§£ç å¾ˆå®¹æ˜“ï¼‰ã€‚è½¬ç ä¹‹åçš„æ•°æ®å…·æœ‰ä¸å¯è¯»æ€§ï¼Œéœ€è¦è§£ç åæ‰èƒ½é˜…è¯»ã€‚ æ³¨ï¼šBASE64åŠ å¯†åäº§ç”Ÿçš„å­—èŠ‚ä½æ•°æ˜¯8çš„å€æ•°ï¼Œå¦‚æœä¸å¤Ÿä½æ•°ä»¥=ç¬¦å·å¡«å……ã€‚ Javaå®ç°BASE64åå°„/* encode by Base64 */ public static String encodeBase64(byte[] input) throws Exception { Class clazz = Class.forName(&quot;com.sun.org.apache.xerces.internal.impl.dv.util.Base64&quot;); Method mainMethod = clazz.getMethod(&quot;encode&quot;, byte[].class); mainMethod.setAccessible(true); Object retObj = mainMethod.invoke(null, new Object[] { input }); return (String) retObj; } /* decode by Base64 */ public static byte[] decodeBase64(String input) throws Exception { Class clazz = Class.forName(&quot;com.sun.org.apache.xerces.internal.impl.dv.util.Base64&quot;); Method mainMethod = clazz.getMethod(&quot;decode&quot;, String.class); mainMethod.setAccessible(true); Object retObj = mainMethod.invoke(null, input); return (byte[]) retObj; } ä½¿ç”¨commons-codec.jar/* encode by Base64 */ public static String encodeBase64(byte[] input) throws Exception { return new String(Base64.encodeBase64(input)); } /* decode by Base64 */ public static byte[] decodeBase64(String input) throws Exception { return Base64.decodeBase64(input); } Base64.encodeBase64()æœ‰å‡ ä¸ªé‡è½½çš„æ–¹æ³•ï¼š Base64.encodeBase64(binaryData) //é»˜è®¤ä¸æ¢è¡Œ Base64.encodeBase64(binaryData, isChunked) //isChunkedä¸ºtrueæ—¶æ¢è¡Œ,falseä¸æ¢è¡Œ Base64.encodeBase64Chunked(binaryData) //é»˜è®¤æ¢è¡Œ Base64.encodeBase64String(binaryData) //ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å› ç„¶è€Œï¼Œæ ‡å‡†çš„Base64å¹¶ä¸é€‚åˆç›´æ¥æ”¾åœ¨URLé‡Œä¼ è¾“ï¼Œå› ä¸ºURLç¼–ç å™¨ä¼šæŠŠæ ‡å‡†Base64ä¸­çš„â€œ/â€å’Œâ€œ+â€å­—ç¬¦å˜ä¸ºå½¢å¦‚â€œ%XXâ€çš„å½¢å¼ï¼Œè€Œè¿™äº›â€œ%â€å·åœ¨å­˜å…¥æ•°æ®åº“æ—¶è¿˜éœ€è¦å†è¿›è¡Œè½¬æ¢ï¼Œå› ä¸ºANSI SQLä¸­å·²å°†â€œ%â€å·ç”¨ä½œé€šé…ç¬¦ã€‚ ä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œå¯é‡‡ç”¨ä¸€ç§ç”¨äºURLçš„æ”¹è¿›Base64ç¼–ç ï¼Œå®ƒä¸ä»…åœ¨æœ«å°¾å»æ‰å¡«å……çš„â€™=â€™å·ï¼Œå¹¶å°†æ ‡å‡†Base64ä¸­çš„â€œ+â€å’Œâ€œ/â€åˆ†åˆ«æ”¹æˆäº†â€œ-â€å’Œâ€œ_â€ï¼Œè¿™æ ·å°±å…å»äº†åœ¨URLç¼–è§£ç å’Œæ•°æ®åº“å­˜å‚¨æ—¶æ‰€è¦ä½œçš„è½¬æ¢ï¼Œé¿å…äº†ç¼–ç ä¿¡æ¯é•¿åº¦åœ¨æ­¤è¿‡ç¨‹ä¸­çš„å¢åŠ ï¼Œå¹¶ç»Ÿä¸€äº†æ•°æ®åº“ã€è¡¨å•ç­‰å¤„å¯¹è±¡æ ‡è¯†ç¬¦çš„æ ¼å¼ã€‚ Base64ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼Œç”¨äºæä¾›å®‰å…¨çš„URL(è½¬æ¢+ä¸º-ã€/ä¸º_ã€å°†å¤šä½™çš„=å»æ‰)ï¼š Base64.encodeBase64(binaryData, isChunked, urlSafe)//urlSafeä¸ºtrueæ—¶è¿›è¡Œå®‰å…¨è½¬æ¢ Base64.encodeBase64URLSafe(binaryData)//é»˜è®¤è¿›è¡Œå®‰å…¨è½¬æ¢ Base64.encodeBase64URLSafeString(binaryData)//é»˜è®¤è¿›è¡Œå®‰å…¨è½¬æ¢ï¼Œå¹¶ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å› ä½¿ç”¨sun.misc.BASE64Encoderå’Œsun.misc.BASE64Decoder /* encode by Base64 */ public static String encodeBase64(byte[] input) throws Exception { return new BASE64Encoder().encode(input); } /* decode by Base64 */ public static byte[] decodeBase64(String input) throws Exception { byte[] output = null; try { BASE64Decoder decoder = new BASE64Decoder(); output = decoder.decodeBuffer(input); } catch (IOException e) { e.printStackTrace(); } return output; } æ³¨ï¼šåœ¨eclipseä¸­å¯¹sun.miscåŒ…é»˜è®¤è®¿é—®ç­–ç•¥ä¸ºForbidden(ç¦æ­¢)ï¼Œä¼šå¯¼è‡´è¯¥åŒ…æ— æ³•å¯¼å…¥ï¼Œè§£å†³åŠæ³•ï¼š--&gt;å³é”®é¡¹ç›® --&gt;Properties --&gt;Java Bulid Path-&gt; Libraries--&gt;JRE System Library--&gt;Access rules--&gt;åŒå‡»Type Access Rulesåœ¨Accessibleä¸­æ·»åŠ accessibleï¼Œä¸‹é¢å¡«ä¸Š** ç‚¹å‡»ç¡®å®šã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"Base64,Java,ç¼–ç ä¸è§£ç ","slug":"Base64-Java-ç¼–ç ä¸è§£ç ","permalink":"/tags/Base64-Java-ç¼–ç ä¸è§£ç /"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Eurekaæ³¨å†Œæ¢ç§˜","slug":"SpringCloudä¹‹--Eurekaæ³¨å†Œæ¢ç§˜","date":"2020-05-31T08:51:38.000Z","updated":"2023-04-30T10:21:41.365Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Eurekaæ³¨å†Œæ¢ç§˜/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Eurekaæ³¨å†Œæ¢ç§˜/","excerpt":"","text":"è½¬è½½è‡ªï¼šEurekaä¸­RetryableClientQuarantineRefreshPercentageå‚æ•°æ¢ç§˜ å‰è¨€æˆ‘ä»¬çŸ¥é“Eurekaåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ŒEureka Serverå’ŒEureka Clientã€‚Eureka Serverå……å½“æ³¨å†Œä¸­å¿ƒçš„è§’è‰²ï¼ŒEureka Clientç›¸å¯¹äºEureka Serveræ¥è¯´æ˜¯å®¢æˆ·ç«¯ï¼Œéœ€è¦å°†è‡ªèº«ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»çš„å°±æ˜¯åœ¨Eureka Clientæ³¨å†Œåˆ°Eureka Serveræ—¶RetryableClientQuarantineRefreshPercentageå‚æ•°çš„ä½¿ç”¨æŠ€å·§ã€‚ Eureka Clientæ³¨å†Œè¿‡ç¨‹åˆ†æEureka Clientæ³¨å†Œåˆ°Eureka Serveræ—¶ï¼Œé¦–å…ˆé‡åˆ°ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯Eureka Clientç«¯è¦çŸ¥é“Serverçš„åœ°å€ï¼Œè¿™ä¸ªå‚æ•°å¯¹åº”çš„æ˜¯eureka.client.service-url.defaultZoneï¼Œä¸¾ä¸ªä¾‹å­ï¼Œåœ¨Eureka Clientçš„propertiesæ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ï¼š eureka.client.service-url.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka,http://localhost:8763/eureka,http://localhost:8764/eureka å¦‚ä¸Šæ‰€ç¤ºï¼ŒEureka Clienté…ç½®å¯¹åº”çš„Eureka Serveråœ°å€åˆ†åˆ«æ˜¯8761ã€8762ã€8763ã€8764ã€‚è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š Eureka Clientä¼šå°†è‡ªèº«ä¿¡æ¯åˆ†åˆ«æ³¨å†Œåˆ°è¿™å››ä¸ªåœ°å€å—ï¼Ÿ Eureka Clinentæ³¨å†Œæœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ æºç é¢å‰ä¸€ç›®äº†ç„¶ï¼Œå¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜æˆ‘ä»¬é€šè¿‡æºç æ¥è§£ç­”è¿™ä¸¤ä¸ªé—®é¢˜ã€‚Eureka Clientåœ¨å¯åŠ¨çš„æ—¶å€™æ³¨å†Œæºç å¦‚ä¸‹ï¼šRetryableEurekaHttpClientä¸­çš„executæ–¹æ³• @Override protected &lt;R&gt; EurekaHttpResponse&lt;R&gt; execute(RequestExecutor&lt;R&gt; requestExecutor) { List&lt;EurekaEndpoint&gt; candidateHosts = null; int endpointIdx = 0; for (int retry = 0; retry &lt; numberOfRetries; retry++) { EurekaHttpClient currentHttpClient = delegate.get(); EurekaEndpoint currentEndpoint = null; if (currentHttpClient == null) { if (candidateHosts == null) { candidateHosts = getHostCandidates(); if (candidateHosts.isEmpty()) { throw new TransportException(&quot;There is no known eureka server; cluster server list is empty&quot;); } } if (endpointIdx &gt;= candidateHosts.size()) { throw new TransportException(&quot;Cannot execute request on any known server&quot;); } currentEndpoint = candidateHosts.get(endpointIdx++); currentHttpClient = clientFactory.newClient(currentEndpoint); } try { EurekaHttpResponse&lt;R&gt; response = requestExecutor.execute(currentHttpClient); if (serverStatusEvaluator.accept(response.getStatusCode(), requestExecutor.getRequestType())) { delegate.set(currentHttpClient); if (retry &gt; 0) { logger.info(&quot;Request execution succeeded on retry #{}&quot;, retry); } return response; } logger.warn(&quot;Request execution failure with status code {}; retrying on another server if available&quot;, response.getStatusCode()); } catch (Exception e) { logger.warn(&quot;Request execution failed with message: {}&quot;, e.getMessage()); // just log message as the underlying client should log the stacktrace } // Connection error or 5xx from the server that must be retried on another server delegate.compareAndSet(currentHttpClient, null); if (currentEndpoint != null) { quarantineSet.add(currentEndpoint); } } throw new TransportException(&quot;Retry limit reached; giving up on completing the request&quot;); } æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œä»£ç ç²¾ç®€åå†…å®¹å¦‚ä¸‹ï¼š int endpointIdx = 0; //ç”¨æ¥ä¿å­˜æ‰€æœ‰Eureka Serverä¿¡æ¯(8761ã€8762ã€8763ã€8764) List&lt;EurekaEndpoint&gt; candidateHosts = null; //numberOfRetriesçš„å€¼ä»£ç å†™æ­»é»˜è®¤ä¸º3æ¬¡ for (int retry = 0; retry &lt; numberOfRetries; retry++) { /** *é¦–æ¬¡è¿›å…¥å¾ªç¯æ—¶ï¼Œè·å–å…¨é‡çš„Eureka Serverä¿¡æ¯(8761ã€8762ã€8763ã€8764) */ if (candidateHosts == null) { candidateHosts = getHostCandidates(); } /** *é€šè¿‡endpointIdxè‡ªå¢ï¼Œä¾æ¬¡è·å–Eureka Serverä¿¡æ¯ï¼Œç„¶åå‘é€ *æ³¨å†Œçš„Postè¯·æ±‚. */ currentEndpoint = candidateHosts.get(endpointIdx++); currentHttpClient = clientFactory.newClient(currentEndpoint); try { /** *å‘é€æ³¨å†Œçš„Postè¯·æ±‚åŠ¨ä½œï¼Œæ³¨æ„å¦‚æœæˆåŠŸï¼Œåˆ™è·³å‡ºå¾ªç¯ï¼Œå¦‚æœå¤±è´¥åˆ™ *æ ¹æ®endpointIdxä¾æ¬¡è·å–ä¸‹ä¸€ä¸ªEureka Server. */ response = requestExecutor.execute(currentHttpClient); return respones; } catch (Exception e) { //å‘æ³¨å†Œä¸­å¿ƒ(Eureka Server)å‘èµ·æ³¨å†Œçš„postå‡ºç°å¼‚å¸¸æ—¶ï¼Œæ‰“å°æ—¥å¿—... } //å¦‚æœæ­¤æ¬¡æ³¨å†ŒåŠ¨ä½œå¤±è´¥ï¼Œå°†å½“å‰çš„ä¿¡æ¯ä¿å­˜åˆ°quarantineSetä¸­(ä¸€ä¸ªSeté›†åˆ) if (currentEndpoint != null) { quarantineSet.add(currentEndpoint); } } //å¦‚æœéƒ½å¤±è´¥,åˆ™ä»¥å¼‚å¸¸å½¢å¼æŠ›å‡º... throw new TransportException(&quot;Retry limit reached; giving up on completing the request&quot;); ä¸Šé¢ä»£ç ä¸­è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å¾ˆé‡è¦å°±æ˜¯ List candidateHosts = getHostCandidates();æ¥ä¸‹æ¥çœ‹ä¸‹getHostCandidates()æ–¹æ³•æºç ã€‚ private List&lt;EurekaEndpoint&gt; getHostCandidates() { List&lt;EurekaEndpoint&gt; candidateHosts = clusterResolver.getClusterEndpoints(); quarantineSet.retainAll(candidateHosts); // If enough hosts are bad, we have no choice but start over again int threshold = (int) (candidateHosts.size() * transportConfig.getRetryableClientQuarantineRefreshPercentage()); if (quarantineSet.isEmpty()) { // no-op } else if (quarantineSet.size() &gt;= threshold) { logger.debug(&quot;Clearing quarantined list of size {}&quot;, quarantineSet.size()); quarantineSet.clear(); } else { List&lt;EurekaEndpoint&gt; remainingHosts = new ArrayList&lt;&gt;(candidateHosts.size()); for (EurekaEndpoint endpoint : candidateHosts) { if (!quarantineSet.contains(endpoint)) { remainingHosts.add(endpoint); } } candidateHosts = remainingHosts; } return candidateHosts; } æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œå°†ä»£ç ç²¾ç®€ä¸‹ï¼ŒåªåŒ…æ‹¬å…³é”®é€»è¾‘ï¼Œå†…å®¹å¦‚ä¸‹ï¼š private List&lt;EurekaEndpoint&gt; getHostCandidates() { /** * è·å–æ‰€æœ‰defaultZoneé…ç½®çš„æ³¨å†Œä¸­å¿ƒä¿¡æ¯(Eureka Server)ï¼Œ * åœ¨æœ¬æ–‡ä¾‹å­ä¸­ä»£è¡¨4ä¸ª(8761ã€8762ã€8763ã€8764)Eureka Server */ List candidateHosts = clusterResolver.getClusterEndpoints(); /** * quarantineSetè¿™ä¸ªSeté›†åˆä¸­ä¿å­˜çš„æ˜¯ä¸å¯ç”¨çš„Eureka Server * æ­¤å¤„æ˜¯æ‹¿ä¸å¯ç”¨çš„Eureka Serverä¸å…¨é‡çš„Eureka Serverå–äº¤é›† */ quarantineSet.retainAll(candidateHosts); /** * æ ¹æ®RetryableClientQuarantineRefreshPercentageå‚æ•°è®¡ç®—é˜ˆå€¼ * è¯¥é˜ˆå€¼åç»­ä¼šå’ŒquarantineSetä¸­ä¿å­˜çš„ä¸å¯ç”¨çš„Eureka Serverä¸ªæ•° * ä½œæ¯”è¾ƒï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦è¿”å›å…¨é‡çš„Eureka Serverè¿˜æ˜¯è¿‡æ»¤æ‰ä¸å¯ç”¨çš„ * Eureka Serverã€‚ */ int threshold = (int) ( candidateHosts.size() * transportConfig.getRetryableClientQuarantineRefreshPercentage() ); if (quarantineSet.isEmpty()) { /** * é¦–æ¬¡è¿›å…¥çš„æ—¶å€™ï¼Œæ­¤æ—¶quarantineSetä¸ºç©ºï¼Œç›´æ¥è¿”å›å…¨é‡çš„ * Eureka Serveråˆ—è¡¨ */ } else if (quarantineSet.size() &gt;= threshold) { /** * å°†ä¸å¯ç”¨çš„Eureka Serverä¸thresholdå€¼ç›¸æ¯”è¾ƒï¼Œå¦‚æœä¸å¯ * ç”¨çš„Eureka Serverä¸ªæ•°å¤§äºé˜ˆå€¼ï¼Œåˆ™å°†ä¹‹å‰ä¿å­˜çš„Eureka * Serverå†…å®¹ç›´æ¥æ¸…ç©ºï¼Œå¹¶è¿”å›å…¨é‡çš„Eureka Serveråˆ—è¡¨ã€‚ */ quarantineSet.clear(); } else { /** * é€šè¿‡quarantineSeté›†åˆä¿å­˜ä¸å¯ç”¨çš„Eureka Serveræ¥è¿‡æ»¤ * å…¨é‡çš„EurekaServerï¼Œä»è€Œè·å–æ­¤æ¬¡Eureka Clientè¦æ³¨å†Œè¦ * æ³¨å†Œçš„Eureka Serverå®ä¾‹åœ°å€ã€‚ */ List&lt;EurekaEndpoint&gt; remainingHosts = new ArrayList&lt;&gt;(candidateHosts.size()); for (EurekaEndpoint endpoint : candidateHosts) { if (!quarantineSet.contains(endpoint)) { remainingHosts.add(endpoint); } } candidateHosts = remainingHosts; } return candidateHosts; } é€šè¿‡æºç åˆ†æï¼Œæˆ‘ä»¬ç°åœ¨åˆæ­¥çŸ¥é“ï¼Œå½“Eureka Clientå‘Eureka Serverå‘èµ·æ³¨å†Œè¯·æ±‚çš„æ—¶å€™(æ ¹æ®defaultZoneå¯»æ‰¾Eureka Serveråˆ—è¡¨)ï¼Œå¦‚æœæœ‰ä¸€æ¬¡è¯·æ±‚æ³¨å†ŒæˆåŠŸï¼Œé‚£ä¹ˆåç»­å°±ä¸ä¼šåœ¨å‘å…¶ä»–Eureka Serverå‘èµ·æ³¨å†Œè¯·æ±‚ã€‚ä»¥æœ¬æ–‡ä¸ºä¾‹ï¼Œæ³¨å†Œä¸­å¿ƒæœ‰å››ä¸ª(8761ã€8762ã€8763ã€8764)ã€‚å¦‚æœ8761å¯¹åº”çš„Eureka ServeræœåŠ¡çš„çŠ¶æ€æ˜¯UPï¼Œé‚£ä¹ˆEureka Clientå‘è¯¥æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæˆåŠŸåï¼Œä¸ä¼šå†å‘(8762ã€8763ã€8764)å¯¹åº”çš„Eureka Serverå‘èµ·æ³¨å†Œè¯·æ±‚(å¯¹åº”ç¨‹åºæ˜¯åœ¨forå¾ªç¯ä¸­ç›´æ¥return respones)ã€‚ è¯´åˆ°è¿™é‡Œåˆå¼•å‡ºæ¥å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ8761è¿™ä¸ªEureka Serveræ˜¯downæ‰çš„å‘¢ï¼Ÿ æ ¹æ®æºç æˆ‘ä»¬å¯çŸ¥Eureka Clienté¦–æ¬¡ä¼šå‘8761è¿™ä¸ªServerå‘èµ·æ³¨å†Œè¯·æ±‚ï¼Œå¦‚æœè¯¥Serverçš„çŠ¶æ€æ˜¯downï¼Œé‚£ä¹ˆå®ƒä¼šå°†è¯¥Serverä¿å­˜åˆ°quarantineSetè¿™ä¸ªSeté›†åˆä¸­ï¼Œç„¶åå†æ¬¡è®¿é—®8762è¿™ä¸ªEureka Serverï¼Œå¦‚æœ8762è¿™ä¸ªServerçš„çŠ¶æ€ä¾æ—§æ˜¯downï¼Œå®ƒä¹Ÿä¼šæŠŠè¿™ä¸ªServerä¿å­˜åˆ°quarantineSetè¿™ä¸ªSeté›†åˆä¸­ï¼Œç„¶åç»§ç»­è®¿é—®8763è¿™ä¸ªServerï¼Œå¦‚æœ8763è¿™ä¸ªServerçš„çŠ¶æ€ä¾æ—§æ˜¯downï¼Œæ­¤æ—¶é™¤äº†ä¼šå°†å…¶ä¿å­˜åˆ°quarantineSetè¿™ä¸ªSeté›†åˆä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šè·³å‡ºæœ¬æ¬¡å¾ªç¯ã€‚ä»è€Œç»“æŸæ­¤æ¬¡æ³¨å†Œè¿‡ç¨‹ã€‚ è¯´é“è¿™é‡Œæœ‰äººè¦é—®æ¥ä¸‹æ¥ä¼šä¸ä¼šå‘8764è¿™ä¸ªServerå‘èµ·æ³¨å†Œï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºå¾ªç¯çš„æ¬¡æ•°é»˜è®¤æ˜¯3æ¬¡ã€‚æ‰€ä»¥å³ä½¿8764è¿™ä¸ªServerçš„çŠ¶æ€æ˜¯UPï¼Œå®ƒä¹Ÿä¸ä¼šæ¥æ”¶åˆ°æ¥è‡ªEureka Clientå‘èµ·çš„æ³¨å†Œä¿¡æ¯ã€‚ Eureka Clientå‘Eureka Serverå‘èµ·æ³¨å†Œä¿¡æ¯çš„è¿‡ç¨‹é™¤äº†åœ¨Eureka Clientå¯åŠ¨çš„æ—¶å€™è§¦å‘ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯åå°å®šæ—¶ä»»åŠ¡ã€‚ å‡è®¾æˆ‘ä»¬ä¸Šé¢æè¿°çš„åœºæ™¯æ˜¯åœ¨Eureka Clientå¯åŠ¨çš„æ—¶å€™ï¼Œå› ä¸ºåœ¨å¯åŠ¨çš„æ—¶å€™æ³¨å†Œè¿™ä¸ªè¿‡ç¨‹å…¨éƒ¨å¤±è´¥äº†ï¼Œå½“åå°å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè¿˜ä¼šè¿›å…¥è¯¥æ³¨å†Œæµç¨‹ã€‚æ³¨æ„æ­¤æ—¶quarantineSetçš„å€¼ä¸º3(8761ã€8762ã€8763ä¹‹å‰æ³¨å†Œå¤±è´¥çš„Eureka Server)ã€‚ æ‰€ä»¥å½“ç¨‹åºå†æ¬¡è¿›å…¥getHostCandidates()æ–¹æ³•æ—¶ï¼Œif (quarantineSet.isEmpty())è¿™ä¸ªæ–¹æ³•æ˜¯ä¸æ»¡è¶³çš„ï¼Œæ¥ä¸‹æ¥ä¼šèµ°else if (quarantineSet.size() &gt;= threshold)è¿™ä¸ªåˆ¤æ–­ï¼Œå¦‚æœè¿™ä¸ªåˆ¤æ–­æˆç«‹ï¼Œé‚£ä¹ˆä¼šå°†quarantineSeté›†åˆæ¸…ç©ºï¼ŒåŒæ—¶è¿”å›å…¨é‡çš„Eureka Serveråˆ—è¡¨ï¼Œå¦‚æœè¿™ä¸ªåˆ¤æ–­ä¸æˆç«‹ï¼Œä¼šæ‹¿quarantineSeté›†åˆä¸­ä¿å­˜çš„å†…å®¹å»è¿‡æ»¤Eureka Serverçš„å…¨é‡åˆ—è¡¨ã€‚ä»¥æœ¬æ–‡ä¸ºä¾‹ï¼šquarantineSetä¸­ä¿å­˜çš„æ˜¯(8761ã€8762ã€8763)ä¸‰ä¸ªEureka Serverï¼ŒEureka Serverå…¨é‡åˆ—è¡¨çš„å†…å®¹æ˜¯(8761ã€8762ã€8763ã€8764)å››ä¸ªEureka Serverï¼Œè¿‡æ»¤åè¿”å›çš„ç»“æœä¸º8764è¿™ä¸ªEureka Serverã€‚ åœ¨æœ¬æ–‡çš„ä¾‹å­ä¸­8761ã€8762ã€8763è¿™ä¸‰ä¸ªEureka Serverçš„çŠ¶æ€æ˜¯downè€Œ8764è¿™ä¸ªEureka Serverçš„çŠ¶æ€æ˜¯UPï¼Œæˆ‘ä»¬å…¶å®æ˜¯æƒ³èµ°åˆ°æœ€åçš„elseåˆ†æ”¯ï¼Œä»è€Œå®Œæˆè¿‡æ»¤æ“ä½œï¼Œå¹¶æœ€ç»ˆå¾—åˆ°8764è¿™ä¸ªServerï¼Œé—æ†¾çš„æ˜¯å®ƒå¹¶ä¸ä¼šèµ°åˆ°è¿™ä¸ªåˆ†æ”¯ï¼Œè€Œæ˜¯è¢«ä¸Šé¢çš„else if (quarantineSet.size() &gt;= threshold)è¿™ä¸ªåˆ†æ”¯æ‰€æ‹¦æˆªï¼Œè¿”å›çš„ä¾æ—§æ˜¯å…¨é‡çš„Eureka Serveråˆ—è¡¨ã€‚è¿™æ ·é€ æˆçš„åæœå°±æ˜¯Eureka Clientä¾æ—§ä¼šä¾æ¬¡å‘(8761ã€8762ã€8763)è¿™ä¸‰ä¸ªdownçš„Eureka Serverå‘èµ·æ³¨å†Œè¯·æ±‚ã€‚ é‚£ä¹ˆé—®é¢˜çš„å…³é”®åœ¨å“ªé‡Œå‘¢ï¼Ÿé—®é¢˜çš„å…³é”®å°±æ˜¯thresholdè¿™ä¸ªå€¼çš„ç”±æ¥ï¼Œå› ä¸ºæ­¤æ—¶quarantineSet.size()çš„å€¼ä¸º3ï¼Œè€Œ3è¿™ä¸ªå€¼å¤§äºthresholdï¼Œä»è€Œå¯¼è‡´ï¼Œä¼šå°†quarantineSeté›†åˆæ¸…ç©ºï¼Œè¿”å›å…¨é‡çš„Serveråˆ—è¡¨ã€‚ æˆ‘ä»¬çŸ¥é“thresholdè¿™ä¸ªå€¼æ˜¯æ ¹æ®å…¨é‡çš„Eureka Serveråˆ—è¡¨ä¹˜ä»¥ä¸€ä¸ªå¯é…ç½®çš„å‚æ•°è®¡ç®—å‡ºæ¥çš„ï¼Œåœ¨æœ¬æ–‡çš„ä¾‹å­å½“ä¸­ï¼Œæˆ‘çš„propertiesæ–‡ä»¶ä¸­é™¤äº†defaultZoneä¹‹å¤–å¹¶æ²¡æœ‰é…ç½®è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‚æ•°æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œé€šè¿‡æºç æˆ‘ä»¬äº†è§£åˆ°ï¼Œè¿™ä¸ªé»˜è®¤å€¼æ˜¯0.66ã€‚å…·ä½“æºç å¦‚ä¸‹ï¼š final class PropertyBasedTransportConfigConstants { /** *çœç•¥éƒ¨åˆ†æºç  */ static class Values { static final int SESSION_RECONNECT_INTERVAL = 20*60; //é»˜è®¤å€¼ä¸º0.66 static final double QUARANTINE_REFRESH_PERCENTAGE = 0.66; static final int DATA_STALENESS_TRHESHOLD = 5*60; static final int ASYNC_RESOLVER_REFRESH_INTERVAL = 5*60*1000; static final int ASYNC_RESOLVER_WARMUP_TIMEOUT = 5000; static final int ASYNC_EXECUTOR_THREADPOOL_SIZE = 5; } } /** *@return the percentage of the full endpoints set above which the *quarantine set is cleared in the range [0, 1.0] */ double getRetryableClientQuarantineRefreshPercentage(); çœ‹åˆ°è¿™é‡Œå°±ä¸éš¾ç†è§£äº†ï¼Œå› ä¸ºè¿™ä¸ªå€¼æ˜¯0.66è€Œæ­¤æ—¶å…¨é‡çš„Eureka Serverå€¼ä¸º4ã€‚è®¡ç®—ä¹‹åçš„å€¼ä¸º2ï¼Œè€Œç”±äºæ³¨å†Œçš„forå¾ªç¯ä¸º3æ¬¡ï¼Œæ‰€ä»¥å½“ç¬¬äºŒæ¬¡å‘èµ·æ³¨å†Œæµç¨‹çš„æ—¶å€™quarantineSetçš„å€¼å§‹ç»ˆå¤§äºthresholdã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœ8761ã€8762ã€8763ä¸€ç›´æ˜¯downå³ä½¿8764ä¸€ç›´æ˜¯å¥½çš„ï¼Œé‚£ä¹ˆEureka Clientä¹Ÿä¸ä¼šæ³¨å†ŒæˆåŠŸã€‚è€Œä¸”è¿™ä¸ªå‚æ•°å€¼çš„åŒºé—´ä¸º0åˆ°1. æ—¢ç„¶é€šè¿‡æºç åˆ†ææˆ‘ä»¬æ‰¾åˆ°äº†é—®é¢˜æ ¹æºï¼Œå…¶å®å¯¹åº”çš„æˆ‘ä»¬ä¹Ÿæ‰¾åˆ°äº†è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•ï¼Œå°±æ˜¯å¯¹åº”æŠŠè¿™ä¸ªå‚æ•°å€¼è°ƒå¤§äº›ã€‚è¿™ä¸ªå€¼åœ¨propertiesä¸­å¯¹åº”çš„å†™æ³•å¦‚ä¸‹ï¼š eureka.client.transport.retryableClientQuarantineRefreshPercentage = xxx æ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸‹propertiesæ–‡ä»¶ï¼Œä¿®æ”¹åçš„å†…å®¹å¦‚ä¸‹ï¼š eureka.client.service-url.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka,http://localhost:8763/eureka,http://localhost:8764/eureka eureka.client.transport.retryableClientQuarantineRefreshPercentage=1 æ¥ä¸‹æ¥æŒ‰ç…§è¿™ä¸ªé…ç½®å†æ¬¡å›é¡¾ä¸‹ä¸Šé¢çš„æµç¨‹ï¼š Eureka Clientå¯åŠ¨æ—¶è¿›è¡Œæ³¨å†Œ(8761ã€8762ã€8763çš„çŠ¶æ€æ˜¯down)ï¼Œæ‰€ä»¥æ­¤æ—¶quarantineSetçš„å€¼ä¸º3. æ¥ä¸‹æ¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­åˆè§¦å‘æ³¨å†Œäº‹ä»¶ï¼Œæ­¤æ—¶å› ä¸ºå‚æ•°çš„å€¼ä»0.66è°ƒæ•´ä¸º1ã€‚æ‰€ä»¥è®¡ç®—å‡ºçš„thresholdçš„å€¼ä¸º4ã€‚è€Œæ­¤æ—¶quarantineSetçš„å€¼ä¸º3ã€‚æ‰€ä»¥ä¸ä¼šè¿›å…¥åˆ°else if (quarantineSet.size() &gt;= threshold)åˆ†æ”¯ï¼Œè€Œæ˜¯ä¼šè¿›å…¥æœ€åçš„esleåˆ†æ”¯ã€‚ åœ¨elseåˆ†æ”¯ä¸­ä¼šå®Œæˆè¿‡æ»¤åŠŸèƒ½ï¼Œæœ€ç»ˆè¿”å›çš„listä¸­çš„ç»“æœåªæœ‰ä¸€ä¸ªå°±æ˜¯8764è¿™ä¸ªEureka Serverã€‚ Eureka Clientå‘8764è¿™ä¸ªEureka Serverå‘èµ·æ³¨å†Œè¯·æ±‚ï¼Œå¾—åˆ°æˆåŠŸç›¸åº”ï¼Œå¹¶è¿”å›ã€‚ é—ç•™é—®é¢˜è¯´é“è¿™é‡Œæˆ‘ä»¬æ„Ÿè§‰å¥½åƒæ˜¯è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆé—®ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå‚æ•°å€¼å¯ä»¥è®¾ç½®çš„æ— é™å¤§å—ï¼Ÿ æ¯”å¦‚æˆ‘å°†è¿™ä¸ªå‚æ•°å€¼è®¾ç½®ä¸º10ï¼Œè™½ç„¶javaDocä¸­è¯´æ˜è¿™ä¸ªå‚æ•°å€¼çš„èŒƒå›´åœ¨0-1ä¹‹é—´ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¯´æ˜å¦‚æœå°†è¿™ä¸ªå‚æ•°è°ƒæ•´å¤§äº1ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µã€‚æ¥ä¸‹æ¥æŒ‰ç…§ä¸Šé¢çš„æµç¨‹æˆ‘ä»¬åˆ†æä¸‹ï¼š ä¹‹å‰æˆ‘ä»¬åˆ†æçš„æµç¨‹ä¸­çš„å‰ææ˜¯8761ã€8762ã€8763è¿™ä¸‰å°Serverçš„çŠ¶æ€æ˜¯downè€Œ8764è¿™ä¸ªserverçš„çŠ¶æ€æ˜¯upï¼Œç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸‹è¿™ä¸ªå‰æã€‚ å‡è®¾ä¸€å¼€å§‹8761ã€8762ã€8763ã€8764è¿™å››å°Eureka Serverçš„çŠ¶æ€éƒ½æ˜¯downã€‚Eureka Clientå¯åŠ¨æ—¶è¿›è¡Œæ³¨å†Œ(8761ã€8762ã€8763çš„çŠ¶æ€æ˜¯down)ï¼Œæ‰€ä»¥æ­¤æ—¶quarantineSetçš„å€¼ä¸º3. æ¥ä¸‹æ¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­åˆè§¦å‘æ³¨å†Œäº‹ä»¶ï¼Œæ­¤æ—¶å› ä¸ºå‚æ•°çš„å€¼ä»0.66è°ƒæ•´ä¸º10ã€‚æ‰€ä»¥è®¡ç®—å‡ºçš„thresholdçš„å€¼ä¸º40ã€‚è€Œæ­¤æ—¶quarantineSetçš„å€¼ä¸º3ã€‚æ‰€ä»¥ä¸ä¼šè¿›å…¥åˆ°else if (quarantineSet.size() &gt;= threshold)åˆ†æ”¯ï¼Œè€Œæ˜¯ä¼šè¿›å…¥æœ€åçš„esleåˆ†æ”¯ã€‚ åœ¨elseåˆ†æ”¯ä¸­ä¼šå®Œæˆè¿‡æ»¤åŠŸèƒ½ï¼Œæœ€ç»ˆè¿”å›çš„listä¸­çš„ç»“æœåªæœ‰ä¸€ä¸ªå°±æ˜¯8764è¿™ä¸ªEureka Serverã€‚ Eureka Clientå‘8764è¿™ä¸ªEureka Serverå‘èµ·æ³¨å†Œè¯·æ±‚ï¼Œå› ä¸ºæ­¤æ—¶8764çš„çŠ¶æ€ä¹Ÿæ˜¯downå¯¼è‡´æ³¨å†Œå¤±è´¥ï¼Œæ­¤æ—¶quarantineSetä¸­çš„å†…å®¹æ˜¯(8761ã€8762ã€8763ã€8764) å½“å®šæ—¶ä»»åŠ¡å†æ¬¡è§¦å‘æ—¶if (quarantineSet.isEmpty())è¿™ä¸ªåˆ†æ”¯ä¸ä¼šè¿›å…¥ï¼Œå› ä¸ºæ­¤æ—¶quarantineSetçš„å€¼ä¸º4 else if (quarantineSet.size() &gt;= threshold)è¿™åˆ†æ”¯ä¹Ÿä¸ä¼šè¿›å…¥å› ä¸ºthresholdçš„å€¼ä¸º40 æœ€ç»ˆä¼šè¿›å…¥elseåˆ†æ”¯ï¼Œè¿™ä¸ªåˆ†æ”¯åŸæœ¬çš„å«ä¹‰æ˜¯æƒ³é€šè¿‡quarantineSetæ¥å……å½“è¿‡æ»¤å™¨ï¼Œä»å…¨é‡çš„Eureka Serverä¸­è¿‡æ»¤æ‰ä¹‹å‰çŠ¶æ€ä¸ºdownçš„Eureka Serverï¼Œä½†æ˜¯ç”±äºquarantineSetçš„å€¼ç°åœ¨å·²ç»æ˜¯å…¨é‡ï¼Œå¯¼è‡´è¿‡æ»¤åçš„ç»“æœè¿”å›çš„æ˜¯ä¸€ä¸ªç©ºçš„listã€‚å³ä½¿æ­¤æ—¶Eureka Serveråˆ—è¡¨(8761ã€8762ã€8763ã€8764)ä»»ä½•ä¸€ä¸ªServerçš„çŠ¶æ€å˜ä¸ºUPï¼Œè¯¥Eureka Clientä¹Ÿä¸å¯èƒ½å®Œæˆæ³¨å†Œäº‹ä»¶ã€‚ è§£å†³åŠæ³•ä¸Šé¢å‡ºç°çš„é‚£ä¸ªé—®é¢˜ï¼Œæ ¹æœ¬åŸå› ä¸ªäººè®¤ä¸ºæ˜¯ç”±äºeureka.client.transport.retryableClientQuarantineRefreshPercentage å‚æ•°è¿‡å¤§è€Œæºç ä¸­æ²¡æœ‰æ ¡éªŒï¼Œä»è€Œå¯¼è‡´æ²¡æœ‰è¿›å…¥else if (quarantineSet.size() &gt;= threshold)çš„é€»è¾‘åˆ†æ”¯ï¼Œå› ä¸ºæ­¤æ—¶å¦‚æœquarantineSetä¸­çš„å€¼å·²ç»è¾¾åˆ°äº†æ‰€æœ‰Eureka Serveråˆ—è¡¨ï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬å¸Œæœ›çš„æ˜¯å°†è¿™ä¸ªSeté›†åˆæ¸…ç©ºï¼Œä»è€Œå†æ¬¡è¿”å›å…¨é‡çš„Eureka Serveråˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´å†é‡æ–°æ¥ä¸€æ¬¡æ³¨å†Œæµç¨‹ã€‚ æ‰€ä»¥åŸºäºä¸Šé¢çš„åˆ†æï¼Œä¸ªäººè®¤ä¸ºåœ¨æºç çš„getHostCandidateså¢åŠ ä¸‹æ ¡éªŒï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š private List&lt;EurekaEndpoint&gt; getHostCandidates() { List&lt;EurekaEndpoint&gt; candidateHosts = clusterResolver.getClusterEndpoints(); quarantineSet.retainAll(candidateHosts); // If enough hosts are bad, we have no choice but start over again int threshold = (int) (candidateHosts.size() * transportConfig.getRetryableClientQuarantineRefreshPercentage()); /** * å¢åŠ åˆ¤æ–­å¦‚æœthresholdçš„å€¼è¿‡å¤§ï¼Œå³è¶…è¿‡Eureka Server * åˆ—è¡¨çš„æ•°é‡ï¼Œé‚£ä¹ˆå°†å…¶å†æ¬¡èµ‹å€¼ï¼Œèµ‹å€¼çš„å†…å®¹ä¸ºEureka Server * åˆ—è¡¨çš„æ•°é‡ã€‚ */ if (threshold &gt; candidateHosts.size()) { threshold = candidateHosts.size(); } if (quarantineSet.isEmpty()) { // no-op } else if (quarantineSet.size() &gt;= threshold) { logger.debug(&quot;Clearing quarantined list of size {}&quot;, quarantineSet.size()); quarantineSet.clear(); } else { List&lt;EurekaEndpoint&gt; remainingHosts = new ArrayList&lt;&gt;(candidateHosts.size()); for (EurekaEndpoint endpoint : candidateHosts) { if (!quarantineSet.contains(endpoint)) { remainingHosts.add(endpoint); } } candidateHosts = remainingHosts; } return candidateHosts; }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Config-Serveré…ç½®ä¸­å¿ƒ","slug":"SpringCloudä¹‹--Config-Serveré…ç½®ä¸­å¿ƒ","date":"2020-05-31T08:50:38.000Z","updated":"2023-04-30T10:21:41.364Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Config-Serveré…ç½®ä¸­å¿ƒ/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Config-Serveré…ç½®ä¸­å¿ƒ/","excerpt":"","text":"Spring Cloud é…ç½®ä¸­å¿ƒä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æä¾›å¤–éƒ¨åŒ–é…ç½®æ”¯æŒã€‚é€šè¿‡Config-Serverï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹é›†ä¸­å¯¹æ‰€æœ‰ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºçš„å¤–éƒ¨åŒ–é…ç½®è¿›è¡Œç®¡ç†ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªåº”ç”¨ç¨‹åºä»å¼€å‘ç¯å¢ƒåˆ‡æ¢åˆ°æµ‹è¯•ç¯å¢ƒï¼Œç„¶åå†ä»æµ‹è¯•ç¯å¢ƒåˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä½ å¯ä»¥ä½¿ç”¨Config-Serverç»Ÿä¸€ç®¡ç†è¿™äº›ç¯å¢ƒä¹‹é—´çš„é…ç½®ï¼Œå¹¶ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨è¿ç§»æ—¶èƒ½å¤Ÿæ‹¥æœ‰å®ƒè¿è¡Œæ‰€éœ€è¦çš„ä¸€åˆ‡é…ç½®ã€‚ç®€è€Œè¨€ä¹‹ï¼šConfig-Server å°±æ˜¯ç”¨æ¥å®ç°é…ç½®ç»Ÿä¸€ç®¡ç†å’Œä¸åŒç¯å¢ƒé—´é…ç½®çš„ç»Ÿä¸€åˆ‡æ¢çš„ã€‚Config-Server æœåŠ¡å™¨çš„åç«¯å­˜å‚¨é»˜è®¤ä½¿ç”¨Gitï¼Œå› æ­¤å®ƒå¾ˆå®¹æ˜“æ”¯æŒé…ç½®ç¯å¢ƒçš„æ ‡ç­¾ç‰ˆæœ¬ï¼ŒåŒæ—¶å¯ä¾›å¤šæ•°çš„å†…å®¹ç®¡ç†å·¥å…·å»è®¿é—®ã€‚ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ å…¶ä»–çš„æ›¿ä»£å®ç°ï¼Œå¹¶å°†å®ƒä»¬æ’å…¥åˆ°Springé…ç½®ä¸­ã€‚ ç›¸å…³äº§å“ï¼š æ¥è‡ªæ·˜å®çš„Diamond æ¥è‡ªç™¾åº¦çš„Disconf æ¥è‡ªSpringcloudçš„Config-Server æ­å»ºé…ç½®ä¸­å¿ƒConfig-Serveré…ç½®ä¸­å¿ƒçš„å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¼•å…¥ä¾èµ–æ–°å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œèµ·åä¸ºconfig-centerï¼Œåœ¨å…¶ pom.xml æ–‡ä»¶ä¸­å¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- Eureka-Client ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Config-Server ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; åˆ›å»ºå¯åŠ¨ç±»æ–°å»ºä¸€ä¸ªSpringbootåº”ç”¨çš„å¯åŠ¨ç±»ConfigCenterApplicationç±»ï¼Œå¹¶åœ¨ä¸Šå¢åŠ @EnableConfigServeræ³¨è§£ï¼Œç”¨æ¥å¯ç”¨Config-Serverã€‚ import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.cloud.config.server.EnableConfigServer; @SpringBootApplication @EnableConfigServer public class ConfigCenterApplication { public static void main(String[] args) { SpringApplication.run(ConfigCenterApplication.class, args); } } æ·»åŠ é…ç½®application.yml æ·»åŠ é…ç½®å¦‚ä¸‹ï¼š server: port: 9001 spring: application: name: config-center eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ æ­¤æ—¶ï¼Œç”±äºå°šæœªé…ç½®ç”¨æ¥ä½œä¸ºæœåŠ¡å™¨åç«¯å­˜å‚¨çš„Gitä»“åº“åœ°å€ï¼Œè‹¥å¯åŠ¨åº”ç”¨ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š *************************** APPLICATION FAILED TO START *************************** Description: Invalid config server configuration. Action: If you are using the git profile, you need to set a Git URI in your configuration. If you are using a native profile and have spring.cloud.config.server.bootstrap=true, you need to use a composite configuration. ä¸ä¸€èˆ¬çš„Spring Bootåº”ç”¨ç›¸åŒï¼Œé»˜è®¤æƒ…å†µä¸‹Config-Serverä¹Ÿé€šè¿‡8080ç«¯å£å¯åŠ¨ã€‚ä¸ºäº†å®¢æˆ·ç«¯è¯»å–é…ç½®æ–¹ä¾¿ï¼Œä½ å¯ä»¥æŠŠå¯åŠ¨ç«¯å£æ”¹ä¸º8888ï¼ˆå®¢æˆ·ç«¯é»˜è®¤ä¼šä»http://localhost:8888/åŠ è½½ä¸æœåŠ¡IDç›¸åŒçš„é…ç½®ï¼‰ã€‚æ­¤å¤–ï¼ŒConfig-Serverè¿˜é€šè¿‡spring.config.name=configserverï¼ˆConfig-Server JaråŒ…ä¸­æœ‰ä¸€ä¸ªconfigserver.yml é…ç½®æ–‡ä»¶ï¼‰é…ç½®ä¸ºæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªé»˜è®¤é…ç½®åº“ï¼Œå®¢æˆ·ç«¯é€šè¿‡é…ç½® spring.cloud.config.discovery.serviceId=configserver ä¾¿å¯ç›´æ¥ä½¿ç”¨ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡application.ymlæ¥å¯¹é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®ã€‚ åˆ›å»ºGitä»“åº“æœ¬æ–‡ä½¿ç”¨å¼€æºä¸­å›½çš„ç äº‘æ¥åˆ›å»ºæˆ‘ä»¬çš„Gitä»“åº“ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„Githubæˆ–è€…é˜¿é‡Œäº‘Gitç­‰åˆ›å»ºè‡ªå·±çš„Gitä»“åº“ã€‚ ç‚¹å‡»å¯¼èˆªæ ä¸­çš„â€œ+â€æŒ‰é’®==&gt;æ–°å»ºä»“åº“ï¼Œå¡«å…¥ä»“åº“ä¿¡æ¯ï¼Œå®Œæˆåˆ›å»ºã€‚ ç‚¹å‡» å…‹éš†/ä¸‹è½½ ==&gt;å¤åˆ¶ï¼Œå°†Gitä»“åº“åœ°å€å¤åˆ¶ä¸‹æ¥å¤‡ç”¨ã€‚ é…ç½®Gitä»“åº“æ¥ä¸‹æ¥ï¼Œåœ¨application.ymlä¸­æ·»åŠ Gitä»“åº“é…ç½®å¦‚ä¸‹ï¼š spring: cloud: config: server: git: uri: https://gitee.com/pengjunlee/config-cloud.git username: ä½ çš„ç äº‘è´¦å· password: ä½ çš„è´¦å·å¯†ç  å†æ¬¡å¯åŠ¨ConfigCenterApplicationï¼Œå‘ç°å¯ä»¥æ­£å¸¸å¯åŠ¨äº†ã€‚å¯åŠ¨å®Œæˆä¹‹åï¼ŒEurekaæ³¨å†Œä¸­å¿ƒä¸­æ³¨å†Œçš„æœåŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š æ­å»ºå®¢æˆ·ç«¯æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡å¯¹ä¸Šä¸€ç« ã€Šå¾®æœåŠ¡ä¸‹çš„é“¾è·¯è¿½è¸ªï¼ˆSleuth+Zipkinï¼‰ã€‹ä¸­çš„product-serviceæœåŠ¡è¿›è¡Œæ”¹é€ ï¼Œæ¥ç¤ºä¾‹å¦‚ä½•ä»é…ç½®ä¸­å¿ƒè·å–é…ç½®ã€‚ å¼•å…¥ä¾èµ– åœ¨product-serviceçš„pom.xmlä¸­æ·»åŠ é…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯ä¾èµ–ï¼š &lt;!-- Config-Client ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-client&lt;/artifactId&gt; &lt;/dependency&gt; æˆ–è€…ï¼š &lt;!-- Starter-Config ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt; &lt;/dependency&gt; ä¿®æ”¹é…ç½®å…ˆå°†product-serviceä¸­çš„application.ymlæ–‡ä»¶æ”¹åä¸ºbootstrap.ymlï¼ˆbootstrap.ymlåœ¨åº”ç”¨ä¸Šä¸‹æ–‡å¯åŠ¨é˜¶æ®µåŠ è½½ï¼Œæ¯”application.ymlæ—©ï¼‰ï¼Œç„¶åå†å¯¹å…¶å†…å®¹è¿›è¡Œä¿®æ”¹ï¼š # è®¾ç½®æœåŠ¡(åº”ç”¨)åç§° spring: application: name: product-service # æŒ‡å®šç”¨äºè·å–é…ç½®çš„é…ç½®ä¸­å¿ƒæœåŠ¡(åº”ç”¨)åç§° cloud: config: discovery: enabled: true serviceId: config-center profile: dev # æŒ‡å®šåˆ†æç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºmaster label: master # æŒ‡å®šæ³¨å†Œä¸­å¿ƒåœ°å€ eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ æ³¨æ„ï¼šå¦‚æœä¸æŒ‡å®šé…ç½®ä¸­å¿ƒï¼Œå®¢æˆ·ç«¯é»˜è®¤ä¼šä» http://localhost:8888 åŠ è½½ä¸æœåŠ¡IDç›¸åŒçš„é…ç½®ã€‚ åœ¨Gitä»“åº“åˆ›å»ºé…ç½®æ–‡ä»¶å®¢æˆ·ç«¯é€šè¿‡å‘é€Httpè¯·æ±‚æ¥ä»é…ç½®ä¸­å¿ƒè¯»å–é…ç½®ï¼Œè¿™äº›Httpè¯·æ±‚çš„URIéµå¾ªä»¥ä¸‹è§„åˆ™ï¼š /{name}-{profiles}.properties /{name}-{profiles}.yml || /{name}-{profiles}.yaml /{label}/{name}-{profiles}.properties /{label}/{name}-{profiles}.json /{name}/{profiles}/{label:.*} /{name}-{profiles}.json /{label}/{name}-{profiles}.yml || /{label}/{name}-{profiles}.yaml /{name}/{profiles:.*[^-].*} /{name}/{profile}/{label}/** /{name}/{profile}/{label}/** /{name}/{profile}/** å…¶ä¸­å„ä¸ªå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ï¼š name æœåŠ¡çš„IDï¼Œå³spring.application.nameçš„å€¼ï¼Œæœ¬ä¾‹ä¸­ä¸º product-serviceï¼› profiles æ¿€æ´»çš„profileï¼Œé€šè¿‡spring.cloud.config.profileæŒ‡å®šï¼Œæœ¬ä¾‹ä¸­ä¸º devï¼› label åˆ†æçš„ç‰ˆæœ¬ï¼Œé€šè¿‡spring.cloud.config.labelæŒ‡å®šï¼Œæœ¬ä¾‹ä¸­ä¸ºé»˜è®¤å€¼ masterï¼› æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æŒ‰ç…§ä¸Šè¿°è§„åˆ™ï¼Œåœ¨Gitä»“åº“çš„ç›¸åº”ä½ç½®åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚æ ¹æ®bootstrap.ymlä¸­çš„é…ç½®ï¼Œèµ„æºè¯·æ±‚åœ°å€å¯ä»¥ä¸º /master/product-service-dev.yml ã€‚ åœ¨Gitä»“åº“çš„masteråˆ†æä¸­åˆ›å»ºproduct-service-dev.ymlå’Œproduct-service-test.ymlä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«å°†æœåŠ¡çš„å¯åŠ¨ç«¯å£æŒ‡å®šä¸º8771å’Œ8772ï¼š # product-service-dev.yml server: port: 8771 # product-service-test.yml server: port: 8772 æ–‡ä»¶åˆ›å»ºå®Œæˆä¹‹åï¼Œå¯åŠ¨é…ç½®ä¸­å¿ƒï¼Œå…ˆåœ¨æµè§ˆå™¨å¯¹ä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œè®¿é—®ã€‚ æ­¤æ—¶ï¼Œå¯åŠ¨product-serviceå°†è¯»å–http://localhost:8888/product-service-dev.ymlä¸­çš„é…ç½®ï¼Œå³å¯åŠ¨ç«¯å£ä¸º8771ã€‚è‹¥å°† bootstrap.ymlä¸­çš„spring.cloud.config.profileçš„å€¼è®¾ç½®ä¸ºtestï¼Œåˆ™å°†è¯»å–http://localhost:8888/product-service-test.ymlä¸­çš„é…ç½®ï¼Œåº”ç”¨çš„å¯åŠ¨ç«¯å£ä¹Ÿä¼šç›¸åº”åœ°å˜ä¸º8772ï¼Œè¯æ˜ä»é…ç½®ä¸­å¿ƒè¯»å–é…ç½®æˆåŠŸã€‚ å‚è€ƒæ–‡ç« http://jm.taobao.org/2016/09/28/an-article-about-config-center/ https://cloud.spring.io/spring-cloud-stream/ https://spring.io/projects/spring-cloud-config https://cloud.spring.io/spring-cloud-static/Finchley.SR2/single/spring-cloud.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Sleuth+Zipkiné“¾è·¯è¿½è¸ª","slug":"SpringCloudä¹‹--Sleuth+Zipkiné“¾è·¯è¿½è¸ª","date":"2020-05-31T08:49:38.000Z","updated":"2023-04-30T10:21:41.367Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Sleuth+Zipkiné“¾è·¯è¿½è¸ª/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Sleuth+Zipkiné“¾è·¯è¿½è¸ª/","excerpt":"","text":"Sleuthç®€ä»‹Sleuthæ˜¯Spring Cloudçš„ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒä¸ºSpring Cloudå®ç°äº†ä¸€ç§åˆ†å¸ƒå¼è¿½è¸ªè§£å†³æ–¹æ¡ˆï¼Œå…¼å®¹Zipkinï¼ŒHTraceå’Œå…¶ä»–åŸºäºæ—¥å¿—çš„è¿½è¸ªç³»ç»Ÿï¼Œä¾‹å¦‚ ELKï¼ˆElasticsearch ã€Logstashã€ Kibanaï¼‰ã€‚ ç›¸å…³æœ¯è¯­Sleuthå¼•å…¥äº†è®¸å¤š Dapperä¸­çš„æœ¯è¯­ï¼š SpanåŸºæœ¬çš„å·¥ä½œå•å…ƒã€‚æ— è®ºæ˜¯å‘é€ä¸€ä¸ªRPCæˆ–æ˜¯å‘RPCå‘é€ä¸€ä¸ªå“åº”éƒ½æ˜¯ä¸€ä¸ªSpanã€‚æ¯ä¸€ä¸ªSpané€šè¿‡ä¸€ä¸ª64ä½IDæ¥è¿›è¡Œå”¯ä¸€æ ‡è¯†ï¼Œå¹¶é€šè¿‡å¦ä¸€ä¸ª64ä½IDå¯¹Spanæ‰€åœ¨çš„Traceè¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚Spanèƒ½å¤Ÿå¯åŠ¨å’Œåœæ­¢ï¼Œä»–ä»¬ä¸æ–­åœ°è¿½è¸ªè‡ªèº«çš„æ—¶é—´ä¿¡æ¯ï¼Œå½“ä½ åˆ›å»ºäº†ä¸€ä¸ªSpanï¼Œä½ å¿…é¡»åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»åœæ­¢å®ƒã€‚æç¤ºï¼šå¯åŠ¨ä¸€ä¸ªTraceçš„åˆå§‹åŒ–Spanè¢«å«ä½œ Root Span ï¼Œå®ƒçš„ Span ID å’Œ Trace Id ç›¸åŒã€‚ Traceç”±ä¸€ç³»åˆ—Span ç»„æˆçš„ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¦æ‰§è¡Œä¸€ä¸ªåˆ†å¸ƒå¼å¤§æ•°æ®çš„å­˜å‚¨æ“ä½œï¼Œè¿™ä¸ªTraceä¹Ÿè®¸ä¼šç”±ä½ çš„PUTè¯·æ±‚æ¥å½¢æˆã€‚ Annotationç”¨æ¥åŠæ—¶è®°å½•ä¸€ä¸ªäº‹ä»¶çš„å­˜åœ¨ã€‚é€šè¿‡å¼•å…¥ Brave åº“ï¼Œæˆ‘ä»¬ä¸ç”¨å†å»è®¾ç½®ä¸€ç³»åˆ—çš„ç‰¹åˆ«äº‹ä»¶ï¼Œä»è€Œè®© Zipkin èƒ½å¤ŸçŸ¥é“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ˜¯è°ã€è¯·æ±‚æ˜¯ä»å“ªé‡Œå¼€å§‹çš„ã€åˆåˆ°å“ªé‡Œç»“æŸã€‚ å‡ºäºå­¦ä¹ çš„ç›®çš„ï¼Œè¿˜æ˜¯æŠŠAnnotationè®°å½•çš„äº‹ä»¶ç±»å‹åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼š cs ï¼ˆClient Sentï¼‰ - å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªæ³¨é‡ŠæŒ‡ç¤ºäº†ä¸€ä¸ªSpançš„å¼€å§‹ã€‚ sr ï¼ˆServer Receivedï¼‰ - æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚å¹¶å¼€å§‹å¤„ç†å®ƒï¼Œå¦‚æœç”¨ sr æ—¶é—´æˆ³å‡å» cs æ—¶é—´æˆ³ä¾¿èƒ½çœ‹å‡ºæœ‰å¤šå°‘ç½‘ç»œå»¶è¿Ÿã€‚ ssï¼ˆServer Sentï¼‰- æ³¨é‡Šè¯·æ±‚å¤„ç†å®Œæˆ(å“åº”å·²å‘é€ç»™å®¢æˆ·ç«¯)ï¼Œå¦‚æœç”¨ ss æ—¶é—´æˆ³å‡å»sr æ—¶é—´æˆ³ä¾¿å¯å¾—å‡ºæœåŠ¡ç«¯å¤„ç†è¯·æ±‚è€—è´¹çš„æ—¶é—´ã€‚ crï¼ˆClient Receivedï¼‰- é¢„ç¤ºäº†ä¸€ä¸ª Spançš„ç»“æŸï¼Œå®¢æˆ·ç«¯æˆåŠŸåœ°æ¥æ”¶åˆ°äº†æœåŠ¡ç«¯çš„å“åº”ï¼Œå¦‚æœç”¨ cr æ—¶é—´æˆ³å‡å» cs æ—¶é—´æˆ³ä¾¿å¯å¾—å‡ºå®¢æˆ·ç«¯ä»æœåŠ¡ç«¯è·å¾—å“åº”æ‰€éœ€è€—è´¹çš„æ•´ä¸ªæ—¶é—´ã€‚ ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªç³»ç»Ÿä¸­çš„ Span å’Œ Trace å¤§æ¦‚çš„æ ·å­ï¼š é¢œè‰²ç›¸åŒçš„æ³¨é‡Šè¡¨ç¤ºæ˜¯åŒä¸€ä¸ªSpanï¼ˆè¿™é‡Œä¸€å…±æœ‰7ä¸ªSpanï¼Œç¼–å·ä» ï¼¡åˆ°ï¼§ï¼‰ï¼Œä»¥ä¸‹é¢è¿™ä¸ªæ³¨é‡Šä¸ºä¾‹ï¼š Trace Id = X Span Id = D Client Sent è¿™ä¸ªæ³¨é‡Šè¡¨ç¤ºå½“å‰Spançš„Trace Id ä¸º Xï¼ŒSpan Id ä¸º Dï¼ŒåŒæ—¶ï¼Œå‘ç”Ÿäº† Client Sent äº‹ä»¶ã€‚ ä¸‹å›¾å±•ç¤ºäº†çˆ¶å­å…³ç³»çš„Spançš„è°ƒç”¨é“¾è·¯ï¼š ä½¿ç”¨Sleuthä¸ºäº†ç¡®ä¿ä½ çš„åº”ç”¨åç§°èƒ½å¤Ÿåœ¨Zipkinä¸­æ­£ç¡®æ˜¾ç¤ºï¼Œä½ éœ€è¦å…ˆåœ¨Springbootçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¯¹spring.application.name å±æ€§è¿›è¡Œé…ç½®ã€‚ å¼•å…¥ä¾èµ–å¦‚æœä½ åªæƒ³ä½¿ç”¨SpringCloud Sleuth è€Œä¸æƒ³ä¸ Zipkin åšé›†æˆï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š &lt;dependencies&gt; &lt;!-- Sleuth ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; å¦‚æœä½ æƒ³é€šè¿‡ HTTP å°† SpringCloud Sleuth ä¸ Zipkinåšé›†æˆï¼Œå¼•å…¥å¦‚ä¸‹ä¾èµ–ï¼š &lt;dependencies&gt; &lt;!-- Zipkin ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; å¦‚æœä½ æƒ³ä½¿ç”¨RabbitMQ æˆ–è€…Kafka æ›¿ä»£ HTTP ï¼Œéœ€å…ˆå¼•å…¥ spring-rabbit æˆ–è€… spring-kafka ä¾èµ–ã€‚é»˜è®¤çš„ç›®æ ‡åç§°æ˜¯ zipkin ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Kafka ï¼Œå¿…é¡»è®¾ç½®ç›¸åº”çš„ spring.zipkin.sender.type å±æ€§ï¼š spring.zipkin.sender.type: kafka æ³¨æ„ï¼šspring-cloud-sleuth-streamå·²ç»è¿‡æœŸå¹¶ä¸”å’Œè¿™äº›ç›®æ ‡ä¸å…¼å®¹ã€‚ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯RabbitMQï¼Œéœ€è¦æ·»åŠ  spring-cloud-starter-zipkin å’Œ spring-rabbit ä¾èµ–ã€‚ &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${release.train.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt; &lt;artifactId&gt;spring-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; ä¸ºäº†ç¤ºä¾‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Sleuth+Zipkinçš„é»˜è®¤é…ç½®ï¼Œåœ¨éœ€è¦è¿›è¡Œé“¾è·¯è¿½è¸ªçš„æ‰€æœ‰æœåŠ¡ç«¯æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Eureka-Server ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Feign ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Sleuth+Zipkin ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zipkin&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; åˆ›å»ºæœåŠ¡ å¦‚å›¾æ‰€ç¤ºï¼Œåˆ›å»ºorder-serviceå’Œproduct-serviceä¸¤ä¸ªæœåŠ¡ï¼Œå¹¶åœ¨order-serviceä¸­é€šè¿‡Feignå¯¹product-serviceè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚ product-service åœ¨product-serviceçš„controllerä¸­æä¾›ä¸€ä¸ªå•†å“æœåŠ¡ï¼š @RestController @RequestMapping(&quot;/api/v1/product&quot;) public class ProductController { private final Logger logger = LoggerFactory.getLogger(getClass()); /** * å•†å“æœåŠ¡ */ @GetMapping(&quot;/service&quot;) public String productService() { logger.info(&quot;Product Service Is Called...&quot;); return &quot;Product Service Is Called...&quot;; } } order-serviceç”±äºéœ€è¦åœ¨ order-service ä¸­è°ƒç”¨product-serviceï¼Œå…ˆåˆ›å»ºä¸€ä¸ªProductClientï¼š @FeignClient(name = &quot;product-service&quot;) public interface ProductClient { @GetMapping(&quot;/api/v1/product/service&quot;) public String productService(); } ä¸ºäº†ç¤ºä¾‹ç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨order-serviceçš„controllerä¸­é€šè¿‡ProductClientå¯¹product-serviceè¿›è¡Œè°ƒç”¨ï¼š @RestController @RequestMapping(&quot;/api/v1/order&quot;) public class OrderController { private final Logger logger = LoggerFactory.getLogger(getClass()); @Autowired private ProductClient productClient; @GetMapping(value = &quot;/service&quot;) public String orderService() { logger.info(&quot;Order Service Is Called...&quot;); String ret = productClient.productService(); logger.info(ret.toString()); return &quot;Order Service Is Called...&quot;; } } å¯åŠ¨&amp;æµ‹è¯•æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¯åŠ¨åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼š ==&gt;å¯åŠ¨Eurekaæ³¨å†Œä¸­å¿ƒï¼Œç«¯å£å· 8761 ==&gt;åˆ†åˆ«é€šè¿‡8771å’Œ8781ä¸¤ä¸ªç«¯å£å¯åŠ¨product-serviceå’Œorder-serviceä¸¤ä¸ªæœåŠ¡ å¯åŠ¨å®Œæˆä¹‹åï¼ŒEurekaæ³¨å†Œä¸­å¿ƒä¸­æ³¨å†Œçš„æœåŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹åœ°å€: http://localhost:8781/api/v1/order/serviceï¼Œè¿”å›å¦‚ä¸‹å†…å®¹ï¼š åŒæ—¶ï¼Œåœ¨order-serviceåå°æ‰“å°å¦‚ä¸‹æ—¥å¿—ï¼š 2019-02-27 13:49:17.439 INFO [order-service,895caa4daa30bb0a,895caa4daa30bb0a,true] 2812 --- [nio-8781-exec-2] c.pengjunlee.controller.OrderController : Order Service Is Called... 2019-02-27 13:49:17.465 INFO [order-service,895caa4daa30bb0a,895caa4daa30bb0a,true] 2812 --- [nio-8781-exec-2] c.pengjunlee.controller.OrderController : Product Service Is Called... åœ¨product-serviceåå°æ‰“å°å¦‚ä¸‹æ—¥å¿—ï¼š 2019-02-27 13:49:17.448 INFO [product-service,895caa4daa30bb0a,9cd122253ea82104,true] 20736 --- [nio-8771-exec-8] c.p.controller.ProductController : Product Service Is Called... æ­£å¦‚ä¸Šé¢ product-service å’Œ order-service ä¸­æ‰“å°çš„æ—¥å¿—æ‰€ç¤ºï¼ŒSleuthå°†Trace Idå’ŒSpan Idæ·»åŠ åˆ°Slf4J MDCï¼ˆMapped Diagnostic Contextï¼‰å¹¶åœ¨æ—¥å¿—ä¸­è¿›è¡Œäº†æ‰“å°ï¼Œè¿™æ ·ï¼Œä½ å°±èƒ½å¤Ÿä»æ—¥å¿—èšåˆå™¨ä¸­æå–ä»»ä½•ä¸€ä¸ªç»™å®šçš„Trace æˆ–è€…Span çš„æ‰€æœ‰æ—¥å¿—äº†ã€‚ æ¥ä¸‹æ¥ï¼Œé‡ç‚¹è§£é‡Šä¸€ä¸‹æ—¥å¿—ä¸­çš„ [appname,traceId,spanId,exportable] å„éƒ¨åˆ†æ‰€ä»£è¡¨çš„å«ä¹‰ï¼š appnameï¼šè®°å½•æ—¥å¿—çš„åº”ç”¨çš„åç§°ï¼Œå³spring.application.nameçš„å€¼ï¼› traceIdï¼šSleuthä¸ºä¸€æ¬¡è¯·æ±‚é“¾è·¯ç”Ÿæˆçš„å”¯ä¸€IDï¼Œä¸€ä¸ªTraceä¸­å¯ä»¥åŒ…å«å¤šä¸ªSpanï¼› spanIdï¼šè¯·æ±‚é“¾è·¯åŸºæœ¬çš„å·¥ä½œå•å…ƒï¼Œä»£è¡¨å‘ç”Ÿä¸€æ¬¡ç‰¹å®šçš„æ“ä½œï¼Œä¾‹å¦‚ï¼šå‘é€ä¸€ä¸ªHttpè¯·æ±‚ï¼› exportableï¼šæ˜¯å¦éœ€è¦å°†æ—¥å¿—å¯¼å‡ºåˆ° Zipkinï¼› Sleuthæä¾›äº†å¯¹å¸¸è§åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªæ•°æ®æ¨¡å‹çš„æŠ½è±¡ï¼šTraceã€Spanã€Annotationå’Œé”®å€¼å¯¹Annotationã€‚Spring-Cloud-Sleuthè™½ç„¶åŸºäºhtraceï¼Œä½†ä¸Zipkinï¼ˆdapperï¼‰ä¹Ÿå…¼å®¹ã€‚ Sleuthè®°å½•æ—¶é—´ä¿¡æ¯ä»¥å¸®åŠ©è¿›è¡Œå»¶è¿Ÿåˆ†æã€‚é€šè¿‡ä½¿ç”¨sleuthï¼Œæ‚¨å¯ä»¥æŸ¥æ˜åº”ç”¨ç¨‹åºä¸­å»¶è¿Ÿçš„åŸå› ã€‚ å½“spring-cloud-sleuth-zipkinåŒ…å«åœ¨classpathä¸­æ—¶ï¼Œåº”ç”¨ç¨‹åºå°†ç”Ÿæˆå¹¶æ”¶é›†ä¸zipkinå…¼å®¹çš„è¿½è¸ªè®°å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šé€šè¿‡HTTPå°†å®ƒä»¬å‘é€åˆ°æœ¬åœ°ä¸»æœºï¼ˆç«¯å£9411ï¼‰ä¸Šçš„ZipkinæœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®spring.zipkin.baseurlæ¥é…ç½®æœåŠ¡çš„åœ°å€ã€‚ å¦‚æœä½ ä¾èµ–çš„æ˜¯spring-rabbitï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºä¼šå°†è¿½è¸ªè®°å½•å‘é€åˆ°Rabbit MQä»£ç†ï¼Œè€Œä¸æ˜¯HTTPã€‚ å¦‚æœä½ ä¾èµ–çš„æ˜¯spring-kafkaï¼Œå¹¶è®¾ç½®äº†spring.zipkin.sender.type:kafkaï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºä¼šå°†è¿½è¸ªè®°å½•å‘é€åˆ°Kafkaä»£ç†è€Œä¸æ˜¯HTTPã€‚ æ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Zipkinï¼Œè¯·é€šè¿‡è®¾ç½®spring.sleuth.sampler.probabilityæ¥é…ç½®å¯¼å‡ºSpançš„æ¦‚ç‡ï¼ˆé»˜è®¤å€¼ï¼š0.1ï¼Œå³10%ï¼‰ã€‚å¦åˆ™ï¼Œæ‚¨å¯èƒ½ä¼šè®¤ä¸ºSleuthä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒçœç•¥äº†ä¸€äº›Spanã€‚ æ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨çš„æ˜¯SLF4Jï¼ŒTraceå’ŒSpançš„è¿½è¸ªè®°å½•é»˜è®¤ä¼šè¢«è®°å½•åˆ°MDCï¼Œæ‰€ä»¥æ—¥å¿—çš„ç”¨æˆ·å¯ä»¥ç«‹åˆ»çœ‹åˆ°ã€‚ä½†å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»–çš„æ—¥å¿—ç³»ç»Ÿï¼Œä½ è¿˜éœ€è¦å¯¹æ—¥å¿—çš„æ‰“å°æ ¼å¼è¿›è¡Œè®¾ç½®æ‰èƒ½çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼š logging.pattern.level = %5p [${spring.zipkin.service.name:${spring.application.name:-}},%X{X-B3-TraceId:-},%X{X-B3-SpanId:-},%X{X-Span-Export:-}] Zipkinç®€ä»‹Zipkinæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„APMå·¥å…·ï¼ˆApplication Performance Managementï¼‰ï¼ŒåŸºäºGoogle Dapper å®ç°ã€‚å®ƒå¸®åŠ©æ”¶é›†è§£å†³å¾®æœåŠ¡æ¶æ„ä¸­å»¶è¿Ÿé—®é¢˜æ‰€éœ€çš„æ—¶é—´æ•°æ®ï¼Œå¹¶ç®¡ç†è¿™äº›æ•°æ®ã€‚å’ŒSleuthç»“åˆå¯ä»¥æä¾›å¯è§†åŒ–Webç•Œé¢åˆ†æè°ƒç”¨é“¾è·¯è€—æ—¶æƒ…å†µã€‚ ä½¿ç”¨Zipkinå¦‚æœä½ ä½¿ç”¨çš„Javaç‰ˆæœ¬ä¸ºJDK 8ï¼Œå¯ä»¥ä¸‹è½½ä¸€ä¸ªZipkinçš„ç‹¬ç«‹å¯æ‰§è¡ŒJarã€‚ ä¸‹è½½åœ°å€ï¼š https://search.maven.org/remote_content?g=io.zipkin.java&amp;a=zipkin-server&amp;v=LATEST&amp;c=exec ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨Zipkinï¼š java -jar zipkin-server-2.12.2-exec.jar å¯åŠ¨å®Œæˆåï¼Œè®¿é—® http://localhost:9411/zipkin/dependency/ æŸ¥çœ‹æœåŠ¡çš„ä¾èµ–å…³ç³»ã€‚ å‚è€ƒæ–‡ç« https://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#netflix-zuul-starter https://github.com/openzipkin/brave https://cloud.spring.io/spring-cloud-static/Finchley.SR2/single/spring-cloud.htmlhttps://cloud.spring.io/spring-cloud-static/Finchley.SR2/single/spring-cloud.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Zuulé«˜çº§é…ç½®(ä¸‹)","slug":"SpringCloudä¹‹--Zuulé«˜çº§é…ç½®(ä¸‹)","date":"2020-05-31T08:48:38.000Z","updated":"2023-04-30T10:21:41.368Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Zuulé«˜çº§é…ç½®(ä¸‹)/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Zuulé«˜çº§é…ç½®(ä¸‹)/","excerpt":"","text":"ä¸ºè·¯ç”±æä¾›HystrixFallbackå½“Zuulä¸­æŸä¸€ä¸ªè·¯ç”±çš„æ–­è·¯å™¨è¢«æ–­å¼€æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªFallbackProviderç±»å‹çš„Beanæ¥ä¸ºå®ƒæä¾›ä¸€ä¸ªFallbackå“åº”ã€‚åœ¨è¿™ä¸ªBeanä¸­ä½ éœ€è¦æŒ‡å®šFallbackå“åº”æ‰€å¯¹åº”çš„è·¯ç”±çš„IDå¹¶æä¾›ä¸€ä¸ªClientHttpResponseä½œä¸ºè¿”å›çš„Fallbackå“åº”ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªFallbackProviderå®ç°çš„å®ä¾‹ã€‚ import java.io.ByteArrayInputStream; import java.io.IOException; import java.io.InputStream; import org.springframework.cloud.netflix.zuul.filters.route.FallbackProvider; import org.springframework.http.HttpHeaders; import org.springframework.http.HttpStatus; import org.springframework.http.MediaType; import org.springframework.http.client.ClientHttpResponse; import org.springframework.stereotype.Component; import com.netflix.hystrix.exception.HystrixTimeoutException; @Component public class MessageFallbackProvider implements FallbackProvider { @Override public String getRoute() { return &quot;zuul-msg&quot;; } @Override public ClientHttpResponse fallbackResponse(String route, final Throwable cause) { if (cause instanceof HystrixTimeoutException) { return response(HttpStatus.GATEWAY_TIMEOUT); } else { return response(HttpStatus.INTERNAL_SERVER_ERROR); } } private ClientHttpResponse response(final HttpStatus status) { return new ClientHttpResponse() { @Override public HttpStatus getStatusCode() throws IOException { return status; } @Override public int getRawStatusCode() throws IOException { return status.value(); } @Override public String getStatusText() throws IOException { return status.getReasonPhrase(); } @Override public void close() { } @Override public InputStream getBody() throws IOException { return new ByteArrayInputStream(&quot;æ¶ˆæ¯æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•ï¼&quot;.getBytes()); } @Override public HttpHeaders getHeaders() { HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_JSON); return headers; } }; } } è·¯ç”±çš„é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š zuul: routes: message-service: /zuul-msg/** å½“message-serviceæœåŠ¡è°ƒç”¨å¤±è´¥æ—¶ï¼Œè¿”å›ç»“æœè§ä¸‹å›¾ã€‚ å¦‚æœä½ æƒ³ä¸ºæ‰€æœ‰çš„è·¯ç”±æä¾›ä¸€ä¸ªé»˜è®¤çš„Fallbackï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªFallbackProvider Beanå¹¶å°†å®ƒçš„getRoute() æ–¹æ³•çš„è¿”å›å€¼è®¾ç½®ä¸º â€œ*â€æˆ–è€… nullã€‚ class MyFallbackProvider implements FallbackProvider { @Override public String getRoute() { return &quot;*&quot;; } @Override public ClientHttpResponse fallbackResponse(String route, Throwable throwable) { return new ClientHttpResponse() { @Override public HttpStatus getStatusCode() throws IOException { return HttpStatus.OK; } @Override public int getRawStatusCode() throws IOException { return 200; } @Override public String getStatusText() throws IOException { return &quot;OK&quot;; } @Override public void close() { } @Override public InputStream getBody() throws IOException { return new ByteArrayInputStream(&quot;fallback&quot;.getBytes()); } @Override public HttpHeaders getHeaders() { HttpHeaders headers = new HttpHeaders(); headers.setContentType(MediaType.APPLICATION_JSON); return headers; } }; } } é‡å†™Locationå¤´ä¿¡æ¯å¦‚æœZuulé¢å‘çš„æ˜¯ä¸€ä¸ªWebåº”ç”¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šç¢°åˆ°éœ€è¦é‡å†™Locationè¯·æ±‚å¤´çš„æƒ…å†µï¼Œä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ªLocationRewriteFilterç±»å‹Beanå³å¯ã€‚ import org.springframework.cloud.netflix.zuul.EnableZuulProxy; import org.springframework.cloud.netflix.zuul.filters.post.LocationRewriteFilter; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration @EnableZuulProxy public class ZuulConfig { @Bean public LocationRewriteFilter locationRewriteFilter() { return new LocationRewriteFilter(); } } æ³¨æ„ï¼šæ­¤è¿‡æ»¤å™¨ä¼šä½œç”¨äºæ‰€æœ‰å“åº”çŠ¶æ€ç ä¸º 3XX çš„Locationå¤´ä¿¡æ¯ï¼Œè¿™å¹¶ä¸ä¸€å®šé€‚ç”¨äºæ‰€æœ‰çš„åœºæ™¯ï¼Œæ¯”å¦‚é‡å®šå‘åˆ°å¤–éƒ¨URLã€‚ å¯ç”¨è·¨åŸŸè¯·æ±‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒZuulä¼šæŠŠæ‰€æœ‰çš„Cross Origin requests (CORSï¼Œè·¨åŸŸè¯·æ±‚)è·¯ç”±ç»™ç›¸åº”çš„æœåŠ¡ï¼Œå¦‚æœä½ æƒ³ä»£æ›¿Zuulè‡ªå·±æ¥å¤„ç†è¿™äº›è¯·æ±‚ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„ WebMvcConfigurer Beanï¼š @Bean public WebMvcConfigurer corsConfigurer() { return new WebMvcConfigurer() { public void addCorsMappings(CorsRegistry registry) { registry.addMapping(&quot;/path-1/**&quot;).allowedOrigins(&quot;http://allowed-origin.com&quot;).allowedMethods(&quot;GET&quot;, &quot;POST&quot;); } }; } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…è®¸ä» http://allowed-origin.com å‘Zuulä¸­ä»¥ path-1 å¼€å¤´çš„ç»ˆç«¯å‘é€ GETå’ŒPOSTç±»å‹çš„è·¨åŸŸè¯·æ±‚ã€‚ä½ æ—¢å¯ä»¥å°† CORS é…ç½®ä½œç”¨äºæŒ‡å®šçš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ /** è®©å®ƒä½œç”¨äºæ•´ä¸ªåº”ç”¨ã€‚ä½ å¯ä»¥åœ¨å…¶ä¸­é…ç½®ä»¥ä¸‹å±æ€§ï¼šallowedOriginsã€allowedMethodsã€allowedHeadersã€exposedHeadersã€allowCredentialsã€maxAgeã€‚ åˆ›å»ºå‰ç½®è¿‡æ»¤å™¨å‰ç½®è¿‡æ»¤å™¨å¯¹RequestContextä¸­çš„æ•°æ®è¿›è¡Œè®¾ç½®ï¼Œå¹¶æä¾›ç»™ä¸‹æ¸¸çš„è¿‡æ»¤å™¨ä½¿ç”¨ï¼Œå®ƒçš„æœ€ä¸»è¦çš„ç”¨é€”å°±æ˜¯å¯¹è·¯ç”±è¿‡æ»¤å™¨æ‰€éœ€çš„ä¿¡æ¯è¿›è¡Œè®¾ç½®ã€‚ import javax.servlet.http.HttpServletRequest; import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants; import com.netflix.zuul.ZuulFilter; import com.netflix.zuul.context.RequestContext; public class QueryParamPreFilter extends ZuulFilter { @Override public int filterOrder() { return FilterConstants.PRE_DECORATION_FILTER_ORDER - 1; // run before PreDecoration } @Override public String filterType() { return FilterConstants.PRE_TYPE; } @Override public boolean shouldFilter() { RequestContext ctx = RequestContext.getCurrentContext(); return !ctx.containsKey(FilterConstants.FORWARD_TO_KEY) // a filter has already forwarded &amp;&amp; !ctx.containsKey(FilterConstants.SERVICE_ID_KEY); // a filter has already determined serviceId } @Override public Object run() { RequestContext ctx = RequestContext.getCurrentContext(); HttpServletRequest request = ctx.getRequest(); if (request.getParameter(&quot;sample&quot;) != null) { // put the serviceId in `RequestContext` ctx.put(FilterConstants.SERVICE_ID_KEY, request.getParameter(&quot;foo&quot;)); } return null; } } åˆ›å»ºè·¯ç”±è¿‡æ»¤å™¨è·¯ç”±è¿‡æ»¤å™¨åœ¨å‰ç½®è¿‡æ»¤å™¨ä¹‹åè¿è¡Œï¼Œå¹¶è´Ÿè´£æ„é€ éœ€è¦å‘é€ç»™å…¶ä»–æœåŠ¡çš„è¯·æ±‚ã€‚å®ƒåœ¨è¿™çš„ä¸»è¦å·¥ä½œæ˜¯ï¼šæŠŠè¯·æ±‚æ•°æ®ä¼ é€è‡³å®¢æˆ·ç«¯æ‰€éœ€è¦çš„ model ä¸­ï¼Œå¹¶æŠŠå®¢æˆ·ç«¯ model ä¸­çš„å†…å®¹è½¬æ¢æˆå“åº”æ•°æ®è¿”å›ã€‚ import java.io.InputStream; import java.util.Enumeration; import java.util.List; import java.util.Map; import javax.servlet.http.HttpServletRequest; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.cloud.netflix.zuul.filters.ProxyRequestHelper; import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants; import org.springframework.util.LinkedMultiValueMap; import org.springframework.util.StreamUtils; import com.netflix.zuul.ZuulFilter; import com.netflix.zuul.context.RequestContext; import okhttp3.Headers; import okhttp3.MediaType; import okhttp3.OkHttpClient; import okhttp3.Request; import okhttp3.RequestBody; import okhttp3.Response; import okhttp3.internal.http.HttpMethod; public class OkHttpRoutingFilter extends ZuulFilter { @Autowired private ProxyRequestHelper helper; @Override public String filterType() { return FilterConstants.ROUTE_TYPE; } @Override public int filterOrder() { return FilterConstants.SIMPLE_HOST_ROUTING_FILTER_ORDER - 1; } @Override public boolean shouldFilter() { return RequestContext.getCurrentContext().getRouteHost() != null &amp;&amp; RequestContext.getCurrentContext().sendZuulResponse(); } @Override public Object run() { OkHttpClient httpClient = new OkHttpClient.Builder().build(); // customize RequestContext context = RequestContext.getCurrentContext(); HttpServletRequest request = context.getRequest(); String method = request.getMethod(); String uri = this.helper.buildZuulRequestURI(request); Headers.Builder headers = new Headers.Builder(); Enumeration&lt;String&gt; headerNames = request.getHeaderNames(); while (headerNames.hasMoreElements()) { String name = headerNames.nextElement(); Enumeration&lt;String&gt; values = request.getHeaders(name); while (values.hasMoreElements()) { String value = values.nextElement(); headers.add(name, value); } } try { InputStream inputStream = request.getInputStream(); RequestBody requestBody = null; if (inputStream != null &amp;&amp; HttpMethod.permitsRequestBody(method)) { MediaType mediaType = null; if (headers.get(&quot;Content-Type&quot;) != null) { mediaType = MediaType.parse(headers.get(&quot;Content-Type&quot;)); } requestBody = RequestBody.create(mediaType, StreamUtils.copyToByteArray(inputStream)); } Request.Builder builder = new Request.Builder().headers(headers.build()).url(uri).method(method, requestBody); Response response = httpClient.newCall(builder.build()).execute(); LinkedMultiValueMap&lt;String, String&gt; responseHeaders = new LinkedMultiValueMap&lt;&gt;(); for (Map.Entry&lt;String, List&lt;String&gt;&gt; entry : response.headers().toMultimap().entrySet()) { responseHeaders.put(entry.getKey(), entry.getValue()); } this.helper.setResponse(response.code(), response.body().byteStream(), responseHeaders); context.setRouteHost(null); // prevent SimpleHostRoutingFilter from running } catch (Exception e) { e.printStackTrace(); } return null; } } åˆ›å»ºåç½®è¿‡æ»¤å™¨åç½®è¿‡æ»¤å™¨é€šå¸¸æ˜¯ç”¨æ¥å¯¹å“åº”è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªè¿‡æ»¤å™¨æ·»åŠ äº†ä¸€ä¸ªUUIDä½œä¸º X-Sample çš„å¤´å†…å®¹ã€‚ import java.util.UUID; import javax.servlet.http.HttpServletResponse; import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants; import com.netflix.zuul.ZuulFilter; import com.netflix.zuul.context.RequestContext; public class AddResponseHeaderFilter extends ZuulFilter { @Override public String filterType() { return FilterConstants.POST_TYPE; } @Override public int filterOrder() { return FilterConstants.SEND_RESPONSE_FILTER_ORDER - 1; } @Override public boolean shouldFilter() { return true; } @Override public Object run() { RequestContext context = RequestContext.getCurrentContext(); HttpServletResponse servletResponse = context.getResponse(); servletResponse.addHeader(&quot;X-Sample&quot;, UUID.randomUUID().toString()); return null; } } Zuulé”™è¯¯å¤„ç†åœ¨Zuulè¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸçš„ä»»ä¸€é˜¶æ®µä¸€æ—¦å‡ºç°å¼‚å¸¸ï¼Œé”™è¯¯è¿‡æ»¤å™¨å°±ä¼šæ‰§è¡Œã€‚SendErrorFilter åªä¼šåœ¨RequestContext.getThrowable() ä¸æ˜¯ null çš„æ—¶å€™è¿è¡Œã€‚å®ƒä¼šåœ¨è¯·æ±‚ä¸­è®¾ç½®ä¸€äº›ç‰¹å®šçš„ javax.servlet.error.* å±æ€§å¹¶å°†è¯·æ±‚è½¬å‘Springbootçš„é”™è¯¯é¡µé¢ã€‚ åº”ç”¨ä¸Šä¸‹æ–‡é¥¿åŠ è½½Zuul åœ¨å†…éƒ¨ä½¿ç”¨çš„æ˜¯Ribbon å¯¹è¿œç¨‹urlè¿›è¡Œè°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒRibbonå®¢æˆ·ç«¯ä¼šåœ¨Spring Cloudç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è¿›è¡Œæ‡’åŠ è½½ã€‚å¦‚æœéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±è¿›è¡ŒåŠ è½½ï¼Œå¯ä»¥åšå¦‚ä¸‹é…ç½®ã€‚ zuul: ribbon: eager-load: enabled: true è¯·æ±‚å¤±è´¥é‡è¯•Spring Cloud Netflix æä¾›äº†å¾ˆå¤šç§æ–¹æ³•ç”¨æ¥åˆ›å»º HTTP è¯·æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„RestTemplateã€Ribbon æˆ–è€… Feign ï¼Œä½†æ— è®ºä½ é€‰æ‹©äº†å“ªä¸€ç§ï¼Œéƒ½æœ‰å¯èƒ½ä¼šå‡ºç°è¯·æ±‚å¤±è´¥çš„æƒ…å†µã€‚å½“ä¸€ä¸ªè¯·æ±‚å¤±è´¥æ—¶ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›å®ƒè‡ªåŠ¨åœ°è¿›è¡Œé‡è¯•ï¼Œè¦å®ç°è¿™ä¸€ç‚¹çš„è¯ï¼Œä½ éœ€è¦æŠŠ Spring Retry æ·»åŠ åˆ°ä½ çš„classpath ï¼Œç„¶åï¼Œè´Ÿè½½å‡è¡¡çš„RestTemplateã€Ribbon ã€ Feign ä»¥åŠ Zuul å°±ä¼šå¯¹æ‰€æœ‰å¤±è´¥çš„è¯·æ±‚è‡ªåŠ¨è¿›è¡Œé‡è¯•ï¼ˆå‰ææ˜¯ä½ çš„é…ç½®å…è®¸å®ƒè¿™æ ·åšçš„è¯ï¼‰ã€‚ è¡¥å¿ç­–ç•¥é»˜è®¤æƒ…å†µä¸‹ï¼Œé‡è¯•è¯·æ±‚æ˜¯æ²¡æœ‰è¡¥å¿ç­–ç•¥çš„ï¼Œå¦‚æœä½ æƒ³è¦é…ç½®ä¸€ä¸ªè¡¥å¿ç­–ç•¥ï¼Œä½ éœ€è¦ä¸ºæŒ‡å®šçš„æœåŠ¡åˆ›å»ºä¸€ä¸ª LoadBalancedRetryFactory ç±»å‹çš„Beanï¼Œå¹¶é‡å†™å®ƒçš„ createBackOffPolicy æ–¹æ³•ã€‚ @Configuration public class MyConfiguration { @Bean LoadBalancedRetryFactory retryFactory() { return new LoadBalancedRetryFactory() { @Override public BackOffPolicy createBackOffPolicy(String service) { return new ExponentialBackOffPolicy(); } }; } } ç›¸å…³é…ç½®åœ¨ä½¿ç”¨Ribbonè¿›è¡Œé‡è¯•æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢å‰ä¸‰ä¸ªä¸ªRibboné…ç½®é¡¹å¯¹é‡è¯•çš„åŠŸèƒ½è¿›è¡Œæ§åˆ¶ã€‚ # Max number of retries on the same server (excluding the first try) sample-client.ribbon.MaxAutoRetries=1 # Max number of next servers to retry (excluding the first server) sample-client.ribbon.MaxAutoRetriesNextServer=1 # Whether all operations can be retried for this client sample-client.ribbon.OkToRetryOnAllOperations=true # Interval to refresh the server list from the source sample-client.ribbon.ServerListRefreshInterval=2000 # Connect timeout used by Apache HttpClient sample-client.ribbon.ConnectTimeout=3000 # Read timeout used by Apache HttpClient sample-client.ribbon.ReadTimeout=3000 # Initial list of servers, can be changed via Archaius dynamic property at runtime sample-client.ribbon.listOfServers=www.microsoft.com:80,www.yahoo.com:80,www.google.com:80 å¦å¤–ï¼Œå¦‚æœä½ æƒ³å½“è¿”å›çš„å“åº”çš„çŠ¶æ€ç ä¸ºæŸäº›å€¼çš„æ—¶å€™æ‰è¿›è¡Œé‡è¯•ï¼Œä½ å¯ä»¥ä½¿ç”¨ clientName.ribbon.retryableStatusCodes æŠŠé‚£äº›éœ€è¦Ribbonå®¢æˆ·ç«¯è¿›è¡Œé‡è¯•çš„çŠ¶æ€ç åˆ—ä¸¾å‡ºæ¥ã€‚ clientName: ribbon: retryableStatusCodes: 404,502 æˆ–è€…åˆ›å»ºä¸€ä¸ª LoadBalancedRetryPolicy ç±»å‹çš„Bean ï¼Œå¹¶å®ç°å®ƒçš„retryableStatusCodeæ–¹æ³•ã€‚ ç¦ç”¨é‡è¯•# å…¨éƒ¨ç¦ç”¨ zuul.retryable=false # ç¦ç”¨æŒ‡å®šè·¯ç”± zuul.routes.routename.retryable=false å‚è€ƒæ–‡ç« https://github.com/spring-projects/spring-retry https://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#netflix-zuul-starter","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Zuulé«˜çº§é…ç½®(ä¸Š)","slug":"SpringCloudä¹‹--Zuulé«˜çº§é…ç½®(ä¸Š)","date":"2020-05-31T08:47:38.000Z","updated":"2023-04-30T10:21:41.368Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Zuulé«˜çº§é…ç½®(ä¸Š)/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Zuulé«˜çº§é…ç½®(ä¸Š)/","excerpt":"","text":"è‡ªå®šä¹‰è·¯ç”±è§„åˆ™åœ¨ã€ŠZuulè·¯ç”±å’Œè¿‡æ»¤ã€‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å¹¶æœªå¯¹Zuulçš„è·¯ç”±è§„åˆ™è¿›è¡Œè®¾ç½®ï¼Œé»˜è®¤ä¼šä½¿ç”¨æœåŠ¡çš„ ID å¯¹æœåŠ¡è¿›è¡Œè·¯ç”±ï¼Œå³ï¼šåœ¨æºæœåŠ¡çš„URIä¹‹å‰å¢åŠ  /service-id å‰ç¼€ã€‚ # Zuul é»˜è®¤è·¯ç”±åœ°å€ http://&lt;zuul-host&gt;:&lt;zuul-port&gt;/service-id/[service-URI] é™¤äº†å¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤çš„è·¯ç”±è§„åˆ™å¤–ï¼ŒZuulè¿˜æä¾›äº†å¾ˆå¤šé…ç½®é¡¹å…è®¸æˆ‘ä»¬å¯¹è·¯ç”±æ˜ å°„è§„åˆ™è¿›è¡Œè‡ªå®šä¹‰ï¼Œä¾‹å¦‚ï¼š zuul: ignoredServices: &#39;*&#39; routes: message-service: /zuul-msg/** ç¤ºä¾‹ä¸­è¿™ä¸ªé…ç½®çš„ä½œç”¨æ˜¯ï¼šå¿½ç•¥é™¤ message-service å¤–çš„æ‰€æœ‰æœåŠ¡ï¼ˆä¸å¯¹å®ƒä»¬è¿›è¡Œè·¯ç”±ï¼‰ï¼Œåªå°†message-service æœåŠ¡è·¯ç”±åˆ° /zuul-msg/** åœ°å€ä¸Šã€‚ zuul.ignored-services # å¿½ç•¥æŒ‡å®šå¾®æœåŠ¡ï¼Œå¤šä¸ªå¾®æœåŠ¡ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš” zuul.routes.service-id # æŒ‡å®šservice-idæœåŠ¡çš„è·¯ç”±åœ°å€ æ³¨æ„ï¼šåœ¨ zuul.routes ä¸­é…ç½®äº†çš„æœåŠ¡ï¼Œå³ä½¿è¢«åŒ…å«åœ¨ zuul.ignored-services é…ç½®ä¸­ä¹Ÿä¸ä¼šè¢«å¿½ç•¥ã€‚ è‹¥å°†ä¸Šä¾‹ä¸­çš„é…ç½®æ”¹æˆå¦‚ä¸‹ï¼Œåˆ™è¡¨ç¤ºé™¤ message-service å¤–çš„æ‰€æœ‰æœåŠ¡éƒ½ä½¿ç”¨é»˜è®¤çš„è·¯ç”±è§„åˆ™ã€‚ zuul: routes: message-service: /zuul-msg/** å¦‚æœä½ å¸Œæœ›å¯¹æŸä¸€ä¸ªè·¯ç”±è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¯ä»¥ç‹¬ç«‹åœ°æŒ‡å®šè¯¥æœåŠ¡çš„è·¯ç”±åœ°å€å’Œå®ƒçš„service-idï¼Œä¾‹å¦‚ï¼š zuul: routes: message: path: /zuul-msg/** serviceId: message-service æˆ–è€…ï¼Œåƒä¸‹é¢è¿™æ ·æŒ‡å®šä¸€ä¸ªè¯¥æœåŠ¡çš„ç‰©ç†åœ°å€æ¥æ›¿ä»£ä¸Šä¾‹ä¸­çš„service-idï¼š zuul: routes: message: path: /zuul-msg/** url: http://localhost:8771/ è¿ç»­å¤šæ¬¡è®¿é—® http://localhost:8791/zuul-msg/api/v1/msg/get è¿”å›ç»“æœç›¸åŒï¼Œè§ä¸‹å›¾ï¼š å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡urlé…ç½®çš„è·¯ç”±ä¸ä¼šè¢«å½“ä½œHystrixCommandæ‰§è¡Œï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šä½¿ç”¨Ribbonåœ¨å¤šä¸ªUrlä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚æ‰€ä»¥ï¼Œæ¨èä½¿ç”¨serviceIdè¿›è¡Œé…ç½®ã€‚æˆ–è€…ï¼ŒæŒ‡å®šä¸€ä¸ªåŒ…å«æœ‰å¤šä¸ªå¯ç”¨æœåŠ¡åˆ—è¡¨çš„serviceIdï¼Œä¾‹å¦‚ï¼š zuul: routes: message: path: /zuul-msg/** serviceId: msg-servers hystrix: command: msg-servers: execution: isolation: thread: timeoutInMilliseconds: 1000 msg-servers: ribbon: NIWSServerListClassName: com.netflix.loadbalancer.ConfigurationBasedServerList listOfServers: http://localhost:8771/,http://localhost:8772/ ConnectTimeout: 1000 ReadTimeout: 3000 MaxTotalHttpConnections: 500 MaxConnectionsPerHost: 100 è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•ä¹Ÿå¯ä»¥è¾¾åˆ°ä¸Šè¿°ç›®æ ‡ï¼šä½¿ç”¨service-idä¸ºè¦è·¯ç”±çš„æœåŠ¡æŒ‡å®šä¸€ä¸ªRibbonå®¢æˆ·ç«¯ï¼Œå¹¶è®¾ç½®Ribbonç¦ç”¨Eurekaï¼Œä¾‹å¦‚ï¼š zuul: routes: message: path: /zuul-msg/** serviceId: msg-servers ribbon: eureka: enabled: false msg-servers: ribbon: listOfServers: http://localhost:8771/,http://localhost:8772/ å¦‚æœä½ çš„service-idå‘½åæ»¡è¶³ä¸€å®šçš„è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»service-idä¸­æå–ä¸€äº›å˜é‡ä½œä¸ºä½ çš„è·¯ç”±åœ°å€ï¼Œä¾‹å¦‚ï¼š @Bean public PatternServiceRouteMapper serviceRouteMapper() { return new PatternServiceRouteMapper(&quot;(?&lt;name&gt;^.+)-(?&lt;version&gt;v.+$)&quot;, &quot;${version}/${name}&quot;); } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ªåç§°ä¸ºmyusers-v1çš„æœåŠ¡ä¼šè¢«è·¯ç”±åˆ° /v1/myusers/** åœ°å€ä¸Šã€‚åœ¨è¿™é‡Œä½ å¯ä»¥ä½¿ç”¨ä»»æ„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯è¦ä¿è¯æ‰€æœ‰çš„å‘½åç»„å¿…é¡»éƒ½åŒ…å«servicePatternå’ŒroutePatternä¸¤éƒ¨åˆ†ã€‚å¦‚æœservicePatternä¸åŒ¹é…service-idï¼Œå°±ä¼šä½¿ç”¨é»˜è®¤çš„è§„åˆ™ï¼Œå³åœ¨æœåŠ¡åŸæœ‰çš„URIä¹‹å‰å¢åŠ  /service-id å‰ç¼€ã€‚Zuulçš„è¿™ä¸€ç‰¹æ€§é»˜è®¤æ˜¯å…³é—­çš„ï¼Œè€Œä¸”åªèƒ½è¢«åº”ç”¨åˆ°å·²ç»å‘ç°çš„æœåŠ¡ã€‚ å¯¹é‚£äº›è¦å¿½ç•¥çš„å¾®æœåŠ¡ä¹Ÿå¯ä»¥é‡‡ç”¨æ¨¡å¼åŒ¹é…è¿›è¡Œæ›´åŠ ç²¾ç»†çš„æ§åˆ¶ï¼Œä¾‹å¦‚ï¼š zuul: ignoredPatterns: /**/v2/** routes: message-service: /zuul-msg/** è¯¥ä¾‹ä¸­çš„é…ç½®ä¼šå¿½ç•¥æ‰€æœ‰åŒ…å« /v2/ çš„è¯·æ±‚ã€‚ ä½¿ç”¨ zuul.prefix é…ç½®é¡¹å¯ä»¥ä¸ºæ‰€æœ‰çš„è·¯ç”±åœ°å€éƒ½æ·»åŠ ä¸€ä¸ªå‰ç¼€ï¼Œä¾‹å¦‚ /abc ã€‚ zuul: prefix: /abc routes: message-service: /zuul-msg/** æ·»åŠ å‰ç¼€ä¹‹åè·¯ç”±åœ°å€ä¸ºï¼šhttp://localhost:8791/abc/zuul-msg/api/v1/msg/get ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒZuulä»£ç†ä¼šåœ¨å°†è¯·æ±‚è½¬å‘å‡ºå»ä¹‹å‰å…ˆå°†å…¶ä¸­çš„å‰ç¼€å­—ç¬¦ä¸²å‰”é™¤æ‰ã€‚å¦‚æœä½ ä¸æƒ³å‰”é™¤å‰ç¼€ï¼Œå¯ä»¥è®¾ç½® zuul.stripPrefix=falseã€‚å¦‚æœä½ åªæ˜¯æƒ³ä¸å‰”é™¤æŒ‡å®šæŸä¸€ä¸ªæœåŠ¡ä¸­çš„å‰ç¼€ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼š zuul: prefix: /abc # stripPrefix: false routes: message-service: /zuul-msg/** stripPrefix: false zuul.routes ä¸­çš„é…ç½®æ¡ç›®æœ€ç»ˆéƒ½ä¼šè¢«ç»‘å®šåˆ°ä¸€ä¸ªZuulPropertiesç±»å‹çš„å¯¹è±¡ï¼Œåœ¨ ZuulProperties ä¸­è¿˜æœ‰ä¸€ä¸ª retryable æ ‡è¯†ï¼Œå°†è¯¥æ ‡è¯†è®¾ç½®æˆ ture èƒ½å¤Ÿè®©Ribbonå®¢æˆ·ç«¯å¯¹å¤±è´¥çš„è¯·æ±‚è‡ªåŠ¨è¿›è¡Œé‡è¯•ã€‚ zuul.routes ä¸­é…ç½®çš„è·¯ç”±åœ°å€æœ€ç»ˆéƒ½ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªMapä¸­ï¼Œè·¯ç”±çš„åœ°å€å³ä¸ºMapçš„keyï¼ŒMapçš„valueæ˜¯ä¸€ä¸ªZuulRouteç±»å‹çš„å¯¹è±¡ã€‚åœ¨yamlé…ç½®æ–‡ä»¶ä¸­ï¼Œè·¯ç”±åœ°å€ç›¸åŒçš„ä¸¤ä¸ªæœåŠ¡ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„é…ç½®ï¼Œä»è€Œå¯¼è‡´å…ˆé…ç½®çš„æœåŠ¡ä¸å¯ç”¨ã€‚ æ³¨æ„ï¼šå¦‚æœéœ€è¦ä¿ç•™è·¯ç”±çš„é¡ºåºï¼Œéœ€è¦ä½¿ç”¨yamlæ–‡ä»¶ï¼Œå› ä¸ºä½¿ç”¨propertiesæ–‡ä»¶æ—¶ä¼šä¸¢å¤±é¡ºåºã€‚ ç›®å‰ï¼ŒZuulå·²ç»ä½¿ç”¨ Apache HTTP Client æ›¿æ¢æ‰äº†å·²ç»è¿‡æ—¶çš„Ribbon RestClient æ¥ä½œä¸ºè‡ªå·±çš„HTTP Clientã€‚ä½ è‹¥æƒ³ç»§ç»­ä½¿ç”¨ RestClient æˆ–è€… okhttp3.OkHttpClientï¼Œåªéœ€è¦å°† ribbon.restclient.enabled æˆ–è€… ribbon.okhttp.enabled è®¾ç½®ä¸º true å³å¯ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ Apache HTTP client æˆ–è€… OK HTTP clientï¼Œæä¾›ä¸€ä¸ªç›¸åº”çš„ ClosableHttpClient æˆ–è€…OkHttpClient ç±»å‹çš„ Beanå³å¯ã€‚ è®¾ç½®è¯·æ±‚å¤´é»˜è®¤æƒ…å†µä¸‹ï¼ŒZuulä¼šä¸ºè½¬å‘çš„è¯·æ±‚æ·»åŠ ä¸€äº› X-Forwarded-* è¯·æ±‚å¤´ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ zuul.addProxyHeaders = false æ¥å…³é—­å®ƒã€‚è¯·æ±‚ä¸­çš„å‰ç¼€é»˜è®¤ä¼šè¢«å‰”é™¤ï¼ŒåŒæ ·åœ°ï¼Œè¯·æ±‚ä¸­çš„X-Forwarded-Prefix è¯·æ±‚å¤´ä¹Ÿä¼šè¢«æ‘˜å–å‡ºæ¥ã€‚ åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œè¯·æ±‚å¤´åœ¨å¤šä¸ªæœåŠ¡ä¹‹é—´æ˜¯å¯ä»¥å…±äº«çš„ï¼Œä½†æ˜¯ä½ å¯èƒ½å¹¶ä¸å¸Œæœ›æŸäº›æ•æ„Ÿçš„è¯·æ±‚å¤´ä¿¡æ¯æ³„éœ²åˆ°ä¸‹æ¸¸çš„å¤–éƒ¨æœåŠ¡å™¨ï¼Œä½ å¯ä»¥æŠŠè¿™äº›æ•æ„Ÿè¯·æ±‚å¤´é…ç½®åˆ°zuul.sensitiveHeadersåˆ—è¡¨ï¼Œä»è€Œç¦æ­¢å®ƒä»¬è¢«ä¼ é€’åˆ°ä¸‹æ¸¸ã€‚ä¾‹å¦‚ï¼š zuul: sensitiveHeaders: Cookie,Set-Cookie,Authorization routes: message-service: /zuul-msg/** sensitiveHeaders: token sensitiveHeaderså°±ç›¸å½“äºæ˜¯ä¸€ä¸ªå‘ä¸‹æ¸¸ä¼ é€’çš„è¯·æ±‚å¤´é»‘åå•ï¼Œé»˜è®¤åŒ…å«äº† Cookieï¼ŒSet-Cookieå’ŒAuthorizationä¸‰ä¸ªè¯·æ±‚å¤´ã€‚å› æ­¤ï¼Œå¦‚æœä½ éœ€è¦å‘ä¸‹ä¼ é€’æ‰€æœ‰çš„è¯·æ±‚å¤´ä¿¡æ¯ï¼Œéœ€è¦æ˜ç¡®åœ°æŠŠsensitiveHeadersè®¾ç½®æˆä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå¦‚ä¸‹ï¼š zuul: sensitiveHeaders: routes: message-service: /zuul-msg/** å¦å¤–ï¼Œä½ è¿˜å¯ä»¥æŠŠé‚£äº›ä¸éœ€è¦ä¼ é€’åˆ°ä¸‹æ¸¸çš„è¯·æ±‚å¤´æˆ–å“åº”å¤´é…ç½®åˆ° zuul.ignoredHeaders ä¸­ï¼Œå¯ä»¥è¾¾åˆ°ç›¸åŒçš„ä½œç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç±»è·¯å¾„ä¸­ä¸åŒ…å« Spring Security æ—¶ï¼ŒignoredHeaders åˆ—è¡¨æ˜¯ç©ºçš„ï¼›å½“ç±»è·¯å¾„ä¸­åŒ…å« Spring Securityæ—¶ï¼ŒignoredHeaders åˆ—è¡¨ä¼šè¢«åˆå§‹åŒ–åŒ…å«ä¸€äº›ç”±Spring SecurityæŒ‡å®šçš„ security å¤´ä¿¡æ¯ï¼Œä¾‹å¦‚ involving cachingã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœä½ éœ€è¦æŠŠè¿™äº› security å¤´ä¿¡æ¯ä¼ é€’åˆ°ä¸‹æ¸¸ï¼Œå¯ä»¥æ·»åŠ  zuul.ignoreSecurityHeaders = false é…ç½®é¡¹ã€‚ ç®¡ç†ç»ˆç«¯é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“@EnableZuulProxyä¸Actuatorä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒActuatorå¥åº·ç›‘æ§é¡µé¢ä¼šå¢åŠ ä¸¤ä¸ªç»ˆç«¯ï¼šRouteså’ŒFiltersã€‚ éœ€è¦åœ¨pom.xmlä¸­å¼•å…¥Actuatorä¾èµ–ï¼š &lt;!-- Actuator ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; å¹¶åœ¨application.ymlæ–‡ä»¶ä¸­å¢åŠ é…ç½®ï¼š management: security: enabled: false endpoints: web: exposure: include: hystrix.stream,* è®¿é—® /actuator/routes ç»ˆç«¯ä¼šè¿”å›ä¸€ä¸ªæ˜ å°„è·¯ç”±çš„åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾ã€‚ è®¿é—® /actuator/routes/details ç»ˆç«¯ä¼šè¿”å›ä¸€ä¸ªæ˜ å°„è·¯ç”±çš„è¯¦ç»†ä¿¡æ¯åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾ã€‚ è®¿é—® /actuator/filters ç»ˆç«¯ä¼šè¿”å›ä¸€ä¸ªåŒ…å«äº†è¿‡æ»¤å™¨ç±»å‹å’Œé…ç½®çš„Mapå¯¹è±¡ã€‚ ç¼–ç è®¾ç½®åœ¨å¯¹è¿›æ¥çš„è¯·æ±‚è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œè¯·æ±‚å‚æ•°ä¼šè¢«è§£ç ä»¥ä¾¿åœ¨Zuulè¿‡æ»¤å™¨ä¸­èƒ½å¤Ÿå¯¹å®ƒä»¬è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œç„¶ååˆä¼šåœ¨è·¯ç”±è¿‡æ»¤å™¨ä¸­é‡æ–°ç¼–ç å¹¶å‘é€å‡ºå»ï¼Œé‡æ–°ç¼–ç åçš„ç»“æœè·ŸåŸæ¥çš„è¾“å…¥å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œè¿™åœ¨å¤šæ•°æƒ…å†µä¸‹æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨ä¸€äº›å¯¹å¤æ‚çš„è¯·æ±‚å­—ç¬¦ä¸²ç¼–ç æ¯”è¾ƒæŒ‘å‰”çš„WebæœåŠ¡å™¨ä¸­ä»æœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚è§£å†³çš„åŠæ³•å°±æ˜¯æ·»åŠ å¦‚ä¸‹çš„é…ç½®æ¥å¼ºåˆ¶ä½¿ç”¨åŸå§‹ç¼–ç çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼Œç›¸å½“äºç›´æ¥ä½¿ç”¨ HttpServletRequest.getQueryString()æ–¹æ³•æ¥è·å–è¯·æ±‚å­—ç¬¦ä¸²ã€‚ åœ¨å¯¹è¿›æ¥çš„è¯·æ±‚è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œä¼šå…ˆå¯¹è¯·æ±‚çš„URIè¿›è¡Œè§£ç ï¼Œå†å’Œè·¯ç”±åœ°å€è¿›è¡ŒåŒ¹é…ï¼Œç„¶ååˆä¼šåœ¨è·¯ç”±è¿‡æ»¤å™¨ä¸­å¯¹è¯·æ±‚çš„URIé‡æ–°ç¼–ç å¹¶å‘é€ç»™åç«¯ï¼Œå½“ä½ çš„URIä¸­åŒ…å« â€œ/â€ å­—ç¬¦æ—¶è¿™å¯èƒ½ä¼šå¼•å‘ä¸€äº›æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚è§£å†³çš„åŠæ³•å°±æ˜¯æ·»åŠ å¦‚ä¸‹çš„é…ç½®æ¥å¼ºåˆ¶ä½¿ç”¨åŸå§‹ç¼–ç çš„è¯·æ±‚URIï¼Œç›¸å½“äºç›´æ¥ä½¿ç”¨ HttpServletRequest.getRequestURI()æ–¹æ³•æ¥è·å–è¯·æ±‚URIã€‚ ç¦ç”¨Zuulè¿‡æ»¤å™¨Spring Cloudçš„Zuulè‡ªå¸¦äº†ä¸€äº›è¿‡æ»¤å™¨Beanï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒä»¬éƒ½æ˜¯å¯ç”¨çš„ã€‚å¦‚æœä½ æƒ³ç¦ç”¨å…¶ä¸­çš„æŸä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼š zuul.&lt;SimpleClassName&gt;.&lt;filterType&gt;.disable=true æŒ‰ç…§æƒ¯ä¾‹ï¼Œè¿‡æ»¤å™¨æ‰€åœ¨åŒ…åä¸­ â€œfiltersâ€ å­—ç¬¦ä¸²åé¢çš„å°±æ˜¯è¿‡æ»¤å™¨çš„ç±»å‹äº†ï¼Œä¾‹å¦‚ï¼Œç¦ç”¨ org.springframework.cloud.netflix.zuul.filters.post.SendResponseFilter ï¼Œé…ç½®å¦‚ä¸‹ï¼š zuul.SendResponseFilter.post.disable=true è¶…æ—¶è®¾ç½® å¦‚æœä½ éœ€è¦è®¾ç½®é€šè¿‡Zuulè·¯ç”±çš„è¯·æ±‚çš„Socketè¶…æ—¶æ—¶é—´å’ŒReadè¶…æ—¶æ—¶é—´ï¼Œæœ‰ä¸¤ç§é…ç½®æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®ä½ çš„é…ç½®æƒ…å†µè¿›è¡Œé€‰æ‹©ï¼š å¦‚æœä½¿ç”¨äº†æœåŠ¡å‘ç°ï¼Œä½¿ç”¨ribbon.ReadTimeout å’Œ ribbon.SocketTimeout è¿›è¡Œé…ç½®ã€‚ å¦‚æœæ˜¯é€šè¿‡æŒ‡å®šURLçš„æ–¹å¼è¿›è¡Œè·¯ç”±ï¼Œä½¿ç”¨zuul.host.connect-timeout-millis å’Œ zuul.host.socket-timeout-millisè¿›è¡Œé…ç½®ã€‚ å‚è€ƒæ–‡ç« https://github.com/spring-projects/spring-retry https://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#netflix-zuul-starter","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Zuulè·¯ç”±å’Œè¿‡æ»¤","slug":"SpringCloudä¹‹--Zuulè·¯ç”±å’Œè¿‡æ»¤","date":"2020-05-31T08:46:38.000Z","updated":"2023-04-30T10:21:41.367Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Zuulè·¯ç”±å’Œè¿‡æ»¤/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Zuulè·¯ç”±å’Œè¿‡æ»¤/","excerpt":"","text":"Zuulæ˜¯ä»€ä¹ˆï¼ŸAPI Gateway æ˜¯éšç€å¾®æœåŠ¡ï¼ˆMicroserviceï¼‰è¿™ä¸ªæ¦‚å¿µä¸€èµ·å…´èµ·çš„ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œå®ƒç”¨äºè§£å†³å¾®æœåŠ¡è¿‡äºåˆ†æ•£ï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å‡ºå…¥å£æ¥è¿›è¡Œæµé‡ç®¡ç†çš„é—®é¢˜ã€‚ API Gatewayå¯ä»¥ä½œä¸ºæ•´ä¸ªç³»ç»Ÿå¯¹å¤–çš„å”¯ä¸€å…¥å£ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œç”¨æ¥å¤„ç†ä¸€äº›ä¸ä¸šåŠ¡æ— å…³çš„è¾¹ç¼˜åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šæ™ºèƒ½è·¯ç”±ã€ç™»å½•é‰´æƒã€æµé‡ç›‘æ§ä¸é™æµã€ç½‘ç»œéš”ç¦»ï¼Œç­‰ç­‰ã€‚ API Gateway çš„ä¸€ç§æ¯”è¾ƒå¸¸è§„çš„é€‰æ‹©å°±æ˜¯ä½¿ç”¨Nginxä»£ç†ï¼Œä½†æ˜¯Netflixå¸¦æ¥äº†å®ƒè‡ªå·±çš„è§£å†³æ–¹æ¡ˆâ€”-Zuulã€‚Zuul æ˜¯Netflixå…¬å¸å¼€æºçš„åŸºäºJVMçš„å¾®æœåŠ¡ç½‘å…³ï¼Œå¯ä»¥å’ŒEurekaã€Ribbonå’ŒHystrixç­‰ç»„ä»¶é…åˆä½¿ç”¨ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰è¾¹ç¼˜æœåŠ¡ã€‚å®ƒç›¸å½“äºæ˜¯è®¾å¤‡å’Œ Netflix æµåº”ç”¨çš„ Web ç½‘ç«™åç«¯æ‰€æœ‰è¯·æ±‚çš„å‰é—¨ï¼Œå¯ä»¥é€‚å½“çš„å¯¹å¤šä¸ª Amazon Auto Scaling Groups è¿›è¡Œè·¯ç”±è¯·æ±‚ã€‚ Netflixå…¬å¸ä¸»è¦ä½¿ç”¨Zuulå®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š é‰´æƒ æµé‡ç›‘æ§ å‹åŠ›æµ‹è¯• é‡‘ä¸é›€æµ‹è¯•ï¼ˆç°åº¦æµ‹è¯•/ABæµ‹è¯•ï¼‰ åŠ¨æ€è·¯ç”± æœåŠ¡è¿ç§» é™æµ å®‰å…¨é˜²æŠ¤ é™æ€å“åº”å¤„ç† Zuulçš„å·¥ä½œåŸç†å’Œå¤§éƒ¨åˆ†åŸºäºJavaçš„Webåº”ç”¨ç±»ä¼¼ï¼ŒZuulä¹Ÿé‡‡ç”¨äº†servletæ¶æ„ï¼Œå› æ­¤Zuulå¤„ç†æ¯ä¸ªè¯·æ±‚çš„æ–¹å¼æ˜¯ï¼šé’ˆå¯¹æ¯ä¸ªè¯·æ±‚ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ‰€æœ‰è¯·æ±‚ä¼šè¢«æ”¾åˆ°å¤„ç†é˜Ÿåˆ—ä¸­ï¼Œä»çº¿ç¨‹æ± ä¸­é€‰å–ç©ºé—²çº¿ç¨‹æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚è¿™æ ·çš„è®¾è®¡æ–¹å¼ï¼Œè¶³ä»¥åº”ä»˜ä¸€èˆ¬çš„é«˜å¹¶å‘åœºæ™¯ã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒZuulçš„æ ¸å¿ƒæ˜¯ä¸€ç³»åˆ—çš„filtersï¼Œå¹¶ä¸”å®ƒè¿˜æä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥å¯¹è¿‡æ»¤å™¨è¿›è¡ŒåŠ¨æ€çš„åŠ è½½ï¼Œç¼–è¯‘ï¼Œè¿è¡Œã€‚Zuulçš„è¿‡æ»¤å™¨ä¹‹é—´å¹¶ä¸ä¼šç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªRequestContextçš„é™æ€ç±»è¿›è¡Œæ•°æ®ä¼ é€’ã€‚RequestContextç”¨ThreadLocalå˜é‡æ¥è®°å½•æ¯ä¸ªRequestæ‰€éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚ Zuulçš„è¿‡æ»¤å™¨æ˜¯ä½¿ç”¨Groovyè¯­è¨€ç¼–å†™è€Œæˆçš„ï¼Œè¿™äº›è¿‡æ»¤å™¨æ–‡ä»¶è¢«æ”¾åœ¨Zuul Serverä¸Šçš„ç‰¹å®šç›®å½•ä¸‹é¢ï¼ŒZuulä¼šå®šæœŸè½®è¯¢è¿™äº›ç›®å½•ï¼Œä¿®æ”¹è¿‡çš„è¿‡æ»¤å™¨ä¼šåŠ¨æ€çš„åŠ è½½åˆ°Zuul Serverä¸­ä»¥ä¾¿äºrequestä½¿ç”¨ã€‚ Zuulçš„æ ‡å‡†è¿‡æ»¤å™¨æœ‰ä»¥ä¸‹å››ç§ç±»å‹ï¼š å‰ç½®è¿‡æ»¤å™¨(pre filters)ï¼šåœ¨è¯·æ±‚åˆ°è¾¾Origin Serverä¹‹å‰è°ƒç”¨ã€‚æˆ‘ä»¬å¯åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨å®ç°èº«ä»½éªŒè¯ã€åœ¨é›†ç¾¤ä¸­é€‰æ‹©è¯·æ±‚çš„Origin Serverã€è®°å½•è°ƒè¯•ä¿¡æ¯ç­‰ã€‚ è·¯ç”±è¿‡æ»¤å™¨(routing filters)ï¼šå°†ç”¨æˆ·çš„è¯·æ±‚è½¬å‘ç»™Origin Serverã€‚å‘é€ç»™Origin Serverçš„ç”¨æˆ·è¯·æ±‚åœ¨è¿™ç±»è¿‡æ»¤å™¨ä¸­buildï¼Œå¹¶ä½¿ç”¨Apache HttpClientæˆ–è€…Netfilx Ribbonå‘é€ç»™Origin Serverã€‚ åç½®è¿‡æ»¤å™¨(post filters)ï¼šåœ¨ç”¨æˆ·è¯·æ±‚ä»Origin Serverè¿”å›ä»¥åæ‰§è¡Œã€‚è¿™ç§è¿‡æ»¤å™¨å¯ç”¨æ¥ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†ä»Origin Serverè·å–åˆ°çš„å“åº”å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚ é”™è¯¯è¿‡æ»¤å™¨(error filters)ï¼šåœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚ ä¸€ä¸ªè¯·æ±‚ä¼šå…ˆæŒ‰é¡ºåºé€šè¿‡æ‰€æœ‰çš„å‰ç½®è¿‡æ»¤å™¨ï¼Œä¹‹ååœ¨è·¯ç”±è¿‡æ»¤å™¨ä¸­è½¬å‘ç»™åç«¯åº”ç”¨ï¼Œå¾—åˆ°å“åº”ååˆä¼šé€šè¿‡æ‰€æœ‰çš„åç½®è¿‡æ»¤å™¨ï¼Œæœ€åå†å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚åœ¨æ•´ä¸ªæµç¨‹ä¸­å¦‚æœå‘ç”Ÿäº†å¼‚å¸¸åˆ™ä¼šè·³è½¬åˆ°é”™è¯¯è¿‡æ»¤å™¨ä¸­ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœéœ€è¦åœ¨è¯·æ±‚åˆ°è¾¾åç«¯åº”ç”¨å‰å°±è¿›è¡Œå¤„ç†çš„è¯ï¼Œä¼šé€‰æ‹©å‰ç½®è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚é‰´æƒã€è¯·æ±‚è½¬å‘ã€å¢åŠ è¯·æ±‚å‚æ•°ç­‰è¡Œä¸ºã€‚åœ¨è¯·æ±‚å®Œæˆåéœ€è¦å¤„ç†çš„æ“ä½œæ”¾åœ¨åç½®è¿‡æ»¤å™¨ä¸­å®Œæˆï¼Œä¾‹å¦‚ç»Ÿè®¡è¿”å›å€¼å’Œè°ƒç”¨æ—¶é—´ã€è®°å½•æ—¥å¿—ã€å¢åŠ è·¨åŸŸå¤´ç­‰è¡Œä¸ºã€‚è·¯ç”±è¿‡æ»¤å™¨ä¸€èˆ¬åªéœ€è¦é€‰æ‹© Zuul ä¸­å†…ç½®çš„å³å¯ï¼Œé”™è¯¯è¿‡æ»¤å™¨ä¸€èˆ¬åªéœ€è¦ä¸€ä¸ªï¼Œè¿™æ ·å¯ä»¥åœ¨ Gateway é‡åˆ°é”™è¯¯é€»è¾‘æ—¶ç›´æ¥æŠ›å‡ºå¼‚å¸¸ä¸­æ–­æµç¨‹ï¼Œå¹¶ç›´æ¥ç»Ÿä¸€å¤„ç†è¿”å›ç»“æœã€‚ ä½¿ç”¨Zuulæ¥ä¸‹æ¥æˆ‘ä»¬å°†æ²¿ç”¨ä¸Šä¸€ç« ã€ŠRibbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‹ä¸­çš„é¡¹ç›®ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Zuulã€‚ å¼•å…¥Zuulä¾èµ–æ–°å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œèµ·åä¸ºapi-gatewayï¼Œåœ¨å…¶ pom.xml æ–‡ä»¶ä¸­å¼•å…¥Zuulä¾èµ–ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Eureka-Client ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Zuul ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; ä¿®æ”¹å¯åŠ¨ç±»æ–°å»ºä¸€ä¸ªSpringbootåº”ç”¨çš„å¯åŠ¨ç±»ApiGatewayApplicationï¼Œå¹¶åœ¨ä¸Šé¢æ·»åŠ @EnableZuulProxyæ³¨è§£ï¼Œç”¨æ¥å¯ç”¨Zuulåå‘ä»£ç†ã€‚ import org.springframework.boot.WebApplicationType; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.builder.SpringApplicationBuilder; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; import org.springframework.cloud.netflix.zuul.EnableZuulProxy; @SpringBootApplication @EnableDiscoveryClient @EnableZuulProxy public class ApiGatewayApplication { public static void main(String[] args) { new SpringApplicationBuilder(ApiGatewayApplication.class).web(WebApplicationType.SERVLET).run(args); } } æ·»åŠ é…ç½®application.yml æ·»åŠ é…ç½®å¦‚ä¸‹ï¼š server: port: 8791 # æœåŠ¡çš„åç§° spring: application: name: api-gateway # æ³¨å†Œä¸­å¿ƒåœ°å€ eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ å¯åŠ¨æµ‹è¯•æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¯åŠ¨åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼š ==&gt;å¯åŠ¨Eurekaæ³¨å†Œä¸­å¿ƒï¼Œç«¯å£å· 8761 ==&gt;åˆ†åˆ«é€šè¿‡8771å’Œ8772ä¸¤ä¸ªç«¯å£å¯åŠ¨message-service ==&gt;å¯åŠ¨api-gatewayï¼Œç«¯å£å· 8791 å¯åŠ¨å®Œæˆä¹‹åï¼ŒEurekaæ³¨å†Œä¸­å¿ƒä¸­æ³¨å†Œçš„æœåŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹åœ°å€: http://localhost:8771/api/v1/msg/getï¼Œå°†ä¼šæ˜¾ç¤ºä»¥ä¸‹ç•Œé¢ï¼š åŒæ ·çš„ï¼Œè®¿é—®åœ°å€ï¼šhttp://localhost:8772/api/v1/msg/getï¼Œå°†ä¼šæ˜¾ç¤ºä»¥ä¸‹ç•Œé¢ï¼š è¯æ˜ä¸¤ä¸ªmessage-serviceæœåŠ¡éƒ½èƒ½æ­£å¸¸è®¿é—®ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡Zuulç½‘å…³è¯·æ±‚æœåŠ¡ï¼Œè¯·æ±‚åœ°å€çš„æ ¼å¼å¦‚ä¸‹ï¼š &lt;zuul-host&gt;:&lt;zuul-port&gt;/service-name/[service-URI] # zuul-host zuulç½‘å…³çš„ä¸»æœºåç§°æˆ–IPåœ°å€ï¼Œæœ¬ä¾‹ä¸­ä¸ºlocalhost # zuul-port zuulç½‘å…³çš„ç«¯å£å·ï¼Œæœ¬ä¾‹ä¸­ä¸º 8791 # service-name è¦è¯·æ±‚çš„æœåŠ¡åç§°ï¼Œæœ¬ä¾‹ä¸­ä¸º message-service # service-URI è¦è¯·æ±‚çš„æœåŠ¡çš„uriåœ°å€ï¼Œæœ¬ä¾‹ä¸­ä¸º /api/v1/msg/get æœ¬ä¾‹ä¸­ï¼Œå®Œæ•´çš„è¯·æ±‚åœ°å€ä¸ºï¼šhttp://localhost:8791/message-service/api/v1/msg/get ï¼Œè¿ç»­è¯·æ±‚ä¸¤æ¬¡ï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š å¯è§ï¼ŒZuulä¸ä»…æˆåŠŸåœ°å¸®æˆ‘ä»¬è·¯ç”±åˆ°äº†ç›¸åº”çš„å¾®æœåŠ¡è¿˜å¯¹è¯·æ±‚åšäº†è´Ÿè½½å‡è¡¡ã€‚ Zuulé›†ç¾¤æ¶æ„é€šå¸¸æˆ‘ä»¬éƒ½ä¼šå¯åŠ¨å¤šä¸ªZuulç½‘å…³èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡Nginxå¯¹å¤šä¸ªç½‘å…³è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ä¸ºäº†é˜²æ­¢Nginxå‡ºç°å•ç‚¹æ•…éšœï¼Œè¿˜éœ€è¦åœ¨Nginxé›†ç¾¤ä¹‹å‰ä½¿ç”¨Lvs+KeepAlivedè¿›è¡Œå¥åº·æ£€æŸ¥ä»¥åŠæ•…éšœè¿ç§»ï¼Œå…¸å‹çš„Zuulé«˜å¯ç”¨é›†ç¾¤æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å‚è€ƒæ–‡ç« https://www.jianshu.com/p/e0434a421c03 https://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#netflix-zuul-starter","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--HystrixæœåŠ¡ç†”æ–­ä¸é™çº§","slug":"SpringCloudä¹‹--HystrixæœåŠ¡ç†”æ–­ä¸é™çº§","date":"2020-05-31T08:45:38.000Z","updated":"2023-04-30T10:21:41.366Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--HystrixæœåŠ¡ç†”æ–­ä¸é™çº§/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--HystrixæœåŠ¡ç†”æ–­ä¸é™çº§/","excerpt":"","text":"æœåŠ¡ç†”æ–­æœåŠ¡ç†”æ–­çš„ä½œç”¨ç±»ä¼¼äºæˆ‘ä»¬å®¶ç”¨çš„ä¿é™©ä¸ï¼Œå½“æŸæœåŠ¡å‡ºç°ä¸å¯ç”¨æˆ–å“åº”è¶…æ—¶çš„æƒ…å†µæ—¶ï¼Œä¸ºäº†é˜²æ­¢æ•´ä¸ªç³»ç»Ÿå‡ºç°é›ªå´©ï¼Œæš‚æ—¶åœæ­¢å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨ã€‚ æœåŠ¡é™çº§æœåŠ¡é™çº§æ˜¯ä»æ•´ä¸ªç³»ç»Ÿçš„è´Ÿè·æƒ…å†µå‡ºå‘å’Œè€ƒè™‘çš„ï¼Œå¯¹æŸäº›è´Ÿè·ä¼šæ¯”è¾ƒé«˜çš„æƒ…å†µï¼Œä¸ºäº†é¢„é˜²æŸäº›åŠŸèƒ½ï¼ˆä¸šåŠ¡åœºæ™¯ï¼‰å‡ºç°è´Ÿè·è¿‡è½½æˆ–è€…å“åº”æ…¢çš„æƒ…å†µï¼Œåœ¨å…¶å†…éƒ¨æš‚æ—¶èˆå¼ƒå¯¹ä¸€äº›éæ ¸å¿ƒçš„æ¥å£å’Œæ•°æ®çš„è¯·æ±‚ï¼Œè€Œç›´æ¥è¿”å›ä¸€ä¸ªæå‰å‡†å¤‡å¥½çš„fallbackï¼ˆé€€è·¯ï¼‰é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚è¿™æ ·ï¼Œè™½ç„¶æä¾›çš„æ˜¯ä¸€ä¸ªæœ‰æŸçš„æœåŠ¡ï¼Œä½†å´ä¿è¯äº†æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚ ç†”æ–­VSé™çº§ç›¸åŒç‚¹ï¼š ç›®æ ‡ä¸€è‡´ éƒ½æ˜¯ä»å¯ç”¨æ€§å’Œå¯é æ€§å‡ºå‘ï¼Œä¸ºäº†é˜²æ­¢ç³»ç»Ÿå´©æºƒï¼› ç”¨æˆ·ä½“éªŒç±»ä¼¼ æœ€ç»ˆéƒ½è®©ç”¨æˆ·ä½“éªŒåˆ°çš„æ˜¯æŸäº›åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼› ä¸åŒç‚¹ï¼š è§¦å‘åŸå› ä¸åŒ æœåŠ¡ç†”æ–­ä¸€èˆ¬æ˜¯æŸä¸ªæœåŠ¡ï¼ˆä¸‹æ¸¸æœåŠ¡ï¼‰æ•…éšœå¼•èµ·ï¼Œè€ŒæœåŠ¡é™çº§ä¸€èˆ¬æ˜¯ä»æ•´ä½“è´Ÿè·è€ƒè™‘ï¼› Hystrixç®€ä»‹ Hystrixï¼šè‹± [hÉªst&#39;rÉªks] ç¾ [hÉªst&#39;rÉªks]ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯â€œè±ªçŒªâ€çš„æ„æ€ã€‚ åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸å¯é¿å…åœ°ä¼šå‡ºç°æŸäº›ä¾èµ–çš„æœåŠ¡å‘ç”Ÿæ•…éšœçš„æƒ…å†µã€‚Hystrixæ˜¯è¿™æ ·çš„ä¸€ä¸ªåº“ï¼Œå®ƒé€šè¿‡æ·»åŠ å®¹è®¸æ—¶å»¶å’Œå®¹é”™é€»è¾‘æ¥å¸®åŠ©ä½ æ§åˆ¶è¿™äº›åˆ†å¸ƒå¼æœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚Hystrixé€šè¿‡éš”ç¦»æœåŠ¡ä¹‹é—´çš„è®¿é—®ç‚¹ï¼Œé˜»æ­¢è·¨æœåŠ¡çš„çº§è”æ•…éšœï¼Œå¹¶æä¾›äº†é€€è·¯é€‰é¡¹ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“å¼¹æ€§ã€‚ Hystrixçš„è®¾è®¡ç›®çš„ï¼š é€šè¿‡ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯çš„åº“æ¥ä¸ºè®¿é—®ä¾èµ–æœåŠ¡æ—¶çš„æ½œåœ¨æ•…éšœæä¾›ä¿æŠ¤å’Œæ§åˆ¶ï¼› é˜²æ­¢åœ¨å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‡ºç°çº§è”æ•…éšœï¼› å¿«é€Ÿå¤±è´¥å’Œè¿…é€Ÿæ¢å¤ï¼› åœ¨å…è®¸çš„æƒ…å†µä¸‹ï¼Œæä¾›é€€è·¯å¯¹æœåŠ¡è¿›è¡Œä¼˜é›…é™çº§ï¼› æä¾›è¿‘å®æ—¶çš„ç›‘æ§ã€æŠ¥è­¦å’Œæ“ä½œæ§åˆ¶ï¼› æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡å¯¹ã€ŠFeignæ¨¡æ‹ŸRPCè°ƒç”¨ã€‹ä¸€ç« ä¸­çš„ message-center é¡¹ç›®è¿›è¡Œæ”¹é€ ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Hystrixï¼ŒeurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒä»¥åŠmessage-serviceæœåŠ¡æä¾›è€…æ— éœ€æ›´æ”¹ã€‚ ä½¿ç”¨Hystrixå¼•å…¥Hystrixä¾èµ–åœ¨ pom.xml æ–‡ä»¶ä¸­å¼•å…¥Hystrixä¾èµ–ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Eureka-Client ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Feign ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Hystrix ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; ä¿®æ”¹å¯åŠ¨ç±»åœ¨MessageCenterApplicationå¯åŠ¨ç±»ä¸Šå¢åŠ @EnableCircuitBreakeræ³¨è§£ï¼š @SpringBootApplication @EnableFeignClients @EnableCircuitBreaker public class MessageCenterApplication { public static void main(String[] args) { new SpringApplicationBuilder(MessageCenterApplication.class).web(WebApplicationType.SERVLET).run(args); } } è¿™é‡Œæˆ‘ä»¬åœ¨å¯åŠ¨ç±»ä¸­åˆå¢åŠ äº†@EnableCircuitBreakeræ³¨è§£ï¼Œç”¨æ¥å¼€å¯æ–­è·¯å™¨åŠŸèƒ½ã€‚å¦‚æœä½ è§‰å¾—å¯åŠ¨ç±»ä¸Šçš„æ³¨è§£ä¸ªæ•°æœ‰ç‚¹å¤šçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª@SpringCloudApplication æ³¨è§£æ¥ä»£æ›¿@SpringBootApplicationï¼ˆæˆ–è€…@EnableEurekaServerï¼‰ã€@EnableDiscoveryClientã€@EnableCircuitBreakerè¿™ä¸‰ä¸ªæ³¨è§£ã€‚ @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) @Documented @Inherited @SpringBootApplication @EnableDiscoveryClient @EnableCircuitBreaker public @interface SpringCloudApplication { } ä¿®æ”¹Controlleræ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºMessageCenterControllerä¸­çš„getMsg()æ¥å£å¢åŠ æ–­è·¯å™¨åŠŸèƒ½ï¼Œä¿®æ”¹éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š @GetMapping(&quot;/msg/get&quot;) @HystrixCommand(fallbackMethod = &quot;getMsgFallback&quot;) public Object getMsg() { String msg = messageService.getMsg(); return msg; } public Object getMsgFallback() { return &quot;ç¥æ‚¨ 2019 çŒªå¹´å¤§å‰ï¼Œ&#39;çŒª&#39;äº‹å¦‚æ„ï¼&quot;; } å…ˆå¯åŠ¨Eurekaï¼Œå†å¯åŠ¨ä¸€ä¸ª8771ç«¯å£çš„message-serviceæœåŠ¡ï¼Œæœ€åå¯åŠ¨message-centerã€‚å¾…å¯åŠ¨å®Œæˆä¹‹åï¼ŒEurekaæ³¨å†Œä¸­å¿ƒå®ä¾‹æ³¨å†Œä¿¡æ¯å¦‚ä¸‹ï¼š æ­¤æ—¶ï¼Œè®¿é—® http://localhost:8781/api/v1/center/msg/get ï¼Œè¿”å›å¦‚ä¸‹ç»“æœè¡¨æ˜æœåŠ¡è°ƒç”¨æˆåŠŸï¼š ç„¶åï¼Œåœæ‰message-serviceæœåŠ¡ï¼Œå†æ¬¡è¯·æ±‚ http://localhost:8781/api/v1/center/msg/get ï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹å‡ºfallbackä¸­çš„ä¿¡æ¯è¢«ç›´æ¥è¿”å›äº†ï¼Œè¡¨æ˜Hystrixæ–­è·¯å™¨è°ƒç”¨æˆåŠŸã€‚ æ³¨æ„ï¼šfallbackæ–¹æ³•çš„ç­¾åéœ€è¦å’ŒåŸæ–¹æ³•ä¿æŒä¸€è‡´ã€‚ /** * è·å–æ¶ˆæ¯è¯¦æƒ… */ @GetMapping(&quot;/api/v1/msg/detail/{id}&quot;) @HystrixCommand(fallbackMethod = &quot;getDetailFallback&quot;) public MessageEntity getDetail(@PathVariable(name = &quot;id&quot;) Long id) { return messageService.getById(id); } /** * è·å–æ¶ˆæ¯è¯¦æƒ…é€€è·¯ */ public MessageEntity getDetailFallback(Long id){ return null; } Feignç»“åˆHystrixä»¥MessageServiceçš„Feignå®¢æˆ·ç«¯ä¸ºä¾‹ï¼Œä¸ºå…¶æ·»åŠ Hystrixæ–­è·¯å™¨åŠŸèƒ½ã€‚ ä¿®æ”¹Feignå®¢æˆ·ç«¯é€šè¿‡é…ç½®@FeignClientæ³¨è§£çš„fallbackå±æ€§æ¥ä½MessageServiceClientæŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„fallbackå¤„ç†ç±»ï¼ˆMessageServiceFallbackï¼‰ã€‚ @FeignClient(name = &quot;message-service&quot;, fallback = MessageServiceFallback.class) public interface MessageServiceClient { @GetMapping(&quot;/api/v1/msg/get&quot;) public String getMsg(); } åˆ›å»ºFallbackå¤„ç†ç±»MessageServiceFallbackéœ€è¦å®ç°MessageServiceClientæ¥å£ï¼Œå¹¶ä¸”åœ¨Springå®¹å™¨ä¸­å¿…é¡»å­˜åœ¨ä¸€ä¸ªè¯¥ç±»å‹çš„æœ‰æ•ˆBeanã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨@Componentæ³¨è§£å°†å…¶æ³¨å…¥åˆ°Springå®¹å™¨ä¸­ã€‚ @Component public class MessageServiceFallback implements MessageServiceClient { @Override public String getMsg() { System.out.println(&quot;è°ƒç”¨æ¶ˆæ¯æ¥å£å¤±è´¥ï¼Œå¯¹å…¶è¿›è¡Œé™çº§å¤„ç†ï¼&quot;); return &quot;æ¶ˆæ¯æ¥å£ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•ï¼&quot;; } } ä¿®æ”¹é…ç½®åœ¨æ–°ç‰ˆæœ¬çš„Springcloudä¸­ï¼ŒFeigné»˜è®¤å…³é—­äº†å¯¹Hystrixçš„æ”¯æŒï¼Œéœ€è¦åœ¨application.ymlè¿›è¡Œé…ç½®ï¼š feign: hystrix: enabled: true å½“message-serviceæœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè¯·æ±‚ http://localhost:8781/api/v1/center/msg/getï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š æŸ¥çœ‹åå°æ—¥å¿—ï¼Œæ‰“å°å¦‚ä¸‹å†…å®¹ï¼Œè¡¨æ˜fallbackæ–¹æ³•è¢«æˆåŠŸè°ƒç”¨äº†ï¼š ç›‘æ§Hystrixå¯ç”¨å¥åº·ç›‘æ§Actuatoræ˜¯Springbootæä¾›çš„ç”¨æ¥å¯¹åº”ç”¨ç³»ç»Ÿè¿›è¡Œè‡ªçœå’Œç›‘æ§çš„åŠŸèƒ½æ¨¡å—ï¼Œå€ŸåŠ©äºActuatorå¼€å‘è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹åº”ç”¨ç³»ç»ŸæŸäº›ç›‘æ§æŒ‡æ ‡è¿›è¡ŒæŸ¥çœ‹ã€ç»Ÿè®¡ç­‰ã€‚ è‹¥è¦ä½¿ç”¨Actuatorå¯¹Hystrix æµè¿›è¡Œç›‘æ§ï¼Œé™¤äº†éœ€åœ¨å·¥ç¨‹POMæ–‡ä»¶ä¸­å¼•å…¥spring-boot-starter-actuatorä¾èµ–: &lt;!-- Actuator ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; è¿˜éœ€è¦åœ¨application.yml ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š management: endpoints: web: exposure: include: hystrix.stream å¯ç”¨Hystrix-Dashboardä½¿ç”¨Hystrixä¸€ä¸ªæœ€å¤§çš„å¥½å¤„å°±æ˜¯å®ƒä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æ”¶é›†æ¯ä¸€ä¸ªHystrixCommandçš„ä¿¡æ¯ï¼Œå¹¶åˆ©ç”¨Hystrix-Dashboardé€šè¿‡ä¸€ç§é«˜æ•ˆçš„æ–¹å¼å¯¹æ¯ä¸€ä¸ªæ–­è·¯å™¨çš„å¥åº·çŠ¶æ€è¿›è¡Œå±•ç¤ºã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨HystrixCommandå¯¹RibbonClientè¿›è¡ŒåŒ…è£…çš„æ—¶å€™ï¼Œä½ éœ€è¦ç¡®ä¿ä½ é…ç½®çš„Hystrixè¶…æ—¶æ—¶é—´è¦æ¯”Ribbonçš„è¶…æ—¶æ—¶é—´é•¿ï¼ŒåŒ…æ‹¬ç”±å®ƒä»¬å¼•èµ·çš„é‡è¯•æ—¶é—´ï¼Œä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœä½ çš„Ribbonè¿æ¥è¶…æ—¶æ—¶é—´æ˜¯1ç§’ï¼Œå¹¶ä¸”Ribbonä¼šè¿ç»­é‡è¯•è¯·æ±‚3æ¬¡ï¼Œé‚£ä¹ˆä½ çš„Hystrixè¿æ¥è¶…æ—¶æ—¶é—´éœ€è¦é…ç½®æˆç¨å¤§äº3ç§’ã€‚ å¼•å…¥ä¾èµ–åœ¨ pom.xml æ–‡ä»¶ä¸­å¼•å…¥Hystrix-Dashboardä¾èµ–ï¼š &lt;!-- Hystrix Dashboard ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt; &lt;/dependency&gt; ä¿®æ”¹å¯åŠ¨ç±»åœ¨MessageCenterApplicationå¯åŠ¨ç±»ä¸Šå¢åŠ @EnableHystrixDashboardæ³¨è§£ï¼š @EnableFeignClients @SpringCloudApplication @EnableHystrixDashboard public class MessageCenterApplication { public static void main(String[] args) { new SpringApplicationBuilder(MessageCenterApplication.class).web(WebApplicationType.SERVLET).run(args); } } ä»ªè¡¨ç›˜ç•Œé¢å¯åŠ¨åº”ç”¨ï¼Œè®¿é—® http://localhost:8781/hystrix ï¼Œæ‰“å¼€Hystrix-Dashboardç›‘æ§é¦–é¡µã€‚ åœ¨è¿™é‡Œé…ç½®å¥½éœ€è¦ç›‘æ§çš„Hystrixæµåœ°å€ http://localhost:8781/actuator/hystrix.stream ï¼Œå¼€å§‹ç›‘æ§ã€‚ å‚è€ƒæ–‡ç« https://github.com/netflix/hystrix/wiki https://github.com/netflix/hystrix https://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Feignæ¨¡æ‹ŸRPCè°ƒç”¨","slug":"SpringCloudä¹‹--Feignæ¨¡æ‹ŸRPCè°ƒç”¨","date":"2020-05-31T08:44:38.000Z","updated":"2023-04-30T10:21:41.365Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Feignæ¨¡æ‹ŸRPCè°ƒç”¨/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Feignæ¨¡æ‹ŸRPCè°ƒç”¨/","excerpt":"","text":"Feignç®€ä»‹Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„Web Serviceå®¢æˆ·ç«¯ï¼Œå®ƒèƒ½å¤Ÿè®©Web Serviceå®¢æˆ·ç«¯çš„ç¼–å†™å˜å¾—æ›´åŠ å®¹æ˜“ï¼ˆä½ åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå¹¶åœ¨æ¥å£ä¸Šæ·»åŠ ç›¸åº”æ³¨è§£å³å¯ï¼‰ã€‚é™¤äº†Feignè‡ªå¸¦çš„æ³¨è§£å¤–å®ƒè¿˜æ”¯æŒJAX-RSæ³¨è§£ï¼ŒSpringCloudåˆä¸ºFeignå¢åŠ äº†å¯¹SpringMVCæ³¨è§£çš„æ”¯æŒï¼ŒåŒæ—¶ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨å’ŒSpring Webä¸­é»˜è®¤ä½¿ç”¨çš„ç›¸åŒçš„httpMessageConverterï¼ŒSpringCloudé›†æˆäº†Ribbonå’ŒEurekaï¼Œç”¨æ¥åœ¨ä½¿ç”¨Feignæ—¶èƒ½å¤Ÿä¸ºå…¶æä¾›ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„HTTPå®¢æˆ·ç«¯ã€‚ æ€»èµ·æ¥è¯´ï¼ŒFeignå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å¯æ’æ‹”çš„æ³¨è§£æ”¯æŒï¼ŒåŒ…æ‹¬Feignæ³¨è§£å’ŒJAX-RSæ³¨è§£; æ”¯æŒå¯æ’æ‹”çš„HTTPç¼–ç å™¨å’Œè§£ç å™¨; æ”¯æŒHystrixå’Œå®ƒçš„Fallback; æ”¯æŒRibbonçš„è´Ÿè½½å‡è¡¡; æ”¯æŒHTTPè¯·æ±‚å’Œå“åº”çš„å‹ç¼©ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡å¯¹ä¸Šä¸€ç« ã€ŠRibbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‹ä¸­çš„ message-center é¡¹ç›®è¿›è¡Œæ”¹é€ ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Feignã€‚ message-centeræ”¹é€ å¼•å…¥Feignä¾èµ–ç”±äºFeignä¾èµ–ä¸­é»˜è®¤åŒ…å«äº†Ribbonï¼Œæ‰€ä»¥åªéœ€è¦åœ¨ pom.xml æ–‡ä»¶ä¸­å¼•å…¥Feignä¾èµ–å³å¯ï¼ŒRibbonä¾èµ–æ— éœ€é‡å¤å¼•å…¥ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Eureka-Client ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Feign ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; ä¿®æ”¹å¯åŠ¨ç±»åœ¨MessageCenterApplicationå¯åŠ¨ç±»ä¸Šå¢åŠ @EnableFeignClientsæ³¨è§£ï¼š import org.springframework.boot.WebApplicationType; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.builder.SpringApplicationBuilder; import org.springframework.cloud.openfeign.EnableFeignClients; @SpringBootApplication @EnableFeignClients public class MessageCenterApplication { public static void main(String[] args) { new SpringApplicationBuilder(MessageCenterApplication.class).web(WebApplicationType.SERVLET).run(args); } } è¿™é‡Œæˆ‘ä»¬åœ¨å¯åŠ¨ç±»ä¸­å¢åŠ äº†@EnableFeignClientsæ³¨è§£ï¼Œç”¨æ¥å¼€å¯Feignå®¢æˆ·ç«¯å‘ç°åŠŸèƒ½ã€‚ å¦‚æœä½ çš„Feignå®¢æˆ·ç«¯ç±»æ–‡ä»¶ä¸åœ¨Springçš„åŒ…æ‰«æè·¯å¾„ä¹‹ä¸­ï¼Œå¯ä»¥åœ¨@EnableFeignClientsæ³¨è§£ä¸­å¯¹Feignå®¢æˆ·ç«¯çš„åŒ…è·¯å¾„è¿›è¡ŒæŒ‡å®šã€‚ @SpringBootApplication @EnableFeignClients(basePackages = &quot;com.pengjunlee.client.**&quot;) public class MessageCenterApplication { public static void main(String[] args) { new SpringApplicationBuilder(MessageCenterApplication.class).web(WebApplicationType.SERVLET).run(args); } } åˆ›å»ºFeignå®¢æˆ·ç«¯åœ¨ä¸Šä¸€ç« ã€ŠRibbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‹ä¸­ï¼Œå¯¹å¤–æä¾›æœåŠ¡çš„HTTPæ¥å£å®šä¹‰åœ¨MessageControllerä¸­ã€‚ @RestController @RequestMapping(&quot;/api/v1/msg&quot;) public class MessageController { @Value(&quot;${server.port}&quot;) private String port; /** * è¿”å›ä¸€æ¡æ¶ˆæ¯ */ @GetMapping(&quot;/get&quot;) public String getMsg() { return &quot;This message is sent from port: &quot; + port; } } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æ¶ˆè´¹ç«¯message-centerä¸­ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªFeignå®¢æˆ·ç«¯ã€‚æ–°å»ºä¸€ä¸ªæ¥å£å–åMessageServiceClientï¼Œå¹¶åœ¨ä¸Šé¢æ·»åŠ @FeignClientæ³¨è§£ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š import org.springframework.cloud.openfeign.FeignClient; import org.springframework.web.bind.annotation.GetMapping; @FeignClient(name = &quot;message-service&quot;) public interface MessageServiceClient { @GetMapping(&quot;/api/v1/msg/get&quot;) public String getMsg(); } è¯´æ˜ï¼šæ­¤å¤„@FeignClientæ³¨è§£çš„nameå±æ€§åº”ä¸message-serviceåº”ç”¨çš„spring.application.nameå±æ€§ç›¸åŒï¼Œè¡¨ç¤ºä¸ºmessage-serviceæœåŠ¡åˆ›å»ºä¸€ä¸ªFeignå®¢æˆ·ç«¯ã€‚æ¥å£çš„æ˜ å°„åœ°å€è·¯å¾„ä»¥åŠæ¥å£å…¥å‚éƒ½å¿…é¡»ä¸MessageControllerä¸­çš„æ–¹æ³•å®Œå…¨ç›¸åŒã€‚ è°ƒç”¨Feignå®¢æˆ·ç«¯æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å¦‚ä½•åœ¨æ¶ˆè´¹ç«¯ä½¿ç”¨åˆ›å»ºå¥½çš„Feignå®¢æˆ·ç«¯å¯¹message-serviceæœåŠ¡è¿›è¡Œè°ƒç”¨ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import com.pengjunlee.service.MessageServiceClient; @RestController @RequestMapping(&quot;/api/v1/center&quot;) public class MessageCenterController { @Autowired private MessageServiceClient messageService; @GetMapping(&quot;/msg/get&quot;) public Object getMsg() { String msg = messageService.getMsg(); return msg; } } å¯åŠ¨åº”ç”¨ï¼Œå†æ¬¡è¯·æ±‚ http://localhost:8781/api/v1/center/msg/get ï¼Œè¿”å›å¦‚ä¸‹ç»“æœè¡¨æ˜æœåŠ¡è°ƒç”¨æˆåŠŸï¼š å…³äºä¼ å‚Feigné™¤äº†æ”¯æŒè‡ªå¸¦çš„æ³¨è§£å’ŒJAX-RSæ³¨è§£å¤–ï¼Œè¿˜æ”¯æŒ SpringMVCæ³¨è§£ï¼Œå¸¸ç”¨çš„æœ‰ï¼š@RequestParam ã€@PathVariableã€@RequestBody ç­‰ã€‚ ä¾‹å¦‚ï¼ŒæœåŠ¡ç«¯æä¾›å¦‚ä¸‹ä¸¤ä¸ªæœåŠ¡æ¥å£ï¼š /** * è·å–æ¶ˆæ¯è¯¦æƒ… */ @GetMapping(&quot;/api/v1/msg/detail/{id}&quot;) public MessageEntity getDetail(@PathVariable(name = &quot;id&quot;) Long id) { return messageService.getById(id); } /** * æ–°å»ºä¸€æ¡æ¶ˆæ¯ */ @PostMapping(&quot;/api/v1/msg/save&quot;) public MessageEntity save(@RequestBody MessageEntity message) { return messageService.save(message); } ç›¸åº”çš„ï¼Œåœ¨Feignå®¢æˆ·ç«¯ä¸­å¯ä»¥è¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š /** * è·å–æ¶ˆæ¯è¯¦æƒ… */ @GetMapping(&quot;/api/v1/msg/detail/{id}&quot;) public MessageEntity getDetail(@PathVariable(name = &quot;id&quot;) Long id) ; /** * æ–°å»ºä¸€æ¡æ¶ˆæ¯ */ @PostMapping(&quot;/api/v1/msg/save&quot;) public MessageEntity save(@RequestBody MessageEntity message) ; é‡å†™Feignçš„é»˜è®¤é…ç½®åœ¨Spring Cloudå¯¹Feignçš„æ”¯æŒå®ç°ä¸­ï¼Œä¸€ä¸ªæ ¸å¿ƒçš„æ¦‚å¿µå°±æ˜¯å®¢æˆ·ç«¯å‘½åï¼Œæ¯ä¸€ä¸ªFeignå®¢æˆ·ç«¯éƒ½æ˜¯æ•´ä¸ªç»„ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬ç›¸äº’ååŒä¸€èµ·å·¥ä½œæ¥æŒ‰ç…§éœ€æ±‚ä¸è¿œç¨‹æœåŠ¡å™¨å–å¾—è”ç³»ã€‚å¹¶ä¸”å®ƒä»¬æ¯ä¸€ä¸ªéƒ½æœ‰è‡ªå·±çš„åå­—ï¼Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨@feignclientæ¥ç»™å®ƒå–åã€‚Spring CloudæŒ‰ç…§è‡ªå·±çš„éœ€è¦åˆä½¿ç”¨FeignClientsConfigurationä¸ºæ¯ä¸€ä¸ªå·²å‘½åçš„å®¢æˆ·ç«¯åˆ›å»ºäº†ä¸€ä¸ªApplicationContextï¼Œé¢å¤–åŒ…å«äº†ä¸€ä¸ªfeign.Decoderã€ä¸€ä¸ª feign.Encoder å’Œä¸€ä¸ª feign.Contractã€‚ä½ å¯ä»¥é€šè¿‡æŒ‡å®š@FeignClientæ³¨è§£çš„contextId å±æ€§æ¥è®¾ç½®ApplicationContextçš„åå­—ã€‚ SpringCloudè¿˜å…è®¸ä½ åœ¨FeignClientsConfigurationçš„åŸºç¡€ä¹‹ä¸Šä½¿ç”¨@FeignClientå£°æ˜ä¸€äº›é¢å¤–çš„é…ç½®ï¼Œä»è€Œå®ç°å¯¹Feignå®¢æˆ·ç«¯çš„å®Œå…¨æ§åˆ¶ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š @FeignClient(name = &quot;message-service&quot;, configuration = MessageConfiguration.class) public interface MessageServiceClient { //.. } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™ä¸ªFeignå®¢æˆ·ç«¯å°†ç”±FeignClientsConfiguration å’ŒMessageConfigurationä¸­çš„ç»„ä»¶ä¸€èµ·ç»„æˆï¼ˆåè€…ä¼šè¦†ç›–å‰è€…çš„é…ç½®ï¼‰ã€‚ æ³¨æ„ï¼šæœ¬ä¾‹ä¸­ï¼ŒMessageConfigurationä¸å¿…ç”¨@Configurationæ³¨è§£è¿›è¡Œæ ‡æ³¨ï¼Œå¦‚æœç¡®å®è¦åŠ ä¸Š@Configurationæ³¨è§£ï¼Œä½ éœ€è¦æ³¨æ„æŠŠMessageConfigurationæ’é™¤åœ¨@ComponentScanå’Œ@SpringBootApplicationæ‰«æçš„åŒ…è·¯å¾„ä¹‹å¤–ï¼Œå¦åˆ™å®ƒå°†æˆä¸ºfeign.Decoderã€feign.Encoder å’Œ feign.Contract ç­‰çš„é»˜è®¤å€¼ã€‚ ä¸‹è¡¨åˆ—å‡ºäº† Spring Cloud Netflix ç¼ºçœä¸ºFeignæä¾›çš„æ‰€æœ‰ Beanï¼ˆBeanç±»å‹ Beanåç§°ï¼šBeanå®ç°ï¼‰ï¼š Decoder feignDecoder: ResponseEntityDecoder (åŒ…è£…äº†ä¸€ä¸ª SpringDecoder) Encoder feignEncoder: SpringEncoder Logger feignLogger: Slf4jLogger Contract feignContract: SpringMvcContract Feign.Builder feignBuilder: HystrixFeign.Builder Client feignClient: å¯ç”¨ Ribbon æ—¶æ˜¯ LoadBalancerFeignClientï¼Œå¦åˆ™ä½¿ç”¨ feign.Client.Defaultã€‚ ä½ å¯ä»¥ä½¿ç”¨ OkHttpClient æˆ–è€… ApacheHttpClient çš„Feignå®¢æˆ·ç«¯ï¼Œåªéœ€è¦å°† feign.okhttp.enabled æˆ–è€… feign.httpclient.enabled è®¾ç½®ä¸º true ï¼Œå¹¶å°†ç›¸åº”ç±»æ·»åŠ åˆ°é¡¹ç›®çš„CLASSPATHå³å¯ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„HTTP å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ Apache æ—¶æä¾›ä¸€ä¸ªClosableHttpClient ç±»å‹Beanæˆ–è€…ä½¿ç”¨OK HTTPæ—¶æä¾›ä¸€ä¸ªOkHttpClient ç±»å‹Beanã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Cloud Netflix å¹¶æ²¡æœ‰ä¸ºFeignæä¾›ä¸‹åˆ—çš„Beanï¼Œä½†ä¾ç„¶ä¼šä»Springå®¹å™¨ä¸­æŸ¥æ‰¾è¿™äº›ç±»å‹çš„Beanç”¨æ¥åˆ›å»ºFeignå®¢æˆ·ç«¯ã€‚ Logger.Level Retryer ErrorDecoder Request.Options Collection&lt;RequestInterceptor&gt; SetterFactory åˆ›å»ºè¿™äº›ç±»å‹çš„ä¸€ä¸ªBean å¹¶å°†å®ƒå†™åˆ° @FeignClient å£°æ˜çš„é…ç½®ä¸­ï¼Œè¿™æ ·ä½ å°±èƒ½å¤Ÿå¯¹è¿™äº›Beanä¸­çš„æ¯ä¸€ä¸ªè¿›è¡Œé‡å†™ã€‚ä¾‹å¦‚ä¸‹é¢çš„ MessageConfiguration åˆ©ç”¨feign.Contract.Defaultæ›¿ä»£äº†SpringMvcContract å¹¶å‘RequestInterceptor é›†åˆä¸­æ·»åŠ äº†ä¸€ä¸ªRequestInterceptor ã€‚ @Configuration public class MessageConfiguration { @Bean public Contract feignContract() { return new feign.Contract.Default(); } @Bean public BasicAuthRequestInterceptor basicAuthRequestInterceptor() { return new BasicAuthRequestInterceptor(&quot;user&quot;, &quot;password&quot;); } } å½“ç„¶ï¼Œ@FeignClient ä¹Ÿæ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚ feign: client: config: message-service: connectTimeout: 5000 readTimeout: 5000 loggerLevel: full errorDecoder: com.pengjunlee.SimpleErrorDecoder retryer: com.pengjunlee.SimpleRetryer requestInterceptors: - com.pengjunlee.FooRequestInterceptor - com.pengjunlee.BarRequestInterceptor decode404: false encoder: com.pengjunlee.SimpleEncoder decoder: com.pengjunlee.SimpleDecoder contract: com.pengjunlee.SimpleContract é»˜è®¤é…ç½®å¯ä»¥é€šè¿‡@EnableFeignClientsçš„defaultConfigurationå±æ€§è¿›è¡ŒæŒ‡å®šï¼Œç„¶åä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰çš„Feignå®¢æˆ·ç«¯ã€‚å¦‚æœä½ å¸Œæœ›ä½¿ç”¨é…ç½®æ–‡ä»¶å¯¹æ‰€æœ‰çš„@FeignClientè¿›è¡Œé…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ default ä½œä¸ºFeignå®¢æˆ·ç«¯çš„åç§°ã€‚ feign: client: config: default: connectTimeout: 5000 readTimeout: 5000 loggerLevel: basic å¦‚æœæˆ‘ä»¬åŒæ—¶ä½¿ç”¨äº†@Configuration Beanå’Œæ–‡ä»¶é…ç½®ï¼Œæ–‡ä»¶é…ç½®ä¼šä¼˜å…ˆç”Ÿæ•ˆã€‚å¦‚æœä½ å¸Œæœ›ä¼˜å…ˆä½¿ç”¨ @Configuration Beanä¸­çš„é…ç½®ï¼Œå¯ä»¥å°† feign.client.default-to-properties è®¾ç½®ä¸º false ã€‚ å¦‚æœä½ éœ€è¦åœ¨RequestInterceptorä¸­ä½¿ç”¨ThreadLocal å˜é‡ï¼Œä½ éœ€è¦å°†Hystrix çš„çº¿ç¨‹éš”ç¦»ç­–ç•¥è®¾ç½®ä¸º SEMAPHORE æˆ–è€…ç›´æ¥ç¦ç”¨Hystrix ã€‚ # To disable Hystrix in Feign feign: hystrix: enabled: false # To set thread isolation to SEMAPHORE hystrix: command: default: execution: isolation: strategy: SEMAPHORE å…³äºè¶…æ—¶åœ¨å¯ç”¨Ribbonçš„æƒ…å†µä¸‹ï¼ŒFeignå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªLoadBalancerFeignClient Beanï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ª execute() æ–¹æ³•ç”¨æ¥å‘é€ä¸€ä¸ªHTTPè¯·æ±‚å¹¶è·å–å“åº”ï¼Œ æœ¬è´¨ä¸Šå…¶å®è¿˜æ˜¯ä½¿ç”¨çš„Ribbonåšè´Ÿè½½å‡è¡¡ï¼Œå¹¶ä½¿ç”¨RestTemplateå‘é€çš„è¯·æ±‚ã€‚execute() æ¥å£å£°æ˜å¦‚ä¸‹ï¼š public Response execute(Request request, Request.Options options) throws IOException;å…¶ä¸­ï¼ŒRequest ç”¨æ¥å°è£…HTTPè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ã€‚ /** * * An immutable request to an http server. * */ public final class Request { private final String method; private final String url; private final Map&lt;String, Collection&lt;String&gt;&gt; headers; private final byte[] body; private final Charset charset; // ... } Options åˆ™å°è£…äº†ä¸€äº›è¯·æ±‚æ§åˆ¶å‚æ•°ï¼š public static class Options { private final int connectTimeoutMillis; private final int readTimeoutMillis; private final boolean followRedirects; public Options(int connectTimeoutMillis, int readTimeoutMillis) { this(connectTimeoutMillis, readTimeoutMillis, true); } public Options() { this(10 * 1000, 60 * 1000); } // ... } ä»Options æºç æ¥çœ‹ï¼ŒFeignå®¢æˆ·ç«¯é»˜è®¤çš„è¯»å–è¶…æ—¶æ—¶é—´ä¸º60ç§’ã€‚è‹¥åŒæ—¶ä½¿ç”¨äº†Hystrixï¼Œç”±äºHystrix é»˜è®¤çš„è¯»å–è¶…æ—¶æ—¶é—´ä¸º1ç§’ï¼Œä¼šå¯¼è‡´Feignå®¢æˆ·ç«¯é»˜è®¤çš„è¯»å–è¶…æ—¶æ—¶é—´è®¾ç½®æ— æ•ˆï¼Œå³è¶…è¿‡1ç§’å³ä¸ºè¯»å–è¶…æ—¶ã€‚å¯ä½¿ç”¨å¦‚ä¸‹é…ç½®åŒæ—¶å¯¹Feignå®¢æˆ·ç«¯å’ŒHystrix çš„è¶…æ—¶é…ç½®è¿›è¡Œé‡å†™ã€‚ feign: client: config: default: connectTimeout: 5000 readTimeout: 5000 å‚è€ƒæ–‡ç« https://cloud.spring.io/spring-cloud-openfeign/single/spring-cloud-openfeign.html https://www.jianshu.com/p/a0d50385e598 https://blog.csdn.net/chengqiuming/article/details/80713471","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡","slug":"SpringCloudä¹‹--Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡","date":"2020-05-31T08:43:38.000Z","updated":"2023-04-30T10:21:41.366Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--Ribbonå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡/","excerpt":"","text":"æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡è´Ÿè½½å‡è¡¡æ˜¯æˆ‘ä»¬å¤„ç†é«˜å¹¶å‘ã€ç¼“è§£ç½‘ç»œå‹åŠ›å’Œè¿›è¡ŒæœåŠ¡å™¨æ‰©å®¹çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ‰€è¯´çš„è´Ÿè½½å‡è¡¡é€šå¸¸éƒ½æ˜¯æŒ‡æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡åˆåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ç¡¬ä»¶è´Ÿè½½å‡è¡¡ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯è½¯ä»¶è´Ÿè½½å‡è¡¡ã€‚ ç¡¬ä»¶è´Ÿè½½å‡è¡¡ä¸»è¦é€šè¿‡åœ¨æœåŠ¡å™¨èŠ‚ç‚¹ä¹‹å‰å®‰è£…ä¸“é—¨ç”¨äºè´Ÿè½½å‡è¡¡çš„è®¾å¤‡ï¼Œå¸¸è§çš„å¦‚ï¼šF5ã€‚ è½¯ä»¶è´Ÿè½½å‡è¡¡åˆ™ä¸»è¦æ˜¯åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¸€äº›å…·æœ‰è´Ÿè½½å‡è¡¡åŠŸèƒ½çš„è½¯ä»¶æ¥å®Œæˆè¯·æ±‚åˆ†å‘è¿›è€Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œå¸¸è§çš„å¦‚ï¼šLVS ã€ Nginx ã€Haproxyã€‚ æ— è®ºæ˜¯ç¡¬ä»¶è´Ÿè½½å‡è¡¡è¿˜æ˜¯è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼Œå®ƒçš„å·¥ä½œåŸç†éƒ½ä¸å¤–ä¹ä¸‹é¢è¿™å¼ å›¾ï¼š å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è€Œå¾®æœåŠ¡çš„å‡ºç°ï¼Œåˆ™ä¸ºè´Ÿè½½å‡è¡¡çš„å®ç°æä¾›äº†å¦å¤–ä¸€ç§æ€è·¯ï¼šæŠŠè´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ä»¥åº“çš„æ–¹å¼é›†æˆåˆ°æœåŠ¡çš„æ¶ˆè´¹æ–¹ï¼Œè€Œä¸å†æ˜¯ç”±ä¸€å°æŒ‡å®šçš„è´Ÿè½½å‡è¡¡è®¾å¤‡é›†ä¸­æä¾›ã€‚è¿™ç§æ–¹æ¡ˆç§°ä¸ºè½¯è´Ÿè½½å‡è¡¡ï¼ˆSoft Load Balancingï¼‰æˆ–è€…å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚å¸¸è§çš„å¦‚ï¼šSpring Cloudä¸­çš„ Ribbonã€‚ Ribbonæ˜¯ä¸€ä¸ªåŸºäºHTTPå’ŒTCPçš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼Œå½“æˆ‘ä»¬å°†Ribbonå’ŒEurekaä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒRibbonä¼šåˆ°Eurekaæ³¨å†Œä¸­å¿ƒå»è·å–æœåŠ¡ç«¯åˆ—è¡¨ï¼Œç„¶åè¿›è¡Œè½®è¯¢è®¿é—®ä»¥åˆ°è¾¾è´Ÿè½½å‡è¡¡çš„ä½œç”¨ï¼Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¹Ÿéœ€è¦å¿ƒè·³æœºåˆ¶å»ç»´æŠ¤æœåŠ¡ç«¯æ¸…å•çš„æœ‰æ•ˆæ€§ï¼Œå½“ç„¶è¿™ä¸ªè¿‡ç¨‹éœ€è¦é…åˆæœåŠ¡æ³¨å†Œä¸­å¿ƒä¸€èµ·å®Œæˆã€‚ æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ VS å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ å®¢æˆ·ç«¯å…ˆå‘é€è¯·æ±‚åˆ°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œç„¶åç”±è´Ÿè½½å‡è¡¡æœåŠ¡å™¨é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåœ¨ä¼—å¤šå¯ç”¨çš„æœåŠ¡å™¨ä¹‹ä¸­é€‰æ‹©ä¸€ä¸ªæ¥å¤„ç†è¯·æ±‚ã€‚ å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ å®¢æˆ·ç«¯è‡ªå·±ç»´æŠ¤ä¸€ä¸ªå¯ç”¨æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼Œåœ¨å‘é€è¯·æ±‚å‰å…ˆé€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªå°†ç”¨æ¥å¤„ç†æœ¬æ¬¡è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œç„¶åå†ç›´æ¥å°†è¯·æ±‚å‘é€è‡³è¯¥æœåŠ¡å™¨ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°†å»¶ç»­ä¸Šä¸€ç« çš„Eurekaæ³¨å†Œä¸­å¿ƒï¼Œç»§ç»­æ­å»ºä¸€ä¸ªåŸºäºRibbonçš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç¤ºä¾‹ã€‚ Ribbonè´Ÿè½½å‡è¡¡ç¤ºä¾‹æ­å»ºåˆ›å»ºæœåŠ¡æä¾›è€…å¼•å…¥ä¾èµ–æ–°å»ºä¸€ä¸ª Maven å·¥ç¨‹ï¼Œå–å message-service ç”¨æ¥æä¾›æ¶ˆæ¯æœåŠ¡ï¼Œåœ¨å…¶ pom.xml æ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–ï¼Œå†…å®¹å¦‚ä¸‹ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Eureka-Client ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; æ·»åŠ é…ç½®application.ymlæ·»åŠ é…ç½®å¦‚ä¸‹ï¼š spring: application: name: message-service eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ æœåŠ¡æä¾›è€…åˆ›å»ºä¸€ä¸ª MessageController æ§åˆ¶å™¨å¯¹å¤–æä¾›ä¸€ä¸ªhttpæ¥å£æœåŠ¡ã€‚ import org.springframework.beans.factory.annotation.Value; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @RestController @RequestMapping(&quot;/api/v1/msg&quot;) public class MessageController { @Value(&quot;${server.port}&quot;) private String port; /** * è¿”å›ä¸€æ¡æ¶ˆæ¯ */ @GetMapping(&quot;/get&quot;) public String getMsg() { return &quot;This message is sent from port: &quot; + port; } } åˆ›å»ºå¯åŠ¨ç±»import org.springframework.boot.WebApplicationType; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.builder.SpringApplicationBuilder; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; @SpringBootApplication @EnableEurekaClient public class MessageApplication { public static void main(String[] args) { new SpringApplicationBuilder(MessageApplication.class).web(WebApplicationType.SERVLET).run(args); } } å¯åŠ¨æœåŠ¡å³é”®--&gt;Run As --&gt; Run Configurations...ï¼Œåˆ†åˆ«ä½¿ç”¨ 8771ã€8772ã€8773 ä¸‰ä¸ªç«¯å£å„å¯åŠ¨ä¸€ä¸ªMessageApplicationåº”ç”¨ã€‚ -Dserver.port=8771 -Dserver.port=8772 -Dserver.port=8773 å¯åŠ¨å®Œæˆåï¼Œæµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:8761/ æ•ˆæœå›¾å¦‚ä¸‹ï¼š æœåŠ¡æ¶ˆè´¹è€…å¼•å…¥Ribbonä¾èµ–æ–°å»ºä¸€ä¸ª Maven å·¥ç¨‹ï¼Œå–å message-center ç”¨æ¥è°ƒç”¨æ¶ˆæ¯æœåŠ¡ï¼Œåœ¨å…¶ pom.xml æ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–ï¼Œå†…å®¹å¦‚ä¸‹ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Eureka-Client ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- Ribbon ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; æ·»åŠ é…ç½®application.yml æ·»åŠ é…ç½®å¦‚ä¸‹ï¼š server: port: 8781 spring: application: name: message-center eureka: client: serviceUrl: defaultZone: http://localhost:8761/eureka/ ä½¿ç”¨Ribbonå®¢æˆ·ç«¯æ–¹å¼ä¸€ï¼š åœ¨å¯åŠ¨ç±»ä¸­å‘Springå®¹å™¨ä¸­æ³¨å…¥ä¸€ä¸ªå¸¦æœ‰@LoadBalancedæ³¨è§£çš„RestTemplate Beanã€‚ import org.springframework.boot.WebApplicationType; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.builder.SpringApplicationBuilder; import org.springframework.cloud.client.loadbalancer.LoadBalanced; import org.springframework.cloud.netflix.eureka.EnableEurekaClient; import org.springframework.context.annotation.Bean; import org.springframework.web.client.RestTemplate; @SpringBootApplication @EnableEurekaClient public class MessageCenterApplication { @Bean @LoadBalanced public RestTemplate restTemplate() { return new RestTemplate(); } public static void main(String[] args) { new SpringApplicationBuilder(MessageCenterApplication.class).web(WebApplicationType.SERVLET).run(args); } } åœ¨è°ƒç”¨é‚£äº›éœ€è¦åšè´Ÿè½½å‡è¡¡çš„æœåŠ¡æ—¶ï¼Œä½¿ç”¨ä¸Šé¢æ³¨å…¥çš„RestTemplate Beanè¿›è¡Œè°ƒç”¨å³å¯ã€‚ import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; @RestController @RequestMapping(&quot;/api/v1/center&quot;) public class MessageCenterController { @Autowired private RestTemplate restTemplate; @GetMapping(&quot;/msg/get&quot;) public Object getMsg() { String msg = restTemplate.getForObject(&quot;http://message-service/api/v1/msg/get&quot;, String.class); return msg; } } æ–¹å¼äºŒï¼š ç›´æ¥ä½¿ç”¨ LoadBalancerClient ä¸­çš„è´Ÿè½½å‡è¡¡ç­–ç•¥è·å–ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡åœ°å€ï¼Œç„¶åå†è¿›è¡Œè¯·æ±‚ã€‚ import java.net.URI; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.cloud.client.ServiceInstance; import org.springframework.cloud.client.loadbalancer.LoadBalancerClient; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import org.springframework.web.client.RestTemplate; @RestController @RequestMapping(&quot;/api/v1/center&quot;) public class MessageCenterController { @Autowired private LoadBalancerClient loadBalancer; @GetMapping(&quot;/msg/get&quot;) public Object getMsg() { ServiceInstance instance = loadBalancer.choose(&quot;message-service&quot;); URI url = URI.create(String.format(&quot;http://%s:%s/api/v1/msg/get&quot;, instance.getHost(), instance.getPort())); RestTemplate restTemplate = new RestTemplate(); String msg = restTemplate.getForObject(url, String.class); return msg; } } å¾…åº”ç”¨å¯åŠ¨ä¹‹åï¼Œè¿ç»­ä¸‰æ¬¡è¯·æ±‚åœ°å€ http://localhost:8781/api/v1/center/msg/get ï¼Œè¿”å›çš„ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š åˆ‡æ¢Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥Ribbonæœ¬èº«æä¾›äº†ä¸‹é¢å‡ ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š RoundRobinRule: è½®è¯¢ç­–ç•¥ï¼ŒRibbonä»¥è½®è¯¢çš„æ–¹å¼é€‰æ‹©æœåŠ¡å™¨ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤å€¼ã€‚æ‰€ä»¥ç¤ºä¾‹ä¸­æ‰€å¯åŠ¨çš„ä¸¤ä¸ªæœåŠ¡ä¼šè¢«å¾ªç¯è®¿é—®; RandomRule: éšæœºç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´Ribbonä¼šéšæœºä»æœåŠ¡å™¨åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªè¿›è¡Œè®¿é—®; BestAvailableRule: æœ€å¤§å¯ç”¨ç­–ç•¥ï¼Œå³å…ˆè¿‡æ»¤å‡ºæ•…éšœæœåŠ¡å™¨åï¼Œé€‰æ‹©ä¸€ä¸ªå½“å‰å¹¶å‘è¯·æ±‚æ•°æœ€å°çš„; WeightedResponseTimeRule: å¸¦æœ‰åŠ æƒçš„è½®è¯¢ç­–ç•¥ï¼Œå¯¹å„ä¸ªæœåŠ¡å™¨å“åº”æ—¶é—´è¿›è¡ŒåŠ æƒå¤„ç†ï¼Œç„¶ååœ¨é‡‡ç”¨è½®è¯¢çš„æ–¹å¼æ¥è·å–ç›¸åº”çš„æœåŠ¡å™¨; AvailabilityFilteringRule: å¯ç”¨è¿‡æ»¤ç­–ç•¥ï¼Œå…ˆè¿‡æ»¤å‡ºæ•…éšœçš„æˆ–å¹¶å‘è¯·æ±‚å¤§äºé˜ˆå€¼çš„ä¸€éƒ¨åˆ†æœåŠ¡å®ä¾‹ï¼Œç„¶åå†ä»¥çº¿æ€§è½®è¯¢çš„æ–¹å¼ä»è¿‡æ»¤åçš„å®ä¾‹æ¸…å•ä¸­é€‰å‡ºä¸€ä¸ª; ZoneAvoidanceRule: åŒºåŸŸæ„ŸçŸ¥ç­–ç•¥ï¼Œå…ˆä½¿ç”¨ä¸»è¿‡æ»¤æ¡ä»¶ï¼ˆåŒºåŸŸè´Ÿè½½å™¨ï¼Œé€‰æ‹©æœ€ä¼˜åŒºåŸŸï¼‰å¯¹æ‰€æœ‰å®ä¾‹è¿‡æ»¤å¹¶è¿”å›è¿‡æ»¤åçš„å®ä¾‹æ¸…å•ï¼Œä¾æ¬¡ä½¿ç”¨æ¬¡è¿‡æ»¤æ¡ä»¶åˆ—è¡¨ä¸­çš„è¿‡æ»¤æ¡ä»¶å¯¹ä¸»è¿‡æ»¤æ¡ä»¶çš„ç»“æœè¿›è¡Œè¿‡æ»¤ï¼Œåˆ¤æ–­æœ€å°è¿‡æ»¤æ•°ï¼ˆé»˜è®¤1ï¼‰å’Œæœ€å°è¿‡æ»¤ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤0ï¼‰ï¼Œæœ€åå¯¹æ»¡è¶³æ¡ä»¶çš„æœåŠ¡å™¨åˆ™ä½¿ç”¨RoundRobinRule(è½®è¯¢æ–¹å¼)é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ã€‚ æˆ‘ä»¬å¯ä»¥å°†ä¸Šä¾‹ä¸­çš„message-serviceçš„è´Ÿè½½å‡è¡¡ç­–ç•¥è®¾ç½®ä¸ºéšæœºè®¿é—®RandomRuleï¼Œapplication.ymlé…ç½®å¦‚ä¸‹ï¼š message-service: ribbon: NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿ClientConfigEnabledRoundRobinRuleï¼Œæ¥å®ç°è‡ªå·±çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚ è‡ªå®šä¹‰Ribbonå®¢æˆ·ç«¯æ‚¨å¯ä»¥ä½¿ç”¨å¤–éƒ¨å±æ€§æŒ‰ç…§ ..= çš„æ ¼å¼å¯¹Ribbonå®¢æˆ·ç«¯çš„æŸäº›ç‰¹æ€§è¿›è¡Œé…ç½®ï¼Œè¿™ä¸ä½¿ç”¨Netflix APIç±»ä¼¼ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨Springbooté…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚æ‰€æœ‰çš„é…ç½®é¡¹å‡ä»¥é™æ€å­—æ®µçš„å½¢å¼å®šä¹‰åœ¨ CommonClientConfigKey ç±»ï¼ˆRibbonæ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼‰ä¸­ã€‚ SpringCloudè¿˜å…è®¸ä½ åœ¨RibbonClientConfigurationçš„åŸºç¡€ä¹‹ä¸Šä½¿ç”¨@RibbonClientå£°æ˜ä¸€äº›é¢å¤–é…ç½®ï¼Œä»è€Œå®ç°å¯¹Ribbonå®¢æˆ·ç«¯çš„å®Œå…¨æ§åˆ¶ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š import org.springframework.cloud.netflix.ribbon.RibbonClient; import org.springframework.cloud.netflix.ribbon.ZonePreferenceServerListFilter; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import com.netflix.loadbalancer.IPing; import com.netflix.loadbalancer.PingUrl; import com.pengjunlee.TestConfiguration.MessageConfiguration; @Configuration @RibbonClient(name = &quot;message-service&quot;, configuration = MessageConfiguration.class) public class TestConfiguration { @Configuration protected static class MessageConfiguration { @Bean public ZonePreferenceServerListFilter serverListFilter() { ZonePreferenceServerListFilter filter = new ZonePreferenceServerListFilter(); filter.setZone(&quot;myTestZone&quot;); return filter; } @Bean public IPing ribbonPing() { return new PingUrl(); } } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™ä¸ªRibbonå®¢æˆ·ç«¯å°†ç”±RibbonClientConfigurationå’ŒMessageConfigurationä¸­çš„ç»„ä»¶ä¸€èµ·ç»„æˆï¼ˆåè€…ä¼šè¦†ç›–å‰è€…çš„é…ç½®ï¼‰ã€‚ æ³¨æ„ï¼šæœ¬ä¾‹ä¸­ï¼ŒMessageConfigurationå¿…é¡»ç”¨@Configurationæ³¨è§£æ ‡æ³¨ï¼Œä½†æ˜¯å®ƒä¸åº”è¯¥è¢«åŒ…å«åœ¨Springçš„ç»„ä»¶æ‰«æè·¯å¾„ä¹‹ä¸­ï¼Œå¦åˆ™å®ƒå°†è¢«æ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯å…±äº«ã€‚å¦‚æœä½ ä½¿ç”¨@ComponentScanï¼ˆæˆ–è€…@SpringBootApplicationï¼‰ï¼Œé‚£ä¹ˆä½ åº”è¯¥é‡‡å–æªæ–½æ¥é¿å…å®ƒè¢«åŒ…å«åˆ°æ‰«æèŒƒå›´ä¹‹ä¸­ã€‚ ä¸‹è¡¨åˆ—å‡ºäº† Spring Cloud Netflix ç¼ºçœä¸ºRibbonæä¾›çš„æ‰€æœ‰ Beanï¼š åˆ›å»ºè¿™äº›ç±»å‹çš„ä¸€ä¸ªBean å¹¶å°†å®ƒå†™åˆ° @RibbonClient å£°æ˜çš„é…ç½®ä¸­ï¼Œè¿™æ ·ä½ å°±èƒ½å¤Ÿå¯¹è¿™äº›Beanä¸­çš„æ¯ä¸€ä¸ªè¿›è¡Œé‡å†™ã€‚ä¾‹å¦‚ä¸Šé¢çš„ MessageConfiguration ä¸­åˆ©ç”¨PingUrlæ›¿ä»£äº†NoOpPingå¹¶æä¾›äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„serverListFilterã€‚ è‡ªå®šä¹‰Ribbonå®¢æˆ·ç«¯çš„é»˜è®¤é…ç½®é€šè¿‡@RibbonClientsæ³¨è§£å¯ä»¥ä¸ºæ‰€æœ‰çš„Ribbonå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªé»˜è®¤çš„é…ç½®ã€‚ä¾‹å¦‚ import org.springframework.cloud.netflix.ribbon.RibbonClients; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import com.netflix.client.config.IClientConfig; import com.netflix.loadbalancer.BestAvailableRule; import com.netflix.loadbalancer.ConfigurationBasedServerList; import com.netflix.loadbalancer.IPing; import com.netflix.loadbalancer.IRule; import com.netflix.loadbalancer.PingUrl; import com.netflix.loadbalancer.Server; import com.netflix.loadbalancer.ServerList; import com.netflix.loadbalancer.ServerListSubsetFilter; @RibbonClients(defaultConfiguration = DefaultRibbonConfig.class) public class RibbonClientDefaultConfigurationTestsConfig { public static class BazServiceList extends ConfigurationBasedServerList { public BazServiceList(IClientConfig config) { super.initWithNiwsConfig(config); } } } @Configuration class DefaultRibbonConfig { @Bean public IRule ribbonRule() { return new BestAvailableRule(); } @Bean public IPing ribbonPing() { return new PingUrl(); } @Bean public ServerList&lt;Server&gt; ribbonServerList(IClientConfig config) { return new RibbonClientDefaultConfigurationTestsConfig.BazServiceList(config); } @Bean public ServerListSubsetFilter serverListFilter() { ServerListSubsetFilter filter = new ServerListSubsetFilter(); return filter; } } é€šè¿‡é…ç½®å±æ€§è‡ªå®šä¹‰Ribbonå®¢æˆ·ç«¯Spring Cloud Netflix ä»1.2.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒé€šè¿‡é…ç½®å±æ€§è‡ªå®šä¹‰Ribbonå®¢æˆ·ç«¯ï¼Œè¿™å¯ä»¥è®©ä½ åœ¨åº”ç”¨å¯åŠ¨æ—¶æ ¹æ®ä¸åŒçš„ç¯å¢ƒæ¥æ”¹å˜Ribbonçš„è¡Œä¸ºã€‚ æ”¯æŒé…ç½®çš„å±æ€§åˆ—è¡¨å¦‚ä¸‹ï¼š &lt;clientName&gt;.ribbon.NFLoadBalancerClassName: éœ€å®ç° ILoadBalancer &lt;clientName&gt;.ribbon.NFLoadBalancerRuleClassName: éœ€å®ç° IRule &lt;clientName&gt;.ribbon.NFLoadBalancerPingClassName: éœ€å®ç° IPing &lt;clientName&gt;.ribbon.NIWSServerListClassName: éœ€å®ç° ServerList &lt;clientName&gt;.ribbon.NIWSServerListFilterClassName: éœ€å®ç° ServerListFilter æ³¨æ„ï¼šé€šè¿‡é…ç½®å±æ€§å®šä¹‰çš„ç±»ä¸ä¸Šè¿°@RibbonClienté…ç½®ç±»ä¸­å®šä¹‰çš„Beanä»¥åŠSpring Cloud Netflix æä¾›çš„ç¼ºçœé…ç½®ç›¸æ¯”å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ ä¾‹å¦‚å¯¹ message-service æœåŠ¡çš„ IRule å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥åœ¨application.ymlä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š message-service: ribbon: NIWSServerListClassName: com.netflix.loadbalancer.ConfigurationBasedServerList NFLoadBalancerRuleClassName: com.netflix.loadbalancer.WeightedResponseTimeRule è„±ç¦»Eurekaä½¿ç”¨RibbonEurekaæä¾›äº†ä¸€ç§æŠ½è±¡çš„å‘ç°è¿œç¨‹æœåŠ¡çš„ä¾¿æ·çš„æ–¹å¼ï¼Œè¿™æ ·ä½ å°±ä¸å¿…åœ¨å®¢æˆ·ç«¯ä¸­ç¡¬ç¼–ç æœåŠ¡åœ°å€åˆ—è¡¨ï¼Œä½†æ˜¯å¦‚æœä½ ä¸ç”¨Eurekaï¼Œä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨Ribbonå’ŒFeignã€‚å‡è®¾åœ¨ä¸ä½¿ç”¨Eurekaï¼Œä½ ç”¨@RibbonClientå£°æ˜äº†ä¸€ä¸ªâ€storesâ€æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™Ribbon Client é»˜è®¤ä¼šå¼•ç”¨ä¸€ä¸ªé…ç½®å¥½çš„æœåŠ¡åˆ—è¡¨ï¼Œä½ å¯ä»¥åœ¨application.ymlä¸­å¯¹å®ƒè¿›è¡Œé…ç½®ï¼š stores: ribbon: listOfServers: example.com,google.com åœ¨Ribbonä¸­ç¦ç”¨Eurekaé€šè¿‡å°† ribbon.eureka.enabled å±æ€§è®¾ç½®ä¸º false å¯ä»¥åœ¨Ribbonä¸­ç¦ç”¨Eurekaã€‚ ribbon: eureka: enabled: false Ribbonç¼“å­˜é…ç½®å¯¹äºæ¯ä¸€ä¸ªRibbonå®¢æˆ·ç«¯ï¼ŒSpring Cloudéƒ½ä¼šç»´æŠ¤ä¸€ä¸ªä¸å…¶ç›¸åº”çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ä¼šåœ¨ç›¸åº”æœåŠ¡ç¬¬ä¸€æ¬¡è¢«è¯·æ±‚æ—¶è¿›è¡Œæ‡’åŠ è½½ã€‚ä½ å¯ä»¥ä½¿ç”¨é¥¥é¥¿åŠ è½½æ¥å–ä»£æ‡’åŠ è½½ï¼Œé€šè¿‡æŒ‡å®šé‚£äº›éœ€è¦é¥¥é¥¿åŠ è½½Ribbonå®¢æˆ·ç«¯åç§°ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶å°±å¯¹å…¶åº”ç”¨ä¸Šä¸‹æ–‡è¿›è¡ŒåŠ è½½ã€‚ ribbon: eager-load: enabled: true clients: client1, client2, client3 å‚è€ƒæ–‡ç« https://www.jianshu.com/p/d32ae141f680 https://blog.csdn.net/u014401141/article/details/78676296 https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.0.2.RELEASE/single/spring-cloud-netflix.html#spring-cloud-ribbon","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ","slug":"SpringCloudä¹‹--EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ","date":"2020-05-31T08:42:38.000Z","updated":"2023-04-30T10:21:41.364Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ/","excerpt":"","text":"Spring Cloudæ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„é›†åˆï¼Œå®ƒåˆ©ç”¨Spring Bootçš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œæ„å»ºäº†æœåŠ¡æ²»ç†(æœåŠ¡æ³¨å†Œä¸å‘ç°)ã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ã€åˆ†å¸ƒå¼ä¼šè¯å’Œé›†ç¾¤çŠ¶æ€ç®¡ç†ç­‰åŠŸèƒ½ï¼Œä¸ºæˆ‘ä»¬æä¾›ä¸€æ•´å¥—ä¼ä¸šçº§åˆ†å¸ƒå¼äº‘åº”ç”¨çš„å®Œç¾è§£å†³æ–¹æ¡ˆã€‚ Spring Cloudçš„æœåŠ¡æ²»ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ä¸»è¦æ˜¯é€šè¿‡Spring Cloud Netflixçš„ç›¸å…³äº§å“æ¥å®ç°ï¼ŒåŒ…æ‹¬ï¼šæœåŠ¡å‘ç°ï¼ˆEurekaï¼‰ã€æ–­è·¯å™¨ï¼ˆHystrixï¼‰ã€æ™ºèƒ½è·¯ç”±ï¼ˆZuulï¼‰å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰ã€‚ æœ¬æ–‡ä¸»è¦å¯¹å¦‚ä½•ä½¿ç”¨Eurekaæ­å»ºæœåŠ¡æ³¨å†Œä¸­å¿ƒè¿›è¡Œä»‹ç»ï¼Œæˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„å•æœºæ¨¡å¼EurekaæœåŠ¡å™¨æ­å»ºå¼€å§‹ã€‚ å…³äºSpringCloudç‰ˆæœ¬ç”±äºSpring Cloudæ˜¯è¯¸å¤šå­é¡¹ç›®é›†åˆçš„ç»¼åˆé¡¹ç›®ï¼ŒåŸåˆ™ä¸Šç”±å…¶å­é¡¹ç›®ç»´æŠ¤è‡ªå·±çš„å‘å¸ƒç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç‰ˆæœ¬å·ï¼Œå¦‚:1.2.3.RELEASEã€1.1.4.RELEASEç­‰ã€‚å› æ­¤Spring Cloudä¸ºäº†é¿å…ç‰ˆæœ¬å·ä¸å…¶å­é¡¹ç›®çš„ç‰ˆæœ¬å·æ··æ·†ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨ç‰ˆæœ¬å·çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨å‘½åçš„æ–¹å¼ã€‚è¿™äº›ç‰ˆæœ¬åç§°é‡‡ç”¨äº†ä¼¦æ•¦åœ°é“ç«™çš„åå­—ï¼Œæ ¹æ®å­—æ¯è¡¨çš„é¡ºåºæ¥å¯¹åº”ç‰ˆæœ¬æ—¶é—´é¡ºåºã€‚æ¯”å¦‚ï¼Œæœ€æ—©çš„Releaseç‰ˆæœ¬åç§°ä¸ºAngelï¼Œç¬¬äºŒä¸ªReleaseç‰ˆæœ¬çš„åç§°ä¸ºBrixtonï¼Œä»¥æ­¤ç±»æ¨â€¦â€¦ã€‚è€Œæˆ‘ä»¬åœ¨æœ¬ç³»åˆ—æ–‡ç« æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬åç§°ä¸º:Finchley.SR2ï¼Œä¹Ÿå°±æ˜¯ç›®å‰çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå…¶ä¸­çš„SRæ˜¯service releasesçš„ç®€å†™ï¼Œè€Œ1åˆ™æ˜¯è¯¥ç‰ˆæœ¬åç§°ä¸­çš„ç¬¬1ä¸ªç‰ˆæœ¬ã€‚å…¶å¯¹åº”çš„Springbootç‰ˆæœ¬ä¸º2.0.6.RELEASEã€‚ å…³äºæ›´å¤šç‰ˆæœ¬çš„ä»‹ç»ï¼Œè¯·å‚è€ƒå®˜ç½‘ã€‚ å•æœºæ¨¡å¼Eurekaæ³¨å†Œä¸­å¿ƒå¼•å…¥Eureka-Serverä¾èµ–æ–°å»ºä¸€ä¸ª Maven å·¥ç¨‹ï¼Œå¹¶åœ¨å…¶pom.xmlæ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–ï¼Œå†…å®¹å¦‚ä¸‹ï¼š &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;properties&gt; &lt;spring-cloud.version&gt;Finchley.SR2&lt;/spring-cloud.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- Eureka-Server ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;dependencyManagement&gt; &lt;dependencies&gt; &lt;!-- SpringCloud ç‰ˆæœ¬æ§åˆ¶ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt; &lt;version&gt;${spring-cloud.version}&lt;/version&gt; &lt;type&gt;pom&lt;/type&gt; &lt;scope&gt;import&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/dependencyManagement&gt; åˆ›å»ºå¯åŠ¨ç±»import org.springframework.boot.WebApplicationType; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.builder.SpringApplicationBuilder; import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer; @SpringBootApplication @EnableEurekaServer public class EurekaServerApplication { public static void main(String[] args) { new SpringApplicationBuilder(EurekaServerApplication.class).web(WebApplicationType.SERVLET).run(args); } } æ·»åŠ é…ç½®é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªEurekaæœåŠ¡ç«¯åŒæ—¶ä¹Ÿæ˜¯Eurekaå®¢æˆ·ç«¯ï¼Œä½ éœ€è¦ä¸ºå®ƒæä¾›ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰service-url è®©å®ƒç”¨æ¥å®šä½å®ƒçš„åŒç±»ï¼ˆå…¶ä»–EurekaæœåŠ¡ç«¯ï¼‰ï¼Œå¦‚æœä½ ä¸€ä¸ªservice-url éƒ½ä¸æä¾›ï¼ŒæœåŠ¡è™½ç„¶èƒ½å¤Ÿè¿è¡Œå¹¶ä¸”æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯å®ƒä¼šåœ¨ä½ çš„æ—¥å¿—æ–‡ä»¶ä¸­æ’å…¥å¾ˆå¤šç”±äºå®ƒä¸èƒ½æˆåŠŸæ³¨å†Œåˆ°åŒç±»è€Œç”Ÿæˆçš„å™ªéŸ³æ—¥å¿—ã€‚ åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œä¸¤ä¸ªEurekaï¼ˆä¸€ä¸ªæœåŠ¡ç«¯å’Œä¸€ä¸ªå®¢æˆ·ç«¯ï¼‰é€šè¿‡æ³¨å†Œè¡¨åˆå¹¶å’Œå¿ƒè·³ç›‘æ§èƒ½å¤Ÿè®©ä¸€ä¸ªç‹¬ç«‹çš„EurekaæœåŠ¡ç«¯ä»æ•…éšœä¸­å®Œç¾å¤æ´»ï¼ˆåªè¦è¿˜æœ‰ç›‘æ§æˆ–è€…å¼¹æ€§è¿è¡Œç¯å¢ƒä½¿å®ƒä¿æŒå­˜æ´»ï¼‰ã€‚åœ¨å•æœºæ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦å…³é—­Eurekaçš„è¿™äº›å®¢æˆ·ç«¯è¡Œä¸ºï¼Œè¿™æ ·çš„è¯å®ƒå°±ä¸ä¼šå†ä¸åœåœ°å»å°è¯•è¿æ¥å®ƒçš„åŒç±»å¹¶ä¸åœåœ°å¤±è´¥äº†ã€‚ åœ¨ Springbootçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ application.yml ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®æ¥å…³é—­Eurekaçš„å®¢æˆ·ç«¯è¡Œä¸ºï¼š server: port: 8761 eureka: instance: hostname: localhost client: registerWithEureka: false fetchRegistry: false serviceUrl: defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ å…¶ä¸­fetch-registryå’Œregister-with-eurekaä¸¤ä¸ªé…ç½®ç”¨æ¥å…³é—­Eurekaçš„å®¢æˆ·ç«¯è¡Œä¸ºã€‚ fetch-registryï¼šè¡¨ç¤ºæ˜¯å¦ä»eureka serverè·å–æ³¨å†Œè¡¨ä¿¡æ¯ï¼Œå¦‚æœæ˜¯å•ä¸€èŠ‚ç‚¹ï¼Œä¸éœ€è¦åŒæ­¥å…¶ä»–eureka serverèŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸ºfalseï¼›è‹¥æ˜¯é›†ç¾¤ï¼Œåˆ™è®¾ç½®ä¸ºtrueï¼Œé»˜è®¤ä¸ºtrueã€‚ register-with-eurekaï¼šè¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°eureka serverï¼Œé»˜è®¤ä¸ºtrueã€‚ é«˜å¯ç”¨Eurekaæ³¨å†Œä¸­å¿ƒç”±äºEurekaæœåŠ¡ç«¯æ²¡æœ‰åå°å­˜å‚¨ï¼Œä½†æ˜¯æ‰€æœ‰çš„æœåŠ¡å®ä¾‹éƒ½éœ€è¦ä¸æ–­åœ°å‘EurekaæœåŠ¡ç«¯å‘é€å¿ƒè·³æ¥æ›´æ–°å®ƒä»¬åœ¨æ³¨å†Œè¡¨ä¸­çš„çŠ¶æ€ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸€ç³»åˆ—çš„åŠŸèƒ½åªèƒ½åœ¨å†…å­˜ä¸­å®Œæˆçš„ã€‚åŒæ—¶ï¼Œæ¯ä¸€ä¸ªEurekaå®¢æˆ·ç«¯éƒ½æœ‰ä¸€ä¸ªå†…å­˜ç¼“å­˜å­˜å‚¨äº†Eurekaçš„æ³¨å†Œè¡¨ä¿¡æ¯ï¼Œå¯¹æœåŠ¡çš„è¯·æ±‚å¯ä»¥ç›´æ¥ä»ç¼“å­˜çš„æ³¨å†Œè¡¨ä¸­è·å–ï¼Œå¹¶ä¸éœ€è¦æ¯ä¸€æ¬¡éƒ½åˆ°Eurekaæ³¨å†Œè¡¨ä¸­å»è·å–ã€‚ ä½ å¯ä»¥æ·»åŠ å¤šä¸ªåŒç±»Eurekaå®ä¾‹åˆ°ä½ çš„ç³»ç»Ÿä¸­ï¼Œåªè¦å®ƒä»¬å½¼æ­¤ä¹‹é—´èƒ½å¤Ÿç›¸äº’è¿æ¥ï¼Œå®ƒä»¬å°±èƒ½å¤Ÿåœ¨å½¼æ­¤ä¹‹é—´è¿›è¡Œæ³¨å†Œè¡¨åŒæ­¥ï¼Œè¿™èƒ½å¤Ÿè®©Eurekaå…·æœ‰æ›´é«˜çš„å¼¹æ€§å’Œå¯ç”¨æ€§ã€‚äº‹å®ä¸Šï¼Œè¿™ä¹Ÿæ˜¯Eurekaçš„é»˜è®¤è¡Œä¸ºï¼Œæ‰€ä»¥ä½ å”¯ä¸€è¦åšçš„å°±æ˜¯é…ç½®ä¸€ä¸ªæœ‰æ•ˆçš„åŒç±»serviceUrl æ¥ä½¿å®ƒç”Ÿæ•ˆã€‚ åŒèŠ‚ç‚¹æ³¨å†Œä¸­å¿ƒä¿®æ”¹é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸Šä¾‹ä¸­çš„application.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š --- server: port: 8761 spring: profiles: peer1 application: name: eureka-server eureka: instance: hostname: peer1 client: serviceUrl: defaultZone: http://peer2:8762/eureka/ --- server: port: 8762 spring: profiles: peer2 application: name: eureka-server eureka: instance: hostname: peer2 client: serviceUrl: defaultZone: http://peer1:8761/eureka/ æœ‰äº†è¿™ä¸ªYAMLæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨ä¸€å°æœåŠ¡å™¨ä¸Šé€šè¿‡åœ¨å¯åŠ¨æ—¶æŒ‡å®šä¸åŒçš„Spring profileæ¥æ¨¡æ‹Ÿå¯åŠ¨ä¸¤ä¸ªä¸»æœºï¼ˆpeer1å’Œpeer2ï¼‰äº†ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ æ˜¯åœ¨ä¸€ä¸ªçŸ¥æ™“è‡ªå·±ä¸»æœºåï¼ˆé»˜è®¤ä¸»æœºæ˜¯é€šè¿‡java.net.InetAddress è¿›è¡ŒæŸ¥æ‰¾ï¼‰çš„æœåŠ¡å™¨ä¸Šè¿è¡Œç¨‹åºï¼Œeureka.instance.hostnameé…ç½®é¡¹å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚ ä¿®æ”¹hostsæ–‡ä»¶ä¿®æ”¹Windowsç³»ç»Ÿçš„hostsæ–‡ä»¶: # Windowsï¼šC:\\Windows\\System32\\drivers\\etc\\hosts # Linuxï¼š/etc/hosts åœ¨hostsæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š 127.0.0.1 peer1 127.0.0.1 peer2 127.0.0.1 peer3 å¯åŠ¨æµ‹è¯•å³é”®--&gt;Run As --&gt; Run Configurations...ï¼Œåˆ†åˆ«ä»¥peer1å’Œpeeer2 é…ç½®ä¿¡æ¯å¯åŠ¨EurekaServerApplicationã€‚ --spring.profiles.active=peer1 --spring.profiles.active=peer2 ä¾æ¬¡å¯åŠ¨å®Œæˆåï¼Œæµè§ˆå™¨è¾“å…¥ï¼š&lt;http://peer1:8761/&gt; æ•ˆæœå›¾å¦‚ä¸‹ï¼š å¤šèŠ‚ç‚¹æ³¨å†Œä¸­å¿ƒä¿®æ”¹é…ç½®æ–‡ä»¶åœ¨ç”Ÿäº§ä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸‰å°æˆ–è€…å¤§äºä¸‰å°çš„æ³¨å†Œä¸­å¿ƒæ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ï¼Œé…ç½®çš„åŸç†å…¶å®éƒ½ä¸€æ ·ï¼Œå°†æ³¨å†Œä¸­å¿ƒåˆ†åˆ«æŒ‡å‘å…¶å®ƒçš„æ³¨å†Œä¸­å¿ƒã€‚è¿™é‡Œåªä»‹ç»ä¸‰å°é›†ç¾¤çš„é…ç½®æƒ…å†µï¼Œå…¶å®å’ŒåŒèŠ‚ç‚¹çš„æ³¨å†Œä¸­å¿ƒç±»ä¼¼ï¼Œä¿®æ”¹ä¸Šä¾‹ä¸­çš„application.ymlæ–‡ä»¶ï¼Œå†æ·»åŠ ä¸€ä¸ª profiles é…ç½®ï¼Œå†…å®¹å¦‚ä¸‹ï¼š --- server: port: 8761 spring: profiles: peer1 application: name: eureka-server eureka: instance: hostname: peer1 client: serviceUrl: defaultZone: http://peer2:8762/eureka/,http://peer3:8763/eureka/ --- server: port: 8762 spring: profiles: peer2 application: name: eureka-server eureka: instance: hostname: peer2 client: serviceUrl: defaultZone: http://peer1:8761/eureka/,http://peer3:8763/eureka/ --- server: port: 8763 spring: profiles: peer3 application: name: eureka-server eureka: instance: hostname: peer3 client: serviceUrl: defaultZone: http://peer1:8761/eureka/,http://peer2:8762/eureka/ å¯åŠ¨æµ‹è¯•åˆ†åˆ«åŠ è½½ä¸‰ä¸ªprofilesçš„é…ç½®å¯åŠ¨EurekaServerApplicationã€‚ å¸¸è§é—®é¢˜EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEYâ€™RE NOT. RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE. å‡ºç°åŸå› ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†é˜²æ­¢ç”±äºç½‘ç»œé—®é¢˜è€Œé€ æˆçš„å·²ç»æ­£å¸¸å¯åŠ¨çš„Eurekaå®ä¾‹æ— æ³•æˆåŠŸæ³¨å†Œï¼ŒEurekaä¼šå¼€å¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œè¿™æ ·å³ä½¿Eurekaå®ä¾‹ç»­çº¦å¤±è´¥ä¹Ÿä¸ä¼šä»å¯ç”¨åˆ—è¡¨ä¸­è¢«å‰”é™¤ï¼Œå¯ç»§ç»­ä»æ³¨å†Œè¡¨ä¸­è¿”å›å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚ è§£å†³åŠæ³•ï¼šå…³é—­è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå°†é…ç½® eureka.server.enable-self-preservation è®¾ç½®ä¸º false ã€‚å…³é—­è‡ªæˆ‘ä¿æŠ¤ä¹‹åï¼Œæç¤ºä¿¡æ¯å°†å˜ä¸ºå¦‚ä¸‹å†…å®¹ï¼š THE SELF PRESERVATION MODE IS TURNED OFF.THIS MAY NOT PROTECT INSTANCE EXPIRY IN CASE OF NETWORK/OTHER PROBLEMS. å‚è€ƒæ–‡ç« https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.0.2.RELEASE/single/spring-cloud-netflix.html https://www.jianshu.com/p/d32ae141f680 http://spring.io/projects/spring-cloud","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"SpringCloudç³»åˆ—ä¹‹--CAPå®šç†","slug":"SpringCloudä¹‹--CAPå®šç†","date":"2020-05-31T08:41:38.000Z","updated":"2023-04-30T10:21:41.364Z","comments":true,"path":"2020/05/31/SpringCloudä¹‹--CAPå®šç†/","link":"","permalink":"/2020/05/31/SpringCloudä¹‹--CAPå®šç†/","excerpt":"","text":"å®šç†ç®€ä»‹1998å¹´ï¼ŒåŠ å·å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦å®¶ Eric Brewer æå‡ºäº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸‰ä¸ªæŒ‡æ ‡ï¼š Cï¼šConsistencyï¼Œä¸€è‡´æ€§ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»å…·æœ‰åŒæ ·çš„å€¼ï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶åˆ»è¯»å–çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„æ•°æ®å‰¯æœ¬ï¼ˆall nodes see the same data at the same timeï¼‰ã€‚ Aï¼šAvailability ï¼Œå¯ç”¨æ€§ï¼Œå¥½çš„å“åº”æ€§èƒ½ã€‚å®Œå…¨çš„å¯ç”¨æ€§æŒ‡çš„æ˜¯åœ¨ä»»ä½•æ•…éšœæ¨¡å‹ä¸‹ï¼ŒæœåŠ¡éƒ½ä¼šåœ¨æœ‰é™çš„æ—¶é—´å†…å¤„ç†å®Œæˆå¹¶è¿›è¡Œå“åº”ï¼ˆReads and writes always succeedï¼‰ã€‚ Pï¼šPartition Tolerance ï¼Œåˆ†åŒºå®¹é”™æ€§ï¼Œå³åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°æŸäº›èŠ‚ç‚¹æˆ–ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§æˆ–å¯ç”¨æ€§çš„æœåŠ¡ã€‚åˆ†åŒºå®¹é”™æ€§è¦æ±‚ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰æŸä¸€ä¸ªæˆ–è€…å‡ ä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå…¶ä»–å‰©ä¸‹çš„èŠ‚ç‚¹è¿˜èƒ½å¤Ÿæ­£å¸¸è¿è½¬å¹¶å¯¹å¤–æä¾›æœåŠ¡ï¼Œå¯¹äºç”¨æˆ·è€Œè¨€å¹¶æ²¡æœ‰ä»€ä¹ˆä½“éªŒä¸Šçš„å½±å“ã€‚ Eric Brewer æŒ‡å‡ºä»»ä½•åˆ†å¸ƒå¼ç³»ç»Ÿåªå¯åŒæ—¶æ»¡è¶³CAPä¸‰ä¸ªæŒ‡æ ‡ä¸­çš„ä¸¤ä¸ªï¼Œæ— æ³•ä¸‰è€…å…¼é¡¾ï¼Œè¿™ä¸ªç»“è®ºå°±å«åš CAP å®šç†ã€‚ å®šç†è§£è¯»åˆ†å¸ƒå¼çš„æœåŠ¡åŒ–ç³»ç»Ÿéƒ½éœ€è¦æ»¡è¶³åˆ†åŒºå®¹å¿æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»åœ¨ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚åœ¨ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿæ—¶ï¼Œä¸¤ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¹‹é—´æ— æ³•è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œçš„ä¿®æ”¹æ“ä½œå°†æ— æ³•åŒæ­¥åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆCï¼‰å°†æ— æ³•æ»¡è¶³ï¼Œå› ä¸ºä¸¤ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ•°æ®ä¸å†ä¿æŒä¸€è‡´ã€‚é™¤éæˆ‘ä»¬ç‰ºç‰²å¯ç”¨æ€§ï¼ˆAï¼‰ï¼Œä¹Ÿå°±æ˜¯åœ¨ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿæ—¶ï¼Œæš‚åœåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹å¤–æä¾›ä¿®æ”¹æ•°æ®æœåŠ¡ï¼Œç›´åˆ°ç½‘ç»œçŠ¶å†µå®Œå…¨æ¢å¤æ­£å¸¸å†ç»§ç»­å¯¹å¤–æä¾›ä¿®æ”¹æ•°æ®æœåŠ¡ã€‚ CPæ»¡è¶³çš„æƒ…å†µä¸‹ï¼ŒAä¸èƒ½æ»¡è¶³çš„åŸå› ï¼šè‹¥è¦æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼‰å°±éœ€è¦åœ¨å¤šä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œåœ¨æ•°æ®åŒæ­¥å®Œæˆä¹‹å‰æ•´ä¸ªç³»ç»Ÿéƒ½å°†ä¸å¯ç”¨ã€‚èŠ‚ç‚¹æ•°é‡è¶Šå¤šåˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰è¶Šå¥½ï¼ŒåŒæ—¶æ•°æ®åŒæ­¥æ‰€è€—è´¹çš„æ—¶é—´è‡ªç„¶ä¹Ÿå°±è¶Šé•¿ï¼Œä»è€Œæ— æ³•åœ¨æœ‰é™çš„æ—¶é—´å†…å®Œæˆè¯·æ±‚å“åº”ï¼Œå¯¼è‡´å¯ç”¨æ€§ï¼ˆAï¼‰ä¸èƒ½æ»¡è¶³ã€‚ CAæ»¡è¶³çš„æƒ…å†µä¸‹ï¼ŒPä¸èƒ½æ»¡è¶³çš„åŸå› ï¼šè‹¥è¦æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼‰å°±éœ€è¦åœ¨å¤šä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œåœ¨æ•°æ®åŒæ­¥å®Œæˆä¹‹å‰æ•´ä¸ªç³»ç»Ÿéƒ½å°†ä¸å¯ç”¨ã€‚éœ€åŒæ­¥çš„èŠ‚ç‚¹æ•°é‡è¶Šå¤šï¼Œæ•°æ®åŒæ­¥æ‰€éœ€è€—è´¹çš„æ—¶é—´è¶Šé•¿ï¼Œå¯ç”¨æ€§ï¼ˆAï¼‰ä¹Ÿè¶Šå·®ã€‚è‹¥è¦åŒæ—¶ä¿è¯å¯ç”¨æ€§ï¼ˆAï¼‰ï¼Œé‚£ä¹ˆéœ€åŒæ­¥çš„èŠ‚ç‚¹æ•°é‡å°±éœ€è¦å°½é‡å‡å°‘ï¼Œä»è€Œå¯¼è‡´åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰æ— æ³•æ»¡è¶³ã€‚ APæ»¡è¶³çš„æƒ…å†µä¸‹ï¼ŒCä¸èƒ½æ»¡è¶³çš„åŸå› ï¼šèŠ‚ç‚¹çš„æ•°é‡è¶Šå¤šï¼Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰è¶Šå¥½ï¼ŒèŠ‚ç‚¹é—´æ•°æ®åŒæ­¥æ‰€éœ€è€—è´¹çš„æ—¶é—´è¶Šé•¿ï¼Œè‹¥è¦åœ¨æœ‰é™çš„æ—¶é—´å†…å®Œæˆè¯·æ±‚å“åº”å³ä¿è¯å¯ç”¨æ€§ï¼ˆAï¼‰ï¼Œé‚£ä¹ˆæ•°æ®å°±å¯èƒ½ä¸èƒ½åŠæ—¶åœ°åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œä»è€Œæ— æ³•ä¿è¯èŠ‚ç‚¹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰ã€‚ å¦‚ä½•æŠ‰æ‹©å¯¹äºç°å¦‚ä»Šå¤§å¤šæ•°çš„äº’è”ç½‘åº”ç”¨åœºæ™¯ï¼Œéƒ½å€¾å‘äºé‡‡ç”¨åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œå®ƒä»¬é€šå¸¸èŠ‚ç‚¹ä¼—å¤šã€éƒ¨ç½²ç›¸å¯¹åˆ†æ•£ï¼Œéšç€é›†ç¾¤è§„æ¨¡å˜å¾—è¶Šæ¥è¶Šå¤§ï¼ŒèŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœå·²æ˜¯å¸¸æ€ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºé‚£äº›å¯¹æ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚ç”µå•†ç³»ç»Ÿï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰ï¼Œå¯¹äºæ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰é€€è€Œæ±‚å…¶æ¬¡ä»…ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§å³å¯ã€‚è¿™è™½ç„¶ä¼šæŸäº›åœ°æ–¹å½±å“å®¢æˆ·ä½“éªŒï¼Œä½†å¹¶ä¸ä¼šè¾¾åˆ°é€ æˆç”¨æˆ·æµå¤±çš„ä¸¥é‡ç¨‹åº¦ã€‚ å¯¹äºåƒé“¶è¡Œç³»ç»Ÿè¿™ç±»å¯¹æ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œæ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰å¿…é¡»ä¿è¯ã€‚ç½‘ç»œå‘ç”Ÿæ•…éšœå®å¯åœæ­¢æœåŠ¡ï¼ˆæˆ–è€…åªè¯»ä¸å†™ï¼‰ï¼Œè¿™æ˜¯ä¿è¯åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰å’Œæ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼Œèˆå¼ƒå¯ç”¨æ€§ï¼ˆAï¼‰ã€‚ ç›®å‰æ¯”è¾ƒä¸»æµçš„æ³¨å†Œä¸­å¿ƒæœ‰ Zookeeperã€Eurekaã€Consulã€Etcd ç­‰ï¼Œä»¥Zookeeper å’ŒEurekaä¸ºä¾‹ï¼Œ åœ¨è¿›è¡Œæ³¨å†Œä¸­å¿ƒé€‰æ‹©æ—¶ï¼ŒCAPåˆè¯¥å¦‚ä½•æŠ‰æ‹©å‘¢ï¼Ÿ Zookeeperï¼šCPè®¾è®¡ï¼Œä¿è¯äº†ä¸€è‡´æ€§ï¼Œé›†ç¾¤æ­å»ºçš„æ—¶å€™ï¼ŒæŸä¸ªèŠ‚ç‚¹å¤±æ•ˆï¼Œåˆ™ä¼šè¿›è¡Œé€‰ä¸¾æ–°çš„Leaderï¼Œæˆ–è€…åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ™æ— æ³•æä¾›æœåŠ¡ï¼Œå› æ­¤å¯ç”¨æ€§ï¼ˆAï¼‰æ²¡æ³•æ»¡è¶³ã€‚ Eurekaï¼šAPè®¾è®¡ï¼Œæ— ä¸»ä»èŠ‚ç‚¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œè‡ªåŠ¨åˆ‡æ¢å…¶ä»–èŠ‚ç‚¹ç»§ç»­ä½¿ç”¨ï¼Œå»ä¸­å¿ƒåŒ–ï¼Œä½†æ•°æ®ä¸€è‡´æ€§ï¼ˆCï¼‰ä¸æ»¡è¶³ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰è‚¯å®šè¦æ»¡è¶³ï¼Œæ‰€ä»¥åªèƒ½åœ¨CAä¸­äºŒé€‰ä¸€ï¼Œ æ²¡æœ‰æœ€å¥½çš„é€‰æ‹©ï¼Œåªæœ‰æ›´é€‚åˆçš„ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯æ¥è¿›è¡Œæ¶æ„è®¾è®¡ï¼š å¦‚æœè¦æ±‚ä¸€è‡´æ€§ï¼Œåˆ™é€‰æ‹© Zookeeperï¼Œå¦‚é‡‘èè¡Œä¸š å¦‚æœè¦æ±‚å¯ç”¨æ€§ï¼Œåˆ™é€‰æ‹© Eurekaï¼Œå¦‚ç”µå•†ç³»ç»Ÿ","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"SpringCloud,Java,SpringBoot","slug":"SpringCloud-Java-SpringBoot","permalink":"/tags/SpringCloud-Java-SpringBoot/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨","slug":"æ·±å…¥ç†è§£JVMä¹‹--çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨","date":"2020-05-30T09:53:38.000Z","updated":"2023-04-30T10:21:41.373Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨/","excerpt":"","text":"è½¬è½½è‡ªï¼šã€Šæ·±å…¥ç†è§£Javaç±»åŠ è½½å™¨(2)ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‹ ä¸€ã€çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆcontext class loaderï¼‰æ˜¯ä» JDK 1.2 å¼€å§‹å¼•å…¥çš„ã€‚ç±» java.lang.Threadä¸­çš„æ–¹æ³• getContextClassLoader()å’Œ setContextClassLoader(ClassLoader cl)ç”¨æ¥è·å–å’Œè®¾ç½®çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡ setContextClassLoader(ClassLoader cl)æ–¹æ³•è¿›è¡Œè®¾ç½®çš„è¯ï¼Œçº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚Java åº”ç”¨è¿è¡Œçš„åˆå§‹çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç å¯ä»¥é€šè¿‡æ­¤ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»å’Œèµ„æºã€‚ å‰é¢æåˆ°çš„ç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼å¹¶ä¸èƒ½è§£å†³ Java åº”ç”¨å¼€å‘ä¸­ä¼šé‡åˆ°çš„ç±»åŠ è½½å™¨çš„å…¨éƒ¨é—®é¢˜ã€‚Java æä¾›äº†å¾ˆå¤šæœåŠ¡æä¾›è€…æ¥å£ï¼ˆService Provider Interfaceï¼ŒSPIï¼‰ï¼Œå…è®¸ç¬¬ä¸‰æ–¹ä¸ºè¿™äº›æ¥å£æä¾›å®ç°ã€‚å¸¸è§çš„ SPI æœ‰ JDBCã€JCEã€JNDIã€JAXP å’Œ JBI ç­‰ã€‚è¿™äº› SPI çš„æ¥å£ç”± Java æ ¸å¿ƒåº“æ¥æä¾›ï¼Œå¦‚ JAXP çš„ SPI æ¥å£å®šä¹‰åŒ…å«åœ¨ javax.xml.parsersåŒ…ä¸­ã€‚è¿™äº› SPI çš„å®ç°ä»£ç å¾ˆå¯èƒ½æ˜¯ä½œä¸º Java åº”ç”¨æ‰€ä¾èµ–çš„ jar åŒ…è¢«åŒ…å«è¿›æ¥ï¼Œå¯ä»¥é€šè¿‡ç±»è·¯å¾„ï¼ˆCLASSPATHï¼‰æ¥æ‰¾åˆ°ï¼Œå¦‚å®ç°äº† JAXP SPI çš„ Apache Xercesæ‰€åŒ…å«çš„ jar åŒ…ã€‚SPI æ¥å£ä¸­çš„ä»£ç ç»å¸¸éœ€è¦åŠ è½½å…·ä½“çš„å®ç°ç±»ã€‚å¦‚ JAXP ä¸­çš„ javax.xml.parsers.DocumentBuilderFactoryç±»ä¸­çš„ newInstance()æ–¹æ³•ç”¨æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ DocumentBuilderFactoryçš„å®ä¾‹ã€‚è¿™é‡Œçš„å®ä¾‹çš„çœŸæ­£çš„ç±»æ˜¯ç»§æ‰¿è‡ª javax.xml.parsers.DocumentBuilderFactoryï¼Œç”± SPI çš„å®ç°æ‰€æä¾›çš„ã€‚å¦‚åœ¨ Apache Xerces ä¸­ï¼Œå®ç°çš„ç±»æ˜¯ org.apache.xerces.jaxp.DocumentBuilderFactoryImplã€‚è€Œé—®é¢˜åœ¨äºï¼ŒSPI çš„æ¥å£æ˜¯ Java æ ¸å¿ƒåº“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ç”±å¼•å¯¼ç±»åŠ è½½å™¨æ¥åŠ è½½çš„ï¼›SPI å®ç°çš„ Java ç±»ä¸€èˆ¬æ˜¯ç”±ç³»ç»Ÿç±»åŠ è½½å™¨æ¥åŠ è½½çš„ã€‚å¼•å¯¼ç±»åŠ è½½å™¨æ˜¯æ— æ³•æ‰¾åˆ° SPI çš„å®ç°ç±»çš„ï¼Œå› ä¸ºå®ƒåªåŠ è½½ Java çš„æ ¸å¿ƒåº“ã€‚å®ƒä¹Ÿä¸èƒ½ä»£ç†ç»™ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œå› ä¸ºå®ƒæ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨çš„ç¥–å…ˆç±»åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»åŠ è½½å™¨çš„ä»£ç†æ¨¡å¼æ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ­£å¥½è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä¸åšä»»ä½•çš„è®¾ç½®ï¼ŒJava åº”ç”¨çš„çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯ç³»ç»Ÿä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚åœ¨ SPI æ¥å£çš„ä»£ç ä¸­ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå°±å¯ä»¥æˆåŠŸçš„åŠ è½½åˆ° SPI å®ç°çš„ç±»ã€‚çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åœ¨å¾ˆå¤š SPI çš„å®ç°ä¸­éƒ½ä¼šç”¨åˆ°ã€‚ Javaé»˜è®¤çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨(AppClassLoader)ã€‚ä»¥ä¸‹ä»£ç æ‘˜è‡ªsun.misc.Launchçš„æ— å‚æ„é€ å‡½æ•°Launch()ã€‚ // Now create the class loader to use to launch the application try { loader = AppClassLoader.getAppClassLoader(extcl); } catch (IOException e) { throw new InternalError( &quot;Could not create application class loader&quot; ); } // Also set the context class loader for the primordial thread. Thread.currentThread().setContextClassLoader(loader); ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå¯ä»¥åœ¨æ‰§è¡Œçº¿ç¨‹ä¸­æŠ›å¼ƒåŒäº²å§”æ´¾åŠ è½½é“¾æ¨¡å¼ï¼Œä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡é‡Œçš„ç±»åŠ è½½å™¨åŠ è½½ç±»ã€‚å…¸å‹çš„ä¾‹å­æœ‰ï¼šé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡æ¥åŠ è½½ç¬¬ä¸‰æ–¹åº“jndiå®ç°ï¼Œè€Œä¸ä¾èµ–äºåŒäº²å§”æ´¾ã€‚å¤§éƒ¨åˆ†java applicationæœåŠ¡å™¨(jboss, tomcat..)ä¹Ÿæ˜¯é‡‡ç”¨contextClassLoaderæ¥å¤„ç†webæœåŠ¡ã€‚è¿˜æœ‰ä¸€äº›é‡‡ç”¨hot swapç‰¹æ€§çš„æ¡†æ¶ï¼Œä¹Ÿä½¿ç”¨äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œæ¯”å¦‚ seasar (full stack framework in japenese)ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡ä»æ ¹æœ¬è§£å†³äº†ä¸€èˆ¬åº”ç”¨ä¸èƒ½è¿èƒŒåŒäº²å§”æ´¾æ¨¡å¼çš„é—®é¢˜ã€‚ä½¿javaç±»åŠ è½½ä½“ç³»æ˜¾å¾—æ›´çµæ´»ã€‚éšç€å¤šæ ¸æ—¶ä»£çš„æ¥ä¸´ï¼Œç›¸ä¿¡å¤šçº¿ç¨‹å¼€å‘å°†ä¼šè¶Šæ¥è¶Šå¤šåœ°è¿›å…¥ç¨‹åºå‘˜çš„å®é™…ç¼–ç è¿‡ç¨‹ä¸­ã€‚å› æ­¤ï¼Œåœ¨ç¼–å†™åŸºç¡€è®¾æ–½æ—¶ï¼Œ é€šè¿‡ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡æ¥åŠ è½½ç±»ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ å½“ç„¶ï¼Œå¥½ä¸œè¥¿éƒ½æœ‰åˆ©å¼Šã€‚ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½ç±»ï¼Œä¹Ÿè¦æ³¨æ„ä¿è¯å¤šä¸ªéœ€è¦é€šä¿¡çš„çº¿ç¨‹é—´çš„ç±»åŠ è½½å™¨åº”è¯¥æ˜¯åŒä¸€ä¸ªï¼Œé˜²æ­¢å› ä¸ºä¸åŒçš„ç±»åŠ è½½å™¨å¯¼è‡´ç±»å‹è½¬æ¢å¼‚å¸¸(ClassCastException)ã€‚ defineClass(String name, byte[] b, int off, int len,ProtectionDomain protectionDomain)æ˜¯java.lang.Classloaderæä¾›ç»™å¼€å‘äººå‘˜ï¼Œç”¨æ¥è‡ªå®šä¹‰åŠ è½½classçš„æ¥å£ã€‚ä½¿ç”¨è¯¥æ¥å£ï¼Œå¯ä»¥åŠ¨æ€çš„åŠ è½½classæ–‡ä»¶ã€‚ä¾‹å¦‚åœ¨jdkä¸­ï¼ŒURLClassLoaderæ˜¯é…åˆfindClassæ–¹æ³•æ¥ä½¿ç”¨defineClassï¼Œå¯ä»¥ä»ç½‘ç»œæˆ–ç¡¬ç›˜ä¸ŠåŠ è½½classã€‚è€Œä½¿ç”¨ç±»åŠ è½½æ¥å£ï¼Œå¹¶åŠ ä¸Šè‡ªå·±çš„å®ç°é€»è¾‘ï¼Œè¿˜å¯ä»¥å®šåˆ¶å‡ºæ›´å¤šçš„é«˜çº§ç‰¹æ€§ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„hot swapç±»åŠ è½½å™¨å®ç°ã€‚hot swapå³çƒ­æ’æ‹”çš„æ„æ€ï¼Œè¿™é‡Œè¡¨ç¤ºä¸€ä¸ªç±»å·²ç»è¢«ä¸€ä¸ªåŠ è½½å™¨åŠ è½½äº†ä»¥åï¼Œåœ¨ä¸å¸è½½å®ƒçš„æƒ…å†µä¸‹é‡æ–°å†åŠ è½½å®ƒä¸€æ¬¡ã€‚æˆ‘ä»¬çŸ¥é“Javaç¼ºçœçš„åŠ è½½å™¨å¯¹ç›¸åŒå…¨åçš„ç±»åªä¼šåŠ è½½ä¸€æ¬¡ï¼Œä»¥åç›´æ¥ä»ç¼“å­˜ä¸­å–è¿™ä¸ªClass objectã€‚å› æ­¤è¦å®ç°hot swapï¼Œå¿…é¡»åœ¨åŠ è½½çš„é‚£ä¸€åˆ»è¿›è¡Œæ‹¦æˆªï¼Œå…ˆåˆ¤æ–­æ˜¯å¦å·²ç»åŠ è½½ï¼Œè‹¥æ˜¯åˆ™é‡æ–°åŠ è½½ä¸€æ¬¡ï¼Œå¦åˆ™ç›´æ¥é¦–æ¬¡åŠ è½½å®ƒã€‚æˆ‘ä»¬ä»URLClassLoaderç»§æ‰¿ï¼ŒåŠ è½½ç±»çš„è¿‡ç¨‹éƒ½ä»£ç†ç»™ç³»ç»Ÿç±»åŠ è½½å™¨URLClassLoaderä¸­çš„ç›¸åº”æ–¹æ³•æ¥å®Œæˆã€‚ package classloader; import java.net.URL; import java.net.URLClassLoader; /** * å¯ä»¥é‡æ–°è½½å…¥åŒåç±»çš„ç±»åŠ è½½å™¨å®ç° * æ”¾å¼ƒäº†åŒäº²å§”æ´¾çš„åŠ è½½é“¾æ¨¡å¼ï¼Œéœ€è¦å¤–éƒ¨ç»´æŠ¤é‡è½½åçš„ç±»çš„æˆå‘˜å˜é‡çŠ¶æ€ */ public class HotSwapClassLoader extends URLClassLoader { public HotSwapClassLoader(URL[] urls) { super(urls); } public HotSwapClassLoader(URL[] urls, ClassLoader parent) { super(urls, parent); } // ä¸‹é¢çš„ä¸¤ä¸ªé‡è½½loadæ–¹æ³•å®ç°ç±»çš„åŠ è½½ï¼Œä»¿ç…§ClassLoaderä¸­çš„ä¸¤ä¸ªloadClass() // å…·ä½“çš„åŠ è½½è¿‡ç¨‹ä»£ç†ç»™çˆ¶ç±»ä¸­çš„ç›¸åº”æ–¹æ³•æ¥å®Œæˆ public Class&lt;?&gt; load(String name) throws ClassNotFoundException { return load(name, false); } public Class&lt;?&gt; load(String name, boolean resolve) throws ClassNotFoundException { // è‹¥ç±»å·²ç»è¢«åŠ è½½ï¼Œåˆ™é‡æ–°å†åŠ è½½ä¸€æ¬¡ if (null != super.findLoadedClass(name)) { return reload(name, resolve); } // å¦åˆ™ç”¨findClass()é¦–æ¬¡åŠ è½½å®ƒ Class&lt;?&gt; clazz = super.findClass(name); if (resolve) { super.resolveClass(clazz); } return clazz; } public Class&lt;?&gt; reload(String name, boolean resolve) throws ClassNotFoundException { return new HotSwapClassLoader(super.getURLs(), super.getParent()).load( name, resolve); } } ä¸¤ä¸ªé‡è½½çš„loadæ–¹æ³•å‚æ•°ä¸ClassLoaderç±»ä¸­çš„ä¸¤ä¸ªloadClass()ç›¸ä¼¼ã€‚åœ¨loadçš„å®ç°ä¸­ï¼Œç”¨findLoadedClass()æŸ¥æ‰¾æŒ‡å®šçš„ç±»æ˜¯å¦å·²ç»è¢«ç¥–å…ˆåŠ è½½å™¨åŠ è½½äº†ï¼Œè‹¥å·²åŠ è½½åˆ™é‡æ–°å†åŠ è½½ä¸€æ¬¡ï¼Œä»è€Œæ”¾å¼ƒäº†åŒäº²å§”æ´¾çš„æ–¹å¼ï¼ˆè¿™ç§æ–¹å¼åªä¼šåŠ è½½ä¸€æ¬¡ï¼‰ã€‚è‹¥æ²¡æœ‰åŠ è½½åˆ™ç”¨è‡ªèº«çš„findClass()æ¥é¦–æ¬¡åŠ è½½å®ƒã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ï¼š package classloader; public class A { private B b; public void setB(B b) { this.b = b; } public B getB() { return b; } } package classloader; public class B { } package classloader; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; import java.net.MalformedURLException; import java.net.URL; public class TestHotSwap { public static void main(String args[]) throws MalformedURLException { A a = new A(); // åŠ è½½ç±»A B b = new B(); // åŠ è½½ç±»B a.setB(b); // Aå¼•ç”¨äº†Bï¼ŒæŠŠbå¯¹è±¡æ‹·è´åˆ°A.b System.out.printf(&quot;A classLoader is %s\\n&quot;, a.getClass().getClassLoader()); System.out.printf(&quot;B classLoader is %s\\n&quot;, b.getClass().getClassLoader()); System.out.printf(&quot;A.b classLoader is %s\\n&quot;, a.getB().getClass().getClassLoader()); try { URL[] urls = new URL[]{ new URL(&quot;file:///C:/Users/JackZhou/Documents/NetBeansProjects/classloader/build/classes/&quot;) }; HotSwapClassLoader c1 = new HotSwapClassLoader(urls, a.getClass().getClassLoader()); Class clazz = c1.load(&quot;classloader.A&quot;); // ç”¨hot swapé‡æ–°åŠ è½½ç±»A Object aInstance = clazz.newInstance(); // åˆ›å»ºAç±»å¯¹è±¡ Method method1 = clazz.getMethod(&quot;setB&quot;, B.class); // è·å–setB(B b)æ–¹æ³• method1.invoke(aInstance, b); // è°ƒç”¨setB(b)æ–¹æ³•ï¼Œé‡æ–°æŠŠbå¯¹è±¡æ‹·è´åˆ°A.b Method method2 = clazz.getMethod(&quot;getB&quot;); // è·å–getB()æ–¹æ³• Object bInstance = method2.invoke(aInstance); // è°ƒç”¨getB()æ–¹æ³• System.out.printf(&quot;Reloaded A.b classLoader is %s\\n&quot;, bInstance.getClass().getClassLoader()); } catch (MalformedURLException | ClassNotFoundException | InstantiationException | IllegalAccessException | NoSuchMethodException | SecurityException | IllegalArgumentException | InvocationTargetException e) { e.printStackTrace(); } } } è¿è¡Œè¾“å‡ºï¼š A classLoader is sun.misc.Launcher$AppClassLoader@73d16e93B classLoader is sun.misc.Launcher$AppClassLoader@73d16e93A.b classLoader is sun.misc.Launcher$AppClassLoader@73d16e93Reloaded A.b classLoader is sun.misc.Launcher$AppClassLoader@73d16e93 HotSwapClassLoaderåŠ è½½å™¨çš„ä½œç”¨æ˜¯é‡æ–°åŠ è½½åŒåçš„ç±»ã€‚ä¸ºäº†å®ç°hot swapï¼Œä¸€ä¸ªç±»åœ¨åŠ è½½è¿‡åï¼Œè‹¥é‡æ–°å†åŠ è½½ä¸€æ¬¡ï¼Œåˆ™æ–°çš„Class objectçš„çŠ¶æ€ä¼šæ”¹å˜ï¼Œè€çš„çŠ¶æ€æ•°æ®éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼æ‹·è´åˆ°é‡æ–°åŠ è½½è¿‡çš„ç±»ç”Ÿæˆçš„å…¨æ–°Class objectå®ä¾‹ä¸­æ¥ã€‚ä¸Šé¢Aç±»å¼•ç”¨äº†Bç±»ï¼ŒåŠ è½½Aæ—¶ä¹Ÿä¼šåŠ è½½Bï¼ˆå¦‚æœBå·²ç»åŠ è½½ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºï¼‰ã€‚åœ¨é‡æ–°åŠ è½½Aåï¼Œå…¶Class objectä¸­çš„æˆå‘˜bä¼šé‡ç½®ï¼Œå› æ­¤è¦é‡æ–°è°ƒç”¨setB(b)æ‹·è´ä¸€æ¬¡ã€‚ä½ å¯ä»¥æ³¨é‡Šæ‰è¿™è¡Œä»£ç ï¼Œå†è¿è¡Œä¼šæŠ›å‡ºjava.lang.NullPointerExceptionï¼ŒæŒ‡ç¤ºA.bä¸ºnullã€‚ æ³¨æ„æ–°çš„A Class objectå®ä¾‹æ‰€ä¾èµ–çš„Bç±»Class objectï¼Œå¦‚æœå®ƒä¸è€çš„B Class objectå®ä¾‹ä¸æ˜¯åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œ å°†ä¼šæŠ›å‡ºç±»å‹è½¬æ¢å¼‚å¸¸(ClassCastException)ï¼Œè¡¨ç¤ºä¸¤ç§ä¸åŒçš„ç±»ã€‚å› æ­¤åœ¨é‡æ–°åŠ è½½Aåï¼Œè¦ç‰¹åˆ«æ³¨æ„ç»™å®ƒçš„Bç±»æˆå‘˜bä¼ å…¥å¤–éƒ¨å€¼æ—¶ï¼Œå®ƒä»¬æ˜¯å¦ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½ã€‚ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œ HotSwapClassLoaderè‡ªå®šä¹‰çš„l/oadæ–¹æ³•ä¸­ï¼Œå½“å‰ç±»ï¼ˆç±»Aï¼‰æ˜¯ç”±è‡ªèº«classLoaderåŠ è½½çš„ï¼Œ è€Œå†…éƒ¨ä¾èµ–çš„ç±»ï¼ˆç±»Bï¼‰è¿˜æ˜¯è€å¯¹è±¡çš„classLoaderåŠ è½½çš„ã€‚ äºŒã€ä½•æ—¶ä½¿ç”¨?è¿™æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œä½†ç­”æ¡ˆå´å¾ˆéš¾å›ç­”ã€‚è¿™ä¸ªé—®é¢˜é€šå¸¸åœ¨éœ€è¦åŠ¨æ€åŠ è½½ç±»å’Œèµ„æºçš„ç³»ç»Ÿç¼–ç¨‹æ—¶ä¼šé‡åˆ°ã€‚æ€»çš„è¯´æ¥åŠ¨æ€åŠ è½½èµ„æºæ—¶ï¼Œå¾€å¾€éœ€è¦ä»ä¸‰ç§ç±»åŠ è½½å™¨é‡Œé€‰æ‹©ï¼šç³»ç»Ÿæˆ–ç¨‹åºçš„ç±»åŠ è½½å™¨ã€å½“å‰ç±»åŠ è½½å™¨ã€ä»¥åŠå½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚åœ¨ç¨‹åºä¸­åº”è¯¥ä½¿ç”¨ä½•ç§ç±»åŠ è½½å™¨å‘¢ï¼Ÿ ç³»ç»Ÿç±»åŠ è½½å™¨é€šå¸¸ä¸ä¼šä½¿ç”¨ã€‚æ­¤ç±»åŠ è½½å™¨å¤„ç†å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶classpathæŒ‡å®šçš„ç±»ï¼Œå¯ä»¥é€šè¿‡ClassLoader.getSystemClassLoader()æ¥è·å¾—ã€‚æ‰€æœ‰çš„ClassLoader.getSystemXXX()æ¥å£ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„ã€‚ä¸€èˆ¬ä¸è¦æ˜¾å¼è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œåº”è¯¥è®©å…¶ä»–ç±»åŠ è½½å™¨ä»£ç†åˆ°ç³»ç»Ÿç±»åŠ è½½å™¨ä¸Šã€‚ç”±äºç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯JVMæœ€ååˆ›å»ºçš„ç±»åŠ è½½å™¨ï¼Œè¿™æ ·ä»£ç åªä¼šé€‚åº”äºç®€å•å‘½ä»¤è¡Œå¯åŠ¨çš„ç¨‹åºã€‚ä¸€æ—¦ä»£ç ç§»æ¤åˆ°EJBã€Webåº”ç”¨æˆ–è€…Java Web Startåº”ç”¨ç¨‹åºä¸­ï¼Œç¨‹åºè‚¯å®šä¸èƒ½æ­£ç¡®æ‰§è¡Œã€‚ å› æ­¤ä¸€èˆ¬åªæœ‰ä¸¤ç§é€‰æ‹©ï¼Œå½“å‰ç±»åŠ è½½å™¨å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å½“å‰ç±»åŠ è½½å™¨æ˜¯æŒ‡å½“å‰æ–¹æ³•æ‰€åœ¨ç±»çš„åŠ è½½å™¨ã€‚è¿™ä¸ªç±»åŠ è½½å™¨æ˜¯è¿è¡Œæ—¶ç±»è§£æä½¿ç”¨çš„åŠ è½½å™¨ï¼ŒClass.forName(String)å’ŒClass.getResource(String)ä¹Ÿä½¿ç”¨è¯¥ç±»åŠ è½½å™¨ã€‚ä»£ç ä¸­X.classçš„å†™æ³•ä½¿ç”¨çš„ç±»åŠ è½½å™¨ä¹Ÿæ˜¯è¿™ä¸ªç±»åŠ è½½å™¨ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åœ¨Java 2(J2SE)æ—¶å¼•å…¥ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå…³è”çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœä½ ä½¿ç”¨new Thread()æ–¹å¼ç”Ÿæˆæ–°çš„çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœç¨‹åºå¯¹çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ²¡æœ‰ä»»ä½•æ”¹åŠ¨çš„è¯ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„çº¿ç¨‹å°†éƒ½ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ä½œä¸ºä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚Webåº”ç”¨å’ŒJavaä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œåº”ç”¨æœåŠ¡å™¨ç»å¸¸è¦ä½¿ç”¨å¤æ‚çš„ç±»åŠ è½½å™¨ç»“æ„æ¥å®ç°JNDIï¼ˆJavaå‘½åå’Œç›®å½•æ¥å£)ã€çº¿ç¨‹æ± ã€ç»„ä»¶çƒ­éƒ¨ç½²ç­‰åŠŸèƒ½ï¼Œå› æ­¤ç†è§£è¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚ ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Ÿå°†å®ƒå¼•å…¥J2SEå¹¶ä¸æ˜¯çº¯ç²¹çš„å™±å¤´ï¼Œç”±äºSunæ²¡æœ‰æä¾›å……åˆ†çš„æ–‡æ¡£è§£é‡Šè¯´æ˜è¿™ä¸€ç‚¹ï¼Œè¿™ä½¿è®¸å¤šå¼€å‘è€…å¾ˆç³Šæ¶‚ã€‚å®é™…ä¸Šï¼Œä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸ºåŒæ ·åœ¨J2SEä¸­å¼•å…¥çš„ç±»åŠ è½½ä»£ç†æœºåˆ¶æä¾›äº†åé—¨ã€‚é€šå¸¸JVMä¸­çš„ç±»åŠ è½½å™¨æ˜¯æŒ‰ç…§å±‚æ¬¡ç»“æ„ç»„ç»‡çš„ï¼Œç›®çš„æ˜¯æ¯ä¸ªç±»åŠ è½½å™¨ï¼ˆé™¤äº†å¯åŠ¨æ•´ä¸ªJVMçš„åŸåˆç±»åŠ è½½å™¨ï¼‰éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ã€‚å½“ç±»åŠ è½½è¯·æ±‚åˆ°æ¥æ—¶ï¼Œç±»åŠ è½½å™¨é€šå¸¸é¦–å…ˆå°†è¯·æ±‚ä»£ç†ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚åªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨å¤±è´¥åï¼Œå®ƒæ‰è¯•å›¾æŒ‰ç…§è‡ªå·±çš„ç®—æ³•æŸ¥æ‰¾å¹¶å®šä¹‰å½“å‰ç±»ã€‚ æœ‰æ—¶è¿™ç§æ¨¡å¼å¹¶ä¸èƒ½æ€»æ˜¯å¥æ•ˆã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨JVMæ ¸å¿ƒä»£ç å¿…é¡»åŠ¨æ€åŠ è½½ç”±åº”ç”¨ç¨‹åºåŠ¨æ€æä¾›çš„èµ„æºæ—¶ã€‚æ‹¿JNDIä¸ºä¾‹ï¼Œå®ƒçš„æ ¸å¿ƒæ˜¯ç”±JREæ ¸å¿ƒç±»(rt.jar)å®ç°çš„ã€‚ä½†è¿™äº›æ ¸å¿ƒJNDIç±»å¿…é¡»èƒ½åŠ è½½ç”±ç¬¬ä¸‰æ–¹å‚å•†æä¾›çš„JNDIå®ç°ã€‚è¿™ç§æƒ…å†µä¸‹è°ƒç”¨çˆ¶ç±»åŠ è½½å™¨ï¼ˆåŸåˆç±»åŠ è½½å™¨ï¼‰æ¥åŠ è½½åªæœ‰å…¶å­ç±»åŠ è½½å™¨å¯è§çš„ç±»ï¼Œè¿™ç§ä»£ç†æœºåˆ¶å°±ä¼šå¤±æ•ˆã€‚è§£å†³åŠæ³•å°±æ˜¯è®©æ ¸å¿ƒJNDIç±»ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œä»è€Œæœ‰æ•ˆçš„æ‰“é€šç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„ï¼Œé€†ç€ä»£ç†æœºåˆ¶çš„æ–¹å‘ä½¿ç”¨ç±»åŠ è½½å™¨ã€‚ é¡ºä¾¿æä¸€ä¸‹ï¼ŒXMLè§£æAPI(JAXP)ä¹Ÿæ˜¯ä½¿ç”¨æ­¤ç§æœºåˆ¶ã€‚å½“JAXPè¿˜æ˜¯J2SEæ‰©å±•æ—¶ï¼ŒXMLè§£æå™¨ä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨æ–¹æ³•æ¥åŠ è½½è§£æå™¨å®ç°ã€‚ä½†å½“JAXPæˆä¸ºJ2SEæ ¸å¿ƒä»£ç åï¼Œç±»åŠ è½½æœºåˆ¶å°±æ¢æˆäº†ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼Œè¿™å’ŒJNDIçš„åŸå› ç›¸ä¼¼ã€‚ å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ˜ç™½äº†é—®é¢˜çš„å…³é”®ï¼šè¿™ä¸¤ç§é€‰æ‹©ä¸å¯èƒ½é€‚åº”æ‰€æœ‰æƒ…å†µã€‚ä¸€äº›äººè®¤ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åº”æˆä¸ºæ–°çš„æ ‡å‡†ã€‚ä½†è¿™åœ¨ä¸åŒJVMçº¿ç¨‹å…±äº«æ•°æ®æ¥æ²Ÿé€šæ—¶ï¼Œå°±ä¼šä½¿ç±»åŠ è½½å™¨çš„ç»“æ„ä¹±ä¸ƒå…«ç³Ÿã€‚é™¤éæ‰€æœ‰çº¿ç¨‹éƒ½ä½¿ç”¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚è€Œä¸”ï¼Œä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨å·²æˆä¸ºç¼ºçœè§„åˆ™ï¼Œå®ƒä»¬å¹¿æ³›åº”ç”¨åœ¨ç±»å£°æ˜ã€Class.forNameç­‰æƒ…æ™¯ä¸­ã€‚å³ä½¿ä½ æƒ³å°½å¯èƒ½åªä½¿ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œæ€»æ˜¯æœ‰è¿™æ ·é‚£æ ·çš„ä»£ç ä¸æ˜¯ä½ æ‰€èƒ½æ§åˆ¶çš„ã€‚è¿™äº›ä»£ç éƒ½ä½¿ç”¨ä»£ç†åˆ°å½“å‰ç±»åŠ è½½å™¨çš„æ¨¡å¼ã€‚æ··æ‚ä½¿ç”¨ä»£ç†æ¨¡å¼æ˜¯å¾ˆå±é™©çš„ã€‚ æ›´ä¸ºç³Ÿç³•çš„æ˜¯ï¼ŒæŸäº›åº”ç”¨æœåŠ¡å™¨å°†å½“å‰ç±»åŠ è½½å™¨å’Œä¸Šä¸‹æ–‡ç±»åŠ å™¨åˆ†åˆ«è®¾ç½®æˆä¸åŒçš„ClassLoaderå®ä¾‹ã€‚è™½ç„¶å®ƒä»¬æ‹¥æœ‰ç›¸åŒçš„ç±»è·¯å¾„ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´å¹¶ä¸å­˜åœ¨çˆ¶å­ä»£ç†å…³ç³»ã€‚æƒ³æƒ³è¿™ä¸ºä»€ä¹ˆå¯æ€•ï¼šè®°ä½åŠ è½½å¹¶å®šä¹‰æŸä¸ªç±»çš„ç±»åŠ è½½å™¨æ˜¯è™šæ‹Ÿæœºå†…éƒ¨æ ‡è¯†è¯¥ç±»çš„ç»„æˆéƒ¨åˆ†ï¼Œå¦‚æœå½“å‰ç±»åŠ è½½å™¨åŠ è½½ç±»Xå¹¶æ¥ç€æ‰§è¡Œå®ƒï¼Œå¦‚JNDIæŸ¥æ‰¾ç±»å‹ä¸ºYçš„æ•°æ®ï¼Œä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨èƒ½å¤ŸåŠ è½½å¹¶å®šä¹‰Yï¼Œè¿™ä¸ªYçš„å®šä¹‰å’Œå½“å‰ç±»åŠ è½½å™¨åŠ è½½çš„ç›¸åŒåç§°çš„ç±»å°±ä¸æ˜¯åŒä¸€ä¸ªï¼Œä½¿ç”¨éšå¼ç±»å‹è½¬æ¢å°±ä¼šé€ æˆå¼‚å¸¸ã€‚ è¿™ç§æ··ä¹±çš„çŠ¶å†µè¿˜å°†åœ¨Javaä¸­å­˜åœ¨å¾ˆé•¿æ—¶é—´ã€‚åœ¨J2SEä¸­è¿˜åŒ…æ‹¬ä»¥ä¸‹çš„åŠŸèƒ½ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨ï¼š JNDIä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚ Class.getResource()å’ŒClass.forName()ä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨ã€‚ JAXPä½¿ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚ java.util.ResourceBundleä½¿ç”¨è°ƒç”¨è€…çš„å½“å‰ç±»åŠ è½½å™¨ã€‚ URLåè®®å¤„ç†å™¨ä½¿ç”¨java.protocol.handler.pkgsç³»ç»Ÿå±æ€§å¹¶åªä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ Javaåºåˆ—åŒ–APIç¼ºçœä½¿ç”¨è°ƒç”¨è€…å½“å‰çš„ç±»åŠ è½½å™¨ã€‚ è¿™äº›ç±»åŠ è½½å™¨éå¸¸æ··ä¹±ï¼Œæ²¡æœ‰åœ¨J2SEæ–‡æ¡£ä¸­ç»™ä»¥æ¸…æ™°æ˜ç¡®çš„è¯´æ˜ã€‚ è¯¥å¦‚ä½•é€‰æ‹©ç±»åŠ è½½å™¨ï¼Ÿ å¦‚è‹¥ä»£ç æ˜¯é™äºæŸäº›ç‰¹å®šæ¡†æ¶ï¼Œè¿™äº›æ¡†æ¶æœ‰ç€ç‰¹å®šåŠ è½½è§„åˆ™ï¼Œåˆ™ä¸è¦åšä»»ä½•æ”¹åŠ¨ï¼Œè®©æ¡†æ¶å¼€å‘è€…æ¥ä¿è¯å…¶å·¥ä½œï¼ˆæ¯”å¦‚åº”ç”¨æœåŠ¡å™¨æä¾›å•†ï¼Œå°½ç®¡ä»–ä»¬å¹¶ä¸èƒ½æ€»æ˜¯åšå¯¹ï¼‰ã€‚å¦‚åœ¨Webåº”ç”¨å’ŒEJBä¸­ï¼Œè¦ä½¿ç”¨Class.gerResourceæ¥åŠ è½½èµ„æºã€‚ åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥é€‰æ‹©æœ€åˆé€‚çš„ç±»åŠ è½½å™¨ã€‚å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥è®¾è®¡é€‰æ‹©æœºåˆ¶ã€‚å…¶æ€æƒ³æ˜¯å°†â€œæ€»æ˜¯ä½¿ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨â€æˆ–è€…â€œæ€»æ˜¯ä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨â€çš„å†³ç­–åŒå…·ä½“å®ç°é€»è¾‘åˆ†ç¦»å¼€ã€‚å¾€å¾€è®¾è®¡ä¹‹åˆæ˜¯å¾ˆéš¾é¢„æµ‹ä½•ç§ç±»åŠ è½½ç­–ç•¥æ˜¯åˆé€‚çš„ï¼Œè¯¥è®¾è®¡èƒ½å¤Ÿè®©ä½ å¯ä»¥åæ¥ä¿®æ”¹ç±»åŠ è½½ç­–ç•¥ã€‚ è€ƒè™‘ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œè¿™æ˜¯ä½œè€…æœ¬äººåœ¨å·¥ä½œä¸­å‘ç°çš„ç»éªŒã€‚è¿™å„¿æœ‰ä¸€ä¸ªç¼ºçœå®ç°ï¼Œåº”è¯¥å¯ä»¥é€‚åº”å¤§éƒ¨åˆ†å·¥ä½œåœºæ™¯ï¼š package classloader.context; /** * ç±»åŠ è½½ä¸Šä¸‹æ–‡ï¼ŒæŒæœ‰è¦åŠ è½½çš„ç±» */ public class ClassLoadContext { private final Class m_caller; public final Class getCallerClass() { return m_caller; } ClassLoadContext(final Class caller) { m_caller = caller; } } package classloader.context; /** * ç±»åŠ è½½ç­–ç•¥æ¥å£ */ public interface IClassLoadStrategy { ClassLoader getClassLoader(ClassLoadContext ctx); } /** * ç¼ºçœçš„ç±»åŠ è½½ç­–ç•¥ï¼Œå¯ä»¥é€‚åº”å¤§éƒ¨åˆ†å·¥ä½œåœºæ™¯ */ public class DefaultClassLoadStrategy implements IClassLoadStrategy { /** * ä¸ºctxè¿”å›æœ€åˆé€‚çš„ç±»åŠ è½½å™¨ï¼Œä»ç³»ç»Ÿç±»åŠ è½½å™¨ã€å½“å‰ç±»åŠ è½½å™¨ * å’Œå½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½ä¸­é€‰æ‹©ä¸€ä¸ªæœ€åº•å±‚çš„åŠ è½½å™¨ * @param ctx * @return */ @Override public ClassLoader getClassLoader(final ClassLoadContext ctx) { final ClassLoader callerLoader = ctx.getCallerClass().getClassLoader(); final ClassLoader contextLoader = Thread.currentThread().getContextClassLoader(); ClassLoader result; // If &#39;callerLoader&#39; and &#39;contextLoader&#39; are in a parent-child // relationship, always choose the child: if (isChild(contextLoader, callerLoader)) { result = callerLoader; } else if (isChild(callerLoader, contextLoader)) { result = contextLoader; } else { // This else branch could be merged into the previous one, // but I show it here to emphasize the ambiguous case: result = contextLoader; } final ClassLoader systemLoader = ClassLoader.getSystemClassLoader(); // Precaution for when deployed as a bootstrap or extension class: if (isChild(result, systemLoader)) { result = systemLoader; } return result; } // åˆ¤æ–­anotherLoaderæ˜¯å¦æ˜¯oneLoaderçš„child private boolean isChild(ClassLoader oneLoader, ClassLoader anotherLoader){ //... } // ... more methods } å†³å®šåº”è¯¥ä½¿ç”¨ä½•ç§ç±»åŠ è½½å™¨çš„æ¥å£æ˜¯IClassLoaderStrategyï¼Œä¸ºäº†å¸®åŠ©IClassLoadStrategyåšå†³å®šï¼Œç»™å®ƒä¼ é€’äº†ä¸ªClassLoadContextå¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ClassLoadContextæŒæœ‰è¦åŠ è½½çš„ç±»ã€‚ ä¸Šé¢ä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼šå¦‚è°ƒç”¨ç±»çš„å½“å‰ç±»åŠ è½½å™¨å’Œä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯çˆ¶å­å…³ç³»ï¼Œåˆ™æ€»æ˜¯é€‰æ‹©å­ç±»åŠ è½½å™¨ã€‚å¯¹å­ç±»åŠ è½½å™¨å¯è§çš„èµ„æºé€šå¸¸æ˜¯å¯¹çˆ¶ç±»å¯è§èµ„æºçš„è¶…é›†ï¼Œå› æ­¤å¦‚æœæ¯ä¸ªå¼€å‘è€…éƒ½éµå¾ªJ2SEçš„ä»£ç†è§„åˆ™ï¼Œè¿™æ ·åšå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯åˆé€‚çš„ã€‚ å½“å‰ç±»åŠ è½½å™¨å’Œä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯å…„å¼Ÿå…³ç³»æ—¶ï¼Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªæ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ŒJavaè¿è¡Œæ—¶ä¸åº”äº§ç”Ÿè¿™ç§æ¨¡ç³Šã€‚ä½†ä¸€æ—¦å‘ç”Ÿï¼Œä¸Šé¢ä»£ç é€‰æ‹©ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚è¿™æ˜¯ä½œè€…æœ¬äººçš„å®é™…ç»éªŒï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œã€‚ä½ å¯ä»¥ä¿®æ”¹è¿™éƒ¨åˆ†ä»£ç æ¥é€‚åº”å…·ä½“éœ€è¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è¦æ¯”å½“å‰ç±»åŠ è½½å™¨æ›´é€‚åˆäºæ¡†æ¶ç¼–ç¨‹ï¼Œè€Œå½“å‰ç±»åŠ è½½å™¨åˆ™æ›´é€‚åˆäºä¸šåŠ¡é€»è¾‘ç¼–ç¨‹ã€‚ æœ€åéœ€è¦æ£€æŸ¥ä¸€ä¸‹ï¼Œä»¥ä¾¿ä¿è¯æ‰€é€‰ç±»åŠ è½½å™¨ä¸æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶äº²ï¼Œåœ¨å¼€å‘æ ‡å‡†æ‰©å±•ç±»åº“æ—¶è¿™é€šå¸¸æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚æ³¨æ„ä½œè€…æ•…æ„æ²¡æœ‰æ£€æŸ¥è¦åŠ è½½èµ„æºæˆ–ç±»çš„åç§°ã€‚Java XML APIæˆä¸ºJ2SEæ ¸å¿ƒçš„å†ç¨‹åº”è¯¥èƒ½è®©æˆ‘ä»¬æ¸…æ¥šè¿‡æ»¤ç±»åå¹¶ä¸æ˜¯å¥½æƒ³æ³•ã€‚ä½œè€…ä¹Ÿæ²¡æœ‰è¯•å›¾æ£€æŸ¥å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½é¦–å…ˆæˆåŠŸï¼Œè€Œæ˜¯æ£€æŸ¥ç±»åŠ è½½å™¨çš„çˆ¶å­å…³ç³»ï¼Œè¿™æ˜¯æ›´å¥½æ›´æœ‰ä¿è¯çš„æ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ç±»åŠ è½½å™¨çš„é€‰æ‹©å™¨ï¼š package classloader.context; /** * ç±»åŠ è½½è§£æå™¨ï¼Œè·å–æœ€åˆé€‚çš„ç±»åŠ è½½å™¨ */ public abstract class ClassLoaderResolver { private static IClassLoadStrategy s_strategy; // initialized in &lt;clinit&gt; private static final int CALL_CONTEXT_OFFSET = 3; // may need to change if this class is redesigned private static final CallerResolver CALLER_RESOLVER; // set in &lt;clinit&gt; static { try { // This can fail if the current SecurityManager does not allow // RuntimePermission (&quot;createSecurityManager&quot;): CALLER_RESOLVER = new CallerResolver(); } catch (SecurityException se) { throw new RuntimeException(&quot;ClassLoaderResolver: could not create CallerResolver: &quot; + se); } s_strategy = new DefaultClassLoadStrategy(); //é»˜è®¤ä½¿ç”¨ç¼ºçœåŠ è½½ç­–ç•¥ } /** * This method selects the best classloader instance to be used for * class/resource loading by whoever calls this method. The decision * typically involves choosing between the caller&#39;s current, thread context, * system, and other classloaders in the JVM and is made by the {@link IClassLoadStrategy} * instance established by the last call to {@link #setStrategy}. * * @return classloader to be used by the caller [&#39;null&#39; indicates the * primordial loader] */ public static synchronized ClassLoader getClassLoader() { final Class caller = getCallerClass(0); // è·å–æ‰§è¡Œå½“å‰æ–¹æ³•çš„ç±» final ClassLoadContext ctx = new ClassLoadContext(caller); // åˆ›å»ºç±»åŠ è½½ä¸Šä¸‹æ–‡ return s_strategy.getClassLoader(ctx); // è·å–æœ€åˆé€‚çš„ç±»åŠ è½½å™¨ } public static synchronized IClassLoadStrategy getStrategy() { return s_strategy; } public static synchronized IClassLoadStrategy setStrategy(final IClassLoadStrategy strategy) { final IClassLoadStrategy old = s_strategy; // è®¾ç½®ç±»åŠ è½½ç­–ç•¥ s_strategy = strategy; return old; } /** * A helper class to get the call context. It subclasses SecurityManager * to make getClassContext() accessible. An instance of CallerResolver * only needs to be created, not installed as an actual security manager. */ private static final class CallerResolver extends SecurityManager { @Override protected Class[] getClassContext() { return super.getClassContext(); // è·å–å½“æ‰§è¡Œæ ˆçš„æ‰€æœ‰ç±»ï¼Œnativeæ–¹æ³• } } /* * Indexes into the current method call context with a given * offset. */ private static Class getCallerClass(final int callerOffset) { return CALLER_RESOLVER.getClassContext()[CALL_CONTEXT_OFFSET + callerOffset]; // è·å–æ‰§è¡Œæ ˆä¸ŠæŸä¸ªæ–¹æ³•æ‰€å±çš„ç±» } } å¯é€šè¿‡è°ƒç”¨ClassLoaderResolver.getClassLoader()æ–¹æ³•æ¥è·å–ç±»åŠ è½½å™¨å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å…¶ClassLoaderçš„æ¥å£å¦‚loadClass()ç­‰æ¥åŠ è½½ç±»å’Œèµ„æºã€‚æ­¤å¤–è¿˜å¯ä½¿ç”¨ä¸‹é¢çš„ResourceLoaderæ¥å£æ¥å–ä»£ClassLoaderæ¥å£ï¼š package classloader.context; import java.net.URL; public class ResourceLoader { /** * åŠ è½½ä¸€ä¸ªç±» * * @param name * @return * @throws java.lang.ClassNotFoundException * @see java.lang.ClassLoader#loadClass(java.lang.String) */ public static Class&lt;?&gt; loadClass(final String name) throws ClassNotFoundException { //è·å–æœ€åˆé€‚çš„ç±»åŠ è½½å™¨ final ClassLoader loader = ClassLoaderResolver.getClassLoader(); //ç”¨æŒ‡å®šåŠ è½½å™¨åŠ è½½ç±» return Class.forName(name, false, loader); } /** * åŠ è½½ä¸€ä¸ªèµ„æº * * @param name * @return * @see java.lang.ClassLoader#getResource(java.lang.String) */ public static URL getResource(final String name) { //è·å–æœ€åˆé€‚çš„ç±»åŠ è½½å™¨ final ClassLoader loader = ClassLoaderResolver.getClassLoader(); //æŸ¥æ‰¾æŒ‡å®šçš„èµ„æº if (loader != null) { return loader.getResource(name); } else { return ClassLoader.getSystemResource(name); } } // ... more methods ... } ClassLoadContext.getCallerClass()è¿”å›çš„ç±»åœ¨ClassLoaderResolveræˆ–ResourceLoaderä½¿ç”¨ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯è®©å…¶èƒ½æ‰¾åˆ°è°ƒç”¨ç±»çš„ç±»åŠ è½½å™¨ï¼ˆä¸Šä¸‹æ–‡åŠ è½½å™¨æ€»æ˜¯èƒ½é€šè¿‡Thread.currentThread().getContextClassLoader()æ¥è·å¾—ï¼‰ã€‚æ³¨æ„è°ƒç”¨ç±»æ˜¯é™æ€è·å¾—çš„ï¼Œå› æ­¤è¿™ä¸ªæ¥å£ä¸éœ€ç°æœ‰ä¸šåŠ¡æ–¹æ³•å¢åŠ é¢å¤–çš„Classå‚æ•°ï¼Œè€Œä¸”ä¹Ÿé€‚åˆäºé™æ€æ–¹æ³•å’Œç±»åˆå§‹åŒ–ä»£ç ã€‚å…·ä½“ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å¾€è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ä¸­æ·»åŠ å…·ä½“éƒ¨ç½²ç¯å¢ƒä¸­æ‰€éœ€çš„å…¶ä»–å±æ€§ã€‚ ä¸‰ã€ç±»åŠ è½½å™¨ä¸Webå®¹å™¨å¯¹äºè¿è¡Œåœ¨ Java EEå®¹å™¨ä¸­çš„ Web åº”ç”¨æ¥è¯´ï¼Œç±»åŠ è½½å™¨çš„å®ç°æ–¹å¼ä¸ä¸€èˆ¬çš„ Java åº”ç”¨æœ‰æ‰€ä¸åŒã€‚ä¸åŒçš„ Web å®¹å™¨çš„å®ç°æ–¹å¼ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚ä»¥ Apache Tomcat æ¥è¯´ï¼Œæ¯ä¸ª Web åº”ç”¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç±»åŠ è½½å™¨å®ä¾‹ã€‚è¯¥ç±»åŠ è½½å™¨ä¹Ÿä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œæ‰€ä¸åŒçš„æ˜¯å®ƒæ˜¯é¦–å…ˆå°è¯•å»åŠ è½½æŸä¸ªç±»ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†ä»£ç†ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚è¿™ä¸ä¸€èˆ¬ç±»åŠ è½½å™¨çš„é¡ºåºæ˜¯ç›¸åçš„ã€‚è¿™æ˜¯ Java Servlet è§„èŒƒä¸­çš„æ¨èåšæ³•ï¼Œå…¶ç›®çš„æ˜¯ä½¿å¾— Web åº”ç”¨è‡ªå·±çš„ç±»çš„ä¼˜å…ˆçº§é«˜äº Web å®¹å™¨æä¾›çš„ç±»ã€‚è¿™ç§ä»£ç†æ¨¡å¼çš„ä¸€ä¸ªä¾‹å¤–æ˜¯ï¼šJava æ ¸å¿ƒåº“çš„ç±»æ˜¯ä¸åœ¨æŸ¥æ‰¾èŒƒå›´ä¹‹å†…çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯ Java æ ¸å¿ƒåº“çš„ç±»å‹å®‰å…¨ã€‚ ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒWeb åº”ç”¨çš„å¼€å‘äººå‘˜ä¸éœ€è¦è€ƒè™‘ä¸ç±»åŠ è½½å™¨ç›¸å…³çš„ç»†èŠ‚ã€‚ä¸‹é¢ç»™å‡ºå‡ æ¡ç®€å•çš„åŸåˆ™ï¼š æ¯ä¸ª Web åº”ç”¨è‡ªå·±çš„ Java ç±»æ–‡ä»¶å’Œä½¿ç”¨çš„åº“çš„ jar åŒ…ï¼Œåˆ†åˆ«æ”¾åœ¨ WEB-INF/classeså’Œ WEB-INF/libç›®å½•ä¸‹é¢ã€‚ å¤šä¸ªåº”ç”¨å…±äº«çš„ Java ç±»æ–‡ä»¶å’Œ jar åŒ…ï¼Œåˆ†åˆ«æ”¾åœ¨ Web å®¹å™¨æŒ‡å®šçš„ç”±æ‰€æœ‰ Web åº”ç”¨å…±äº«çš„ç›®å½•ä¸‹é¢ã€‚ å½“å‡ºç°æ‰¾ä¸åˆ°ç±»çš„é”™è¯¯æ—¶ï¼Œæ£€æŸ¥å½“å‰ç±»çš„ç±»åŠ è½½å™¨å’Œå½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯å¦æ­£ç¡®ã€‚ å››ã€ç±»åŠ è½½å™¨ä¸OSGiOSGiæ˜¯ Java ä¸Šçš„åŠ¨æ€æ¨¡å—ç³»ç»Ÿã€‚å®ƒä¸ºå¼€å‘äººå‘˜æä¾›äº†é¢å‘æœåŠ¡å’ŒåŸºäºç»„ä»¶çš„è¿è¡Œç¯å¢ƒï¼Œå¹¶æä¾›æ ‡å‡†çš„æ–¹å¼ç”¨æ¥ç®¡ç†è½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚OSGi å·²ç»è¢«å®ç°å’Œéƒ¨ç½²åœ¨å¾ˆå¤šäº§å“ä¸Šï¼Œåœ¨å¼€æºç¤¾åŒºä¹Ÿå¾—åˆ°äº†å¹¿æ³›çš„æ”¯æŒã€‚Eclipseå°±æ˜¯åŸºäºOSGi æŠ€æœ¯æ¥æ„å»ºçš„ã€‚ OSGi ä¸­çš„æ¯ä¸ªæ¨¡å—ï¼ˆbundleï¼‰éƒ½åŒ…å« Java åŒ…å’Œç±»ã€‚æ¨¡å—å¯ä»¥å£°æ˜å®ƒæ‰€ä¾èµ–çš„éœ€è¦å¯¼å…¥ï¼ˆimportï¼‰çš„å…¶å®ƒæ¨¡å—çš„ Java åŒ…å’Œç±»ï¼ˆé€šè¿‡ Import-Packageï¼‰ï¼Œä¹Ÿå¯ä»¥å£°æ˜å¯¼å‡ºï¼ˆexportï¼‰è‡ªå·±çš„åŒ…å’Œç±»ï¼Œä¾›å…¶å®ƒæ¨¡å—ä½¿ç”¨ï¼ˆé€šè¿‡ Export-Packageï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´éœ€è¦èƒ½å¤Ÿéšè—å’Œå…±äº«ä¸€ä¸ªæ¨¡å—ä¸­çš„æŸäº› Java åŒ…å’Œç±»ã€‚è¿™æ˜¯é€šè¿‡ OSGi ç‰¹æœ‰çš„ç±»åŠ è½½å™¨æœºåˆ¶æ¥å®ç°çš„ã€‚OSGi ä¸­çš„æ¯ä¸ªæ¨¡å—éƒ½æœ‰å¯¹åº”çš„ä¸€ä¸ªç±»åŠ è½½å™¨ã€‚å®ƒè´Ÿè´£åŠ è½½æ¨¡å—è‡ªå·±åŒ…å«çš„ Java åŒ…å’Œç±»ã€‚å½“å®ƒéœ€è¦åŠ è½½ Java æ ¸å¿ƒåº“çš„ç±»æ—¶ï¼ˆä»¥ javaå¼€å¤´çš„åŒ…å’Œç±»ï¼‰ï¼Œå®ƒä¼šä»£ç†ç»™çˆ¶ç±»åŠ è½½å™¨ï¼ˆé€šå¸¸æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰æ¥å®Œæˆã€‚å½“å®ƒéœ€è¦åŠ è½½æ‰€å¯¼å…¥çš„ Java ç±»æ—¶ï¼Œå®ƒä¼šä»£ç†ç»™å¯¼å‡ºæ­¤ Java ç±»çš„æ¨¡å—æ¥å®ŒæˆåŠ è½½ã€‚ æ¨¡å—ä¹Ÿå¯ä»¥æ˜¾å¼çš„å£°æ˜æŸäº› Java åŒ…å’Œç±»ï¼Œå¿…é¡»ç”±çˆ¶ç±»åŠ è½½å™¨æ¥åŠ è½½ã€‚åªéœ€è¦è®¾ç½®ç³»ç»Ÿå±æ€§ org.osgi.framework.bootdelegationçš„å€¼å³å¯ã€‚ å‡è®¾æœ‰ä¸¤ä¸ªæ¨¡å— bundleA å’Œ bundleBï¼Œå®ƒä»¬éƒ½æœ‰è‡ªå·±å¯¹åº”çš„ç±»åŠ è½½å™¨ classLoaderA å’Œ classLoaderBã€‚åœ¨ bundleA ä¸­åŒ…å«ç±» com.bundleA.Sampleï¼Œå¹¶ä¸”è¯¥ç±»è¢«å£°æ˜ä¸ºå¯¼å‡ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¢«å…¶å®ƒæ¨¡å—æ‰€ä½¿ç”¨çš„ã€‚bundleB å£°æ˜äº†å¯¼å…¥ bundleA æä¾›çš„ç±» com.bundleA.Sampleï¼Œå¹¶åŒ…å«ä¸€ä¸ªç±» com.bundleB.NewSampleç»§æ‰¿è‡ª com.bundleA.Sampleã€‚åœ¨ bundleB å¯åŠ¨çš„æ—¶å€™ï¼Œå…¶ç±»åŠ è½½å™¨ classLoaderB éœ€è¦åŠ è½½ç±» com.bundleB.NewSampleï¼Œè¿›è€Œéœ€è¦åŠ è½½ç±» com.bundleA.Sampleã€‚ç”±äº bundleB å£°æ˜äº†ç±» com.bundleA.Sampleæ˜¯å¯¼å…¥çš„ï¼ŒclassLoaderB æŠŠåŠ è½½ç±» com.bundleA.Sampleçš„å·¥ä½œä»£ç†ç»™å¯¼å‡ºè¯¥ç±»çš„ bundleA çš„ç±»åŠ è½½å™¨ classLoaderAã€‚classLoaderA åœ¨å…¶æ¨¡å—å†…éƒ¨æŸ¥æ‰¾ç±» com.bundleA.Sampleå¹¶å®šä¹‰å®ƒï¼Œæ‰€å¾—åˆ°çš„ç±» com.bundleA.Sampleå®ä¾‹å°±å¯ä»¥è¢«æ‰€æœ‰å£°æ˜å¯¼å…¥äº†æ­¤ç±»çš„æ¨¡å—ä½¿ç”¨ã€‚å¯¹äºä»¥ javaå¼€å¤´çš„ç±»ï¼Œéƒ½æ˜¯ç”±çˆ¶ç±»åŠ è½½å™¨æ¥åŠ è½½çš„ã€‚å¦‚æœå£°æ˜äº†ç³»ç»Ÿå±æ€§ org.osgi.framework.bootdelegation=com.example.core.*ï¼Œé‚£ä¹ˆå¯¹äºåŒ… com.example.coreä¸­çš„ç±»ï¼Œéƒ½æ˜¯ç”±çˆ¶ç±»åŠ è½½å™¨æ¥å®Œæˆçš„ã€‚ OSGi æ¨¡å—çš„è¿™ç§ç±»åŠ è½½å™¨ç»“æ„ï¼Œä½¿å¾—ä¸€ä¸ªç±»çš„ä¸åŒç‰ˆæœ¬å¯ä»¥å…±å­˜åœ¨ Java è™šæ‹Ÿæœºä¸­ï¼Œå¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚ä¸è¿‡å®ƒçš„è¿™ç§ä¸åŒï¼Œä¹Ÿä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥ä¸€äº›éº»çƒ¦ï¼Œå°¤å…¶å½“æ¨¡å—éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„åº“çš„æ—¶å€™ã€‚ä¸‹é¢æä¾›å‡ æ¡æ¯”è¾ƒå¥½çš„å»ºè®®ï¼š å¦‚æœä¸€ä¸ªç±»åº“åªæœ‰ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼ŒæŠŠè¯¥ç±»åº“çš„ jar åŒ…æ”¾åœ¨æ¨¡å—ä¸­ï¼Œåœ¨ Bundle-ClassPathä¸­æŒ‡æ˜å³å¯ã€‚ å¦‚æœä¸€ä¸ªç±»åº“è¢«å¤šä¸ªæ¨¡å—å…±ç”¨ï¼Œå¯ä»¥ä¸ºè¿™ä¸ªç±»åº“å•ç‹¬çš„åˆ›å»ºä¸€ä¸ªæ¨¡å—ï¼ŒæŠŠå…¶å®ƒæ¨¡å—éœ€è¦ç”¨åˆ°çš„ Java åŒ…å£°æ˜ä¸ºå¯¼å‡ºçš„ã€‚å…¶å®ƒæ¨¡å—å£°æ˜å¯¼å…¥è¿™äº›ç±»ã€‚ å¦‚æœç±»åº“æä¾›äº† SPI æ¥å£ï¼Œå¹¶ä¸”åˆ©ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥åŠ è½½ SPI å®ç°çš„ Java ç±»ï¼Œæœ‰å¯èƒ½ä¼šæ‰¾ä¸åˆ° Java ç±»ã€‚å¦‚æœå‡ºç°äº† NoClassDefFoundErrorå¼‚å¸¸ï¼Œé¦–å…ˆæ£€æŸ¥å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯å¦æ­£ç¡®ã€‚é€šè¿‡ Thread.currentThread().getContextClassLoader()å°±å¯ä»¥å¾—åˆ°è¯¥ç±»åŠ è½½å™¨ã€‚è¯¥ç±»åŠ è½½å™¨åº”è¯¥æ˜¯è¯¥æ¨¡å—å¯¹åº”çš„ç±»åŠ è½½å™¨ã€‚å¦‚æœä¸æ˜¯çš„è¯ï¼Œå¯ä»¥é¦–å…ˆé€šè¿‡ class.getClassLoader()æ¥å¾—åˆ°æ¨¡å—å¯¹åº”çš„ç±»åŠ è½½å™¨ï¼Œå†é€šè¿‡ Thread.currentThread().setContextClassLoader()æ¥è®¾ç½®å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚ æ€»ç»“ç±»åŠ è½½å™¨æ˜¯ Java è¯­è¨€çš„ä¸€ä¸ªåˆ›æ–°ã€‚å®ƒä½¿å¾—åŠ¨æ€å®‰è£…å’Œæ›´æ–°è½¯ä»¶ç»„ä»¶æˆä¸ºå¯èƒ½ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†ç±»åŠ è½½å™¨çš„ç›¸å…³è¯é¢˜ï¼ŒåŒ…æ‹¬åŸºæœ¬æ¦‚å¿µã€ä»£ç†æ¨¡å¼ã€çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€ä¸ Web å®¹å™¨å’Œ OSGi çš„å…³ç³»ç­‰ã€‚å¼€å‘äººå‘˜åœ¨é‡åˆ° ClassNotFoundExceptionå’Œ NoClassDefFoundErrorç­‰å¼‚å¸¸çš„æ—¶å€™ï¼Œåº”è¯¥æ£€æŸ¥æŠ›å‡ºå¼‚å¸¸çš„ç±»çš„ç±»åŠ è½½å™¨å’Œå½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œä»ä¸­å¯ä»¥å‘ç°é—®é¢˜çš„æ‰€åœ¨ã€‚åœ¨å¼€å‘è‡ªå·±çš„ç±»åŠ è½½å™¨çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸å·²æœ‰çš„ç±»åŠ è½½å™¨ç»„ç»‡ç»“æ„çš„åè°ƒã€‚ å‚è€ƒæ–‡çŒ®ï¼šhttps://www.ibm.com/developerworks/cn/java/j-lo-classloader/ http://www.blogjava.net/lihao336/archive/2009/09/17/295489.html http://kenwublog.com/structure-of-java-class-loader","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--Javaç±»åŠ è½½åŸç†è§£æ","slug":"æ·±å…¥ç†è§£JVMä¹‹--Javaç±»åŠ è½½åŸç†è§£æ","date":"2020-05-30T09:48:38.000Z","updated":"2023-04-30T10:21:41.370Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--Javaç±»åŠ è½½åŸç†è§£æ/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--Javaç±»åŠ è½½åŸç†è§£æ/","excerpt":"","text":"è½¬è½½è‡ªï¼šã€Šæ·±å…¥ç†è§£Javaç±»åŠ è½½å™¨(1)ï¼šJavaç±»åŠ è½½åŸç†è§£æã€‹ ä¸€ã€å‰è¨€æ¯ä¸ªå¼€å‘äººå‘˜å¯¹Java.lang.ClassNotFoundExcetpionè¿™ä¸ªå¼‚å¸¸è‚¯å®šéƒ½ä¸é™Œç”Ÿï¼Œè¿™èƒŒåå°±æ¶‰åŠåˆ°äº†javaæŠ€æœ¯ä½“ç³»ä¸­çš„ç±»åŠ è½½ã€‚Javaçš„ç±»åŠ è½½æœºåˆ¶æ˜¯æŠ€æœ¯ä½“ç³»ä¸­æ¯”è¾ƒæ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œè™½ç„¶å’Œå¤§éƒ¨åˆ†å¼€å‘äººå‘˜ç›´æ¥æ‰“äº¤é“ä¸å¤šï¼Œä½†æ˜¯å¯¹å…¶èƒŒåçš„æœºç†æœ‰ä¸€å®šç†è§£æœ‰åŠ©äºæ’æŸ¥ç¨‹åºä¸­å‡ºç°çš„ç±»åŠ è½½å¤±è´¥ç­‰æŠ€æœ¯é—®é¢˜ï¼Œå¯¹ç†è§£javaè™šæ‹Ÿæœºçš„è¿æ¥æ¨¡å‹å’Œjavaè¯­è¨€çš„åŠ¨æ€æ€§éƒ½æœ‰å¾ˆå¤§å¸®åŠ©ã€‚ äºŒã€Javaç±»åŠ è½½å™¨2.1JVMä¸‰ç§é¢„å®šä¹‰ç±»å‹ç±»åŠ è½½å™¨æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹JVMé¢„å®šä¹‰çš„ä¸‰ç§ç±»å‹ç±»åŠ è½½å™¨ï¼Œå½“ä¸€ä¸ª JVMå¯åŠ¨çš„æ—¶å€™ï¼ŒJavaç¼ºçœå¼€å§‹ä½¿ç”¨å¦‚ä¸‹ä¸‰ç§ç±»å‹ç±»è£…å…¥å™¨ï¼š å¯åŠ¨ï¼ˆBootstrapï¼‰ç±»åŠ è½½å™¨ï¼šå¼•å¯¼ç±»è£…å…¥å™¨æ˜¯ç”¨æœ¬åœ°ä»£ç å®ç°çš„ç±»è£…å…¥å™¨ï¼Œå®ƒè´Ÿè´£å°† &lt;Java_Runtime_Home&gt;/libä¸‹é¢çš„æ ¸å¿ƒç±»åº“æˆ–-Xbootclasspathé€‰é¡¹æŒ‡å®šçš„jaråŒ…åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç”±äºå¼•å¯¼ç±»åŠ è½½å™¨æ¶‰åŠåˆ°è™šæ‹Ÿæœºæœ¬åœ°å®ç°ç»†èŠ‚ï¼Œå¼€å‘è€…æ— æ³•ç›´æ¥è·å–åˆ°å¯åŠ¨ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œæ‰€ä»¥ä¸å…è®¸ç›´æ¥é€šè¿‡å¼•ç”¨è¿›è¡Œæ“ä½œã€‚ æ‰©å±•ï¼ˆExtensionï¼‰ç±»åŠ è½½å™¨ï¼šæ‰©å±•ç±»åŠ è½½å™¨æ˜¯ç”±Sunçš„ExtClassLoaderï¼ˆsun.misc.Launcher$ExtClassLoaderï¼‰å®ç°çš„ã€‚å®ƒè´Ÿè´£å°†&lt; Java_Runtime_Home &gt;/lib/extæˆ–è€…ç”±ç³»ç»Ÿå˜é‡-Djava.ext.diræŒ‡å®šä½ç½®ä¸­çš„ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ã€‚ ç³»ç»Ÿï¼ˆSystemï¼‰ç±»åŠ è½½å™¨ï¼šç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯ç”± Sunçš„ AppClassLoaderï¼ˆsun.misc.Launcher$AppClassLoaderï¼‰å®ç°çš„ã€‚å®ƒè´Ÿè´£å°†ç³»ç»Ÿç±»è·¯å¾„java -classpathæˆ–-Djava.class.pathå˜é‡æ‰€æŒ‡çš„ç›®å½•ä¸‹çš„ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ é™¤äº†ä»¥ä¸Šåˆ—ä¸¾çš„ä¸‰ç§ç±»åŠ è½½å™¨ï¼Œè¿˜æœ‰ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹å°±æ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œè¿™ä¸ªå°†åœ¨åé¢å•ç‹¬ä»‹ç»ã€‚ 2.2 ç±»åŠ è½½åŒäº²å§”æ´¾æœºåˆ¶ åœ¨è¿™é‡Œï¼Œéœ€è¦ç€é‡è¯´æ˜çš„æ˜¯ï¼ŒJVMåœ¨åŠ è½½ç±»æ—¶é»˜è®¤é‡‡ç”¨çš„æ˜¯åŒäº²å§”æ´¾æœºåˆ¶ã€‚é€šä¿—çš„è®²ï¼Œå°±æ˜¯æŸä¸ªç‰¹å®šçš„ç±»åŠ è½½å™¨åœ¨æ¥åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œé¦–å…ˆå°†åŠ è½½ä»»åŠ¡å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œä¾æ¬¡é€’å½’ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼›åªæœ‰çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡æ—¶ï¼Œæ‰è‡ªå·±å»åŠ è½½ã€‚å…³äºè™šæ‹Ÿæœºé»˜è®¤çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç³»ç»Ÿç±»åŠ è½½å™¨å’Œæ‰©å±•ç±»åŠ è½½å™¨ä¸ºä¾‹ä½œç®€å•åˆ†æã€‚ å›¾ä¸€ æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ç»§æ‰¿å±‚æ¬¡å›¾ å›¾äºŒ ç³»ç»Ÿç±»åŠ è½½å™¨ç»§æ‰¿å±‚æ¬¡å›¾ é€šè¿‡å›¾ä¸€å’Œå›¾äºŒæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç±»åŠ è½½å™¨å‡æ˜¯ç»§æ‰¿è‡ªjava.lang.ClassLoaderæŠ½è±¡ç±»ã€‚æˆ‘ä»¬ä¸‹é¢æˆ‘ä»¬å°±çœ‹ç®€è¦ä»‹ç»ä¸€ä¸‹java.lang.ClassLoaderä¸­å‡ ä¸ªæœ€é‡è¦çš„æ–¹æ³•ï¼š //åŠ è½½æŒ‡å®šåç§°ï¼ˆåŒ…æ‹¬åŒ…åï¼‰çš„äºŒè¿›åˆ¶ç±»å‹ï¼Œä¾›ç”¨æˆ·è°ƒç”¨çš„æ¥å£ public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException{ â€¦ } //åŠ è½½æŒ‡å®šåç§°ï¼ˆåŒ…æ‹¬åŒ…åï¼‰çš„äºŒè¿›åˆ¶ç±»å‹ï¼ŒåŒæ—¶æŒ‡å®šæ˜¯å¦è§£æï¼ˆä½†æ˜¯è¿™é‡Œçš„resolveå‚æ•°ä¸ä¸€å®šçœŸæ­£èƒ½è¾¾åˆ°è§£æçš„æ•ˆæœï¼‰ï¼Œä¾›ç»§æ‰¿ç”¨ protected synchronized Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException{ â€¦ } //findClassæ–¹æ³•ä¸€èˆ¬è¢«loadClassæ–¹æ³•è°ƒç”¨å»åŠ è½½æŒ‡å®šåç§°ç±»ï¼Œä¾›ç»§æ‰¿ç”¨ protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException { â€¦ } //å®šä¹‰ç±»å‹ï¼Œä¸€èˆ¬åœ¨findClassæ–¹æ³•ä¸­è¯»å–åˆ°å¯¹åº”å­—èŠ‚ç åè°ƒç”¨ï¼Œå¯ä»¥çœ‹å‡ºä¸å¯ç»§æ‰¿ //ï¼ˆè¯´æ˜ï¼šJVMå·²ç»å®ç°äº†å¯¹åº”çš„å…·ä½“åŠŸèƒ½ï¼Œè§£æå¯¹åº”çš„å­—èŠ‚ç ï¼Œäº§ç”Ÿå¯¹åº”çš„å†…éƒ¨æ•°æ®ç»“æ„æ”¾ç½®åˆ°æ–¹æ³•åŒºï¼Œæ‰€ä»¥æ— éœ€è¦†å†™ï¼Œç›´æ¥è°ƒç”¨å°±å¯ä»¥äº†ï¼‰ protected final Class&lt;?&gt; defineClass(String name, byte[] b, int off, int len) throws ClassFormatError{ â€¦ } é€šè¿‡è¿›ä¸€æ­¥åˆ†ææ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆsun.misc.Launcher$ExtClassLoaderï¼‰å’Œç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆsun.misc.Launcher$AppClassLoaderï¼‰çš„ä»£ç ä»¥åŠå…¶å…¬å…±çˆ¶ç±»ï¼ˆjava.net.URLClassLoaderå’Œjava.security.SecureClassLoaderï¼‰çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œéƒ½æ²¡æœ‰è¦†å†™java.lang.ClassLoaderä¸­é»˜è®¤çš„åŠ è½½å§”æ´¾è§„åˆ™â€”loadClassï¼ˆâ€¦ï¼‰æ–¹æ³•ã€‚æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åˆ†æjava.lang.ClassLoaderä¸­çš„loadClassï¼ˆString nameï¼‰æ–¹æ³•çš„ä»£ç å°±å¯ä»¥åˆ†æå‡ºè™šæ‹Ÿæœºé»˜è®¤é‡‡ç”¨çš„åŒäº²å§”æ´¾æœºåˆ¶åˆ°åº•æ˜¯ä»€ä¹ˆæ¨¡æ ·ï¼š public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException { return loadClass(name, false); } protected synchronized Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { // é¦–å…ˆåˆ¤æ–­è¯¥ç±»å‹æ˜¯å¦å·²ç»è¢«åŠ è½½ Class c = findLoadedClass(name); if (c == null) { //å¦‚æœæ²¡æœ‰è¢«åŠ è½½ï¼Œå°±å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½æˆ–è€…å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ try { if (parent != null) { //å¦‚æœå­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œå°±å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½ c = parent.loadClass(name, false); } else { //å¦‚æœä¸å­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œå°±æ£€æŸ¥æ˜¯å¦æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œ //é€šè¿‡è°ƒç”¨æœ¬åœ°æ–¹æ³•native findBootstrapClass0(String name) c = findBootstrapClass0(name); } } catch (ClassNotFoundException e) { // å¦‚æœçˆ¶ç±»åŠ è½½å™¨å’Œå¯åŠ¨ç±»åŠ è½½å™¨éƒ½ä¸èƒ½å®ŒæˆåŠ è½½ä»»åŠ¡ï¼Œæ‰è°ƒç”¨è‡ªèº«çš„åŠ è½½åŠŸèƒ½ c = findClass(name); } } if (resolve) { resolveClass(c); } return c; } é€šè¿‡ä¸Šé¢çš„ä»£ç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¯¹JVMé‡‡ç”¨çš„åŒäº²å§”æ´¾ç±»åŠ è½½æœºåˆ¶æœ‰äº†æ›´æ„Ÿæ€§çš„è®¤è¯†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥ç€åˆ†æä¸€ä¸‹å¯åŠ¨ç±»åŠ è½½å™¨ã€æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨ä¸‰è€…ä¹‹é—´çš„å…³ç³»ã€‚å¯èƒ½å¤§å®¶å·²ç»ä»å„ç§èµ„æ–™ä¸Šé¢çœ‹åˆ°äº†å¦‚ä¸‹ç±»ä¼¼çš„ä¸€å¹…å›¾ç‰‡ï¼š å›¾ä¸‰ ç±»åŠ è½½å™¨é»˜è®¤å§”æ´¾å…³ç³»å›¾ ä¸Šé¢å›¾ç‰‡ç»™äººçš„ç›´è§‚å°è±¡æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œä¸‹é¢æˆ‘ä»¬å°±ç”¨ä»£ç å…·ä½“æµ‹è¯•ä¸€ä¸‹ï¼š public class LoaderTest { public static void main(String[] args) { try { System.out.println(ClassLoader.getSystemClassLoader()); System.out.println(ClassLoader.getSystemClassLoader().getParent()); System.out.println(ClassLoader.getSystemClassLoader().getParent().getParent()); } catch (Exception e) { e.printStackTrace(); } } } è¯´æ˜ï¼šé€šè¿‡java.lang.ClassLoader.getSystemClassLoader()å¯ä»¥ç›´æ¥è·å–åˆ°ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ ä»£ç è¾“å‡ºå¦‚ä¸‹ï¼š sun.misc.Launcher$AppClassLoader@6d06d69csun.misc.Launcher$ExtClassLoader@70dea4enull é€šè¿‡ä»¥ä¸Šçš„ä»£ç è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤å®šç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨æ˜¯æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬è¯•å›¾è·å–æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ—¶ç¡®å¾—åˆ°äº†nullï¼Œå°±æ˜¯è¯´æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨æœ¬èº«å¼ºåˆ¶è®¾å®šçˆ¶ç±»åŠ è½½å™¨ä¸ºnullã€‚æˆ‘ä»¬è¿˜æ˜¯å€ŸåŠ©äºä»£ç åˆ†æä¸€ä¸‹ã€‚ æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹java.lang.ClassLoaderæŠ½è±¡ç±»ä¸­é»˜è®¤å®ç°çš„ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼š protected ClassLoader() { SecurityManager security = System.getSecurityManager(); if (security != null) { security.checkCreateClassLoader(); } //é»˜è®¤å°†çˆ¶ç±»åŠ è½½å™¨è®¾ç½®ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒgetSystemClassLoader()è·å–ç³»ç»Ÿç±»åŠ è½½å™¨ this.parent = getSystemClassLoader(); initialized = true; } protected ClassLoader(ClassLoader parent) { SecurityManager security = System.getSecurityManager(); if (security != null) { security.checkCreateClassLoader(); } //å¼ºåˆ¶è®¾ç½®çˆ¶ç±»åŠ è½½å™¨ this.parent = parent; initialized = true; } æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ClassLoaderæŠ½è±¡ç±»ä¸­parentæˆå‘˜çš„å£°æ˜ï¼š // The parent class loader for delegation private ClassLoader parent; å£°æ˜ä¸ºç§æœ‰å˜é‡çš„åŒæ—¶å¹¶æ²¡æœ‰å¯¹å¤–æä¾›å¯ä¾›æ´¾ç”Ÿç±»è®¿é—®çš„publicæˆ–è€…protectedè®¾ç½®å™¨æ¥å£ï¼ˆå¯¹åº”çš„setteræ–¹æ³•ï¼‰ï¼Œç»“åˆå‰é¢çš„æµ‹è¯•ä»£ç çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºï¼š ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰è°ƒç”¨ClassLoader(ClassLoader parent)æ„é€ å‡½æ•°å°†çˆ¶ç±»åŠ è½½å™¨è®¾ç½®ä¸ºæ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨(ExtClassLoader)ã€‚ï¼ˆå› ä¸ºå¦‚æœä¸å¼ºåˆ¶è®¾ç½®ï¼Œé»˜è®¤ä¼šé€šè¿‡è°ƒç”¨getSystemClassLoader()æ–¹æ³•è·å–å¹¶è®¾ç½®æˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œè¿™æ˜¾ç„¶å’Œæµ‹è¯•è¾“å‡ºç»“æœä¸ç¬¦ã€‚ï¼‰ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtClassLoaderï¼‰è°ƒç”¨ClassLoader(ClassLoader parent)æ„é€ å‡½æ•°å°†çˆ¶ç±»åŠ è½½å™¨è®¾ç½®ä¸ºnullã€‚ï¼ˆå› ä¸ºå¦‚æœä¸å¼ºåˆ¶è®¾ç½®ï¼Œé»˜è®¤ä¼šé€šè¿‡è°ƒç”¨getSystemClassLoader()æ–¹æ³•è·å–å¹¶è®¾ç½®æˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œè¿™æ˜¾ç„¶å’Œæµ‹è¯•è¾“å‡ºç»“æœä¸ç¬¦ã€‚ï¼‰ ç°åœ¨æˆ‘ä»¬å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šæ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtClassLoaderï¼‰çš„çˆ¶ç±»åŠ è½½å™¨è¢«å¼ºåˆ¶è®¾ç½®ä¸ºnulläº†ï¼Œé‚£ä¹ˆæ‰©å±•ç±»åŠ è½½å™¨ä¸ºä»€ä¹ˆè¿˜èƒ½å°†åŠ è½½ä»»åŠ¡å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨å‘¢ï¼Ÿ å›¾å›› æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨æˆå‘˜å¤§çº²è§†å›¾ å›¾äº” æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨å…¬å…±çˆ¶ç±»æˆå‘˜å¤§çº²è§†å›¾ é€šè¿‡å›¾å››å’Œå›¾äº”å¯ä»¥çœ‹å‡ºï¼Œæ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åŠå…¶çˆ¶ç±»ï¼ˆjava.NET.URLClassLoaderå’Œjava.security.SecureClassLoaderï¼‰éƒ½æ²¡æœ‰è¦†å†™java.lang.ClassLoaderä¸­é»˜è®¤çš„åŠ è½½å§”æ´¾è§„åˆ™â€”loadClassï¼ˆâ€¦ï¼‰æ–¹æ³•ã€‚æœ‰å…³java.lang.ClassLoaderä¸­é»˜è®¤çš„åŠ è½½å§”æ´¾è§„åˆ™å‰é¢å·²ç»åˆ†æè¿‡ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨ä¸ºnullï¼Œåˆ™ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•è¿›è¡Œå¯åŠ¨ç±»åŠ è½½å°è¯•ã€‚æ‰€ä»¥ï¼Œå›¾ä¸‰ä¸­ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨ã€æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨ä¹‹é—´çš„å§”æ´¾å…³ç³»äº‹å®ä¸Šæ˜¯ä»å°±æˆç«‹çš„ã€‚ï¼ˆåœ¨åé¢çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨éƒ¨åˆ†ï¼Œè¿˜ä¼šåšæ›´æ·±å…¥çš„åˆ†æï¼‰ã€‚ 2.3 ç±»åŠ è½½åŒäº²å§”æ´¾ç¤ºä¾‹ä»¥ä¸Šå·²ç»ç®€è¦ä»‹ç»äº†è™šæ‹Ÿæœºé»˜è®¤ä½¿ç”¨çš„å¯åŠ¨ç±»åŠ è½½å™¨ã€æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œå¹¶ä»¥ä¸‰è€…ä¸ºä¾‹ç»“åˆJDKä»£ç å¯¹JVMé»˜è®¤ä½¿ç”¨çš„åŒäº²å§”æ´¾ç±»åŠ è½½æœºåˆ¶åšäº†åˆ†æã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸ªç»¼åˆçš„ä¾‹å­ã€‚é¦–å…ˆåœ¨IDEä¸­å»ºç«‹ä¸€ä¸ªç®€å•çš„javaåº”ç”¨å·¥ç¨‹ï¼Œç„¶åå†™ä¸€ä¸ªç®€å•çš„JavaBeanå¦‚ä¸‹ï¼š package classloader.test.bean; public class TestBean { public TestBean() { } } åœ¨ç°æœ‰å½“å‰å·¥ç¨‹ä¸­å¦å¤–å»ºç«‹ä¸€æµ‹è¯•ç±»ï¼ˆClassLoaderTest.javaï¼‰å†…å®¹å¦‚ä¸‹ï¼š æµ‹è¯•ä¸€ï¼š package classloader.test.bean; public class ClassLoaderTest { public static void main(String[] args) { try { //æŸ¥çœ‹å½“å‰ç³»ç»Ÿç±»è·¯å¾„ä¸­åŒ…å«çš„è·¯å¾„æ¡ç›® System.out.println(System.getProperty(&quot;java.class.path&quot;)); //è°ƒç”¨åŠ è½½å½“å‰ç±»çš„ç±»åŠ è½½å™¨ï¼ˆè¿™é‡Œå³ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰åŠ è½½TestBean Class typeLoaded = Class.forName(&quot;classloader.test.bean.TestBean&quot;); //æŸ¥çœ‹è¢«åŠ è½½çš„TestBeanç±»å‹æ˜¯è¢«é‚£ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„ System.out.println(typeLoaded.getClassLoader()); } catch (Exception e) { e.printStackTrace(); } } } å¯¹åº”çš„è¾“å‡ºå¦‚ä¸‹ï¼š C:\\Users\\JackZhou\\Documents\\NetBeansProjects\\ClassLoaderTest\\build\\classessun.misc.Launcher$AppClassLoader@73d16e93 è¯´æ˜ï¼šå½“å‰ç±»è·¯å¾„é»˜è®¤çš„å«æœ‰çš„ä¸€ä¸ªæ¡ç›®å°±æ˜¯å·¥ç¨‹çš„è¾“å‡ºç›®å½•ã€‚ æµ‹è¯•äºŒï¼š å°†å½“å‰å·¥ç¨‹è¾“å‡ºç›®å½•ä¸‹çš„TestBean.classæ‰“åŒ…è¿›test.jarå‰ªè´´åˆ°&lt;Java_Runtime_Home&gt;/lib/extç›®å½•ä¸‹ï¼ˆç°åœ¨å·¥ç¨‹è¾“å‡ºç›®å½•ä¸‹å’ŒJREæ‰©å±•ç›®å½•ä¸‹éƒ½æœ‰å¾…åŠ è½½ç±»å‹çš„classæ–‡ä»¶ï¼‰ã€‚å†è¿è¡Œæµ‹è¯•ä¸€æµ‹è¯•ä»£ç ï¼Œç»“æœå¦‚ä¸‹ï¼š C:\\Users\\JackZhou\\Documents\\NetBeansProjects\\ClassLoaderTest\\build\\classessun.misc.Launcher$ExtClassLoader@15db9742 å¯¹æ¯”æµ‹è¯•ä¸€å’Œæµ‹è¯•äºŒï¼Œæˆ‘ä»¬æ˜æ˜¾å¯ä»¥éªŒè¯å‰é¢è¯´çš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨æ¥åˆ°åŠ è½½classloader.test.bean.TestBeanç±»å‹çš„è¯·æ±‚æ—¶ï¼Œé¦–å…ˆå°†è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼ˆæ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼‰ï¼Œæ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨æŠ¢å…ˆå®Œæˆäº†åŠ è½½è¯·æ±‚ã€‚ æµ‹è¯•ä¸‰ï¼š å°†test.jaræ‹·è´ä¸€ä»½åˆ°&lt;Java_Runtime_Home&gt;/libä¸‹ï¼Œè¿è¡Œæµ‹è¯•ä»£ç ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š C:\\Users\\JackZhou\\Documents\\NetBeansProjects\\ClassLoaderTest\\build\\classessun.misc.Launcher$ExtClassLoader@15db9742 æµ‹è¯•ä¸‰å’Œæµ‹è¯•äºŒè¾“å‡ºç»“æœä¸€è‡´ã€‚é‚£å°±æ˜¯è¯´ï¼Œæ”¾ç½®åˆ°Â·&lt;Java_Runtime_Home&gt;/libÂ·ç›®å½•ä¸‹çš„Â·TestBeanÂ·å¯¹åº”çš„classå­—èŠ‚ç å¹¶æ²¡æœ‰è¢«åŠ è½½ï¼Œè¿™å…¶å®å’Œå‰é¢è®²çš„åŒäº²å§”æ´¾æœºåˆ¶å¹¶ä¸çŸ›ç›¾ã€‚è™šæ‹Ÿæœºå‡ºäºå®‰å…¨ç­‰å› ç´ è€ƒè™‘ï¼Œä¸ä¼šåŠ è½½Â·&lt;Java_Runtime_Home&gt;/libÂ·å­˜åœ¨çš„é™Œç”Ÿç±»ï¼Œå¼€å‘è€…é€šè¿‡å°†è¦åŠ è½½çš„éJDKè‡ªèº«çš„ç±»æ”¾ç½®åˆ°æ­¤ç›®å½•ä¸‹æœŸå¾…å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½æ˜¯ä¸å¯èƒ½çš„ã€‚åšä¸ªè¿›ä¸€æ­¥éªŒè¯ï¼Œåˆ é™¤Â·&lt;Java_Runtime_Home&gt;/lib/extÂ·ç›®å½•ä¸‹å’Œå·¥ç¨‹è¾“å‡ºç›®å½•ä¸‹çš„TestBeanå¯¹åº”çš„classæ–‡ä»¶ï¼Œç„¶åå†è¿è¡Œæµ‹è¯•ä»£ç ï¼Œåˆ™å°†ä¼šæœ‰Â·ClassNotFoundExceptionÂ·å¼‚å¸¸æŠ›å‡ºã€‚æœ‰å…³è¿™ä¸ªé—®é¢˜ï¼Œå¤§å®¶å¯ä»¥åœ¨Â·java.lang.ClassLoaderÂ·ä¸­çš„Â·loadClass(String name, boolean resolve)Â·æ–¹æ³•ä¸­è®¾ç½®ç›¸åº”æ–­ç‚¹è¿è¡Œæµ‹è¯•ä¸‰è¿›è¡Œè°ƒè¯•ï¼Œä¼šå‘ç°Â·findBootstrapClass0()Â·ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç„¶ååœ¨ä¸‹é¢çš„findClassæ–¹æ³•ä¸­è¢«åŠ è½½ï¼Œå½“å‰è¿è¡Œçš„ç±»åŠ è½½å™¨æ­£æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆÂ·sun.misc.Launcher$ExtClassLoaderÂ·ï¼‰ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡JDTä¸­å˜é‡è§†å›¾æŸ¥çœ‹éªŒè¯ã€‚ ä¸‰ã€javaç¨‹åºåŠ¨æ€æ‰©å±•æ–¹å¼Javaçš„è¿æ¥æ¨¡å‹å…è®¸ç”¨æˆ·è¿è¡Œæ—¶æ‰©å±•å¼•ç”¨ç¨‹åºï¼Œæ—¢å¯ä»¥é€šè¿‡å½“å‰è™šæ‹Ÿæœºä¸­é¢„å®šä¹‰çš„åŠ è½½å™¨åŠ è½½ç¼–è¯‘æ—¶å·²çŸ¥çš„ç±»æˆ–è€…æ¥å£ï¼Œåˆå…è®¸ç”¨æˆ·è‡ªè¡Œå®šä¹‰ç±»è£…è½½å™¨ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€æ‰©å±•ç”¨æˆ·çš„ç¨‹åºã€‚é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»è£…è½½å™¨ï¼Œä½ çš„ç¨‹åºå¯ä»¥è£…è½½åœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“æˆ–è€…å°šæœªå­˜åœ¨çš„ç±»æˆ–è€…æ¥å£ï¼Œå¹¶åŠ¨æ€è¿æ¥å®ƒä»¬å¹¶è¿›è¡Œæœ‰é€‰æ‹©çš„è§£æã€‚ è¿è¡Œæ—¶åŠ¨æ€æ‰©å±•javaåº”ç”¨ç¨‹åºæœ‰å¦‚ä¸‹ä¸¤ä¸ªé€”å¾„ï¼š 3.1 è°ƒç”¨java.lang.Class.forName(â€¦)åŠ è½½ç±»è¿™ä¸ªæ–¹æ³•å…¶å®åœ¨å‰é¢å·²ç»è®¨è®ºè¿‡ï¼Œåœ¨åé¢çš„é—®é¢˜2è§£ç­”ä¸­è¯´æ˜äº†è¯¥æ–¹æ³•è°ƒç”¨ä¼šè§¦å‘å“ªä¸ªç±»åŠ è½½å™¨å¼€å§‹åŠ è½½ä»»åŠ¡ã€‚è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯å¤šå‚æ•°ç‰ˆæœ¬çš„forName(â€¦)æ–¹æ³•ï¼š public static Class&lt;?&gt; forName(String name, boolean initialize, ClassLoader loader) throws ClassNotFoundException è¿™é‡Œçš„initializeå‚æ•°æ˜¯å¾ˆé‡è¦çš„ã€‚å®ƒè¡¨ç¤ºåœ¨åŠ è½½åŒæ—¶æ˜¯å¦å®Œæˆåˆå§‹åŒ–çš„å·¥ä½œï¼ˆè¯´æ˜ï¼šå•å‚æ•°ç‰ˆæœ¬çš„forNameæ–¹æ³•é»˜è®¤æ˜¯å®Œæˆåˆå§‹åŒ–çš„ï¼‰ã€‚æœ‰äº›åœºæ™¯ä¸‹éœ€è¦å°†initializeè®¾ç½®ä¸ºtrueæ¥å¼ºåˆ¶åŠ è½½åŒæ—¶å®Œæˆåˆå§‹åŒ–ã€‚ä¾‹å¦‚å…¸å‹çš„å°±æ˜¯åˆ©ç”¨DriverManagerè¿›è¡ŒJDBCé©±åŠ¨ç¨‹åºç±»æ³¨å†Œçš„é—®é¢˜ã€‚å› ä¸ºæ¯ä¸€ä¸ªJDBCé©±åŠ¨ç¨‹åºç±»çš„é™æ€åˆå§‹åŒ–æ–¹æ³•éƒ½ç”¨DriverManageræ³¨å†Œé©±åŠ¨ç¨‹åºï¼Œè¿™æ ·æ‰èƒ½è¢«åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚è¿™å°±è¦æ±‚é©±åŠ¨ç¨‹åºç±»å¿…é¡»è¢«åˆå§‹åŒ–ï¼Œè€Œä¸å•å•è¢«åŠ è½½ã€‚Class.forNameçš„ä¸€ä¸ªå¾ˆå¸¸è§çš„ç”¨æ³•å°±æ˜¯åœ¨åŠ è½½æ•°æ®åº“é©±åŠ¨çš„æ—¶å€™ã€‚å¦‚ Class.forName(â€œorg.apache.derby.jdbc.EmbeddedDriverâ€).newInstance()ç”¨æ¥åŠ è½½ Apache Derby æ•°æ®åº“çš„é©±åŠ¨ã€‚ 3.2 ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨é€šè¿‡å‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé™¤äº†å’Œæœ¬åœ°å®ç°å¯†åˆ‡ç›¸å…³çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¹‹å¤–ï¼ŒåŒ…æ‹¬æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨å’Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨å†…çš„æ‰€æœ‰å…¶ä»–ç±»åŠ è½½å™¨æˆ‘ä»¬éƒ½å¯ä»¥å½“åšè‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥å¯¹å¾…ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯æ˜¯å¦è¢«è™šæ‹Ÿæœºé»˜è®¤ä½¿ç”¨ã€‚å‰é¢çš„å†…å®¹ä¸­å·²ç»å¯¹java.lang.ClassLoaderæŠ½è±¡ç±»ä¸­çš„å‡ ä¸ªé‡è¦çš„æ–¹æ³•åšäº†ä»‹ç»ï¼Œè¿™é‡Œå°±ç®€è¦å™è¿°ä¸€ä¸‹ä¸€èˆ¬ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„å·¥ä½œæµç¨‹å§ï¼ˆå¯ä»¥ç»“åˆåé¢é—®é¢˜è§£ç­”ä¸€èµ·çœ‹ï¼‰ï¼š é¦–å…ˆæ£€æŸ¥è¯·æ±‚çš„ç±»å‹æ˜¯å¦å·²ç»è¢«è¿™ä¸ªç±»è£…è½½å™¨è£…è½½åˆ°å‘½åç©ºé—´ä¸­äº†ï¼Œå¦‚æœå·²ç»è£…è½½ï¼Œç›´æ¥è¿”å›ï¼›å¦åˆ™è½¬å…¥æ­¥éª¤2ï¼› å§”æ´¾ç±»åŠ è½½è¯·æ±‚ç»™çˆ¶ç±»åŠ è½½å™¨ï¼ˆæ›´å‡†ç¡®çš„è¯´åº”è¯¥æ˜¯åŒäº²ç±»åŠ è½½å™¨ï¼ŒçœŸå®è™šæ‹Ÿæœºä¸­å„ç§ç±»åŠ è½½å™¨æœ€ç»ˆä¼šå‘ˆç°æ ‘çŠ¶ç»“æ„ï¼‰ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨èƒ½å¤Ÿå®Œæˆï¼Œåˆ™è¿”å›çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„Classå®ä¾‹ï¼›å¦åˆ™è½¬å…¥æ­¥éª¤3ï¼› è°ƒç”¨æœ¬ç±»åŠ è½½å™¨çš„findClassï¼ˆâ€¦ï¼‰æ–¹æ³•ï¼Œè¯•å›¾è·å–å¯¹åº”çš„å­—èŠ‚ç ï¼Œå¦‚æœè·å–çš„åˆ°ï¼Œåˆ™è°ƒç”¨defineClassï¼ˆâ€¦ï¼‰å¯¼å…¥ç±»å‹åˆ°æ–¹æ³•åŒºï¼›å¦‚æœè·å–ä¸åˆ°å¯¹åº”çš„å­—èŠ‚ç æˆ–è€…å…¶ä»–åŸå› å¤±è´¥ï¼Œè¿”å›å¼‚å¸¸ç»™loadClassï¼ˆâ€¦ï¼‰ï¼Œ loadClassï¼ˆâ€¦ï¼‰è½¬è€ŒæŠ›å¼‚å¸¸ï¼Œç»ˆæ­¢åŠ è½½è¿‡ç¨‹ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„å¼‚å¸¸ç§ç±»ä¸æ­¢ä¸€ç§ï¼‰ã€‚ è¯´æ˜ï¼šè¿™é‡Œè¯´çš„è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ˜¯æŒ‡JDK 1.2ä»¥åç‰ˆæœ¬çš„å†™æ³•ï¼Œå³ä¸è¦†å†™æ”¹å˜java.lang.loadClass(â€¦)å·²æœ‰å§”æ´¾é€»è¾‘æƒ…å†µä¸‹ã€‚ æ•´ä¸ªåŠ è½½ç±»çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š å›¾å…­ è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½ç±»çš„è¿‡ç¨‹ å››ã€å¸¸è§é—®é¢˜åˆ†æ4.1 ç”±ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½çš„æŒ‡å®šç±»è¿˜æ˜¯ç›¸åŒçš„ç±»å‹å—ï¼Ÿ åœ¨Javaä¸­ï¼Œä¸€ä¸ªç±»ç”¨å…¶å®Œå…¨åŒ¹é…ç±»å(fully qualified class name)ä½œä¸ºæ ‡è¯†ï¼Œè¿™é‡ŒæŒ‡çš„å®Œå…¨åŒ¹é…ç±»ååŒ…æ‹¬åŒ…åå’Œç±»åã€‚ä½†åœ¨JVMä¸­ä¸€ä¸ªç±»ç”¨å…¶å…¨åå’Œä¸€ä¸ªåŠ è½½ç±»ClassLoaderçš„å®ä¾‹ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œä¸åŒç±»åŠ è½½å™¨åŠ è½½çš„ç±»å°†è¢«ç½®äºä¸åŒçš„å‘½åç©ºé—´ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨å»åŠ è½½æŸè‡ªå®šä¹‰ç±»å‹ï¼ˆæ³¨æ„ä¸è¦å°†è‡ªå®šä¹‰ç±»å‹çš„å­—èŠ‚ç æ”¾ç½®åˆ°ç³»ç»Ÿè·¯å¾„æˆ–è€…æ‰©å±•è·¯å¾„ä¸­ï¼Œå¦åˆ™ä¼šè¢«ç³»ç»Ÿç±»åŠ è½½å™¨æˆ–æ‰©å±•ç±»åŠ è½½å™¨æŠ¢å…ˆåŠ è½½ï¼‰ï¼Œç„¶åç”¨è·å–åˆ°çš„ä¸¤ä¸ªClasså®ä¾‹è¿›è¡Œjava.lang.Object.equalsï¼ˆâ€¦ï¼‰åˆ¤æ–­ï¼Œå°†ä¼šå¾—åˆ°ä¸ç›¸ç­‰çš„ç»“æœã€‚è¿™ä¸ªå¤§å®¶å¯ä»¥å†™ä¸¤ä¸ªè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å»åŠ è½½ç›¸åŒçš„è‡ªå®šä¹‰ç±»å‹ï¼Œç„¶ååšä¸ªåˆ¤æ–­ï¼›åŒæ—¶ï¼Œå¯ä»¥æµ‹è¯•åŠ è½½java.*ç±»å‹ï¼Œç„¶åå†å¯¹æ¯”æµ‹è¯•ä¸€ä¸‹æµ‹è¯•ç»“æœã€‚ 4.2 åœ¨ä»£ç ä¸­ç›´æ¥è°ƒç”¨Class.forName(String name)æ–¹æ³•ï¼Œåˆ°åº•ä¼šè§¦å‘é‚£ä¸ªç±»åŠ è½½å™¨è¿›è¡Œç±»åŠ è½½è¡Œä¸ºï¼Ÿ Class.forName(String name)é»˜è®¤ä¼šä½¿ç”¨è°ƒç”¨ç±»çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œç±»åŠ è½½ã€‚æˆ‘ä»¬ç›´æ¥æ¥åˆ†æä¸€ä¸‹å¯¹åº”çš„jdkçš„ä»£ç ï¼š //java.lang.Class.java publicstatic Class&lt;?&gt; forName(String className) throws ClassNotFoundException { return forName0(className, true, ClassLoader.getCallerClassLoader()); } //java.lang.ClassLoader.java // Returns the invoker&#39;s class loader, or null if none. static ClassLoader getCallerClassLoader() { // è·å–è°ƒç”¨ç±»ï¼ˆcallerï¼‰çš„ç±»å‹ Class caller = Reflection.getCallerClass(3); // This can be null if the VM is requesting it if (caller == null) { return null; } // è°ƒç”¨java.lang.Classä¸­æœ¬åœ°æ–¹æ³•è·å–åŠ è½½è¯¥è°ƒç”¨ç±»ï¼ˆcallerï¼‰çš„ClassLoader return caller.getClassLoader0(); } //java.lang.Class.java //è™šæ‹Ÿæœºæœ¬åœ°å®ç°ï¼Œè·å–å½“å‰ç±»çš„ç±»åŠ è½½å™¨ï¼Œå‰é¢ä»‹ç»çš„Classçš„getClassLoader()ä¹Ÿä½¿ç”¨æ­¤æ–¹æ³• native ClassLoader getClassLoader0(); 4.3 åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰è®¾å®šçˆ¶åŠ è½½å™¨ï¼Œé‚£ä¹ˆçˆ¶åŠ è½½å™¨æ˜¯è°ï¼Ÿ å‰é¢è®²è¿‡ï¼Œåœ¨ä¸æŒ‡å®šçˆ¶ç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤é‡‡ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚å¯èƒ½æœ‰äººè§‰å¾—ä¸æ˜ç™½ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹JDKå¯¹åº”çš„ä»£ç å®ç°ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬ç¼–å†™è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ç›´æ¥æˆ–è€…é—´æ¥ç»§æ‰¿è‡ªjava.lang.ClassLoaderæŠ½è±¡ç±»ï¼Œå¯¹åº”çš„æ— å‚é»˜è®¤æ„é€ å‡½æ•°å®ç°å¦‚ä¸‹ï¼š //æ‘˜è‡ªjava.lang.ClassLoader.java protected ClassLoader() { SecurityManager security = System.getSecurityManager(); if (security != null) { security.checkCreateClassLoader(); } this.parent = getSystemClassLoader(); initialized = true; } æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„getSystemClassLoader()æ–¹æ³•çš„å®ç°ï¼š private static synchronized void initSystemClassLoader() { //... sun.misc.Launcher l = sun.misc.Launcher.getLauncher(); scl = l.getClassLoader(); //... } æˆ‘ä»¬å¯ä»¥å†™ç®€å•çš„æµ‹è¯•ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹ï¼š System.out.println(sun.misc.Launcher.getLauncher().getClassLoader()); æœ¬æœºå¯¹åº”è¾“å‡ºå¦‚ä¸‹ï¼šsun.misc.Launcher$AppClassLoader@73d16e93 æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç›¸ä¿¡å½“è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ²¡æœ‰æŒ‡å®šçˆ¶ç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„çˆ¶ç±»åŠ è½½å™¨å³ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼šå³ä½¿ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸æŒ‡å®šçˆ¶ç±»åŠ è½½å™¨ï¼Œé‚£ä¹ˆï¼ŒåŒæ ·å¯ä»¥åŠ è½½å¦‚ä¸‹ä¸‰ä¸ªåœ°æ–¹çš„ç±»ï¼š &lt;Java_Runtime_Home&gt;/libä¸‹çš„ç±»ï¼› &lt; Java_Runtime_Home &gt;/lib/extä¸‹æˆ–è€…ç”±ç³»ç»Ÿå˜é‡java.ext.diræŒ‡å®šä½ç½®ä¸­çš„ç±»ï¼› å½“å‰å·¥ç¨‹ç±»è·¯å¾„ä¸‹æˆ–è€…ç”±ç³»ç»Ÿå˜é‡java.class.pathæŒ‡å®šä½ç½®ä¸­çš„ç±»ã€‚ 4.4 åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœå°†çˆ¶ç±»åŠ è½½å™¨å¼ºåˆ¶è®¾ç½®ä¸ºnullï¼Œé‚£ä¹ˆä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿå¦‚æœè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¸èƒ½åŠ è½½æŒ‡å®šç±»ï¼Œå°±è‚¯å®šä¼šåŠ è½½å¤±è´¥å—ï¼Ÿ JVMè§„èŒƒä¸­è§„å®šå¦‚æœç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å°†çˆ¶ç±»åŠ è½½å™¨å¼ºåˆ¶è®¾ç½®ä¸ºnullï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨å°†å¯åŠ¨ç±»åŠ è½½å™¨è®¾ç½®ä¸ºå½“å‰ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ï¼ˆè¿™ä¸ªé—®é¢˜å‰é¢å·²ç»åˆ†æè¿‡äº†ï¼‰ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼šå³ä½¿ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸æŒ‡å®šçˆ¶ç±»åŠ è½½å™¨ï¼Œé‚£ä¹ˆï¼ŒåŒæ ·å¯ä»¥åŠ è½½åˆ°&lt;Java_Runtime_Home&gt;/libä¸‹çš„ç±»ï¼Œä½†æ­¤æ—¶å°±ä¸èƒ½å¤ŸåŠ è½½&lt;Java_Runtime_Home&gt;/lib/extç›®å½•ä¸‹çš„ç±»äº†ã€‚ è¯´æ˜ï¼šé—®é¢˜3å’Œé—®é¢˜4çš„æ¨æ–­ç»“è®ºæ˜¯åŸºäºç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœ¬èº«å»¶ç»­äº†java.lang.ClassLoader.loadClassï¼ˆâ€¦ï¼‰é»˜è®¤å§”æ´¾é€»è¾‘ï¼Œå¦‚æœç”¨æˆ·å¯¹è¿™ä¸€é»˜è®¤å§”æ´¾é€»è¾‘è¿›è¡Œäº†æ”¹å˜ï¼Œä»¥ä¸Šæ¨æ–­ç»“è®ºå°±ä¸ä¸€å®šæˆç«‹äº†ï¼Œè¯¦è§é—®é¢˜5ã€‚ 4.5 ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œä¸€èˆ¬æœ‰å“ªäº›æ³¨æ„ç‚¹ï¼Ÿ ä¸€èˆ¬å°½é‡ä¸è¦è¦†å†™å·²æœ‰çš„loadClass(â€¦)æ–¹æ³•ä¸­çš„å§”æ´¾é€»è¾‘ ä¸€èˆ¬åœ¨JDK 1.2ä¹‹å‰çš„ç‰ˆæœ¬æ‰è¿™æ ·åšï¼Œè€Œä¸”äº‹å®è¯æ˜ï¼Œè¿™æ ·åšææœ‰å¯èƒ½å¼•èµ·ç³»ç»Ÿé»˜è®¤çš„ç±»åŠ è½½å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚åœ¨JVMè§„èŒƒå’ŒJDKæ–‡æ¡£ä¸­ï¼ˆ1.2æˆ–è€…ä»¥åç‰ˆæœ¬ä¸­ï¼‰ï¼Œéƒ½æ²¡æœ‰å»ºè®®ç”¨æˆ·è¦†å†™loadClass(â€¦)æ–¹æ³•ï¼Œç›¸æ¯”è€Œè¨€ï¼Œæ˜ç¡®æç¤ºå¼€å‘è€…åœ¨å¼€å‘è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ—¶è¦†å†™findClass(â€¦)é€»è¾‘ã€‚ä¸¾ä¸€ä¸ªä¾‹å­æ¥éªŒè¯è¯¥é—®é¢˜ï¼š //ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨WrongClassLoader.Javaï¼ˆè¦†å†™loadClassé€»è¾‘ï¼‰ public class WrongClassLoader extends ClassLoader { public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException { return this.findClass(name); } protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException { // å‡è®¾æ­¤å¤„åªæ˜¯åˆ°å·¥ç¨‹ä»¥å¤–çš„ç‰¹å®šç›®å½•D:\\libraryä¸‹å»åŠ è½½ç±» // å…·ä½“å®ç°ä»£ç çœç•¥ } } é€šè¿‡å‰é¢çš„åˆ†ææˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œè¿™ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨WrongClassLoaderçš„é»˜è®¤ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œä½†æ˜¯ç°åœ¨é—®é¢˜4ç§çš„ç»“è®ºå°±ä¸æˆç«‹äº†ã€‚å¤§å®¶å¯ä»¥ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œç°åœ¨&lt;Java_Runtime_Home&gt;/libã€&lt; Java_Runtime_Home &gt;/lib/extå’Œå·¥ç¨‹ç±»è·¯å¾„ä¸Šçš„ç±»éƒ½åŠ è½½ä¸ä¸Šäº†ã€‚ //é—®é¢˜5æµ‹è¯•ä»£ç ä¸€ public class WrongClassLoaderTest { publicstaticvoid main(String[] args) { try { WrongClassLoader loader = new WrongClassLoader(); Class classLoaded = loader.loadClass(&quot;beans.Account&quot;); System.out.println(classLoaded.getName()); System.out.println(classLoaded.getClassLoader()); } catch (Exception e) { e.printStackTrace(); } } } è¿™é‡ŒD:&quot;classes&quot;beans&quot;Account.classæ˜¯ç‰©ç†å­˜åœ¨çš„ã€‚è¾“å‡ºç»“æœï¼š java.io.FileNotFoundException: D:&quot;classes&quot;java&quot;lang&quot;Object.class (ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚) at java.io.FileInputStream.open(Native Method) at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:106) at WrongClassLoader.findClass(WrongClassLoader.java:40) at WrongClassLoader.loadClass(WrongClassLoader.java:29) at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319) at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClass(ClassLoader.java:620) at java.lang.ClassLoader.defineClass(ClassLoader.java:400) at WrongClassLoader.findClass(WrongClassLoader.java:43) at WrongClassLoader.loadClass(WrongClassLoader.java:29) at WrongClassLoaderTest.main(WrongClassLoaderTest.java:27) Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: java/lang/Object at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClass(ClassLoader.java:620) at java.lang.ClassLoader.defineClass(ClassLoader.java:400) at WrongClassLoader.findClass(WrongClassLoader.java:43) at WrongClassLoader.loadClass(WrongClassLoader.java:29) at WrongClassLoaderTest.main(WrongClassLoaderTest.java:27) è¿™è¯´æ˜ï¼Œè¿è¦åŠ è½½çš„ç±»å‹çš„è¶…ç±»å‹java.lang.Objectéƒ½åŠ è½½ä¸åˆ°äº†ã€‚è¿™é‡Œåˆ—ä¸¾çš„ç”±äºè¦†å†™loadClass()å¼•èµ·çš„é€»è¾‘é”™è¯¯æ˜æ˜¾æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå®é™…å¼•èµ·çš„é€»è¾‘é”™è¯¯å¯èƒ½å¤æ‚çš„å¤šã€‚ //é—®é¢˜5æµ‹è¯•äºŒ //ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨WrongClassLoader.Java(ä¸è¦†å†™loadClassé€»è¾‘) public class WrongClassLoader extends ClassLoader { protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException { //å‡è®¾æ­¤å¤„åªæ˜¯åˆ°å·¥ç¨‹ä»¥å¤–çš„ç‰¹å®šç›®å½•D:\\libraryä¸‹å»åŠ è½½ç±» //å…·ä½“å®ç°ä»£ç çœç•¥ } } å°†è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä»£ç WrongClassLoader.Javaåšä»¥ä¸Šä¿®æ”¹åï¼Œå†è¿è¡Œæµ‹è¯•ä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼šbeans.AccountWrongClassLoader@1c78e57 æ­£ç¡®è®¾ç½®çˆ¶ç±»åŠ è½½å™¨é€šè¿‡ä¸Šé¢é—®é¢˜4å’Œé—®é¢˜5çš„åˆ†ææˆ‘ä»¬åº”è¯¥å·²ç»ç†è§£ï¼Œä¸ªäººè§‰å¾—è¿™æ˜¯è‡ªå®šä¹‰ç”¨æˆ·ç±»åŠ è½½å™¨æ—¶æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œä½†å¸¸å¸¸è¢«å¿½ç•¥æˆ–è€…è½»æ˜“å¸¦è¿‡ã€‚æœ‰äº†å‰é¢JDKä»£ç çš„åˆ†æä½œä¸ºåŸºç¡€ï¼Œæˆ‘æƒ³ç°åœ¨å¤§å®¶éƒ½å¯ä»¥éšä¾¿ä¸¾å‡ºä¾‹å­äº†ã€‚ ä¿è¯findClass(String name)æ–¹æ³•çš„é€»è¾‘æ­£ç¡®æ€§äº‹å…ˆå°½é‡å‡†ç¡®ç†è§£å¾…å®šä¹‰çš„ç±»åŠ è½½å™¨è¦å®Œæˆçš„åŠ è½½ä»»åŠ¡ï¼Œç¡®ä¿æœ€å¤§ç¨‹åº¦ä¸Šèƒ½å¤Ÿè·å–åˆ°å¯¹åº”çš„å­—èŠ‚ç å†…å®¹ã€‚ 4.6 å¦‚ä½•åœ¨è¿è¡Œæ—¶åˆ¤æ–­ç³»ç»Ÿç±»åŠ è½½å™¨èƒ½åŠ è½½å“ªäº›è·¯å¾„ä¸‹çš„ç±»ï¼Ÿ ä¸€æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨ClassLoader.getSystemClassLoader()æˆ–è€…å…¶ä»–æ–¹å¼è·å–åˆ°ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨å’Œæ‰©å±•ç±»åŠ è½½å™¨æœ¬èº«éƒ½æ´¾ç”Ÿè‡ªURLClassLoaderï¼‰ï¼Œè°ƒç”¨URLClassLoaderä¸­çš„getURLs()æ–¹æ³•å¯ä»¥è·å–åˆ°ã€‚ äºŒæ˜¯å¯ä»¥ç›´æ¥é€šè¿‡è·å–ç³»ç»Ÿå±æ€§java.class.pathæ¥æŸ¥çœ‹å½“å‰ç±»è·¯å¾„ä¸Šçš„æ¡ç›®ä¿¡æ¯ ï¼šSystem.getProperty(â€œjava.class.pathâ€)ã€‚ 4.7 å¦‚ä½•åœ¨è¿è¡Œæ—¶åˆ¤æ–­æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨èƒ½åŠ è½½å“ªäº›è·¯å¾„ä¸‹çš„ç±»ï¼Ÿæ–¹æ³•ä¹‹ä¸€ï¼š import java.net.URL; import java.net.URLClassLoader; public class ClassLoaderTest { /** * @param args the command line arguments */ public static void main(String[] args) { try { URL[] extURLs = ((URLClassLoader) ClassLoader.getSystemClassLoader().getParent()).getURLs(); for (int i = 0; i &lt; extURLs.length; i++) { System.out.println(extURLs[i]); } } catch (Exception e) { //â€¦ } } } æœ¬æœºå¯¹åº”è¾“å‡ºå¦‚ä¸‹ï¼š file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/access-bridge-64.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/cldrdata.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/dnsns.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/jaccess.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/jfxrt.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/localedata.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/nashorn.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/sunec.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/sunjce_provider.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/sunmscapi.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/sunpkcs11.jar file:/C:/Program%20Files/Java/jdk1.8.0_05/jre/lib/ext/zipfs.jar äº”ã€å¼€å‘è‡ªå·±çš„ç±»åŠ è½½å™¨åœ¨å‰é¢ä»‹ç»ç±»åŠ è½½å™¨çš„ä»£ç†å§”æ´¾æ¨¡å¼çš„æ—¶å€™ï¼Œæåˆ°è¿‡ç±»åŠ è½½å™¨ä¼šé¦–å…ˆä»£ç†ç»™å…¶å®ƒç±»åŠ è½½å™¨æ¥å°è¯•åŠ è½½æŸä¸ªç±»ã€‚è¿™å°±æ„å‘³ç€çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œçš„ç±»åŠ è½½å™¨å’Œå¯åŠ¨è¿™ä¸ªåŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨ï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œæ˜¯é€šè¿‡è°ƒç”¨defineClassæ¥å®ç°çš„ï¼›è€Œå¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨loadClassæ¥å®ç°çš„ã€‚å‰è€…ç§°ä¸ºä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨ï¼ˆdefining loaderï¼‰ï¼Œåè€…ç§°ä¸ºåˆå§‹åŠ è½½å™¨ï¼ˆinitiating loaderï¼‰ã€‚åœ¨Javaè™šæ‹Ÿæœºåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„å®šä¹‰åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªç±»åŠ è½½å™¨å¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„åŠ è½½å™¨ã€‚ä¸¤ç§ç±»åŠ è½½å™¨çš„å…³è”ä¹‹å¤„åœ¨äºï¼šä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨æ˜¯å®ƒå¼•ç”¨çš„å…¶å®ƒç±»çš„åˆå§‹åŠ è½½å™¨ã€‚å¦‚ç±» com.example.Outerå¼•ç”¨äº†ç±» com.example.Innerï¼Œåˆ™ç”±ç±» com.example.Outerçš„å®šä¹‰åŠ è½½å™¨è´Ÿè´£å¯åŠ¨ç±» com.example.Innerçš„åŠ è½½è¿‡ç¨‹ã€‚ æ–¹æ³• loadClass()æŠ›å‡ºçš„æ˜¯ java.lang.ClassNotFoundExceptionå¼‚å¸¸ï¼›æ–¹æ³• defineClass()æŠ›å‡ºçš„æ˜¯ java.lang.NoClassDefFoundErrorå¼‚å¸¸ã€‚ ç±»åŠ è½½å™¨åœ¨æˆåŠŸåŠ è½½æŸä¸ªç±»ä¹‹åï¼Œä¼šæŠŠå¾—åˆ°çš„ java.lang.Classç±»çš„å®ä¾‹ç¼“å­˜èµ·æ¥ã€‚ä¸‹æ¬¡å†è¯·æ±‚åŠ è½½è¯¥ç±»çš„æ—¶å€™ï¼Œç±»åŠ è½½å™¨ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ç±»çš„å®ä¾‹ï¼Œè€Œä¸ä¼šå°è¯•å†æ¬¡åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªç±»åŠ è½½å™¨å®ä¾‹æ¥è¯´ï¼Œç›¸åŒå…¨åçš„ç±»åªåŠ è½½ä¸€æ¬¡ï¼Œå³ loadClassæ–¹æ³•ä¸ä¼šè¢«é‡å¤è°ƒç”¨ã€‚ åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç³»ç»Ÿé»˜è®¤æä¾›çš„ç±»åŠ è½½å™¨å®ç°å·²ç»å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨è¿˜æ˜¯éœ€è¦ä¸ºåº”ç”¨å¼€å‘å‡ºè‡ªå·±çš„ç±»åŠ è½½å™¨ã€‚æ¯”å¦‚æ‚¨çš„åº”ç”¨é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“Javaç±»çš„å­—èŠ‚ä»£ç ï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œè¿™äº›å­—èŠ‚ä»£ç ç»è¿‡äº†åŠ å¯†å¤„ç†ã€‚è¿™ä¸ªæ—¶å€™æ‚¨å°±éœ€è¦è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥ä»æŸä¸ªç½‘ç»œåœ°å€ä¸Šè¯»å–åŠ å¯†åçš„å­—èŠ‚ä»£ç ï¼Œæ¥ç€è¿›è¡Œè§£å¯†å’ŒéªŒè¯ï¼Œæœ€åå®šä¹‰å‡ºè¦åœ¨Javaè™šæ‹Ÿæœºä¸­è¿è¡Œçš„ç±»æ¥ã€‚ä¸‹é¢å°†é€šè¿‡ä¸¤ä¸ªå…·ä½“çš„å®ä¾‹æ¥è¯´æ˜ç±»åŠ è½½å™¨çš„å¼€å‘ã€‚ 5.1 æ–‡ä»¶ç³»ç»Ÿç±»åŠ è½½å™¨ç¬¬ä¸€ä¸ªç±»åŠ è½½å™¨ç”¨æ¥åŠ è½½å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„Javaå­—èŠ‚ä»£ç ã€‚å®Œæ•´çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚ package classloader; import java.io.ByteArrayOutputStream; import java.io.File; import java.io.FileInputStream; import java.io.IOException; import java.io.InputStream; // æ–‡ä»¶ç³»ç»Ÿç±»åŠ è½½å™¨ public class FileSystemClassLoader extends ClassLoader { private String rootDir; public FileSystemClassLoader(String rootDir) { this.rootDir = rootDir; } // è·å–ç±»çš„å­—èŠ‚ç  @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException { byte[] classData = getClassData(name); // è·å–ç±»çš„å­—èŠ‚æ•°ç»„ if (classData == null) { throw new ClassNotFoundException(); } else { return defineClass(name, classData, 0, classData.length); } } private byte[] getClassData(String className) { // è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ String path = classNameToPath(className); try { InputStream ins = new FileInputStream(path); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 4096; byte[] buffer = new byte[bufferSize]; int bytesNumRead = 0; // è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç  while ((bytesNumRead = ins.read(buffer)) != -1) { baos.write(buffer, 0, bytesNumRead); } return baos.toByteArray(); } catch (IOException e) { e.printStackTrace(); } return null; } private String classNameToPath(String className) { // å¾—åˆ°ç±»æ–‡ä»¶çš„å®Œå…¨è·¯å¾„ return rootDir + File.separatorChar + className.replace(&#39;.&#39;, File.separatorChar) + &quot;.class&quot;; } } å¦‚ä¸Šæ‰€ç¤ºï¼Œç±» FileSystemClassLoaderç»§æ‰¿è‡ªç±»java.lang.ClassLoaderã€‚åœ¨java.lang.ClassLoaderç±»çš„å¸¸ç”¨æ–¹æ³•ä¸­ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå·±å¼€å‘çš„ç±»åŠ è½½å™¨åªéœ€è¦è¦†å†™ findClass(String name)æ–¹æ³•å³å¯ã€‚java.lang.ClassLoaderç±»çš„æ–¹æ³•loadClass()å°è£…äº†å‰é¢æåˆ°çš„ä»£ç†æ¨¡å¼çš„å®ç°ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆè°ƒç”¨findLoadedClass()æ–¹æ³•æ¥æ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼›å¦‚æœæ²¡æœ‰åŠ è½½è¿‡çš„è¯ï¼Œä¼šè°ƒç”¨çˆ¶ç±»åŠ è½½å™¨çš„loadClass()æ–¹æ³•æ¥å°è¯•åŠ è½½è¯¥ç±»ï¼›å¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»çš„è¯ï¼Œå°±è°ƒç”¨findClass()æ–¹æ³•æ¥æŸ¥æ‰¾è¯¥ç±»ã€‚å› æ­¤ï¼Œä¸ºäº†ä¿è¯ç±»åŠ è½½å™¨éƒ½æ­£ç¡®å®ç°ä»£ç†æ¨¡å¼ï¼Œåœ¨å¼€å‘è‡ªå·±çš„ç±»åŠ è½½å™¨æ—¶ï¼Œæœ€å¥½ä¸è¦è¦†å†™ loadClass()æ–¹æ³•ï¼Œè€Œæ˜¯è¦†å†™ findClass()æ–¹æ³•ã€‚ ç±» FileSystemClassLoaderçš„ findClass()æ–¹æ³•é¦–å…ˆæ ¹æ®ç±»çš„å…¨ååœ¨ç¡¬ç›˜ä¸ŠæŸ¥æ‰¾ç±»çš„å­—èŠ‚ä»£ç æ–‡ä»¶ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œç„¶åè¯»å–è¯¥æ–‡ä»¶å†…å®¹ï¼Œæœ€åé€šè¿‡defineClass()æ–¹æ³•æ¥æŠŠè¿™äº›å­—èŠ‚ä»£ç è½¬æ¢æˆ java.lang.Classç±»çš„å®ä¾‹ã€‚ åŠ è½½æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç±»ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š package com.example; public class Sample { private Sample instance; public void setSample(Object instance) { System.out.println(instance.toString()); this.instance = (Sample) instance; } } package classloader; import java.lang.reflect.Method; public class ClassIdentity { public static void main(String[] args) { new ClassIdentity().testClassIdentity(); } public void testClassIdentity() { String classDataRootPath = &quot;C:\\\\Users\\\\JackZhou\\\\Documents\\\\NetBeansProjects\\\\classloader\\\\build\\\\classes&quot;; FileSystemClassLoader fscl1 = new FileSystemClassLoader(classDataRootPath); FileSystemClassLoader fscl2 = new FileSystemClassLoader(classDataRootPath); String className = &quot;com.example.Sample&quot;; try { Class&lt;?&gt; class1 = fscl1.loadClass(className); // åŠ è½½Sampleç±» Object obj1 = class1.newInstance(); // åˆ›å»ºå¯¹è±¡ Class&lt;?&gt; class2 = fscl2.loadClass(className); Object obj2 = class2.newInstance(); Method setSampleMethod = class1.getMethod(&quot;setSample&quot;, java.lang.Object.class); setSampleMethod.invoke(obj1, obj2); } catch (Exception e) { e.printStackTrace(); } } } è¿è¡Œè¾“å‡ºï¼š com.example.Sample@7852e922 5.2 ç½‘ç»œç±»åŠ è½½å™¨ä¸‹é¢å°†é€šè¿‡ä¸€ä¸ªç½‘ç»œç±»åŠ è½½å™¨æ¥è¯´æ˜å¦‚ä½•é€šè¿‡ç±»åŠ è½½å™¨æ¥å®ç°ç»„ä»¶çš„åŠ¨æ€æ›´æ–°ã€‚å³åŸºæœ¬çš„åœºæ™¯æ˜¯ï¼šJava å­—èŠ‚ä»£ç ï¼ˆ.classï¼‰æ–‡ä»¶å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œå®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œçš„æ–¹å¼è·å–å­—èŠ‚ä»£ç å¹¶æ‰§è¡Œã€‚å½“æœ‰ç‰ˆæœ¬æ›´æ–°çš„æ—¶å€™ï¼Œåªéœ€è¦æ›¿æ¢æ‰æœåŠ¡å™¨ä¸Šä¿å­˜çš„æ–‡ä»¶å³å¯ã€‚é€šè¿‡ç±»åŠ è½½å™¨å¯ä»¥æ¯”è¾ƒç®€å•çš„å®ç°è¿™ç§éœ€æ±‚ã€‚ ç±» NetworkClassLoaderè´Ÿè´£é€šè¿‡ç½‘ç»œä¸‹è½½Javaç±»å­—èŠ‚ä»£ç å¹¶å®šä¹‰å‡ºJavaç±»ã€‚å®ƒçš„å®ç°ä¸FileSystemClassLoaderç±»ä¼¼ã€‚ package classloader; import java.io.ByteArrayOutputStream; import java.io.InputStream; import java.net.URL; public class NetworkClassLoader extends ClassLoader { private String rootUrl; public NetworkClassLoader(String rootUrl) { // æŒ‡å®šURL this.rootUrl = rootUrl; } // è·å–ç±»çš„å­—èŠ‚ç  @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException { byte[] classData = getClassData(name); if (classData == null) { throw new ClassNotFoundException(); } else { return defineClass(name, classData, 0, classData.length); } } private byte[] getClassData(String className) { // ä»ç½‘ç»œä¸Šè¯»å–çš„ç±»çš„å­—èŠ‚ String path = classNameToPath(className); try { URL url = new URL(path); InputStream ins = url.openStream(); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 4096; byte[] buffer = new byte[bufferSize]; int bytesNumRead = 0; // è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ while ((bytesNumRead = ins.read(buffer)) != -1) { baos.write(buffer, 0, bytesNumRead); } return baos.toByteArray(); } catch (Exception e) { e.printStackTrace(); } return null; } private String classNameToPath(String className) { // å¾—åˆ°ç±»æ–‡ä»¶çš„URL return rootUrl + &quot;/&quot; + className.replace(&#39;.&#39;, &#39;/&#39;) + &quot;.class&quot;; } } åœ¨é€šè¿‡NetworkClassLoaderåŠ è½½äº†æŸä¸ªç‰ˆæœ¬çš„ç±»ä¹‹åï¼Œä¸€èˆ¬æœ‰ä¸¤ç§åšæ³•æ¥ä½¿ç”¨å®ƒã€‚ç¬¬ä¸€ç§åšæ³•æ˜¯ä½¿ç”¨Javaåå°„APIã€‚å¦å¤–ä¸€ç§åšæ³•æ˜¯ä½¿ç”¨æ¥å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸èƒ½ç›´æ¥åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å¼•ç”¨ä»æœåŠ¡å™¨ä¸Šä¸‹è½½çš„ç±»ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä»£ç çš„ç±»åŠ è½½å™¨æ‰¾ä¸åˆ°è¿™äº›ç±»ã€‚ä½¿ç”¨Javaåå°„APIå¯ä»¥ç›´æ¥è°ƒç”¨Javaç±»çš„æ–¹æ³•ã€‚è€Œä½¿ç”¨æ¥å£çš„åšæ³•åˆ™æ˜¯æŠŠæ¥å£çš„ç±»æ”¾åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œä»æœåŠ¡å™¨ä¸ŠåŠ è½½å®ç°æ­¤æ¥å£çš„ä¸åŒç‰ˆæœ¬çš„ç±»ã€‚åœ¨å®¢æˆ·ç«¯é€šè¿‡ç›¸åŒçš„æ¥å£æ¥ä½¿ç”¨è¿™äº›å®ç°ç±»ã€‚æˆ‘ä»¬ä½¿ç”¨æ¥å£çš„æ–¹å¼ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯æ¥å£ï¼š package classloader; public interface Versioned { String getVersion(); } package classloader; public interface ICalculator extends Versioned { String calculate(String expression); } ç½‘ç»œä¸Šçš„ä¸åŒç‰ˆæœ¬çš„ç±»ï¼š package com.example; import classloader.ICalculator; public class CalculatorBasic implements ICalculator { @Override public String calculate(String expression) { return expression; } @Override public String getVersion() { return &quot;1.0&quot;; } } package com.example; import classloader.ICalculator; public class CalculatorAdvanced implements ICalculator { @Override public String calculate(String expression) { return &quot;Result is &quot; + expression; } @Override public String getVersion() { return &quot;2.0&quot;; } } åœ¨å®¢æˆ·ç«¯åŠ è½½ç½‘ç»œä¸Šçš„ç±»çš„è¿‡ç¨‹ï¼š package classloader; public class CalculatorTest { public static void main(String[] args) { String url = &quot;http://localhost:8080/ClassloaderTest/classes&quot;; NetworkClassLoader ncl = new NetworkClassLoader(url); String basicClassName = &quot;com.example.CalculatorBasic&quot;; String advancedClassName = &quot;com.example.CalculatorAdvanced&quot;; try { Class&lt;?&gt; clazz = ncl.loadClass(basicClassName); // åŠ è½½ä¸€ä¸ªç‰ˆæœ¬çš„ç±» ICalculator calculator = (ICalculator) clazz.newInstance(); // åˆ›å»ºå¯¹è±¡ System.out.println(calculator.getVersion()); clazz = ncl.loadClass(advancedClassName); // åŠ è½½å¦ä¸€ä¸ªç‰ˆæœ¬çš„ç±» calculator = (ICalculator) clazz.newInstance(); System.out.println(calculator.getVersion()); } catch (Exception e) { e.printStackTrace(); } } } å‚è€ƒæ–‡çŒ®http://www.blogjava.net/zhuxing/archive/2008/08/08/220841.html http://www.ibm.com/developerworks/cn/java/j-lo-classloader/","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“","slug":"æ·±å…¥ç†è§£JVMä¹‹--è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“","date":"2020-05-30T08:52:38.000Z","updated":"2023-04-30T10:21:41.374Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬2ç‰ˆ)ã€‹ çŸ¥è¯†ç‚¹å›é¡¾ï¼šjavacç¼–è¯‘å™¨é€šè¿‡å¯¹ç¨‹åºä»£ç è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ã€éå†æŠ½è±¡è¯­æ³•æ ‘ç­‰å¤æ‚çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œæœ€ç»ˆï¼Œå°†ç¨‹åºä»£ç å˜æˆäº†Classå­—èŠ‚ç æ–‡ä»¶ã€‚ç„¶åï¼Œç”Ÿæˆçš„Classå­—èŠ‚ç æ–‡ä»¶åœ¨ç»å†è¿‡åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ç­‰é˜¶æ®µä¹‹åæ‰èƒ½è¢«ä½¿ç”¨/å¸è½½ã€‚ è¿è¡Œæ—¶æ ˆå¸§ç»“æ„æ ˆå¸§ï¼ˆStack Frameï¼‰æ˜¯ç”¨äºæ”¯æŒè™šæ‹Ÿæœºè¿›è¡Œæ–¹æ³•è°ƒç”¨å’Œæ–¹æ³•æ‰§è¡Œçš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºä¸­çš„è™šæ‹Ÿæœºæ ˆï¼ˆVirtual Machine Stackï¼‰çš„æ ˆå…ƒç´ ã€‚ æ ˆå¸§å­˜å‚¨äº†æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€ æ“ä½œæ•°æ ˆã€ åŠ¨æ€è¿æ¥å’Œæ–¹æ³•è¿”å›åœ°å€ç­‰ä¿¡æ¯ã€‚ æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨å¼€å§‹è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œéƒ½å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆé‡Œé¢ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚ ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ–¹æ³•è°ƒç”¨é“¾å¯èƒ½ä¼šå¾ˆé•¿ï¼Œå¾ˆå¤šæ–¹æ³•éƒ½åŒæ—¶å¤„äºæ‰§è¡ŒçŠ¶æ€ã€‚ å¯¹äºæ‰§è¡Œå¼•æ“æ¥è¯´ï¼Œåœ¨æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œåªæœ‰ä½äºæ ˆé¡¶çš„æ ˆå¸§æ‰æ˜¯æœ‰æ•ˆçš„ï¼Œç§°ä¸ºå½“å‰æ ˆå¸§ï¼ˆCurrent StackFrameï¼‰ï¼Œä¸è¿™ä¸ªæ ˆå¸§ç›¸å…³è”çš„æ–¹æ³•ç§°ä¸ºå½“å‰æ–¹æ³•ï¼ˆCurrent Methodï¼‰ã€‚ æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤éƒ½åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œï¼Œåœ¨æ¦‚å¿µæ¨¡å‹ä¸Šï¼Œå…¸å‹çš„æ ˆå¸§ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å±€éƒ¨å˜é‡è¡¨å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variable Tableï¼‰æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚ åœ¨Javaç¨‹åºç¼–è¯‘ä¸ºClassæ–‡ä»¶æ—¶ï¼Œå°±åœ¨æ–¹æ³•çš„Codeå±æ€§çš„max_localsæ•°æ®é¡¹ä¸­ç¡®å®šäº†è¯¥æ–¹æ³•æ‰€éœ€è¦åˆ†é…çš„å±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§å®¹é‡ã€‚ å±€éƒ¨å˜é‡è¡¨çš„å®¹é‡ä»¥å˜é‡æ§½ï¼ˆVariable Slotï¼Œä¸‹ç§°Slotï¼‰ä¸ºæœ€å°å•ä½ï¼Œåœ¨åŸºæœ¬æ•°æ®ç±»å‹ä¸­ï¼Œ64 ä½é•¿åº¦çš„long å’Œdouble ç±»å‹çš„æ•°æ®ä¼šå ç”¨2 ä¸ªè¿ç»­å±€éƒ¨å˜é‡ç©ºé—´ï¼ˆé«˜ä½å¯¹é½ï¼‰ï¼Œå…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨1 ä¸ªã€‚ç”±äºå±€éƒ¨å˜é‡è¡¨å»ºç«‹åœ¨çº¿ç¨‹çš„å †æ ˆä¸Šï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ï¼Œæ— è®ºè¯»å†™ä¸¤ä¸ªè¿ç»­çš„Slotæ˜¯å¦ä¸ºåŸå­æ“ä½œï¼Œéƒ½ä¸ä¼šå¼•èµ·æ•°æ®å®‰å…¨é—®ã€‚ åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºæ˜¯ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆå‚æ•°å€¼åˆ°å‚æ•°å˜é‡åˆ—è¡¨çš„ä¼ é€’è¿‡ç¨‹çš„ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯å®ä¾‹æ–¹æ³•ï¼ˆéstaticçš„æ–¹æ³•ï¼‰ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨ä¸­ç¬¬0ä½ç´¢å¼•çš„Sloté»˜è®¤æ˜¯ç”¨äºä¼ é€’æ–¹æ³•æ‰€å±å¯¹è±¡å®ä¾‹çš„å¼•ç”¨ï¼Œåœ¨æ–¹æ³•ä¸­å¯ä»¥é€šè¿‡å…³é”®å­—â€œthisâ€æ¥è®¿é—®åˆ°è¿™ä¸ªéšå«çš„å‚æ•°ã€‚ å…¶ä½™å‚æ•°åˆ™æŒ‰ç…§å‚æ•°è¡¨é¡ºåºæ’åˆ—ï¼Œå ç”¨ä»1å¼€å§‹çš„å±€éƒ¨å˜é‡Slotï¼Œå‚æ•°è¡¨åˆ†é…å®Œæ¯•åï¼Œå†æ ¹æ®æ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å˜é‡é¡ºåºå’Œä½œç”¨åŸŸåˆ†é…å…¶ä½™çš„Slotã€‚ ä¸ºäº†å°½å¯èƒ½èŠ‚çœæ ˆå¸§ç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotæ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œæ–¹æ³•ä½“ä¸­å®šä¹‰çš„å˜é‡ï¼Œå…¶ä½œç”¨åŸŸå¹¶ä¸ä¸€å®šä¼šè¦†ç›–æ•´ä¸ªæ–¹æ³•ä½“ï¼Œå¦‚æœå½“å‰å­—èŠ‚ç PCè®¡æ•°å™¨çš„å€¼å·²ç»è¶…å‡ºäº†æŸä¸ªå˜é‡çš„ä½œç”¨åŸŸï¼Œé‚£è¿™ä¸ªå˜é‡å¯¹åº”çš„Slotå°±å¯ä»¥äº¤ç»™å…¶ä»–å˜é‡ä½¿ç”¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒSlotçš„å¤ç”¨ä¼šå½±å“åƒåœ¾æ”¶é›†å™¨çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼šè¢«å¤ç”¨çš„Slotä¸­æ‰€å¼•ç”¨çš„å˜é‡åœ¨è¶…å‡ºå˜é‡çš„ä½œç”¨åŸŸåï¼Œä½†è¯¥Slotç©ºé—´è¿˜æ²¡æœ‰è¢«å…¶ä»–å˜é‡æ‰€å ç”¨ï¼Œä¼šå¯¼è‡´ä½œä¸ºGC Rootsä¸€éƒ¨åˆ†çš„å±€éƒ¨å˜é‡è¡¨ä»ç„¶ä¿æŒç€å¯¹æ—§å˜é‡çš„å…³è”ï¼Œè¿›è€Œå¯¼è‡´æ—§å˜é‡æ— æ³•è¢«å›æ”¶ã€‚ æ“ä½œæ•°æ ˆæ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰ä¹Ÿå¸¸ç§°ä¸ºæ“ä½œæ ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªåå…¥å…ˆå‡ºï¼ˆLast In First Out,LIFOï¼‰æ ˆã€‚ åŒå±€éƒ¨å˜é‡è¡¨ä¸€æ ·ï¼Œæ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ä¹Ÿåœ¨ç¼–è¯‘çš„æ—¶å€™å†™å…¥åˆ°Codeå±æ€§çš„max_stacksæ•°æ®é¡¹ä¸­ã€‚ æ“ä½œæ•°æ ˆçš„æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥æ˜¯ä»»æ„çš„Javaæ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬longå’Œdoubleã€‚ 32ä½æ•°æ®ç±»å‹æ‰€å çš„æ ˆå®¹é‡ä¸º1ï¼Œ64ä½æ•°æ®ç±»å‹æ‰€å çš„æ ˆå®¹é‡ä¸º2ã€‚ åœ¨æ–¹æ³•æ‰§è¡Œçš„ä»»ä½•æ—¶å€™ï¼Œæ“ä½œæ•°æ ˆçš„æ·±åº¦éƒ½ä¸ä¼šè¶…è¿‡åœ¨max_stacksæ•°æ®é¡¹ä¸­è®¾å®šçš„æœ€å¤§å€¼ã€‚ å½“ä¸€ä¸ªæ–¹æ³•åˆšåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ï¼Œåœ¨æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰å„ç§å­—èŠ‚ç æŒ‡ä»¤å¾€æ“ä½œæ•°æ ˆä¸­å†™å…¥å’Œæå–å†…å®¹ï¼Œä¹Ÿå°±æ˜¯å‡ºæ ˆ/å…¥æ ˆæ“ä½œï¼Œè€Œä¸”æ“ä½œæ•°æ ˆä¸­å…ƒç´ çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å­—èŠ‚ç æŒ‡ä»¤çš„åºåˆ—ä¸¥æ ¼åŒ¹é…ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæ•´æ•°åŠ æ³•çš„å­—èŠ‚ç æŒ‡ä»¤iaddåœ¨è¿è¡Œçš„æ—¶å€™æ“ä½œæ•°æ ˆä¸­æœ€æ¥è¿‘æ ˆé¡¶çš„ä¸¤ä¸ªå…ƒç´ å·²ç»å­˜å…¥äº†ä¸¤ä¸ªintå‹çš„æ•°å€¼ï¼Œå½“æ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤æ—¶ï¼Œä¼šå°†è¿™ä¸¤ä¸ªintå€¼å‡ºæ ˆå¹¶ç›¸åŠ ï¼Œç„¶åå°†ç›¸åŠ çš„ç»“æœå…¥æ ˆã€‚ åŠ¨æ€è¿æ¥æ¯ä¸ªæ ˆå¸§éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼ŒæŒæœ‰è¿™ä¸ªå¼•ç”¨æ˜¯ä¸ºäº†æ”¯æŒæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„åŠ¨æ€è¿æ¥ï¼ˆDynamic Linkingï¼‰ã€‚ Classæ–‡ä»¶çš„å¸¸é‡æ± ä¸­å­˜æœ‰å¤§é‡çš„ç¬¦å·å¼•ç”¨ï¼Œå­—èŠ‚ç ä¸­çš„æ–¹æ³•è°ƒç”¨æŒ‡ä»¤å°±ä»¥å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä½œä¸ºå‚æ•°ã€‚ è¿™äº›ç¬¦å·å¼•ç”¨ä¸€éƒ¨åˆ†ä¼šåœ¨ç±»åŠ è½½é˜¶æ®µæˆ–è€…ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™å°±è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç§è½¬åŒ–ç§°ä¸ºé™æ€è§£æã€‚ å¦å¤–ä¸€éƒ¨åˆ†å°†åœ¨æ¯ä¸€æ¬¡è¿è¡ŒæœŸé—´è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†ç§°ä¸ºåŠ¨æ€è¿æ¥ã€‚ æ–¹æ³•è¿”å›åœ°å€å½“ä¸€ä¸ªæ–¹æ³•å¼€å§‹æ‰§è¡Œåï¼Œåªæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€€å‡ºè¿™ä¸ªæ–¹æ³•ã€‚ ç¬¬ä¸€ç§æ–¹å¼æ˜¯æ‰§è¡Œå¼•æ“é‡åˆ°ä»»æ„ä¸€ä¸ªæ–¹æ³•è¿”å›çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œè¿™æ—¶å€™å¯èƒ½ä¼šæœ‰è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼ˆè°ƒç”¨å½“å‰æ–¹æ³•çš„æ–¹æ³•ç§°ä¸ºè°ƒç”¨è€…ï¼‰ï¼Œæ˜¯å¦æœ‰è¿”å›å€¼å’Œè¿”å›å€¼çš„ç±»å‹å°†æ ¹æ®é‡åˆ°ä½•ç§æ–¹æ³•è¿”å›æŒ‡ä»¤æ¥å†³å®šï¼Œè¿™ç§é€€å‡ºæ–¹æ³•çš„æ–¹å¼ç§°ä¸ºæ­£å¸¸å®Œæˆå‡ºå£ï¼ˆNormal Method Invocation Completionï¼‰ã€‚ å¦å¤–ä¸€ç§é€€å‡ºæ–¹å¼æ˜¯ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ²¡æœ‰åœ¨æ–¹æ³•ä½“å†…å¾—åˆ°å¤„ç†ï¼Œæ— è®ºæ˜¯Javaè™šæ‹Ÿæœºå†…éƒ¨äº§ç”Ÿçš„å¼‚å¸¸ï¼Œè¿˜æ˜¯ä»£ç ä¸­ä½¿ç”¨athrowå­—èŠ‚ç æŒ‡ä»¤äº§ç”Ÿçš„å¼‚å¸¸ï¼Œåªè¦åœ¨æœ¬æ–¹æ³•çš„å¼‚å¸¸è¡¨ä¸­æ²¡æœ‰æœç´¢åˆ°åŒ¹é…çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºï¼Œè¿™ç§é€€å‡ºæ–¹æ³•çš„æ–¹å¼ç§°ä¸ºå¼‚å¸¸å®Œæˆå‡ºå£ï¼ˆAbrupt Method Invocation Completionï¼‰ã€‚ ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨å¼‚å¸¸å®Œæˆå‡ºå£çš„æ–¹å¼é€€å‡ºï¼Œæ˜¯ä¸ä¼šç»™å®ƒçš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•è¿”å›å€¼çš„ã€‚ æ— è®ºé‡‡ç”¨ä½•ç§é€€å‡ºæ–¹å¼ï¼Œåœ¨æ–¹æ³•é€€å‡ºä¹‹åï¼Œéƒ½éœ€è¦è¿”å›åˆ°æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ï¼Œç¨‹åºæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ–¹æ³•é€€å‡ºçš„è¿‡ç¨‹å®é™…ä¸Šå°±ç­‰åŒäºæŠŠå½“å‰æ ˆå¸§å‡ºæ ˆï¼Œå› æ­¤é€€å‡ºæ—¶å¯èƒ½æ‰§è¡Œçš„æ“ä½œæœ‰ï¼šæ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆï¼ŒæŠŠè¿”å›å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å‹å…¥è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­ï¼Œè°ƒæ•´PCè®¡æ•°å™¨çš„å€¼ä»¥æŒ‡å‘æ–¹æ³•è°ƒç”¨æŒ‡ä»¤åé¢çš„ä¸€æ¡æŒ‡ä»¤ç­‰ã€‚ æ–¹æ³•è°ƒç”¨æ–¹æ³•è°ƒç”¨å¹¶ä¸ç­‰åŒäºæ–¹æ³•æ‰§è¡Œï¼Œæ–¹æ³•è°ƒç”¨é˜¶æ®µå”¯ä¸€çš„ä»»åŠ¡å°±æ˜¯ç¡®å®šè¢«è°ƒç”¨æ–¹æ³•çš„ç‰ˆæœ¬ï¼ˆå³è°ƒç”¨å“ªä¸€ä¸ªæ–¹æ³•ï¼‰ï¼Œæš‚æ—¶è¿˜ä¸æ¶‰åŠæ–¹æ³•å†…éƒ¨çš„å…·ä½“è¿è¡Œè¿‡ç¨‹ã€‚ Classæ–‡ä»¶çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸åŒ…å«ä¼ ç»Ÿç¼–è¯‘ä¸­çš„è¿æ¥æ­¥éª¤ï¼Œä¸€åˆ‡æ–¹æ³•è°ƒç”¨åœ¨Classæ–‡ä»¶é‡Œé¢å­˜å‚¨çš„éƒ½åªæ˜¯ç¬¦å·å¼•ç”¨ï¼Œè€Œä¸æ˜¯æ–¹æ³•åœ¨å®é™…è¿è¡Œæ—¶å†…å­˜å¸ƒå±€ä¸­çš„å…¥å£åœ°å€ï¼ˆç›¸å½“äºä¹‹å‰è¯´çš„ç›´æ¥å¼•ç”¨ï¼‰ã€‚ è¿™ä¸ªç‰¹æ€§ç»™Javaå¸¦æ¥äº†æ›´å¼ºå¤§çš„åŠ¨æ€æ‰©å±•èƒ½åŠ›ï¼Œä½†ä¹Ÿä½¿å¾—Javaæ–¹æ³•è°ƒç”¨è¿‡ç¨‹å˜å¾—ç›¸å¯¹å¤æ‚èµ·æ¥ï¼Œéœ€è¦åœ¨ç±»åŠ è½½æœŸé—´ï¼Œç”šè‡³åˆ°è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šç›®æ ‡æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚ è§£ææ‰€æœ‰æ–¹æ³•è°ƒç”¨ä¸­çš„ç›®æ ‡æ–¹æ³•åœ¨Classæ–‡ä»¶é‡Œé¢éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨ï¼Œåœ¨ç±»åŠ è½½çš„è§£æé˜¶æ®µï¼Œä¼šå°†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç§è§£æèƒ½æˆç«‹çš„å‰ææ˜¯ï¼šæ–¹æ³•åœ¨ç¨‹åºçœŸæ­£è¿è¡Œä¹‹å‰å°±æœ‰ä¸€ä¸ªå¯ç¡®å®šçš„è°ƒç”¨ç‰ˆæœ¬ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ç‰ˆæœ¬åœ¨è¿è¡ŒæœŸæ˜¯ä¸å¯æ”¹å˜çš„ã€‚ æ¢å¥è¯è¯´ï¼Œè°ƒç”¨ç›®æ ‡åœ¨ç¨‹åºä»£ç å†™å¥½ã€ ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶å°±å¿…é¡»ç¡®å®šä¸‹æ¥ã€‚ è¿™ç±»æ–¹æ³•çš„è°ƒç”¨ç§°ä¸ºè§£æï¼ˆResolutionï¼‰ã€‚ åœ¨Javaè¯­è¨€ä¸­ç¬¦åˆâ€œç¼–è¯‘æœŸå¯çŸ¥ï¼Œè¿è¡ŒæœŸä¸å¯å˜â€è¿™ä¸ªè¦æ±‚çš„æ–¹æ³•ï¼Œä¸»è¦åŒ…æ‹¬é™æ€æ–¹æ³•å’Œç§æœ‰æ–¹æ³•ä¸¤å¤§ç±»ï¼Œå‰è€…ä¸ç±»å‹ç›´æ¥å…³è”ï¼Œåè€…åœ¨å¤–éƒ¨ä¸å¯è¢«è®¿é—®ï¼Œè¿™ä¸¤ç§æ–¹æ³•å„è‡ªçš„ç‰¹ç‚¹å†³å®šäº†å®ƒä»¬éƒ½ä¸å¯èƒ½é€šè¿‡ç»§æ‰¿æˆ–åˆ«çš„æ–¹å¼é‡å†™å…¶ä»–ç‰ˆæœ¬ï¼Œå› æ­¤å®ƒä»¬éƒ½é€‚åˆåœ¨ç±»åŠ è½½é˜¶æ®µè¿›è¡Œè§£æã€‚ ä¸ä¹‹ç›¸å¯¹åº”çš„æ˜¯ï¼Œåœ¨Javaè™šæ‹Ÿæœºé‡Œé¢æä¾›äº†5æ¡æ–¹æ³•è°ƒç”¨å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†åˆ«å¦‚ä¸‹ã€‚ invokestaticï¼šè°ƒç”¨é™æ€æ–¹æ³•ã€‚ invokespecialï¼šè°ƒç”¨å®ä¾‹æ„é€ å™¨ï¼œinitï¼æ–¹æ³•ã€ ç§æœ‰æ–¹æ³•å’Œçˆ¶ç±»æ–¹æ³•ã€‚ invokevirtualï¼šè°ƒç”¨æ‰€æœ‰çš„è™šæ–¹æ³•ã€‚ invokeinterfaceï¼šè°ƒç”¨æ¥å£æ–¹æ³•ï¼Œä¼šåœ¨è¿è¡Œæ—¶å†ç¡®å®šä¸€ä¸ªå®ç°æ­¤æ¥å£çš„å¯¹è±¡ã€‚ invokedynamicï¼šå…ˆåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„æ–¹æ³•ï¼Œç„¶åå†æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œåœ¨æ­¤ä¹‹å‰çš„4æ¡è°ƒç”¨æŒ‡ä»¤ï¼Œåˆ†æ´¾é€»è¾‘æ˜¯å›ºåŒ–åœ¨Javaè™šæ‹Ÿæœºå†…éƒ¨çš„ï¼Œè€ŒinvokedynamicæŒ‡ä»¤çš„åˆ†æ´¾é€»è¾‘æ˜¯ç”±ç”¨æˆ·æ‰€è®¾å®šçš„å¼•å¯¼æ–¹æ³•å†³å®šçš„ã€‚ åªè¦èƒ½è¢«invokestaticå’ŒinvokespecialæŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ï¼Œéƒ½å¯ä»¥åœ¨è§£æé˜¶æ®µä¸­ç¡®å®šå”¯ä¸€çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œç¬¦åˆè¿™ä¸ªæ¡ä»¶çš„æœ‰é™æ€æ–¹æ³•ã€ ç§æœ‰æ–¹æ³•ã€ å®ä¾‹æ„é€ å™¨ã€ çˆ¶ç±»æ–¹æ³•4ç±»ï¼Œå®ƒä»¬åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šæŠŠç¬¦å·å¼•ç”¨è§£æä¸ºè¯¥æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚ è¿™äº›æ–¹æ³•å¯ä»¥ç§°ä¸ºéè™šæ–¹æ³•ï¼Œä¸ä¹‹ç›¸åï¼Œå…¶ä»–æ–¹æ³•ç§°ä¸ºè™šæ–¹æ³•ï¼ˆé™¤å»finalæ–¹æ³•ï¼‰ã€‚ Javaä¸­çš„éè™šæ–¹æ³•é™¤äº†ä½¿ç”¨invokestaticã€ invokespecialè°ƒç”¨çš„æ–¹æ³•ä¹‹å¤–è¿˜æœ‰ä¸€ç§ï¼Œå°±æ˜¯è¢«finalä¿®é¥°çš„æ–¹æ³•ã€‚ è™½ç„¶finalæ–¹æ³•æ˜¯ä½¿ç”¨invokevirtualæŒ‡ä»¤æ¥è°ƒç”¨çš„ï¼Œä½†æ˜¯ç”±äºå®ƒæ— æ³•è¢«è¦†ç›–ï¼Œæ²¡æœ‰å…¶ä»–ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¹Ÿæ— é¡»å¯¹æ–¹æ³•æ¥æ”¶è€…è¿›è¡Œå¤šæ€é€‰æ‹©ï¼Œåˆæˆ–è€…è¯´å¤šæ€é€‰æ‹©çš„ç»“æœè‚¯å®šæ˜¯å”¯ä¸€çš„ã€‚ è§£æè°ƒç”¨ä¸€å®šæ˜¯ä¸ªé™æ€çš„è¿‡ç¨‹ï¼Œåœ¨ç¼–è¯‘æœŸé—´å°±å®Œå…¨ç¡®å®šï¼Œåœ¨ç±»è£…è½½çš„è§£æé˜¶æ®µå°±ä¼šæŠŠæ¶‰åŠçš„ç¬¦å·å¼•ç”¨å…¨éƒ¨è½¬å˜ä¸ºå¯ç¡®å®šçš„ç›´æ¥å¼•ç”¨ï¼Œä¸ä¼šå»¶è¿Ÿåˆ°è¿è¡ŒæœŸå†å»å®Œæˆã€‚ åˆ†æ´¾é™æ€åˆ†æ´¾Object obj=new String(); å½¢å¦‚ä¸Šé¢è¿™è¡Œä»£ç ï¼Œæˆ‘ä»¬æŠŠä»£ç ä¸­çš„â€œObject â€ç§°ä¸ºå˜é‡çš„é™æ€ç±»å‹ï¼ˆStatic Typeï¼‰ï¼Œæˆ–è€…å«åšçš„å¤–è§‚ç±»å‹ï¼ˆApparent Typeï¼‰ï¼Œåé¢çš„â€œStringâ€åˆ™ç§°ä¸ºå˜é‡çš„å®é™…ç±»å‹ï¼ˆActual Typeï¼‰ã€‚ é™æ€ç±»å‹å’Œå®é™…ç±»å‹çš„åŒºåˆ«åœ¨äºï¼šä¸€ä¸ªå˜é‡çš„é™æ€ç±»å‹æ˜¯ä¸ä¼šè¢«æ”¹å˜çš„ï¼Œå¹¶ä¸”å…¶æœ€ç»ˆçš„é™æ€ç±»å‹æ˜¯åœ¨ç¼–è¯‘æœŸå¯çŸ¥çš„ï¼›è€Œå®é™…ç±»å‹å˜åŒ–çš„ç»“æœè¦åˆ°è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘ç¨‹åºçš„æ—¶å€™å¹¶ä¸çŸ¥é“ä¸€ä¸ªå¯¹è±¡çš„å®é™…ç±»å‹æ˜¯ä»€ä¹ˆã€‚ è™šæ‹Ÿæœºï¼ˆå‡†ç¡®åœ°è¯´æ˜¯ç¼–è¯‘å™¨ï¼‰åœ¨é‡è½½æ–¹æ³•é€‰æ‹©æ—¶æ˜¯é€šè¿‡å‚æ•°çš„é™æ€ç±»å‹è€Œä¸æ˜¯å®é™…ç±»å‹ä½œä¸ºåˆ¤å®šä¾æ®çš„ï¼Œæˆ‘ä»¬æŠŠè¿™ç§ä¾èµ–é™æ€ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾åŠ¨ä½œç§°ä¸ºé™æ€åˆ†æ´¾ã€‚ /** * æ–¹æ³•é™æ€åˆ†æ´¾æ¼”ç¤º */ public class StaticDispatch { static abstract class Human { } static class Man extends Human { } static class Woman extends Human { } public void sayHello(Human guy) { System.out.println(&quot;hello,guyï¼&quot;); } public void sayHello(Man guy) { System.out.println(&quot;hello,gentlemanï¼&quot;); } public void sayHello(Woman guy) { System.out.println(&quot;hello,ladyï¼&quot;); } public static void main(String[] args) { Human man = new Man(); Human woman = new Woman(); StaticDispatch sr = new StaticDispatch(); sr.sayHello(man); sr.sayHello(woman); } } åŠ¨æ€åˆ†æ´¾æ‰€æœ‰ä¾èµ–å®é™…ç±»å‹æ¥å®šä½æ–¹æ³•æ‰§è¡Œç‰ˆæœ¬çš„åˆ†æ´¾åŠ¨ä½œç§°ä¸ºåŠ¨æ€åˆ†æ´¾ï¼Œæ¯”è¾ƒå…¸å‹çš„ä¸€ä¸ªä½“ç°å°±æ˜¯é‡å†™ï¼ˆOverrideï¼‰ã€‚ /** * æ–¹æ³•åŠ¨æ€åˆ†æ´¾æ¼”ç¤º */ public class DynamicDispatch { static abstract class Human { protected abstract void sayHello(); } static class Man extends Human { @Override protected void sayHello() { System.out.println(&quot;man say hello&quot;); } } static class Woman extends Human { @Override protected void sayHello() { System.out.println(&quot;woman say hello&quot;); } } public static void main(String[] args) { Human man = new Man(); Human woman = new Woman(); man.sayHello(); woman.sayHello(); man = new Woman(); man.sayHello(); } } å•åˆ†æ´¾ä¸å¤šåˆ†æ´¾æ–¹æ³•çš„æ¥æ”¶è€…ä¸æ–¹æ³•çš„å‚æ•°ç»Ÿç§°ä¸ºæ–¹æ³•çš„å®—é‡ï¼Œæ ¹æ®åˆ†æ´¾åŸºäºå¤šå°‘ç§å®—é‡ï¼Œå¯ä»¥å°†åˆ†æ´¾åˆ’åˆ†ä¸ºå•åˆ†æ´¾å’Œå¤šåˆ†æ´¾ä¸¤ç§ã€‚å•åˆ†æ´¾æ˜¯æ ¹æ®ä¸€ä¸ªå®—é‡å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¤šåˆ†æ´¾åˆ™æ˜¯æ ¹æ®å¤šäºä¸€ä¸ªå®—é‡å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œé€‰æ‹©ã€‚ åŸºäºæ ˆçš„è§£é‡Šå™¨æ‰§è¡Œè¿‡ç¨‹é€šè¿‡ä¸€æ®µJavaä»£ç ï¼Œçœ‹çœ‹åœ¨è™šæ‹Ÿæœºä¸­å®é™…æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚ package com.pengjunlee; public class Test { public int calc() { int a = 100; int b = 200; int c = 300; return (a + b) * c; } } ä½¿ç”¨javapå‘½ä»¤çœ‹çœ‹å®ƒçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ javapæç¤ºè¿™æ®µä»£ç éœ€è¦æ·±åº¦ä¸º2çš„æ“ä½œæ•°æ ˆå’Œ4ä¸ªSlotçš„å±€éƒ¨å˜é‡ç©ºé—´ï¼Œä¸‹é¢çš„7å¼ å›¾ï¼Œç”¨å®ƒä»¬æ¥æè¿°ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŒ‡ä»¤ã€ æ“ä½œæ•°æ ˆå’Œå±€éƒ¨å˜é‡è¡¨çš„å˜åŒ–æƒ…å†µã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶","slug":"æ·±å…¥ç†è§£JVMä¹‹--è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶","date":"2020-05-30T08:51:38.000Z","updated":"2023-04-30T10:21:41.374Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬2ç‰ˆ)ã€‹ è™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»Classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€ è½¬æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ï¼Œè¿™å°±æ˜¯è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚ ç±»åŠ è½½çš„æ—¶æœºç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šåŠ è½½ï¼ˆLoadingï¼‰ã€ éªŒè¯ï¼ˆVerificationï¼‰ã€ å‡†å¤‡ï¼ˆPreparationï¼‰ã€ è§£æï¼ˆResolutionï¼‰ã€ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ã€ ä½¿ç”¨ï¼ˆUsingï¼‰å’Œå¸è½½ï¼ˆUnloadingï¼‰7ä¸ªé˜¶æ®µã€‚ å…¶ä¸­éªŒè¯ã€ å‡†å¤‡ã€ è§£æ3ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ï¼Œè¿™7ä¸ªé˜¶æ®µçš„å‘ç”Ÿé¡ºåºå¦‚ä¸‹å›¾ã€‚ Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡æ˜åœ¨ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦åŠ è½½ï¼ˆLoadingï¼‰ç±»ï¼Œå„ä¸ªè™šæ‹Ÿæœºå¯è‡ªç”±æŠŠæ¡ã€‚ ä½†æ˜¯å¯¹äºåˆå§‹åŒ–é˜¶æ®µï¼Œè™šæ‹Ÿæœºè§„èŒƒåˆ™æ˜¯ä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰5ç§æƒ…å†µå¿…é¡»ç«‹å³å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ï¼ˆè€ŒåŠ è½½ã€ éªŒè¯ã€ å‡†å¤‡è‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰ï¼š é‡åˆ°newã€ getstaticã€ putstaticæˆ–invokestaticè¿™4æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ ç”Ÿæˆè¿™4æ¡æŒ‡ä»¤çš„æœ€å¸¸è§çš„Javaä»£ç åœºæ™¯æ˜¯ï¼šä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ã€ è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢«finalä¿®é¥°ã€ å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰çš„æ—¶å€™ï¼Œä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚ ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«mainï¼ˆï¼‰æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚ å½“ä½¿ç”¨JDK 1.7çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ªjava.lang.invoke.MethodHandleå®ä¾‹æœ€åçš„è§£æç»“æœREF_getStaticã€ REF_putStaticã€ REF_invokeStaticçš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ å¯¹äºè¿™5ç§ä¼šè§¦å‘ç±»è¿›è¡Œåˆå§‹åŒ–çš„åœºæ™¯ï¼Œè™šæ‹Ÿæœºè§„èŒƒä¸­ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆå¼ºçƒˆçš„é™å®šè¯­ï¼šâ€œæœ‰ä¸”åªæœ‰â€ï¼Œè¿™5ç§åœºæ™¯ä¸­çš„è¡Œä¸ºç§°ä¸ºå¯¹ä¸€ä¸ªç±»è¿›è¡Œä¸»åŠ¨å¼•ç”¨ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚ ä»¥ä¸‹æ˜¯ä¸‰ä¸ªè¢«åŠ¨å¼•ç”¨çš„ä»£ç ç¤ºä¾‹ã€‚ /** * è¢«åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤ºä¸€ï¼š é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ– **/ public class SuperClass { static { System.out.println(&quot;SuperClass initï¼&quot;); } public static int value = 123; } public class SubClass extends SuperClass { static { System.out.println(&quot;SubClass initï¼&quot;); } } public class NotInitialization { public static void main(String[] args) { System.out.println(SubClass.value); } } æ‰§è¡Œç»“æœï¼š /** * è¢«åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤ºäºŒï¼š é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ– **/ public class NotInitialization { public static void main(String[] args) { SuperClass[] sca = new SuperClass[10]; } } æ‰§è¡Œç»“æœï¼šæœªæ‰§è¡ŒSuperClassçš„ç±»åˆå§‹åŒ–ï¼Œå³æœªæ‰“å°ä»»ä½•æ–‡å­—ã€‚ /** * è¢«åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤ºä¸‰ï¼š å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–ã€‚ **/ public class ConstantClass { static{ System.out.println(&quot;ConstClass initï¼&quot;); } public static final String HELLOWORLD=&quot;hello world&quot;; } /** * éä¸»åŠ¨ä½¿ç”¨å­—æ®µæ¼”ç¤º **/ public class NotInitialization { public static void main(String[] args) { System.out.println(ConstantClass.HELLOWORLD); } } æ‰§è¡Œç»“æœï¼š ç±»åŠ è½½çš„è¿‡ç¨‹åŠ è½½åœ¨åŠ è½½é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹3ä»¶äº‹æƒ…ï¼š é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ åŠ è½½é˜¶æ®µå®Œæˆåï¼Œè™šæ‹Ÿæœºå¤–éƒ¨çš„äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€éœ€çš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œæ–¹æ³•åŒºä¸­çš„æ•°æ®å­˜å‚¨æ ¼å¼ç”±è™šæ‹Ÿæœºå®ç°è‡ªè¡Œå®šä¹‰ï¼Œè™šæ‹Ÿæœºè§„èŒƒæœªè§„å®šæ­¤åŒºåŸŸçš„å…·ä½“æ•°æ®ç»“æ„ã€‚ ç„¶ååœ¨å†…å­˜ä¸­å®ä¾‹åŒ–ä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼ˆå¹¶æ²¡æœ‰æ˜ç¡®è§„å®šæ˜¯åœ¨Javaå †ä¸­ï¼Œå¯¹äºHotSpotè™šæ‹Ÿæœºè€Œè¨€ï¼ŒClasså¯¹è±¡æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒè™½ç„¶æ˜¯å¯¹è±¡ï¼Œä½†æ˜¯å­˜æ”¾åœ¨æ–¹æ³•åŒºé‡Œé¢ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å°†ä½œä¸ºç¨‹åºè®¿é—®æ–¹æ³•åŒºä¸­çš„è¿™äº›ç±»å‹æ•°æ®çš„å¤–éƒ¨æ¥å£ã€‚ åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹ï¼ˆå¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œï¼‰æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªå®Œæˆï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å·²ç»å¼€å§‹ï¼Œä½†è¿™äº›å¤¹åœ¨åŠ è½½é˜¶æ®µä¹‹ä¸­è¿›è¡Œçš„åŠ¨ä½œï¼Œä»ç„¶å±äºè¿æ¥é˜¶æ®µçš„å†…å®¹ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µçš„å¼€å§‹æ—¶é—´ä»ç„¶ä¿æŒç€å›ºå®šçš„å…ˆåé¡ºåºã€‚ éªŒè¯éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚ ä»æ•´ä½“ä¸Šæ¥çœ‹ï¼ŒéªŒè¯é˜¶æ®µå¤§è‡´ä¸Šä¼šå®Œæˆä¸‹é¢4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ã€å…ƒæ•°æ®éªŒè¯ã€ å­—èŠ‚ç éªŒè¯ã€ ç¬¦å·å¼•ç”¨éªŒè¯ã€‚ æ–‡ä»¶æ ¼å¼éªŒè¯ç¬¬ä¸€é˜¶æ®µè¦éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚ å…ƒæ•°æ®éªŒè¯ç¬¬äºŒé˜¶æ®µæ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ã€‚ å­—èŠ‚ç éªŒè¯ç¬¬ä¸‰é˜¶æ®µæ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ ç¬¦åˆé€»è¾‘çš„ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯æœ€åä¸€ä¸ªé˜¶æ®µçš„æ ¡éªŒå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”â€”è§£æé˜¶æ®µä¸­å‘ç”Ÿã€‚ å‡†å¤‡å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼ï¼ˆâ€œé€šå¸¸æƒ…å†µâ€ä¸‹æ˜¯æ•°æ®ç±»å‹çš„é›¶å€¼ï¼‰çš„é˜¶æ®µï¼Œè¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚ è§£æè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ å„ç§è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€å¯ä»¥å„ä¸ç›¸åŒï¼Œä½†æ˜¯å®ƒä»¬èƒ½æ¥å—çš„ç¬¦å·å¼•ç”¨å¿…é¡»éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒçš„Classæ–‡ä»¶æ ¼å¼ä¸­ã€‚ ç›´æ¥å¼•ç”¨ï¼ˆDirect Referencesï¼‰ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ ç›´æ¥å¼•ç”¨æ˜¯å’Œè™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚ å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨ã€‚ è™šæ‹Ÿæœºè§„èŒƒä¹‹ä¸­å¹¶æœªè§„å®šè§£æé˜¶æ®µå‘ç”Ÿçš„å…·ä½“æ—¶é—´ï¼Œåªè¦æ±‚äº†åœ¨æ‰§è¡Œanewarrayã€checkcastã€ getfieldã€ getstaticã€ instanceofã€ invokedynamicã€ invokeinterfaceã€ invokespecialã€invokestaticã€ invokevirtualã€ ldcã€ ldc_wã€ multianewarrayã€ newã€ putfieldå’Œputstaticè¿™16ä¸ªç”¨äºæ“ä½œç¬¦å·å¼•ç”¨çš„å­—èŠ‚ç æŒ‡ä»¤ä¹‹å‰ï¼Œå…ˆå¯¹å®ƒä»¬æ‰€ä½¿ç”¨çš„ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æã€‚ é™¤invokedynamicæŒ‡ä»¤ä»¥å¤–ï¼Œè™šæ‹Ÿæœºå®ç°å¯ä»¥å¯¹ç¬¬ä¸€æ¬¡è§£æçš„ç»“æœè¿›è¡Œç¼“å­˜ï¼ˆåœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è®°å½•ç›´æ¥å¼•ç”¨ï¼Œå¹¶æŠŠå¸¸é‡æ ‡è¯†ä¸ºå·²è§£æçŠ¶æ€ï¼‰ä»è€Œé¿å…è§£æåŠ¨ä½œé‡å¤è¿›è¡Œã€‚ åˆå§‹åŒ–ç±»åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œå‰é¢çš„ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å‚ä¸ä¹‹å¤–ï¼Œå…¶ä½™åŠ¨ä½œå®Œå…¨ç”±è™šæ‹Ÿæœºä¸»å¯¼å’Œæ§åˆ¶ã€‚ åˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ï¼ˆæˆ–è€…è¯´æ˜¯å­—èŠ‚ç ï¼‰ã€‚ åœ¨å‡†å¤‡é˜¶æ®µï¼Œå˜é‡å·²ç»èµ‹è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œåˆ™æ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æºï¼Œæˆ–è€…å¯ä»¥ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥è¡¨è¾¾ï¼šåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•çš„è¿‡ç¨‹ã€‚ ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰€å†³å®šçš„ï¼Œé™æ€è¯­å¥å—ä¸­åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºã€‚ public class Test { static { i = 0; // ç»™å˜é‡èµ‹å€¼å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡ System.out.print(i); // è¿™å¥ç¼–è¯‘å™¨ä¼šæç¤º&quot;éæ³•å‘å‰å¼•ç”¨&quot; } static int i = 1; } ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•ä¸ç±»çš„æ„é€ å‡½æ•°ï¼ˆæˆ–è€…è¯´å®ä¾‹æ„é€ å™¨ï¼œinitï¼ï¼ˆï¼‰æ–¹æ³•ï¼‰ä¸åŒï¼Œå®ƒä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»çš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚ å› æ­¤åœ¨è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•çš„ç±»è‚¯å®šæ˜¯java.lang.Objectã€‚ ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•å¯¹äºç±»æˆ–æ¥å£æ¥è¯´å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•ã€‚ æ¥å£ä¸­ä¸èƒ½ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·éƒ½ä¼šç”Ÿæˆï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•ã€‚ ä½†æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•ã€‚ åªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šåˆå§‹åŒ–ã€‚ å¦å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•ã€‚ è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åœ°åŠ é”ã€ åŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„ï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œï¼œclinitï¼ï¼ˆï¼‰æ–¹æ³•å®Œæ¯•ã€‚ ç±»åŠ è½½å™¨è™šæ‹Ÿæœºè®¾è®¡å›¢é˜ŸæŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚ å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç æ¨¡å—ç§°ä¸ºâ€œç±»åŠ è½½å™¨â€ã€‚ ç±»ä¸ç±»åŠ è½½å™¨ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†å®ƒåœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¿œä¸é™äºç±»åŠ è½½é˜¶æ®µã€‚ å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±åŠ è½½å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚ è¿™å¥è¯å¯ä»¥è¡¨è¾¾å¾—æ›´é€šä¿—ä¸€äº›ï¼šæ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚ import java.io.IOException; import java.io.InputStream; import com.pengjunlee.MyClass; /** * ç±»åŠ è½½å™¨ä¸instanceofå…³é”®å­—æ¼”ç¤º */ public class ClassLoaderTest { public static void main(String[] args) { ClassLoader myLoader = new ClassLoader() { public Class&lt;?&gt; loadClass(String name) throws ClassNotFoundException { try { String fileName = name.substring(name.lastIndexOf(&quot;.&quot;) + 1) + &quot;.class&quot;; InputStream is = getClass().getResourceAsStream(fileName); if (is == null) { return super.loadClass(name); } byte[] b = new byte[is.available()]; is.read(b); return defineClass(name, b, 0, b.length); } catch (IOException e) { throw new ClassNotFoundException(name); } } }; try { Object obj = myLoader.loadClass(&quot;jvm.ClassLoaderTest&quot;) .newInstance(); System.out.println(obj.getClass()); System.out.println(obj instanceof jvm.ClassLoaderTest); System.out.println(obj.getClass().getClassLoader().getClass()); System.out.println(jvm.ClassLoaderTest.class.getClassLoader() .getClass()); } catch (Exception e) { e.printStackTrace(); } } } æ‰§è¡Œç»“æœï¼š åŒäº²å§”æ´¾æ¨¡å‹ä»Javaè™šæ‹Ÿæœºçš„è§’åº¦æ¥è®²ï¼Œåªå­˜åœ¨ä¸¤ç§ä¸åŒçš„ç±»åŠ è½½å™¨ï¼šä¸€ç§æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨ä½¿ç”¨C++è¯­è¨€å®ç°ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼›å¦ä¸€ç§å°±æ˜¯æ‰€æœ‰å…¶ä»–çš„ç±»åŠ è½½å™¨ï¼Œè¿™äº›ç±»åŠ è½½å™¨éƒ½ç”±Javaè¯­è¨€å®ç°ï¼Œç‹¬ç«‹äºè™šæ‹Ÿæœºå¤–éƒ¨ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ªæŠ½è±¡ç±»java.lang.ClassLoaderã€‚ å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ï¼šå‰é¢å·²ç»ä»‹ç»è¿‡ï¼Œè¿™ä¸ªç±»å°†å™¨è´Ÿè´£å°†å­˜æ”¾åœ¨ï¼œJAVA_HOMEï¼\\libç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«-Xbootclasspathå‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨libç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ã€‚ å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¼•å¯¼ç±»åŠ è½½å™¨ï¼Œé‚£ç›´æ¥ä½¿ç”¨nullä»£æ›¿å³å¯ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ï¼šè¿™ä¸ªåŠ è½½å™¨ç”±sun.misc.Launcher$ExtClassLoaderå®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½ï¼œJAVA_HOMEï¼\\lib\\extç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«java.ext.dirsç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼šè¿™ä¸ªç±»åŠ è½½å™¨ç”±sun.misc.Launcher $AppClassLoaderå®ç°ã€‚ ç”±äºè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ClassLoaderä¸­çš„getSystemClassLoaderï¼ˆï¼‰æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿç§°å®ƒä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ å®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚ æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”±è¿™3ç§ç±»åŠ è½½å™¨äº’ç›¸é…åˆè¿›è¡ŒåŠ è½½çš„ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œè¿˜å¯ä»¥åŠ å…¥è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚ è¿™äº›ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»ä¸€èˆ¬å¦‚å›¾æ‰€ç¤ºã€‚ å›¾ä¸­å±•ç¤ºçš„ç±»åŠ è½½å™¨ä¹‹é—´çš„è¿™ç§å±‚æ¬¡å…³ç³»ï¼Œç§°ä¸ºç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParents Delegation Modelï¼‰ã€‚ åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ è¿™é‡Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸ä¼šä»¥ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»æ¥å®ç°ï¼Œè€Œæ˜¯éƒ½ä½¿ç”¨ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚ åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹æ˜¯ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚ java.lang.ClassLoaderçš„loadClassï¼ˆï¼‰æ–¹æ³•ä¹‹ä¸­å®ç°åŒäº²å§”æ´¾çš„ç›¸å…³ä»£ç å¦‚ä¸‹ã€‚ protected synchronized Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { //é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº† Class c = findLoadedClass(name); if (c == null) { try { if (parent != null) { c = parent.loadClass(name, false); } else { c = findBootstrapClassOrNull(name); } } catch (ClassNotFoundException e) { //å¦‚æœçˆ¶ç±»åŠ è½½å™¨æŠ›å‡ºClassNotFoundException //è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚ } if (c == null) { //åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½çš„æ—¶å€™ //å†è°ƒç”¨æœ¬èº«çš„findClassæ–¹æ³•æ¥è¿›è¡Œç±»åŠ è½½ c = findClass(name); } } if (resolve) { resolveClass(c); } return c; }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--æ€§èƒ½ç›‘æ§ä¸æ•…éšœè¯Šæ–­","slug":"æ·±å…¥ç†è§£JVMä¹‹--æ€§èƒ½ç›‘æ§ä¸æ•…éšœè¯Šæ–­","date":"2020-05-30T08:50:38.000Z","updated":"2023-04-30T10:21:41.372Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--æ€§èƒ½ç›‘æ§ä¸æ•…éšœè¯Šæ–­/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--æ€§èƒ½ç›‘æ§ä¸æ•…éšœè¯Šæ–­/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬2ç‰ˆ)ã€‹ SUNå…¬å¸åœ¨JDKçš„binç›®å½•ä¸­ä¸ºJavaå¼€å‘äººå‘˜æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé™¤äº†å¤§å®¶ç†ŸçŸ¥çš„java.exeã€javac.exeå’Œjavap.exeä¹‹å¤–ï¼Œè¿˜åŒ…å«ä¸€äº›åŠŸèƒ½å¼ºå¤§ä¸”ç¨³å®šçš„è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·ï¼Œèƒ½åœ¨å¤„ç†åº”ç”¨ç¨‹åºæ€§èƒ½é—®é¢˜ã€ å®šä½æ•…éšœæ—¶å‘æŒ¥å¾ˆå¤§çš„ä½œç”¨ï¼Œä¾‹å¦‚ä¸‹é¢è¿™å‡ ä¸ªã€‚ è¿˜æ˜¯å…ˆæ¥çœ‹çœ‹å®ƒä»¬éƒ½æ˜¯å¹²ä»€ä¹ˆç”¨çš„å§ï¼Œç¨åå†å¯¹å„ä¸ªå·¥å…·çš„ä½œç”¨åŠç”¨æ³•è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚ jpsï¼šæŸ¥çœ‹è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µjpsï¼ˆJVM Process Status Toolï¼‰çš„ä½œç”¨æ˜¯ï¼šåˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºè™šæ‹Ÿæœºæ‰§è¡Œä¸»ç±»ï¼ˆMain Class,mainï¼ˆï¼‰å‡½æ•°æ‰€åœ¨çš„ç±»ï¼‰åç§°ä»¥åŠè¿™äº›è¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€IDï¼ˆLocal Virtual Machine Identifier,LVMIDï¼‰ï¼Œå¯¹äºæœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹æ¥è¯´ï¼ŒLVMIDä¸æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹IDï¼ˆProcess Identifier,PIDï¼‰æ˜¯ä¸€è‡´çš„ã€‚ # jps å‘½ä»¤æ ¼å¼ï¼š jps [options] [hostid] jpså¯ä»¥é€šè¿‡RMIåè®®æŸ¥è¯¢å¼€å¯äº†RMIæœåŠ¡çš„è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€ï¼Œhostidä¸ºRMIæ³¨å†Œè¡¨ä¸­æ³¨å†Œçš„ä¸»æœºåã€‚ jpsçš„å…¶ä»–å¸¸ç”¨é€‰é¡¹è§ä¸‹è¡¨ã€‚ jpsæ‰§è¡Œæ ·ä¾‹ï¼š åœ¨Eclipse IDEä¸­å°†main()æ–¹æ³•ä¼ å…¥å‚æ•°åŠJVMå¯åŠ¨å‚æ•°è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼Œå¹¶æ‰§è¡Œè‡ªå®šä¹‰ç±»jvm.JpsTestä¸­çš„main()æ–¹æ³•ã€‚ ä½¿ç”¨å‘½ä»¤ jps -mlv æŸ¥çœ‹æ‰€æœ‰çš„JVMè¿›ç¨‹ã€main()æ–¹æ³•ä¼ å…¥å‚æ•°ã€JVMå¯åŠ¨å‚æ•°ï¼Œå¹¶æ˜¾ç¤ºç±»çš„åŒ…å…¨åã€‚ jstatï¼šç›‘è§†è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€jstatï¼ˆJVM Statistics Monitoring Toolï¼‰æ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€ å†…å­˜ã€ åƒåœ¾æ”¶é›†ã€ JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ï¼Œåœ¨æ²¡æœ‰GUIå›¾å½¢ç•Œé¢ï¼Œåªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚ # jstat å‘½ä»¤æ ¼å¼ä¸ºï¼š jstat [ option vmid [ interval[s|ms] [count]] ] å¯¹äºå‘½ä»¤æ ¼å¼ä¸­çš„VMIDä¸LVMIDéœ€è¦ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ï¼šå¦‚æœæ˜¯æœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹ï¼ŒVMIDä¸LVMIDæ˜¯ä¸€è‡´çš„ï¼Œå¦‚æœæ˜¯è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œé‚£VMIDçš„æ ¼å¼åº”å½“æ˜¯ï¼š[protocolï¼š][//]lvmid[@hostname[ï¼šport]/servername] å‚æ•°intervalå’Œcountä»£è¡¨æŸ¥è¯¢é—´éš”å’Œæ¬¡æ•°ï¼Œå¦‚æœçœç•¥è¿™ä¸¤ä¸ªå‚æ•°ï¼Œè¯´æ˜åªæŸ¥è¯¢ä¸€æ¬¡ã€‚ å‡è®¾éœ€è¦æ¯250æ¯«ç§’æŸ¥è¯¢ä¸€æ¬¡è¿›ç¨‹2764åƒåœ¾æ”¶é›†çŠ¶å†µï¼Œä¸€å…±æŸ¥è¯¢20æ¬¡ï¼Œé‚£å‘½ä»¤åº”å½“æ˜¯ï¼šjstat -gc 2764 250 20 é€‰é¡¹optionä»£è¡¨ç€ç”¨æˆ·å¸Œæœ›æŸ¥è¯¢çš„è™šæ‹Ÿæœºä¿¡æ¯ï¼Œä¸»è¦åˆ†ä¸º3ç±»ï¼šç±»è£…è½½ã€ åƒåœ¾æ”¶é›†ã€ è¿è¡ŒæœŸç¼–è¯‘çŠ¶å†µï¼Œå…·ä½“é€‰é¡¹åŠä½œç”¨å¦‚ä¸‹è¡¨ã€‚ jstatæ‰§è¡Œæ ·ä¾‹ï¼š æˆ‘ä»¬ä»¥ç›‘è§†Javaå †çš„çŠ¶å†µä¸ºä¾‹ï¼Œä½¿ç”¨å‘½ä»¤ï¼šjstat -gcutil [è¿›ç¨‹ID] ç›‘è§†ç»“æœè¡¨æ˜ï¼šè¿™å°æœåŠ¡å™¨çš„æ–°ç”Ÿä»£EdenåŒºï¼ˆEï¼Œè¡¨ç¤ºEdenï¼‰ä½¿ç”¨äº†6.01%çš„ç©ºé—´ï¼Œä¸¤ä¸ªSurvivoråŒºï¼ˆS0ã€ S1ï¼Œè¡¨ç¤ºSurvivor0ã€ Survivor1ï¼‰é‡Œé¢éƒ½æ˜¯ç©ºçš„ï¼Œè€å¹´ä»£ï¼ˆOï¼Œè¡¨ç¤ºOldï¼‰å’Œæ°¸ä¹…ä»£ï¼ˆPï¼Œè¡¨ç¤ºPermanentï¼‰åˆ™åˆ†åˆ«ä½¿ç”¨äº†1.88%å’Œ14.28%çš„ç©ºé—´ã€‚ ç¨‹åºè¿è¡Œä»¥æ¥å…±å‘ç”ŸMinor GCï¼ˆYGCï¼Œè¡¨ç¤ºYoung GCï¼‰14æ¬¡ï¼Œæ€»è€—æ—¶0.037ç§’ï¼Œå‘ç”ŸFull GCï¼ˆFGCï¼Œè¡¨ç¤ºFullGCï¼‰0æ¬¡ï¼ŒFull GCæ€»è€—æ—¶ï¼ˆFGCTï¼Œè¡¨ç¤ºFull GC Timeï¼‰ä¸º0.000ç§’ï¼Œæ‰€æœ‰GCæ€»è€—æ—¶ï¼ˆGCTï¼Œè¡¨ç¤ºGC Timeï¼‰ä¸º0.037ç§’ã€‚ jinfoï¼šç®¡ç†JVMé…ç½®ä¿¡æ¯jinfoï¼ˆConfiguration Info for Javaï¼‰çš„ä½œç”¨æ˜¯å®æ—¶åœ°æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•°ã€‚ # jinfo å‘½ä»¤æ ¼å¼ï¼š jinfo [option] pid é€‰é¡¹optionçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹è¡¨ã€‚ jinfoæ‰§è¡Œæ ·ä¾‹ï¼š jmapï¼šJavaå†…å­˜æ˜ åƒå·¥å…·jmapï¼ˆMemory Map for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸ºheapdumpæˆ–dumpæ–‡ä»¶ï¼‰ # jmap å‘½ä»¤æ ¼å¼ï¼š jmap [option] vmid å…·ä½“é€‰é¡¹åŠä½œç”¨å¦‚ä¸‹è¡¨ã€‚ jmapæ‰§è¡Œæ ·ä¾‹ï¼šç”Ÿæˆä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„eclipseè¿›ç¨‹çš„dumpå¿«ç…§æ–‡ä»¶ã€‚ ä½¿ç”¨ clstats å‚æ•°ï¼Œä»¥ClassLoaderä¸ºç»Ÿè®¡å£å¾„æ˜¾ç¤ºæ°¸ä¹…ä»£å†…å­˜çŠ¶æ€ jhatï¼šJVMå¿«ç…§åˆ†æå·¥å…·Sun JDKæä¾›jhatï¼ˆJVM Heap Analysis Toolï¼‰å‘½ä»¤ä¸jmapæ­é…ä½¿ç”¨ï¼Œæ¥åˆ†æjmapç”Ÿæˆçš„å †è½¬å‚¨å¿«ç…§ã€‚ jhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpæ–‡ä»¶çš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚ jhatæ‰§è¡Œæ ·ä¾‹ï¼šä½¿ç”¨jhatåˆ†æä¸Šä¾‹ä¸­é‡‡ç”¨jmapç”Ÿæˆçš„Eclipse IDEçš„å†…å­˜å¿«ç…§æ–‡ä»¶ã€‚ å±å¹•æ˜¾ç¤ºâ€œServer is ready.â€çš„æç¤ºåï¼Œç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­é”®å…¥http://localhostï¼š7000/å°±å¯ä»¥çœ‹åˆ°åˆ†æç»“æœï¼Œåˆ†æç»“æœé»˜è®¤æ˜¯ä»¥åŒ…ä¸ºå•ä½è¿›è¡Œåˆ†ç»„æ˜¾ç¤ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ jstackï¼šJavaå †æ ˆè·Ÿè¸ªå·¥å…·jstackï¼ˆStack Trace for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸ºthreaddumpæˆ–è€…javacoreæ–‡ä»¶ï¼‰ã€‚ çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€ æ­»å¾ªç¯ã€ è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„å¸¸è§åŸå› ã€‚ çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ç€ä»€ä¹ˆèµ„æºã€‚ # jstack å‘½ä»¤æ ¼å¼ï¼š jstack [option] vmid optioné€‰é¡¹çš„åˆæ³•å€¼ä¸å…·ä½“å«ä¹‰ä¸‹è¡¨ã€‚ jstackæ‰§è¡Œæ ·ä¾‹ï¼šä½¿ç”¨jstackæŸ¥çœ‹ä¸€ä¸ªjavaçº¿ç¨‹çš„å †æ ˆã€‚ åœ¨JDK 1.5ä¸­ï¼Œjava.lang.Threadç±»æ–°å¢äº†ä¸€ä¸ªgetAllStackTracesï¼ˆï¼‰æ–¹æ³•ç”¨äºè·å–è™šæ‹Ÿæœºä¸­æ‰€æœ‰çº¿ç¨‹çš„StackTraceElementå¯¹è±¡ã€‚ import java.util.Map; public class JstackTrace { public void printThreadTrace() { for (Map.Entry&lt;Thread, StackTraceElement[]&gt; stackTrace : Thread .getAllStackTraces().entrySet()) { Thread thread = (Thread) stackTrace.getKey(); StackTraceElement[] stack = (StackTraceElement[]) stackTrace .getValue(); if (thread.equals(Thread.currentThread())) { continue; } System.out.print(&quot;\\nçº¿ç¨‹:&quot; + thread.getName() + &quot;\\n&quot;); for (StackTraceElement element : stack) { System.out.print(&quot;\\t&quot; + element + &quot;\\n&quot;); } } } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹","slug":"æ·±å…¥ç†è§£JVMä¹‹--Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹","date":"2020-05-30T08:49:38.000Z","updated":"2023-04-30T10:21:41.369Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--Javaå†…å­˜æ¨¡å‹ä¸çº¿ç¨‹/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€ŠJavaç‰¹ç§å…µï¼ˆä¸Šå†Œï¼‰ã€‹ ç¡¬ä»¶çš„æ•ˆç‡ä¸ä¸€è‡´æ€§ä¼—æ‰€å‘¨çŸ¥ï¼Œç°ä»£è®¡ç®—æœºçš„è¿ç®—é€Ÿåº¦å·²ç»è¿œé«˜äºå®ƒçš„å­˜å‚¨å’Œé€šä¿¡å­ç³»ç»Ÿçš„é€Ÿåº¦ï¼Œå¹¶ä¸”è®¡ç®—æœºä¸­ç»å¤§å¤šæ•°çš„è¿ç®—ä»»åŠ¡éƒ½ä¸å¯èƒ½åªé å¤„ç†å™¨â€œè®¡ç®—â€å°±èƒ½å®Œæˆï¼Œå¤„ç†å™¨è‡³å°‘è¦ä¸å†…å­˜äº¤äº’ï¼Œå¦‚è¯»å–è¿ç®—æ•°æ®ã€å­˜å‚¨è¿ç®—ç»“æœç­‰ï¼Œè¿™ä¸ªI/Oæ“ä½œæ˜¯å¾ˆéš¾æ¶ˆé™¤çš„ï¼ˆæ— æ³•ä»…é å¯„å­˜å™¨æ¥å®Œæˆæ‰€æœ‰è¿ç®—ä»»åŠ¡ï¼‰ï¼Œè¿™å°±æ„å‘³ç€ï¼Œè®¡ç®—æœºåœ¨æ‰§è¡Œè¿ç®—ä»»åŠ¡æ—¶ï¼Œå¤§é‡çš„æ—¶é—´éƒ½ä¼šèŠ±è´¹åœ¨ç­‰å¾…ç£ç›˜I/Oã€ç½‘ç»œé€šä¿¡æˆ–è€…æ•°æ®åº“è®¿é—®ä¸Šï¼Œè¿™ä¼šå¯¹å¤„ç†å™¨çš„è¿ç®—èƒ½åŠ›é€ æˆå¾ˆå¤§çš„æµªè´¹ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„æ”¹å–„æ‰‹æ®µå°±æ˜¯è®©è®¡ç®—æœºåŒæ—¶å¤„ç†å‡ é¡¹ä»»åŠ¡ï¼ˆå³å¤šçº¿ç¨‹æŠ€æœ¯ï¼‰ï¼Œå› æ­¤ï¼Œå¤šä»»åŠ¡å¤„ç†åœ¨ç°ä»£è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­å‡ ä¹å·²æ˜¯ä¸€é¡¹å¿…å¤‡çš„åŠŸèƒ½äº†ã€‚ ç”±äºè®¡ç®—æœºçš„å­˜å‚¨è®¾å¤‡ä¸å¤„ç†å™¨çš„è¿ç®—é€Ÿåº¦æœ‰å‡ ä¸ªæ•°é‡çº§çš„å·®è·ï¼Œæ‰€ä»¥ç°ä»£è®¡ç®—æœºç³»ç»Ÿéƒ½ä¸å¾—ä¸åŠ å…¥ä¸€å±‚è¯»å†™é€Ÿåº¦å°½å¯èƒ½æ¥è¿‘å¤„ç†å™¨è¿ç®—é€Ÿåº¦çš„é«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰æ¥ä½œä¸ºå†…å­˜ä¸å¤„ç†å™¨ä¹‹é—´çš„ç¼“å†²ï¼šå°†è¿ç®—éœ€è¦ä½¿ç”¨åˆ°çš„æ•°æ®å¤åˆ¶åˆ°ç¼“å­˜ä¸­ï¼Œè®©è¿ç®—èƒ½å¿«é€Ÿè¿›è¡Œï¼Œå½“è¿ç®—ç»“æŸåå†ä»ç¼“å­˜åŒæ­¥å›å†…å­˜ä¹‹ä¸­ï¼Œè¿™æ ·å¤„ç†å™¨å°±æ— é¡»ç­‰å¾…ç¼“æ…¢çš„å†…å­˜è¯»å†™äº†ã€‚ åŸºäºé«˜é€Ÿç¼“å­˜çš„å­˜å‚¨äº¤äº’å¾ˆå¥½åœ°è§£å†³äº†å¤„ç†å™¨ä¸å†…å­˜çš„é€Ÿåº¦çŸ›ç›¾ï¼Œä½†æ˜¯ä¹Ÿå¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ï¼ˆCache Coherenceï¼‰ã€‚åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼Œè€Œå®ƒä»¬åˆå…±äº«åŒä¸€ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ï¼Œå½“å¤šä¸ªå¤„ç†å™¨çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€å—ä¸»å†…å­˜åŒºåŸŸæ—¶ï¼Œå°†å¯èƒ½å¯¼è‡´å„è‡ªçš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœçœŸçš„å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œé‚£åŒæ­¥å›åˆ°ä¸»å†…å­˜æ—¶ä»¥è°çš„ç¼“å­˜æ•°æ®ä¸ºå‡†å‘¢ï¼Ÿä¸ºäº†è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Œéœ€è¦å„ä¸ªå¤„ç†å™¨è®¿é—®ç¼“å­˜æ—¶éƒ½éµå¾ªä¸€äº›åè®®ï¼Œåœ¨è¯»å†™æ—¶è¦æ ¹æ®åè®®æ¥è¿›è¡Œæ“ä½œã€‚ Javaå†…å­˜æ¨¡å‹Javaè™šæ‹Ÿæœºè§„èŒƒä¸­è¯•å›¾å®šä¹‰ä¸€ç§Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´æ€§çš„å¹¶å‘æ•ˆæœã€‚ Javaå†…å­˜æ¨¡å‹çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚æ­¤å¤„çš„å˜é‡ï¼ˆVariablesï¼‰ä¸Javaç¼–ç¨‹ä¸­æ‰€è¯´çš„å˜é‡æœ‰æ‰€åŒºåˆ«ï¼Œå®ƒåŒ…æ‹¬äº†å®ä¾‹å­—æ®µã€é™æ€å­—æ®µå’Œæ„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ ï¼Œä½†ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡ä¸æ–¹æ³•å‚æ•°ï¼Œå› ä¸ºåè€…æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸ä¼šè¢«å…±äº«ï¼Œè‡ªç„¶å°±ä¸ä¼šå­˜åœ¨ç«äº‰é—®é¢˜ã€‚ä¸ºäº†è·å¾—è¾ƒå¥½çš„æ‰§è¡Œæ•ˆèƒ½ï¼ŒJavaå†…å­˜æ¨¡å‹å¹¶æ²¡æœ‰é™åˆ¶æ‰§è¡Œå¼•æ“ä½¿ç”¨å¤„ç†å™¨çš„ç‰¹å®šå¯„å­˜å™¨æˆ–ç¼“å­˜æ¥å’Œä¸»å†…å­˜è¿›è¡Œäº¤äº’ï¼Œä¹Ÿæ²¡æœ‰é™åˆ¶å³æ—¶ç¼–è¯‘å™¨è¿›è¡Œè°ƒæ•´ä»£ç æ‰§è¡Œé¡ºåºè¿™ç±»ä¼˜åŒ–æªæ–½ã€‚ Javaå†…å­˜æ¨¡å‹è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ä¸­ï¼ˆæ­¤å¤„çš„ä¸»å†…å­˜ä»…æ˜¯è™šæ‹Ÿæœºå†…å­˜çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¢«è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹æ‰€æœ‰å˜é‡çš„æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚çº¿ç¨‹ã€ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸‰è€…çš„äº¤äº’å…³ç³»å¦‚ä¸‹å›¾ã€‚ å†…å­˜é—´äº¤äº’æ“ä½œå…³äºä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜ä¹‹é—´å…·ä½“çš„äº¤äº’åè®®ï¼Œå³ä¸€ä¸ªå˜é‡å¦‚ä½•ä»ä¸»å†…å­˜æ‹·è´åˆ°å·¥ä½œå†…å­˜ã€å¦‚ä½•ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¹‹ç±»çš„å®ç°ç»†èŠ‚ï¼ŒJavaå†…å­˜æ¨¡å‹ä¸­å®šä¹‰äº†ä»¥ä¸‹8ç§æ“ä½œæ¥å®Œæˆï¼Œè™šæ‹Ÿæœºå®ç°æ—¶å¿…é¡»ä¿è¯ä¸‹é¢æåŠçš„æ¯ä¸€ç§æ“ä½œéƒ½æ˜¯åŸå­çš„ã€ä¸å¯å†åˆ†çš„ï¼ˆå¯¹äºdoubleå’Œlongç±»å‹çš„å˜é‡æ¥è¯´ï¼Œloadã€storeã€readå’Œwriteæ“ä½œåœ¨æŸäº›å¹³å°ä¸Šå…è®¸æœ‰ä¾‹å¤–ï¼‰ã€‚ lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸»å†…å­˜è¯¥å˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚ unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚ readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ã€‚ loadï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚ useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ assginï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ Storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšå çš„writeæ“ä½œä½¿ç”¨ã€‚ Writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚ å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜å¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œé‚£å°±è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œreadå’Œloadæ“ä½œï¼Œå¦‚æœè¦æŠŠå˜é‡ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ï¼Œå°±è¦æŒ‰é¡ºåºçš„æ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚è¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œæ²¡æœ‰ä¿è¯æ˜¯è¿ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´readä¸loadä¹‹é—´ã€storeä¸writeä¹‹é—´æ˜¯å¯æ’å…¥å…¶ä»–æŒ‡ä»¤çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJavaå†…å­˜æ¨¡å‹è¿˜è§„å®šäº†åœ¨æ‰§è¡Œä¸Šè¿°å…«ç§åŸºæœ¬æ“ä½œæ—¶å¿…é¡»æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼Œå³ä¸å…è®¸ä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜è¯»å–äº†ä½†å·¥ä½œå†…å­˜ä¸æ¥å—ï¼Œæˆ–è€…ä»å·¥ä½œå†…å­˜å‘èµ·å›å†™äº†ä½†ä¸»å†…å­˜ä¸æ¥å—çš„æƒ…å†µå‡ºç°ã€‚ ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘çš„assignæ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠè¯¥å˜åŒ–åŒæ­¥å›ä¸»å†…å­˜ã€‚ ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› çš„ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•assignæ“ä½œï¼‰æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­ã€‚ ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­â€œè¯ç”Ÿâ€ï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ–assignï¼‰çš„å˜é‡ï¼Œå°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œuseå’Œstoreä¹‹å‰å¿…é¡»å…ˆæ‰§è¡Œè¿‡äº†assignå’Œloadæ“ä½œã€‚ ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œlockåï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚ å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œé‚£å°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚ å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢«lockæ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œunlockæ“ä½œï¼Œä¹Ÿä¸å…è®¸å»unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šä½çš„å˜é‡ã€‚ å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œstoreã€writeæ“ä½œï¼‰ã€‚ è¿™8ç§å†…å­˜è®¿é—®æ“ä½œä»¥åŠä¸Šè¿°è§„å®šé™å®šï¼Œå†åŠ ä¸Šç¨åä»‹ç»çš„å¯¹volatileçš„ä¸€äº›ç‰¹æ®Šè§„å®šï¼Œå°±å·²ç»å®Œå…¨ç¡®å®šäº†Javaç¨‹åºä¸­å“ªäº›å†…å­˜è®¿é—®æ“ä½œåœ¨å¹¶å‘ä¸‹æ˜¯å®‰å…¨çš„ã€‚ å¯¹äºvolatileå‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™å…³é”®å­—volatileå¯ä»¥è¯´æ˜¯Javaè™šæ‹Ÿæœºæä¾›çš„æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œå½“ä¸€ä¸ªå˜é‡å®šä¹‰ä¸ºvolatileä¹‹åï¼Œå®ƒå°†å…·å¤‡ä¸¤ç§ç‰¹æ€§ï¼Œç¬¬ä¸€æ˜¯ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çš„â€œå¯è§æ€§â€ï¼Œè¿™é‡Œçš„â€œå¯è§æ€§â€æ˜¯æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³å¾—çŸ¥çš„ã€‚ ç”±äºvolatileå˜é‡åªèƒ½ä¿è¯å¯è§æ€§ï¼Œåœ¨ä¸ç¬¦åˆä»¥ä¸‹ä¸¤æ¡è§„åˆ™çš„è¿ç®—åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶è¦é€šè¿‡åŠ é”ï¼ˆä½¿ç”¨synchronizedæˆ–java.util.concurrentä¸­çš„åŸå­ç±»ï¼‰æ¥ä¿è¯åŸå­æ€§ã€‚ è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ã€‚ å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çš„çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚ ä¸‹ç±»åœºæ™¯å¾ˆé€‚åˆä½¿ç”¨volatileå˜é‡æ¥æ§åˆ¶å¹¶å‘ï¼Œå½“shutdown()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œèƒ½ä¿è¯æ‰€æœ‰çº¿ç¨‹ä¸­æ‰§è¡Œçš„doWork()æ–¹æ³•éƒ½ç«‹å³åœä¸‹æ¥ã€‚ volatile boolean shutdownRequested; public void shutdown(){ shutdownRequested=true; } public void doWork(){ while(!shutdownRequested){ //do stuff } } ä½¿ç”¨volatileå˜é‡çš„ç¬¬äºŒä¸ªè¯­ä¹‰æ˜¯ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œæ™®é€šçš„å˜é‡ä»…ä»…ä¼šä¿è¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¾èµ–èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å–åˆ°æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯å˜é‡èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚ ä¸‹é¢æ˜¯Javaå†…å­˜æ¨¡å‹ä¸­å¯¹volatileå˜é‡å®šä¹‰çš„ç‰¹æ®Šè§„åˆ™ã€‚å‡å®šTè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼ŒVå’ŒWåˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªvolatileå˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œreadã€loadã€useã€assignã€storeå’Œwriteæ“ä½œæ—¶éœ€è¦æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š åªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„å‰ä¸€ä¸ªåŠ¨ä½œæ˜¯loadçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒuseåŠ¨ä½œï¼›å¹¶ä¸”ï¼Œåªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„åä¸€ä¸ªåŠ¨ä½œæ˜¯useçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒloadåŠ¨ä½œã€‚çº¿ç¨‹Tå¯¹å˜é‡Vçš„useåŠ¨ä½œå¯ä»¥è®¤ä¸ºæ˜¯å’Œçº¿ç¨‹Tå¯¹å˜é‡Vçš„loadã€readåŠ¨ä½œç›¸å…³è”ï¼Œå¿…é¡»è¿ç»­ä¸€èµ·å‡ºç°ï¼ˆè¿™æ¡è§„åˆ™è¦æ±‚åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨volatileå˜é‡å‰éƒ½å¿…é¡»ä»ä¸»å†…å­˜ä¸­åˆ·æ–°æœ€æ–°çš„å€¼ï¼Œç”¨äºä¿è¯èƒ½çœ‹åˆ°å…¶ä»–çº¿ç¨‹å¯¹å˜é‡Væ‰€åšçš„ä¿®æ”¹åçš„å€¼ï¼‰ã€‚ åªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„å‰ä¸€ä¸ªåŠ¨ä½œæ˜¯assignçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒstoreåŠ¨ä½œï¼›å¹¶ä¸”ï¼Œåªæœ‰å½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„åä¸€ä¸ªåŠ¨ä½œæ˜¯storeçš„æ—¶å€™ï¼Œçº¿ç¨‹Tæ‰èƒ½å¯¹å˜é‡Væ‰§è¡Œassignæ“ä½œã€‚çº¿ç¨‹Tå¯¹å˜é‡Vçš„assignåŠ¨ä½œå¯ä»¥è®¤ä¸ºæ˜¯å’Œçº¿ç¨‹Tå¯¹å˜é‡Vçš„storeã€writeåŠ¨ä½œç›¸å…³è”ï¼Œå¿…é¡»è¿ç»­ä¸€èµ·å‡ºå¸­ï¼ˆè¿™æ¡è§„åˆ™è¦æ±‚åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œæ¯æ¬¡ä¿®æ”¹åçš„å€¼éƒ½å¿…é¡»ç«‹åˆ»åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œç”¨äºä¿è¯å…¶ä»–çº¿ç¨‹å¯ä»¥çœ‹åˆ°è‡ªå·±å¯¹å˜é‡Væ‰€åšçš„ä¿®æ”¹ï¼‰ã€‚ å‡å®šåŠ¨ä½œAæ˜¯çº¿ç¨‹Tå¯¹å˜é‡Vå®æ–½çš„useæˆ–assignåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œFæ˜¯å’ŒåŠ¨ä½œAç›¸å…³è”çš„loadæˆ–storeåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œPæ˜¯å’ŒåŠ¨ä½œFç›¸åº”çš„å¯¹å˜é‡Vçš„readæˆ–writeåŠ¨ä½œï¼›ç±»ä¼¼çš„ï¼Œå‡å®šåŠ¨ä½œBæ˜¯çº¿ç¨‹Tå¯¹å˜é‡Wå®æ–½çš„useæˆ–assignåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œGæ˜¯å’ŒåŠ¨ä½œBç›¸å…³è”çš„loadæˆ–storeåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œQæ˜¯å’ŒåŠ¨ä½œGç›¸åº”çš„å¯¹å˜é‡Wçš„readæˆ–writeåŠ¨ä½œï¼Œå¦‚æœAå…ˆäºBï¼Œé‚£ä¹ˆPå…ˆäºQï¼ˆè¿™æ¡è§„åˆ™è¦æ±‚volatileä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œä¿è¯ä»£ç çš„æ‰§è¡Œé¡ºåºä¸ç¨‹åºçš„é¡ºåºç›¸åŒï¼‰ã€‚ å¯¹äºlongå’Œdoubleå‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™Javaå†…å­˜æ¨¡å‹è¦æ±‚lockã€unlockã€readã€loadã€assignã€useã€storeã€writeè¿™8ä¸ªæ“ä½œéƒ½å…·æœ‰åŸå­æ€§ï¼Œä½†æ˜¯å¯¹äº64ä½çš„æ•°æ®ç±»å‹ï¼ˆlongå’Œdoubleï¼‰ï¼Œåœ¨æ¨¡å‹ä¸­ç‰¹åˆ«å®šä¹‰äº†ä¸€æ¡ç›¸å¯¹å®½æ¾çš„è§„å®šï¼šå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢«volatileä¿®é¥°çš„64ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡32ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå®ç°é€‰æ‹©å¯ä»¥ä¸ä¿è¯64ä½æ•°æ®ç±»å‹çš„loadã€storeã€readå’Œwriteè¿™å››ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œè¿™ç‚¹å°±æ˜¯æ‰€è°“çš„longå’Œdoubleçš„éåŸå­æ€§åå®šï¼ˆNonatomic Treatment of double and long Variablesï¼‰ã€‚ æ³¨æ„ï¼šç›®å‰å„ç§å¹³å°ä¸‹çš„å•†ç”¨è™šæ‹Ÿæœºå‡ ä¹éƒ½é€‰æ‹©æŠŠ64ä½æ•°æ®çš„è¯»å†™æ“ä½œä½œä¸ºåŸå­æ“ä½œæ¥å¯¹å¾…ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ä¸€èˆ¬ä¸éœ€è¦æŠŠç”¨åˆ°çš„longå’Œdoubleå˜é‡ä¸“é—¨å£°æ˜ä¸ºvolatileã€‚ å…ˆè¡Œå‘ç”ŸåŸåˆ™javaè¯­è¨€ä¸­æœ‰ä¸€ä¸ªå…ˆè¡Œå‘ç”Ÿï¼ˆHappens-Beforeï¼‰åŸåˆ™ï¼Œå®ƒæ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ç«äº‰ã€çº¿ç¨‹æ˜¯å¦å®‰å…¨çš„ä¸»è¦ä¾æ®ï¼Œä¾é è¿™ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡ æ¡è§„åˆ™ä¸€æ½å­åœ°è§£å†³å¹¶å‘ç¯å¢ƒä¸‹ä¸¤ä¸ªæ“ä½œä¹‹é—´æ˜¯å¦å¯èƒ½å­˜åœ¨å†²çªçš„æ‰€æœ‰é—®é¢˜ã€‚ å…ˆè¡Œå‘ç”Ÿæ˜¯Javaå†…å­˜æ¨¡å‹ä¸­å®šä¹‰çš„ä¸¤é¡¹æ“ä½œä¹‹é—´çš„ååºå…³ç³»ï¼Œå¦‚æœè¯´æ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œå…¶å®å°±æ˜¯è¯´åœ¨å‘ç”Ÿæ“ä½œBä¹‹å‰ï¼Œæ“ä½œAäº§ç”Ÿçš„å½±å“èƒ½è¢«æ“ä½œBè§‚å¯Ÿåˆ°ï¼Œâ€œå½±å“â€åŒ…æ‹¬ä¿®æ”¹äº†å†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ã€å‘é€äº†æ¶ˆæ¯ã€è°ƒç”¨äº†æ–¹æ³•ç­‰ã€‚ ä¸‹é¢æ˜¯Javaå†…å­˜æ¨¡å‹ä¸‹ä¸€äº›â€œå¤©ç„¶çš„â€å…ˆè¡Œå‘ç”Ÿå…³ç³»ï¼Œè¿™äº›å…ˆè¡Œå‘ç”Ÿå…³ç³»æ— é¡»ä»»ä½•åŒæ­¥å™¨ååŠ©å°±å·²ç»å­˜åœ¨ï¼Œå¯ä»¥åœ¨ç¼–ç ä¸­ç›´æ¥ä½¿ç”¨ã€‚å¦‚æœä¸¤ä¸ªæ“ä½œä¹‹é—´çš„å…³ç³»ä¸åœ¨æ­¤åˆ—ï¼Œå¹¶ä¸”æ— æ³•ä»ä¸‹åˆ—è§„åˆ™æ¨å¯¼å‡ºæ¥çš„è¯ï¼Œå®ƒä»¬å°±æ²¡æœ‰é¡ºåºæ€§ä¿éšœï¼Œè™šæ‹Ÿæœºå¯ä»¥å¯¹å®ƒä»¬éšæ„è¿›è¡Œé‡æ’åºã€‚ ç¨‹åºæ¬¡åºè§„åˆ™ï¼ˆProgram Order Ruleï¼‰ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ç¨‹åºä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚ ç®¡ç¨‹é”å®šè§„åˆ™ï¼ˆMonitor Lock Ruleï¼‰ï¼šä¸€ä¸ªunlockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œã€‚ volatileå˜é‡è§„åˆ™ï¼ˆVolatile Variable Ruleï¼‰ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚ çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼ˆThread Start Ruleï¼‰ï¼šçº¿ç¨‹çš„Thread.start()å¿…é¡»åœ¨è¯¥çº¿ç¨‹æ‰€æœ‰å…¶ä»–æ“ä½œä¹‹å‰å‘ç”Ÿã€‚ çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼ˆThread Termination Ruleï¼‰ï¼šçº¿ç¨‹ä¸­æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºè¯¥çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.join()æ–¹æ³•ç»“æŸã€Thread.isAlive()çš„è¿”å›å€¼ç­‰æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚ çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼ˆThread Interruption Ruleï¼‰ï¼šå¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡Thread.interrupted()æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚ å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼ˆFinalizer Ruleï¼‰ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„finalize()æ–¹æ³•çš„å¼€å§‹ã€‚ ä¼ é€’æ€§ï¼ˆTransitivityï¼‰ï¼šå¦‚æœæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œæ“ä½œBå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCçš„ç»“è®ºã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--Javaå¯¹è±¡çš„å†…å­˜ç»“æ„","slug":"æ·±å…¥ç†è§£JVMä¹‹--Javaå¯¹è±¡çš„å†…å­˜ç»“æ„","date":"2020-05-30T08:47:38.000Z","updated":"2023-04-30T10:21:41.369Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--Javaå¯¹è±¡çš„å†…å­˜ç»“æ„/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--Javaå¯¹è±¡çš„å†…å­˜ç»“æ„/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€ŠJavaç‰¹ç§å…µï¼ˆä¸Šå†Œï¼‰ã€‹ å¯¹è±¡å†…å­˜ç»“æ„Classæ–‡ä»¶ä»¥å­—èŠ‚ç çš„å½¢å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºå½“ä¸­ï¼Œç”¨æ¥æè¿°ä¸€ä¸ªç±»æœ¬èº«çš„å†…å­˜ç»“æ„ã€‚å½“ä½¿ç”¨Classæ–‡ä»¶æ–°å»ºå¯¹è±¡æ—¶ï¼Œå¯¹è±¡å®ä¾‹çš„å†…å­˜ç»“æ„åˆç©¶ç«Ÿæ˜¯ä¸ªä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºäº†è¡¨ç¤ºå¯¹è±¡çš„å±æ€§ã€æ–¹æ³•ç­‰ä¿¡æ¯ï¼ŒHotSpot VMä½¿ç”¨å¯¹è±¡å¤´éƒ¨çš„ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ClassåŒºåŸŸçš„æ–¹å¼æ¥æ‰¾åˆ°å¯¹è±¡çš„Classæè¿°ï¼Œä»¥åŠå†…éƒ¨çš„æ–¹æ³•ã€å±æ€§å…¥å£ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜åœ¨å¯¹è±¡çš„å¤´éƒ¨åˆ’åˆ†äº†éƒ¨åˆ†ç©ºé—´ï¼ˆMark Wordï¼‰ï¼Œç”¨äºæè¿°ä¸å¯¹è±¡ç›¸å…³çš„å…¶ä»–ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šæ˜¯å¦åŠ é”ã€GCæ ‡å¿—ä½ã€Minor GCæ¬¡æ•°ã€å¯¹è±¡é»˜è®¤çš„hashCodeï¼ˆSystem.identityHashCode(object)å¯è·å–å¯¹è±¡çš„è¿™ä¸ªå€¼ï¼‰ã€‚ åœ¨32ä½ç³»ç»Ÿä¸‹ï¼Œå­˜æ”¾ClassæŒ‡é’ˆçš„ç©ºé—´å¤§å°æ˜¯4å­—èŠ‚ï¼ŒMark Wordç©ºé—´å¤§å°ä¹Ÿæ˜¯4å­—èŠ‚ï¼Œå› æ­¤å°±æ˜¯8å­—èŠ‚çš„å¤´éƒ¨ï¼Œå¦‚æœæ˜¯æ•°ç»„è¿˜éœ€è¦å¢åŠ 4å­—èŠ‚æ¥è¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ã€‚ åœ¨64ä½ç³»ç»ŸåŠ64ä½JVMä¸‹ï¼Œå¼€å¯æŒ‡é’ˆå‹ç¼©ï¼ˆå‚æ•°æ˜¯ -XX:+UseCompressedOopsï¼‰ï¼Œé‚£ä¹ˆå¤´éƒ¨å­˜æ”¾ClassæŒ‡é’ˆçš„ç©ºé—´å¤§å°è¿˜æ˜¯4å­—èŠ‚ï¼Œè€ŒMark WordåŒºåŸŸä¼šå˜å¤§ï¼Œå˜æˆ8å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯å¤´éƒ¨æœ€å°‘ä¸º12å­—èŠ‚ã€‚è‹¥æœªå¼€å¯æŒ‡é’ˆå‹ç¼©ï¼Œé‚£ä¹ˆä¿å­˜ClassæŒ‡é’ˆçš„ç©ºé—´å¤§å°ä¹Ÿä¼šå˜æˆ8å­—èŠ‚ï¼Œé‚£ä¹ˆå¯¹è±¡å¤´éƒ¨ä¼šå˜æˆ16å­—èŠ‚ã€‚å¦å¤–ï¼Œåœ¨64ä½æ¨¡å¼ä¸‹ï¼Œè‹¥æœªå¼€å¯å‹ç¼©ï¼Œå¼•ç”¨ä¹Ÿä¼šå˜æˆ8å­—èŠ‚ã€‚ æ­¤å¤–ï¼ŒJavaå¯¹è±¡å°†ä»¥8å­—èŠ‚å¯¹é½åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å ç”¨çš„ç©ºé—´ä¸æ˜¯8å­—èŠ‚çš„å€æ•°ï¼Œå°†ä¼šè¢«è¡¥é½ä¸º8å­—èŠ‚çš„å€æ•°ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåœ¨å¯¹è±¡åˆ†é…å’ŒæŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ä¸ç”¨è€ƒè™‘è¿‡å¤šçš„åç§»é‡é—®é¢˜ã€‚ ä»¥ä¸‹æ˜¯åœ¨32ä½ç³»ç»Ÿä¸‹ä¸€äº›å¸¸è§å¯¹è±¡å ç”¨çš„ç©ºé—´å¤§å°ç¤ºä¾‹ã€‚ æ²¡æœ‰ç»§æ‰¿çš„å¯¹è±¡å±æ€§æ’å¸ƒåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒHotSpot VMä¼šæŒ‰ç…§ä¸€ä¸ªé¡ºåºæ’å¸ƒå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œè¿™ä¸ªé¡ºåºæ˜¯ï¼Œlong/doubleâ€“&gt;int/floatâ€“&gt;short/charâ€“&gt;byte/booleanâ€“&gt;Referenceï¼ˆä¸å¯¹è±¡æœ¬èº«çš„å±æ€§é¡ºåºæ— å…³ï¼‰ã€‚ æœ‰ç»§æ‰¿çš„å¯¹è±¡å±æ€§æ’å¸ƒåœ¨HotSpot VMä¸­ï¼Œæœ‰ç»§æ‰¿å…³ç³»çš„å¯¹è±¡åœ¨åˆ›å»ºæ—¶ï¼Œçˆ¶ç±»çš„å±æ€§ä¼šè¢«åˆ†é…åˆ°ç›¸åº”çš„å¯¹è±¡ä¸­ï¼Œç”±äºçˆ¶ç±»çš„å±æ€§ä¸èƒ½å’Œå­ç±»æ··ç”¨ï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»å•ç‹¬æ’å¸ƒåœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯ä»¥è®¤ä¸ºå®ƒä»¬å°±æ˜¯ä»ä¸Šåˆ°ä¸‹çš„ä¸€ä¸ªé¡ºåºã€‚ä»¥ä¸¤é‡ç»§æ‰¿ä¸ºä¾‹ï¼Œå¯¹è±¡ç»§æ‰¿å±æ€§æ’å¸ƒè§„åˆ™å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è¿™é‡Œçš„å¯¹é½æœ‰ä¸¤ç§ï¼šä¸€æ˜¯æ•´ä¸ªå¯¹è±¡çš„8å­—èŠ‚å¯¹é½ï¼›äºŒæ˜¯çˆ¶ç±»åˆ°å­ç±»çš„å±æ€§å¯¹é½ã€‚åœ¨32ä½åŠ64ä½å‹ç¼©æ¨¡å¼ä¸‹ï¼Œä¼šæŒ‰ç…§4å­—èŠ‚å¯¹é½ã€‚ ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š class A {byte b;}class B extends A {byte b;}class C extends B {byte b;} å¦‚ä½•è®¡ç®—å¯¹è±¡å¤§å°æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“Javaå¯¹è±¡åˆ°åº•å ç”¨å¤šå°‘å†…å­˜ï¼Œæœ‰äººé€šè¿‡è¿ç»­è°ƒç”¨ä¸¤æ¬¡System.gc()æ¯”è¾ƒä¸¤æ¬¡gcå‰åå†…å­˜çš„ä½¿ç”¨é‡åœ¨è®¡ç®—javaå¯¹è±¡çš„å¤§å°ï¼Œä¹Ÿæœ‰äººæ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒä¸­çš„Javaå¯¹è±¡å†…å­˜æ’åˆ—ä¼°ç®—å¯¹è±¡çš„å¤§å°ï¼Œè¿™ä¸¤ç§æ–¹æ³•æˆ–å¤šæˆ–å°‘éƒ½æœ‰é—®é¢˜ï¼Œå› ä¸ºSystem.gc()å¹¶ä¸ä¸€å®šä¿ƒå‘GCï¼ŒåŒä¸€ä¸ªç±»å‹çš„å¯¹è±¡åœ¨32ä½ä¸64ä½JVMä¸­ä½¿ç”¨çš„å†…å­˜ä¼šä¸ä¸€æ ·ï¼Œåœ¨64ä½è™šæ‹Ÿæœºä¸­æ˜¯å¦å¼€å¯æŒ‡é’ˆå‹ç¼©ä¹Ÿä¼šå½±å“Javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¤§å°ã€‚ é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ—¢å‡†ç¡®åˆæ–¹ä¾¿çš„æ–¹æ³•è®¡ç®—å¯¹è±¡çš„å¤§å°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚åœ¨Java 5ä¸­å¼•å…¥äº†Instrumentationç±»ï¼Œè¿™ä¸ªç±»æä¾›äº†è®¡ç®—å¯¹è±¡å†…å­˜å ç”¨é‡çš„æ–¹æ³•ï¼›Hotspotæ”¯æŒinstrumentationæ¡†æ¶ï¼Œå…¶ä»–çš„è™šæ‹Ÿæœºä¹Ÿæä¾›äº†ç±»ä¼¼çš„æ¡†æ¶ã€‚ ä½¿ç”¨Instrumentationç±»è®¡ç®—Javaå¯¹è±¡å¤§å°çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆ›å»ºä¸€ä¸ªå«æœ‰premain()æ–¹æ³•çš„Java ç±»ã€‚package sizeof; import java.lang.instrument.Instrumentation; import java.lang.reflect.Array; import java.lang.reflect.Field; import java.lang.reflect.Modifier; import java.util.IdentityHashMap; import java.util.Map; import java.util.Stack; public class DeepObjectSizeOf { private static Instrumentation inst; public static void premain(String agentArgs, Instrumentation instP) { inst = instP; } public static long sizeOf(Object object) { //è®¡ç®—å½“å‰å¯¹è±¡çš„å†…å­˜å¤§å°ï¼Œä¸åŒ…å«å¼•ç”¨å¯¹è±¡ return inst.getObjectSize(object); } public static long deepSizeOf(Object obj) {//æ·±å…¥æ£€ç´¢å¯¹è±¡ï¼Œå¹¶è®¡ç®—å¤§å° Map&lt;Object, Object&gt; visited = new IdentityHashMap&lt;Object, Object&gt;(); Stack&lt;Object&gt; stack = new Stack&lt;Object&gt;(); long result = internalSizeOf(obj, stack, visited); while (!stack.isEmpty()) {//é€šè¿‡æ ˆè¿›è¡Œéå† result += internalSizeOf(stack.pop(), stack, visited); } visited.clear(); return result; } private static boolean needSkipObject(Object obj, Map&lt;Object, Object&gt; visited) { if (obj instanceof String) { if (obj == ((String) obj).intern()) { return true; } } return (obj == null) || visited.containsKey(obj); } private static long internalSizeOf(Object obj, Stack&lt;Object&gt; stack, Map&lt;Object, Object&gt; visited) { if (needSkipObject(obj, visited)) { return 0; } visited.put(obj, null);//å°†å½“å‰å¯¹è±¡æ”¾å…¥æ ˆä¸­ long result = 0; result += sizeOf(obj); Class &lt;?&gt;clazz = obj.getClass(); if (clazz.isArray()) {//å¦‚æœæ•°ç»„ if(clazz.getName().length() != 2) {//å¦‚æœprimitive type arrayï¼ŒClassçš„nameä¸º2ä½ int length = Array.getLength(obj); for (int i = 0; i &lt; length; i++) { stack.add(Array.get(obj, i)); } } return result; } return getNodeSize(clazz , result , obj , stack); } //è¿™ä¸ªæ–¹æ³•è·å–éæ•°ç»„å¯¹è±¡è‡ªèº«çš„å¤§å°ï¼Œå¹¶ä¸”å¯ä»¥å‘çˆ¶ç±»è¿›è¡Œå‘ä¸Šæœç´¢ private static long getNodeSize(Class &lt;?&gt;clazz , long result , Object obj , Stack&lt;Object&gt; stack) { while (clazz != null) { Field[] fields = clazz.getDeclaredFields(); for (Field field : fields) { if (!Modifier.isStatic(field.getModifiers())) {//è¿™é‡ŒæŠ›å¼€é™æ€å±æ€§ if (field.getType().isPrimitive()) {//è¿™é‡ŒæŠ›å¼€åŸºæœ¬å…³é”®å­—ï¼ˆå› ä¸ºåŸºæœ¬å…³é”®å­—åœ¨è°ƒç”¨javaé»˜è®¤æä¾›çš„æ–¹æ³•å°±å·²ç»è®¡ç®—è¿‡äº†ï¼‰ continue; }else { field.setAccessible(true); try { Object objectToAdd = field.get(obj); if (objectToAdd != null) { stack.add(objectToAdd);//å°†å¯¹è±¡æ”¾å…¥æ ˆä¸­ï¼Œä¸€éå¼¹å‡ºåç»§ç»­æ£€ç´¢ } } catch (IllegalAccessException ex) { assert false; } } } } clazz = clazz.getSuperclass();//æ‰¾çˆ¶ç±»classï¼Œç›´åˆ°æ²¡æœ‰çˆ¶ç±» } return result; } } JVMä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œä¹‹å‰è°ƒç”¨è¿™ä¸ªJava ç±»çš„premain()æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯åœ¨æ‰§è¡Œåº”ç”¨ç¨‹åºçš„mainæ–¹æ³•ä¹‹å‰ï¼‰ï¼ŒJVMä¼šåœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶ä¼ å…¥ä¸€ä¸ªå®ç°Instrumentationæ¥å£çš„å®ä¾‹ï¼Œé€šè¿‡è°ƒç”¨æ­¤æ¥å£å®ä¾‹çš„getObjectSize()æ–¹æ³•å¯ä»¥è®¡ç®—å‡ºå¯¹è±¡çš„å¤§å°ï¼ˆåªè®¡ç®—å½“å‰å¯¹è±¡çš„å¤§å°ï¼Œä¸ä¼šè¿›ä¸€æ­¥è®¡ç®—å†…éƒ¨å¼•ç”¨å¯¹è±¡çš„å¤§å°ï¼‰ã€‚ å°†åˆ›å»ºå¥½çš„Javaç±»æ‰“æˆä¸€ä¸ªjaråŒ…åœ¨æ‰“åŒ…ä¹‹å‰å…ˆåˆ›å»ºä¸€ä¸ªMANIFEST.txtæ–‡ä»¶ä½œä¸ºè¿™ä¸ªjaråŒ…çš„æ¸…å•æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š Manifest-Version: 1.0 Premain-Class: sizeof.DeepObjectSizeOf æŒ‰ç…§Javaç±»æ–‡ä»¶çš„åŒ…è·¯å¾„åˆ›å»ºå¥½ç›®å½•ï¼ˆDeepObjectSizeOf.classæ–‡ä»¶æ”¾åœ¨sizeofæ–‡ä»¶å¤¹ä¸­ï¼‰ã€‚ ä½¿ç”¨ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºjaråŒ…ï¼š jar -cmf MANIFEST.txt java_sizeof.jar sizeof/* ä¿®æ”¹JVMå¯åŠ¨é…ç½®ä¿®æ”¹Eclipse IDEçš„JVMå¯åŠ¨é…ç½®ï¼Œå¢åŠ -javaagentå¯åŠ¨å‚æ•°ï¼š -javaagent:jaræ–‡ä»¶è·¯å¾„ æˆ‘åˆ›å»ºçš„ java_sizeof.jaræ”¾åœ¨D:\\sizeofç›®å½•ä¸‹ï¼Œè®¾ç½®å‚æ•°å¦‚ä¸‹ã€‚ æµ‹è¯•æ ·ä¾‹åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»SizeOfMain.javaï¼Œä»£ç å¦‚ä¸‹ã€‚ package sizeof; public class SizeOfMain { public static void main(String[] args) { System.out.println(&quot;new Integer(1) å¯¹è±¡å¤§å°ï¼š&quot; + DeepObjectSizeOf.deepSizeOf(new Integer(1))); System.out.println(&quot;new String(\\&quot;sizeof\\&quot;) å¯¹è±¡å¤§å°ï¼š&quot; + DeepObjectSizeOf.deepSizeOf(new String(&quot;sizeof&quot;))); } } åœ¨64ä½æœºå™¨ä¸Šï¼ˆä¸å¼€å¯æŒ‡é’ˆå‹ç¼©ï¼‰ï¼š è®¾ç½®å‚æ•°ï¼š-javaagent:d:\\sizeof/java_sizeof.jar -XX:-UseCompressedOops æ‰§è¡Œç»“æœï¼š åœ¨64ä½æœºå™¨ä¸Šï¼ˆå¼€å¯æŒ‡é’ˆå‹ç¼©ï¼‰ï¼š è®¾ç½®å‚æ•°ï¼š-javaagent:d:\\sizeof/java_sizeof.jar -XX:+UseCompressedOops æ‰§è¡Œç»“æœï¼š","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸‹ï¼‰","slug":"æ·±å…¥ç†è§£JVMä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸‹ï¼‰","date":"2020-05-30T08:46:38.000Z","updated":"2023-04-30T10:21:41.372Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸‹ï¼‰/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸‹ï¼‰/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬2ç‰ˆ)ã€‹ åœ¨åˆ¤å®šï¼ˆå¯ä»¥é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•æˆ–è€…æ ¹æœç´¢ç®—æ³•ï¼‰å®Œå“ªäº›å¯¹è±¡è¿˜æ´»ç€ï¼Œå“ªäº›å¯¹è±¡å¯ä»¥è¢«å›æ”¶ä¹‹åï¼ŒGCç©¶ç«Ÿæ˜¯å¦‚ä½•è¿›è¡Œåƒåœ¾å›æ”¶çš„å‘¢ï¼Ÿ åƒåœ¾æ”¶é›†ç®—æ³•æ ‡è®°-æ¸…é™¤ç®—æ³•æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•æ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œå¦‚åŒå®ƒçš„åå­—ä¸€æ ·ï¼Œç®—æ³•åˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œæ ‡è®°è¿‡ç¨‹å…¶å®å°±æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•æˆ–è€…æ ¹æœç´¢ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚ä¹‹æ‰€ä»¥è¯´å®ƒæ˜¯æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•ï¼Œæ˜¯å› ä¸ºåç»­çš„æ”¶é›†ç®—æ³•éƒ½æ˜¯åŸºäºè¿™ç§æ€è·¯å¹¶å¯¹å…¶ä¸è¶³è¿›è¡Œæ”¹è¿›è€Œå¾—åˆ°çš„ã€‚å®ƒçš„ä¸»è¦ä¸è¶³æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ï¼›å¦ä¸€ä¸ªæ˜¯ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§çš„å¯¹è±¡æ—¶ï¼Œæ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚æ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¤åˆ¶ç®—æ³•ä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œå¤åˆ¶ï¼ˆCopingï¼‰ç®—æ³•å°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠè¿™å—å·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆã€‚åªæ˜¯è¿™ç§ç®—æ³•çš„ä»£ä»·æ˜¯å°†å†…å­˜ç¼©å°ä¸ºäº†åŸæ¥çš„ä¸€åŠï¼Œæœªå…å¤ªé«˜äº†ä¸€ç‚¹ã€‚å¤åˆ¶ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ ‡è®°-æ•´ç†ç®—æ³•å¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šé™ä½ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œå¦‚æœä¸æƒ³æµªè´¹50%çš„ç©ºé—´ï¼Œå°±éœ€è¦æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆä¾‹å¦‚ï¼Œåœ¨HotSpotè™šæ‹Ÿä¸­ï¼Œå¦‚æœSurvivorç©ºé—´æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾ä¸Šä¸€æ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡æ—¶ï¼Œè¿™äº›å¯¹è±¡å°†ç›´æ¥é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶è¿›å…¥è€å¹´ä»£ï¼‰ï¼Œä»¥åº”å¯¹è¢«ä½¿ç”¨çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½100%å­˜æ´»çš„æç«¯æƒ…å†µï¼Œæ‰€ä»¥è€å¹´ä»£ä¸€èˆ¬ä¸èƒ½ç›´æ¥é€‰ç”¨å¤åˆ¶æ”¶é›†ç®—æ³•ã€‚æ ¹æ®è€å¹´ä»£çš„ç‰¹ç‚¹ï¼Œæœ‰äººæå‡ºäº†å¦å¤–ä¸€ç§â€œæ ‡è®°-æ•´ç†â€ï¼ˆMark-Compactï¼‰ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚è¿™ç§æ–¹æ³•æ—¢é¿å…äº†å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿï¼Œåˆä¸ä¼šåƒå¤åˆ¶ç®—æ³•é‚£æ ·æµªè´¹è¿‡å¤šçš„å†…å­˜ç©ºé—´ã€‚ æ ‡è®°-æ•´ç†ç®—æ³•ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åˆ†ä»£æ”¶é›†ç®—æ³•å½“å‰å•†ä¸šè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ï¼ˆGenerational Collectionï¼‰ç®—æ³•ï¼Œè¿™ç§ç®—æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ã€‚ ä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚ åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé‚£å°±é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚ è€Œè€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ã€ æ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€œæ ‡è®°â€”æ¸…ç†â€æˆ–è€…â€œæ ‡è®°â€”æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚ åƒåœ¾æ”¶é›†å™¨å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•å®ç°å¹¶æ²¡æœ‰ä»»ä½•è§„å®šï¼Œå› æ­¤ä¸åŒçš„å‚å•†ã€ ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºæ‰€æä¾›çš„åƒåœ¾æ”¶é›†å™¨éƒ½å¯èƒ½ä¼šæœ‰å¾ˆå¤§å·®åˆ«ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½ä¼šæä¾›å‚æ•°ä¾›ç”¨æˆ·æ ¹æ®è‡ªå·±çš„åº”ç”¨ç‰¹ç‚¹å’Œè¦æ±‚ç»„åˆå‡ºå„ä¸ªå¹´ä»£æ‰€ä½¿ç”¨çš„æ”¶é›†å™¨ã€‚åœ¨æ­¤æˆ‘ä»¬å¯¹åŸºäºJDK 1.7 Update 14ä¹‹åçš„HotSpotè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†å™¨è¿›è¡Œè¯´æ˜ï¼Œè¿™ä¸ªè™šæ‹ŸæœºåŒ…å«çš„æ‰€æœ‰æ”¶é›†å™¨å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å›¾ä¸­å±•ç¤ºäº†7ç§ä½œç”¨äºä¸åŒåˆ†ä»£çš„æ”¶é›†å™¨ï¼Œå¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚ è™šæ‹Ÿæœºæ‰€å¤„çš„åŒºåŸŸï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯å±äºæ–°ç”Ÿä»£æ”¶é›†å™¨è¿˜æ˜¯è€å¹´ä»£æ”¶é›†å™¨ã€‚ Serialæ”¶é›†å™¨Serialæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œä½†å®ƒçš„â€œå•çº¿ç¨‹â€çš„æ„ä¹‰å¹¶ä¸ä»…ä»…è¯´æ˜å®ƒåªä¼šä½¿ç”¨ä¸€ä¸ªCPUæˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸï¼Œæœ‰ç‚¹ç±»ä¼¼â€œStop The Worldâ€ã€‚ä¸‹å›¾ç¤ºæ„äº†Serial/Serial Oldæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹ã€‚ ParNewæ”¶é›†å™¨ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šæ¡çº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ï¼ˆä¾‹å¦‚ï¼š-XXï¼šSurvivorRatioã€ -XXï¼šPretenureSizeThresholdã€ -XXï¼šHandlePromotionFailureç­‰ï¼‰ã€ æ”¶é›†ç®—æ³•ã€ Stop The Worldã€ å¯¹è±¡åˆ†é…è§„åˆ™ã€ å›æ”¶ç­–ç•¥ç­‰éƒ½ä¸Serialæ”¶é›†å™¨å®Œå…¨ä¸€æ ·ï¼Œåœ¨å®ç°ä¸Šï¼Œè¿™ä¸¤ç§æ”¶é›†å™¨ä¹Ÿå…±ç”¨äº†ç›¸å½“å¤šçš„ä»£ç ã€‚ ParNewæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¹¶è¡Œï¼ˆParallelï¼‰ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚ å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œäºå¦ä¸€ä¸ªCPUä¸Šã€‚ Parallel Scavengeæ”¶é›†å™¨Parallel Scavengeæ”¶é›†å™¨ä¸ParNewæ”¶é›†å™¨å­˜åœ¨å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä¾‹å¦‚ï¼šæ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå¤åˆ¶ç®—æ³•ã€å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚åŒå…¶å®ƒçš„æ”¶é›†å™¨ç›¸æ¯”ï¼ŒParallel Scavengeæ”¶é›†å™¨çš„ä¸ä¼—ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒçš„è¿è¡Œç›®æ ‡æ˜¯ä½¿ç³»ç»Ÿè¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚ æ‰€è°“ååé‡å°±æ˜¯CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ï¼Œè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚ CMSç­‰æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œåœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼Œè€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚ Parallel Scavengeæ”¶é›†å™¨æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´çš„-XXï¼šMaxGCPauseMilliså‚æ•°ä»¥åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„-XXï¼šGCTimeRatioå‚æ•°ã€‚ Serial Oldæ”¶é›†å™¨Serial Oldæ”¶é›†å™¨æ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚ è¿™ä¸ªæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯åœ¨äºç»™Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚ å¦‚æœåœ¨Serveræ¨¡å¼ä¸‹ï¼Œé‚£ä¹ˆå®ƒä¸»è¦è¿˜æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨JDK 1.5ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”å°±æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨ã€‚ Serial Oldæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ Parallel Oldæ”¶é›†å™¨Parallel Oldæ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚ Parallel Scavengeæ”¶é›†å™¨å’ŒParallel Oldæ”¶é›†å™¨ç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€ä¸ªåå‰¯å…¶å®çš„â€œååé‡ä¼˜å…ˆâ€çš„åº”ç”¨ç»„åˆï¼Œåœ¨æ³¨é‡ååé‡ä»¥åŠCPUèµ„æºæ•æ„Ÿçš„åœºåˆï¼Œå¯ä»¥è€ƒè™‘ä¼˜å…ˆä½¿ç”¨ã€‚ Parallel Oldæ”¶é›†å™¨çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ CMSæ”¶é›†å™¨CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œä½¿ç”¨â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ã€‚ CMSæ”¶é›†å™¨çš„å®Œæ•´è¿ä½œè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰ å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰ é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰ å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰ å…¶ä¸­ï¼Œåˆå§‹æ ‡è®°ã€ é‡æ–°æ ‡è®°è¿™ä¸¤ä¸ªæ­¥éª¤ä»ç„¶éœ€è¦â€œStop The Worldâ€ã€‚ åˆå§‹æ ‡è®°ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œå¹¶å‘æ ‡è®°é˜¶æ®µå°±æ˜¯è¿›è¡ŒGC RootsTracingçš„è¿‡ç¨‹ï¼Œè€Œé‡æ–°æ ‡è®°é˜¶æ®µåˆ™æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°çš„æ—¶é—´çŸ­ã€‚ ç”±äºæ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥ï¼Œä»æ€»ä½“ä¸Šæ¥è¯´ï¼ŒCMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚ é€šè¿‡ä¸‹å›¾å¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹åˆ°CMSæ”¶é›†å™¨çš„è¿ä½œæ­¥éª¤ä¸­å¹¶å‘å’Œéœ€è¦åœé¡¿çš„æ—¶é—´ã€‚ G1 æ”¶é›†å™¨G1ï¼ˆGarbage-Firstï¼‰æ”¶é›†å™¨æ˜¯å½“ä»Šæ”¶é›†å™¨æŠ€æœ¯å‘å±•çš„æœ€å‰æ²¿æˆæœä¹‹ä¸€ï¼Œä¸å…¶ä»–GCæ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š å¹¶è¡Œä¸å¹¶å‘ï¼šG1èƒ½å……åˆ†åˆ©ç”¨å¤šCPUã€ å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUï¼ˆCPUæˆ–è€…CPUæ ¸å¿ƒï¼‰æ¥ç¼©çŸ­Stop-The-Worldåœé¡¿çš„æ—¶é—´ï¼Œéƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©Javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚ åˆ†ä»£æ”¶é›†ï¼šä¸å…¶ä»–æ”¶é›†å™¨ä¸€æ ·ï¼Œåˆ†ä»£æ¦‚å¿µåœ¨G1ä¸­ä¾ç„¶å¾—ä»¥ä¿ç•™ã€‚ è™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†å®ƒèƒ½å¤Ÿé‡‡ç”¨ä¸åŒçš„æ–¹å¼å»å¤„ç†æ–°åˆ›å»ºçš„å¯¹è±¡å’Œå·²ç»å­˜æ´»äº†ä¸€æ®µæ—¶é—´ã€ ç†¬è¿‡å¤šæ¬¡GCçš„æ—§å¯¹è±¡ä»¥è·å–æ›´å¥½çš„æ”¶é›†æ•ˆæœã€‚ ç©ºé—´æ•´åˆï¼šä¸CMSçš„â€œæ ‡è®°â€”æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°â€”æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸¤ç§ç®—æ³•éƒ½æ„å‘³ç€G1è¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ï¼Œæ”¶é›†åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚ è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCã€‚ å¯é¢„æµ‹çš„åœé¡¿ï¼šè¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ï¼Œè¿™å‡ ä¹å·²ç»æ˜¯å®æ—¶Javaï¼ˆRTSJï¼‰çš„åƒåœ¾æ”¶é›†å™¨çš„ç‰¹å¾äº†ã€‚ åœ¨G1ä¹‹å‰çš„å…¶ä»–æ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€å¹´ä»£ï¼Œè€ŒG1ä¸å†æ˜¯è¿™æ ·ã€‚ ä½¿ç”¨G1æ”¶é›†å™¨æ—¶ï¼ŒJavaå †çš„å†…å­˜å¸ƒå±€å°±ä¸å…¶ä»–æ”¶é›†å™¨æœ‰å¾ˆå¤§å·®åˆ«ï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œè™½ç„¶è¿˜ä¿ç•™æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚ G1æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚ G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionï¼ˆè¿™ä¹Ÿå°±æ˜¯Garbage-Firståç§°çš„æ¥ç”±ï¼‰ã€‚ è¿™ç§ä½¿ç”¨Regionåˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚ åœ¨G1æ”¶é›†å™¨ä¸­ï¼ŒRegionä¹‹é—´çš„å¯¹è±¡å¼•ç”¨ä»¥åŠå…¶ä»–æ”¶é›†å™¨ä¸­çš„æ–°ç”Ÿä»£ä¸è€å¹´ä»£ä¹‹é—´çš„å¯¹è±¡å¼•ç”¨ï¼Œè™šæ‹Ÿæœºéƒ½æ˜¯ä½¿ç”¨Remembered Setæ¥é¿å…å…¨å †æ‰«æçš„ã€‚ G1ä¸­æ¯ä¸ªRegionéƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„Remembered Setï¼Œè™šæ‹Ÿæœºå‘ç°ç¨‹åºåœ¨å¯¹Referenceç±»å‹çš„æ•°æ®è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªWrite Barrieræš‚æ—¶ä¸­æ–­å†™æ“ä½œï¼Œæ£€æŸ¥Referenceå¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å¤„äºä¸åŒçš„Regionä¹‹ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œä¾¿é€šè¿‡CardTableæŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°è¢«å¼•ç”¨å¯¹è±¡æ‰€å±çš„Regionçš„Remembered Setä¹‹ä¸­ã€‚ å½“è¿›è¡Œå†…å­˜å›æ”¶æ—¶ï¼Œåœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´ä¸­åŠ å…¥Remembered Setå³å¯ä¿è¯ä¸å¯¹å…¨å †æ‰«æä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚ å¦‚æœä¸è®¡ç®—ç»´æŠ¤Remembered Setçš„æ“ä½œï¼ŒG1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰ æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰ ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰ åˆå§‹æ ‡è®°é˜¶æ®µä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNext Top at Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ç”¨çš„Regionä¸­åˆ›å»ºæ–°å¯¹è±¡ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚ å¹¶å‘æ ‡è®°é˜¶æ®µæ˜¯ä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ è€Œæœ€ç»ˆæ ‡è®°é˜¶æ®µåˆ™æ˜¯ä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹Remembered Set Logsé‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠRemembered Set Logsçš„æ•°æ®åˆå¹¶åˆ°Remembered Setä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚ æœ€ååœ¨ç­›é€‰å›æ”¶é˜¶æ®µé¦–å…ˆå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„GCåœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œä»Sunå…¬å¸é€éœ²å‡ºæ¥çš„ä¿¡æ¯æ¥çœ‹ï¼Œè¿™ä¸ªé˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…æé«˜æ”¶é›†æ•ˆç‡ã€‚ é€šè¿‡ä¸‹å›¾å¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹åˆ°G1æ”¶é›†å™¨çš„è¿ä½œæ­¥éª¤ä¸­å¹¶å‘å’Œéœ€è¦åœé¡¿çš„é˜¶æ®µã€‚ åƒåœ¾æ”¶é›†ç›¸å…³çš„å¸¸ç”¨å‚æ•°","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸Šï¼‰","slug":"æ·±å…¥ç†è§£JVMä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸Šï¼‰","date":"2020-05-30T08:45:38.000Z","updated":"2023-04-30T10:21:41.371Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸Šï¼‰/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--åƒåœ¾æ”¶é›†å™¨ï¼ˆä¸Šï¼‰/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬2ç‰ˆ)ã€‹ Javaè¯­è¨€å‡ºæ¥ä¹‹å‰ï¼Œç¨‹åºå¼€å‘æ›´å¤šçš„æ˜¯ä½¿ç”¨Cæˆ–è€…C++è¯­è¨€ï¼Œç„¶è€Œåœ¨Cæˆ–è€…C++è¯­è¨€ä¸­å­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„çŸ›ç›¾ï¼šåˆ›å»ºå¯¹è±¡æ—¶è¦ä¸æ–­åœ°è°ƒç”¨å¯¹è±¡çš„æ„é€ æ–¹æ³•æ¥ä¸ºå¯¹è±¡å¼€è¾Ÿç©ºé—´ï¼Œå¯¹è±¡ç”¨å®Œä¹‹ååˆéœ€è¦ä¸æ–­åœ°å»è°ƒç”¨ææ„æ–¹æ³•æ¥é‡Šæ”¾å®ƒæ‰€å çš„å†…å­˜ç©ºé—´ï¼Œæ—¢è¦å†™æ„é€ æ–¹æ³•ï¼Œåˆè¦å†™ææ„æ–¹æ³•ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯åœ¨åšé‡å¤çš„å·¥ä½œã€‚ä¸ºäº†è§£å†³è¿™ä¸€çŸ›ç›¾ï¼Œåƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collectionï¼ŒGCï¼‰åº”è¿è€Œç”Ÿã€‚ è¯´èµ·åƒåœ¾æ”¶é›†å™¨ï¼ˆGarbage Collectionï¼ŒGCï¼‰ï¼Œå¤§éƒ¨åˆ†äººéƒ½æŠŠè¿™é¡¹æŠ€æœ¯å½“ä½œJavaè¯­è¨€çš„ä¼´ç”Ÿäº§ç‰©ã€‚äº‹å®ä¸Šï¼ŒGCçš„å†å²æ¯”Javaä¹…è¿œï¼Œ1960å¹´è¯ç”ŸäºMITçš„Lispæ˜¯ç¬¬ä¸€é—¨çœŸæ­£ä½¿ç”¨å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯çš„è¯­è¨€ã€‚ å½“Lispè¿˜åœ¨èƒšèƒæ—¶æœŸæ—¶ï¼Œäººä»¬å°±åœ¨æ€è€ƒGCéœ€è¦å®Œæˆçš„3ä»¶äº‹æƒ…ï¼š å“ªäº›å†…å­˜éœ€è¦å›æ”¶ï¼Ÿ ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿ å¦‚ä½•å›æ”¶ï¼Ÿ ç”±äºJavaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸä¸­çš„ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ3ä¸ªåŒºåŸŸéšçº¿ç¨‹è€Œç”Ÿï¼Œéšçº¿ç¨‹è€Œç­ï¼›æ ˆä¸­çš„æ ˆå¸§éšç€æ–¹æ³•çš„è¿›å…¥å’Œé€€å‡ºè€Œæœ‰æ¡ä¸ç´Šåœ°æ‰§è¡Œç€å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œã€‚æ¯ä¸€ä¸ªæ ˆå¸§ä¸­åˆ†é…å¤šå°‘å†…å­˜åŸºæœ¬ä¸Šæ˜¯åœ¨ç±»ç»“æ„ç¡®å®šä¸‹æ¥æ—¶å°±å·²çŸ¥çš„ï¼Œå› æ­¤è¿™å‡ ä¸ªåŒºåŸŸçš„å†…å­˜åˆ†é…å’Œå›æ”¶éƒ½å…·å¤‡ç¡®å®šæ€§ï¼Œåœ¨è¿™å‡ ä¸ªåŒºåŸŸå°±ä¸éœ€è¦è¿‡å¤šè€ƒè™‘å›æ”¶çš„é—®é¢˜ï¼Œå› ä¸ºæ–¹æ³•ç»“æŸæˆ–è€…çº¿ç¨‹ç»“æŸæ—¶ï¼Œå†…å­˜è‡ªç„¶å°±è·Ÿéšç€å›æ”¶äº†ã€‚ åƒåœ¾æ”¶é›†å™¨å›æ”¶çš„é‡ç‚¹åŒºåŸŸæ˜¯ï¼šJavaå †å’Œæ–¹æ³•åŒº â€œå­˜æ´»â€orâ€œæ­»å»â€åƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å¯¹è±¡è¿›è¡Œå›æ”¶ä¹‹å‰ï¼Œéœ€å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯â€œå­˜æ´»â€ç€ï¼Œè¿˜æ˜¯å·²ç»â€œæ­»å»â€ï¼ˆå³ä¸å¯èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡ï¼‰ã€‚åƒåœ¾æ”¶é›†å™¨åªä¼šå¯¹é‚£äº›å·²ç»â€œæ­»å»â€çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚ å¸¸ç”¨çš„åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ç®—æ³•æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š 1. å¼•ç”¨è®¡æ•°ç®—æ³•å¼•ç”¨è®¡æ•°ï¼ˆReference Countingï¼‰ç®—æ³•æ˜¯åƒåœ¾æ”¶é›†å™¨ä¸­çš„æ—©æœŸç­–ç•¥ã€‚åœ¨è¿™ç§ç®—æ³•ä¸­ï¼Œå †ä¸­æ¯ä¸ªå¯¹è±¡ï¼ˆä¸æ˜¯å¼•ç”¨ï¼‰éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ã€‚å¯¹äºä¸€ä¸ªå¯¹è±¡ Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº† Aï¼Œåˆ™A çš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ  1ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡ 1ã€‚ä»»ä½•æ—¶åˆ»å¼•ç”¨è®¡æ•°ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ï¼Œå³å·²ç»â€œæ­»å»â€ã€‚ å¼•ç”¨è®¡æ•°ç®—æ³•å®ç°ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡ä¹Ÿå¾ˆé«˜ã€‚ä½†æ˜¯è¿™ä¸ªç®—æ³•æœ‰æ˜æ˜¾çš„ç¼ºé™·ï¼Œå¯¹äºå¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œå¾ªç¯å¼•ç”¨çš„å¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶ã€‚å¦‚A=B,B=A, æ­¤æ—¶ï¼Œå¯¹è±¡ A å’Œå¯¹è±¡B çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º 0ã€‚ä½†æ˜¯åœ¨ç³»ç»Ÿä¸­å´ä¸å­˜åœ¨ä»»ä½•ç¬¬ 3 ä¸ªå¯¹è±¡å¼•ç”¨äº† A æˆ– Bã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒA å’Œ B æ˜¯åº”è¯¥è¢«å›æ”¶çš„åƒåœ¾å¯¹è±¡ï¼Œä½†ç”±äºåƒåœ¾å¯¹è±¡é—´ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿åƒåœ¾æ”¶é›†å™¨æ— æ³•è¯†åˆ«ï¼Œå¼•èµ·å†…å­˜æ³„æ¼ã€‚ 2. æ ¹æœç´¢ç®—æ³•è¿™ç§ç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡ä¸€ç³»åˆ—åä¸ºâ€œGC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼ˆReference Chainï¼‰ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼ˆç”¨å›¾è®ºçš„è¯æ¥è¯´ï¼Œå°±æ˜¯ä»GC Rootsåˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾ï¼‰æ—¶ï¼Œå°±è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆè“è‰²è¡¨ç¤ºä¾ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œæ©™è‰²è¡¨ç¤ºå¯å›æ”¶çš„å¯¹è±¡ï¼‰ï¼Œå¯¹è±¡ObjDã€ObjEè™½ç„¶å½¼æ­¤æœ‰å…³è”ï¼Œä½†æ˜¯å®ƒä»¬åˆ°GC Rootsæ˜¯ä¸å¯è¾¾çš„ï¼Œæ‰€ä»¥å®ƒä»¬å°†ä¼šè¢«åˆ¤å®šä¸ºæ˜¯å¯å›æ”¶çš„å¯¹è±¡ã€‚ åœ¨Javaè¯­è¨€é‡Œï¼Œå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚ æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚ æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚ æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆNativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ã€‚ å†è°ˆå¼•ç”¨æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡æ ¹æœç´¢ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾ï¼Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»éƒ½ä¸â€œå¼•ç”¨æœ‰å…³â€ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ­¤å†è°ˆè°ˆå¼•ç”¨ã€‚ åœ¨JDK 1.2ä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ï¼ˆ Strong Referenceï¼‰ã€è½¯å¼•ç”¨ï¼ˆ Soft Referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆ Weak Referenceï¼‰ã€è™šå¼•ç”¨ï¼ˆ Phantom Referenceï¼‰å››ç§ï¼Œè¿™å››ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚ å¼ºå¼•ç”¨å¼ºå¼•ç”¨å°±æ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„ï¼Œç±»ä¼¼â€œObject obj = new Object()â€è¿™ç±»çš„å¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJavaè™šæ‹Ÿæœºå®æ„¿æŠ›å‡ºOutOfMemoryErroré”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚å¦‚æœä¸ä½¿ç”¨æ—¶ï¼Œå¯ä»¥èµ‹å€¼obj=nullï¼Œæ˜¾ç¤ºçš„è®¾ç½®objä¸ºnullï¼Œåˆ™GCè®¤ä¸ºè¯¥å¯¹è±¡ä¸å­˜åœ¨å¼•ç”¨ï¼Œè¿™æ—¶å€™å°±å¯ä»¥å›æ”¶æ­¤å¯¹è±¡ã€‚ è½¯å¼•ç”¨è½¯å¼•ç”¨ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†å¹¶éå¿…éœ€çš„å¯¹è±¡ã€‚å¯¹äºè½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ã€‚å¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚åœ¨ JDK 1.2 ä¹‹åï¼Œæä¾›äº† SoftReference ç±»æ¥å®ç°è½¯å¼•ç”¨ã€‚ è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ è½¯å¼•ç”¨ä¸»è¦åº”ç”¨äºå†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ï¼Œåœ¨Androidç³»ç»Ÿä¸­ç»å¸¸ä½¿ç”¨åˆ°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒAndroidåº”ç”¨ä¼šç”¨åˆ°å¤§é‡çš„é»˜è®¤å›¾ç‰‡ï¼Œè¿™äº›å›¾ç‰‡å¾ˆå¤šåœ°æ–¹ä¼šç”¨åˆ°ã€‚å¦‚æœæ¯æ¬¡éƒ½å»è¯»å–å›¾ç‰‡ï¼Œç”±äºè¯»å–æ–‡ä»¶éœ€è¦ç¡¬ä»¶æ“ä½œï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œä¼šå¯¼è‡´æ€§èƒ½è¾ƒä½ã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å°†å›¾ç‰‡ç¼“å­˜èµ·æ¥ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥ä»å†…å­˜ä¸­è¯»å–ã€‚ä½†æ˜¯ï¼Œç”±äºå›¾ç‰‡å ç”¨å†…å­˜ç©ºé—´æ¯”è¾ƒå¤§ï¼Œç¼“å­˜å¾ˆå¤šå›¾ç‰‡éœ€è¦å¾ˆå¤šçš„å†…å­˜ï¼Œå°±å¯èƒ½æ¯”è¾ƒå®¹æ˜“å‘ç”ŸOutOfMemoryå¼‚å¸¸ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨è½¯å¼•ç”¨æŠ€æœ¯æ¥é¿å…è¿™ä¸ªé—®é¢˜å‘ç”Ÿã€‚SoftReferenceå¯ä»¥è§£å†³oomçš„é—®é¢˜ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡é€šè¿‡è½¯å¼•ç”¨è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™ä¸ªå¯¹è±¡å°±ä»¥cacheçš„å½¢å¼ä¿å­˜èµ·æ¥ï¼Œå½“å†æ¬¡è°ƒç”¨è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œé‚£ä¹ˆç›´æ¥é€šè¿‡è½¯å¼•ç”¨ä¸­çš„get()æ–¹æ³•ï¼Œå°±å¯ä»¥å¾—åˆ°å¯¹è±¡ä¸­çš„èµ„æºæ•°æ®ï¼Œè¿™æ ·å°±æ²¡å¿…è¦å†æ¬¡è¿›è¡Œè¯»å–äº†ï¼Œç›´æ¥ä»cacheä¸­å°±å¯ä»¥è¯»å–å¾—åˆ°ï¼Œå½“å†…å­˜å°†è¦å‘ç”ŸOOMçš„æ—¶å€™ï¼ŒGCä¹Ÿèƒ½å›æ”¶è¯¥å†…å­˜ï¼Œé˜²æ­¢oomå‘ç”Ÿã€‚ å¼±å¼•ç”¨å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ã€‚ï¼Œå½“JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚åœ¨JDK 1.2ä¹‹åï¼Œç”¨WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚ ä»¥ä¸‹ä»£ç ç”¨äºå¯¹æ¯”åœ¨å†…å­˜å……è¶³çš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨System.gc()ä¹‹åï¼Œè½¯å¼•ç”¨ä¸å¼±å¼•ç”¨å…³è”å¯¹è±¡çš„ä¸åŒå›æ”¶ç»“æœã€‚ import java.lang.ref.WeakReference; /** * VM Args:-XX:+PrintHeapAtGC */ public class ReferenceTest { public static void main(String[] args) { byte[] bytes = new byte[1024 * 1024 * 5]; /** * å–æ¶ˆsoftBytesæ‰€åœ¨è¡Œæ³¨é‡Šï¼Œåœ¨å†…å­˜å……è¶³çš„æƒ…å†µä¸‹ï¼ŒGCä¸ä¼šå›æ”¶æ‰€å…³è”çš„byteæ•°ç»„ã€‚ */ // SoftReference&lt;byte[]&gt; softBytes=new SoftReference&lt;byte[]&gt;(bytes); /** * å–æ¶ˆweakBytesæ‰€åœ¨è¡Œæ³¨é‡Šï¼Œåœ¨å†…å­˜å……è¶³çš„æƒ…å†µä¸‹ï¼ŒGCä¹Ÿä¼šæˆåŠŸå›æ”¶æ‰€å…³è”çš„byteæ•°ç»„ã€‚ */ // WeakReference&lt;byte[]&gt; weakBytes=new WeakReference&lt;byte[]&gt;(bytes); bytes = null; System.gc(); } } æ‰§è¡Œç¨‹åºï¼Œæ ¹æ®PrintHeapAtGCæ‰€æ‰“å°å‡ºæ¥çš„å †å†…å­˜å›æ”¶æ—¥å¿—ï¼Œå¯å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼šè½¯å¼•ç”¨å…³è”çš„å¯¹è±¡æœªè¢«å›æ”¶ï¼Œè€Œå¼±å¼•ç”¨å…³è”çš„å¯¹è±¡è¢«æˆåŠŸå›æ”¶äº†ã€‚ è™šå¼•ç”¨è™šå¼•ç”¨ä¹Ÿç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ã€‚å’Œå‰é¢çš„è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ä¸åŒï¼Œå®ƒå¹¶ä¸å½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨JDK 1.2ä¹‹åï¼Œç”¨PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸è™šå¼•ç”¨å…³è”ï¼Œåˆ™è·Ÿæ²¡æœ‰å¼•ç”¨ä¸ä¹‹å…³è”ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚ æ­»é‡Œé€ƒç”Ÿâ€”-finalize()æ–¹æ³•è¢«åˆ¤å®šä¸ºå·²ç»â€œæ­»äº¡â€çš„å¯¹è±¡å¹¶ä¸æ˜¯ä¸€å®šä¼šè¢«JVMå›æ”¶ã€‚ä¸€ä¸ªå¯¹è±¡åœ¨è¢«å›æ”¶ä¹‹å‰ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼šåˆæ¬¡è¢«åˆ¤å®šä¸ºå·²ç»â€œæ­»äº¡â€åï¼Œå¯¹è±¡å°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰,ç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•,æˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€(å³æ„å‘³ç€ç›´æ¥å›æ”¶)ã€‚ å¦‚æœè¿™ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•,é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šæ”¾ç½®åœ¨ä¸€ä¸ªå«åšF-Queueçš„é˜Ÿåˆ—ä¹‹ä¸­,å¹¶åœ¨ç¨åç”±ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹å»æ‰§è¡Œå®ƒã€‚è¿™é‡Œæ‰€è°“çš„â€œæ‰§è¡Œâ€æ˜¯æŒ‡è™šæ‹Ÿæœºä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•,ä½†å¹¶ä¸æ‰¿è¯ºä¼šç­‰å¾…å®ƒè¿è¡Œç»“æŸ,è¿™æ ·åšçš„åŸå› æ˜¯,å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­æ‰§è¡Œç¼“æ…¢,æˆ–è€…å‘ç”Ÿäº†æ­»å¾ªç¯(æ›´æç«¯çš„æƒ…å†µ),å°†å¾ˆå¯èƒ½ä¼šå¯¼è‡´F-Queueé˜Ÿåˆ—ä¸­å…¶ä»–å¯¹è±¡æ°¸ä¹…å¤„äºç­‰å¾…,ç”šè‡³å¯¼è‡´æ•´ä¸ªå†…å­˜å›æ”¶ç³»ç»Ÿå´©æºƒã€‚ finalize()æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼š,ç¨åGCå°†å¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°,å¦‚æœå¯¹è±¡è¦åœ¨finalize()ä¸­æˆåŠŸæ‹¯æ•‘è‡ªå·±â€”â€”åªè¦é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹å…³è”å³å¯,è­¬å¦‚æŠŠè‡ªå·±(thiså…³é”®å­—)èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–è€…å¯¹è±¡çš„æˆå‘˜å˜é‡,é‚£åœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶å®ƒå°†è¢«ç§»é™¤å‡ºâ€œå³å°†å›æ”¶â€çš„é›†åˆ;å¦‚æœå¯¹è±¡è¿™æ—¶å€™è¿˜æ²¡æœ‰é€ƒè„±,é‚£åŸºæœ¬ä¸Šå®ƒå°±çœŸçš„è¢«å›æ”¶äº†ã€‚ public class FinalizeEscapeGC { public static FinalizeEscapeGC SAVE_HOOK = null; public void isAlive() { System.out.println(&quot;yes,i am still alive:)&quot;); } @Override protected void finalize() throws Throwable { super.finalize(); System.out.println(&quot;finalize mehtod executed!&quot;); FinalizeEscapeGC.SAVE_HOOK = this; } public static void main(String[] args) throws Throwable { SAVE_HOOK = new FinalizeEscapeGC(); // å¯¹è±¡ç¬¬ä¸€æ¬¡æˆåŠŸæ‹¯æ•‘è‡ªå·± SAVE_HOOK = null; System.gc(); // å› ä¸ºfinalizeæ–¹æ³•ä¼˜å…ˆçº§å¾ˆä½,æ‰€ä»¥æš‚åœ0.5ç§’ä»¥ç­‰å¾…å®ƒ Thread.sleep(500); if (SAVE_HOOK != null) { SAVE_HOOK.isAlive(); } else { System.out.println(&quot;no,i am dead:(&quot;); } // ä¸‹é¢è¿™æ®µä»£ç ä¸ä¸Šé¢çš„å®Œå…¨ç›¸åŒ,ä½†æ˜¯è¿™æ¬¡è‡ªæ•‘å´å¤±è´¥äº† SAVE_HOOK = null; System.gc(); // å› ä¸ºfinalizeæ–¹æ³•ä¼˜å…ˆçº§å¾ˆä½,æ‰€ä»¥æš‚åœ0.5ç§’ä»¥ç­‰å¾…å®ƒ Thread.sleep(500); if (SAVE_HOOK != null) { SAVE_HOOK.isAlive(); } else { System.out.println(&quot;no,i am dead:(&quot;); } } } è¿è¡Œç»“æœï¼š finalize mehtod executed!yes,i am still alive:)no,i am dead:( ä»è¿è¡Œç»“æœæ¥çœ‹SAVE_HOOKå¯¹è±¡çš„finalize()æ–¹æ³•ç¡®å®è¢«GCæ”¶é›†å™¨è§¦å‘è¿‡ï¼Œï¼Œå¹¶ä¸”åœ¨è¢«æ”¶é›†å‰æˆåŠŸé€ƒè„±äº†ã€‚ å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œä»£ç ä¸­æœ‰ä¸¤æ®µå®Œå…¨ä¸€æ ·çš„ä»£ç ç‰‡æ®µï¼Œæ‰§è¡Œç»“æœå´æ˜¯ä¸€æ¬¡é€ƒè„±æˆåŠŸï¼Œä¸€æ¬¡å¤±è´¥ï¼Œè¿™æ˜¯å› ä¸ºä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•éƒ½åªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœå¯¹é¢é¢ä¸´ä¸‹ä¸€æ¬¡å›æ”¶ï¼Œå®ƒçš„finalize()æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡æ‰§è¡Œï¼Œå› æ­¤ç¬¬äºŒæ®µä»£ç çš„è‡ªæ•‘è¡ŒåŠ¨å¤±è´¥äº†ã€‚ å›æ”¶æ–¹æ³•åŒºå¾ˆå¤šäººä»¥ä¸ºæ–¹æ³•åŒºï¼ˆæˆ–è€…HotSopt VMä¸­çš„æ°¸ä¹…ä»£ï¼‰æ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†çš„ï¼ŒJavaè™šæ‹Ÿæœºè§„èŒƒä¸­ç¡®å®è¯´è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºåœ¨æ–¹æ³•åŒºå®ç°åƒåœ¾æ”¶é›†ï¼Œè€Œä¸”æ€§ä»·æ¯”ä¸€èˆ¬è¾ƒä½ï¼Œåœ¨å¯¹çš„æ–°ç”Ÿä»£ç”Ÿä¸€èˆ¬èƒ½å›æ”¶70%~95%çš„ç©ºé—´ï¼Œè€Œæ°¸ä¹…ä»£è¿œä½äºæ­¤ã€‚ æ°¸ä¹…ä»£çš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šåºŸå¼ƒå¸¸é‡å’Œæ— ç”¨çš„ç±»ã€‚ å›æ”¶åºŸå¼ƒå¸¸é‡ä¸å›æ”¶Javaå †ä¸­çš„å¯¹è±¡éå¸¸ç›¸ä¼¼ã€‚ä»¥å¸¸é‡æ± ä¸­å­—é¢é‡çš„å›æ”¶ä¸ºä¾‹ï¼Œè‹¥å­—ç¬¦ä¸²â€œabcâ€å·²ç»è¿›å…¥å¸¸é‡æ± ä¸­ï¼Œä½†å½“å‰ç³»ç»Ÿæ²¡æœ‰ä»»ä½•Stringå¯¹è±¡å¼•ç”¨å¸¸é‡æ± ä¸­çš„â€œabcâ€å¸¸é‡ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¯¥å­—é¢é‡ï¼Œè‹¥å‘ç”Ÿå†…å­˜å›æ”¶ï¼Œä¸”å¿…è¦çš„è¯ï¼Œè¯¥â€œabcâ€å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± ã€‚å¸¸é‡æ± ä¸­å…¶ä»–çš„ç±»ï¼ˆæ¥å£ï¼‰ã€æ–¹æ³•ã€å­—æ®µçš„ç¬¦å·å¼•ç”¨ä¸æ­¤ç±»ä¼¼ã€‚ æ— ç”¨çš„ç±»éœ€è¦æ»¡è¶³3ä¸ªæ¡ä»¶ï¼š è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œå³Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ï¼› åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶ï¼› è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚ è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿°3ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œæ­¤å¤„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ï¼Œä¸ä½¿ç”¨äº†å°±å¿…ç„¶å›æ”¶ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--JVMå†…å­˜æ¨¡å‹","slug":"æ·±å…¥ç†è§£JVMä¹‹--JVMå†…å­˜æ¨¡å‹","date":"2020-05-30T08:44:38.000Z","updated":"2023-04-30T10:21:41.369Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--JVMå†…å­˜æ¨¡å‹/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--JVMå†…å­˜æ¨¡å‹/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬2ç‰ˆ)ã€‹ Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚è¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”ï¼Œä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶é—´ï¼Œæœ‰çš„åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œæœ‰äº›åŒºåŸŸåˆ™æ˜¯ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ã€‚æ ¹æ®ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒï¼ˆJava SE 7 ç‰ˆï¼‰ã€‹çš„è§„å®šï¼ŒJavaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜å°†ä¼šåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªè¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ1ã€ç¨‹åºè®¡æ•°å™¨ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œï¼ˆä»…æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå„ç§è™šæ‹Ÿæœºå¯èƒ½ä¼šé€šè¿‡ä¸€äº›æ›´é«˜æ•ˆçš„æ–¹å¼å»å®ç°ï¼‰ï¼Œå­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ ç”±äºJava è™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨ï¼ˆå¯¹äºå¤šæ ¸å¤„ç†å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå†…æ ¸ï¼‰åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚å› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´çš„è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚ å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªJava æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯Natvie æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼åˆ™ä¸ºç©ºï¼ˆUndefinedï¼‰ã€‚æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Java è™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryError æƒ…å†µçš„åŒºåŸŸã€‚ 2ã€Java è™šæ‹Ÿæœºæ ˆä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼ŒJava è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚ ç»å¸¸æœ‰äººæŠŠJava å†…å­˜ç²—ç•¥åœ°åŒºåˆ†ä¸ºå †å†…å­˜ï¼ˆHeapï¼‰å’Œæ ˆå†…å­˜ï¼ˆStackï¼‰ï¼Œè¿™é‡Œçš„â€œæ ˆå†…å­˜â€å°±æ˜¯æŒ‡çš„è™šæ‹Ÿæœºæ ˆï¼Œæˆ–è€…è¯´æ˜¯è™šæ‹Ÿæœºæ ˆä¸­çš„å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ã€‚ å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸ç­‰åŒäºå¯¹è±¡æœ¬èº«ï¼Œæ ¹æ®ä¸åŒçš„è™šæ‹Ÿæœºå®ç°ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–è€…å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰å’ŒreturnAddress ç±»å‹ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚ å…¶ä¸­64 ä½é•¿åº¦çš„long å’Œdouble ç±»å‹çš„æ•°æ®ä¼šå ç”¨2 ä¸ªå±€éƒ¨å˜é‡ç©ºé—´ï¼ˆSlotï¼‰ï¼Œå…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨1 ä¸ªã€‚å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨å¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚ åœ¨Java è™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¯¹è¿™ä¸ªåŒºåŸŸè§„å®šäº†ä¸¤ç§å¼‚å¸¸çŠ¶å†µï¼šå¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowError å¼‚å¸¸ï¼›å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼ˆå½“å‰å¤§éƒ¨åˆ†çš„Java è™šæ‹Ÿæœºéƒ½å¯åŠ¨æ€æ‰©å±•ï¼Œåªä¸è¿‡Java è™šæ‹Ÿæœºè§„èŒƒä¸­ä¹Ÿå…è®¸å›ºå®šé•¿åº¦çš„è™šæ‹Ÿæœºæ ˆï¼‰ï¼Œå½“æ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryError å¼‚å¸¸ã€‚ 3ã€æœ¬åœ°æ–¹æ³•æ ˆæœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰ä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå…¶åŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJava æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Native æ–¹æ³•æœåŠ¡ã€‚è™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„æ–¹æ³•ä½¿ç”¨çš„è¯­è¨€ã€ä½¿ç”¨æ–¹å¼ä¸æ•°æ®ç»“æ„å¹¶æ²¡æœ‰å¼ºåˆ¶è§„å®šï¼Œå› æ­¤å…·ä½“çš„è™šæ‹Ÿæœºå¯ä»¥è‡ªç”±å®ç°å®ƒã€‚ç”šè‡³æœ‰çš„è™šæ‹Ÿæœºï¼ˆè­¬å¦‚Sun HotSpot è™šæ‹Ÿæœºï¼‰ç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåŒºåŸŸä¹Ÿä¼šæŠ›å‡ºStackOverflowError å’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚ 4ã€Java å †å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼ŒJava å †ï¼ˆJava Heapï¼‰æ˜¯Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Java å †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚è¿™ä¸€ç‚¹åœ¨Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„æè¿°æ˜¯ï¼šæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ï¼Œä½†æ˜¯éšç€JIT ç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯çš„é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–å‘ç”Ÿï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åœ¨å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸æ˜¯é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚ Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™ä¹Ÿè¢«ç§°åšâ€œGC å †â€ï¼ˆGarbage Collected Heapï¼Œå¹¸å¥½å›½å†…æ²¡ç¿»è¯‘æˆâ€œåƒåœ¾å †â€ï¼‰ã€‚ä»å†…å­˜å›æ”¶çš„è§’åº¦æ¥çœ‹ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨çš„åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥Java å †ä¸­è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹çš„æœ‰Eden ç©ºé—´ã€From Survivor ç©ºé—´ã€To Survivor ç©ºé—´ç­‰ã€‚ä»å†…å­˜åˆ†é…çš„è§’åº¦æ¥çœ‹ï¼Œçº¿ç¨‹å…±äº«çš„Java å †ä¸­å¯èƒ½åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ã€‚ä¸è¿‡ï¼Œæ— è®ºå¦‚ä½•åˆ’åˆ†ï¼Œéƒ½ä¸å­˜æ”¾å†…å®¹æ— å…³ï¼Œæ— è®ºå“ªä¸ªåŒºåŸŸï¼Œå­˜å‚¨çš„éƒ½ä»ç„¶æ˜¯å¯¹è±¡å®ä¾‹ï¼Œè¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚ æ ¹æ®Java è™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼ŒJava å †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ï¼Œå°±åƒæˆ‘ä»¬çš„ç£ç›˜ç©ºé—´ä¸€æ ·ã€‚åœ¨å®ç°æ—¶ï¼Œæ—¢å¯ä»¥å®ç°æˆå›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¿‡å½“å‰ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§å¯æ‰©å±•æ¥å®ç°çš„ï¼ˆé€šè¿‡-Xmxå’Œ-Xms æ§åˆ¶ï¼‰ã€‚å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryError å¼‚å¸¸ã€‚ 5ã€æ–¹æ³•åŒºæ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸Java å †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚è™½ç„¶Java è™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åšNon-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸Java å †åŒºåˆ†å¼€æ¥ã€‚ å¯¹äºä¹ æƒ¯åœ¨HotSpot è™šæ‹Ÿæœºä¸Šå¼€å‘å’Œéƒ¨ç½²ç¨‹åºçš„å¼€å‘è€…æ¥è¯´ï¼Œå¾ˆå¤šäººæ„¿æ„æŠŠæ–¹æ³•åŒºç§°ä¸ºâ€œæ°¸ä¹…ä»£â€ï¼ˆPermanent Generationï¼‰ï¼Œæœ¬è´¨ä¸Šä¸¤è€…å¹¶ä¸ç­‰ä»·ï¼Œä»…ä»…æ˜¯å› ä¸ºHotSpot è™šæ‹Ÿæœºçš„è®¾è®¡å›¢é˜Ÿé€‰æ‹©æŠŠGC åˆ†ä»£æ”¶é›†æ‰©å±•è‡³æ–¹æ³•åŒºï¼Œæˆ–è€…è¯´ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²ã€‚å¯¹äºå…¶ä»–è™šæ‹Ÿæœºï¼ˆå¦‚BEA JRockitã€IBM J9 ç­‰ï¼‰æ¥è¯´æ˜¯ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µçš„ã€‚å³ä½¿æ˜¯HotSpot è™šæ‹Ÿæœºæœ¬èº«ï¼Œæ ¹æ®å®˜æ–¹å‘å¸ƒçš„è·¯çº¿å›¾ä¿¡æ¯ï¼Œç°åœ¨ä¹Ÿæœ‰æ”¾å¼ƒæ°¸ä¹…ä»£å¹¶â€œæ¬å®¶â€è‡³Native Memory æ¥å®ç°æ–¹æ³•åŒºçš„è§„åˆ’äº†ã€‚ Java è™šæ‹Ÿæœºè§„èŒƒå¯¹è¿™ä¸ªåŒºåŸŸçš„é™åˆ¶éå¸¸å®½æ¾ï¼Œé™¤äº†å’ŒJava å †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜å’Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‰©å±•å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©ä¸å®ç°åƒåœ¾æ”¶é›†ã€‚ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†å¹¶éæ•°æ®è¿›å…¥äº†æ–¹æ³•åŒºå°±å¦‚æ°¸ä¹…ä»£çš„åå­—ä¸€æ ·â€œæ°¸ä¹…â€å­˜åœ¨äº†ã€‚è¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸ªåŒºåŸŸçš„å›æ”¶â€œæˆç»©â€æ¯”è¾ƒéš¾ä»¥ä»¤äººæ»¡æ„ï¼Œå°¤å…¶æ˜¯ç±»å‹çš„å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶ç¡®å®æ˜¯æœ‰å¿…è¦çš„ã€‚åœ¨Sun å…¬å¸çš„BUG åˆ—è¡¨ä¸­ï¼Œæ›¾å‡ºç°è¿‡çš„è‹¥å¹²ä¸ªä¸¥é‡çš„BUG å°±æ˜¯ç”±äºä½ç‰ˆæœ¬çš„HotSpot è™šæ‹Ÿæœºå¯¹æ­¤åŒºåŸŸæœªå®Œå…¨å›æ”¶è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ æ ¹æ®Java è™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼Œå½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryError å¼‚å¸¸ã€‚ 6ã€è¿è¡Œæ—¶å¸¸é‡æ± è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ç­‰ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚ Java è™šæ‹Ÿæœºå¯¹Class æ–‡ä»¶çš„æ¯ä¸€éƒ¨åˆ†ï¼ˆè‡ªç„¶ä¹ŸåŒ…æ‹¬å¸¸é‡æ± ï¼‰çš„æ ¼å¼éƒ½æœ‰ä¸¥æ ¼çš„è§„å®šï¼Œæ¯ä¸€ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨å“ªç§æ•°æ®éƒ½å¿…é¡»ç¬¦åˆè§„èŒƒä¸Šçš„è¦æ±‚ï¼Œè¿™æ ·æ‰ä¼šè¢«è™šæ‹Ÿæœºè®¤å¯ã€è£…è½½å’Œæ‰§è¡Œã€‚ä½†å¯¹äºè¿è¡Œæ—¶å¸¸é‡æ± ï¼ŒJava è™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰åšä»»ä½•ç»†èŠ‚çš„è¦æ±‚ï¼Œä¸åŒçš„æä¾›å•†å®ç°çš„è™šæ‹Ÿæœºå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€è¦æ¥å®ç°è¿™ä¸ªå†…å­˜åŒºåŸŸã€‚ä¸è¿‡ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé™¤äº†ä¿å­˜Class æ–‡ä»¶ä¸­æè¿°çš„ç¬¦å·å¼•ç”¨å¤–ï¼Œè¿˜ä¼šæŠŠç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¹Ÿå­˜å‚¨åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äºClass æ–‡ä»¶å¸¸é‡æ± çš„å¦å¤–ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å…·å¤‡åŠ¨æ€æ€§ï¼ŒJava è¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªèƒ½åœ¨ç¼–è¯‘æœŸäº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯å¹¶éé¢„ç½®å…¥Class æ–‡ä»¶ä¸­å¸¸é‡æ± çš„å†…å®¹æ‰èƒ½è¿›å…¥æ–¹æ³•åŒºè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œè¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¾¿æ˜¯String ç±»çš„intern() æ–¹æ³•ã€‚ æ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œè‡ªç„¶ä¼šå—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶ï¼Œå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryError å¼‚å¸¸ã€‚ 7ã€ç›´æ¥å†…å­˜ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryError å¼‚å¸¸å‡ºç°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¾åˆ°è¿™é‡Œä¸€èµ·è®²è§£ã€‚ åœ¨JDK 1.4 ä¸­æ–°åŠ å…¥äº†NIOï¼ˆNew Input/Outputï¼‰ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ï¼ˆChannelï¼‰ä¸ç¼“å†²åŒºï¼ˆBufferï¼‰çš„I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Java å †é‡Œé¢çš„DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨Java å †å’ŒNative å †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚ æ˜¾ç„¶ï¼Œæœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ°Java å †å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜ï¼Œåˆ™è‚¯å®šè¿˜æ˜¯ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜ï¼ˆåŒ…æ‹¬RAM åŠSWAP åŒºæˆ–è€…åˆ†é¡µæ–‡ä»¶ï¼‰çš„å¤§å°åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚æœåŠ¡å™¨ç®¡ç†å‘˜é…ç½®è™šæ‹Ÿæœºå‚æ•°æ—¶ï¼Œä¸€èˆ¬ä¼šæ ¹æ®å®é™…å†…å­˜è®¾ç½®-Xmxç­‰å‚æ•°ä¿¡æ¯ï¼Œä½†ç»å¸¸ä¼šå¿½ç•¥æ‰ç›´æ¥å†…å­˜ï¼Œä½¿å¾—å„ä¸ªå†…å­˜åŒºåŸŸçš„æ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶ï¼ˆåŒ…æ‹¬ç‰©ç†ä¸Šçš„å’Œæ“ä½œç³»ç»Ÿçº§çš„é™åˆ¶ï¼‰ï¼Œä»è€Œå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç°OutOfMemoryErrorå¼‚å¸¸ã€‚ äºŒã€OutOfMemoryErrorå¼‚å¸¸åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒçš„æè¿°ä¸­ï¼Œé™¤äº†ç¨‹åºè®¡æ•°å™¨å¤–ï¼Œè™šæ‹Ÿæœºå†…å­˜çš„å…¶ä»–å‡ ä¸ªè¿è¡Œæ—¶åŒºåŸŸéƒ½æœ‰å‘ç”ŸOutOfMemoryErrorï¼ˆOOMï¼‰å¼‚å¸¸çš„å¯èƒ½ï¼Œä»¥ä¸‹å°†é€šè¿‡å®ä¾‹æ¥æ¨¡æ‹Ÿå„ä¸ªåŒºåŸŸå‘ç”ŸOOMå¼‚å¸¸çš„åœºæ™¯ã€‚ 1ã€Javaå †æº¢å‡ºJavaå †ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œåªè¦ä¸æ–­åœ°åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”ä¿è¯GC Rootsåˆ°å¯¹è±¡ä¹‹é—´æœ‰å¯è¾¾è·¯å¾„æ¥é¿å…åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤è¿™äº›å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨å¯¹è±¡æ•°é‡åˆ°è¾¾æœ€å¤§å †çš„å®¹é‡é™åˆ¶åå°±ä¼šäº§ç”Ÿå†…å­˜æº¢å‡ºã€‚ ä¿®æ”¹Eclipse IDEçš„è™šæ‹Ÿæœºå¯åŠ¨å‚æ•°å¦‚ä¸‹ï¼š-Xms20M -Xmx20M -Xmn10M -XX:SurvivorRatio=8 å°†Javaå †çš„å¤§å°é™åˆ¶ä¸º20MBï¼Œä¸å¯æ‰©å±•ï¼ˆå°†å †çš„æœ€å°å€¼-Xmså‚æ•°ä¸æœ€å¤§å€¼-Xmxå‚æ•°è®¾ç½®ä¸ºä¸€æ ·å³å¯é¿å…å †è‡ªåŠ¨æ‰©å±•ï¼‰ï¼Œå…¶ä¸­å¹´è½»ä»£å¤§å°ä¸º10Mï¼ˆ-Xmnå‚æ•°æŒ‡å®šï¼‰ï¼ŒEdenç©ºé—´ä¸å•ä¸ªSurvivorç©ºé—´ï¼ˆFrom Survivorç©ºé—´æˆ–To Survivorç©ºé—´ï¼‰å¤§å°æ¯”å€¼ä¸º 8:1ã€‚ æ­¤æ—¶JVMå †å†…å­˜å„ä¸ªç©ºé—´å¤§å°åˆ†é…å¦‚ä¸‹ï¼š ï¼ˆHeapæ€»å¤§å°ï¼‰20MB = ï¼ˆEdenç©ºé—´ï¼‰8MB+ï¼ˆSurvivorç©ºé—´ï¼‰1MB*2+ï¼ˆè€å¹´ä»£ï¼‰10MB æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š import java.util.ArrayList; import java.util.List; /** * VM Args:-Xms20M -Xmx20M -Xmn10M -XX:SurvivorRatio=8 */ public class HeapOOM { static class OOMObject { } public static void main(String[] args) { List&lt;OOMObject&gt; list = new ArrayList&lt;OOMObject&gt;(); while (true) { list.add(new OOMObject()); } } } è¿è¡Œç»“æœï¼š 2ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡ºç”±äºåœ¨HotSpotè™šæ‹Ÿæœºä¸­å¹¶ä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œå› æ­¤ï¼Œå¯¹äºhotSpotæ¥è¯´ï¼Œè™½ç„¶-Xosså‚æ•°ï¼ˆè®¾ç½®æœ¬åœ°æ–¹æ³•æ ˆå¤§å°ï¼‰å­˜åœ¨ï¼Œä½†å®é™…ä¸Šæ˜¯æ— æ•ˆçš„ï¼Œæ ˆå®¹é‡åªç”±-Xsså‚æ•°è®¾å®šã€‚å…³äºè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æè¿°äº†ä¸¤ç§å¼‚å¸¸ï¼š å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ã€‚ å¦‚æœè™šæ‹Ÿæœºåœ¨æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š /** * VM Args:-Xss128k */ public class JavaVMStackSOF { private int stackLength = 1; public void stackLeak() { stackLength++; stackLeak(); } public static void main(String[] args) throws Throwable { JavaVMStackSOF sof = new JavaVMStackSOF(); try { sof.stackLeak(); } catch (Throwable e) { System.out.println(&quot;stack length:&quot; + sof.stackLength); throw e; } } } è¿è¡Œç»“æœï¼š æ³¨æ„ï¼š ä»¥ä¸Šæµ‹è¯•ä»£ç åœ¨å•çº¿ç¨‹ä¸­è¿›è¡Œæ“ä½œï¼Œè‹¥ä½¿ç”¨-Xsså‚æ•°å‡å°‘æ ˆå†…å­˜å®¹é‡æˆ–åœ¨æ–¹æ³•ä¸­å®šä¹‰æœ¬åœ°å˜é‡ï¼Œå‡ä¼šå¯¼è‡´æŠ›å‡ºStackOverflowErrorå¼‚å¸¸æ—¶è¾“å‡ºçš„å †æ ˆæ·±åº¦å‡å°ã€‚ åœ¨å•çº¿ç¨‹ä¸‹ï¼Œæ— è®ºæ˜¯ç”±äºæ ˆå¸§å¤ªå¤§è¿˜æ˜¯è™šæ‹Ÿæœºæ ˆå®¹é‡å¤ªå°ï¼Œå½“å†…å­˜æ— æ³•åˆ†é…çš„æ—¶å€™ï¼Œè™šæ‹ŸæœºæŠ›å‡ºçš„éƒ½æ˜¯StackOverflowErrorå¼‚å¸¸ã€‚ ç†è®ºä¸Šé€šè¿‡ä¸æ–­åœ°åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼æ˜¯å¯ä»¥äº§ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸çš„ï¼Œä¾‹å¦‚ä¸‹é¢çš„æµ‹è¯•ä»£ç ï¼Œä½†æ˜¯è¿™æ ·äº§ç”Ÿçš„å†…å­˜æº¢å‡ºä¸æ ˆç©ºé—´æ˜¯å¦è¶³å¤Ÿå¤§å¹¶ä¸å­˜åœ¨ä»»ä½•è”ç³»ï¼Œæˆ–è€…å‡†ç¡®åœ°è¯´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…çš„å†…å­˜è¶Šå¤§ï¼Œåè€Œè¶Šå®¹æ˜“äº§ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚ å¯¼è‡´ä»¥ä¸Šç°è±¡å‡ºç°çš„åŸå› å¦‚ä¸‹ï¼šæ“ä½œç³»ç»Ÿåˆ†é…ç»™æ¯ä¸ªè¿›ç¨‹çš„å†…å­˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œè­¬å¦‚32ä½çš„Windowsé™åˆ¶ä¸º2GBã€‚è™šæ‹Ÿæœºæä¾›äº†å‚æ•°æ¥æ§åˆ¶Javaå †å’Œæ–¹æ³•åŒºçš„è¿™ä¸¤éƒ¨åˆ†å†…å­˜çš„æœ€å¤§å€¼ã€‚å‰©ä½™çš„å†…å­˜ä¸º2GBï¼ˆWindowsæ“ä½œç³»ç»Ÿé™åˆ¶ï¼‰å‡å»Xmxï¼ˆæœ€å¤§å †å®¹é‡ï¼‰ï¼Œå†å‡å»MaxPermSizeï¼ˆæœ€å¤§æ–¹æ³•åŒºå®¹é‡ï¼‰ï¼Œç¨‹åºè®¡æ•°å™¨æ¶ˆè€—å†…å­˜å¾ˆå°ï¼Œå¯ä»¥å¿½ç•¥æ‰ã€‚å¦‚æœè™šæ‹Ÿæœºè¿›ç¨‹æœ¬èº«è€—è´¹çš„å†…å­˜ä¸è®¡ç®—åœ¨å†…ï¼Œå‰©ä¸‹çš„å†…å­˜å°±ç”±è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆâ€œç“œåˆ†â€äº†ã€‚æ¯ä¸ªçº¿ç¨‹åˆ†é…åˆ°çš„æ ˆå®¹é‡è¶Šå¤§ï¼Œå¯ä»¥å»ºç«‹çš„çº¿ç¨‹æ•°é‡è‡ªç„¶å°±è¶Šå°‘ï¼Œå»ºç«‹çº¿ç¨‹æ—¶å°±è¶Šå®¹æ˜“æŠŠå‰©ä¸‹çš„å†…å­˜è€—å°½ã€‚ /** *VM Args:-Xss4M(è¿™æ—¶å€™ä¸å¦¨è®¾ç½®å¤§äº›) */ public class JavaVMStackOOM { private void dontStop() { while (true) { } } public void stackLeakByThread() { while (true) { Thread thread = new Thread(new Runnable() { public void run() { dontStop(); } }); thread.start(); System.out.println(Thread.activeCount()); } } public static void main(String[] args) throws Throwable { JavaVMStackOOM oom = new JavaVMStackOOM(); oom.stackLeakByThread(); } } è¿è¡Œç»“æœï¼š æ³¨æ„ï¼šç”±äºWindowså¹³å°çš„è™šæ‹Ÿæœºä¸­ï¼ŒJavaçš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„å†…æ ¸çº¿ç¨‹ä¸Šçš„ï¼Œå› æ­¤ä¸Šè¿°ä»£ç æ‰§è¡Œæ—¶æœ‰è¾ƒå¤§çš„é£é™©ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ“ä½œç³»ç»Ÿå‡æ­»ï¼Œå¹¶ä¸ä¸€å®šä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ 3ã€æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡ºString.intern()æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤Stringå¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›ä»£è¡¨æ± ä¸­è¿™ä¸ªå­—ç¬¦ä¸²çš„Stringå¯¹è±¡ï¼›å¦åˆ™ï¼Œå°†æ­¤Stringå¯¹è±¡åŒ…å«çš„å­—ç¬¦ä¸²æ·»åŠ åˆ°å¸¸é‡æ± ä¸­ï¼Œå¹¶ä¸”è¿”å›æ­¤Stringå¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨JDK 1.ï¼–åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œç”±äºå¸¸é‡æ± åˆ†é…åœ¨æ°¸ä¹…ä»£å†…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡-XX:PermSizeå’Œ -XX:MaxPermSizeé™åˆ¶æ–¹æ³•åŒºå¤§å°ï¼Œä»è€Œé—´æ¥é™åˆ¶å…¶ä¸­å¸¸é‡æ± çš„å®¹é‡ã€‚ æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š import java.util.List; import java.util.ArrayList; /** * VM Args:-XX:PermSize=10M -XX:MaxPermSize=10M */ public class RuntimeConstantPoolOOM { public static void main(String[] args) { // ä½¿ç”¨Listä¿æŒå¸¸é‡æ± å¼•ç”¨ï¼Œé¿å…Full GCå›æ”¶å¸¸é‡æ± å†…çš„å¯¹è±¡ List&lt;String&gt; list = new ArrayList&lt;String&gt;(); int i = 0; while (true) { list.add(String.valueOf((i++)).intern()); } } } è¿è¡Œç»“æœï¼š æ–¹æ³•åŒºç”¨äºå­˜æ”¾Classçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç±»åã€è®¿é—®ä¿®é¥°ç¬¦ã€å¸¸é‡æ± ã€å­—æ®µæè¿°ã€æ–¹æ³•æè¿°ç­‰ã€‚å¯¹äºè¿™äº›åŒºåŸŸçš„æµ‹è¯•ï¼ŒåŸºæœ¬æ€è·¯æ˜¯è¿è¡Œæ—¶äº§ç”Ÿå¤§é‡çš„ç±»å»å¡«æ»¡æ–¹æ³•åŒºï¼Œç›´åˆ°æº¢å‡ºã€‚ä»¥ä¸‹ç¤ºä¾‹ä»£ç å€ŸåŠ©CGLIBç›´æ¥æ“ä½œå­—èŠ‚ç è¿è¡Œæ—¶ç”Ÿæˆå¤§é‡çš„åŠ¨æ€ç±»è¿›è¡Œæµ‹è¯•ã€‚ import java.lang.reflect.Method; import net.sf.cglib.proxy.Enhancer; import net.sf.cglib.proxy.MethodInterceptor; import net.sf.cglib.proxy.MethodProxy; /** * VM Args:-XX:PermSize=10M -XX:MaxPermSize=10M */ public class JavaMethodAreaOOM { static class OOMObject { } public static void main(String[] args) { while (true) { Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(OOMObject.class); enhancer.setUseCache(false); enhancer.setCallback(new MethodInterceptor() { public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable { return proxy.invokeSuper(obj, args); } }); enhancer.create(); } } } è¿è¡Œç»“æœï¼š 4ã€æœ¬æœºç›´æ¥å†…å­˜æº¢å‡ºDirectMemoryå®¹é‡å¯é€šè¿‡-XX:MaxDirectMemorySizeæŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸Javaå †æœ€å¤§å€¼ï¼ˆ-XmxæŒ‡å®šï¼‰ä¸€æ ·ï¼Œæµ‹è¯•ä»£ç è¶Šè¿‡äº†DirectByteBufferç±»ï¼Œç›´æ¥é€šè¿‡åå°„è·å–Unsafeç¤ºä¾‹è¿›è¡Œå†…å­˜åˆ†é…ï¼ˆUnsafeç±»çš„getUnsafe()æ–¹æ³•é™åˆ¶äº†åªæœ‰å¼•å¯¼ç±»åŠ è½½å™¨æ‰ä¼šè¿”å›å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è®¾è®¡è€…å¸Œæœ›åªæœ‰rt.jarä¸­çš„ç±»æ‰èƒ½ä½¿ç”¨Unsafeçš„åŠŸèƒ½ï¼‰ã€‚å› ä¸ºï¼Œè™½ç„¶ä½¿ç”¨DirectByteBufferåˆ†é…å†…å­˜ä¹Ÿä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ï¼Œä½†å®ƒæŠ›å‡ºå¼‚å¸¸æ—¶å¹¶æ²¡æœ‰çœŸæ­£å‘æ“ä½œç³»ç»Ÿç”³è¯·åˆ†é…å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡è®¡ç®—å¾—çŸ¥å†…å­˜æ— æ³•åˆ†é…ï¼Œäºæ˜¯æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼ŒçœŸæ­£ç”³è¯·åˆ†é…å†…å­˜çš„æ–¹æ³•æ˜¯unsafe.allocateMemory()ã€‚ æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š import java.lang.reflect.Field; import sun.misc.Unsafe; /** * VM Args:-Xmx20M -XX:MaxDirectMemorySize=10M */ public class DirectMemoryOOM { private static final int _1MB = 1024 * 1024; public static void main(String[] args) throws Exception { Field unsafeField = Unsafe.class.getDeclaredFields()[0]; unsafeField.setAccessible(true); Unsafe unsafe = (Unsafe) unsafeField.get(null); while (true) { unsafe.allocateMemory(_1MB); } } } è¿è¡Œç»“æœï¼š","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--classç±»æ–‡ä»¶","slug":"æ·±å…¥ç†è§£JVMä¹‹--ç±»æ–‡ä»¶ç»“æ„","date":"2020-05-30T08:43:38.000Z","updated":"2023-04-30T10:21:41.373Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--ç±»æ–‡ä»¶ç»“æ„/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--ç±»æ–‡ä»¶ç»“æ„/","excerpt":"","text":"å‚è€ƒä¹¦ç±ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºâ€”â€”JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬2ç‰ˆ)ã€‹ Javaåœ¨åˆšåˆšè¯ç”Ÿä¹‹æ—¶æ›¾ç»æå‡ºè¿‡ä¸€ä¸ªéå¸¸è‘—åçš„å®£ä¼ å£å·ï¼šä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œï¼ˆWrite Once,Run Anywhereï¼‰ï¼Œè¿™å¥è¯å……åˆ†è¡¨è¾¾äº†è½¯ä»¶å¼€å‘äººå‘˜å¯¹å†²ç ´å¹³å°ç•Œé™çš„æ¸´æ±‚ã€‚è€Œå®ç°è¿™ä¸ªâ€œä¸å¹³å°æ— å…³â€ç†æƒ³çš„åŸºç¡€å°±æ˜¯è™šæ‹Ÿæœºå’Œå­—èŠ‚ç ï¼ˆByteCodeï¼‰æ ¼å¼å­˜å‚¨ã€‚ Javaè™šæ‹Ÿæœºä¸å’ŒåŒ…æ‹¬Javaåœ¨å†…çš„ä»»ä½•è¯­è¨€ç»‘å®šï¼Œå®ƒåªä¸â€œClassæ–‡ä»¶â€è¿™ç§ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼æ‰€å…³è”ï¼ŒClass æ–‡ä»¶ä¸­åŒ…å«äº† Java è™šæ‹ŸæœºæŒ‡ä»¤é›†ï¼ˆæˆ–è€…ç§°ä¸ºå­—èŠ‚ç ã€ Bytecodesï¼‰å’Œç¬¦å·è¡¨ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚ä½¿ç”¨ä¸åŒè¯­è¨€æ‰€ç¼–å†™çš„ä»£ç åªè¦èƒ½å¤Ÿè¢«æ­£ç¡®ç¼–è¯‘ä¸ºç¬¦åˆè™šæ‹Ÿæœºè§„èŒƒè¦æ±‚çš„Classæ–‡ä»¶ï¼Œè™šæ‹Ÿæœºå°±èƒ½å¤Ÿæ‰§è¡Œå®ƒï¼Œè™šæ‹Ÿæœºå¹¶ä¸å…³å¿ƒClassæ–‡ä»¶çš„æ¥æºæ˜¯ä½•ç§è¯­è¨€ã€‚ ä¸€ã€Classç±»æ–‡ä»¶çš„ç»“æ„Classæ–‡ä»¶æ ¼å¼æ‰€å…·å¤‡çš„å¹³å°ä¸­ç«‹ï¼ˆä¸ä¾èµ–äºç‰¹å®šç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿï¼‰ã€ç´§å‡‘ã€ç¨³å®šå’Œå¯æ‰©å±•çš„ç‰¹ç‚¹ï¼Œæ˜¯JavaæŠ€æœ¯ä½“ç³»å®ç°å¹³å°æ— å…³ã€ è¯­è¨€æ— å…³ä¸¤é¡¹ç‰¹æ€§çš„é‡è¦æ”¯æŸ±ã€‚ Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥8ä½å­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµï¼Œå„ä¸ªæ•°æ®é¡¹ç›®ä¸¥æ ¼æŒ‰ç…§é¡ºåºç´§å‡‘åœ°æ’åˆ—åœ¨Classæ–‡ä»¶ä¹‹ä¸­ï¼Œä¸­é—´æ²¡æœ‰æ·»åŠ ä»»ä½•åˆ†éš”ç¬¦ï¼Œè¿™ä½¿å¾—æ•´ä¸ªClassæ–‡ä»¶ä¸­å­˜å‚¨çš„å†…å®¹å‡ ä¹å…¨éƒ¨æ˜¯ç¨‹åºè¿è¡Œçš„å¿…è¦æ•°æ®ï¼Œæ²¡æœ‰ç©ºéš™å­˜åœ¨ã€‚ å½“é‡åˆ°éœ€è¦å ç”¨8ä½å­—èŠ‚ä»¥ä¸Šç©ºé—´çš„æ•°æ®é¡¹æ—¶ï¼Œåˆ™ä¼šæŒ‰ç…§é«˜ä½åœ¨å‰çš„æ–¹å¼åˆ†å‰²æˆè‹¥å¹²ä¸ª8ä½å­—èŠ‚è¿›è¡Œå­˜å‚¨ã€‚ æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼ŒClassæ–‡ä»¶æ ¼å¼é‡‡ç”¨ä¸€ç§ç±»ä¼¼äºCè¯­è¨€ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè¿™ç§ä¼ªç»“æ„ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼šæ— ç¬¦å·æ•°å’Œè¡¨ã€‚ æ— ç¬¦å·æ•°å±äºåŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä»¥u1ã€ u2ã€ u4ã€ u8æ¥åˆ†åˆ«ä»£è¡¨1ä¸ªå­—èŠ‚ã€ 2ä¸ªå­—èŠ‚ã€ 4ä¸ªå­—èŠ‚å’Œ8ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°ï¼Œæ— ç¬¦å·æ•°å¯ä»¥ç”¨æ¥æè¿°æ•°å­—ã€ ç´¢å¼•å¼•ç”¨ã€ æ•°é‡å€¼æˆ–è€…æŒ‰ç…§UTF-8ç¼–ç æ„æˆå­—ç¬¦ä¸²å€¼ã€‚ è¡¨æ˜¯ç”±å¤šä¸ªæ— ç¬¦å·æ•°æˆ–è€…å…¶ä»–è¡¨ä½œä¸ºæ•°æ®é¡¹æ„æˆçš„å¤åˆæ•°æ®ç±»å‹ï¼Œæ‰€æœ‰è¡¨éƒ½ä¹ æƒ¯æ€§åœ°ä»¥â€œ_infoâ€ç»“å°¾ï¼Œç”¨äºæè¿°æœ‰å±‚æ¬¡å…³ç³»çš„å¤åˆç»“æ„çš„æ•°æ®ã€‚ æ•´ä¸ªClassæ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ è¡¨ï¼Œå®ƒç”±ä¸‹è¡¨æ‰€ç¤ºçš„æ•°æ®é¡¹æ„æˆã€‚ æ ·ä¾‹æºç ï¼š package jvm; public class SimpleClass implements Comparable&lt;SimpleClass&gt; { private static final int magic = 0xCAFEBABE; private int number; public void setNumber(int number) { this.number = number; } public int compareTo(SimpleClass o) { if (this.number == o.number) { return 0; } int ret = this.number &gt; o.number ? 1 : -1; return ret; } } å°†ä»¥ä¸Šä»£ç ä½¿ç”¨JDK 1.6ç¼–è¯‘è¾“å‡ºçš„Classæ–‡ä»¶åœ¨UltraEditä¸­æ‰“å¼€ï¼Œå…¶å‰64ä¸ªå­—èŠ‚çš„å†…å®¹å¦‚ä¸‹å›¾ï¼š äºŒã€é­”æ•°ä¸Classæ–‡ä»¶çš„ç‰ˆæœ¬æ¯ä¸ªClassæ–‡ä»¶çš„å¤´4ä¸ªå­—èŠ‚ç§°ä¸ºé­”æ•°ï¼ˆMagic Numberï¼‰ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥å—çš„Classæ–‡ä»¶ã€‚ å¾ˆå¤šæ–‡ä»¶å­˜å‚¨æ ‡å‡†ä¸­éƒ½ä½¿ç”¨é­”æ•°æ¥è¿›è¡Œèº«ä»½è¯†åˆ«ï¼Œè­¬å¦‚å›¾ç‰‡æ ¼å¼ï¼Œå¦‚gifæˆ–è€…jpegç­‰åœ¨æ–‡ä»¶å¤´ä¸­éƒ½å­˜æœ‰é­”æ•°ã€‚ ä½¿ç”¨é­”æ•°è€Œä¸æ˜¯æ‰©å±•åæ¥è¿›è¡Œè¯†åˆ«ä¸»è¦æ˜¯åŸºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œå› ä¸ºæ–‡ä»¶æ‰©å±•åå¯ä»¥éšæ„åœ°æ”¹åŠ¨ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒClassæ–‡ä»¶çš„é­”æ•°å€¼ä¸ºï¼š0xCAFEBABEã€‚ ç´§æ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯Classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼šç¬¬5å’Œç¬¬6ä¸ªå­—èŠ‚æ˜¯æ¬¡ç‰ˆæœ¬å·ï¼ˆMinor Versionï¼Œå›¾ä¸­ä¸º0x0000ï¼‰ï¼Œç¬¬7å’Œç¬¬8ä¸ªå­—èŠ‚æ˜¯ä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼Œå›¾ä¸­ä¸º0x0031ï¼‰ã€‚ ä¸‰ã€å¸¸é‡æ± ç”±äºå¸¸é‡æ± ä¸­å¸¸é‡çš„æ•°é‡æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥åœ¨å¸¸é‡æ± çš„å…¥å£éœ€è¦æ”¾ç½®ä¸€é¡¹u2ç±»å‹çš„æ•°æ®ï¼Œä»£è¡¨å¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ï¼ˆconstant_pool_countï¼‰ã€‚ ä¸Javaä¸­è¯­è¨€ä¹ æƒ¯ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™ä¸ªå®¹é‡è®¡æ•°æ˜¯ä»1è€Œä¸æ˜¯0å¼€å§‹çš„ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¸¸é‡æ± å®¹é‡ï¼ˆåç§»åœ°å€ï¼š0x00000008ï¼‰ä¸ºåå…­è¿›åˆ¶æ•°0x0024ï¼Œå³åè¿›åˆ¶çš„36ï¼Œè¿™å°±ä»£è¡¨å¸¸é‡æ± ä¸­æœ‰35é¡¹å¸¸é‡ï¼Œç´¢å¼•å€¼èŒƒå›´ä¸º1ï½35ã€‚ åœ¨Classæ–‡ä»¶æ ¼å¼è§„èŒƒåˆ¶å®šä¹‹æ—¶ï¼Œè®¾è®¡è€…å°†ç¬¬0é¡¹å¸¸é‡ç©ºå‡ºæ¥æ˜¯æœ‰ç‰¹æ®Šè€ƒè™‘çš„ï¼Œè¿™æ ·åšçš„ç›®çš„åœ¨äºæ»¡è¶³åé¢æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹å®šæƒ…å†µä¸‹éœ€è¦è¡¨è¾¾â€œä¸å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®â€çš„å«ä¹‰ï¼Œè¿™ç§æƒ…å†µå°±å¯ä»¥æŠŠç´¢å¼•å€¼ç½®ä¸º0æ¥è¡¨ç¤ºã€‚Classæ–‡ä»¶ç»“æ„ä¸­åªæœ‰å¸¸é‡æ± çš„å®¹é‡è®¡æ•°æ˜¯ä»1å¼€å§‹ï¼Œå¯¹äºå…¶ä»–é›†åˆç±»å‹ï¼ŒåŒ…æ‹¬æ¥å£ç´¢å¼•é›†åˆã€ å­—æ®µè¡¨é›†åˆã€ æ–¹æ³•è¡¨é›†åˆç­‰çš„å®¹é‡è®¡æ•°éƒ½ä¸ä¸€èˆ¬ä¹ æƒ¯ç›¸åŒï¼Œæ˜¯ä»0å¼€å§‹çš„ã€‚ å¸¸é‡æ± ä¸­ä¸»è¦å­˜æ”¾ä¸¤å¤§ç±»å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ã€‚å­—é¢é‡æ¯”è¾ƒæ¥è¿‘äºJavaè¯­è¨€å±‚é¢çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€ å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚ è€Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬äº†ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼ˆFully Qualified Nameï¼‰ å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼ˆDescriptorï¼‰ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ å¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œä»JDK 1.7å¼€å§‹ï¼Œå…±åˆ†ä¸ºä»¥ä¸‹14ç§è¡¨ç±»å‹ã€‚ è¿˜æ˜¯ä»¥ä¸Šé¢ç¼–è¯‘çš„classæ–‡ä»¶çš„UltraEditæˆªå›¾è¿›è¡Œç¤ºä¾‹ã€‚ UltraEditæˆªå›¾ä¸­å¸¸é‡æ± çš„ç¬¬ä¸€é¡¹å¸¸é‡çš„æ ‡å¿—ä½ï¼ˆåç§»åœ°å€ï¼š0x0000000aï¼‰æ˜¯0x07ï¼Œè¡¨ç¤ºè¿™ä¸ªå¸¸é‡å±äºCONSTANT_Class_infoç±»å‹ï¼Œæ­¤ç±»å‹çš„å¸¸é‡ä»£è¡¨ä¸€ä¸ªç±»æˆ–è€…æ¥å£çš„ç¬¦å·å¼•ç”¨ã€‚ CONSTANT_Class_infoçš„ç»“æ„æ¯”è¾ƒç®€å•ï¼Œè§ä¸‹è¡¨ã€‚ tagæ˜¯æ ‡å¿—ä½ï¼Œç”¨äºåŒºåˆ†å¸¸é‡ç±»å‹ï¼›name_indexæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼Œå®ƒæŒ‡å‘å¸¸é‡æ± ä¸­ä¸€ä¸ªCONSTANT_Utf8_infoç±»å‹å¸¸é‡ï¼Œæ­¤å¸¸é‡ä»£è¡¨äº†è¿™ä¸ªç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„å…¨é™å®šåï¼Œè¿™é‡Œname_indexå€¼ï¼ˆåç§»åœ°å€ï¼š0x0000000bï¼‰ä¸º0x0002ï¼Œä¹Ÿå³æ˜¯æŒ‡å‘äº†å¸¸é‡æ± ä¸­çš„ç¬¬äºŒé¡¹å¸¸é‡ã€‚ ç»§ç»­ä»UltraEditæˆªå›¾ä¸­æŸ¥æ‰¾ç¬¬äºŒé¡¹å¸¸é‡ï¼Œå®ƒçš„æ ‡å¿—ä½ï¼ˆåœ°å€ï¼š0x0000000dï¼‰æ˜¯0x01ï¼Œè¡¨ç¤ºè¿™ä¸ªå¸¸é‡å±äºCONSTANT_Utf8_infoç±»å‹ï¼ŒCONSTANT_Utf8_infoç±»å‹çš„ç»“æ„è§ä¸‹è¡¨ã€‚ lengthå€¼è¯´æ˜äº†è¿™ä¸ªUTF-8ç¼–ç çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¤šå°‘å­—èŠ‚ï¼Œå®ƒåé¢ç´§è·Ÿç€çš„é•¿åº¦ä¸ºlengthå­—èŠ‚çš„è¿ç»­æ•°æ®æ˜¯ä¸€ä¸ªä½¿ç”¨UTF-8ç¼©ç•¥ç¼–ç è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚ UTF-8ç¼©ç•¥ç¼–ç ä¸æ™®é€šUTF-8ç¼–ç çš„åŒºåˆ«æ˜¯ï¼š ä»â€™\\u0001â€™åˆ°â€™\\u007fâ€™ä¹‹é—´çš„å­—ç¬¦ï¼ˆç›¸å½“äº1ï½127çš„ASCIIç ï¼‰çš„ç¼©ç•¥ç¼–ç ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼› ä»â€™\\u0080â€™åˆ°â€™\\u07ffâ€™ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦çš„ç¼©ç•¥ç¼–ç ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºï¼› ä»â€™\\u0800â€™åˆ°â€™\\uffffâ€™ä¹‹é—´çš„æ‰€æœ‰å­—ç¬¦çš„ç¼©ç•¥ç¼–ç å°±æŒ‰ç…§æ™®é€šUTF-8ç¼–ç è§„åˆ™ä½¿ç”¨ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚ æœ¬ä¾‹ä¸­è¿™ä¸ªå­—ç¬¦ä¸²çš„lengthå€¼ï¼ˆåç§»åœ°å€ï¼š0x0000000eï¼‰ä¸º0x000Fï¼Œä¹Ÿå°±æ˜¯é•¿15å­—èŠ‚ï¼Œå¾€å15å­—èŠ‚æ­£å¥½éƒ½åœ¨1ï½127çš„ASCIIç èŒƒå›´ä»¥å†…ï¼Œå†…å®¹ä¸ºâ€œjvm/SimpleClassâ€ï¼Œæ¢ç®—ç»“æœå¦‚ä¸‹å›¾é€‰ä¸­çš„éƒ¨åˆ†æ‰€ç¤ºã€‚ å…¶ä½™çš„34ä¸ªå¸¸é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç±»ä¼¼çš„æ–¹æ³•è®¡ç®—å‡ºæ¥ï¼Œæˆ–ä½¿ç”¨javapå·¥å…·å¸®åŠ©æˆ‘ä»¬è¿›è¡Œè®¡ç®—ï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨javapå·¥å…·çš„-verboseå‚æ•°è¾“å‡ºçš„SimpleClass.classçš„å¸¸é‡æ± å†…å®¹ã€‚ å¸¸é‡æ± ä¸­14ç§å¸¸é‡é¡¹çš„ç»“æ„æ€»è¡¨ã€‚ å››ã€è®¿é—®æ ‡å¿—åœ¨å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„ä¸¤ä¸ªå­—èŠ‚ä»£è¡¨è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ªClassæ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼›æ˜¯å¦å®šä¹‰ä¸ºpublicç±»å‹ï¼›æ˜¯å¦å®šä¹‰ä¸ºabstractç±»å‹ï¼›å¦‚æœæ˜¯ç±»çš„è¯ï¼Œæ˜¯å¦è¢«å£°æ˜ä¸ºfinalç­‰ã€‚ å…·ä½“çš„æ ‡å¿—ä½ä»¥åŠæ ‡å¿—çš„å«ä¹‰ä¸‹è¡¨ã€‚ access_flagsä¸­ä¸€å…±æœ‰16ä¸ªæ ‡å¿—ä½å¯ä»¥ä½¿ç”¨ï¼Œå½“å‰åªå®šä¹‰äº†å…¶ä¸­8ä¸ªï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„æ ‡å¿—ä½è¦æ±‚ä¸€å¾‹ä¸º0ã€‚UltraEditæˆªå›¾ä¸­çš„access_flagsæ ‡å¿—ï¼ˆåç§»åœ°å€ï¼š0x000001b2ï¼‰å€¼ä¸º0x0021ï¼Œä»£è¡¨SimpleClassæ˜¯ä¸€ä¸ªpublicè®¿é—®æƒé™çš„æ™®é€šjavaç±»ã€‚ äº”ã€ç±»ç´¢å¼•ã€ çˆ¶ç±»ç´¢å¼•ä¸æ¥å£ç´¢å¼•é›†åˆç±»ç´¢å¼•ï¼ˆthis_classï¼‰å’Œçˆ¶ç±»ç´¢å¼•ï¼ˆsuper_classï¼‰éƒ½æ˜¯ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼Œè€Œæ¥å£ç´¢å¼•é›†åˆï¼ˆinterfacesï¼‰æ˜¯ä¸€ç»„u2ç±»å‹çš„æ•°æ®çš„é›†åˆï¼ŒClassæ–‡ä»¶ä¸­ç”±è¿™ä¸‰é¡¹æ•°æ®æ¥ç¡®å®šè¿™ä¸ªç±»çš„ç»§æ‰¿å…³ç³»ã€‚ ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œçˆ¶ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåã€‚ ç”±äºJavaè¯­è¨€ä¸å…è®¸å¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº†java.lang.Objectä¹‹å¤–ï¼Œæ‰€æœ‰çš„Javaç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº†java.lang.Objectå¤–ï¼Œæ‰€æœ‰Javaç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º0ã€‚ æ¥å£ç´¢å¼•é›†åˆå°±ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†å“ªäº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰implementsè¯­å¥ï¼ˆå¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåˆ™åº”å½“æ˜¯extendsè¯­å¥ï¼‰åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚ ç±»ç´¢å¼•ã€ çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆéƒ½æŒ‰é¡ºåºæ’åˆ—åœ¨è®¿é—®æ ‡å¿—ä¹‹åï¼Œç±»ç´¢å¼•å’Œçˆ¶ç±»ç´¢å¼•ç”¨ä¸¤ä¸ªu2ç±»å‹çš„ç´¢å¼•å€¼è¡¨ç¤ºï¼Œå®ƒä»¬å„è‡ªæŒ‡å‘ä¸€ä¸ªç±»å‹ä¸ºCONSTANT_Class_infoçš„ç±»æè¿°ç¬¦å¸¸é‡ï¼Œé€šè¿‡CONSTANT_Class_infoç±»å‹çš„å¸¸é‡ä¸­çš„ç´¢å¼•å€¼å¯ä»¥æ‰¾åˆ°å®šä¹‰åœ¨CONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡ä¸­çš„å…¨é™å®šåå­—ç¬¦ä¸²ã€‚ SimpleClassç±»ä»…å®ç°äº†ä¸€ä¸ªComparableæ¥å£ï¼Œå…¶æ¥å£è®¡æ•°å™¨åç§»åœ°å€ï¼š0x00001b07ï¼Œå…¶åç´§è·Ÿ0x0005æŒ‡å‘ä¸€ä¸ªCONSTANT_Class_infoç±»å‹çš„ç´¢å¼•å€¼ï¼Œä»å¸¸é‡#6å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç´¢å¼•æŒ‡å‘çš„å°±æ˜¯Comparableæ¥å£ã€‚ å…­ã€å­—æ®µè¡¨é›†åˆå­—æ®µè¡¨ï¼ˆfield_infoï¼‰ç”¨äºæè¿°æ¥å£æˆ–è€…ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚ å­—æ®µï¼ˆfieldï¼‰åŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹çº§å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬åœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚å­—æ®µè¡¨ç»“æ„å¦‚ä¸‹è¡¨ã€‚ å…¶ä¸­access_flagå¯ä»¥è®¾ç½®çš„è®¿é—®æ ‡å¿—ä½å’Œå«ä¹‰è§ä¸‹è¡¨ã€‚ è·Ÿéšaccess_flagsæ ‡å¿—çš„æ˜¯ä¸¤é¡¹ç´¢å¼•å€¼ï¼šname_indexå’Œdescriptor_indexã€‚ å®ƒä»¬éƒ½æ˜¯å¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œåˆ†åˆ«ä»£è¡¨ç€å­—æ®µçš„ç®€å•åç§°ä»¥åŠå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦ã€‚ æ‰€è°“å…¨é™å®šï¼Œä»…ä»…æ˜¯æŠŠç±»å…¨åä¸­çš„.æ›¿æ¢æˆäº†/è€Œå·²ï¼Œä¾‹å¦‚ï¼šâ€œjava/lang/Comparableâ€ï¼Œä¸ºäº†ä½¿è¿ç»­çš„å¤šä¸ªå…¨é™å®šåä¹‹é—´ä¸äº§ç”Ÿæ··æ·†ï¼Œåœ¨ä½¿ç”¨æ—¶æœ€åä¸€èˆ¬ä¼šåŠ å…¥ä¸€ä¸ªï¼›è¡¨ç¤ºå…¨é™å®šåç»“æŸã€‚ ç®€å•åç§°æ˜¯æŒ‡æ²¡æœ‰ç±»å‹å’Œå‚æ•°ä¿®é¥°çš„æ–¹æ³•æˆ–è€…å­—æ®µåç§°ï¼Œä¾‹å¦‚ï¼ŒSimpleClassç±»ä¸­çš„setNumber()æ–¹æ³•å’Œmagicå­—æ®µçš„ç®€å•åç§°åˆ†åˆ«æ˜¯â€œsetNumberâ€å’Œâ€œmagicâ€ã€‚ æè¿°ç¬¦çš„ä½œç”¨æ˜¯ç”¨æ¥æè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€ æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆåŒ…æ‹¬æ•°é‡ã€ ç±»å‹ä»¥åŠé¡ºåºï¼‰å’Œè¿”å›å€¼ã€‚ å¯¹äºæ•°ç»„ç±»å‹ï¼Œæ¯ä¸€ç»´åº¦å°†ä½¿ç”¨ä¸€ä¸ªå‰ç½®çš„[å­—ç¬¦æ¥æè¿°ï¼Œå¦‚ä¸€ä¸ªå®šä¹‰ä¸ºjava.lang.String[][]ç±»å‹çš„äºŒç»´æ•°ç»„ï¼Œå°†è¢«è®°å½•ä¸ºï¼š[[Ljava/lang/Stringï¼›ï¼Œä¸€ä¸ªæ•´å‹æ•°ç»„int[]å°†è¢«è®°å½•ä¸º[Iã€‚ ç”¨æè¿°ç¬¦æ¥æè¿°æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§å…ˆå‚æ•°åˆ—è¡¨ï¼Œåè¿”å›å€¼çš„é¡ºåºæè¿°ï¼Œå‚æ•°åˆ—è¡¨æŒ‰ç…§å‚æ•°çš„ä¸¥æ ¼é¡ºåºæ”¾åœ¨ä¸€ç»„å°æ‹¬å·ï¼ˆï¼‰ä¹‹å†…ã€‚ å¦‚æ–¹æ³•void inc()çš„æè¿°ç¬¦ä¸ºï¼ˆï¼‰Vï¼Œæ–¹æ³•java.lang.String toString()çš„æè¿°ç¬¦ä¸ºï¼ˆï¼‰Ljava/lang/Stringï¼›ï¼Œæ–¹æ³•int indexOfï¼ˆchar[]source,int sourceOffset,int sourceCount,char[] target,int targetOffset,int targetCount,int fromIndexï¼‰çš„æè¿°ç¬¦ä¸ºï¼ˆ[CII[CIIIï¼‰Iã€‚ å¯¹äºSimpleClass.classæ–‡ä»¶æ¥è¯´ï¼Œå­—æ®µè¡¨é›†åˆä»åœ°å€0x000001bbå¼€å§‹ï¼Œç¬¬ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ä¸ºå®¹é‡è®¡æ•°å™¨fields_countï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå…¶å€¼ä¸º0x0002ï¼Œè¯´æ˜è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªå­—æ®µè¡¨æ•°æ®ã€‚ æ¥ä¸‹æ¥ç´§è·Ÿç€å®¹é‡è®¡æ•°å™¨çš„æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µçš„access_flagsæ ‡å¿—ï¼Œå€¼ä¸º0x001Aï¼Œä»£è¡¨è¯¥å­—æ®µè¢«private+static+finalä¿®é¥°ã€‚ ä»£è¡¨å­—æ®µåç§°çš„name_indexçš„å€¼ä¸º0x0007ï¼Œä»å¸¸é‡æ± ä¸­å¯æŸ¥å¾—ç¬¬7é¡¹å¸¸é‡åä¸ºmagicï¼Œä»£è¡¨å­—æ®µæè¿°ç¬¦çš„descriptor_indexçš„å€¼ä¸º0x0008ï¼ŒæŒ‡å‘å¸¸é‡æ± çš„å­—ç¬¦ä¸²Iï¼Œå³è¯¥å­—æ®µä¸ºintç±»å‹ã€‚ å­—æ®µè¡¨é›†åˆä¸­ä¸ä¼šåˆ—å‡ºä»è¶…ç±»æˆ–è€…çˆ¶æ¥å£ä¸­ç»§æ‰¿è€Œæ¥çš„å­—æ®µï¼Œä½†æœ‰å¯èƒ½åˆ—å‡ºåŸæœ¬Javaä»£ç ä¹‹ä¸­ä¸å­˜åœ¨çš„å­—æ®µï¼Œè­¬å¦‚åœ¨å†…éƒ¨ç±»ä¸­ä¸ºäº†ä¿æŒå¯¹å¤–éƒ¨ç±»çš„è®¿é—®æ€§ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æŒ‡å‘å¤–éƒ¨ç±»å®ä¾‹çš„å­—æ®µã€‚ ä¸ƒã€æ–¹æ³•è¡¨é›†åˆClassæ–‡ä»¶å­˜å‚¨æ ¼å¼ä¸­å¯¹æ–¹æ³•çš„æè¿°ä¸å¯¹å­—æ®µçš„æè¿°å‡ ä¹é‡‡ç”¨äº†å®Œå…¨ä¸€è‡´çš„æ–¹å¼ï¼Œæ–¹æ³•è¡¨çš„ç»“æ„å¦‚åŒå­—æ®µè¡¨ä¸€æ ·ï¼Œä¾æ¬¡åŒ…æ‹¬äº†è®¿é—®æ ‡å¿—ï¼ˆaccess_flagsï¼‰ã€ åç§°ç´¢å¼•ï¼ˆname_indexï¼‰ã€ æè¿°ç¬¦ç´¢å¼•ï¼ˆdescriptor_indexï¼‰ã€ å±æ€§è¡¨é›†åˆï¼ˆattributesï¼‰å‡ é¡¹ï¼Œè§ä¸‹è¡¨ã€‚ å¯¹äºæ–¹æ³•è¡¨ï¼Œæ‰€æœ‰æ ‡å¿—ä½åŠå…¶å–å€¼å¯å‚è§ä¸‹è¡¨ã€‚ å¯¹äºSimpleClass.classæ–‡ä»¶æ¥è¯´ï¼Œæ–¹æ³•è¡¨é›†åˆçš„å…¥å£åœ°å€ä¸ºï¼š0x00001d04ï¼Œç¬¬ä¸€ä¸ªu2ç±»å‹çš„æ•°æ®ï¼ˆå³æ˜¯è®¡æ•°å™¨å®¹é‡ï¼‰çš„å€¼ä¸º0x0004ï¼Œä»£è¡¨é›†åˆä¸­æœ‰å››ä¸ªæ–¹æ³•ï¼ˆè¿™å››ä¸ªæ–¹æ³•ä¸ºç¼–è¯‘å™¨æ·»åŠ çš„å®ä¾‹æ„é€ å™¨ï¼œinitï¼ã€Comparableæ¥å£çš„æ„é€ æ–¹æ³•ä»¥åŠæºç ä¸­çš„æ–¹æ³•compareTo()å’ŒsetNumber()æ–¹æ³•ï¼‰ã€‚ ç¬¬ä¸€ä¸ªæ–¹æ³•çš„è®¿é—®æ ‡å¿—å€¼ä¸º0x001ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ACC_PUBLICæ ‡å¿—ä¸ºçœŸï¼Œåç§°ç´¢å¼•å€¼ä¸º0x000Cï¼Œä»å¸¸é‡æ± ä¸­å¯æŸ¥å¾—ç¬¬12é¡¹å¸¸é‡æ± çš„æ–¹æ³•åä¸ºâ€œï¼œinitï¼ï¼Œæè¿°ç¬¦ç´¢å¼•å€¼ä¸º0x000Dï¼Œå¯¹åº”å¸¸é‡ä¸ºï¼ˆï¼‰Vï¼Œå±æ€§è¡¨è®¡æ•°å™¨attributes_countçš„å€¼ä¸º0x0001å°±è¡¨ç¤ºæ­¤æ–¹æ³•çš„å±æ€§è¡¨é›†åˆæœ‰ä¸€é¡¹å±æ€§ï¼Œå±æ€§åç§°ç´¢å¼•ä¸º0x000Eï¼Œå¯¹åº”å¸¸é‡ä¸ºCodeï¼Œè¯´æ˜æ­¤å±æ€§æ˜¯æ–¹æ³•çš„å­—èŠ‚ç æè¿°ã€‚ ä¸å­—æ®µè¡¨é›†åˆç›¸å¯¹åº”çš„ï¼Œå¦‚æœçˆ¶ç±»æ–¹æ³•åœ¨å­ç±»ä¸­æ²¡æœ‰è¢«é‡å†™ï¼ˆOverrideï¼‰ï¼Œæ–¹æ³•è¡¨é›†åˆä¸­å°±ä¸ä¼šå‡ºç°æ¥è‡ªçˆ¶ç±»çš„æ–¹æ³•ä¿¡æ¯ã€‚ ä½†åŒæ ·çš„ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ çš„æ–¹æ³•ï¼Œæœ€å…¸å‹çš„ä¾¿æ˜¯ç±»æ„é€ å™¨â€œï¼œclinitï¼â€æ–¹æ³•å’Œå®ä¾‹æ„é€ å™¨â€œï¼œinitï¼â€æ–¹æ³•ã€‚ å…«ã€å±æ€§è¡¨é›†åˆå±æ€§è¡¨ï¼ˆattribute_infoï¼‰åœ¨å‰é¢çš„è®²è§£ä¹‹ä¸­å·²ç»å‡ºç°è¿‡æ•°æ¬¡ï¼Œåœ¨Classæ–‡ä»¶ã€ å­—æ®µè¡¨ã€ æ–¹æ³•è¡¨éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨é›†åˆï¼Œä»¥ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚ å±æ€§è¡¨çš„é¢„å®šä¹‰å±æ€§ç›®å‰å…±æœ‰21é¡¹ï¼Œä¾‹å¦‚ï¼šCodeã€ConstantValueã€LocalVariableTableã€LineNumberTableã€‚ Codeå±æ€§Javaç¨‹åºæ–¹æ³•ä½“ä¸­çš„ä»£ç ç»è¿‡Javacç¼–è¯‘å™¨å¤„ç†åï¼Œæœ€ç»ˆå˜ä¸ºå­—èŠ‚ç æŒ‡ä»¤å­˜å‚¨åœ¨Codeå±æ€§å†…ã€‚ Codeå±æ€§å‡ºç°åœ¨æ–¹æ³•è¡¨çš„å±æ€§é›†åˆä¹‹ä¸­ï¼Œä½†å¹¶éæ‰€æœ‰çš„æ–¹æ³•è¡¨éƒ½å¿…é¡»å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œè­¬å¦‚æ¥å£æˆ–è€…æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å°±ä¸å­˜åœ¨Codeå±æ€§ï¼Œå¦‚æœæ–¹æ³•è¡¨æœ‰Codeå±æ€§å­˜åœ¨ï¼Œé‚£ä¹ˆå®ƒçš„ç»“æ„å°†å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ attribute_name_indexæ˜¯ä¸€é¡¹æŒ‡å‘CONSTANT_Utf8_infoå‹å¸¸é‡çš„ç´¢å¼•ï¼Œå¸¸é‡å€¼å›ºå®šä¸ºâ€œCodeâ€ï¼Œå®ƒä»£è¡¨äº†è¯¥å±æ€§çš„å±æ€§åç§°ï¼Œattribute_lengthæŒ‡ç¤ºäº†å±æ€§å€¼çš„é•¿åº¦ï¼Œç”±äºå±æ€§åç§°ç´¢å¼•ä¸å±æ€§é•¿åº¦ä¸€å…±ä¸º6å­—èŠ‚ï¼Œæ‰€ä»¥å±æ€§å€¼çš„é•¿åº¦å›ºå®šä¸ºæ•´ä¸ªå±æ€§è¡¨é•¿åº¦å‡å»6ä¸ªå­—èŠ‚ã€‚ max_stackä»£è¡¨äº†æ“ä½œæ•°æ ˆï¼ˆOperand Stacksï¼‰æ·±åº¦çš„æœ€å¤§å€¼ã€‚ åœ¨æ–¹æ³•æ‰§è¡Œçš„ä»»æ„æ—¶åˆ»ï¼Œæ“ä½œæ•°æ ˆéƒ½ä¸ä¼šè¶…è¿‡è¿™ä¸ªæ·±åº¦ã€‚ è™šæ‹Ÿæœºè¿è¡Œçš„æ—¶å€™éœ€è¦æ ¹æ®è¿™ä¸ªå€¼æ¥åˆ†é…æ ˆå¸§ï¼ˆStack Frameï¼‰ä¸­çš„æ“ä½œæ ˆæ·±åº¦ã€‚ max_localsä»£è¡¨äº†å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ã€‚ åœ¨è¿™é‡Œï¼Œmax_localsçš„å•ä½æ˜¯Slot,Slotæ˜¯è™šæ‹Ÿæœºä¸ºå±€éƒ¨å˜é‡åˆ†é…å†…å­˜æ‰€ä½¿ç”¨çš„æœ€å°å•ä½ã€‚ å¯¹äºbyteã€ charã€ floatã€ intã€ shortã€ booleanå’ŒreturnAddressç­‰é•¿åº¦ä¸è¶…è¿‡32ä½çš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸ªå±€éƒ¨å˜é‡å ç”¨1ä¸ªSlotï¼Œè€Œdoubleå’Œlongè¿™ä¸¤ç§64ä½çš„æ•°æ®ç±»å‹åˆ™éœ€è¦ä¸¤ä¸ªSlotæ¥å­˜æ”¾ã€‚ æ–¹æ³•å‚æ•°ï¼ˆåŒ…æ‹¬å®ä¾‹æ–¹æ³•ä¸­çš„éšè—å‚æ•°â€œthisâ€ï¼‰ã€ æ˜¾å¼å¼‚å¸¸å¤„ç†å™¨çš„å‚æ•°ï¼ˆException Handler Parameterï¼Œå°±æ˜¯try-catchè¯­å¥ä¸­catchå—æ‰€å®šä¹‰çš„å¼‚å¸¸ï¼‰ã€ æ–¹æ³•ä½“ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡éƒ½éœ€è¦ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨æ¥å­˜æ”¾ã€‚ å¦å¤–ï¼Œå¹¶ä¸æ˜¯åœ¨æ–¹æ³•ä¸­ç”¨åˆ°äº†å¤šå°‘ä¸ªå±€éƒ¨å˜é‡ï¼Œå°±æŠŠè¿™äº›å±€éƒ¨å˜é‡æ‰€å Slotä¹‹å’Œä½œä¸ºmax_localsçš„å€¼ï¼ŒåŸå› æ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotå¯ä»¥é‡ç”¨ï¼Œå½“ä»£ç æ‰§è¡Œè¶…å‡ºä¸€ä¸ªå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæ—¶ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡æ‰€å çš„Slotå¯ä»¥è¢«å…¶ä»–å±€éƒ¨å˜é‡æ‰€ä½¿ç”¨ï¼ŒJavacç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡çš„ä½œç”¨åŸŸæ¥åˆ†é…Slotç»™å„ä¸ªå˜é‡ä½¿ç”¨ï¼Œç„¶åè®¡ç®—å‡ºmax_localsçš„å¤§å°ã€‚ code_lengthå’Œcodeç”¨æ¥å­˜å‚¨Javaæºç¨‹åºç¼–è¯‘åç”Ÿæˆçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ code_lengthä»£è¡¨å­—èŠ‚ç é•¿åº¦ï¼Œcodeæ˜¯ç”¨äºå­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤çš„ä¸€ç³»åˆ—å­—èŠ‚æµã€‚ å…¶ä¸­å¼‚å¸¸è¡¨çš„ç»“æ„å¦‚ä¸‹è¡¨ã€‚ Exceptionså±æ€§Exceptionså±æ€§çš„ä½œç”¨æ˜¯åˆ—ä¸¾å‡ºæ–¹æ³•ä¸­å¯èƒ½æŠ›å‡ºçš„å—æŸ¥å¼‚å¸¸ï¼ˆChecked Excepitonsï¼‰ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•æè¿°æ—¶åœ¨throwså…³é”®å­—åé¢åˆ—ä¸¾çš„å¼‚å¸¸ã€‚ å®ƒçš„ç»“æ„è§ä¸‹è¡¨ã€‚ LineNumberTableå±æ€§LineNumberTableå±æ€§ç”¨äºæè¿°Javaæºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·ï¼ˆå­—èŠ‚ç çš„åç§»é‡ï¼‰ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ å®ƒçš„ç»“æ„è§ä¸‹è¡¨ã€‚ LocalVariableTableå±æ€§LocalVariableTableå±æ€§ç”¨äºæè¿°æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¸Javaæºç ä¸­å®šä¹‰çš„å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚ å®ƒçš„ç»“æ„è§ä¸‹è¡¨ã€‚ å…¶ä¸­ï¼Œlocal_variable_infoé¡¹ç›®ä»£è¡¨äº†ä¸€ä¸ªæ ˆå¸§ä¸æºç ä¸­çš„å±€éƒ¨å˜é‡çš„å…³è”ï¼Œç»“æ„ä¸‹è¡¨ã€‚ ConstantValueå±æ€§ConstantValueå±æ€§çš„ä½œç”¨æ˜¯é€šçŸ¥è™šæ‹Ÿæœºè‡ªåŠ¨ä¸ºé™æ€å˜é‡èµ‹å€¼ã€‚ åªæœ‰è¢«staticå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼ˆç±»å˜é‡ï¼‰æ‰å¯ä»¥ä½¿ç”¨è¿™é¡¹å±æ€§ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--javacå‘½ä»¤","slug":"æ·±å…¥ç†è§£JVMä¹‹--javacå‘½ä»¤","date":"2020-05-30T08:42:38.000Z","updated":"2023-04-30T10:21:41.371Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--javacå‘½ä»¤/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--javacå‘½ä»¤/","excerpt":"","text":"javacå‘½ä»¤ç”¨äºå°† .java æºæ–‡ä»¶ç¼–è¯‘æˆ .class å­—èŠ‚ç æ–‡ä»¶ï¼Œåœ¨windowså‘½ä»¤è¡Œä¸­ä½¿ç”¨â€javac -helpâ€å‘½ä»¤æŸ¥çœ‹å…¶ç”¨æ³•ï¼š è¯­æ³•æ ¼å¼: javac &lt;options&gt; &lt;source files&gt; options # å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå¯æŒ‡å®šå¤šä¸ªï¼Œå¤šä¸ªé€‰é¡¹å¯æŒ‰ä»»æ„é¡ºåºæ’åˆ—ã€‚ source files # ç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªè¦ç¼–è¯‘çš„ .java æºæ–‡ä»¶ã€‚ æŒ‡å®šç¼–è¯‘æºæ–‡ä»¶å¦‚æœéœ€è¦ç¼–è¯‘çš„æºæ–‡ä»¶æ•°é‡è¾ƒå°‘ï¼Œå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸Šå°†æ‰€æœ‰æ–‡ä»¶åï¼ˆå¿…è¦æ—¶åŒ…å«è·¯å¾„ï¼‰åˆ—å‡ºï¼Œå¤šä¸ªæ–‡ä»¶åä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚ javac src/FirstClass.java src/SecondClass.java src/ThirdClass.java # ä¾‹1 æ³¨æ„ï¼šå¦‚æœæ–‡ä»¶è·¯å¾„ä¸­åŒ…å«æœ‰ç©ºæ ¼ï¼Œéœ€ç”¨åŒå¼•å·æŠŠè¯¥æ–‡ä»¶åæ‹¬èµ·æ¥ã€‚ javac &quot;src/Program Files/MyClass.java&quot; åœ¨æ²¡ä½¿ç”¨åˆ†å·çš„æƒ…å†µä¸‹ï¼Œå¯¹ç›¸åŒè·¯å¾„ä¸‹çš„å¤šä¸ª .java æºç æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œå¯ä»¥ä½¿ç”¨*é€šé…ç¬¦ï¼Œæ­¤æ—¶ä¾‹1å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š javac src/*.java javac src/*Class.java å¦‚æœéœ€è¦ç¼–è¯‘çš„ .java æºæ–‡ä»¶æ•°é‡è¾ƒå¤šï¼Œä¸ºç¼©çŸ­å’Œç®€åŒ–javacå‘½ä»¤ï¼Œå¯ä»¥æŠŠè¦ç¼–è¯‘çš„ .java æºæ–‡ä»¶çš„æ–‡ä»¶åï¼ˆå¿…è¦æ—¶åŒ…å«è·¯å¾„ï¼‰å­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¤šä¸ª .java æºæ–‡ä»¶åä¹‹é—´ç”¨ç©ºæ ¼æˆ–å›è½¦è¿›è¡Œåˆ†éš”ã€‚ç„¶ååœ¨javacå‘½ä»¤è¡Œä¸­ï¼Œç”¨â€˜@â€™ å­—ç¬¦æŒ‡å®šè¯¥æ–‡ä»¶ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠä¾‹1ä¸­è¦ç¼–è¯‘çš„ .java æºç æ–‡ä»¶åå†™åˆ°classes.txtæ–‡ä»¶ä¸­ï¼Œclasses.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š src\\FirstClass.java src\\SecondClass.java src\\ThirdClass.java æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨classes.txtä¸­ç”¨åŒå¼•å·æŠŠå•ä¸ªè¦ç¼–è¯‘çš„ .java æºæ–‡ä»¶åæ‹¬èµ·æ¥ï¼Œä½†æ˜¯è¿™æ—¶è·¯å¾„ä¹‹é—´æ¥çš„åˆ†éš”ç¬¦â€œ\\â€å°±è¦å†™æˆâ€\\â€œçš„å½¢å¼äº†ã€‚classes.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š &quot;src\\\\FirstClass.java&quot; &quot;src\\\\SecondClass.java&quot; &quot;src\\\\ThirdClass.java&quot; æ­¤æ—¶ï¼Œæ‰§è¡Œå¦‚ä¸‹çš„javacå‘½ä»¤ï¼š javac @classes.txt å‘½ä»¤é€‰é¡¹-d &lt;ç›®å½•&gt; # æŒ‡å®šæ”¾ç½®ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„ä½ç½® è¯¥é€‰é¡¹ç”¨äºæŒ‡å®šç”Ÿæˆçš„.classæ–‡ä»¶å­˜æ”¾çš„ä½ç½®ã€‚å¦‚æœæŸä¸ªç±»æ˜¯ä¸€ä¸ªåŒ…çš„ç»„æˆéƒ¨åˆ†ï¼Œåˆ™javacå°†æŠŠç”Ÿæˆçš„.classæ–‡ä»¶æ”¾å…¥åæ˜ åŒ…åçš„å­ç›®å½•ä¸­ï¼Œå¿…è¦æ—¶åˆ›å»ºç›®å½•ã€‚ package com.pengjunlee; public class MyClass { } ä½¿ç”¨å‘½ä»¤ï¼š**javac -d bin src\\MyClass.java**ï¼Œå¯¹ä»¥ä¸ŠMyClass.javaæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œå°†ä¼šå°†ç”Ÿæˆçš„MyClass.classæ–‡ä»¶å­˜æ”¾åˆ° bin\\com\\pengjunlee ç›®å½•ä¸‹ã€‚ è‹¥æœªæŒ‡å®š -d é€‰é¡¹ï¼Œåˆ™ javac å°†æŠŠç”Ÿæˆçš„ .class æ–‡ä»¶æ”¾åˆ°ä¸ .java æºæ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­ã€‚.classç±»æ–‡ä»¶çš„æœç´¢è·¯å¾„ -bootclasspath &lt;è·¯å¾„&gt; è¦†ç›–å¼•å¯¼ç±»æ–‡ä»¶çš„ä½ç½® -extdirs &lt;è·¯å¾„&gt; è¦†ç›–æ‰€å®‰è£…æ‰©å±•çš„ä½ç½® -classpath &lt;è·¯å¾„&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶å’Œæ³¨é‡Šå¤„ç†ç¨‹åºçš„ä½ç½® -cp &lt;è·¯å¾„&gt; æŒ‡å®šæŸ¥æ‰¾ç”¨æˆ·ç±»æ–‡ä»¶å’Œæ³¨é‡Šå¤„ç†ç¨‹åºçš„ä½ç½® JDKåœ¨ç¼–è¯‘ä¸€ä¸ªjavaæºæ–‡ä»¶æ—¶ï¼Œæœç´¢ä¾èµ–çš„.classç±»æ–‡ä»¶çš„é¡ºåºå¦‚ä¸‹ï¼š Bootstrap classes--&gt;Extension classes--&gt;User classes Bootstrap classes é»˜è®¤çš„æ˜¯JDKè‡ªå¸¦çš„jaræˆ–zipæ–‡ä»¶ï¼Œå®ƒåŒ…æ‹¬jre\\libä¸‹rt.jarç­‰æ–‡ä»¶ï¼ŒJDKé¦–å…ˆæœç´¢è¿™äº›æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡-bootclasspathæ¥è®¾ç½®å®ƒï¼Œæ–‡ä»¶ä¹‹é—´ç”¨åˆ†å·â€;â€è¿›è¡Œåˆ†éš”ã€‚ Extension classes é»˜è®¤çš„æ˜¯ä½äºjre\\lib\\extç›®å½•ä¸‹çš„jaræ–‡ä»¶ï¼ŒJDKåœ¨æœç´¢å®ŒBootstrapåå°±æœç´¢è¯¥ç›®å½•ä¸‹çš„jaræ–‡ä»¶.å¯ä»¥é€šè¿‡-extdirsæ¥è®¾ç½®ã€‚æ–‡ä»¶ä¹‹é—´ç”¨åˆ†å·â€;â€æ¥è¿›è¡Œåˆ†éš”ã€‚ User classes æœç´¢é¡ºåºä¸ºå½“å‰ç›®å½•ã€ç¯å¢ƒå˜é‡ CLASSPATHã€-classpathã€‚ -cp å’Œ -classpath æ˜¯åŒä¹‰è¯ï¼Œå‚æ•°æ„ä¹‰æ˜¯ä¸€æ ·çš„ã€‚classpathå‚æ•°å¤ªé•¿äº†ï¼Œæ‰€ä»¥æä¾›cpä½œä¸ºç¼©å†™å½¢å¼ã€‚å®ƒä»¬ç”¨äºå‘ŠçŸ¥JDKæœç´¢ç›®å½•åã€jaræ–‡æ¡£åã€zipæ–‡æ¡£åï¼Œç”¨åˆ†å·â€;â€è¿›è¡Œåˆ†éš”ã€‚ä¾‹å¦‚å½“ä½ è‡ªå·±å¼€å‘äº†å…¬å…±ç±»å¹¶åŒ…è£…æˆä¸€ä¸ªcommon.jaråŒ…ï¼Œåœ¨ä½¿ç”¨ common.jarä¸­çš„ç±»æ—¶ï¼Œå°±éœ€è¦ç”¨-classpath common.jarå‘Šè¯‰JDKä»common.jarä¸­æŸ¥æ‰¾è¯¥ç±»ï¼Œå¦åˆ™JDKå°±ä¼šæŠ›å‡ºjava.lang.NoClassDefFoundErrorå¼‚å¸¸ï¼Œè¡¨æ˜æœªæ‰¾åˆ°ç±»å®šä¹‰ã€‚ ä½¿ç”¨-classpathåJDKå°†ä¸å†ä½¿ç”¨CLASSPATHä¸­çš„ç±»æœç´¢è·¯å¾„ï¼Œå¦‚æœ-classpathå’ŒCLASSPATHéƒ½æ²¡æœ‰è®¾ç½®ï¼Œåˆ™JDKä½¿ç”¨å½“å‰è·¯å¾„(.)ä½œä¸ºç±»æœç´¢è·¯å¾„ã€‚ æ¨èä½¿ç”¨-classpathæ¥å®šä¹‰JDKè¦æœç´¢çš„ç±»è·¯å¾„ï¼Œè€Œä¸è¦ä½¿ç”¨ç¯å¢ƒå˜é‡ CLASSPATHçš„æœç´¢è·¯å¾„ï¼Œä»¥å‡å°‘å¤šä¸ªé¡¹ç›®åŒæ—¶ä½¿ç”¨CLASSPATHæ—¶å­˜åœ¨çš„æ½œåœ¨å†²çªã€‚ä¾‹å¦‚åº”ç”¨1è¦ä½¿ç”¨a1.0.jarä¸­çš„ç±»Gï¼Œåº”ç”¨2è¦ä½¿ç”¨a2.0.jarä¸­çš„ç±»G,a2.0.jaræ˜¯a1.0.jarçš„å‡çº§åŒ…ï¼Œå½“a1.0.jarï¼Œa2.0.jaréƒ½åœ¨CLASSPATHä¸­ï¼ŒJDKæœç´¢åˆ°ç¬¬ä¸€ä¸ªåŒ…ä¸­çš„ç±»Gæ—¶å°±åœæ­¢æœç´¢ï¼Œå¦‚æœåº”ç”¨1åº”ç”¨2çš„è™šæ‹Ÿæœºéƒ½ä»CLASSPATHä¸­æœç´¢ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªåº”ç”¨å¾—ä¸åˆ°æ­£ç¡®ç‰ˆæœ¬çš„ç±»Gã€‚ javac -cp bin -d bin MyClass.java javac -classpath bin -d bin MyClass.java å¦‚æœéœ€è¦æŒ‡å®šå„ä¸ªJARæ–‡ä»¶å…·ä½“çš„å­˜æ”¾è·¯å¾„ï¼Œç›¸åŒè·¯å¾„æœ‰å¤šä¸ªå¯ä½¿ç”¨é€šé…ç¬¦ã€‚ -sourcepath &lt;è·¯å¾„&gt; # æŒ‡å®šæŸ¥æ‰¾è¾“å…¥æºæ–‡ä»¶çš„ä½ç½® åœ¨ç¼–è¯‘æ—¶ï¼ŒJDKéœ€è¦ä¸¤æ–¹é¢çš„è·¯å¾„ï¼Œä¸€ä¸ªæ˜¯æŸ¥æ‰¾javaæºç æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸€ä¸ªæ˜¯æŸ¥æ‰¾ .classï¼ˆç±»ï¼‰æ–‡ä»¶çš„è·¯å¾„ã€‚ å…³äº.classæ–‡ä»¶çš„è·¯å¾„ä¸Šæ–‡å·²ç»å·²ç»ä»‹ç»è¿‡ï¼Œå¯ä»¥é€šè¿‡-bootclasspathï¼Œ-extdirsï¼Œ-classpathå’Œ-cpæ¥è®¾å®šã€‚javaæºç æ–‡ä»¶çš„è·¯å¾„åˆ™å¯ä»¥é€šè¿‡-sourcepathæ¥è®¾å®šï¼Œé»˜è®¤æƒ…å†µä¸‹-sourcepathå’Œ-classpathçš„è·¯å¾„ä¸€æ ·ã€‚åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œè‹¥éœ€è¦ç›¸å…³javaç±»çš„åˆ™é¦–å…ˆåœ¨sourcefilesæˆ–@filesåˆ—å‡ºçš„javaæºç æ–‡ä»¶ä¸­æŸ¥æ‰¾å¹¶ç¼–è¯‘ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åœ¨-sourcepathæŒ‡å®šçš„è·¯å¾„ä¸­æŸ¥æ‰¾javaæºç æ–‡ä»¶ï¼Œè¿™æ—¶æ— è®ºæ‰¾æ²¡æ‰¾åˆ°éƒ½ä¼šç»§ç»­åœ¨ç±»è·¯å¾„ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æœåœ¨sourcepathä¸­æ‰¾åˆ°äº†javaæºç æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨ç±»è·¯å¾„ä¸­æ²¡æœ‰æ‰¾åˆ°äº†ç›¸å…³çš„ç±»ï¼Œæˆ–æ‰¾çš„ç±»ä½äºåŒ…æ–‡ä»¶ï¼ˆjaræˆ–zipï¼‰ä¸­,æˆ–æ‰¾çš„ç±»å¹¶ä¸æ˜¯åœ¨åŒ…æ–‡ä»¶ä¸­ï¼Œä½†æºç æ–‡ä»¶æ¯”è¯¥ç±»æ–‡ä»¶æ–°ï¼Œè¿™æ—¶ä¼šå¯¹æºç æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œè€Œä¸”ç¼–è¯‘ç”Ÿæˆçš„ç±»æ–‡ä»¶å°†ä¼šå’Œä½ æŒ‡å®šè¦è¿›è¡Œç¼–è¯‘çš„javaæºç æ‰€ç”Ÿæˆçš„ç±»æ–‡ä»¶ä½äºåŒä¸€æ ¹ç›®å½•ã€‚å¦åˆ™ï¼Œé™¤äº†æ—¢æ²¡æ‰¾åˆ°javaæºç æ–‡ä»¶ä¹Ÿæ²¡æ‰¾åˆ°ç›¸å…³ç±»å°±ç¼–è¯‘å¤±è´¥å¤–ï¼Œç›´æ¥è½½å…¥ç›¸å…³ç±»å°±å¯ä»¥äº†ã€‚å› æ­¤ä½ å¾—è‡³å°‘è¦æŒ‡å®šä¸€ä¸ªè¦ç¼–è¯‘çš„javaæºæ–‡ä»¶ã€‚å®ƒå¹¶ä¸æ˜¯æŒ‡å®šsourecfilesæˆ–@filesä¸­æŒ‡å®šçš„è¦ç¼–è¯‘çš„javaæºç æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚ä¸ç±»è·¯å¾„ä¸€æ ·ï¼Œjavaæºç è·¯å¾„é¡¹ç”¨åˆ†å· (;) è¿›è¡Œåˆ†éš”ï¼Œå®ƒä»¬å¯ä»¥æ˜¯classæ–‡ä»¶çš„æ ¹ç›®å½•ã€JAR å½’æ¡£æ–‡ä»¶æˆ– ZIP å½’æ¡£æ–‡ä»¶ã€‚ javac -sourcepath src -d bin MyClass.java -source &lt;å‘è¡Œç‰ˆ&gt; # æä¾›ä¸æŒ‡å®šå‘è¡Œç‰ˆçš„æºå…¼å®¹æ€§ å½“ä½ ä»sunå®‰è£…äº†æŸä¸ªç‰ˆæœ¬çš„JDKï¼Œè€Œå…¶å®è¯¥JDKå´åŒ…å«å¤šä¸ªç‰ˆæœ¬çš„ç¼–è¯‘å™¨ã€‚-sourceå‚æ•°å°±æ˜¯æŒ‡å®šç”¨å“ªä¸ªç‰ˆæœ¬çš„ç¼–è¯‘å™¨å¯¹javaæºç è¿›è¡Œç¼–è¯‘ã€‚å¦‚æœä½ çš„javaæºç ä¸ç¬¦åˆè¯¥ç‰ˆæœ¬ç¼–è¯‘å™¨çš„è§„èŒƒçš„è¯ï¼Œå½“ç„¶å°±ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚ -target &lt;å‘è¡Œç‰ˆ&gt; # ç”Ÿæˆç‰¹å®š VM ç‰ˆæœ¬çš„ç±»æ–‡ä»¶ -target å‘½ä»¤ç”¨äºæŒ‡å®šç”Ÿæˆçš„classæ–‡ä»¶å°†ä¿è¯å’Œå“ªä¸ªç‰ˆæœ¬çš„è™šæ‹Ÿæœºè¿›è¡Œå…¼å®¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡-target 1.2æ¥ä¿è¯ç”Ÿæˆçš„classæ–‡ä»¶èƒ½åœ¨1.2è™šæ‹Ÿæœºä¸Šè¿›è¡Œè¿è¡Œï¼Œä½†æ˜¯1.1çš„è™šæ‹Ÿæœºå°±ä¸èƒ½ä¿è¯äº†ã€‚å› ä¸ºjavaè™šæ‹Ÿæœºçš„å‘å‰å…¼å®¹è¡Œï¼Œ1.5çš„è™šæ‹Ÿæœºå½“ç„¶ä¹Ÿå¯ä»¥è¿è¡Œé€šè¿‡-target 1.2ç”Ÿæˆçš„classæ–‡ä»¶ã€‚æ¯ä¸ªç‰ˆæœ¬ç¼–è¯‘å™¨çš„é»˜è®¤-targetç‰ˆæœ¬æ˜¯ä¸å¤ªä¸€æ ·çš„ã€‚ javac -source 1.2 -target 1.1 -sourcepath src -d bin MyClass.java javac -source 1.2 -target 1.5 -sourcepath src -d bin MyClass.java -deprecation # è¾“å‡ºä½¿ç”¨å·²è¿‡æ—¶çš„ API çš„æºä½ç½® å¦‚æœjavaæºç ä¸­ä½¿ç”¨äº†ä¸é¼“åŠ±ä½¿ç”¨çš„ç±»æˆ–æ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚æœä½¿ç”¨äº†è¯¥å‚æ•°ï¼Œå°†æ˜¾ç¤ºå…³äºæ­¤è­¦å‘Šçš„è¯¦ç»†ä¿¡æ¯,å¦åˆ™åªæœ‰ä¸ªç®€å•çš„Note. public class MyClass { public static void main(String[] args) { String str=new String(new byte[3],100); } } -verbose # è¾“å‡ºæœ‰å…³ç¼–è¯‘å™¨æ­£åœ¨æ‰§è¡Œçš„æ“ä½œçš„æ¶ˆæ¯ ä½¿ç”¨è¯¥å‚æ•°ï¼Œä½ å¯ä»¥çœ‹åˆ°ç¼–è¯‘å™¨ç¼–è¯‘javaæºæ–‡ä»¶çš„è¯¦ç»†è¿‡ç¨‹ã€‚ -encoding&lt;ç¼–ç &gt; ï¼ƒ æŒ‡å®šæºæ–‡ä»¶ä½¿ç”¨çš„å­—ç¬¦ç¼–ç  è®¾ç½®æºæ–‡ä»¶ç¼–ç åç§°ï¼Œä¾‹å¦‚UTF-8ã€‚è‹¥æœªæŒ‡å®š -encoding é€‰é¡¹ï¼Œåˆ™ä½¿ç”¨å¹³å°ç¼ºçœçš„ç¼–ç æ–¹å¼ã€‚ -g ï¼ƒ ç”Ÿæˆæ‰€æœ‰è°ƒè¯•ä¿¡æ¯ ç”Ÿæˆæ‰€æœ‰çš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œåªç”Ÿæˆè¡Œå·å’Œæºæ–‡ä»¶ä¿¡æ¯ã€‚ -g:none ï¼ƒ ä¸ç”Ÿæˆä»»ä½•è°ƒè¯•ä¿¡æ¯ -g:{lines,vars,source} ï¼ƒ åªç”ŸæˆæŸäº›è°ƒè¯•ä¿¡æ¯ -nowarn ï¼ƒ ç¦ç”¨è­¦å‘Šä¿¡æ¯ã€‚ éæ ‡å‡†é€‰é¡¹ -Xä½¿ç”¨è¯¥å‚æ•°ï¼Œå¯ä»¥æ˜¾ç¤ºæ‰€æœ‰çš„éæ ‡å‡†é€‰é¡¹çš„æœ‰å…³ä¿¡æ¯ã€‚ -Xlint ï¼ƒ å¯ç”¨å»ºè®®çš„è­¦å‘Š -Xlint:{all,noneï¼Œå…¶ä»–é€‰é¡¹} ï¼ƒ å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„è­¦å‘Š é€šè¿‡è¯¥å‘½ä»¤æˆ‘ä»¬å°†çœ‹åˆ°ä½ javaæºç æ–‡ä»¶çš„ä¸€äº›å±é™©ä»£ç ï¼Œå…³é”®å­—æœ‰ï¼š {all,auxiliaryclass,cast,classfile,deprecation,dep-ann,divzero,empty,fallthrough,finally,options,overloads, overrides,path,processing,rawtypes,serial,static,try,unchecked,varargs, -auxiliaryclass,-cast,-classfile,-deprecation,-dep-ann,-divzero,-empty,-fallthrough,-finally,-options,-overloads,-overrides,-path,-processing,-rawtypes,-serial,-static,-try,-unchecked,-varargs,none} æ²¡æœ‰â€-â€œå‰ç¼€çš„è¡¨ç¤ºå¼€å¯ï¼Œæœ‰çš„è¯¥å‰ç¼€çš„è¡¨ç¤ºå…³é—­ï¼Œallè¡¨ç¤ºå¼€å¯æ‰€æœ‰ï¼Œnoneè¡¨ç¤ºéƒ½ä¸å¼€å¯ã€‚ public class MyClass { public static void main(String[] args) { String str=new String(new byte[3],100); } } -Xstdout &lt;æ–‡ä»¶å&gt; ï¼ƒ é‡å®šå‘æ ‡å‡†è¾“å‡º javacå‘½ä»¤æ‰§è¡Œä¿¡æ¯é»˜è®¤å°†åœ¨å½“å‰æ§åˆ¶å°è¿›è¡Œæ˜¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¯¥å‚æ•°è¿›è¡Œé‡æ–°å®šä¹‰ã€‚æ¯”å¦‚å°†å‰ä¸€ç¤ºä¾‹çš„ç¼–è¯‘è¿‡ç¨‹ä¿¡æ¯è¾“å‡ºåˆ°â€stdout.logâ€æ–‡ä»¶ä¸­ï¼š javac -Xstdout stdout.log -Xlint:all MyClass.java å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼ŒæŸ¥çœ‹stdout.logä¸­å†…å®¹å¦‚ä¸‹ï¼š -Xmaxerrs &lt;ç¼–å·&gt; ï¼ƒ è®¾ç½®è¦è¾“å‡ºçš„é”™è¯¯çš„æœ€å¤§æ•°ç›® -Xmaxwarns &lt;ç¼–å·&gt; ï¼ƒ è®¾ç½®è¦è¾“å‡ºçš„è­¦å‘Šçš„æœ€å¤§æ•°ç›®","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"æ·±å…¥ç†è§£JVMç³»åˆ—ä¹‹--å­—èŠ‚ç æŒ‡ä»¤è¡¨","slug":"æ·±å…¥ç†è§£JVMä¹‹--å­—èŠ‚ç æŒ‡ä»¤è¡¨","date":"2020-05-30T08:41:38.000Z","updated":"2023-04-30T10:21:41.372Z","comments":true,"path":"2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--å­—èŠ‚ç æŒ‡ä»¤è¡¨/","link":"","permalink":"/2020/05/30/æ·±å…¥ç†è§£JVMä¹‹--å­—èŠ‚ç æŒ‡ä»¤è¡¨/","excerpt":"","text":"ã€Šæ·±å…¥ç†è§£Javaè™šæ‹ŸæœºJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µã€‹é™„å½•B è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤è¡¨","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"JVM,Java,è™šæ‹Ÿæœº","slug":"JVM-Java-è™šæ‹Ÿæœº","permalink":"/tags/JVM-Java-è™šæ‹Ÿæœº/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--è§£é‡Šå™¨æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--è§£é‡Šå™¨æ¨¡å¼","date":"2020-05-24T09:03:28.000Z","updated":"2023-04-30T10:21:41.361Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è§£é‡Šå™¨æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è§£é‡Šå™¨æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯è§£é‡Šå™¨æ¨¡å¼è§£é‡Šå™¨(Interpreter)æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚ æ‰€è°“â€œè¯­è¨€â€ï¼ŒæŒ‡çš„æ˜¯ä½¿ç”¨è§„å®šæ ¼å¼å’Œæ–‡æ³•çš„ä¸€ç±»å­—ç¬¦ç»„åˆã€‚ æ‰€è°“â€œæ–‡æ³•â€ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯æˆ‘ä»¬ä¿—ç§°çš„â€œè¯­æ³•è§„åˆ™â€ã€‚ ä»¥javaè¯­è¨€ä¸ºä¾‹ï¼Œå…¶å˜é‡å£°æ˜æ–‡æ³•ä¸ºï¼š[public|protected|private] + [static] + [final] + å˜é‡ç±»å‹ + å˜é‡å + [=åˆå§‹å€¼]ï¼Œä»¥ä¸‹è¿™æ¡å­—ç¬¦ä¸²å˜é‡å£°æ˜è¯­å¥å°±æ˜¯è¯¥æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼šprivate static final String sql = â€œ select * from user where 1=1â€ ã€‚ è§£é‡Šå™¨æ¨¡å¼çš„æœ¬è´¨ï¼šåˆ†ç¦»å®ç°ï¼Œè§£é‡Šæ‰§è¡Œ è®¾è®¡æ„å›¾ï¼šä¸ºè¯­è¨€ä¸­çš„ä¸åŒçš„æ–‡æ³•è¡¨ç¤ºï¼Œåˆ†åˆ«å®šä¹‰ä¸€ä¸ªä¸è¯¥æ–‡æ³•è¡¨ç¤ºç›¸å¯¹åº”çš„çš„è§£é‡Šå™¨ï¼Œç„¶åé€šè¿‡è¿™ä¸ªè§£é‡Šå™¨æ¥å¯¹è¯¥æ–‡æ³•è¡¨ç¤ºè¿›è¡Œè§£é‡Šã€‚ äºŒã€è§£é‡Šå™¨æ¨¡å¼çš„ç»“æ„ è§£é‡Šå™¨æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡è¡¨è¾¾å¼(AbstractExpression)è§’è‰²ï¼šçº¦å®šè§£é‡Šå™¨çš„è§£é‡Šæ“ä½œï¼Œä¸»è¦æ˜¯ä¸€ä¸ªinterpret()æ–¹æ³•ã€‚ ç»ˆç»“ç¬¦è¡¨è¾¾å¼(TerminalExpression)è§’è‰²ï¼šç”¨æ¥å®ç°æ–‡æ³•ä¸­å’Œç»ˆç»“ç¬¦ç›¸å…³çš„è§£é‡Šæ“ä½œï¼Œä¸å†åŒ…å«å…¶å®ƒçš„è§£é‡Šå™¨ï¼Œå¦‚æœç”¨ç»„åˆæ¨¡å¼æ¥æ„å»ºæŠ½è±¡è¯­æ³•æ ‘çš„è¯ï¼Œå°±ç›¸å½“äºç»„åˆæ¨¡å¼ä¸­çš„å¶å­å¯¹è±¡ï¼Œå¯ä»¥æœ‰å¤šç§ç»ˆç»“ç¬¦è§£é‡Šå™¨ã€‚ éç»ˆç»“ç¬¦è¡¨è¾¾å¼(NonterminalExpression)è§’è‰²ï¼šç”¨æ¥å®ç°æ–‡æ³•ä¸­å’Œéç»ˆç»“ç¬¦ç›¸å…³çš„è§£é‡Šæ“ä½œï¼Œé€šå¸¸ä¸€ä¸ªè§£é‡Šå™¨å¯¹åº”ä¸€ä¸ªè¯­æ³•è§„åˆ™ï¼Œå¯ä»¥åŒ…å«å…¶å®ƒçš„è§£é‡Šå™¨ï¼Œå¦‚æœç”¨ç»„åˆæ¨¡å¼æ¥æ„å»ºæŠ½è±¡è¯­æ³•æ ‘çš„è¯ï¼Œå°±ç›¸å½“äºç»„åˆæ¨¡å¼ä¸­çš„ç»„åˆå¯¹è±¡ï¼Œå¯ä»¥æœ‰å¤šç§éç»ˆç»“ç¬¦è§£é‡Šå™¨ã€‚ ç¯å¢ƒ(Context)è§’è‰²ï¼šä¹Ÿç§°â€œä¸Šä¸‹æ–‡â€ï¼Œå¸¸ç”¨HashMapæ¥ä»£æ›¿ï¼Œé€šå¸¸åŒ…å«è§£é‡Šå™¨ä¹‹å¤–çš„ä¸€äº›å…¨å±€ä¿¡æ¯ï¼ˆè§£é‡Šå™¨éœ€è¦çš„æ•°æ®ï¼Œæˆ–æ˜¯å…¬å…±çš„åŠŸèƒ½ï¼‰ã€‚ å®¢æˆ·ç«¯(Client)è§’è‰²ï¼šæ„å»ºæ–‡æ³•è¡¨ç¤ºçš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼Œè¯¥æŠ½è±¡è¯­æ³•æ ‘ç”±ç»ˆç»“ç¬¦è¡¨è¾¾å¼å’Œéç»ˆç»“ç¬¦è¡¨è¾¾å¼çš„å®ä¾‹è£…é…è€Œæˆï¼‰ï¼Œå¹¶è°ƒç”¨è§£é‡Šæ“ä½œinterpret()æ–¹æ³•ã€‚ è§£é‡Šå™¨æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šé¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡è¡¨è¾¾å¼(AbstractExpression)è§’è‰²ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ä¸€ä¸ªæ‰§è¡Œè§£é‡Šæ“ä½œçš„æ¥å£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * æŠ½è±¡è¡¨è¾¾å¼ */ public abstract class AbstractExpression { /** * è§£é‡Šçš„æ“ä½œ * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡ */ public abstract void interpret(Context ctx); } æŠ½è±¡è¡¨è¾¾å¼(AbstractExpression) çš„å…·ä½“å®ç°åˆ†ä¸¤ç§ï¼šç»ˆç»“ç¬¦è¡¨è¾¾å¼(TerminalExpression)å’Œéç»ˆç»“ç¬¦è¡¨è¾¾å¼ /** * ç»ˆç»“ç¬¦è¡¨è¾¾å¼ */ public class TerminalExpression extends AbstractExpression { @Override public void interpret(Context ctx) { // å®ç°ä¸è¯­æ³•è§„åˆ™ä¸­çš„ç»ˆç»“ç¬¦ç›¸å…³è”çš„è§£é‡Šæ“ä½œ } } /** * éç»ˆç»“ç¬¦è¡¨è¾¾å¼ */ public class NonterminalExpression extends AbstractExpression { @Override public void interpret(Context ctx) { // å®ç°ä¸è¯­æ³•è§„åˆ™ä¸­çš„éç»ˆç»“ç¬¦ç›¸å…³è”çš„è§£é‡Šæ“ä½œ } } å†æ¥çœ‹çœ‹ç¯å¢ƒ(Context)çš„å®šä¹‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«è§£é‡Šå™¨ä¹‹å¤–çš„ä¸€äº›å…¨å±€ä¿¡æ¯ */ public class Context { } æœ€åæ¥çœ‹çœ‹å®¢æˆ·ç«¯çš„å®šä¹‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * ä½¿ç”¨è§£é‡Šå™¨çš„å®¢æˆ· */ public class Client { /** * ä¸»è¦æŒ‰ç…§è¯­æ³•è§„æ ¼å¯¹ç‰¹å®šçš„å¥å­æ„å»ºæŠ½è±¡è¯­æ³•æ ‘ * ç„¶åè°ƒç”¨è§£é‡Šæ“ä½œ */ } ä»¥ä¸Šç¤ºä¾‹ä»£ç å¾ˆç®€å•ï¼Œ åªæ˜¯ä¸ºäº†è¯´æ˜è§£é‡Šå™¨æ¨¡å¼å®ç°çš„åŸºæœ¬ç»“æ„å’Œå„ä¸ªè§’è‰²çš„åŠŸèƒ½ï¼Œ å®é™…çš„è§£é‡Šé€»è¾‘å¹¶æœªå†™å‡ºã€‚ ä¸‰ã€è§£é‡Šå™¨æ¨¡å¼åº”ç”¨ä¸¾ä¾‹å‡å¦‚æˆ‘ä»¬è¦å®ç°è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½ï¼šåŠ å‡æ³•è®¡ç®—å™¨ã€‚è®¡ç®—å™¨ä¸­å‚ä¸è¿ç®—çš„å…ƒç´ ä¸ºaã€bã€cã€dç­‰â€¦ï¼Œè¿™äº›å…ƒç´ éƒ½ä¸å…·ä½“çš„ä¸šåŠ¡ç›¸å…³ï¼Œæˆ‘ä»¬ä¸ç»†è¿½ç©¶å…¶æ‰€ä»£è¡¨çš„æ„ä¹‰ã€‚ç°è¦å®ç°ï¼šå®¢æˆ·ç«¯æŒ‡å®šä¸€ä¸ªå…¬å¼ï¼Œå¦‚â€œa+b-câ€ï¼Œâ€œa+b+c-dâ€ï¼Œè®¡ç®—å™¨å°±å¯ä»¥è®¡ç®—å‡ºç»“æœã€‚ è®¾è®¡å¥½çš„ç±»å›¾ç»“æ„ç¤ºæ„å¦‚ä¸‹ï¼š æºä»£ç å¦‚ä¸‹ã€‚ import java.util.HashMap; /** * æŠ½è±¡è¡¨è¾¾å¼,å£°æ˜è§£é‡Šæ“ä½œ */ public interface AbstractExpression { // æ¯ä¸ªè¡¨è¾¾å¼éƒ½å¿…é¡»æœ‰ä¸€ä¸ªè§£é‡Šæ“ä½œ public int interprete(HashMap&lt;String, Integer&gt; var); } import java.util.HashMap; /** * ç»ˆç»“ç¬¦è¡¨è¾¾å¼,ä»£è¡¨å‚åŠ è¿ç®—çš„å…ƒç´ å¯¹è±¡ */ public class VarExpression implements AbstractExpression { private String key; public VarExpression(String key) { this.key = key; } public int interprete(HashMap&lt;String, Integer&gt; var) { return (Integer) var.get(this.key); } } /** * éç»ˆç»“ç¬¦è¡¨è¾¾å¼,è¿ç®—ç¬¦ï¼ˆæ­¤å¤„ä¸ºåŠ æ³•å’Œå‡æ³•ï¼‰çš„æŠ½è±¡çˆ¶ç±»,çœŸæ­£çš„è§£é‡Šæ“ä½œç”±å…¶å­ç±»æ¥å®ç° */ public abstract class SymbolExpression implements AbstractExpression { protected AbstractExpression left; protected AbstractExpression right; // éç»ˆç»“ç¬¦è¡¨è¾¾å¼çš„è§£é‡Šæ“ä½œåªå…³å¿ƒè‡ªå·±å·¦å³ä¸¤ä¸ªè¡¨è¾¾å¼çš„ç»“æœ public SymbolExpression(AbstractExpression left, AbstractExpression right) { this.left = left; this.right = right; } } import java.util.HashMap; /** * åŠ æ³•è¡¨è¾¾å¼ */ public class AddExpression extends SymbolExpression { public AddExpression(AbstractExpression left, AbstractExpression right) { super(left, right); } // æŠŠå·¦å³ä¸¤ä¸ªè¡¨è¾¾å¼è¿ç®—çš„ç»“æœåŠ èµ·æ¥ public int interprete(HashMap&lt;String, Integer&gt; var) { return super.left.interprete(var) + super.right.interprete(var); } } import java.util.HashMap; /** * å‡æ³•è¡¨è¾¾å¼ */ public class SubExpression extends SymbolExpression { public SubExpression(AbstractExpression left, AbstractExpression right) { super(left, right); } // å·¦å³ä¸¤ä¸ªè¡¨è¾¾å¼ç›¸å‡ public int interprete(HashMap&lt;String, Integer&gt; var) { return super.left.interprete(var) - super.right.interprete(var); } } import java.util.HashMap; import java.util.Stack; public class Calculator { private AbstractExpression expression; /** * å¯¹å…¬å¼è¿›è¡Œè§£ææ“ä½œ * * @param expStr * è¾“å…¥çš„å…¬å¼ */ public Calculator(String expStr) { // å®šä¹‰ä¸€ä¸ªå †æ ˆï¼Œå®‰æ’è¿ç®—çš„å…ˆåé¡ºåº Stack&lt;AbstractExpression&gt; stack = new Stack&lt;AbstractExpression&gt;(); // è¡¨è¾¾å¼æ‹†åˆ†ä¸ºå­—ç¬¦æ•°ç»„ char[] charArray = expStr.toCharArray(); // è¿ç®— AbstractExpression left = null; AbstractExpression right = null; for (int i = 0; i &lt; charArray.length; i++) { switch (charArray[i]) { case &#39;+&#39;: // åŠ æ³• left = stack.pop(); right = new VarExpression(String.valueOf(charArray[++i])); stack.push(new AddExpression(left, right)); break; case &#39;-&#39;: // å‡æ³• left = stack.pop(); right = new VarExpression(String.valueOf(charArray[++i])); stack.push(new SubExpression(left, right)); break; default: // å…¬å¼ä¸­çš„å˜é‡ stack.push(new VarExpression(String.valueOf(charArray[i]))); } } // æŠŠè¿ç®—ç»“æœæŠ›å‡ºæ¥ this.expression = stack.pop(); } // è®¡ç®—ç»“æœ public int calculate(HashMap&lt;String, Integer&gt; var) { return this.expression.interprete(var); } } import java.util.HashMap; public class Client { public static void main(String[] args) { // æ„é€ è¿ç®—å…ƒç´ çš„å€¼åˆ—è¡¨ HashMap&lt;String, Integer&gt; ctx = new HashMap&lt;String, Integer&gt;(); ctx.put(&quot;a&quot;, 10); ctx.put(&quot;b&quot;, 20); ctx.put(&quot;c&quot;, 30); ctx.put(&quot;d&quot;, 40); ctx.put(&quot;e&quot;, 50); ctx.put(&quot;f&quot;, 60); Calculator calc = new Calculator(&quot;a+b-c&quot;); int result = calc.calculate(ctx); System.out.println(&quot;Result of a+b-c: &quot; + result); calc = new Calculator(&quot;d-a-b+c&quot;); result = calc.calculate(ctx); System.out.println(&quot;Result of d-a-b+c: &quot; + result); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š Result of a+b-c: 0Result of d-a-b+c: 40 è¯¥åŠ å‡æ³•è®¡ç®—å™¨ç¤ºä¾‹ä¸è§£é‡Šå™¨æ¨¡å¼ç»„æˆå…ƒç´ å¯¹ç…§å¦‚ä¸‹ï¼š ç»™å®šä¸€ç§è¯­è¨€ï¼Œ æœ¬ä¾‹ä¸­å°±æ˜¯ä¸€ä¸ªç®€å•çš„åŠ å‡è¿ç®—ã€‚ å®šä¹‰ä¸€ç§æ–‡æ³•è¡¨ç¤ºï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯æŒ‡å®šçš„å‚ä¸è¿ç®—çš„å…ƒç´ (abcdef)ä»¥åŠè¿ç®—ç¬¦(+-)ï¼Œä»¥åŠç”±å®ƒä»¬æ„é€ è€Œæˆçš„å…¬å¼ï¼Œå¦‚ d-a-b+cã€‚ ç»™å®šä¸€ä¸ªè§£é‡Šå™¨æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ï¼šæœ¬ä¾‹ä¸­çš„è§£é‡Šå™¨æ˜¯å¤šä¸ªç±»çš„ç»„åˆ,åŒ…æ‹¬Calculatorå’ŒAbstractExpression ã€‚ TerminalExpressionè¡¨ç¤ºç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼Œç›¸å½“äºæœ¬ä¾‹ä¸­çš„VarExpressionã€‚ NonterminalExpressionæ˜¯éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼Œç›¸å½“äºæœ¬ä¾‹ä¸­çš„åŠ æ³•ã€å‡æ³•ã€‚ å››ã€è§£é‡Šå™¨æ¨¡å¼çš„é€‚ç”¨æ€§è§£é‡Šå™¨æ¨¡å¼ä¼¼ä¹ä½¿ç”¨é¢ä¸æ˜¯å¾ˆå¹¿ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªè¯­è¨€è§£é‡Šå™¨æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å¾ˆå°‘å»æ„é€ ä¸€ä¸ªè¯­è¨€çš„æ–‡æ³•ã€‚ å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µä¸­é€‰ç”¨è§£é‡Šå™¨æ¨¡å¼ï¼šå½“æœ‰ä¸€ä¸ªè¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥å°†è¯­è¨€ä¸­çš„å¥å­è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼ã€‚ äº”ã€è§£é‡Šå™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹è§£é‡Šå™¨æ¨¡å¼æœ‰ä»¥ä¸‹ä¼˜ç‚¹: æ˜“äºå®ç°è¯­æ³•åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œä¸€æ¡è¯­æ³•è§„åˆ™ç”¨ä¸€ä¸ªè§£é‡Šå™¨å¯¹è±¡æ¥è§£é‡Šæ‰§è¡Œã€‚å¯¹äºè§£é‡Šå™¨çš„å®ç°æ¥è®²ï¼ŒåŠŸèƒ½å°±å˜å¾—æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦è€ƒè™‘è¿™ä¸€æ¡è¯­æ³•è§„åˆ™çš„å®ç°å°±å¯ä»¥äº†ï¼Œå…¶ä»–çš„éƒ½ä¸ç”¨ç®¡ã€‚ æ˜“äºæ‰©å±•æ–°çš„è¯­æ³•æ­£æ˜¯ç”±äºé‡‡ç”¨ä¸€ä¸ªè§£é‡Šå™¨å¯¹è±¡è´Ÿè´£ä¸€æ¡è¯­æ³•è§„åˆ™çš„æ–¹å¼ï¼Œä½¿å¾—æ‰©å±•æ–°çš„è¯­æ³•éå¸¸å®¹æ˜“ã€‚æ‰©å±•äº†æ–°çš„è¯­æ³•ï¼Œåªéœ€è¦åˆ›å»ºç›¸åº”çš„è§£é‡Šå™¨å¯¹è±¡ï¼Œåœ¨åˆ›å»ºæŠ½è±¡è¯­æ³•æ ‘çš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªæ–°çš„è§£é‡Šå™¨å¯¹è±¡å°±å¯ä»¥äº†ã€‚ è§£é‡Šå™¨æ¨¡å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹: ä¸é€‚åˆå¤æ‚çš„è¯­æ³•å¦‚æœè¯­æ³•ç‰¹åˆ«å¤æ‚ï¼Œæ„å»ºè§£é‡Šå™¨æ¨¡å¼éœ€è¦çš„æŠ½è±¡è¯­æ³•æ ‘çš„å·¥ä½œæ˜¯éå¸¸è‰°å·¨çš„ï¼Œå†åŠ ä¸Šæœ‰å¯èƒ½ä¼šéœ€è¦æ„å»ºå¤šä¸ªæŠ½è±¡è¯­æ³•æ ‘ã€‚æ‰€ä»¥è§£é‡Šå™¨æ¨¡å¼ä¸å¤ªé€‚åˆäºå¤æ‚çš„è¯­æ³•ï¼Œå¯¹äºå¤æ‚çš„è¯­æ³•ï¼Œä½¿ç”¨è¯­æ³•åˆ†æç¨‹åºæˆ–ç¼–è¯‘å™¨ç”Ÿæˆå™¨å¯èƒ½ä¼šæ›´å¥½ä¸€äº›ã€‚ å…­ã€ç›¸å…³æ¨¡å¼ è§£é‡Šå™¨å’Œç»„åˆæ¨¡å¼è¿™ä¸¤ç§æ¨¡å¼å¯ä»¥ç»„åˆä½¿ç”¨ã€‚é€šå¸¸è§£é‡Šå™¨æ¨¡å¼éƒ½ä¼šä½¿ç”¨ç»„åˆæ¨¡å¼æ¥å®ç°ï¼Œè¿™æ ·èƒ½å¤Ÿæ–¹ä¾¿åœ°æ„å»ºæŠ½è±¡è¯­æ³•æ ‘ã€‚ä¸€èˆ¬éç»ˆç»“ç¬¦è§£é‡Šå™¨ç›¸å½“äºç»„åˆæ¨¡å¼ä¸­çš„ç»„åˆå¯¹è±¡ï¼Œç»ˆç»“ç¬¦è§£é‡Šå™¨ç›¸å½“äºå¶å­å¯¹è±¡ã€‚ è§£é‡Šå™¨æ¨¡å¼å’Œè¿­ä»£å™¨æ¨¡å¼è¿™ä¸¤ç§æ¨¡å¼å¯ä»¥ç»„åˆä½¿ç”¨ã€‚ç”±äºè§£é‡Šå™¨æ¨¡å¼é€šå¸¸ä½¿ç”¨ç»„åˆæ¨¡å¼æ¥å®ç°ï¼Œå› æ­¤åœ¨éå†æ•´ä¸ªå¯¹è±¡ç»“æ„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼ã€‚ è§£é‡Šå™¨æ¨¡å¼å’Œäº«å…ƒæ¨¡å¼è¿™ä¸¤ç§æ¨¡å¼å¯ä»¥ç»„åˆä½¿ç”¨ã€‚åœ¨ä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé€ æˆå¤šä¸ªç»†ç²’åº¦å¯¹è±¡ï¼Œå¦‚å„å¼å„æ ·çš„ç»ˆç»“ç¬¦è§£é‡Šå™¨ï¼Œè€Œè¿™äº›ç»ˆç»“ç¬¦è§£é‡Šå™¨å¯¹ä¸åŒçš„è¡¨è¾¾å¼æ¥è¯´æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯å¯ä»¥å…±ç”¨çš„ï¼Œå› æ­¤å¯ä»¥å¼•å…¥äº«å…ƒæ¨¡å¼æ¥å…±äº«è¿™äº›å¯¹è±¡ã€‚ è§£é‡Šå™¨æ¨¡å¼å’Œè®¿é—®è€…æ¨¡å¼è¿™ä¸¤ç§æ¨¡å¼å¯ä»¥ç»„åˆä½¿ç”¨ã€‚åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­ï¼Œè¯­æ³•è§„åˆ™å’Œè§£é‡Šå™¨å¯¹è±¡æ˜¯æœ‰å¯¹åº”å…³ç³»çš„ã€‚è¯­æ³•è§„åˆ™çš„å˜åŠ¨æ„å‘³ç€åŠŸèƒ½çš„å˜åŒ–ã€‚è‡ªç„¶ä¼šå¯¼è‡´ä½¿ç”¨ä¸åŒçš„è§£é‡Šå™¨å¯¹è±¡ï¼›è€Œä¸”ä¸€ä¸ªè¯­æ³•è§„åˆ™å¯ä»¥è¢«ä¸åŒçš„è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œã€‚å› æ­¤åœ¨æ„å»ºæŠ½è±¡è¯­æ³•æ ‘çš„æ—¶å€™ï¼Œå¦‚æœæ¯ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„è§£é‡Šå™¨å¯¹è±¡æ˜¯å›ºå®šçš„ï¼Œè¿™æ„å‘³ç€è¯¥èŠ‚ç‚¹å¯¹åº”çš„åŠŸèƒ½æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆå°±ä¸å¾—ä¸æ ¹æ®éœ€è¦æ¥æ„å»ºä¸åŒçš„æŠ½è±¡è¯­æ³•æ ‘ã€‚ä¸ºäº†è®©æ„å»ºçš„æŠ½è±¡è¯­æ³•æ ‘è¾ƒä¸ºé€šç”¨ï¼Œé‚£å°±è¦æ±‚è§£é‡Šå™¨çš„åŠŸèƒ½ä¸è¦é‚£ä¹ˆå›ºå®šï¼Œè¦èƒ½å¾ˆæ–¹ä¾¿åœ°æ”¹å˜è§£é‡Šå™¨çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ—¶å€™å°±å˜æˆäº†å¦‚ä½•èƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°æ›´æ”¹æ ‘å½¢ç»“æ„ä¸­èŠ‚ç‚¹å¯¹è±¡çš„åŠŸèƒ½äº†ï¼Œè®¿é—®è€…æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ ä¸ƒã€æ€»ç»“è§£é‡Šå™¨æ¨¡å¼é€šè¿‡ä¸€ä¸ªè§£é‡Šå™¨å¯¹è±¡å¤„ç†ä¸€ä¸ªè¯­æ³•è§„åˆ™çš„æ–¹å¼ï¼ŒæŠŠå¤æ‚çš„åŠŸèƒ½åˆ†ç¦»å¼€ï¼›ç„¶åé€‰æ‹©éœ€è¦è¢«æ‰§è¡Œçš„åŠŸèƒ½ï¼Œå¹¶æŠŠè¿™äº›åŠŸèƒ½ç»„åˆæˆä¸ºéœ€è¦è¢«è§£é‡Šæ‰§è¡Œçš„æŠ½è±¡è¯­æ³•æ ‘ï¼›å†æŒ‰ç…§æŠ½è±¡è¯­æ³•æ ‘æ¥è§£é‡Šæ‰§è¡Œï¼Œå®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"è§£é‡Šå™¨æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"è§£é‡Šå™¨æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/è§£é‡Šå™¨æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--å¤–è§‚æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--å¤–è§‚æ¨¡å¼","date":"2020-05-24T09:02:28.000Z","updated":"2023-04-30T10:21:41.357Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å¤–è§‚æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å¤–è§‚æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯å¤–è§‚æ¨¡å¼å¤–è§‚(Facade)æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„ç»“æ„å‹æ¨¡å¼ã€‚ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œ Facadeæ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚ å¤–è§‚æ¨¡å¼çš„æœ¬è´¨ï¼šå°è£…äº¤äº’ï¼Œç®€åŒ–è°ƒç”¨ è®¾è®¡æ„å›¾ï¼šéšè—ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œå¹¶å‘å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªå¯ä»¥è®¿é—®ç³»ç»Ÿçš„ç®€å•æ¥å£ï¼Œä»¥é™ä½ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ å°†ä¸€ä¸ªç³»ç»Ÿåˆ’åˆ†æˆä¸ºè‹¥å¹²ä¸ªå­ç³»ç»Ÿæœ‰åˆ©äºé™ä½ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ä¸€ä¸ªå¸¸è§çš„è®¾è®¡ç›®æ ‡æ˜¯ä½¿å­ç³»ç»Ÿé—´çš„é€šä¿¡å’Œç›¸äº’ä¾èµ–å…³ç³»è¾¾åˆ°æœ€å°ï¼Œè¾¾åˆ°è¯¥ç›®æ ‡çš„é€”å¾„ä¹‹ä¸€å°±æ˜¯å¼•å…¥ä¸€ä¸ªå¤–è§‚(Facade)å¯¹è±¡ï¼Œå®ƒä¸ºå­ç³»ç»Ÿä¸­è¾ƒä¸€èˆ¬çš„è®¾æ–½æä¾›äº†ä¸€ä¸ªå•ä¸€è€Œç®€å•çš„ç•Œé¢ã€‚ å¦‚å›¾æ‰€ç¤ºï¼Œå¼•å…¥å¤–è§‚è§’è‰²ä¹‹åï¼Œç”¨æˆ·åªéœ€è¦ç›´æ¥ä¸å¤–è§‚è§’è‰²äº¤äº’ï¼Œç”¨æˆ·ä¸å­ç³»ç»Ÿä¹‹é—´çš„å¤æ‚å…³ç³»ç”±å¤–è§‚è§’è‰²æ¥å®ç°ï¼Œä»è€Œé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ äºŒã€å¤–è§‚æ¨¡å¼çš„ç»“æ„ å¤–è§‚æ¨¡å¼æ²¡æœ‰ä¸€ä¸ªä¸€èˆ¬åŒ–çš„ç±»å›¾è¡¨ç¤ºï¼Œä¸‹å›¾ä»…æ˜¯ä¸€ä¸ªåŠŸèƒ½ç¤ºæ„ã€‚ å¤–è§‚æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š å¤–è§‚(Facade)è§’è‰²ï¼šå®šä¹‰æ•´ä¸ªç³»ç»Ÿå¯¹å¤–çš„é«˜å±‚æ¥å£ï¼Œé€šå¸¸éœ€è¦è°ƒç”¨å†…éƒ¨å¤šä¸ªå­ç³»ç»Ÿï¼Œä»è€ŒæŠŠå®¢æˆ·çš„è¯·æ±‚ä»£ç†ç»™é€‚å½“çš„å­ç³»ç»Ÿå¯¹è±¡ã€‚ å­ç³»ç»Ÿ(Subsystem)è§’è‰²ï¼šæ¥å—Facadeå¯¹è±¡çš„å§”æ´¾ï¼ŒçœŸæ­£å®ç°åŠŸèƒ½ï¼Œå„ä¸ªå­ç³»ç»Ÿå¯¹è±¡ä¹‹é—´å¯èƒ½æœ‰äº¤äº’ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼ŒFacadeå¯¹è±¡çŸ¥é“å„ä¸ªå­ç³»ç»Ÿï¼Œä½†æ˜¯å„ä¸ªå­ç³»ç»Ÿä¸åº”è¯¥çŸ¥é“Facadeå¯¹è±¡ã€‚ æ­¤å¤„ä¸ºäº†ç¤ºæ„ï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šæ±½è½¦åœè½¦èµ·æ­¥ã€‚ æ±½è½¦åœè½¦èµ·æ­¥ç®€åŒ–ä¹‹åä¸€èˆ¬ä¼šåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ“ä½œæ­¥éª¤ï¼šå‘åŠ¨æ±½è½¦â€“&gt;è¸©ä¸‹ç¦»åˆâ€“&gt;æŒ‚æ¡£â€“&gt;æ¾å¼€ç¦»åˆâ€“&gt;è¸©æ²¹é—¨ã€‚å½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªæç®€åŒ–äº†çš„æ­¥éª¤ï¼ŒçœŸå®çš„æ“ä½œæ­¥éª¤å¯èƒ½æ¯”è¿™è¿˜è¦å¤æ‚å¾—å¤š(è¿˜è¦é…åˆåˆ¹è½¦ç­‰æ“ä½œ)ã€‚ç„¶è€Œï¼Œå³ä¾¿å°±æ˜¯è¿™ç»è¿‡ç®€åŒ–çš„æ­¥éª¤ï¼Œä¹Ÿç»å¸¸ä¼šæŠŠè®¸å¤šå­¦è½¦çš„æ–°æ‰‹æå¾—æ‰‹å¿™è„šä¹±ã€è¿è¿æ†‹ç†„ç«ã€‚ è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”¨æˆ·ä¸ä¸€ä¸ªç³»ç»Ÿï¼ˆæ±½è½¦ï¼‰ä¸­çš„å¤šä¸ªå­ç³»ç»Ÿï¼ˆåŠ¨åŠ›ç³»ç»Ÿï¼Œç¦»åˆå™¨ï¼Œå˜é€Ÿå™¨ï¼Œæ²¹é—¨ï¼‰è¿›è¡Œäº¤äº’çš„æƒ…å½¢ï¼Œç”¨æˆ·éœ€è¦å’Œæ‰€æœ‰çš„å­ç³»ç»Ÿäº¤äº’ï¼Œæ‰èƒ½å®Œæˆè‡ªå·±æƒ³è¦å®ç°çš„åŠŸèƒ½ï¼Œè¿™å…¶å®æ˜¯æä¸åˆç†çš„ï¼Œä¹Ÿæå®¹æ˜“å‡ºé”™ï¼Œæ¯•ç«Ÿå¹¶éæ‰€æœ‰çš„ç”¨æˆ·éƒ½æ˜¯â€œè€å¸æœºâ€ï¼Œä½ è¯´æ˜¯å§ï¼ æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨å¤–è§‚æ¨¡å¼æ¥æ”¹é€ ï¼Œå®ç°ä»¥ä¸Šçš„åŠŸèƒ½ï¼Œç±»å›¾ç»“æ„å¦‚ä¸‹ï¼š ä¸‹é¢æ˜¯å…¶å®ç°çš„æºä»£ç ï¼šé¦–å…ˆæ¥çœ‹çœ‹å„ä¸ªå­ç³»ç»Ÿçš„å®šä¹‰ï¼ŒåŒ…æ‹¬ï¼šåŠ¨åŠ›ç³»ç»Ÿã€ç¦»åˆå™¨ã€åŠ é€Ÿå™¨ã€å˜é€Ÿå™¨å››ä¸ªå­ç³»ç»Ÿã€‚ /** * åŠ¨åŠ›ç³»ç»Ÿ */ public class PowerSystem { /** * æ±½è½¦å‘åŠ¨ */ public void startUp() { System.out.println(&quot;æ±½è½¦å‘åŠ¨ã€‚ã€‚ã€‚ã€‚&quot;); } /** * æ±½è½¦ç†„ç« */ public void closeDown() { System.out.println(&quot;æ±½è½¦ç†„ç«ã€‚ã€‚ã€‚ã€‚&quot;); } } /** * ç¦»åˆå™¨ */ public class ClutchSystem { /** * è¸©ä¸‹ç¦»åˆ */ public void press() { System.out.println(&quot;è¸©ä¸‹ç¦»åˆã€‚ã€‚ã€‚ã€‚&quot;); } /** * æ¾å¼€ç¦»åˆ */ public void release() { System.out.println(&quot;æ¾å¼€ç¦»åˆã€‚ã€‚ã€‚ã€‚&quot;); } } /** * å˜é€Ÿå™¨ */ public class TransmissionSystem { /** * æŒ‚æŒ¡æ“ä½œ * @param gear æ‰€æŒ‚æ¡£ä½ */ public void shift(int gear) { switch (gear) { case -1: System.out.println(&quot;æŒ‚å€’æ¡£ã€‚ã€‚ã€‚ã€‚&quot;); break; case 0: System.out.println(&quot;æŒ‚ç©ºæ¡£ã€‚ã€‚ã€‚ã€‚&quot;); break; case 1: System.out.println(&quot;æŒ‚ä¸€æ¡£ã€‚ã€‚ã€‚ã€‚&quot;); break; case 2: System.out.println(&quot;æŒ‚äºŒæ¡£ã€‚ã€‚ã€‚ã€‚&quot;); break; case 3: System.out.println(&quot;æŒ‚ä¸‰æ¡£ã€‚ã€‚ã€‚ã€‚&quot;); break; case 4: System.out.println(&quot;æŒ‚å››æ¡£ã€‚ã€‚ã€‚ã€‚&quot;); break; case 5: System.out.println(&quot;æŒ‚äº”æ¡£ã€‚ã€‚ã€‚ã€‚&quot;); break; } } } /** * åŠ é€Ÿå™¨ï¼Œå³æ²¹é—¨ */ public class AcceleratorSystem { /** * è¸©ä¸‹æ²¹é—¨ */ public void press() { System.out.println(&quot;è¸©ä¸‹æ²¹é—¨ã€‚ã€‚ã€‚ã€‚&quot;); } /** * æ¾å¼€æ²¹é—¨ */ public void release() { System.out.println(&quot;æ¾å¼€æ²¹é—¨ã€‚ã€‚ã€‚ã€‚&quot;); } } æ¥ä¸‹æ¥è¯¥çœ‹çœ‹å¤–è§‚çš„å®šä¹‰äº†ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * å¤–è§‚ç±» */ public class Facade { /** * ç¤ºæ„æ–¹æ³•ï¼Œåœè½¦èµ·æ­¥ */ public void parkingStart() { // åˆ›å»ºéœ€è¦è½¬è°ƒçš„å­ç³»ç»Ÿå¯¹è±¡å®ä¾‹ ClutchSystem clutchSystem = new ClutchSystem(); TransmissionSystem transmissionSystem = new TransmissionSystem(); AcceleratorSystem acceleratorSystem = new AcceleratorSystem(); // è½¬è°ƒå­ç³»ç»Ÿçš„åŠŸèƒ½ clutchSystem.press(); transmissionSystem.shift(1); clutchSystem.release(); acceleratorSystem.press(); System.out.println(&quot;æ±½è½¦å¼€å§‹åŠ¨äº†ã€‚ã€‚ã€‚ã€‚&quot;); } } åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ç±»æµ‹è¯•ä¸€ä¸‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { PowerSystem powerSystem = new PowerSystem(); // å‘åŠ¨æ±½è½¦ // æ­¤å¤„ä½œä¸ºç¤ºæ„ï¼Œç”¨æˆ·å¯ä»¥è·³è¿‡å¤–è§‚ï¼Œç›´æ¥ä¸å­ç³»ç»Ÿè¿›è¡Œäº¤äº’ powerSystem.startUp(); // åˆ›å»ºå¤–è§‚å®ä¾‹ Facade facade = new Facade(); // åœè½¦èµ·æ­¥ facade.parkingStart(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ±½è½¦å‘åŠ¨ã€‚ã€‚ã€‚ã€‚è¸©ä¸‹ç¦»åˆã€‚ã€‚ã€‚ã€‚æŒ‚ä¸€æ¡£ã€‚ã€‚ã€‚ã€‚æ¾å¼€ç¦»åˆã€‚ã€‚ã€‚ã€‚è¸©ä¸‹æ²¹é—¨ã€‚ã€‚ã€‚ã€‚æ±½è½¦å¼€å§‹åŠ¨äº†ã€‚ã€‚ã€‚ã€‚ åœ¨ä»¥ä¸Šä»£ç ç¤ºä¾‹ä¸­ï¼Œä¸ºç®€æ˜èµ·è§ï¼Œåªä¸ºFacadeå¯¹è±¡æ·»åŠ äº†ä¸€ä¸ªâ€œåœè½¦èµ·æ­¥â€çš„åŠŸèƒ½ï¼Œäº‹å®ä¸Šå®ƒè¿˜å¯ä»¥æœ‰æ›´å¤šå…¶ä»–çš„åŠŸèƒ½ï¼ŒFacadeå¯¹è±¡è¿™ä¸ªâ€œåœè½¦èµ·æ­¥â€çš„åŠŸèƒ½å…¶å®å°±ç›¸å½“äºæ˜¯ä¸ºå·²ç»å‘åŠ¨äº†çš„æ±½è½¦å¢åŠ äº†ä¸€ä¸ªâ€œä¸€é”®åœè½¦èµ·æ­¥â€çš„åŠŸèƒ½ã€‚å¹¶æœªæŠŠâ€œå‘åŠ¨æ±½è½¦â€è¿™ä¸ªæ­¥éª¤ä¸€å¹¶åŠ å…¥çš„Facadeå¯¹è±¡ä¸­ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä½œä¸€ä¸ªç¤ºæ„ï¼šæ ¹æ®å®é™…éœ€è¦ï¼Œç”¨æˆ·æ˜¯å¯ä»¥è¶Šè¿‡Facadeå±‚ï¼Œç›´æ¥ä¸å­ç³»ç»Ÿè¿›è¡Œäº¤äº’çš„ã€‚ ä¸‰ã€å¤–è§‚æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼š å½“ä½ è¦ä¸ºä¸€ä¸ªå¤æ‚å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€å•æ¥å£æ—¶ã€‚å­ç³»ç»Ÿå¾€å¾€å› ä¸ºä¸æ–­æ¼”åŒ–è€Œå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚å¤§å¤šæ•°æ¨¡å¼ä½¿ç”¨æ—¶éƒ½ä¼šäº§ç”Ÿæ›´å¤šæ›´å°çš„ç±»ã€‚è¿™ä½¿å¾—å­ç³»ç»Ÿæ›´å…·å¯é‡ç”¨æ€§ï¼Œä¹Ÿæ›´å®¹æ˜“å¯¹å­ç³»ç»Ÿè¿›è¡Œå®šåˆ¶ï¼Œä½†è¿™ä¹Ÿç»™é‚£äº›ä¸éœ€è¦å®šåˆ¶å­ç³»ç»Ÿçš„ç”¨æˆ·å¸¦æ¥ä¸€äº›ä½¿ç”¨ä¸Šçš„å›°éš¾ã€‚facadeå¯ä»¥æä¾›ä¸€ä¸ªç®€å•çš„ç¼ºçœè§†å›¾ï¼Œè¿™ä¸€è§†å›¾å¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´å·²ç»è¶³å¤Ÿï¼Œè€Œé‚£äº›éœ€è¦æ›´å¤šçš„å¯å®šåˆ¶æ€§çš„ç”¨æˆ·å¯ä»¥è¶Šè¿‡facadeå±‚ã€‚ å®¢æˆ·ç¨‹åºä¸æŠ½è±¡ç±»çš„å®ç°éƒ¨åˆ†ä¹‹é—´å­˜åœ¨ç€å¾ˆå¤§çš„ä¾èµ–æ€§ã€‚å¼•å…¥facadeå°†è¿™ä¸ªå­ç³»ç»Ÿä¸å®¢æˆ·ä»¥åŠå…¶ä»–çš„å­ç³»ç»Ÿåˆ†ç¦»ï¼Œå¯ä»¥æé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§å’Œå¯ç§»æ¤æ€§ã€‚ å½“ä½ éœ€è¦æ„å»ºä¸€ä¸ªå±‚æ¬¡ç»“æ„çš„å­ç³»ç»Ÿæ—¶ï¼Œä½¿ç”¨ facadeæ¨¡å¼å®šä¹‰å­ç³»ç»Ÿä¸­æ¯å±‚çš„å…¥å£ç‚¹ã€‚å¦‚æœå­ç³»ç»Ÿä¹‹é—´æ˜¯ç›¸äº’ä¾èµ–çš„ï¼Œä½ å¯ä»¥è®©å®ƒä»¬ä»…é€šè¿‡facadeè¿›è¡Œé€šè®¯ï¼Œä»è€Œç®€åŒ–äº†å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ å››ã€å¤–è§‚æ¨¡å¼å’Œä¸­ä»‹è€…æ¨¡å¼å¤–è§‚æ¨¡å¼å’Œä¸­ä»‹è€…æ¨¡å¼éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯å´æœ‰æœ¬è´¨çš„åŒºåˆ«ã€‚ ä¸­ä»‹è€…æ¨¡å¼ä¸»è¦ç”¨æ¥å°è£…å¤šä¸ªå¯¹è±¡ä¹‹é—´ç›¸äº’çš„äº¤äº’ï¼Œå¤šç”¨åœ¨ç³»ç»Ÿå†…éƒ¨çš„å¤šä¸ªæ¨¡å—ä¹‹é—´ï¼›è€Œå¤–è§‚æ¨¡å¼å°è£…çš„æ˜¯å•å‘çš„äº¤äº’ï¼Œæ˜¯ä»å®¢æˆ·ç«¯è®¿é—®ç³»ç»Ÿçš„è°ƒç”¨ï¼Œæ²¡æœ‰ä»ç³»ç»Ÿä¸­æ¥è®¿é—®å®¢æˆ·ç«¯çš„è°ƒç”¨ã€‚ åœ¨ä¸­ä»‹è€…æ¨¡å¼çš„å®ç°é‡Œé¢ï¼Œæ˜¯éœ€è¦å®ç°å…·ä½“çš„äº¤äº’åŠŸèƒ½çš„ï¼›è€Œå¤–è§‚æ¨¡å¼çš„å®ç°é‡Œé¢ï¼Œä¸€èˆ¬æ˜¯ç»„åˆè°ƒç”¨æˆ–æ˜¯è½¬è°ƒå†…éƒ¨å®ç°çš„åŠŸèƒ½ï¼Œé€šå¸¸å¤–è§‚æ¨¡å¼æœ¬èº«å¹¶ä¸å®ç°è¿™äº›åŠŸèƒ½ã€‚ ä¸­ä»‹è€…æ¨¡å¼çš„ç›®çš„ä¸»è¦æ˜¯æ¾æ•£å¤šä¸ªåŒäº‹ä¹‹é—´çš„è€¦åˆï¼ŒæŠŠè¿™äº›è€¦åˆå…³ç³»å…¨éƒ¨æ”¾åˆ°ä¸­ä»‹è€…ä¸­å»å®ç°ï¼›è€Œå¤–è§‚æ¨¡å¼çš„ç›®çš„æ˜¯ç®€åŒ–å®¢æˆ·ç«¯çš„è°ƒç”¨ï¼Œè¿™ç‚¹å’Œä¸­ä»‹è€…æ¨¡å¼ä¹Ÿä¸åŒã€‚ äº”ã€å¤–è§‚æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä½¿ç”¨å¤–è§‚æ¨¡å¼çš„ä¼˜ç‚¹ï¼š æ¾æ•£è€¦åˆå¤–è§‚æ¨¡å¼æ¾æ•£äº†å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿçš„è€¦åˆå…³ç³»ï¼Œè®©å­ç³»ç»Ÿå†…éƒ¨çš„æ¨¡å—èƒ½æ›´å®¹æ˜“æ‰©å±•å’Œç»´æŠ¤ã€‚ ç®€å•æ˜“ç”¨å¤–è§‚æ¨¡å¼è®©å­ç³»ç»Ÿæ›´åŠ æ˜“ç”¨ï¼Œå®¢æˆ·ç«¯ä¸å†éœ€è¦äº†è§£å­ç³»ç»Ÿå†…éƒ¨çš„å®ç°ï¼Œä¹Ÿä¸éœ€è¦è·Ÿä¼—å¤šå­ç³»ç»Ÿå†…éƒ¨çš„æ¨¡å—è¿›è¡Œäº¤äº’ï¼Œåªéœ€è¦è·Ÿå¤–è§‚äº¤äº’å°±å¯ä»¥äº†ï¼Œç›¸å½“äºå¤–è§‚ç±»ä¸ºå¤–éƒ¨å®¢æˆ·ç«¯ä½¿ç”¨å­ç³»ç»Ÿæä¾›äº†ä¸€ç«™å¼æœåŠ¡ã€‚ æ›´å¥½åœ°åˆ’åˆ†è®¿é—®çš„å±‚æ¬¡é€šè¿‡åˆç†ä½¿ç”¨Facadeï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°åˆ’åˆ†è®¿é—®çš„å±‚æ¬¡ã€‚æœ‰äº›æ–¹æ³•æ˜¯å¯¹ç³»ç»Ÿå¤–çš„ï¼Œæœ‰äº›æ–¹æ³•æ˜¯åœ¨ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨çš„ã€‚æŠŠéœ€è¦æš´éœ²ç»™å¤–éƒ¨çš„åŠŸèƒ½é›†ä¸­åˆ°å¤–è§‚ä¸­ï¼Œè¿™æ ·æ—¢æ–¹ä¾¿å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¹Ÿå¾ˆå¥½åœ°éšè—äº†å†…éƒ¨çš„ç»†èŠ‚ã€‚ ä½¿ç”¨å¤–è§‚æ¨¡å¼çš„ç¼ºç‚¹ ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼Œå¦‚æœå¯¹å®¢æˆ·è®¿é—®å­ç³»ç»Ÿç±»åšå¤ªå¤šçš„é™åˆ¶åˆ™å‡å°‘äº†å¯å˜æ€§å’Œçµæ´»æ€§ã€‚ åœ¨ä¸å¼•å…¥æŠ½è±¡å¤–è§‚ç±»çš„æƒ…å†µä¸‹ï¼Œå¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»æˆ–å®¢æˆ·ç«¯çš„æºä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚ å…­ã€æ€»ç»“Facadeå°è£…äº†å­ç³»ç»Ÿå¤–éƒ¨å’Œå­ç³»ç»Ÿå†…éƒ¨å¤šä¸ªæ¨¡å—çš„äº¤äº’è¿‡ç¨‹ï¼Œä»è€Œç®€åŒ–äº†å¤–éƒ¨çš„è°ƒç”¨ã€‚é€šè¿‡å¤–è§‚ï¼Œå­ç³»ç»Ÿä¸ºå¤–éƒ¨æä¾›ä¸€äº›é«˜å±‚çš„æ¥å£ï¼Œä»¥æ–¹ä¾¿å®ƒä»¬çš„ä½¿ç”¨ã€‚ å¤–è§‚æ¨¡å¼å¾ˆå¥½åœ°ä½“ç°äº†â€œæœ€å°‘çŸ¥è¯†åŸåˆ™â€ã€‚ å¦‚æœä¸ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œå®¢æˆ·ç«¯é€šå¸¸éœ€è¦å’Œå­ç³»ç»Ÿå†…éƒ¨çš„å¤šä¸ªæ¨¡å—äº¤äº’ï¼Œä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯ä¼šå’Œè¿™äº›æ¨¡å—ä¹‹é—´éƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œä»»æ„ä¸€ä¸ªæ¨¡å—çš„å˜åŠ¨éƒ½å¯èƒ½ä¼šå¼•èµ·å®¢æˆ·ç«¯çš„å˜åŠ¨ã€‚ ä½¿ç”¨å¤–è§‚æ¨¡å¼åï¼Œå®¢æˆ·ç«¯åªéœ€è¦å’Œå¤–è§‚ç±»äº¤äº’ï¼Œå³åªå’Œè¿™ä¸ªå¤–è§‚ç±»æœ‰ä¾èµ–å…³ç³»ï¼Œä¸éœ€è¦å†å»å…³å¿ƒå­ç³»ç»Ÿå†…éƒ¨æ¨¡å—çš„å˜åŠ¨æƒ…å†µäº†ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯ä¸ä½†ç®€å•ï¼Œè€Œä¸”è¿™ä¸ªç³»ç»Ÿä¼šæ›´æœ‰å¼¹æ€§ã€‚å½“ç³»ç»Ÿå†…éƒ¨å¤šä¸ªæ¨¡å—å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜åŒ–å¯ä»¥è¢«è¿™ä¸ªå¤–è§‚ç±»å¸æ”¶å’Œæ¶ˆåŒ–ï¼Œå¹¶ä¸éœ€è¦å½±å“åˆ°å®¢æˆ·ç«¯ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼šå¯ä»¥åœ¨ä¸å½±å“å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ï¼Œå®ç°ç³»ç»Ÿå†…éƒ¨çš„ç»´æŠ¤å’Œæ‰©å±•ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å¤–è§‚æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å¤–è§‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å¤–è§‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--ä¸­ä»‹è€…æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--ä¸­ä»‹è€…æ¨¡å¼","date":"2020-05-24T09:01:24.000Z","updated":"2023-04-30T10:21:41.354Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ä¸­ä»‹è€…æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ä¸­ä»‹è€…æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯ä¸­ä»‹è€…æ¨¡å¼ä¸­ä»‹è€…(Mediator)æ¨¡å¼ï¼ˆäº¦è¢«ç§°ä¸ºè°ƒåœè€…æ¨¡å¼ï¼‰æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ ä¸­ä»‹è€…æ¨¡å¼çš„æœ¬è´¨ï¼šå°è£…äº¤äº’ è®¾è®¡æ„å›¾ï¼šé¢å‘å¯¹è±¡è®¾è®¡é¼“åŠ±å°†è¡Œä¸ºåˆ†å¸ƒåˆ°å„ä¸ªå¯¹è±¡ä¸­ã€‚è¿™ç§åˆ†å¸ƒå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªå¯¹è±¡ä¹‹é—´éœ€è¦ç›¸äº’äº¤äº’ï¼Œä»è€Œå½¢æˆç´§å¯†è€¦åˆï¼Œä¸åˆ©äºå¯¹è±¡çš„ä¿®æ”¹å’Œç»´æŠ¤ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹,æ¯ä¸€ä¸ªå¯¹è±¡éƒ½éœ€è¦çŸ¥é“å…¶ä»–æ‰€æœ‰å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è™½ç„¶å°†ä¸€ä¸ªç³»ç»Ÿåˆ†å‰²æˆè®¸å¤šå¯¹è±¡é€šå¸¸å¯ä»¥å¢å¼ºå¯å¤ç”¨æ€§ï¼Œä½†æ˜¯å¯¹è±¡é—´ç›¸äº’è¿æ¥çš„æ¿€å¢åˆä¼šé™ä½å…¶å¯å¤ç”¨æ€§ã€‚å¤§é‡çš„ç›¸äº’è¿æ¥ä½¿å¾—ä¸€ä¸ªå¯¹è±¡ä¼¼ä¹ä¸å¤ªå¯èƒ½åœ¨æ²¡æœ‰å…¶ä»–å¯¹è±¡çš„æ”¯æŒä¸‹å·¥ä½œâ€”-ç³»ç»Ÿè¡¨ç°ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ã€‚è€Œä¸”ï¼Œå¯¹ç³»ç»Ÿçš„è¡Œä¸ºè¿›è¡Œä»»ä½•è¾ƒå¤§çš„æ”¹åŠ¨éƒ½ååˆ†å›°éš¾ï¼Œå› ä¸ºè¡Œä¸ºè¢«åˆ†å¸ƒåœ¨è®¸å¤šå¯¹è±¡ä¸­ã€‚ç»“æœæ˜¯ï¼šä½ å¯èƒ½ä¸å¾—ä¸å®šä¹‰å¾ˆå¤šå­ç±»ä»¥å®šåˆ¶ç³»ç»Ÿçš„è¡Œä¸ºã€‚ ä¸­ä»‹è€…æ¨¡å¼é€šè¿‡å¼•å…¥ä¸€ä¸ªä¸­ä»‹å¯¹è±¡ï¼Œå½¢æˆäº†ä¸€ä¸ªä»¥ä¸­ä»‹è€…ä¸ºä¸­å¿ƒçš„æ˜Ÿå½¢ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æŸä¸€ä¸ªå¯¹è±¡ä¸å†é€šè¿‡ç›´æ¥çš„è”ç³»ä¸å¦ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œè€Œæ˜¯è®©æ‰€æœ‰çš„å¯¹è±¡éƒ½åªå’Œä¸­ä»‹è€…å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œä»è€Œå®ç°äº†å¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚ä¸­ä»‹è€…å¯¹è±¡çš„å­˜åœ¨ä¿è¯äº†å¯¹è±¡ç»“æ„ä¸Šçš„ç¨³å®šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿçš„ç»“æ„ä¸ä¼šå› ä¸ºæ–°å¯¹è±¡çš„å¼•å…¥é€ æˆå¤§é‡çš„ä¿®æ”¹å·¥ä½œã€‚ äºŒã€ä¸­ä»‹è€…æ¨¡å¼çš„ç»“æ„ ä¸­ä»‹è€…æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡ä¸­ä»‹è€…(Mediator)è§’è‰²ï¼šä¸€èˆ¬å®šä¹‰ä¸ºæ¥å£ï¼Œç”¨æ¥å®šä¹‰å„ä¸ªåŒäº‹ä¹‹é—´äº¤äº’éœ€è¦çš„æ–¹æ³•ï¼Œå¯ä»¥æ˜¯å…¬å…±çš„é€šä¿¡æ–¹æ³•ï¼Œæ¯”å¦‚ changed()æ–¹æ³•ï¼Œå¤§å®¶éƒ½ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å°èŒƒå›´çš„äº¤äº’æ–¹æ³•ã€‚ å…·ä½“ä¸­ä»‹è€…(ConcreteMediator)è§’è‰²ï¼šå®ç°Mediatorä¸­å®šä¹‰çš„æ¥å£ï¼Œå®ƒéœ€è¦äº†è§£å¹¶ç»´æŠ¤å„ä¸ªåŒäº‹å¯¹è±¡ï¼Œå¹¶è´Ÿè´£å…·ä½“çš„åè°ƒå„åŒäº‹å¯¹è±¡çš„äº¤äº’å…³ç³»ã€‚ æŠ½è±¡åŒäº‹(Colleague)è§’è‰²ï¼šé€šå¸¸å®ç°æˆä¸ºæŠ½è±¡ç±»ï¼Œä¸»è¦è´Ÿè´£çº¦æŸåŒäº‹å¯¹è±¡çš„ç±»å‹ï¼Œå¹¶å®ç°ä¸€äº›å…·ä½“åŒäº‹ç±»ä¹‹é—´çš„å…¬å…±åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œæ¯ä¸ªå…·ä½“åŒäº‹ç±»éƒ½åº”è¯¥çŸ¥é“ä¸­ä»‹è€…å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…·ä½“åŒäº‹ç±»éƒ½ä¼šæŒæœ‰ä¸­ä»‹è€…å¯¹è±¡ï¼Œéƒ½å¯ä»¥å®šä¹‰åˆ°è¿™ä¸ªç±»é‡Œé¢ã€‚ å…·ä½“åŒäº‹(ConcreteColleague)è§’è‰²ï¼šç»§æ‰¿è‡ªColleagueï¼Œå®ç°è‡ªå·±çš„ä¸šåŠ¡ï¼Œåœ¨éœ€è¦ä¸å…¶ä»–åŒäº‹é€šä¿¡çš„æ—¶å€™ï¼Œå°±ä¸æŒæœ‰çš„ä¸­ä»‹è€…é€šä¿¡ï¼Œä¸­ä»‹è€…è´Ÿè´£ä¸ä»–çš„åŒäº‹äº¤äº’ã€‚ ä¸­ä»‹è€…æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šå…ˆæ¥çœ‹çœ‹æ‰€æœ‰åŒäº‹çš„çˆ¶ç±»çš„å®šä¹‰ã€‚ /** * åŒäº‹ç±»çš„æŠ½è±¡çˆ¶ç±» */ public abstract class Colleague { /** * æŒæœ‰ä¸­ä»‹è€…å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªåŒäº‹ç±»éƒ½çŸ¥é“å®ƒçš„ä¸­ä»‹è€…å¯¹è±¡ */ private Mediator mediator; public Colleague(Mediator mediator) { this.mediator = mediator; } /** * è·å–å½“å‰åŒäº‹ç±»å¯¹åº”çš„ä¸­ä»‹è€…å¯¹è±¡ */ public Mediator getMediator() { return mediator; } } å†æ¥çœ‹çœ‹å…·ä½“çš„åŒäº‹ç±»ï¼Œåœ¨ç¤ºæ„ä¸­å®ƒä»¬çš„å®ç°æ˜¯å·®ä¸å¤šçš„ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * å…·ä½“çš„åŒäº‹ç±»A */ public class ConcreteColleagueA extends Colleague { public ConcreteColleagueA(Mediator mediator) { super(mediator); } public void someOperation() { // åœ¨éœ€è¦è·Ÿå…¶ä»–åŒäº‹é€šä¿¡çš„æ—¶å€™ï¼Œé€šçŸ¥ä¸­ä»‹è€…å¯¹è±¡ getMediator().changed(this); } } /** * å…·ä½“çš„åŒäº‹ç±»B */ public class ConcreteColleagueB extends Colleague { public ConcreteColleagueB(Mediator mediator){ super(mediator); } public void someOperation(){ //åœ¨éœ€è¦è·Ÿå…¶ä»–åŒäº‹é€šä¿¡çš„æ—¶å€™ï¼Œé€šçŸ¥ä¸­ä»‹è€…å¯¹è±¡ getMediator().changed(this); } } æ¥ä¸‹æ¥çœ‹çœ‹ä¸­ä»‹è€…æ¥å£çš„å®šä¹‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * ä¸­ä»‹è€…ï¼Œå®šä¹‰å„ä¸ªåŒäº‹å¯¹è±¡é€šä¿¡çš„æ¥å£ */ public interface Mediator { /** * åŒäº‹å¯¹è±¡åœ¨è‡ªèº«æ”¹å˜çš„æ—¶å€™æ¥é€šçŸ¥ä¸­ä»‹è€…çš„æ–¹æ³•ï¼Œè®©ä¸­ä»‹è€…è´Ÿè´£ç›¸åº”çš„ä¸å…¶ä»–åŒäº‹å¯¹è±¡çš„äº¤äº’ */ public void changed(Colleague colleague); } æœ€åæ¥çœ‹çœ‹å…·ä½“çš„ä¸­ä»‹è€…å®ç°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * å…·ä½“çš„ä¸­ä»‹è€…å®ç° */ public class ConcreteMediator implements Mediator { /** * æŒæœ‰å¹¶ç»´æŠ¤åŒäº‹A */ private ConcreteColleagueA colleagueA; /** * æŒæœ‰å¹¶ç»´æŠ¤åŒäº‹B */ private ConcreteColleagueB colleagueB; /** * è®¾ç½®ä¸­ä»‹è€…éœ€è¦äº†è§£å¹¶ç»´æŠ¤çš„åŒäº‹Aå¯¹è±¡ */ public void setConcreteColleagueA(ConcreteColleagueA colleagueA) { this.colleagueA = colleagueA; } /** * è®¾ç½®ä¸­ä»‹è€…éœ€è¦äº†è§£å¹¶ç»´æŠ¤çš„åŒäº‹Bå¯¹è±¡ */ public void setConcreteColleagueB(ConcreteColleagueB colleagueB) { this.colleagueB = colleagueB; } @Override public void changed(Colleague colleague) { // æŸä¸ªåŒäº‹ç±»å‘ç”Ÿäº†å˜åŒ–ï¼Œé€šå¸¸éœ€è¦ä¸å…¶ä»–åŒäº‹äº¤äº’ // å…·ä½“åè°ƒç›¸åº”çš„åŒäº‹å¯¹è±¡æ¥å®ç°åä½œè¡Œä¸º } } ä¸‰ã€ä¸­ä»‹è€…æ¨¡å¼åº”ç”¨ä¸¾ä¾‹ã€Šç ”ç£¨è®¾è®¡æ¨¡å¼ã€‹ä¸­ç»™å‡ºè¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼šä½¿ç”¨ç”µè„‘æ¥çœ‹ç”µå½±ã€‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ç”µè„‘æ¥çœ‹ç”µå½±ï¼ŒæŠŠè¿™ä¸ªè¿‡ç¨‹æè¿°å‡ºæ¥ï¼Œç®€åŒ–åå‡å®šä¼šæœ‰å¦‚ä¸‹çš„äº¤äº’è¿‡ç¨‹ï¼š é¦–å…ˆæ˜¯å…‰é©±è¦è¯»å–å…‰ç›˜ä¸Šçš„æ•°æ®ï¼Œç„¶åå‘Šè¯‰ä¸»æ¿ï¼Œå®ƒçš„çŠ¶æ€æ”¹å˜äº†ã€‚ ä¸»æ¿å»å¾—åˆ°å…‰é©±çš„æ•°æ®ï¼ŒæŠŠè¿™äº›æ•°æ®äº¤ç»™CPUè¿›è¡Œåˆ†æå¤„ç†ã€‚ CPUå¤„ç†å®Œåï¼ŒæŠŠæ•°æ®åˆ†æˆäº†è§†é¢‘æ•°æ®å’ŒéŸ³é¢‘æ•°æ®ï¼Œé€šçŸ¥ä¸»æ¿ï¼Œå®ƒå¤„ç†å®Œäº†ã€‚ ä¸»æ¿å»å¾—åˆ°CPUå¤„ç†è¿‡åçš„æ•°æ®ï¼Œåˆ†åˆ«æŠŠæ•°æ®äº¤ç»™æ˜¾å¡å’Œå£°å¡ï¼Œå»æ˜¾ç¤ºè§†é¢‘å’Œæ’­æ”¾å£°éŸ³ã€‚ å¦‚æœä½¿ç”¨è°ƒåœè€…æ¨¡å¼æŠŠè¿™ä¸ªè¿‡ç¨‹æè¿°å‡ºæ¥ï¼Œè¯¥å¦‚ä½•å…·ä½“å®ç°å‘¢ï¼Ÿ è¦ä½¿ç”¨è°ƒåœè€…æ¨¡å¼æ¥å®ç°ç¤ºä¾‹ï¼Œé¦–å…ˆè¦åŒºåˆ†å‡ºåŒäº‹å¯¹è±¡å’Œè°ƒåœè€…å¯¹è±¡ã€‚å¾ˆæ˜æ˜¾ï¼Œä¸»æ¿æ˜¯ä¸­ä»‹è€…ï¼Œè€Œå…‰é©±ã€å£°å¡ã€CPUã€æ˜¾å¡ç­‰é…ä»¶ï¼Œéƒ½æ˜¯ä½œä¸ºåŒäº‹å¯¹è±¡ã€‚ æ ¹æ®ä¸­ä»‹è€…æ¨¡å¼çš„çŸ¥è¯†ï¼Œè®¾è®¡å‡ºçš„ç¨‹åºç±»å›¾ç»“æ„å¦‚ä¸‹ã€‚ ä¸‹é¢æ¥çœ‹çœ‹ä»£ç å®ç°ï¼Œä¼šæ›´æ¸…æ¥šã€‚ æŠ½è±¡åŒäº‹ç±»çš„å®šä¹‰è·Ÿæ ‡å‡†çš„å®ç°æ˜¯å·®ä¸å¤šçš„ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * æŠ½è±¡åŒäº‹ç±» */ public abstract class Colleague { // æŒæœ‰ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡ private Mediator mediator; /** * æ„é€ å‡½æ•° */ public Colleague(Mediator mediator) { this.mediator = mediator; } /** * è·å–å½“å‰åŒäº‹ç±»å¯¹åº”çš„ä¸­ä»‹è€…å¯¹è±¡ */ public Mediator getMediator() { return mediator; } } å®šä¹‰ä¼—å¤šçš„åŒäº‹ç±»ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * å…‰é©±ç±»ï¼Œä¸€ä¸ªåŒäº‹ç±» */ public class CDDriver extends Colleague { // å…‰é©±è¯»å–å‡ºæ¥çš„æ•°æ® private String data = &quot;&quot;; /** * æ„é€ å‡½æ•° */ public CDDriver(Mediator mediator) { super(mediator); } /** * è·å–å…‰ç›˜è¯»å–å‡ºæ¥çš„æ•°æ® */ public String getData() { return data; } /** * è¯»å–å…‰ç›˜ */ public void readCD(String data) { // é€—å·å‰æ˜¯è§†é¢‘æ˜¾ç¤ºçš„æ•°æ®ï¼Œé€—å·åæ˜¯å£°éŸ³ this.data = data; // é€šçŸ¥ä¸»æ¿ï¼Œè‡ªå·±çš„çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ getMediator().changed(this); } } /** * CPUç±»ï¼Œä¸€ä¸ªåŒäº‹ç±» */ public class CPU extends Colleague { // åˆ†è§£å‡ºæ¥çš„è§†é¢‘æ•°æ® private String videoData = &quot;&quot;; // åˆ†è§£å‡ºæ¥çš„å£°éŸ³æ•°æ® private String audioData = &quot;&quot;; /** * æ„é€ å‡½æ•° */ public CPU(Mediator mediator) { super(mediator); } /** * è·å–åˆ†è§£å‡ºæ¥çš„è§†é¢‘æ•°æ® */ public String getVideoData() { return videoData; } /** * è·å–åˆ†è§£å‡ºæ¥çš„å£°éŸ³æ•°æ® */ public String getAudioData() { return audioData; } /** * å¤„ç†æ•°æ®ï¼ŒæŠŠæ•°æ®åˆ†æˆè§†é¢‘å’ŒéŸ³é¢‘çš„æ•°æ® */ public void processData(String data) { // æŠŠæ•°æ®åˆ†è§£å¼€ï¼Œå‰é¢æ˜¯è§†é¢‘æ•°æ®ï¼Œåé¢æ˜¯éŸ³é¢‘æ•°æ® String[] array = data.split(&quot;,&quot;); this.videoData = array[0]; this.audioData = array[1]; // é€šçŸ¥ä¸»æ¿ï¼ŒCPUå®Œæˆå·¥ä½œ getMediator().changed(this); } } /** * æ˜¾å¡ç±»ï¼Œä¸€ä¸ªåŒäº‹ç±» */ public class VideoCard extends Colleague { /** * æ„é€ å‡½æ•° */ public VideoCard(Mediator mediator) { super(mediator); } /** * æ˜¾ç¤ºè§†é¢‘æ•°æ® */ public void display(String data) { System.out.println(&quot;æ‚¨æ­£åœ¨è§‚çœ‹çš„æ˜¯ï¼š&quot; + data); } } /** * å£°å¡ç±»ï¼Œä¸€ä¸ªåŒäº‹ç±» */ public class AudioCard extends Colleague { /** * æ„é€ å‡½æ•° */ public AudioCard(Mediator mediator) { super(mediator); } /** * æ’­æ”¾éŸ³é¢‘æ•°æ® */ public void play(String data) { System.out.println(&quot;ç”»å¤–éŸ³ï¼š&quot; + data); } } æ¥ä¸‹æ¥çœ‹çœ‹æŠ½è±¡ä¸­ä»‹è€…çš„å®šä¹‰ï¼Œæ­¤å¤„ä»…å®šä¹‰ä¸€ä¸ªè®©åŒäº‹å¯¹è±¡åœ¨è‡ªèº«æ”¹å˜çš„æ—¶å€™æ¥é€šçŸ¥ä¸­ä»‹è€…çš„æ¥å£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * ä¸­ä»‹è€…æ¥å£ */ public interface Mediator { /** * åŒäº‹å¯¹è±¡åœ¨è‡ªèº«æ”¹å˜çš„æ—¶å€™æ¥é€šçŸ¥ä¸­ä»‹è€…çš„æ–¹æ³• è®©ä¸­ä»‹è€…å»è´Ÿè´£ç›¸åº”çš„ä¸å…¶ä»–åŒäº‹å¯¹è±¡çš„äº¤äº’ */ public void changed(Colleague c); } å†æ¥çœ‹çœ‹å…·ä½“ä¸­ä»‹è€…çš„å®ç°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * ä¸»æ¿ç±»ï¼Œå®ç°ä¸­ä»‹è€…æ¥å£ */ public class MainBoard implements Mediator { // éœ€è¦çŸ¥é“è¦äº¤äº’çš„åŒäº‹ç±»â€”â€”å…‰é©±ç±» private CDDriver cdDriver = null; // éœ€è¦çŸ¥é“è¦äº¤äº’çš„åŒäº‹ç±»â€”â€”CPUç±» private CPU cpu = null; // éœ€è¦çŸ¥é“è¦äº¤äº’çš„åŒäº‹ç±»â€”â€”æ˜¾å¡ç±» private VideoCard videoCard = null; // éœ€è¦çŸ¥é“è¦äº¤äº’çš„åŒäº‹ç±»â€”â€”å£°å¡ç±» private AudioCard audioCard = null; public void setCdDriver(CDDriver cdDriver) { this.cdDriver = cdDriver; } public void setCpu(CPU cpu) { this.cpu = cpu; } public void setVideoCard(VideoCard videoCard) { this.videoCard = videoCard; } public void setAudioCard(AudioCard audioCard) { this.audioCard = audioCard; } @Override public void changed(Colleague c) { if (c instanceof CDDriver) { // è¡¨ç¤ºå…‰é©±å·²ç»è¯»å–æ•°æ®äº† this.afterCDDriverReadData((CDDriver) c); } else if (c instanceof CPU) { // è¡¨ç¤ºCPUå·²ç»å¤„ç†æ•°æ®äº† this.afterCPUProcessData((CPU) c); } } /** * å…‰é©±è¯»å–æ•°æ®ä»¥åä¸å…¶ä»–å¯¹è±¡çš„äº¤äº’ */ private void afterCDDriverReadData(CDDriver cd) { // å…ˆè·å–å…‰é©±è¯»å–çš„æ•°æ® String data = cd.getData(); // æŠŠè¿™äº›æ•°æ®ä¼ é€’ç»™CPUè¿›è¡Œå¤„ç† cpu.processData(data); } /** * CPUå¤„ç†å®Œæ•°æ®åä¸å…¶ä»–å¯¹è±¡çš„äº¤äº’ */ private void afterCPUProcessData(CPU cpu) { // å…ˆè·å–CPUå¤„ç†åçš„æ•°æ® String videoData = cpu.getVideoData(); String audioData = cpu.getAudioData(); // æŠŠè¿™äº›æ•°æ®ä¼ é€’ç»™æ˜¾å¡å’Œå£°å¡å±•ç¤ºå‡ºæ¥ videoCard.display(videoData); audioCard.play(audioData); } } å¤§åŠŸå‘Šæˆï¼Œåœ¨å®¢æˆ·ç«¯ä¸­æµ‹è¯•ä¸€ä¸‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // åˆ›å»ºä¸­ä»‹è€…â€”â€”ä¸»æ¿ MainBoard mediator = new MainBoard(); // åˆ›å»ºåŒäº‹ç±» CDDriver cdDriver = new CDDriver(mediator); CPU cpu = new CPU(mediator); VideoCard videoCard = new VideoCard(mediator); AudioCard audioCard = new AudioCard(mediator); // è®©ä¸­ä»‹è€…çŸ¥é“æ‰€æœ‰åŒäº‹ mediator.setCdDriver(cdDriver); mediator.setCpu(cpu); mediator.setVideoCard(videoCard); mediator.setAudioCard(audioCard); // å¼€å§‹çœ‹ç”µå½±ï¼ŒæŠŠå…‰ç›˜æ”¾å…¥å…‰é©±ï¼Œå…‰é©±å¼€å§‹è¯»ç›˜ cdDriver.readCD(&quot;ä¸œäº¬çƒ­,çœŸçš„å¥½çƒ­ï¼&quot;); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ‚¨æ­£åœ¨è§‚çœ‹çš„æ˜¯ï¼šä¸œäº¬çƒ­ç”»å¤–éŸ³ï¼šçœŸçš„å¥½çƒ­ï¼ å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œå¯¹äºå…‰é©±å¯¹è±¡ã€CPUå¯¹è±¡ã€æ˜¾å¡å¯¹è±¡å’Œå£°å¡å¯¹è±¡ï¼Œéœ€è¦ç›¸äº’äº¤äº’ï¼Œè™½ç„¶åªæ˜¯ç®€å•æ¼”ç¤ºï¼Œä½†æ˜¯ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œå®ƒä»¬çš„äº¤äº’æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œäºæ˜¯å®šä¹‰ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡â€”-ä¸»æ¿å¯¹è±¡ï¼Œæ¥ç»´æŠ¤å®ƒä»¬ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œä»è€Œä½¿å¾—è¿™äº›å¯¹è±¡æ¾æ•£è€¦åˆã€‚å¦‚æœè¿™ä¸ªæ—¶å€™éœ€è¦ä¿®æ”¹å®ƒä»¬çš„äº¤äº’å…³ç³»ï¼Œç›´æ¥åˆ°ä¸­ä»‹è€…é‡Œé¢ä¿®æ”¹å°±å¥½äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„å…³ç³»å·²ç»ç‹¬ç«‹å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢äº†ï¼Œå¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œè€Œä¸ç”¨å»ä¿®æ”¹è¿™äº›åŒäº‹å¯¹è±¡ã€‚ å››ã€å¹¿ä¹‰ä¸­ä»‹è€…åœ¨å®é™…åº”ç”¨å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨ç®€åŒ–ç‰ˆçš„ä¸­ä»‹è€…æ¨¡å¼è¿›è¡Œå¼€å‘ï¼Œè¢«ç§°ä¸ºå¹¿ä¹‰ä¸­ä»‹è€…ï¼Œå¸¸æœ‰å¦‚ä¸‹ç®€åŒ–: é€šå¸¸ä¼šå»æ‰åŒäº‹å¯¹è±¡çš„çˆ¶ç±»ï¼Œè¿™æ ·å¯ä»¥è®©ä»»æ„çš„å¯¹è±¡ï¼Œåªè¦éœ€è¦ç›¸äº’äº¤äº’ï¼Œå°±å¯ä»¥æˆä¸ºåŒäº‹ã€‚ é€šå¸¸ä¸å®šä¹‰Mediatoræ¥å£ï¼ŒæŠŠå…·ä½“çš„ä¸­ä»‹è€…å¯¹è±¡å®ç°æˆä¸ºå•ä¾‹ã€‚ åŒäº‹å¯¹è±¡ä¸å†æŒæœ‰ä¸­ä»‹è€…ï¼Œè€Œæ˜¯åœ¨éœ€è¦çš„æ—¶å€™ç›´æ¥è·å–ä¸­ä»‹è€…å¯¹è±¡å¹¶è°ƒç”¨ï¼›ä¸­ä»‹è€…ä¹Ÿä¸å†æŒæœ‰åŒäº‹å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨å…·ä½“å¤„ç†æ–¹æ³•é‡Œé¢å»åˆ›å»ºï¼Œæˆ–è€…è·å–ï¼Œæˆ–è€…ä»å‚æ•°ä¼ å…¥éœ€è¦çš„åŒäº‹å¯¹è±¡ã€‚ äº”ã€ä¸­ä»‹è€…æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼çš„ä¼˜ç‚¹ï¼š æ¾æ•£è€¦åˆä¸­ä»‹è€…æ¨¡å¼é€šè¿‡æŠŠå¤šä¸ªåŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢ï¼Œä»è€Œä½¿å¾—åŒäº‹å¯¹è±¡ä¹‹é—´æ¾æ•£è€¦åˆï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åšåˆ°äº’è¡¥ä¾èµ–ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŒäº‹å¯¹è±¡å°±å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–å’Œå¤ç”¨ï¼Œè€Œä¸å†åƒä»¥å‰é‚£æ ·â€œç‰µä¸€å¤„è€ŒåŠ¨å…¨èº«â€äº†ã€‚ é›†ä¸­æ§åˆ¶äº¤äº’å¤šä¸ªåŒäº‹å¯¹è±¡çš„äº¤äº’ï¼Œè¢«å°è£…åœ¨ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢é›†ä¸­ç®¡ç†ï¼Œä½¿å¾—è¿™äº›äº¤äº’è¡Œä¸ºå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿®æ”¹ä¸­ä»‹è€…å¯¹è±¡å°±å¯ä»¥äº†ï¼Œå½“ç„¶å¦‚æœæ˜¯å·²ç»åšå¥½çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆå°±æ‰©å±•ä¸­ä»‹è€…å¯¹è±¡ï¼Œè€Œå„ä¸ªåŒäº‹ç±»ä¸éœ€è¦åšä¿®æ”¹ã€‚ å¤šå¯¹å¤šå˜æˆä¸€å¯¹å¤šæ²¡æœ‰ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼çš„æ—¶å€™ï¼ŒåŒäº‹å¯¹è±¡ä¹‹é—´çš„å…³ç³»é€šå¸¸æ˜¯å¤šå¯¹å¤šçš„ï¼Œå¼•å…¥ä¸­ä»‹è€…å¯¹è±¡ä»¥åï¼Œä¸­ä»‹è€…å¯¹è±¡å’ŒåŒäº‹å¯¹è±¡çš„å…³ç³»é€šå¸¸å˜æˆåŒå‘çš„ä¸€å¯¹å¤šï¼Œè¿™ä¼šè®©å¯¹è±¡çš„å…³ç³»æ›´å®¹æ˜“ç†è§£å’Œå®ç°ã€‚ ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼çš„ç¼ºç‚¹ï¼š ä¸­ä»‹è€…æ¨¡å¼çš„ä¸€ä¸ªæ½œåœ¨ç¼ºç‚¹æ˜¯ï¼Œè¿‡åº¦é›†ä¸­åŒ–ã€‚å¦‚æœåŒäº‹å¯¹è±¡çš„äº¤äº’éå¸¸å¤šï¼Œè€Œä¸”æ¯”è¾ƒå¤æ‚ï¼Œå½“è¿™äº›å¤æ‚æ€§å…¨éƒ¨é›†ä¸­åˆ°ä¸­ä»‹è€…çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´ä¸­ä»‹è€…å¯¹è±¡å˜å¾—ååˆ†å¤æ‚ï¼Œè€Œä¸”éš¾äºç®¡ç†å’Œç»´æŠ¤ã€‚ å…­ã€ä¸­ä»‹è€…æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼š å¦‚æœä¸€ç»„å¯¹è±¡ä¹‹é—´çš„é€šä¿¡æ–¹å¼æ¯”è¾ƒå¤æ‚ï¼Œå¯¼è‡´ç›¸äº’ä¾èµ–ã€ç»“æ„æ··ä¹±ï¼Œå¯ä»¥é‡‡ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼ŒæŠŠè¿™äº›å¯¹è±¡ç›¸äº’çš„äº¤äº’ç®¡ç†èµ·æ¥ï¼Œå„ä¸ªå¯¹è±¡éƒ½åªéœ€è¦å’Œä¸­ä»‹è€…äº¤äº’ï¼Œä»è€Œä½¿å¾—å„ä¸ªå¯¹è±¡æ¾æ•£è€¦åˆï¼Œç»“æ„ä¹Ÿæ›´æ¸…æ™°æ˜“æ‡‚ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡å¼•ç”¨å¾ˆå¤šçš„å¯¹è±¡ï¼Œå¹¶ç›´æ¥è·Ÿè¿™äº›å¯¹è±¡äº¤äº’ï¼Œå¯¼è‡´éš¾ä»¥å¤ç”¨è¯¥å¯¹è±¡ï¼Œå¯ä»¥é‡‡ç”¨ä¸­ä»‹è€…æ¨¡å¼ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡è·Ÿå…¶ä»–å¯¹è±¡çš„äº¤äº’å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢ï¼Œè¿™ä¸ªå¯¹è±¡åªéœ€è¦å’Œä¸­ä»‹è€…å¯¹è±¡äº¤äº’å°±å¯ä»¥äº†ã€‚ ä¸ƒã€æ€»ç»“ä¸­ä»‹è€…æ¨¡å¼é€šè¿‡å¼•å…¥ä¸€ä¸ªä¸­ä»‹å¯¹è±¡ï¼Œè®©å…¶ä»–çš„å¯¹è±¡éƒ½åªå’Œä¸­ä»‹å¯¹è±¡äº¤äº’ï¼Œè€Œä¸­ä»‹å¯¹è±¡çŸ¥é“å¦‚ä½•å’Œå…¶ä»–æ‰€æœ‰çš„å¯¹è±¡äº¤äº’ï¼Œè¿™æ ·å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»å°±æ²¡æœ‰äº†ï¼Œä»è€Œå®ç°äº†å¯¹è±¡ä¹‹é—´çš„è§£è€¦ã€‚ å¯¹äºä¸­ä»‹å¯¹è±¡è€Œè¨€ï¼Œæ‰€æœ‰ç›¸äº’äº¤äº’çš„å¯¹è±¡ï¼Œè¢«è§†ä¸ºåŒäº‹ç±»ï¼Œä¸­ä»‹å¯¹è±¡å°±æ˜¯æ¥ç»´æŠ¤å„ä¸ªåŒäº‹ä¹‹é—´çš„å…³ç³»ï¼Œè€Œæ‰€æœ‰çš„åŒäº‹ç±»éƒ½åªæ˜¯å’Œä¸­ä»‹å¯¹è±¡äº¤äº’ã€‚ æ¯ä¸ªåŒäº‹å¯¹è±¡ï¼Œå½“è‡ªå·±å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¸éœ€è¦çŸ¥é“è¿™ä¼šå¼•èµ·å…¶ä»–å¯¹è±¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œå®ƒåªéœ€è¦é€šçŸ¥ä¸­ä»‹è€…å°±å¯ä»¥äº†ï¼Œç„¶åç”±ä¸­ä»‹è€…å»ä¸å…¶ä»–å¯¹è±¡äº¤äº’ã€‚è¿™æ ·æ¾æ•£è€¦åˆå¸¦æ¥çš„å¥½å¤„æ˜¯ï¼Œé™¤äº†è®©åŒäº‹å¯¹è±¡ä¹‹é—´ç›¸äº’æ²¡æœ‰å…³è”å¤–ï¼Œè¿˜æœ‰åˆ©äºåŠŸèƒ½çš„ä¿®æ”¹å’Œæ‰©å±•ã€‚ æœ‰äº†ä¸­ä»‹è€…ä»¥åï¼Œæ‰€æœ‰çš„äº¤äº’éƒ½å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢ï¼Œå„ä¸ªå¯¹è±¡å°±ä¸å†éœ€è¦ç»´æŠ¤è¿™äº›å…³ç³»äº†ã€‚æ‰©å±•å…³ç³»çš„æ—¶å€™ä¹Ÿåªéœ€è¦æ‰©å±•æˆ–ä¿®æ”¹ä¸­ä»‹è€…å¯¹è±¡å°±å¯ä»¥äº†ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"ä¸­ä»‹è€…æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"ä¸­ä»‹è€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/ä¸­ä»‹è€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--å‘½ä»¤æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--å‘½ä»¤æ¨¡å¼","date":"2020-05-24T09:00:17.000Z","updated":"2023-04-30T10:21:41.357Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å‘½ä»¤æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å‘½ä»¤æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯å‘½ä»¤æ¨¡å¼å‘½ä»¤(Command)æ¨¡å¼åˆå«ä½œåŠ¨ä½œ(Action)æ¨¡å¼æˆ–äº‹åŠ¡(Transaction)æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ä½ å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤æ¶ˆçš„æ“ä½œã€‚ å‘½ä»¤æ¨¡å¼çš„æœ¬è´¨ï¼šå°è£…è¯·æ±‚ è®¾è®¡æ„å›¾ï¼šå‘½ä»¤æ¨¡å¼é€šè¿‡å°†è¯·æ±‚å°è£…åˆ°ä¸€ä¸ªå‘½ä»¤(Command)å¯¹è±¡ä¸­ï¼Œå®ç°äº†è¯·æ±‚è°ƒç”¨è€…å’Œå…·ä½“å®ç°è€…ä¹‹é—´çš„è§£è€¦ã€‚ äºŒã€å‘½ä»¤æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼š å¦‚æœéœ€è¦æŠ½è±¡å‡ºéœ€è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œå¹¶å‚æ•°åŒ–è¿™äº›å¯¹è±¡ï¼Œå¯ä»¥é€‰ç”¨å‘½ä»¤æ¨¡å¼ã€‚å°†è¿™äº›éœ€è¦æ‰§è¡Œçš„åŠ¨ä½œæŠ½è±¡æˆä¸ºå‘½ä»¤ï¼Œç„¶åå®ç°å‘½ä»¤çš„å‚æ•°åŒ–é…ç½®ã€‚ å¦‚æœéœ€è¦åœ¨ä¸åŒçš„æ—¶åˆ»æŒ‡å®šã€æ’åˆ—å’Œæ‰§è¡Œè¯·æ±‚ï¼Œå¯ä»¥é€‰ç”¨å‘½ä»¤æ¨¡å¼ã€‚å°†è¿™äº›è¯·æ±‚å°è£…æˆä¸ºå‘½ä»¤å¯¹è±¡ï¼Œç„¶åå®ç°å°†è¯·æ±‚é˜Ÿåˆ—åŒ–ã€‚ å¦‚æœéœ€è¦æ”¯æŒå–æ¶ˆæ“ä½œï¼Œå¯ä»¥é€‰ç”¨å‘½ä»¤æ¨¡å¼ï¼Œé€šè¿‡ç®¡ç†å‘½ä»¤å¯¹è±¡ï¼Œèƒ½å¾ˆå®¹æ˜“åœ°å®ç°å‘½ä»¤çš„æ¢å¤å’Œé‡åšåŠŸèƒ½ã€‚ å¦‚æœéœ€è¦æ”¯æŒå½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œèƒ½å°†ç³»ç»Ÿçš„æ“ä½œåŠŸèƒ½é‡æ–°æ‰§è¡Œä¸€éï¼Œå¯ä»¥é€‰ç”¨å‘½ä»¤æ¨¡å¼ã€‚å°†è¿™äº›æ“ä½œåŠŸèƒ½çš„è¯·æ±‚å°è£…æˆå‘½ä»¤å¯¹è±¡ï¼Œç„¶åå®ç°æ—¥å¿—å‘½ä»¤ï¼Œå°±å¯ä»¥åœ¨ç³»ç»Ÿæ¢å¤ä»¥åï¼Œé€šè¿‡æ—¥å¿—è·å–å‘½ä»¤åˆ—è¡¨ï¼Œä»è€Œé‡æ–°æ‰§è¡Œä¸€éåŠŸèƒ½ã€‚ åœ¨éœ€è¦äº‹åŠ¡çš„ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€‰ç”¨å‘½ä»¤æ¨¡å¼ã€‚å‘½ä»¤æ¨¡å¼æä¾›äº†å¯¹äº‹åŠ¡è¿›è¡Œå»ºæ¨¡çš„æ–¹æ³•ã€‚å‘½ä»¤æ¨¡å¼æœ‰ä¸€ä¸ªåˆ«åå°±æ˜¯Transactionã€‚ ä¸‰ã€å‘½ä»¤æ¨¡å¼çš„ç»“æ„ å‘½ä»¤æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡å‘½ä»¤(Command)è§’è‰²ï¼šä¸€èˆ¬å®šä¹‰ä¸ºæ¥å£ï¼Œç”¨æ¥å®šä¹‰æ‰§è¡Œå‘½ä»¤çš„æ¥å£ã€‚ å…·ä½“å‘½ä»¤(ConcreteCommand)è§’è‰²ï¼šé€šå¸¸ä¼šæŒæœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶è°ƒç”¨æ¥æ”¶è€…å¯¹è±¡çš„ç›¸åº”åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚ æ¥æ”¶è€…(Receiver)è§’è‰²ï¼šçœŸæ­£æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ã€‚ä»»ä½•ç±»éƒ½å¯èƒ½æˆä¸ºæ¥æ”¶è€…ï¼Œåªè¦å®ƒèƒ½å¤Ÿå®ç°å‘½ä»¤è¦æ±‚å®ç°çš„ç›¸åº”åŠŸèƒ½ã€‚ è°ƒç”¨è€…(Invoker)è§’è‰²ï¼šè¦æ±‚å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œé€šå¸¸ä¼šæŒæœ‰å‘½ä»¤å¯¹è±¡ï¼Œå¯ä»¥æŒæœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ã€‚è¿™ä¸ªæ˜¯å®¢æˆ·ç«¯çœŸæ­£è§¦å‘å‘½ä»¤å¹¶è¦æ±‚å‘½ä»¤æ‰§è¡Œç›¸åº”æ“ä½œçš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´ç›¸å½“äºä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å…¥å£ã€‚ å®¢æˆ·ç«¯(Client)è§’è‰²ï¼šåˆ›å»ºå…·ä½“çš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®å‘½ä»¤å¯¹è±¡çš„æ¥æ”¶è€…ã€‚ å‘½ä»¤æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šå…ˆæ¥çœ‹çœ‹æŠ½è±¡å‘½ä»¤æ¥å£çš„å®šä¹‰ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * å‘½ä»¤æ¥å£ */ public interface Command { /** * æ‰§è¡Œå‘½ä»¤ */ public void execute(); } æ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“å‘½ä»¤æ˜¯å¦‚ä½•å®ç°çš„ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * å…·ä½“çš„å‘½ä»¤å®ç° */ public class ConcreteCommand implements Command { /** * æŒæœ‰ç›¸åº”çš„æ¥æ”¶è€…å¯¹è±¡ */ private Receiver receiver = null; /** * æ„é€ æ–¹æ³•ï¼Œä¼ å…¥ç›¸åº”çš„æ¥æ”¶è€…å¯¹è±¡ * * @param receiver ç›¸åº”çš„æ¥æ”¶è€…å¯¹è±¡ */ public ConcreteCommand(Receiver receiver) { this.receiver = receiver; } /** * æ‰§è¡Œå‘½ä»¤ */ @Override public void execute() { // é€šå¸¸ä¼šè½¬è°ƒæ¥æ”¶è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³•ï¼Œè®©æ¥æ”¶è€…æ¥çœŸæ­£æ‰§è¡ŒåŠŸèƒ½ receiver.action(); } } å†æ¥çœ‹çœ‹æ¥æ”¶è€…çš„å®šä¹‰ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * å‘½ä»¤çš„æ¥æ”¶è€… */ public class Receiver { /** * ç¤ºæ„æ–¹æ³•ï¼ŒçœŸæ­£æ‰§è¡Œå‘½ä»¤ç›¸åº”çš„æ“ä½œ */ public void action() { System.out.println(&quot;æ¥æ”¶è€…å¼€å§‹è¡ŒåŠ¨ã€‚ã€‚ã€‚&quot;); } } ä¸‹é¢è¯¥æ¥çœ‹çœ‹è°ƒç”¨è€…å¦‚ä½•å®ç°çš„äº†ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * å‘½ä»¤çš„è°ƒç”¨è€… */ public class Invoker { /** * æŒæœ‰å‘½ä»¤å¯¹è±¡ */ private Command command = null; /** * è®¾ç½®è°ƒç”¨è€…æŒæœ‰çš„å‘½ä»¤å¯¹è±¡ * * @param command å‘½ä»¤å¯¹è±¡ */ public void setCommand(Command command) { this.command = command; } /** * ç¤ºæ„æ–¹æ³•ï¼Œè°ƒç”¨å‘½ä»¤æ‰§è¡Œè¯·æ±‚ */ public void invoke() { command.execute(); } } å†æ¥çœ‹çœ‹å®¢æˆ·ç«¯çš„å®ç°ã€‚ public class Client { public static void main(String[] args) { // åˆ›å»ºæ¥æ”¶è€… Receiver receiver = new Receiver(); // åˆ›å»ºå‘½ä»¤å¯¹è±¡ï¼Œè®¾å®šå®ƒçš„æ¥æ”¶è€… Command command = new ConcreteCommand(receiver); // åˆ›å»ºè°ƒç”¨è€…ï¼ŒæŠŠå‘½ä»¤å¯¹è±¡è®¾ç½®è¿›å» Invoker invoker = new Invoker(); invoker.setCommand(command); // è°ƒç”¨è€…è°ƒç”¨å‘½ä»¤ invoker.invoke(); } } å››ã€å‘½ä»¤æ¨¡å¼çš„ä¼˜ç‚¹ æ›´æ¾æ•£çš„è€¦åˆå‘½ä»¤æ¨¡å¼ä½¿å¾—å‘èµ·å‘½ä»¤çš„å¯¹è±¡â€”â€”å®¢æˆ·ç«¯ï¼Œå’Œå…·ä½“å®ç°å‘½ä»¤çš„å¯¹è±¡â€”â€”æ¥æ”¶è€…å¯¹è±¡å®Œå…¨è§£è€¦ï¼Œä¹Ÿå°±æ˜¯è¯´å‘èµ·å‘½ä»¤çš„å¯¹è±¡å®Œå…¨ä¸çŸ¥é“å…·ä½“å®ç°å¯¹è±¡æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•å®ç°ã€‚ æ›´åŠ¨æ€çš„æ§åˆ¶å‘½ä»¤æ¨¡å¼æŠŠè¯·æ±‚å°è£…èµ·æ¥ï¼Œå¯ä»¥åŠ¨æ€åœ°å¯¹å®ƒè¿›è¡Œå‚æ•°åŒ–ã€é˜Ÿåˆ—åŒ–å’Œæ—¥å¿—åŒ–ç­‰æ“ä½œï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿæ›´çµæ´»ã€‚ å¾ˆè‡ªç„¶çš„å¤åˆå‘½ä»¤å‘½ä»¤æ¨¡å¼ä¸­çš„å‘½ä»¤å¯¹è±¡èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°ç»„åˆæˆå¤åˆå‘½ä»¤ï¼Œå¦‚å®å‘½ä»¤ï¼Œä»è€Œä½¿ç³»ç»Ÿæ“ä½œæ›´ç®€å•ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚ æ›´å¥½çš„æ‰©å±•æ€§ç”±äºå‘èµ·å‘½ä»¤çš„å¯¹è±¡å’Œå…·ä½“çš„å®ç°å®Œå…¨è§£è€¦ï¼Œå› æ­¤æ‰©å±•æ–°çš„å‘½ä»¤å°±å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦å®ç°æ–°çš„å‘½ä»¤å¯¹è±¡ï¼Œç„¶ååœ¨è£…é…çš„æ—¶å€™ï¼ŒæŠŠå…·ä½“çš„å®ç°å¯¹è±¡è®¾ç½®åˆ°å‘½ä»¤å¯¹è±¡ä¸­ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯¹è±¡ï¼Œå·²æœ‰çš„å®ç°å®Œå…¨ä¸ç”¨å˜åŒ–ã€‚ äº”ã€è®¤è¯†å‘½ä»¤æ¨¡å¼ å‚æ•°åŒ–é…ç½® æ‰€è°“å‘½ä»¤æ¨¡å¼çš„å‚æ•°åŒ–é…ç½®ï¼ŒæŒ‡çš„æ˜¯ï¼šå¯ä»¥ç”¨ä¸åŒçš„å‘½ä»¤å¯¹è±¡ï¼Œå»å‚æ•°åŒ–é…ç½®å®¢æˆ·çš„è¯·æ±‚ã€‚å³ï¼šå¯¹äºInvokerçš„åŒä¸€ä¸ªè¯·æ±‚ï¼Œä¸ºå…¶é…ç½®ä¸åŒçš„Commandå¯¹è±¡ï¼Œå°±ä¼šæ‰§è¡Œä¸åŒçš„åŠŸèƒ½ã€‚ å¯æ’¤é”€çš„æ“ä½œ å¯æ’¤é”€æ“ä½œçš„æ„æ€å°±æ˜¯ï¼šæ”¾å¼ƒè¯¥æ“ä½œï¼Œå›åˆ°æœªæ‰§è¡Œè¯¥æ“ä½œå‰çš„çŠ¶æ€ã€‚æœ‰ä¸¤ç§åŸºæœ¬çš„æ€è·¯æ¥å®ç°å¯æ’¤é”€çš„æ“ä½œï¼Œä¸€ç§æ˜¯è¡¥å¿å¼ï¼Œåˆç§°åæ“ä½œå¼ï¼Œæ¯”å¦‚è¦æ’¤é”€çš„æ“ä½œæ˜¯åŠ çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ç›¸åçš„æ“ä½œå³å‡çš„åŠŸèƒ½å»å®ç°ï¼Œæ’¤é”€åŠ å¤šå°‘å°±å‡å¤šå°‘ã€‚ä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯ä»¥å®ç°è¡¥å¿å¼çš„å¯æ’¤é”€æ“ä½œï¼Œé¦–å…ˆéœ€è¦æŠŠæ“ä½œè¿‡çš„å‘½ä»¤è®°å½•ä¸‹æ¥ï¼Œå½¢æˆå‘½ä»¤çš„å†å²åˆ—è¡¨ï¼Œæ’¤é”€çš„æ—¶å€™å°±ä»æœ€åä¸€ä¸ªå¼€å§‹æ‰§è¡Œæ’¤é”€ã€‚åŒæ ·çš„æ–¹å¼ï¼Œè¿˜å¯ä»¥å®ç°æ¢å¤çš„åŠŸèƒ½ã€‚å¦å¤–ä¸€ç§å®ç°å¯æ’¤é”€æ“ä½œçš„æ–¹å¼æ˜¯å­˜å‚¨æ¢å¤å¼ï¼Œæ„æ€å°±æ˜¯æŠŠæ“ä½œå‰çš„çŠ¶æ€è®°å½•ä¸‹æ¥ï¼Œç„¶åè¦æ’¤é”€æ“ä½œçš„æ—¶å€™å°±ç›´æ¥æ¢å¤å›å»å°±å¯ä»¥äº†ï¼ˆå¯ä»¥ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼å®ç°ï¼‰ã€‚ å®å‘½ä»¤ ä»€ä¹ˆæ˜¯å®å‘½ä»¤å‘¢ï¼Ÿç®€å•ç‚¹è¯´å°±æ˜¯åŒ…å«å¤šä¸ªå‘½ä»¤çš„å‘½ä»¤ï¼Œæ˜¯ä¸€ä¸ªå‘½ä»¤çš„ç»„åˆã€‚ä»¥å»é¥­åº—åƒé¥­ä¸ºä¾‹ï¼Œä¸€èˆ¬çš„æµç¨‹éƒ½æ˜¯ï¼šé€‰åº§ä½â€“&gt;ç‚¹èœâ€“&gt;ä¸Šèœâ€“&gt;äº«ç”¨ç¾é£Ÿâ€“&gt;ç»“è´¦ï¼Œå¦‚æœå°†è¿™å‡ ä¸ªæ­¥éª¤ä¸­æ¶‰åŠçš„å‘½ä»¤æ‰“åŒ…ä¸€èµ·æ‰§è¡Œçš„è¯ï¼Œå°±å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå®å‘½ä»¤ã€‚ é˜Ÿåˆ—è¯·æ±‚ æ‰€è°“é˜Ÿåˆ—è¯·æ±‚ï¼Œå°±æ˜¯å¯¹å‘½ä»¤å¯¹è±¡è¿›è¡Œæ’é˜Ÿï¼Œç»„æˆå‘½ä»¤é˜Ÿåˆ—ï¼Œç„¶åä¾æ¬¡å–å‡ºå‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œã€‚è¿˜æ˜¯ä»¥å»é¥­åº—åƒé¥­ä¸ºä¾‹ï¼Œå·²ç»ç‚¹èœçš„é¡¾å®¢å¯èƒ½æœ‰å¾ˆå¤šäººï¼Œç‚¹çš„æ¯ä¸€é“èœéƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€æ¡å‘½ä»¤ï¼ˆéœ€è¦å¨å¸ˆå»åšèœï¼ŒæœåŠ¡å‘˜ä¸Šèœï¼‰ï¼Œè¿™äº›è¢«ç‚¹çš„èœå°±æ„æˆäº†ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—ã€‚å¨å¸ˆä¸€èˆ¬éƒ½ä¼šæŒ‰ç…§ç‚¹èœçš„å…ˆåé¡ºåºå»åšèœï¼Œè°çš„èœå…ˆç‚¹ï¼Œå°±å…ˆåšè°çš„ã€‚ æ—¥å¿—è¯·æ±‚ æ‰€è°“æ—¥å¿—è¯·æ±‚ï¼Œå°±æ˜¯æŠŠè¯·æ±‚çš„å†å²çºªå½•ä¿å­˜ä¸‹æ¥ï¼Œä¸€èˆ¬æ˜¯é‡‡ç”¨æ°¸ä¹…å­˜å‚¨çš„æ–¹å¼ã€‚å¦‚æœåœ¨è¿è¡Œè¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå´©æºƒäº†ï¼Œé‚£ä¹ˆå½“ç³»ç»Ÿå†æ¬¡è¿è¡Œæ—¶ï¼Œå°±å¯ä»¥ä»ä¿å­˜çš„å†å²è®°å½•ä¸­è·å–æ—¥å¿—è¯·æ±‚ï¼Œå¹¶é‡æ–°æ‰§è¡Œå‘½ä»¤ã€‚æ—¥å¿—è¯·æ±‚çš„å®ç°æœ‰ä¸¤ç§æ–¹æ¡ˆï¼šä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨Javaä¸­çš„åºåˆ—åŒ–æ–¹æ³•ï¼›å¦å¤–ä¸€ç§å°±æ˜¯åœ¨å‘½ä»¤å¯¹è±¡ä¸­æ·»åŠ ä¸Šå­˜å‚¨å’Œè£…è½½çš„æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯è®©å‘½ä»¤å¯¹è±¡è‡ªå·±å®ç°ç±»ä¼¼åºåˆ—åŒ–çš„åŠŸèƒ½ã€‚ å…­ã€æ€»ç»“å‘½ä»¤æ¨¡å¼æ˜¯å¯¹å‘½ä»¤çš„å°è£…ã€‚å‘½ä»¤æ¨¡å¼æŠŠå‘å‡ºå‘½ä»¤çš„è´£ä»»å’Œæ‰§è¡Œå‘½ä»¤çš„è´£ä»»åˆ†å‰²å¼€ï¼Œå§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡ã€‚ æ¯ä¸€ä¸ªå‘½ä»¤éƒ½æ˜¯ä¸€ä¸ªæ“ä½œï¼šè¯·æ±‚çš„ä¸€æ–¹å‘å‡ºè¯·æ±‚è¦æ±‚æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼›æ¥æ”¶çš„ä¸€æ–¹æ”¶åˆ°è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ“ä½œã€‚å‘½ä»¤æ¨¡å¼å…è®¸è¯·æ±‚çš„ä¸€æ–¹å’Œæ¥æ”¶çš„ä¸€æ–¹ç‹¬ç«‹å¼€æ¥ï¼Œä½¿å¾—è¯·æ±‚çš„ä¸€æ–¹ä¸å¿…çŸ¥é“æ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹çš„æ¥å£ï¼Œæ›´ä¸å¿…çŸ¥é“è¯·æ±‚æ˜¯æ€ä¹ˆè¢«æ¥æ”¶ï¼Œä»¥åŠæ“ä½œæ˜¯å¦è¢«æ‰§è¡Œã€ä½•æ—¶è¢«æ‰§è¡Œï¼Œä»¥åŠæ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å‘½ä»¤æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å‘½ä»¤æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å‘½ä»¤æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--è¿­ä»£å™¨æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--è¿­ä»£å™¨æ¨¡å¼","date":"2020-05-24T08:59:16.000Z","updated":"2023-04-30T10:21:41.363Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è¿­ä»£å™¨æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è¿­ä»£å™¨æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯è¿­ä»£å™¨æ¨¡å¼è¿­ä»£å™¨(Iterator)æ¨¡å¼åˆå«ä½œæ¸¸æ ‡(Cursor)æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆï¼ˆæŒ‡ä¸€ç»„å¯¹è±¡çš„ç»„åˆç»“æ„ï¼Œå¦‚ï¼šJavaä¸­çš„é›†åˆã€æ•°ç»„ç­‰ï¼‰å¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚ è¿­ä»£å™¨æ¨¡å¼çš„æœ¬è´¨ï¼šæ§åˆ¶è®¿é—®èšåˆå¯¹è±¡ä¸­çš„å…ƒç´  è®¾è®¡æ„å›¾ï¼šæ— é¡»æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨å®ç°ï¼Œå°±èƒ½å¤Ÿè®¿é—®åˆ°èšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ã€‚ äºŒã€è¿­ä»£å™¨æ¨¡å¼çš„ç»“æ„ è¿­ä»£å™¨æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡è¿­ä»£å™¨(Iterator)è§’è‰²ï¼šä¸€èˆ¬å®šä¹‰ä¸ºæ¥å£ï¼Œç”¨æ¥å®šä¹‰è®¿é—®å’Œéå†å…ƒç´ çš„æ¥å£ã€‚ å…·ä½“è¿­ä»£å™¨(ConcreteIterator)è§’è‰²ï¼šå®ç°å¯¹èšåˆå¯¹è±¡çš„éå†ï¼Œå¹¶è·Ÿè¸ªéå†æ—¶çš„å½“å‰ä½ç½®ã€‚ æŠ½è±¡èšåˆ(Aggregate)è§’è‰²ï¼šå®šä¹‰åˆ›å»ºç›¸åº”è¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚ å…·ä½“èšåˆ(ConcreteAggregate)è§’è‰²ï¼šå®ç°åˆ›å»ºç›¸åº”çš„è¿­ä»£å™¨å¯¹è±¡ã€‚ è¿­ä»£å™¨æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šå…ˆæ¥çœ‹çœ‹æŠ½è±¡è¿­ä»£å™¨æ¥å£çš„å®šä¹‰ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * è¿­ä»£å™¨æ¥å£ï¼Œå®šä¹‰è®¿é—®å’Œéå†å…ƒç´ çš„æ“ä½œ */ public interface Iterator { /** * ç§»åŠ¨åˆ°èšåˆå¯¹è±¡ä¸­ç¬¬ä¸€ä¸ªå…ƒç´  */ public void first(); /** * ç§»åŠ¨åˆ°èšåˆå¯¹è±¡ä¸­ä¸‹ä¸€ä¸ªå…ƒç´  */ public void next(); /** * åˆ¤æ–­æ˜¯å¦å·²ç»ç§»åŠ¨åˆ°èšåˆå¯¹è±¡çš„æœ€åä¸€ä¸ªå…ƒç´  */ public boolean isDone(); /** * è·å–è¿­ä»£çš„å½“å‰å…ƒç´  */ public Object currentItem(); } æ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“è¿­ä»£å™¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * å…·ä½“çš„è¿­ä»£å™¨å®ç°ç±»ï¼Œä¸åŒçš„èšåˆå¯¹è±¡æ‰€å¯¹åº”çš„è¿­ä»£å™¨å®ç°æ˜¯ä¸ä¸€æ ·çš„ ä»¥ä¸‹ç¤ºæ„çš„æ˜¯æ•°ç»„èšåˆå¯¹è±¡çš„è¿­ä»£å™¨ */ public class ConcreteIterator implements Iterator { /** * æŒæœ‰è¢«è¿­ä»£çš„å…·ä½“çš„èšåˆå¯¹è±¡ */ private ConcreteAggregate aggregate; /** * å†…éƒ¨ç´¢å¼•ï¼Œè®°å½•å½“å‰è¿­ä»£åˆ°çš„ä½ç½® */ private int index = -1; /** * æ„é€ æ–¹æ³•ï¼Œä¼ å…¥è¢«è¿­ä»£çš„å…·ä½“çš„èšåˆå¯¹è±¡ * * @param aggregate è¢«è¿­ä»£çš„å…·ä½“çš„èšåˆå¯¹è±¡ */ public ConcreteIterator(ConcreteAggregate aggregate) { this.aggregate = aggregate; } /** * ç§»åŠ¨åˆ°èšåˆå¯¹è±¡ä¸­ç¬¬ä¸€ä¸ªå…ƒç´  */ @Override public void first() { index = 0; } /** * ç§»åŠ¨åˆ°èšåˆå¯¹è±¡ä¸­ä¸‹ä¸€ä¸ªå…ƒç´  */ @Override public void next() { if (index &lt; this.aggregate.size()) { index += 1; } } /** * åˆ¤æ–­æ˜¯å¦å·²ç»ç§»åŠ¨åˆ°èšåˆå¯¹è±¡çš„æœ€åä¸€ä¸ªå…ƒç´  */ @Override public boolean isDone() { if (index == this.aggregate.size()) { return true; } return false; } /** * è·å–è¿­ä»£çš„å½“å‰å…ƒç´  */ @Override public Object currentItem() { return this.aggregate.get(index); } } å†æ¥çœ‹çœ‹æŠ½è±¡èšåˆç±»çš„å®šä¹‰ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * èšåˆå¯¹è±¡çš„æ¥å£ï¼Œå®šä¹‰åˆ›å»ºç›¸åº”çš„è¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ */ public abstract class Aggregate { /** * å·¥å‚æ–¹æ³•ï¼Œåˆ›å»ºç›¸åº”çš„è¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ */ public abstract Iterator createIterator(); } ä¸‹é¢è¯¥æ¥çœ‹çœ‹å…·ä½“èšåˆç±»æ˜¯å¦‚ä½•å®ç°çš„äº†ï¼Œè¿™é‡Œä»¥æ•°ç»„èšåˆå¯¹è±¡çš„è¿­ä»£å™¨å®ç°ä¸ºä¾‹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * å…·ä½“çš„èšåˆå¯¹è±¡ï¼Œå®ç°åˆ›å»ºç›¸åº”è¿­ä»£å™¨å¯¹è±¡çš„åŠŸèƒ½ * */ public class ConcreteAggregate extends Aggregate { /** * ç¤ºæ„ï¼Œè¡¨ç¤ºèšåˆå¯¹è±¡å…·ä½“çš„å†…å®¹ */ private String[] ss = null; /** * æ„é€ æ–¹æ³•ï¼Œä¼ å…¥èšåˆå¯¹è±¡å…·ä½“çš„å†…å®¹ * * @param ss èšåˆå¯¹è±¡å…·ä½“çš„å†…å®¹ */ public ConcreteAggregate(String[] ss) { super(); this.ss = ss; } /** * å·¥å‚æ–¹æ³•ï¼Œåˆ›å»ºç›¸åº”çš„è¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ */ @Override public Iterator createIterator() { // å®ç°åˆ›å»ºè¿­ä»£å™¨çš„å·¥å‚æ–¹æ³• return new ConcreteIterator(this); } /** * æ ¹æ®ç´¢å¼•ä½ç½®ï¼Œè·å–æ‰€å¯¹åº”çš„å…ƒç´  */ public Object get(int index) { Object retObj = null; if (index &lt; ss.length) { retObj = ss[index]; } return retObj; } /** * è·å–èšåˆå¯¹è±¡çš„å®¹é‡å¤§å° */ public int size() { return this.ss.length; } } åœ¨å®¢æˆ·ç«¯ä¸­æµ‹è¯•ä¸€ä¸‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Client { public void someOperation() { // åˆ›å»ºä¸€ä¸ªæ•°ç»„ String[] names = { &quot;å¼ ä¸‰&quot;, &quot;æå››&quot;, &quot;ç‹äº”&quot; }; // åˆ›å»ºèšåˆå¯¹è±¡ ConcreteAggregate aggregate = new ConcreteAggregate(names); // è·å–èšåˆå¯¹è±¡çš„è¿­ä»£å™¨ Iterator iterator = aggregate.createIterator(); // ç§»åŠ¨åˆ°èšåˆå¯¹è±¡ä¸­ç¬¬ä¸€ä¸ªå…ƒç´  iterator.first(); int index = 1; // å¾ªç¯è¾“å‡ºèšåˆå¯¹è±¡ä¸­çš„å€¼ while (!iterator.isDone()) { Object obj = iterator.currentItem(); System.out.println(&quot;èšåˆå¯¹è±¡ä¸­ç¬¬&quot; + (index++) + &quot;ä¸ªå…ƒç´ æ˜¯ï¼š&quot; + obj); iterator.next(); } } public static void main(String[] args) { Client client = new Client(); client.someOperation(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š èšåˆå¯¹è±¡ä¸­ç¬¬1ä¸ªå…ƒç´ æ˜¯ï¼šå¼ ä¸‰èšåˆå¯¹è±¡ä¸­ç¬¬2ä¸ªå…ƒç´ æ˜¯ï¼šæå››èšåˆå¯¹è±¡ä¸­ç¬¬3ä¸ªå…ƒç´ æ˜¯ï¼šç‹äº” ä»ä»¥ä¸Šç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œè¿­ä»£å™¨æ¨¡å¼ä¸ºå®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªç»Ÿä¸€è®¿é—®èšåˆå¯¹è±¡çš„æ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£å°±å¯ä»¥é¡ºåºåœ°è®¿é—®èšåˆå¯¹è±¡çš„å…ƒç´ ã€‚å¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œåªæ˜¯é¢å‘è¿™ä¸ªæ¥å£åœ¨è®¿é—®ï¼Œæ ¹æœ¬ä¸çŸ¥é“èšåˆå¯¹è±¡å†…éƒ¨çš„å®ç°ç»†èŠ‚ï¼ˆèšåˆå¯¹è±¡å¯ä»¥æ˜¯é›†åˆï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„ï¼Œå®¢æˆ·ç«¯æ— ä»å¾—çŸ¥ï¼‰ã€‚ ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼ï¼Œè¿˜å¯ä»¥å®ç°å¾ˆå¤šæ›´åŠ ä¸°å¯Œçš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼š ä»¥ä¸åŒçš„æ–¹å¼éå†èšåˆå¯¹è±¡ï¼Œæ¯”å¦‚å‘å‰ã€å‘åç­‰ã€‚ å¯¹åŒä¸€ä¸ªèšåˆåŒæ—¶è¿›è¡Œå¤šä¸ªéå†ã€‚ ä»¥ä¸åŒçš„éå†ç­–ç•¥æ¥éå†èšåˆï¼Œæ¯”å¦‚æ˜¯å¦éœ€è¦è¿‡æ»¤ç­‰ã€‚ å¤šæ€è¿­ä»£ï¼Œå«ä¹‰æ˜¯ï¼šä¸ºä¸åŒçš„èšåˆç»“æ„æä¾›ç»Ÿä¸€çš„è¿­ä»£æ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡ä¸€ä¸ªè¿­ä»£æ¥å£å¯ä»¥è®¿é—®ä¸åŒçš„èšåˆç»“æ„ã€‚ï¼ˆå¤šæ€è¿­ä»£å¯èƒ½ä¼šå¸¦æ¥ç±»å‹å®‰å…¨çš„é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ³›å‹ï¼‰ ä¸‰ã€ç¿»é¡µè¿­ä»£åœ¨å®é™…å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦ä¸€æ¬¡è¿­ä»£å¤šæ¡æ•°æ®çš„æƒ…å†µï¼Œæ¯”å¦‚å¸¸ç”¨çš„ç¿»é¡µåŠŸèƒ½ã€‚ç¿»é¡µåŠŸèƒ½æœ‰å¦‚ä¸‹å‡ ç§å®ç°æ–¹å¼ã€‚ ï¼ˆ1ï¼‰çº¯æ•°æ®åº“å®ç°ä¾é SQLæä¾›çš„åŠŸèƒ½å®ç°ç¿»é¡µï¼Œç”¨æˆ·æ¯æ¬¡è¯·æ±‚ç¿»é¡µçš„æ•°æ®ï¼Œå°±ä¼šåˆ°æ•°æ®åº“ä¸­è·å–ç›¸åº”çš„æ•°æ®ã€‚ ï¼ˆ2ï¼‰çº¯å†…å­˜å®ç°å°±æ˜¯ä¸€æ¬¡æ€§ä»æ•°æ®åº“ä¸­æŠŠéœ€è¦çš„æ‰€æœ‰æ•°æ®éƒ½å–å‡ºæ¥æ”¾åˆ°å†…å­˜ä¸­ï¼Œç„¶åç”¨æˆ·è¯·æ±‚ç¿»é¡µæ—¶ï¼Œä»å†…å­˜ä¸­è·å–ç›¸åº”çš„æ•°æ®ã€‚ ä¸¤ç§æ–¹æ¡ˆå„æœ‰ä¼˜ç¼ºç‚¹ï¼š ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜æ˜¾æ˜¯æ—¶é—´æ¢ç©ºé—´çš„ç­–ç•¥ï¼Œæ¯æ¬¡è·å–ç¿»é¡µçš„æ•°æ®éƒ½è¦è®¿é—®æ•°æ®åº“ï¼Œè¿è¡Œé€Ÿåº¦ç›¸å¯¹æ¯”è¾ƒæ…¢ï¼Œè€Œä¸”å¾ˆè€—æ•°æ®åº“èµ„æºï¼Œä½†æ˜¯èŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚ ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´ï¼Œæ¯æ¬¡æ˜¯ç›´æ¥ä»å†…å­˜ä¸­è·å–ç¿»é¡µçš„æ•°æ®ï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼Œä½†æ˜¯å¾ˆè€—å†…å­˜ã€‚ ï¼ˆ3ï¼‰çº¯æ•°æ®åº“å®ç°+çº¯å†…å­˜å®ç°æ€è·¯æ˜¯è¿™æ ·çš„ï¼šå¦‚æœæ¯é¡µæ˜¾ç¤º10æ¡è®°å½•ï¼Œæ ¹æ®åˆ¤æ–­ï¼Œç”¨æˆ·å¾ˆå°‘ç¿»åˆ°10é¡µä»¥åï¼Œé‚£å¥½ï¼Œç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œå°±ä¸€æ¬¡æ€§ä»æ•°æ®åº“ä¸­è·å–å‰10é¡µçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯100æ¡è®°å½•ï¼ŒæŠŠè¿™100æ¡è®°å½•æ”¾åœ¨å†…å­˜é‡Œé¢ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“ç”¨æˆ·åœ¨å‰10é¡µå†…è¿›è¡Œç¿»é¡µæ“ä½œçš„æ—¶å€™ï¼Œå°±ä¸ç”¨å†è®¿é—®æ•°æ®åº“äº†ï¼Œè€Œæ˜¯ç›´æ¥ä»å†…å­˜ä¸­è·å–æ•°æ®ï¼Œé€Ÿåº¦å°±å¿«äº†ã€‚å½“ç”¨æˆ·æƒ³è¦è·å–ç¬¬11é¡µçš„æ•°æ®æ—¶ï¼Œæ‰ä¼šå†æ¬¡è®¿é—®æ•°æ®åº“ã€‚ å››ã€è¿­ä»£å™¨æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼ï¼š å¦‚æœä½ å¸Œæœ›æä¾›è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹ï¼Œä½†æ˜¯åˆä¸æƒ³æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼æ¥æä¾›è¿­ä»£å™¨æ¥å£ï¼Œä»è€Œè®©å®¢æˆ·ç«¯åªæ˜¯é€šè¿‡è¿­ä»£å™¨çš„æ¥å£æ¥è®¿é—®èšåˆå¯¹è±¡ï¼Œè€Œæ— é¡»å…³å¿ƒèšåˆå¯¹è±¡çš„å†…éƒ¨å®ç°ã€‚ å¦‚æœä½ å¸Œæœ›æœ‰å¤šç§éå†æ–¹å¼å¯ä»¥è®¿é—®èšåˆå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼ã€‚ å¦‚æœä½ å¸Œæœ›ä¸ºéå†ä¸åŒçš„èšåˆå¯¹è±¡æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼ã€‚ äº”ã€è¿­ä»£å™¨æ¨¡å¼çš„ä¼˜ç‚¹æ›´å¥½çš„å°è£…æ€§ è¿­ä»£å™¨æ¨¡å¼å¯ä»¥è®©ä½ è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹ï¼Œè€Œæ— é¡»æš´éœ²è¯¥èšåˆå¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ï¼Œä»è€Œæé«˜èšåˆå¯¹è±¡çš„å°è£…æ€§ã€‚ å¯ä»¥ä»¥ä¸åŒçš„éå†æ–¹å¼æ¥éå†ä¸€ä¸ªèšåˆ ä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼ï¼Œä½¿å¾—èšåˆå¯¹è±¡çš„å†…å®¹å’Œå…·ä½“çš„è¿­ä»£ç®—æ³•åˆ†ç¦»å¼€ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸åŒçš„è¿­ä»£å™¨çš„å®ä¾‹ã€ä¸åŒçš„éå†æ–¹å¼æ¥éå†ä¸€ä¸ªèšåˆå¯¹è±¡äº†ã€‚ å®ç°åŠŸèƒ½åˆ†ç¦»ã€ç®€åŒ–èšåˆçš„æ¥å£ æœ‰äº†è¿­ä»£å™¨çš„æ¥å£ï¼Œåˆ™èšåˆå¯¹è±¡åªéœ€è¦å®ç°è‡ªèº«çš„åŸºæœ¬åŠŸèƒ½ï¼ŒæŠŠè¿­ä»£çš„åŠŸèƒ½å§”è®©ç»™å¤–éƒ¨çš„è¿­ä»£å™¨å»å®ç°ï¼Œå®ç°äº†åŠŸèƒ½åˆ†ç¦»ï¼Œç¬¦åˆâ€œå•ä¸€èŒè´£â€åŸåˆ™ã€‚ ç®€åŒ–å®¢æˆ·ç«¯è°ƒç”¨ è¿­ä»£å™¨ä¸ºéå†ä¸åŒçš„èšåˆå¯¹è±¡æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œä¸€æ–¹é¢æ–¹ä¾¿è°ƒç”¨ï¼›å¦ä¸€æ–¹é¢ä½¿å¾—å®¢æˆ·ç«¯ä¸å¿…å…³æ³¨è¿­ä»£å™¨çš„å®ç°ç»†èŠ‚ã€‚ åŒä¸€ä¸ªèšåˆä¸Šå¯ä»¥æœ‰å¤šä¸ªéå† æ¯ä¸ªè¿­ä»£å™¨ä¿æŒå®ƒè‡ªå·±çš„éå†çŠ¶æ€ï¼Œæ¯”å¦‚å‰é¢ç¤ºä¾‹ä¸­çš„è¿­ä»£ç´¢å¼•ä½ç½®ï¼Œå› æ­¤å¯ä»¥å¯¹åŒä¸€ä¸ªèšåˆå¯¹è±¡åŒæ—¶è¿›è¡Œå¤šä¸ªéå†ã€‚ å…­ã€æ€»ç»“èšåˆå¯¹è±¡çš„ç±»å‹å¾ˆå¤šï¼Œå¦‚æœå¯¹èšåˆå¯¹è±¡çš„è¿­ä»£è®¿é—®è·Ÿèšåˆå¯¹è±¡æœ¬èº«èåˆåœ¨ä¸€èµ·çš„è¯ï¼Œä¼šä¸¥é‡å½±å“åˆ°èšåˆå¯¹è±¡çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ è¿­ä»£å™¨æ¨¡å¼é€šè¿‡æŠŠå¯¹èšåˆå¯¹è±¡çš„éå†å’Œè®¿é—®ä»èšåˆå¯¹è±¡ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæ”¾å…¥åˆ°å•ç‹¬çš„è¿­ä»£å™¨ä¸­ï¼Œä½¿å¾—èšåˆå¯¹è±¡å˜å¾—ç®€å•ï¼›è€Œä¸”è¿­ä»£å™¨å’Œèšåˆå¯¹è±¡å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–å’Œå‘å±•ï¼Œå¤§å¤§åŠ å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"è¿­ä»£å™¨æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"è¿­ä»£å™¨æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/è¿­ä»£å™¨æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--æ¨¡æ¿æ–¹æ³•æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--æ¨¡æ¿æ–¹æ³•æ¨¡å¼","date":"2020-05-24T08:58:19.000Z","updated":"2023-04-30T10:21:41.358Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--æ¨¡æ¿æ–¹æ³•æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--æ¨¡æ¿æ–¹æ³•æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¨¡æ¿æ–¹æ³•(TemplateMethod)æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼çš„æœ¬è´¨ï¼šå›ºå®šç®—æ³•éª¨æ¶ äºŒã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç»“æ„ æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡ç±»(AbstractClass)è§’è‰²ï¼šç”¨æ¥å®šä¹‰ç®—æ³•éª¨æ¶(template method)å’ŒåŸè¯­æ“ä½œ(primitive operation)ï¼Œå…·ä½“çš„å­ç±»é€šè¿‡é‡å®šä¹‰è¿™äº›åŸè¯­æ“ä½œæ¥å®ç°ä¸€ä¸ªç®—æ³•çš„å„ä¸ªæ­¥éª¤ã€‚åœ¨è¿™ä¸ªç±»é‡Œé¢ï¼Œè¿˜å¯ä»¥æä¾›ç®—æ³•ä¸­é€šç”¨çš„å®ç°(general operation)ã€‚ å…·ä½“å®ç°ç±»(ConcreteClass)è§’è‰²ï¼šç”¨æ¥å®ç°ç®—æ³•éª¨æ¶ä¸­çš„æŸäº›æ­¥éª¤ï¼Œå®Œæˆä¸å®ç°ç±»è‡ªèº«ç›¸å…³çš„æŸäº›åŠŸèƒ½ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šå…ˆçœ‹çœ‹æŠ½è±¡ç±»çš„å†™æ³•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public abstract class AbstractClass { /** * æ¨¡æ¿æ–¹æ³• */ public void templateMethod() { // è°ƒç”¨åŸè¯­æ“ä½œå’Œé€šç”¨æ“ä½œ generalOperation(); primitiveOperationA(); primitiveOperationB(); } // åŸè¯­æ“ä½œAï¼Œç®—æ³•ä¸­çš„å¿…è¦æ­¥éª¤ï¼Œçˆ¶ç±»æ— æ³•ç¡®å®šå¦‚ä½•çœŸæ­£å®ç°ï¼Œéœ€è¦å­ç±»æ¥å®ç° public abstract void primitiveOperationA(); // åŸè¯­æ“ä½œBï¼Œç®—æ³•ä¸­çš„å¿…è¦æ­¥éª¤ï¼Œçˆ¶ç±»æ— æ³•ç¡®å®šå¦‚ä½•çœŸæ­£å®ç°ï¼Œéœ€è¦å­ç±»æ¥å®ç° public abstract void primitiveOperationB(); protected void generalOperation() { System.out.println(&quot;æ‰§è¡Œé€šç”¨æ“ä½œ...&quot;); } } å†æ¥çœ‹çœ‹å…·ä½“å®ç°ç±»å†™æ³•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * å…·ä½“å®ç°ç±»ï¼Œå®ç°åŸè¯­æ“ä½œï¼Œå¹¶å¯ä»¥æ·»åŠ ä¸è‡ªèº«åŠŸèƒ½ç›¸å…³çš„å…¶ä»–æ“ä½œ */ public class ConcreteClass extends AbstractClass { // å…·ä½“çš„å®ç° @Override public void primitiveOperationA() { System.out.println(&quot;æ‰§è¡ŒåŸè¯­æ“ä½œA...&quot;); } // å…·ä½“çš„å®ç° @Override public void primitiveOperationB() { System.out.println(&quot;æ‰§è¡ŒåŸè¯­æ“ä½œB...&quot;); } } æ¥ä¸‹æ¥çœ‹çœ‹å®¢æˆ·ç«¯çš„ç¤ºä¾‹ï¼Œç¤ºæ„ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªæ¨¡æ¿å®ä¾‹ AbstractClass abstractClass = new ConcreteClass(); // æ‰§è¡Œå®ä¾‹çš„æ¨¡æ¿æ–¹æ³• abstractClass.templateMethod(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ‰§è¡Œé€šç”¨æ“ä½œâ€¦æ‰§è¡ŒåŸè¯­æ“ä½œAâ€¦æ‰§è¡ŒåŸè¯­æ“ä½œBâ€¦ ä¸‰ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç›¸å…³çŸ¥è¯†ç‚¹æŠ½è±¡ç±»å’Œæ¥å£ï¼š æ¥å£æ˜¯ä¸€ç§ç‰¹æ®Šçš„æŠ½è±¡ç±»ï¼Œæ‰€æœ‰æ¥å£ä¸­çš„å±æ€§è‡ªåŠ¨æ˜¯å¸¸é‡ï¼Œä¹Ÿå°±æ˜¯public final staticçš„ï¼Œè€Œæ‰€æœ‰æ¥å£ä¸­çš„æ–¹æ³•å¿…é¡»æ˜¯æŠ½è±¡çš„ã€‚ æŠ½è±¡ç±»ï¼Œç®€å•ç‚¹è¯´æ˜¯ç”¨abstractä¿®é¥°çš„ç±»ã€‚è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•çš„å…³ç³»ï¼Œè®°ä½ä¸¤å¥è¯ï¼šæŠ½è±¡ç±»ä¸ä¸€å®šåŒ…å«æŠ½è±¡æ–¹æ³•ï¼›æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»ä¸€å®šæ˜¯æŠ½è±¡ç±»ã€‚ æŠ½è±¡ç±»å’Œæ¥å£ç›¸æ¯”è¾ƒï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±åœ¨äºæŠ½è±¡ç±»ä¸­æ˜¯å¯ä»¥æœ‰å…·ä½“çš„å®ç°æ–¹æ³•çš„ï¼Œè€Œæ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯æ²¡æœ‰å…·ä½“çš„å®ç°çš„ã€‚ é€šå¸¸åœ¨â€œæ—¢è¦çº¦æŸå­ç±»çš„è¡Œä¸ºï¼Œåˆè¦ä¸ºå­ç±»æä¾›å…¬å…±åŠŸèƒ½â€çš„æ—¶å€™ä½¿ç”¨æŠ½è±¡ç±»ã€‚ å˜ä¸ä¸å˜ï¼š ç¨‹åºè®¾è®¡çš„ä¸€ä¸ªå¾ˆé‡è¦çš„æ€è€ƒç‚¹å°±æ˜¯â€œå˜ä¸ä¸å˜â€ï¼Œä¹Ÿå°±æ˜¯åˆ†æç¨‹åºä¸­å“ªäº›åŠŸèƒ½æ˜¯å¯å˜çš„ï¼Œå“ªäº›åŠŸèƒ½æ˜¯ä¸å˜çš„ï¼Œç„¶åæŠŠä¸å˜çš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ï¼Œè¿›è¡Œå…¬å…±çš„å®ç°ï¼ŒæŠŠå˜åŒ–çš„éƒ¨åˆ†åˆ†ç¦»å‡ºå»ï¼Œç”¨æ¥å£æ¥å°è£…éš”ç¦»ï¼Œæˆ–è€…æ˜¯ç”¨æŠ½è±¡ç±»æ¥çº¦æŸå­ç±»è¡Œä¸ºã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆå¥½åœ°ä½“ç°äº†è¿™ä¸€ç‚¹ã€‚æ¨¡æ¿ç±»å®ç°çš„å°±æ˜¯ä¸å˜çš„æ–¹æ³•å’Œç®—æ³•çš„éª¨æ¶ï¼Œè€Œéœ€è¦å˜åŒ–çš„åœ°æ–¹ï¼Œéƒ½é€šè¿‡æŠ½è±¡æ–¹æ³•ï¼ŒæŠŠå…·ä½“å®ç°å»¶è¿Ÿåˆ°å­ç±»ä¸­äº†ï¼Œè€Œä¸”è¿˜é€šè¿‡çˆ¶ç±»çš„å®šä¹‰æ¥çº¦æŸäº†å­ç±»çš„è¡Œä¸ºï¼Œä»è€Œä½¿ç³»ç»Ÿèƒ½æœ‰æ›´å¥½çš„å¤ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚ å¥½è±åæ³•åˆ™ï¼š ä»€ä¹ˆæ˜¯å¥½è±åæ³•åˆ™å‘¢ï¼Ÿç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯â€œä¸è¦æ‰¾æˆ‘ä»¬ï¼Œ æˆ‘ä»¬ä¼šè”ç³»ä½ â€ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼å¾ˆå¥½åœ°ä½“ç°äº†è¿™ä¸€ç‚¹ã€‚ä½œä¸ºçˆ¶ç±»çš„æ¨¡æ¿ä¼šåœ¨éœ€è¦çš„æ—¶å€™ï¼Œè°ƒç”¨å­ç±»ç›¸åº”çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”±çˆ¶ç±»æ¥æ‰¾å­ç±»ï¼Œè€Œä¸æ˜¯è®©å­ç±»æ¥æ‰¾çˆ¶ç±»ã€‚ è¿™å…¶å®ä¹Ÿæ˜¯ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ã€‚æŒ‰ç…§é€šå¸¸çš„æ€è·¯ï¼Œæ˜¯å­ç±»æ‰¾çˆ¶ç±»æ‰å¯¹ï¼Œä¹Ÿå°±æ˜¯åº”è¯¥å­ç±»æ¥è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œå› ä¸ºçˆ¶ç±»æ ¹æœ¬å°±ä¸çŸ¥é“å­ç±»ï¼Œè€Œå­ç±»æ˜¯çŸ¥é“çˆ¶ç±»çš„ï¼Œä½†æ˜¯åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼é‡Œé¢ï¼Œæ˜¯çˆ¶ç±»æ¥æ‰¾å­ç±»ï¼Œæ‰€ä»¥æ˜¯ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ã€‚ â€œåæœŸç»‘å®šâ€æŠ€æœ¯ï¼š åœ¨Javaè¯­è¨€ä¸­ï¼Œå¯¹äºå‡ºç°å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³•çš„æƒ…å†µï¼Œåœ¨ç¼–è¯‘æ—¶æ˜¯çœ‹æ•°æ®ç±»å‹ï¼Œè¿è¡Œæ—¶åˆ™çœ‹å®é™…çš„å¯¹è±¡ç±»å‹ï¼ˆnewè°å°±è°ƒç”¨è°çš„æ–¹æ³•ï¼‰ã€‚ åœ¨ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ—¶å€™ï¼Œè™½ç„¶ç”¨çš„æ•°æ®ç±»å‹æ˜¯æ¨¡æ¿ç±»å‹ï¼Œä½†æ˜¯åœ¨åˆ›å»ºç±»å®ä¾‹çš„æ—¶å€™æ˜¯åˆ›å»ºçš„å…·ä½“çš„å­ç±»çš„å®ä¾‹ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šè¢«åŠ¨æ€ç»‘å®šåˆ°å­ç±»çš„æ–¹æ³•ä¸Šï¼Œä»è€Œå®ç°åå‘æ§åˆ¶ã€‚å…¶å®åœ¨å†™çˆ¶ç±»çš„æ—¶å€™ï¼Œå®ƒè°ƒç”¨çš„æ–¹æ³•æ˜¯çˆ¶ç±»è‡ªå·±çš„æŠ½è±¡æ–¹æ³•ï¼Œåªæ˜¯åœ¨è¿è¡Œçš„æ—¶å€™è¢«åŠ¨æ€ç»‘å®šåˆ°äº†å­ç±»çš„æ–¹æ³•ä¸Šã€‚ å››ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨é¢å‘å¯¹è±¡ç³»ç»Ÿçš„åˆ†æä¸è®¾è®¡è¿‡ç¨‹ä¸­ç»å¸¸ä¼šé‡åˆ°è¿™æ ·ä¸€ç§æƒ…å†µï¼š å¯¹äºæŸä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼ˆç®—æ³•å®ç°ï¼‰åœ¨ä¸åŒçš„å¯¹è±¡ä¸­æœ‰ä¸åŒçš„ç»†èŠ‚å®ç°ï¼Œ ä½†æ˜¯é€»è¾‘ï¼ˆç®—æ³•ï¼‰çš„æ¡†æ¶ï¼ˆæˆ–é€šç”¨çš„åº”ç”¨ç®—æ³•ï¼‰æ˜¯ç›¸åŒçš„ã€‚æ¨¡æ¿æ–¹æ³•æä¾›äº†è¿™ç§æƒ…å†µçš„ä¸€ä¸ªå®ç°æ¡†æ¶ã€‚ æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼æ˜¯é‡‡ç”¨ç»§æ‰¿çš„æ–¹å¼å®ç°è¿™ä¸€ç‚¹ï¼š å°†é€»è¾‘ï¼ˆç®—æ³•ï¼‰æ¡†æ¶æ”¾åœ¨æŠ½è±¡åŸºç±»ä¸­ï¼Œ å¹¶å®šä¹‰å¥½ç»†èŠ‚çš„æ¥å£ï¼Œå­ç±»ä¸­å®ç°ç»†èŠ‚ã€‚ ç­–ç•¥æ¨¡å¼è§£å†³çš„æ˜¯å’Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼ç±»ä¼¼çš„é—®é¢˜ï¼Œ ä½†æ˜¯ç­–ç•¥æ¨¡å¼æ˜¯å°†é€»è¾‘ï¼ˆç®—æ³•ï¼‰å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶é‡‡å–ç»„åˆï¼ˆå§”æ‰˜ï¼‰çš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æ¨¡æ¿æ–¹æ³•åº”ç”¨äºä¸‹åˆ—æƒ…å†µï¼š å›ºå®šå®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå®ç°ä¸€ä¸ªç®—æ³•çš„ä¸å˜çš„éƒ¨åˆ†ï¼Œå¹¶æŠŠå¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°ã€‚ å„å­ç±»ä¸­å…·æœ‰å…¬å…±è¡Œä¸ºï¼Œåº”è¢«æå–å‡ºæ¥ï¼Œé›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­å»å®ç°ï¼Œä»¥é¿å…ä»£ç é‡å¤ï¼Œå³â€œé‡åˆ†è§£ä»¥ä¸€èˆ¬åŒ–â€ã€‚ æ§åˆ¶å­ç±»æ‰©å±•ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼åªåœ¨ç‰¹å®šç‚¹è°ƒç”¨å­ç±»çš„æ–¹æ³•ï¼Œè¿™æ ·å°±åªå…è®¸åœ¨è¿™äº›ç‚¹è¿›è¡Œæ‰©å±•ã€‚ äº”ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ä¼˜ç‚¹ï¼š æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§å®ç°ä»£ç å¤ç”¨çš„å¾ˆå¥½çš„æ‰‹æ®µã€‚é€šè¿‡æŠŠå­ç±»çš„å…¬å…±åŠŸèƒ½æç‚¼å’ŒæŠ½å–ï¼ŒæŠŠå…¬å…±éƒ¨åˆ†æ”¾åˆ°æ¨¡æ¿ä¸­å»å®ç°ã€‚ ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç¼ºç‚¹ï¼š æ¨¡æ¿æ–¹æ³•æ¨¡å¼æœ€åŸºæœ¬çš„åŠŸèƒ½å°±æ˜¯é€šè¿‡æ¨¡æ¿çš„åˆ¶å®šï¼ŒæŠŠç®—æ³•éª¨æ¶å®Œå…¨å›ºå®šä¸‹æ¥ã€‚äº‹å®ä¸Šæ¨¡æ¿å’Œå­ç±»æ˜¯éå¸¸è€¦åˆçš„ï¼Œå¦‚æœè¦å¯¹æ¨¡æ¿ä¸­çš„ç®—æ³•éª¨æ¶è¿›è¡Œå˜æ›´ï¼Œå¯èƒ½å°±ä¼šè¦æ±‚æ‰€æœ‰ç›¸å…³çš„å­ç±»è¿›è¡Œç›¸åº”çš„å˜åŒ–ã€‚æ‰€ä»¥æŠ½è±¡ç®—æ³•éª¨æ¶çš„æ—¶å€™è¦ç‰¹åˆ«å°å¿ƒï¼Œå°½é‡ç¡®ä¿æ˜¯ä¸ä¼šå˜åŒ–çš„éƒ¨åˆ†æ‰æ”¾åˆ°æ¨¡æ¿ä¸­ã€‚ å…­ã€æ€»ç»“æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸»è¦æ˜¯é€šè¿‡åˆ¶å®šæ¨¡æ¿ï¼ŒæŠŠç®—æ³•æ­¥éª¤å›ºå®šä¸‹æ¥ï¼Œè‡³äºè°æ¥å®ç°ï¼Œæ¨¡æ¿å¯ä»¥è‡ªå·±æä¾›å®ç°ï¼Œä¹Ÿå¯ä»¥ç”±å­ç±»å»å®ç°ï¼Œè¿˜å¯ä»¥é€šè¿‡å›è°ƒæœºåˆ¶è®©å…¶ä»–ç±»æ¥å®ç°ã€‚ é€šè¿‡å›ºå®šç®—æ³•éª¨æ¶æ¥çº¦æŸå­ç±»çš„è¡Œä¸ºï¼Œå¹¶åœ¨ç‰¹å®šçš„æ‰©å±•ç‚¹æ¥è®©å­ç±»è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œä»è€Œè®©ç¨‹åºæ—¢æœ‰å¾ˆå¥½çš„å¤ç”¨æ€§ï¼Œåˆæœ‰è¾ƒå¥½çš„æ‰©å±•æ€§ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"æ¨¡æ¿æ–¹æ³•æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"æ¨¡æ¿æ–¹æ³•æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/æ¨¡æ¿æ–¹æ³•æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--çŠ¶æ€æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--çŠ¶æ€æ¨¡å¼","date":"2020-05-24T08:57:11.000Z","updated":"2023-04-30T10:21:41.359Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--çŠ¶æ€æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--çŠ¶æ€æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯çŠ¶æ€æ¨¡å¼çŠ¶æ€(State)ï¼‰æ¨¡å¼ï¼Œåˆç§°çŠ¶æ€å¯¹è±¡(Pattern of Objects for States)æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™æ”¹å˜å…¶è¡Œä¸ºã€‚è¿™ä¸ªå¯¹è±¡çœ‹ä¸Šå»å°±åƒæ˜¯æ”¹å˜äº†å®ƒçš„ç±»ä¸€æ ·ã€‚ çŠ¶æ€æ¨¡å¼çš„æœ¬è´¨ï¼šæ ¹æ®çŠ¶æ€æ¥åˆ†ç¦»å’Œé€‰æ‹©è¡Œä¸º äºŒã€çŠ¶æ€æ¨¡å¼çš„ç»“æ„ çŠ¶æ€æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š ç¯å¢ƒ(Context)è§’è‰²:ä¹Ÿç§°ä¸Šä¸‹æ–‡,é€šå¸¸ç”¨æ¥å®šä¹‰å®¢æˆ·ç«¯æ„Ÿå…´è¶£çš„æ¥å£ï¼ŒåŒæ—¶ç»´æŠ¤ä¸€ä¸ªæ¥å…·ä½“å¤„ç†å½“å‰çŠ¶æ€çš„å¯¹è±¡ç¤ºä¾‹ã€‚ æŠ½è±¡çŠ¶æ€(State)è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨æ¥å°è£…ä¸ç¯å¢ƒï¼ˆContextï¼‰å¯¹è±¡çš„ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸ºã€‚ å…·ä½“çŠ¶æ€(ConcreteState)è§’è‰²ï¼šæ¯ä¸€ä¸ªå…·ä½“çŠ¶æ€ç±»éƒ½å®ç°äº†ä¸€ä¸ªè·Ÿç¯å¢ƒï¼ˆContextï¼‰ç›¸å…³çš„çŠ¶æ€çš„å…·ä½“å¤„ç†ã€‚ çŠ¶æ€æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼š /** * æŠ½è±¡çŠ¶æ€(State)è§’è‰²ï¼Œç”¨æ¥å°è£…ä¸ç¯å¢ƒï¼ˆContextï¼‰å¯¹è±¡çš„ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸º */ public interface State { /** * çŠ¶æ€å¯¹åº”çš„å¤„ç† * * @param sampleParameter ç¤ºä¾‹å‚æ•° */ public void handle(String sampleParameter); } /** * å…·ä½“çŠ¶æ€(ConcreteState)è§’è‰²ï¼Œå®ç°ä¸€ä¸ªä¸Contextçš„ä¸€ä¸ªç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸º */ public class ConcreteStateA implements State { @Override public void handle(String sampleParameter) { // å®ç°å…·ä½“çš„å¤„ç† } } /** * å…·ä½“çŠ¶æ€(ConcreteState)è§’è‰²ï¼Œå®ç°ä¸€ä¸ªä¸Contextçš„ä¸€ä¸ªç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸º */ public class ConcreteStateB implements State { @Override public void handle(String sampleParameter) { // å®ç°å…·ä½“çš„å¤„ç† } } /** * ç¯å¢ƒ(Context)è§’è‰² */ public class Context { // æŒæœ‰ä¸€ä¸ªStateç±»å‹çš„å¯¹è±¡å®ä¾‹ private State state; public void setState(State state) { this.state = state; } public void request(String sampleParameter) { // å¤„ç†æ“ä½œï¼Œä¼šè½¬è°ƒStateæ¥å¤„ç† state.handle(sampleParameter); } } ä¸‰ã€çŠ¶æ€æ¨¡å¼åº”ç”¨ä¸¾ä¾‹ã€Šç ”ç£¨è®¾è®¡æ¨¡å¼ã€‹ä¸­ç»™å‡ºè¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼šå®ç°åœ¨çº¿æŠ•ç¥¨ã€‚ è€ƒè™‘ä¸€ä¸ªåœ¨çº¿æŠ•ç¥¨çš„åº”ç”¨ï¼Œè¦å®ç°æ§åˆ¶åŒä¸€ä¸ªç”¨æˆ·åªèƒ½æŠ•ä¸€ç¥¨ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·é‡å¤æŠ•ç¥¨ï¼Œè€Œä¸”æŠ•ç¥¨æ¬¡æ•°è¶…è¿‡5æ¬¡ï¼Œåˆ™åˆ¤å®šä¸ºæ¶æ„åˆ·ç¥¨ï¼Œè¦å–æ¶ˆè¯¥ç”¨æˆ·æŠ•ç¥¨çš„èµ„æ ¼ï¼Œå½“ç„¶åŒæ—¶ä¹Ÿè¦å–æ¶ˆä»–æ‰€æŠ•çš„ç¥¨ï¼›å¦‚æœä¸€ä¸ªç”¨æˆ·çš„æŠ•ç¥¨æ¬¡æ•°è¶…è¿‡8æ¬¡ï¼Œå°†è¿›å…¥é»‘åå•ï¼Œç¦æ­¢å†ç™»å½•å’Œä½¿ç”¨ç³»ç»Ÿã€‚ ä»¥ä¸ŠåŠŸèƒ½æˆ‘ä»¬ä½¿ç”¨çŠ¶æ€æ¨¡å¼æ¥å®ç°ï¼š é¦–å…ˆéœ€è¦æŠŠæŠ•ç¥¨è¿‡ç¨‹çš„å„ç§çŠ¶æ€å®šä¹‰å‡ºæ¥ï¼Œæ ¹æ®ä»¥ä¸Šæè¿°å¤§è‡´åˆ†ä¸ºå››ç§çŠ¶æ€ï¼šæ­£å¸¸æŠ•ç¥¨ã€é‡å¤æŠ•ç¥¨ã€æ¶æ„åˆ·ç¥¨ã€è¿›å…¥é»‘åå•ã€‚ è®¾è®¡å¥½çš„ç¨‹åºç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š å…ˆæ¥çœ‹çœ‹çŠ¶æ€æ¥å£çš„ä»£ç å®ç°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public interface VoteState { /** * å¤„ç†çŠ¶æ€å¯¹åº”çš„è¡Œä¸º * * @param user * æŠ•ç¥¨äºº * @param voteItem * æŠ•ç¥¨é¡¹ * @param voteManager * æŠ•ç¥¨ä¸Šä¸‹æ–‡ï¼Œç”¨æ¥åœ¨å®ç°çŠ¶æ€å¯¹åº”çš„åŠŸèƒ½å¤„ç†çš„æ—¶å€™ï¼Œ å¯ä»¥å›è°ƒä¸Šä¸‹æ–‡çš„æ•°æ® */ public void vote(String user, String voteItem, VoteManager voteManager); } æ¥ä¸‹æ¥çœ‹çœ‹å„ä¸ªçŠ¶æ€å¯¹åº”çš„å¤„ç†ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * æ­£å¸¸æŠ•ç¥¨çŠ¶æ€ */ public class NormalVoteState implements VoteState { @Override public void vote(String user, String voteItem, VoteManager voteManager) { // æ­£å¸¸æŠ•ç¥¨ï¼Œè®°å½•åˆ°æŠ•ç¥¨è®°å½•ä¸­ voteManager.getMapVote().put(user, voteItem); System.out.println(&quot;æ­å–œæ‚¨ï¼ŒæŠ•ç¥¨æˆåŠŸã€‚&quot;); } } /** * é‡å¤æŠ•ç¥¨çŠ¶æ€ */ public class RepeatVoteState implements VoteState { @Override public void vote(String user, String voteItem, VoteManager voteManager) { // é‡å¤æŠ•ç¥¨ï¼Œæ­¤å¤„ä»…æ‰“å°ä¸€ä¸ªè­¦å‘Šä½œä¸ºç¤ºæ„ System.out.println(&quot;è­¦å‘Šï¼šè¯·ä¸è¦é‡å¤æŠ•ç¥¨!&quot;); } } /** * æ¶æ„åˆ·ç¥¨çŠ¶æ€ */ public class SpiteVoteState implements VoteState { @Override public void vote(String user, String voteItem, VoteManager voteManager) { // æ¶æ„æŠ•ç¥¨ï¼Œå–æ¶ˆç”¨æˆ·çš„æŠ•ç¥¨èµ„æ ¼ï¼Œå¹¶å–æ¶ˆæŠ•ç¥¨è®°å½• String str = voteManager.getMapVote().get(user); if (str != null) { voteManager.getMapVote().remove(user); } System.out.println(&quot;ä½ æœ‰æ¶æ„åˆ·å±è¡Œä¸ºï¼Œå–æ¶ˆæŠ•ç¥¨èµ„æ ¼ï¼&quot;); } } /** * é»‘åå•çŠ¶æ€ */ public class BlackVoteState implements VoteState { @Override public void vote(String user, String voteItem, VoteManager voteManager) { // è®°å½•åœ¨é»‘åå•ä¸­ï¼Œç¦æ­¢ç™»å½•ç³»ç»Ÿ System.out.println(&quot;æç¤ºï¼šæ‚¨å·²è¿›å…¥æŠ•ç¥¨é»‘åå•ï¼Œç¦æ­¢ç™»å½•å’Œä½¿ç”¨æœ¬ç³»ç»Ÿï¼&quot;); } } æœ€åçœ‹çœ‹æŠ•ç¥¨ç®¡ç†ï¼Œç›¸å½“äºçŠ¶æ€æ¨¡å¼ä¸­çš„ä¸Šä¸‹æ–‡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ import java.util.HashMap; import java.util.Map; public class VoteManager { // æŒæœ‰çŠ¶ä½“å¤„ç†å¯¹è±¡å®ä¾‹ private VoteState state = null; // è®°å½•ç”¨æˆ·æŠ•ç¥¨çš„ç»“æœï¼ŒMap&lt;String,String&gt;å¯¹åº”Map&lt;ç”¨æˆ·åç§°ï¼ŒæŠ•ç¥¨çš„é€‰é¡¹&gt; private Map&lt;String, String&gt; mapVote = new HashMap&lt;String, String&gt;(); // è®°å½•ç”¨æˆ·æŠ•ç¥¨æ¬¡æ•°ï¼ŒMap&lt;String,Integer&gt;å¯¹åº”Map&lt;ç”¨æˆ·åç§°ï¼ŒæŠ•ç¥¨çš„æ¬¡æ•°&gt; private Map&lt;String, Integer&gt; mapVoteCount = new HashMap&lt;String, Integer&gt;(); /** * è·å–ç”¨æˆ·æŠ•ç¥¨ç»“æœçš„Map */ public Map&lt;String, String&gt; getMapVote() { return mapVote; } /** * æŠ•ç¥¨ * * @param user * æŠ•ç¥¨äºº * @param voteItem * æŠ•ç¥¨çš„é€‰é¡¹ */ public void vote(String user, String voteItem) { // 1.ä¸ºè¯¥ç”¨æˆ·å¢åŠ æŠ•ç¥¨æ¬¡æ•° // ä»è®°å½•ä¸­å–å‡ºè¯¥ç”¨æˆ·å·²æœ‰çš„æŠ•ç¥¨æ¬¡æ•° Integer oldVoteCount = mapVoteCount.get(user); if (oldVoteCount == null) { oldVoteCount = 0; } oldVoteCount += 1; mapVoteCount.put(user, oldVoteCount); // 2.åˆ¤æ–­è¯¥ç”¨æˆ·çš„æŠ•ç¥¨ç±»å‹ï¼Œå°±ç›¸å½“äºåˆ¤æ–­å¯¹åº”çš„çŠ¶æ€ // åˆ°åº•æ˜¯æ­£å¸¸æŠ•ç¥¨ã€é‡å¤æŠ•ç¥¨ã€æ¶æ„æŠ•ç¥¨è¿˜æ˜¯ä¸Šé»‘åå•çš„çŠ¶æ€ if (oldVoteCount == 1) { state = new NormalVoteState(); } else if (oldVoteCount &gt; 1 &amp;&amp; oldVoteCount &lt; 5) { state = new RepeatVoteState(); } else if (oldVoteCount &gt;= 5 &amp;&amp; oldVoteCount &lt; 8) { state = new SpiteVoteState(); } else if (oldVoteCount &gt; 8) { state = new BlackVoteState(); } // 3.ç„¶åè½¬è°ƒçŠ¶æ€å¯¹è±¡æ¥è¿›è¡Œç›¸åº”çš„æ“ä½œ state.vote(user, voteItem, this); } } å†™ä¸ªå®¢æˆ·ç«¯æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªæŠ•ç¥¨ç®¡ç†å¯¹è±¡å®ä¾‹ VoteManager vm = new VoteManager(); // é€šè¿‡ä¸€ä¸ªå¾ªç¯æ“ä½œæ¥æ¨¡ä»¿ç”¨æˆ·è¿ç»­æŠ•ç¥¨9æ¬¡çš„è¡Œä¸º for (int i = 0; i &lt; 9; i++) { vm.vote(&quot;u1&quot;, &quot;A&quot;); } } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ­å–œæ‚¨ï¼ŒæŠ•ç¥¨æˆåŠŸã€‚è­¦å‘Šï¼šè¯·ä¸è¦é‡å¤æŠ•ç¥¨!è­¦å‘Šï¼šè¯·ä¸è¦é‡å¤æŠ•ç¥¨!è­¦å‘Šï¼šè¯·ä¸è¦é‡å¤æŠ•ç¥¨!ä½ æœ‰æ¶æ„åˆ·å±è¡Œä¸ºï¼Œå–æ¶ˆæŠ•ç¥¨èµ„æ ¼ï¼ä½ æœ‰æ¶æ„åˆ·å±è¡Œä¸ºï¼Œå–æ¶ˆæŠ•ç¥¨èµ„æ ¼ï¼ä½ æœ‰æ¶æ„åˆ·å±è¡Œä¸ºï¼Œå–æ¶ˆæŠ•ç¥¨èµ„æ ¼ï¼ä½ æœ‰æ¶æ„åˆ·å±è¡Œä¸ºï¼Œå–æ¶ˆæŠ•ç¥¨èµ„æ ¼ï¼æç¤ºï¼šæ‚¨å·²è¿›å…¥æŠ•ç¥¨é»‘åå•ï¼Œç¦æ­¢ç™»å½•å’Œä½¿ç”¨æœ¬ç³»ç»Ÿï¼ å››ã€ç†è§£çŠ¶æ€æ¨¡å¼çŠ¶æ€å’Œè¡Œä¸ºæ‰€è°“å¯¹è±¡çš„çŠ¶æ€ï¼Œé€šå¸¸æŒ‡çš„å°±æ˜¯å¯¹è±¡å®ä¾‹çš„å±æ€§çš„å€¼ï¼›è€Œè¡Œä¸ºæŒ‡çš„å°±æ˜¯å¯¹è±¡çš„åŠŸèƒ½ï¼Œå†å…·ä½“ç‚¹è¯´ï¼Œè¡Œä¸ºå¤§å¤šå¯ä»¥å¯¹åº”åˆ°æ–¹æ³•ä¸Šã€‚ çŠ¶æ€æ¨¡å¼çš„åŠŸèƒ½å°±æ˜¯åˆ†ç¦»çŠ¶æ€çš„è¡Œä¸ºï¼Œé€šè¿‡ç»´æŠ¤çŠ¶æ€çš„å˜åŒ–ï¼Œæ¥è°ƒç”¨ä¸åŒçŠ¶æ€å¯¹åº”çš„ä¸åŒåŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŠ¶æ€å’Œè¡Œä¸ºæ˜¯ç›¸å…³è”çš„ï¼Œå®ƒä»¬çš„å…³ç³»å¯ä»¥æè¿°ä¸ºï¼šçŠ¶æ€å†³å®šè¡Œä¸ºã€‚ ç”±äºçŠ¶æ€æ˜¯åœ¨è¿è¡ŒæœŸé—´è¢«æ”¹å˜çš„ï¼Œå› æ­¤è¡Œä¸ºä¹Ÿä¼šåœ¨è¿è¡ŒæœŸé—´æ ¹æ®çŠ¶æ€çš„æ”¹å˜è€Œæ”¹å˜ï¼Œçœ‹èµ·æ¥ï¼ŒåŒä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ä¸åŒçš„è¿è¡Œæ—¶åˆ»ï¼Œè¡Œä¸ºæ˜¯ä¸ä¸€æ ·çš„ï¼Œå°±åƒæ˜¯ç±»è¢«ä¿®æ”¹äº†ä¸€æ ·ã€‚ è¡Œä¸ºçš„å¹³è¡Œæ€§æ³¨æ„å¹³è¡Œæ€§è€Œä¸æ˜¯å¹³ç­‰æ€§ã€‚æ‰€è°“å¹³è¡Œæ€§æŒ‡çš„æ˜¯å„ä¸ªçŠ¶æ€çš„è¡Œä¸ºæ‰€å¤„çš„å±‚æ¬¡æ˜¯ä¸€æ ·çš„ï¼Œç›¸äº’ç‹¬ç«‹çš„ã€æ²¡æœ‰å…³è”çš„ï¼Œæ˜¯æ ¹æ®ä¸åŒçš„çŠ¶æ€æ¥å†³å®šåˆ°åº•èµ°å¹³è¡Œçº¿çš„å“ªä¸€æ¡ã€‚è¡Œä¸ºæ˜¯ä¸åŒçš„ï¼Œå½“ç„¶å¯¹åº”çš„å®ç°ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œç›¸äº’ä¹‹é—´æ˜¯ä¸å¯æ›¿æ¢çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è€Œå¹³ç­‰æ€§å¼ºè°ƒçš„æ˜¯å¯æ›¿æ¢æ€§ï¼Œå¤§å®¶æ˜¯åŒä¸€è¡Œä¸ºçš„ä¸åŒæè¿°æˆ–å®ç°ï¼Œå› æ­¤åœ¨åŒä¸€ä¸ªè¡Œä¸ºå‘ç”Ÿçš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®æ¡ä»¶æŒ‘é€‰ä»»æ„ä¸€ä¸ªå®ç°æ¥è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¤§å®¶å¯èƒ½ä¼šå‘ç°çŠ¶æ€æ¨¡å¼çš„ç»“æ„å’Œç­–ç•¥æ¨¡å¼çš„ç»“æ„å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯ï¼Œå®ƒä»¬çš„ç›®çš„ã€å®ç°ã€æœ¬è´¨å´æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚è¿˜æœ‰è¡Œä¸ºä¹‹é—´çš„ç‰¹æ€§ä¹Ÿæ˜¯çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«ï¼ŒçŠ¶æ€æ¨¡å¼çš„è¡Œä¸ºæ˜¯å¹³è¡Œæ€§çš„ï¼Œä¸å¯ç›¸äº’æ›¿æ¢çš„ï¼›è€Œç­–ç•¥æ¨¡å¼çš„è¡Œä¸ºæ˜¯å¹³ç­‰æ€§çš„ï¼Œæ˜¯å¯ä»¥ç›¸äº’æ›¿æ¢çš„ã€‚ ç¯å¢ƒå’ŒçŠ¶æ€å¤„ç†å¯¹è±¡åœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œç¯å¢ƒ(Context)æ˜¯æŒæœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œä½†æ˜¯ç¯å¢ƒè‡ªèº«å¹¶ä¸å¤„ç†è·Ÿç‰¹å®šçš„çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºï¼Œè€Œæ˜¯æŠŠå¤„ç†çŠ¶æ€çš„åŠŸèƒ½å§”æ‰˜ç»™äº†çŠ¶æ€å¯¹åº”çš„çŠ¶æ€å¤„ç†ç±»æ¥å¤„ç†ã€‚ åœ¨å…·ä½“çš„çŠ¶æ€å¤„ç†ç±»ä¸­ç»å¸¸éœ€è¦è·å–ç¯å¢ƒè‡ªèº«çš„æ•°æ®ï¼Œç”šè‡³åœ¨å¿…è¦çš„æ—¶å€™ä¼šå›è°ƒç¯å¢ƒçš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œé€šå¸¸å°†ç¯å¢ƒè‡ªèº«å½“ä½œä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å…·ä½“çš„çŠ¶æ€å¤„ç†ç±»ã€‚ å®¢æˆ·ç«¯ä¸€èˆ¬åªå’Œç¯å¢ƒäº¤äº’ã€‚å®¢æˆ·ç«¯å¯ä»¥ç”¨çŠ¶æ€å¯¹è±¡æ¥é…ç½®ä¸€ä¸ªç¯å¢ƒï¼Œä¸€æ—¦é…ç½®å®Œæ¯•ï¼Œå°±ä¸å†éœ€è¦å’ŒçŠ¶æ€å¯¹è±¡æ‰“äº¤é“äº†ã€‚å®¢æˆ·ç«¯é€šå¸¸ä¸è´Ÿè´£è¿è¡ŒæœŸé—´çŠ¶æ€çš„ç»´æŠ¤ï¼Œä¹Ÿä¸è´Ÿè´£å†³å®šåç»­åˆ°åº•ä½¿ç”¨å“ªä¸€ä¸ªå…·ä½“çš„çŠ¶æ€å¤„ç†å¯¹è±¡ã€‚ äº”ã€çŠ¶æ€æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨çŠ¶æ€æ¨¡å¼ï¼š ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€,å¹¶ä¸”å®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶åˆ»æ ¹æ®çŠ¶æ€æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚ ä¸€ä¸ªæ“ä½œä¸­å«æœ‰åºå¤§çš„å¤šåˆ†æ”¯çš„æ¡ä»¶è¯­å¥ï¼Œä¸”è¿™äº›åˆ†æ”¯ä¾èµ–äºè¯¥å¯¹è±¡çš„çŠ¶æ€ã€‚ å…­ã€çŠ¶æ€æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä½¿ç”¨çŠ¶æ€æ¨¡å¼çš„ä¼˜ç‚¹ï¼š ç®€åŒ–åº”ç”¨é€»è¾‘æ§åˆ¶çŠ¶æ€æ¨¡å¼ä½¿ç”¨å•ç‹¬çš„ç±»æ¥å°è£…ä¸€ä¸ªçŠ¶æ€çš„å¤„ç†ï¼Œå¯ä»¥æŠŠè´Ÿè´£é€»è¾‘æ§åˆ¶çš„ä»£ç åˆ†æ•£åˆ°å•ç‹¬çš„çŠ¶æ€ç±»ä¸­å»ï¼Œè¿™æ ·å°±æŠŠç€çœ¼ç‚¹ä»æ‰§è¡ŒçŠ¶æ€æé«˜åˆ°æ•´ä¸ªå¯¹è±¡çš„çŠ¶æ€ï¼Œä½¿å¾—ä»£ç ç»“æ„åŒ–å’Œæ„å›¾æ›´æ¸…æ™°ï¼Œä»è€Œç®€åŒ–åº”ç”¨çš„é€»è¾‘æ§åˆ¶ã€‚ æ›´å¥½åœ°åˆ†ç¦»çŠ¶æ€å’Œè¡Œä¸ºçŠ¶æ€æ¨¡å¼é€šè¿‡è®¾ç½®æ‰€æœ‰çŠ¶æ€ç±»çš„å…¬å…±æ¥å£ï¼ŒæŠŠçŠ¶æ€å’ŒçŠ¶æ€å¯¹åº”çš„è¡Œä¸ºåˆ†ç¦»å¼€ï¼ŒæŠŠæ‰€æœ‰ä¸ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºéƒ½æ”¾å…¥ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºåœ¨æ§åˆ¶çš„æ—¶å€™ï¼Œåªéœ€è¦å…³å¿ƒçŠ¶æ€çš„åˆ‡æ¢ï¼Œè€Œä¸ç”¨å…³å¿ƒè¿™ä¸ªçŠ¶æ€å¯¹åº”çš„çœŸæ­£å¤„ç†ã€‚ æ›´å¥½çš„æ‰©å±•æ€§å¼•å…¥äº†çŠ¶æ€å¤„ç†çš„å…¬å…±æ¥å£åï¼Œä½¿å¾—æ‰©å±•æ–°çš„çŠ¶æ€å˜å¾—éå¸¸å®¹æ˜“ï¼Œåªéœ€è¦æ–°å¢åŠ ä¸€ä¸ªå®ç°çŠ¶æ€å¤„ç†çš„å…¬å…±æ¥å£çš„å®ç°ç±»ï¼Œç„¶ååœ¨è¿›è¡ŒçŠ¶æ€ç»´æŠ¤çš„åœ°æ–¹ï¼Œè®¾ç½®çŠ¶æ€å˜åŒ–åˆ°è¿™ä¸ªæ–°çš„çŠ¶æ€å³å¯ã€‚ æ˜¾å¼åŒ–è¿›è¡ŒçŠ¶æ€è½¬æ¢çŠ¶æ€æ¨¡å¼ä¸ºä¸åŒçš„çŠ¶æ€å¼•å…¥ç‹¬ç«‹çš„å¯¹è±¡ï¼Œä½¿å¾—çŠ¶æ€çš„è½¬æ¢å˜å¾—æ›´åŠ æ˜ç¡®ã€‚è€Œä¸”çŠ¶æ€å¯¹è±¡å¯ä»¥ä¿è¯ä¸Šä¸‹æ–‡ä¸ä¼šå‘ç”Ÿå†…éƒ¨çŠ¶æ€ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå› ä¸ºä¸Šä¸‹æ–‡ä¸­åªæœ‰ä¸€ä¸ªå˜é‡æ¥è®°å½•çŠ¶æ€å¯¹è±¡ï¼Œåªè¦ä¸ºè¿™ä¸€ä¸ªå˜é‡èµ‹å€¼å°±å¯ä»¥äº†ã€‚ ä½¿ç”¨çŠ¶æ€æ¨¡å¼çš„ç¼ºç‚¹ï¼šä¸€ä¸ªçŠ¶æ€å¯¹åº”ä¸€ä¸ªçŠ¶æ€å¤„ç†ç±»ï¼Œä¼šä½¿å¾—ç¨‹åºå¼•å…¥å¤ªå¤šçš„çŠ¶æ€ç±»ï¼Œè¿™æ ·ç¨‹åºå˜å¾—æ‚ä¹±ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"çŠ¶æ€æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"çŠ¶æ€æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/çŠ¶æ€æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--ç»„åˆæ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--ç»„åˆæ¨¡å¼","date":"2020-05-24T08:56:11.000Z","updated":"2023-04-30T10:21:41.360Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ç»„åˆæ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ç»„åˆæ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯ç»„åˆæ¨¡å¼ç»„åˆ(Composite)æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚ ç»„åˆæ¨¡å¼çš„æœ¬è´¨ï¼šç»Ÿä¸€å¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡ ç»„åˆæ¨¡å¼çš„ç›®çš„ï¼šè®©å®¢æˆ·ç«¯ä¸å†åŒºåˆ†æ“ä½œçš„æ˜¯ç»„åˆå¯¹è±¡è¿˜æ˜¯å¶å­å¯¹è±¡ï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼æ¥æ“ä½œã€‚ äºŒã€ç»„åˆæ¨¡å¼çš„é€‚ç”¨æ€§åœ¨å¼€å‘ä¸­ï¼Œ æˆ‘ä»¬ç»å¸¸å¯èƒ½è¦é€’å½’æ„å»ºæ ‘çŠ¶çš„ç»„åˆç»“æ„ï¼Œæ¯”å¦‚ä»¥ä¸‹çš„å•†å“ç±»åˆ«æ ‘ï¼š ä»”ç»†è§‚å¯Ÿä¸Šé¢çš„å•†å“ç±»åˆ«æ ‘ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ˜æ˜¾çš„ç‰¹ç‚¹ã€‚ æœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œæ¯”å¦‚â€œæœè£…â€ï¼Œå®ƒæ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥åŒ…å«å…¶ä»–çš„èŠ‚ç‚¹ã€‚ æ ‘æèŠ‚ç‚¹ï¼Œæœ‰ä¸€ç±»èŠ‚ç‚¹å¯ä»¥åŒ…å«å…¶ä»–çš„èŠ‚ç‚¹ï¼Œç§°ä¹‹ä¸ºæ ‘æèŠ‚ç‚¹ï¼Œæ¯”å¦‚â€œç”·è£…â€ã€â€œå¥³è£…â€å’Œâ€œæ¯å©´â€ã€‚ å¶å­èŠ‚ç‚¹ï¼Œæœ‰ä¸€ç±»èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç§°ä¹‹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œæ¯”å¦‚â€œè¡¬è¡£â€ã€â€œå¤¹å…‹â€ã€â€œè£™å­â€ã€â€œå¥—è£…â€ç­‰ã€‚ å¦‚æœç¢°åˆ°ç±»ä¼¼ä¸Šé¢è¿™ç§ï¼Œéœ€ä½¿ç”¨å¯¹è±¡æ ‘æ¥æè¿°æˆ–å®ç°çš„åŠŸèƒ½ï¼Œéƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨ç»„åˆæ¨¡å¼ï¼Œæ¯”å¦‚è¯»å–XMLæ–‡ä»¶ï¼Œæˆ–æ˜¯å¯¹è¯­å¥è¿›è¡Œè¯­æ³•è§£æç­‰ã€‚ ä¸‰ã€ç»„åˆæ¨¡å¼çš„ç»“æ„ ç»„åˆæ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡ç»„ä»¶(Component)è§’è‰²ï¼šä¸ºç»„åˆå¯¹è±¡å’Œå¶å­å¯¹è±¡å£°æ˜å…¬å…±çš„æ¥å£ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£æ¥è®¿é—®å’Œç®¡ç†æ•´ä¸ªå¯¹è±¡æ ‘ï¼Œå¹¶å¯ä»¥ä¸ºè¿™äº›å®šä¹‰çš„æ¥å£æä¾›ç¼ºçœçš„å®ç°ã€‚ ç»„åˆå¯¹è±¡(Composite)è§’è‰²ï¼šé€šå¸¸ä¼šå­˜å‚¨å­ç»„ä»¶(ç»„åˆå¯¹è±¡ã€å¶å­å¯¹è±¡)ï¼Œå®šä¹‰åŒ…å«å­ç»„ä»¶çš„é‚£äº›ç»„ä»¶çš„è¡Œä¸ºï¼Œå¹¶å®ç°åœ¨æŠ½è±¡ç»„ä»¶ä¸­å®šä¹‰çš„ä¸å­ç»„ä»¶æœ‰å…³çš„æ“ä½œï¼Œä¾‹å¦‚å­ç»„ä»¶çš„æ·»åŠ (addChild)å’Œåˆ é™¤(removeChild)ç­‰ã€‚ å¶å­å¯¹è±¡(Leaf)è§’è‰²ï¼šå®šä¹‰å’Œå®ç°å¶å­å¯¹è±¡çš„è¡Œä¸ºï¼Œå¹¶ä¸”å®ƒä¸å†åŒ…å«å…¶ä»–çš„å­èŠ‚ç‚¹å¯¹è±¡ã€‚ å®¢æˆ·ç«¯(Client)è§’è‰²ï¼šé€šè¿‡Componentæ¥å£æ¥ç»Ÿä¸€æ“ä½œç»„åˆå¯¹è±¡å’Œå¶å­å¯¹è±¡ï¼Œä»¥åˆ›å»ºå‡ºæ•´ä¸ªå¯¹è±¡æ ‘ç»“æ„ã€‚ ç»„åˆæ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šå…ˆçœ‹çœ‹æŠ½è±¡ç»„ä»¶ç±»çš„å®šä¹‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ /** * æŠ½è±¡çš„ç»„ä»¶å¯¹è±¡ï¼Œä¸ºç»„åˆä¸­çš„å¯¹è±¡å£°æ˜æ¥å£ï¼Œå®ç°æ¥å£çš„ç¼ºçœè¡Œä¸º */ public abstract class Component { // ç¤ºæ„æ–¹æ³•ï¼Œå­ç»„ä»¶å¯¹è±¡å¯èƒ½æœ‰çš„åŠŸèƒ½æ–¹æ³• public abstract void someOperation(String preStr); public void addChild(Component child) { // ç¼ºçœçš„å®ç°ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºå¶å­å¯¹è±¡æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ–å­ç±»æœªå®ç°è¿™ä¸ªåŠŸèƒ½ throw new UnsupportedOperationException(&quot;å¯¹è±¡ä¸æ”¯æŒæ­¤åŠŸèƒ½&quot;); } public void removeChild(Component child) { // ç¼ºçœçš„å®ç°ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºå¶å­å¯¹è±¡æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ–å­ç±»æœªå®ç°è¿™ä¸ªåŠŸèƒ½ throw new UnsupportedOperationException(&quot;å¯¹è±¡ä¸æ”¯æŒæ­¤åŠŸèƒ½&quot;); } public Component getChildren(int index) { // ç¼ºçœçš„å®ç°ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºå¶å­å¯¹è±¡æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ–å­ç±»æœªå®ç°è¿™ä¸ªåŠŸèƒ½ throw new UnsupportedOperationException(&quot;å¯¹è±¡ä¸æ”¯æŒæ­¤åŠŸèƒ½&quot;); } } æ¥ä¸‹æ¥çœ‹çœ‹ç»„åˆç±»çš„å®šä¹‰ï¼Œç¤ºæ„ä»£ç å¦‚ä¸‹ã€‚ import java.util.ArrayList; import java.util.List; public class Composite extends Component { /** * ç¤ºæ„å±æ€§ï¼Œç»„ä»¶çš„åå­— */ private String name = &quot;&quot;; public Composite(String name) { this.name = name; } /** * ç”¨æ¥å­˜å‚¨ç»„åˆå¯¹è±¡ä¸­åŒ…å«çš„å­ç»„ä»¶å¯¹è±¡ */ private List&lt;Component&gt; childComponents = null; /** * ç¤ºæ„æ–¹æ³•ï¼Œæ­¤å¤„ç”¨äºè¾“å‡ºç»„ä»¶çš„æ ‘å½¢ç»“æ„ï¼Œé€šå¸¸åœ¨é‡Œé¢éœ€è¦å®ç°é€’å½’çš„è°ƒç”¨ */ @Override public void someOperation(String preStr) { // å…ˆæŠŠè‡ªå·±è¾“å‡º System.out.println(preStr + &quot;+&quot; + name); // å¦‚æœè¿˜åŒ…å«å…¶ä»–å­ç»„ä»¶ï¼Œé‚£ä¹ˆå°±è¾“å‡ºè¿™äº›å­ç»„ä»¶å¯¹è±¡ if (null != childComponents) { // æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œè¡¨ç¤ºå‘åç¼©è¿›ä¸€ä¸ªç©ºæ ¼ preStr += &quot; &quot;; // è¾“å‡ºå½“å‰å¯¹è±¡çš„å­ç»„ä»¶å¯¹è±¡ for (Component component : childComponents) { // é€’å½’åœ°è¿›è¡Œå­ç»„ä»¶ç›¸åº”æ–¹æ³•çš„è°ƒç”¨ï¼Œè¾“å‡ºæ¯ä¸ªå­ç»„ä»¶å¯¹è±¡ component.someOperation(preStr); } } } /** * å‘ç»„åˆå¯¹è±¡ä¸­æ·»åŠ ç»„ä»¶å¯¹è±¡ */ public void addChild(Component child) { // å»¶è¿Ÿåˆå§‹åŒ– if (null == childComponents) { childComponents = new ArrayList&lt;Component&gt;(); } childComponents.add(child); } /** * ä»ç»„åˆå¯¹è±¡ä¸­ç§»é™¤ç»„ä»¶å¯¹è±¡ */ public void removeChild(Component child) { if (null != childComponents) { childComponents.remove(child); } } /** * æ ¹æ®ç´¢å¼•è·å–ç»„åˆå¯¹è±¡ä¸­å¯¹åº”çš„ç»„ä»¶å¯¹è±¡ */ public Component getChildren(int index) { if (null != childComponents) { if (index &gt;= 0 &amp;&amp; index &lt; childComponents.size()) { return childComponents.get(index); } } return null; } } å†æ¥çœ‹çœ‹å¶å­ç±»çš„å®šä¹‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Leaf extends Component { /** * ç¤ºæ„å±æ€§ï¼Œç»„ä»¶çš„åå­— */ private String name = &quot;&quot;; public Leaf(String name) { this.name = name; } /** * ç¤ºæ„æ–¹æ³•ï¼Œæ­¤å¤„ç”¨äºè¾“å‡ºç»„ä»¶çš„æ ‘å½¢ç»“æ„ */ @Override public void someOperation(String preStr) { System.out.println(preStr + &quot;-&quot; + name); } } åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨Componentæ¥å£æ¥æ“ä½œç»„åˆå¯¹è±¡ç»“æ„ï¼Œç¤ºæ„ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // å®šä¹‰å¤šä¸ªCompositeç»„åˆå¯¹è±¡ Component root = new Composite(&quot;æœè£…&quot;); Component c1 = new Composite(&quot;ç”·è£…&quot;); Component c2 = new Composite(&quot;å¥³è£…&quot;); Component c3 = new Composite(&quot;æ¯å©´&quot;); // å®šä¹‰å¤šä¸ªLeafå¶å­å¯¹è±¡ Component leaf1 = new Leaf(&quot;è¥¿æœ&quot;); Component leaf2 = new Leaf(&quot;å¤¹å…‹&quot;); Component leaf3 = new Leaf(&quot;è¡¬è¡«&quot;); Component leaf4 = new Leaf(&quot;è£™å­&quot;); Component leaf5 = new Leaf(&quot;å¥—è£…&quot;); Component leaf6 = new Leaf(&quot;é‹è¢œ&quot;); Component leaf7 = new Leaf(&quot;å­•å¦‡è£…&quot;); Component leaf8 = new Leaf(&quot;å©´å„¿è£…&quot;); // ç»„åˆæˆä¸ºæ ‘å½¢çš„å¯¹è±¡ç»“æ„ root.addChild(c1); root.addChild(c2); root.addChild(leaf6); c1.addChild(leaf1); c1.addChild(leaf2); c1.addChild(leaf3); c2.addChild(leaf4); c2.addChild(leaf5); c2.addChild(c3); c3.addChild(leaf7); c3.addChild(leaf8); // è°ƒç”¨æ ¹å¯¹è±¡çš„è¾“å‡ºåŠŸèƒ½è¾“å‡ºæ•´æ£µæ ‘ root.someOperation(&quot;&quot;); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š +æœè£…&emsp;&emsp;+ç”·è£…&emsp;&emsp;&emsp;&emsp;-è¥¿æœ&emsp;&emsp;&emsp;&emsp;-å¤¹å…‹&emsp;&emsp;&emsp;&emsp;-è¡¬è¡«&emsp;&emsp;+å¥³è£…&emsp;&emsp;&emsp;&emsp;-è£™å­&emsp;&emsp;&emsp;&emsp;-å¥—è£…&emsp;&emsp;&emsp;&emsp;+æ¯å©´&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;-å­•å¦‡è£…&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;-å©´å„¿è£…&emsp;&emsp;-é‹è¢œ ä»ä»¥ä¸Šçš„ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œç»„åˆæ¨¡å¼çš„å…³é”®å°±åœ¨äºæŠ½è±¡ç»„ä»¶è§’è‰²ï¼Œä½œä¸ºç»„åˆå¯¹è±¡å’Œå¶å­å¯¹è±¡çš„çˆ¶ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç»„ä»¶ç±»æ—¢å¯ä»¥ä»£è¡¨å¶å­å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä»£è¡¨ç»„åˆå¯¹è±¡ï¼Œè¿™æ ·ç”¨æˆ·åœ¨æ“ä½œçš„æ—¶å€™ï¼Œå§‹ç»ˆæ˜¯åœ¨æ“ä½œç»„ä»¶å¯¹è±¡ï¼Œä¸å¿…å†å»åŒºåˆ†æ˜¯åœ¨æ“ä½œç»„åˆå¯¹è±¡è¿˜æ˜¯å¶å­å¯¹è±¡ï¼Œä»è€Œä½¿å¾—å¯¹å¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰äº†ä¸€è‡´æ€§ã€‚ å››ã€ç»„åˆæ¨¡å¼çš„å®‰å…¨æ€§å’Œé€æ˜æ€§ ç»„åˆæ¨¡å¼çš„å®‰å…¨æ€§æ˜¯æŒ‡ï¼šä»å®¢æˆ·ä½¿ç”¨ç»„åˆæ¨¡å¼ä¸Šçœ‹æ˜¯å¦æ›´å®‰å…¨ã€‚å¦‚æœæ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæœ‰å‘ç”Ÿè¯¯æ“ä½œçš„å¯èƒ½ï¼Œèƒ½è®¿é—®çš„æ–¹æ³•éƒ½æ˜¯è¢«æ”¯æŒçš„åŠŸèƒ½ã€‚ ç»„åˆæ¨¡å¼çš„é€æ˜æ€§æ˜¯æŒ‡ï¼šä»å®¢æˆ·ä½¿ç”¨ç»„åˆæ¨¡å¼ä¸Šçœ‹æ˜¯å¦éœ€è¦åŒºåˆ†åˆ°åº•æ˜¯ç»„åˆå¯¹è±¡è¿˜æ˜¯å¶å­å¯¹è±¡ã€‚å¦‚æœæ˜¯é€æ˜çš„ï¼Œé‚£å°±ä¸ç”¨å†åŒºåˆ†ï¼Œå¯¹äºå®¢æˆ·è€Œè¨€ï¼Œéƒ½æ˜¯ç»„ä»¶å¯¹è±¡ï¼Œå…·ä½“çš„ç±»å‹å¯¹äºå®¢æˆ·è€Œè¨€æ˜¯é€æ˜çš„ï¼Œæ˜¯å®¢æˆ·æ— é¡»å…³å¿ƒçš„ã€‚ é€æ˜æ€§çš„å®ç°ï¼š å¦‚æœæŠŠç®¡ç†å­ç»„ä»¶çš„æ“ä½œå®šä¹‰åœ¨Componentä¸­ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åªéœ€è¦é¢å¯¹Componentï¼Œè€Œæ— é¡»å…³å¿ƒå…·ä½“çš„ç»„ä»¶ç±»å‹ï¼Œè¿™ç§å®ç°æ–¹å¼å°±æ˜¯é€æ˜æ€§çš„å®ç°ã€‚å‰é¢ç»“æ„ç¤ºæ„ä»£ç ä¸­å°±æ˜¯é‡‡ç”¨çš„è¿™ä¸€å®ç°æ–¹å¼ã€‚ ä½†æ˜¯é€æ˜æ€§çš„å®ç°æ˜¯ä»¥å®‰å…¨æ€§ä¸ºä»£ä»·çš„ï¼Œå› ä¸ºåœ¨Componentä¸­å®šä¹‰çš„ä¸€äº›æ–¹æ³•ï¼Œå¯¹äºå¶å­å¯¹è±¡æ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ¯”å¦‚å¢åŠ ã€åˆ é™¤å­ç»„ä»¶å¯¹è±¡ã€‚ä½†è¿™äº›æ–¹æ³•å¯¹å®¢æˆ·å´æ˜¯é€æ˜çš„ï¼Œå› æ­¤å®¢æˆ·å¯èƒ½ä¼šå¯¹å¶å­å¯¹è±¡è°ƒç”¨è¿™ç§å¢åŠ æˆ–åˆ é™¤å­ç»„ä»¶çš„æ–¹æ³•ï¼Œè¿™æ ·çš„æ“ä½œæ˜¯ä¸å®‰å…¨çš„ã€‚ ç»„åˆæ¨¡å¼çš„é€æ˜æ€§å®ç°ï¼Œé€šå¸¸çš„æ–¹å¼æ˜¯ï¼šåœ¨Componentä¸­å£°æ˜ç®¡ç†å­ç»„ä»¶çš„æ“ä½œï¼Œå¹¶åœ¨Componentä¸­ä¸ºè¿™äº›æ–¹æ³•æä¾›é»˜è®¤çš„å®ç°ï¼Œå¯¹äºå¶å­å¯¹è±¡ä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œæ¥è¡¨ç¤ºä¸æ”¯æŒè¿™ä¸ªåŠŸèƒ½ã€‚ å®‰å…¨æ€§çš„å®ç°ï¼š å¦‚æœæŠŠç®¡ç†å­ç»„ä»¶çš„æ“ä½œå®šä¹‰åœ¨Compositeä¸­ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åœ¨ä½¿ç”¨å¶å­å¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¸ä¼šå‘ç”Ÿä½¿ç”¨æ·»åŠ å­ç»„ä»¶æˆ–æ˜¯åˆ é™¤å­ç»„ä»¶çš„æ“ä½œäº†ï¼Œå› ä¸ºå‹æ ¹å°±æ²¡æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼Œè¿™ç§å®ç°æ–¹å¼æ˜¯å®‰å…¨çš„ã€‚ ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå°±å¿…é¡»åŒºåˆ†åˆ°åº•ä½¿ç”¨çš„æ˜¯Compositeå¯¹è±¡ï¼Œè¿˜æ˜¯å¶å­å¯¹è±¡ï¼Œä¸åŒå¯¹è±¡çš„åŠŸèƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚ ä¸¤ç§å®ç°æ–¹å¼çš„é€‰æ‹©ï¼š å¯¹äºç»„åˆæ¨¡å¼è€Œè¨€ï¼Œåœ¨å®‰å…¨æ€§å’Œé€æ˜æ€§ä¸Šï¼Œä¼šæ›´çœ‹é‡é€æ˜æ€§ï¼Œæ¯•ç«Ÿç»„åˆæ¨¡å¼çš„åŠŸèƒ½å°±æ˜¯è¦è®©ç”¨æˆ·å¯¹å¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚ å› æ­¤ï¼Œåœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼çš„æ—¶å€™ï¼Œåº”å¤šé‡‡ç”¨é€æ˜æ€§çš„å®ç°æ–¹å¼ï¼Œå°‘ç”¨å®‰å…¨æ€§çš„å®ç°æ–¹å¼ã€‚ äº”ã€ç»„åˆæ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä½¿ç”¨ç»„åˆæ¨¡å¼çš„ä¼˜ç‚¹ï¼š ç»Ÿä¸€äº†ç»„åˆå¯¹è±¡å’Œå¶å­å¯¹è±¡ã€‚ ç®€åŒ–äº†å®¢æˆ·ç«¯è°ƒç”¨ï¼Œæ— é¡»åŒºåˆ†æ“ä½œçš„æ˜¯ç»„åˆå¯¹è±¡è¿˜æ˜¯å¶å­å¯¹è±¡ã€‚ æ›´å®¹æ˜“æ‰©å±•ï¼Œæœ‰äº†Componentçš„çº¦æŸï¼Œæ–°å®šä¹‰çš„Compositeæˆ–Leafå­ç±»èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°ä¸å·²æœ‰çš„ç»“æ„ä¸€èµ·å·¥ä½œã€‚ ä½¿ç”¨ç»„åˆæ¨¡å¼çš„ç¼ºç‚¹ï¼š å¾ˆéš¾é™åˆ¶ç»„åˆä¸­çš„ç»„ä»¶ç±»å‹ã€‚ å…­ã€æ€»ç»“ç»„åˆæ¨¡å¼é€šè¿‡æŠŠå¶å­å¯¹è±¡å½“æˆç‰¹æ®Šçš„ç»„åˆå¯¹è±¡çœ‹å¾…ï¼Œä»è€Œå¯¹å¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡ä¸€è§†åŒä»ï¼Œå…¨éƒ¨å½“æˆäº†Componentå¯¹è±¡ï¼Œæœ‰æœºåœ°ç»Ÿä¸€äº†å¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚ æ­£æ˜¯å› ä¸ºç»Ÿä¸€äº†å¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡ï¼Œåœ¨å°†å¯¹è±¡æ„å»ºæˆæ ‘å½¢ç»“æ„çš„æ—¶å€™ï¼Œæ‰ä¸éœ€è¦åšåŒºåˆ†ï¼Œåæ­£æ˜¯ç»„ä»¶å¯¹è±¡é‡Œé¢åŒ…å«å…¶ä»–çš„ç»„ä»¶å¯¹è±¡ï¼Œå¦‚æ­¤é€’å½’ä¸‹å»ï¼šä¹Ÿæ‰ä½¿å¾—å¯¹äºæ ‘å½¢ç»“æ„çš„æ“ä½œå˜å¾—ç®€å•ï¼Œä¸ç®¡å¯¹è±¡ç±»å‹ï¼Œç»Ÿä¸€æ“ä½œã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"ç»„åˆæ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"ç»„åˆæ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/ç»„åˆæ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--å¤‡å¿˜å½•æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--å¤‡å¿˜å½•æ¨¡å¼","date":"2020-05-24T08:54:51.000Z","updated":"2023-04-30T10:21:41.357Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å¤‡å¿˜å½•æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å¤‡å¿˜å½•æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯å¤‡å¿˜å½•æ¨¡å¼å¤‡å¿˜å½•(Memento)æ¨¡å¼åˆå«ä½œå¿«ç…§(Snapshot)æ¨¡å¼æˆ–Tokenæ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚åœ¨å¤‡å¿˜å½•æ¨¡å¼é‡Œï¼Œä¸€ä¸ªå¤‡å¿˜å½•æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå­˜å‚¨å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆå¤‡å¿˜å½•çš„åŸå‘å™¨ï¼‰åœ¨æŸä¸ªç¬é—´çš„å†…éƒ¨çŠ¶æ€ã€‚å¤‡å¿˜çš„ç›®çš„å°±æ˜¯ä¸ºäº†ä»¥ååœ¨éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥å°†åŸå‘å™¨å¯¹è±¡çš„çŠ¶æ€æ¢å¤ï¼ˆundo/rollbackï¼‰åˆ°å¤‡å¿˜å½•æ‰€ä¿å­˜çš„çŠ¶æ€ã€‚ å¤‡å¿˜å½•çš„æœ¬è´¨ï¼šä¿å­˜å’Œæ¢å¤çŠ¶æ€ è®¾è®¡æ„å›¾ï¼šåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·å°±å¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤ï¼ˆundo/rollbackï¼‰åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€äº†ã€‚ äºŒã€å¤‡å¿˜å½•æ¨¡å¼çš„ç»“æ„ å¤‡å¿˜å½•æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š åŸå‘å™¨(Originator)è§’è‰²ï¼šåŸå‘å™¨æ ¹æ®éœ€è¦å†³å®šå°†è‡ªå·±çš„å“ªäº›å†…éƒ¨çŠ¶æ€ä¿å­˜åˆ°å¤‡å¿˜å½•ä¸­ï¼Œå¹¶å¯ä»¥ä½¿ç”¨å¤‡å¿˜å½•æ¥æ¢å¤å†…éƒ¨çŠ¶æ€ã€‚ å¤‡å¿˜å½•(Memento)è§’è‰²ï¼šè´Ÿè´£å­˜å‚¨åŸå‘å™¨å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä½†æ˜¯å…·ä½“éœ€è¦å­˜å‚¨å“ªäº›çŠ¶æ€æ˜¯ç”±åŸå‘å™¨å¯¹è±¡æ¥å†³å®šçš„ã€‚å¦å¤–å¤‡å¿˜å½•åº”è¯¥åªèƒ½ç”±åŸå‘å™¨å¯¹è±¡æ¥è®¿é—®å®ƒå†…éƒ¨çš„æ•°æ®ï¼ŒåŸå‘å™¨å¤–éƒ¨çš„å¯¹è±¡ä¸åº”è¯¥è®¿é—®åˆ°å¤‡å¿˜å½•å¯¹è±¡çš„å†…éƒ¨æ•°æ®ã€‚ &emsp;&emsp;ä¸ºäº†æ§åˆ¶å¯¹å¤‡å¿˜å½•å¯¹è±¡çš„è®¿é—®ï¼Œå¤‡å¿˜å½•æ¨¡å¼ä¸­å‡ºç°äº†çª„æ¥å£å’Œå®½æ¥å£çš„æ¦‚å¿µã€‚ çª„æ¥å£ï¼šç®¡ç†è€…åªèƒ½çœ‹åˆ°å¤‡å¿˜å½•çš„çª„æ¥å£ï¼Œçª„æ¥å£çš„å®ç°ä¸­é€šå¸¸æ²¡æœ‰ä»»ä½•çš„æ–¹æ³•ï¼Œåªæ˜¯ä¸€ä¸ªç±»å‹æ ‡è¯†ã€‚çª„æ¥å£ä½¿å¾—ç®¡ç†è€…åªèƒ½å°†å¤‡å¿˜å½•ä¼ é€’ç»™å…¶ä»–å¯¹è±¡ã€‚ å®½æ¥å£ï¼šåŸå‘å™¨èƒ½å¤Ÿçœ‹åˆ°å¤‡å¿˜å½•çš„å®½æ¥å£ï¼Œä»è€Œå¯ä»¥ä»å¤‡å¿˜å½•ä¸­è·å–åˆ°æ‰€éœ€çš„æ•°æ®ï¼Œæ¥å°†è‡ªå·±æ¢å¤åˆ°å¤‡å¿˜å½•ä¸­æ‰€ä¿å­˜çš„çŠ¶æ€ã€‚ç†æƒ³æƒ…å†µæ˜¯ï¼šåªå…è®¸ç”Ÿæˆå¤‡å¿˜å½•çš„åŸå‘å™¨æ¥è®¿é—®è¯¥å¤‡å¿˜å½•çš„å†…éƒ¨çŠ¶æ€ï¼Œé€šå¸¸å®ç°æˆä¸ºåŸå‘å™¨å†…çš„ä¸€ä¸ªç§æœ‰å†…éƒ¨ç±»ã€‚ ç®¡ç†è€…(Caretaker)è§’è‰²:å¤‡å¿˜å½•ç®¡ç†è€…ï¼Œæˆ–è€…ç§°ä¸ºå¤‡å¿˜å½•è´Ÿè´£äººã€‚ä¸»è¦è´Ÿè´£ä¿å­˜å¥½å¤‡å¿˜å½•å¯¹è±¡ï¼Œä½†æ˜¯ä¸èƒ½å¯¹å¤‡å¿˜å½•å¯¹è±¡çš„å†…å®¹è¿›è¡Œæ“ä½œæˆ–æ£€æŸ¥ã€‚ å¤‡å¿˜å½•æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šå…ˆæ¥çœ‹çœ‹å¤‡å¿˜å½•çª„æ¥å£çš„å®šä¹‰ã€‚ /** * å¤‡å¿˜å½•çš„çª„æ¥å£ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•å®šä¹‰ */ public interface Memento { } å†çœ‹çœ‹åŸå‘å™¨è§’è‰²ï¼Œå®ƒé‡Œé¢ä¼šæœ‰å¤‡å¿˜å½•å¯¹è±¡çš„å®ç°ï¼Œæ­¤å¤„å°†çœŸæ­£çš„å¤‡å¿˜å½•å¯¹è±¡å½“ä½œåŸå‘å™¨å¯¹è±¡çš„ä¸€ä¸ªç§æœ‰å†…éƒ¨ç±»æ¥å®ç°ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š public class Originator { /** * ç¤ºæ„ï¼Œè¡¨ç¤ºåŸå‘å™¨çš„çŠ¶æ€ */ private String state = &quot;&quot;; /** * åˆ›å»ºå¤‡å¿˜å½•ï¼Œä¿å­˜åŸå‘å™¨çš„çŠ¶æ€ * * @return åˆ›å»ºå¥½çš„å¤‡å¿˜å½•å¯¹è±¡ */ public Memento createMemento() { return new MementoImpl(state); } /** * å°†åŸå‘å™¨æ¢å¤åˆ°å¤‡å¿˜å½•ä¸­ä¿å­˜çš„çŠ¶æ€ * * @param ä¿å­˜æœ‰åŸå‘å™¨çŠ¶æ€çš„å¤‡å¿˜å½•å¯¹è±¡ */ public void recoverFromMemento(Memento memento) { MementoImpl mementoImpl = (MementoImpl) memento; this.state = mementoImpl.getState(); } public String getState() { return state; } public void setState(String state) { this.state = state; } /** * çœŸæ­£çš„å¤‡å¿˜å½•å¯¹è±¡ï¼Œå®ç°äº†å¤‡å¿˜å½•çª„æ¥å£ å®ç°æˆç§æœ‰çš„å†…éƒ¨ç±»ï¼Œä¸è®©å¤–éƒ¨è®¿é—® */ private static class MementoImpl implements Memento { /** * ç¤ºæ„ï¼Œè¡¨ç¤ºéœ€è¦ä¿å­˜çš„çŠ¶æ€ */ private String state = &quot;&quot;; public MementoImpl(String state) { super(); this.state = state; } public String getState() { return state; } } } æ¥ä¸‹æ¥æ˜¯å¤‡å¿˜å½•ç®¡ç†è€…çš„ç¤ºä¾‹ä»£ç ã€‚ public class Caretaker { /** * è®°å½•è¢«ä¿å­˜çš„å¤‡å¿˜å½•å¯¹è±¡ */ private Memento memento = null; public Memento getMemento() { return memento; } public void setMemento(Memento memento) { this.memento = memento; } } åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªåŸå‘å™¨ Originator o = new Originator(); // è®¾ç½®å…¶åˆå§‹çŠ¶æ€ o.setState(&quot;state 0&quot;); // æ‰“å°åŸå‘å™¨å½“å‰çš„çŠ¶æ€ System.out.println(&quot;åŸå‘å™¨çš„åˆå§‹çŠ¶æ€ï¼š&quot; + o.getState()); // å°†åŸå‘å™¨å½“å‰çš„çŠ¶æ€ä¿å­˜åˆ°å¤‡å¿˜å½•ä¸­ Memento memento = o.createMemento(); // åˆ›å»ºä¸€ä¸ªç®¡ç†è€… Caretaker c = new Caretaker(); // å°†åˆ›å»ºå¥½çš„å¤‡å¿˜å½•äº¤ç»™ç®¡ç†è€…è¿›è¡Œç®¡ç† c.setMemento(memento); // æ”¹å˜åŸå‘å™¨çš„çŠ¶æ€ o.setState(&quot;state 1&quot;); // æ‰“å°åŸå‘å™¨å½“å‰çš„çŠ¶æ€ System.out.println(&quot;åŸå‘å™¨æ”¹è®ŠåçŠ¶æ€ï¼š&quot; + o.getState()); // å°†åŸå‘å™¨çŠ¶æ€æ¢å¤åˆ°å¤‡å¿˜å½•ä¿å­˜çš„çŠ¶æ€ o.recoverFromMemento(c.getMemento()); // å†æ¬¡æ‰“å°åŸå‘å™¨å½“å‰çš„çŠ¶æ€ System.out.println(&quot;åŸå‘å™¨æ¢å¾©åçŠ¶æ€ï¼š&quot; + o.getState()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š åŸå‘å™¨çš„åˆå§‹çŠ¶æ€ï¼šstate 0åŸå‘å™¨æ”¹è®ŠåçŠ¶æ€ï¼šstate 1åŸå‘å™¨æ¢å¾©åçŠ¶æ€ï¼šstate 0 åœ¨å¤‡å¿˜å½•æ¨¡å¼ä¸­ï¼Œå¤‡å¿˜å½•å¯¹è±¡é€šå¸¸ç”¨æ¥è®°å½•åŸå‘å™¨ä¸­éœ€è¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ï¼Œä¸ºäº†ä¸ç ´ååŸå‘å™¨å¯¹è±¡çš„å°è£…æ€§ï¼Œä¸€èˆ¬åªè®©åŸå‘å™¨è‡ªå·±æ¥æ“ä½œå®ƒçš„å¤‡å¿˜å½•å¯¹è±¡ã€‚ä¸ºäº†ä¿è¯è¿™ä¸€ç‚¹ï¼Œé€šå¸¸ä¼šæŠŠå¤‡å¿˜å½•å¯¹è±¡ä½œä¸ºåŸå‘å™¨å¯¹è±¡çš„å†…éƒ¨ç±»æ¥å®ç°ï¼Œè€Œä¸”å®ç°æˆç§æœ‰çš„ï¼Œè¿™æ ·å°±æ–­äº†å¤–éƒ¨æ¥è®¿é—®è¿™ä¸ªå¤‡å¿˜å½•å¯¹è±¡çš„é€”å¾„ã€‚ æŠŠå¤‡å¿˜å½•å¯¹è±¡è®¾è®¡æˆä¸ºä¸€ä¸ªç§æœ‰çš„å†…éƒ¨ç±»ï¼Œå¤–éƒ¨åªèƒ½é€šè¿‡å¤‡å¿˜å½•å¯¹è±¡çš„çª„æ¥å£æ¥è·å–å¤‡å¿˜å½•å¯¹è±¡ï¼Œè€Œè¿™ä¸ªæ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œä»…ä»…èµ·åˆ°äº†ä¸€ä¸ªæ ‡è¯†å¯¹è±¡ç±»å‹çš„ä½œç”¨ï¼Œä»è€Œä¿è¯å†…éƒ¨çš„æ•°æ®ä¸ä¼šè¢«å¤–éƒ¨è·å–æˆ–æ˜¯æ“ä½œï¼Œä¿è¯äº†åŸå‘å™¨å¯¹è±¡çš„å°è£…æ€§ï¼Œä¹Ÿå°±ä¸å†æš´éœ²åŸå‘å™¨å¯¹è±¡åœ¨å†…éƒ¨ç»“æ„äº†ã€‚ ä¸‰ã€å¤‡å¿˜å½•æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼ï¼š å¦‚æœå¿…é¡»ä¿å­˜ä¸€ä¸ªå¯¹è±¡åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„å…¨éƒ¨æˆ–éƒ¨åˆ†çŠ¶æ€ï¼Œæ–¹ä¾¿åœ¨ä»¥åéœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠè¯¥å¯¹è±¡æ¢å¤åˆ°å…ˆå‰çš„çŠ¶æ€ã€‚ å¦‚æœéœ€è¦ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä½†æ˜¯å¦‚æœç”¨æ¥å£æ¥è®©å…¶å®ƒå¯¹è±¡ç›´æ¥å¾—åˆ°è¿™äº›éœ€è¦ä¿å­˜çš„çŠ¶æ€ï¼Œå°†ä¼šæš´éœ²å¯¹è±¡çš„å®ç°ç»†èŠ‚å¹¶ç ´åå¯¹è±¡çš„å°è£…æ€§ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼ï¼ŒæŠŠå¤‡å¿˜å½•å¯¹è±¡å®ç°æˆä¸ºåŸå‘å™¨å¯¹è±¡çš„ç§æœ‰å†…éƒ¨ç±»ï¼Œä»è€Œä¿è¯åªæœ‰åŸå‘å™¨å¯¹è±¡æ‰èƒ½è®¿é—®è¯¥å¤‡å¿˜å½•å¯¹è±¡ã€‚è¿™æ ·æ—¢ä¿å­˜äº†éœ€è¦ä¿å­˜çš„çŠ¶æ€ï¼Œåˆä¸ä¼šæš´éœ²åŸå‘å™¨å¯¹è±¡çš„å†…éƒ¨å®ç°ç»†èŠ‚ã€‚ å››ã€å¤‡å¿˜å½•æ¨¡å¼çš„å®ç° å¢é‡å­˜å‚¨ï¼šå¦‚æœéœ€è¦é¢‘ç¹åœ°åˆ›å»ºå¤‡å¿˜å½•å¯¹è±¡ï¼Œè€Œä¸”åˆ›å»ºå’Œåº”ç”¨å¤‡å¿˜å½•å¯¹è±¡æ¥æ¢å¤çŠ¶æ€çš„é¡ºåºæ˜¯å¯æ§çš„ï¼Œé‚£ä¹ˆå¯ä»¥è®©å¤‡å¿˜å½•è¿›è¡Œå¢é‡å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯å¤‡å¿˜å½•å¯ä»¥ä»…ä»…å­˜å‚¨åŸå‘å™¨å†…éƒ¨ç›¸å¯¹äºä¸Šä¸€æ¬¡å­˜å‚¨çŠ¶æ€åçš„å¢é‡æ”¹å˜ã€‚ ç»“åˆåŸå‹æ¨¡å¼ï¼šåœ¨åŸå‘å™¨å¯¹è±¡åˆ›å»ºå¤‡å¿˜å½•å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœåŸå‘å™¨å¯¹è±¡ä¸­å…¨éƒ¨æˆ–è€…å¤§éƒ¨åˆ†çš„çŠ¶æ€éƒ½éœ€è¦ä¿å­˜ï¼Œä¸€ä¸ªç®€æ´çš„æ–¹å¼å°±æ˜¯ç›´æ¥å…‹éš†ä¸€ä¸ªåŸå‘å™¨å¯¹è±¡ã€‚ ç¦»çº¿å­˜å‚¨ï¼šå¤‡å¿˜å½•çš„æ•°æ®å¯ä»¥å®ç°æˆä¸ºç¦»çº¿å­˜å‚¨ï¼Œé™¤äº†å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿˜å¯ä»¥æŠŠå¤‡å¿˜å½•æ•°æ®å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ã€XMLä¸­ã€æ•°æ®åº“ä¸­ï¼Œä»è€Œæ”¯æŒè·¨è¶Šä¼šè¯çš„å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½ã€‚ äº”ã€å¤‡å¿˜å½•æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼çš„ä¼˜ç‚¹ï¼š æ›´å¥½çš„å°è£…æ€§å¤‡å¿˜å½•æ¨¡å¼é€šè¿‡ä½¿ç”¨å¤‡å¿˜å½•å¯¹è±¡ï¼Œæ¥å°è£…åŸå‘å™¨å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œè™½ç„¶è¿™ä¸ªå¯¹è±¡æ˜¯ä¿å­˜åœ¨åŸå‘å™¨å¯¹è±¡çš„å¤–éƒ¨ï¼Œä½†æ˜¯ç”±äºå¤‡å¿˜å½•å¯¹è±¡çš„çª„æ¥å£å¹¶ä¸æä¾›ä»»ä½•æ–¹æ³•ã€‚è¿™æ ·æœ‰æ•ˆåœ°ä¿è¯äº†å¯¹åŸå‘å™¨å¯¹è±¡å†…éƒ¨çŠ¶æ€çš„å°è£…ï¼Œä¸æŠŠåŸå‘å™¨å¯¹è±¡çš„å†…éƒ¨å®ç°ç»†èŠ‚æš´éœ²ç»™å¤–éƒ¨ã€‚ ç®€åŒ–äº†åŸå‘å™¨åœ¨å¤‡å¿˜å½•æ¨¡å¼ä¸­ï¼ŒåŸå‘å™¨ä¸å†éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„ä¸€ä¸ªä¸ªç‰ˆæœ¬ï¼Œè€Œæ˜¯äº¤ç”±ç®¡ç†è€…æˆ–å®¢æˆ·ç«¯å¯¹è¿™äº›çŠ¶æ€çš„ç‰ˆæœ¬è¿›è¡Œç®¡ç†ï¼Œä»è€Œè®©åŸå‘å™¨å¯¹è±¡å¾—åˆ°ç®€åŒ–ã€‚ çª„æ¥å£å’Œå®½æ¥å£å¤‡å¿˜å½•æ¨¡å¼ï¼Œé€šè¿‡å¼•å…¥çª„æ¥å£å’Œå®½æ¥å£ï¼Œä½¿å¾—ä¸åŒçš„åœ°æ–¹ï¼Œå¯¹å¤‡å¿˜å½•å¯¹è±¡çš„è®¿é—®æ˜¯ä¸ä¸€æ ·çš„ã€‚çª„æ¥å£ä¿è¯äº†åªæœ‰åŸå‘å™¨æ‰å¯ä»¥è®¿é—®å¤‡å¿˜å½•å¯¹è±¡å­˜å‚¨çš„çŠ¶æ€ã€‚ ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼çš„ç¼ºç‚¹ï¼š æ ‡å‡†çš„å¤‡å¿˜å½•æ¨¡å¼çš„å®ç°æœºåˆ¶æ˜¯ä¾é ç¼“å­˜æ¥å®ç°çš„ï¼Œå› æ­¤ï¼Œå½“éœ€è¦å¤‡å¿˜çš„æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œæˆ–è€…æ˜¯å­˜å‚¨çš„å¤‡å¿˜å½•å¯¹è±¡æ•°æ®é‡ä¸å¤§ä½†æ˜¯æ•°é‡å¾ˆå¤šçš„æ—¶å€™ï¼Œæˆ–è€…æ˜¯ç”¨æˆ·å¾ˆé¢‘ç¹åœ°åˆ›å»ºå¤‡å¿˜å½•å¯¹è±¡çš„æ—¶å€™ï¼Œè¿™äº›éƒ½ä¼šå¯¼è‡´éå¸¸å¤§çš„å¼€é”€ã€‚ ç®¡ç†è€…è´Ÿè´£ç»´æŠ¤å¤‡å¿˜å½•ï¼Œç„¶è€Œï¼Œç®¡ç†è€…å¹¶ä¸çŸ¥é“å¤‡å¿˜å½•ä¸­æœ‰å¤šå°‘ä¸ªçŠ¶æ€ã€‚å› æ­¤å½“å­˜å‚¨å¤‡å¿˜å½•æ—¶ï¼Œä¸€ä¸ªæœ¬æ¥å¾ˆå°çš„ç®¡ç†è€…ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„å­˜å‚¨å¼€é”€ã€‚ å…­ã€æ€»ç»“å¤‡å¿˜å½•æ¨¡å¼çš„åŠŸèƒ½ï¼Œé¦–å…ˆæ˜¯åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚è¿™é‡Œè¦æ³¨æ„ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯ä¸ç ´åå°è£…æ€§ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡ä¸èƒ½æš´éœ²å®ƒä¸åº”è¯¥æš´éœ²çš„ç»†èŠ‚ï¼›å¦å¤–ä¸€ä¸ªæ˜¯æ•è·çš„æ˜¯å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œè€Œä¸”é€šå¸¸è¿˜æ˜¯è¿è¡ŒæœŸé—´æŸä¸ªæ—¶åˆ»å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚ ä¹‹æ‰€ä»¥è¦æ•è·è¿™äº›å†…éƒ¨çŠ¶æ€ï¼Œæ˜¯ä¸ºäº†åœ¨ä»¥åçš„æŸä¸ªæ—¶å€™ï¼Œå¯ä»¥å°†è¯¥å¯¹è±¡çš„çŠ¶æ€æ¢å¤åˆ°å¤‡å¿˜å½•æ‰€ä¿å­˜çš„çŠ¶æ€ï¼Œè¿™æ‰æ˜¯å¤‡å¿˜å½•çœŸæ­£çš„ç›®çš„ã€‚å‰é¢ä¿å­˜çŠ¶æ€å°±æ˜¯ä¸ºäº†åé¢æ¢å¤ï¼Œè™½ç„¶ä¸æ˜¯ä¸€å®šè¦æ¢å¤ï¼Œä½†æ˜¯ç›®çš„æ˜¯ä¸ºäº†æ¢å¤ã€‚ åœ¨å¤‡å¿˜å½•æ¨¡å¼ä¸­ï¼Œå¤‡å¿˜å½•å¯¹è±¡é€šå¸¸ç”¨æ¥è®°å½•åŸå‘å™¨ä¸­éœ€è¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ï¼Œä¸ºäº†ä¸ç ´ååŸå‘å™¨å¯¹è±¡çš„å°è£…æ€§ï¼Œä¸€èˆ¬åªè®©åŸå‘å™¨è‡ªå·±æ¥æ“ä½œå®ƒçš„å¤‡å¿˜å½•å¯¹è±¡ã€‚ä¸ºäº†ä¿è¯è¿™ä¸€ç‚¹ï¼Œé€šå¸¸ä¼šæŠŠå¤‡å¿˜å½•å¯¹è±¡ä½œä¸ºåŸå‘å™¨å¯¹è±¡çš„å†…éƒ¨ç±»æ¥å®ç°ï¼Œè€Œä¸”å®ç°æˆç§æœ‰çš„ï¼Œè¿™æ ·å°±æ–­äº†å¤–éƒ¨æ¥è®¿é—®è¿™ä¸ªå¤‡å¿˜å½•å¯¹è±¡çš„é€”å¾„ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å¤‡å¿˜å½•æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å¤‡å¿˜å½•æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å¤‡å¿˜å½•æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--èŒè´£é“¾æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--èŒè´£é“¾æ¨¡å¼","date":"2020-05-24T08:53:40.000Z","updated":"2023-04-30T10:21:41.360Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--èŒè´£é“¾æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--èŒè´£é“¾æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯èŒè´£é“¾æ¨¡å¼èŒè´£é“¾(Chain of Responsibility)æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚åœ¨èŒè´£é“¾æ¨¡å¼é‡Œï¼Œå¾ˆå¤šå¯¹è±¡ç”±æ¯ä¸€ä¸ªå¯¹è±¡å¯¹å…¶ä¸‹å®¶çš„å¼•ç”¨è€Œè¿æ¥èµ·æ¥å½¢æˆä¸€æ¡é“¾ã€‚è¯·æ±‚åœ¨è¿™ä¸ªé“¾ä¸Šä¼ é€’ï¼Œç›´åˆ°é“¾ä¸Šçš„æŸä¸€ä¸ªå¯¹è±¡å†³å®šå¤„ç†æ­¤è¯·æ±‚ã€‚å‘å‡ºè¿™ä¸ªè¯·æ±‚çš„å®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“é“¾ä¸Šçš„å“ªä¸€ä¸ªå¯¹è±¡æœ€ç»ˆå¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿå¯ä»¥åœ¨ä¸å½±å“å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹åŠ¨æ€åœ°é‡æ–°ç»„ç»‡å’Œåˆ†é…èŒè´£ã€‚ èŒè´£é“¾æ¨¡å¼çš„æœ¬è´¨ï¼šåˆ†ç¦»èŒè´£ã€åŠ¨æ€ç»„åˆ è®¾è®¡æ„å›¾ï¼šä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ äºŒã€èŒè´£é“¾æ¨¡å¼çš„ç»“æ„ èŒè´£é“¾æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡å¤„ç†è€…(Handler)è§’è‰²ï¼šå®šä¹‰èŒè´£çš„æ¥å£ï¼Œé€šå¸¸åœ¨è¿™é‡Œå®šä¹‰å¤„ç†è¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚æœéœ€è¦ï¼Œæ¥å£å¯ä»¥å®šä¹‰å‡ºä¸€ä¸ªæ–¹æ³•ä»¥è®¾å®šå’Œè¿”å›å¯¹åç»§å¤„ç†è€…çš„å¼•ç”¨ã€‚ å…·ä½“å¤„ç†è€…(ConcreteHandler)è§’è‰²ï¼šå®ç°èŒè´£çš„ç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œå®ç°å¯¹åœ¨å®ƒèŒè´£èŒƒå›´å†…è¯·æ±‚çš„å¤„ç†ï¼Œå¦‚æœä¸å¤„ç†ï¼Œå°±ç»§ç»­è½¬å‘è¯·æ±‚ç»™åç»§å¤„ç†è€…ã€‚ å®¢æˆ·ç«¯(Client)è§’è‰²ï¼šèŒè´£é“¾çš„å®¢æˆ·ç«¯ï¼Œå‘é“¾ä¸Šçš„å…·ä½“å¤„ç†å¯¹è±¡æäº¤è¯·æ±‚ï¼Œè®©èŒè´£é“¾è´Ÿè´£å¤„ç†ã€‚ èŒè´£é“¾æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šæŠ½è±¡å¤„ç†è€…çš„ç¤ºæ„ä»£ç å¦‚ä¸‹ã€‚ /** * æŠ½è±¡å¤„ç†è€…ï¼Œå®šä¹‰èŒè´£çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯å¤„ç†è¯·æ±‚çš„æ¥å£ */ public abstract class Handler { /** * æŒæœ‰åç»§çš„å¤„ç†è€…å¯¹è±¡ */ protected Handler successor; /** * èµ‹å€¼æ–¹æ³•ï¼Œè®¾ç½®åç»§çš„å¤„ç†è€…å¯¹è±¡ * * @param successor */ public void setSuccessor(Handler successor) { this.successor = successor; } /** * ç¤ºæ„å¤„ç†è¯·æ±‚çš„æ–¹æ³•ï¼Œè™½ç„¶è¿™ä¸ªç¤ºæ„æ–¹æ³•æ˜¯æ²¡æœ‰ä¼ å…¥å‚æ•°çš„ ä½†å®é™…æ˜¯å¯ä»¥ä¼ å…¥å‚æ•°çš„ï¼Œæ ¹æ®å…·ä½“éœ€è¦æ¥é€‰æ‹©æ˜¯å¦ä¼ é€’å‚æ•° */ public abstract void handleRequest(); } å…·ä½“å¤„ç†è€…ç¤ºæ„ä»£ç å¦‚ä¸‹ã€‚ public class ConcreteHandlerA extends Handler { /** * å¤„ç†æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•å¤„ç†è¯·æ±‚ */ @Override public void handleRequest() { // æ ¹æ®æŸäº›æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´,ä¸‹é¢é€™å¥è©±åªæ˜¯ä¸ªç¤ºæ„ boolean someCondition = false; if (someCondition) { // å¦‚æœå±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œå°±åœ¨è¿™é‡Œå¤„ç†è¯·æ±‚ // å…·ä½“çš„å¤„ç†ä»£ç  } else { // å¦‚æœä¸å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œé‚£å°±åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åç»§çš„èŒè´£å¯¹è±¡ // å¦‚æœæœ‰ï¼Œå°±è½¬å‘è¯·æ±‚ç»™åç»§çš„èŒè´£å¯¹è±¡ // å¦‚æœæ²¡æœ‰ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè‡ªç„¶ç»“æŸ if (null != this.successor) { this.successor.handleRequest(); } } } } public class ConcreteHandlerB extends Handler { /** * å¤„ç†æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•å¤„ç†è¯·æ±‚ */ @Override public void handleRequest() { // æ ¹æ®æŸäº›æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´,ä¸‹é¢é€™å¥è©±åªæ˜¯ä¸ªç¤ºæ„ boolean someCondition = false; if (someCondition) { // å¦‚æœå±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œå°±åœ¨è¿™é‡Œå¤„ç†è¯·æ±‚ // å…·ä½“çš„å¤„ç†ä»£ç  } else { // å¦‚æœä¸å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œé‚£å°±åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åç»§çš„èŒè´£å¯¹è±¡ // å¦‚æœæœ‰ï¼Œå°±è½¬å‘è¯·æ±‚ç»™åç»§çš„èŒè´£å¯¹è±¡ // å¦‚æœæ²¡æœ‰ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè‡ªç„¶ç»“æŸ if (null != this.successor) { this.successor.handleRequest(); } } } } å®¢æˆ·ç«¯ç¤ºæ„ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // ç»„è£…èŒè´£é“¾ Handler handlerA = new ConcreteHandlerA(); Handler handlerB = new ConcreteHandlerB(); handlerA.setSuccessor(handlerB); // æäº¤è¯·æ±‚ handlerA.handleRequest(); } } ä¸‰ã€èŒè´£é“¾æ¨¡å¼åº”ç”¨ä¸¾ä¾‹ã€Šç ”ç£¨è®¾è®¡æ¨¡å¼ã€‹ä¸­ç»™å‡ºè¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼šç”³è¯·èšé¤è´¹ç”¨ã€‚å¾ˆå¤šå…¬å¸éƒ½æœ‰è¿™æ ·çš„ç¦åˆ©ï¼Œå°±æ˜¯é¡¹ç›®ç»„æˆ–è€…æ˜¯éƒ¨é—¨å¯ä»¥å‘å…¬å¸ç”³è¯·ä¸€äº›èšé¤è´¹ç”¨ï¼Œç”¨äºç»„ç»‡é¡¹ç›®ç»„æˆå‘˜æˆ–è€…æ˜¯éƒ¨é—¨æˆå‘˜è¿›è¡Œèšé¤æ´»åŠ¨ï¼Œä»¥å¢è¿›å‘˜å·¥ä¹‹é—´çš„æ„Ÿæƒ…ï¼Œæ›´æœ‰åˆ©äºå·¥ä½œä¸­çš„ç›¸äº’åˆä½œã€‚ ç”³è¯·èšé¤è´¹ç”¨çš„å¤§è‡´æµç¨‹ä¸€èˆ¬æ˜¯ï¼šç”±ç”³è¯·äººå…ˆå¡«å†™ç”³è¯·å•ï¼Œç„¶åäº¤ç»™é¢†å¯¼å®¡æ‰¹ï¼Œå¦‚æœç”³è¯·æ‰¹å‡†ä¸‹æ¥ï¼Œé¢†å¯¼ä¼šé€šçŸ¥ç”³è¯·äººå®¡æ‰¹é€šè¿‡ï¼Œç„¶åç”³è¯·äººå»è´¢åŠ¡é¢†å–è´¹ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ‰¹å‡†ä¸‹æ¥ï¼Œé¢†å¯¼ä¼šé€šçŸ¥ç”³è¯·äººå®¡æ‰¹æœªé€šè¿‡ï¼Œæ­¤äº‹ä¹Ÿå°±æ­¤ä½œç½¢ã€‚ ä¸åŒçº§åˆ«çš„é¢†å¯¼ï¼Œå¯¹äºå®¡æ‰¹çš„é¢åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ï¼Œé¡¹ç›®ç»ç†åªèƒ½å®¡æ‰¹500å…ƒä»¥å†…çš„ç”³è¯·ï¼›éƒ¨é—¨ç»ç†èƒ½å®¡æ‰¹1000å…ƒä»¥å†…çš„ç”³è¯·ï¼›è€Œæ€»ç»ç†å¯ä»¥å®¡æ ¸ä»»æ„é¢åº¦çš„ç”³è¯·ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŸäººæå‡ºèšé¤è´¹ç”¨ç”³è¯·çš„è¯·æ±‚åï¼Œè¯¥è¯·æ±‚ä¼šç»ç”±é¡¹ç›®ç»ç†ã€éƒ¨é—¨ç»ç†ã€æ€»ç»ç†ä¹‹ä¸­çš„æŸä¸€ä½é¢†å¯¼æ¥è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œä½†æ˜¯æå‡ºç”³è¯·çš„äººå¹¶ä¸çŸ¥é“æœ€ç»ˆä¼šç”±è°æ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œä¸€èˆ¬ç”³è¯·äººæ˜¯æŠŠè‡ªå·±çš„ç”³è¯·æäº¤ç»™é¡¹ç›®ç»ç†ï¼Œæˆ–è®¸æœ€åæ˜¯ç”±æ€»ç»ç†æ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œä½†æ˜¯ç”³è¯·äººå¹¶ä¸çŸ¥é“åº”è¯¥ç”±æ€»ç»ç†æ¥å¤„ç†ä»–çš„ç”³è¯·ã€‚ ä¸Šè¿°åŠŸèƒ½å¯ä»¥ä½¿ç”¨èŒè´£é“¾æ¨¡å¼æ¥å®ç°ï¼šå½“æŸäººæå‡ºèšé¤è´¹ç”¨ç”³è¯·çš„è¯·æ±‚åï¼Œè¯¥è¯·æ±‚ä¼šåœ¨ é¡¹ç›®ç»ç†â€”ã€‰éƒ¨é—¨ç»ç†â€”ã€‰æ€»ç»ç† è¿™æ ·ä¸€æ¡é¢†å¯¼å¤„ç†é“¾ä¸Šè¿›è¡Œä¼ é€’ï¼Œå‘å‡ºè¯·æ±‚çš„äººå¹¶ä¸çŸ¥é“è°ä¼šæ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œæ¯ä¸ªé¢†å¯¼ä¼šæ ¹æ®è‡ªå·±çš„èŒè´£èŒƒå›´ï¼Œæ¥åˆ¤æ–­æ˜¯å¤„ç†è¯·æ±‚è¿˜æ˜¯æŠŠè¯·æ±‚äº¤ç»™æ›´é«˜çº§åˆ«çš„é¢†å¯¼ï¼Œåªè¦æœ‰é¢†å¯¼å¤„ç†äº†ï¼Œä¼ é€’å°±ç»“æŸäº†ã€‚ éœ€è¦æŠŠæ¯ä½é¢†å¯¼çš„å¤„ç†ç‹¬ç«‹å‡ºæ¥ï¼Œå®ç°æˆå•ç‹¬çš„èŒè´£å¤„ç†å¯¹è±¡ï¼Œç„¶åä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªå…¬å…±çš„ã€æŠ½è±¡çš„çˆ¶èŒè´£å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯æ¥åŠ¨æ€åœ°ç»„åˆèŒè´£é“¾ï¼Œå®ç°ä¸åŒçš„åŠŸèƒ½è¦æ±‚äº†ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨èŒè´£é“¾æ¨¡å¼å®ç°ç¤ºä¾‹çš„ç±»å›¾ç»“æ„ã€‚ å…ˆå®šä¹‰æŠ½è±¡å¤„ç†è€…è§’è‰²ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ï¼ŒåŒæ—¶è¿˜è¦å®šä¹‰ä¸šåŠ¡å¤„ç†æ–¹æ³•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š /** * æŠ½è±¡å¤„ç†è€…ï¼Œå®šä¹‰èŒè´£çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯å¤„ç†è¯·æ±‚çš„æ¥å£ */ public abstract class Handler { /** * æŒæœ‰åç»§çš„å¤„ç†è€…å¯¹è±¡ */ protected Handler successor=null; /** * èµ‹å€¼æ–¹æ³•ï¼Œè®¾ç½®åç»§çš„å¤„ç†è€…å¯¹è±¡ * * @param successor */ public void setSuccessor(Handler successor) { this.successor = successor; } /** * å¤„ç†èšé¤è´¹ç”¨çš„ç”³è¯· * @param user ç”³è¯·äºº * @param fee ç”³è¯·çš„é’±æ•° */ public abstract String handleFeeRequest(String user,double fee); } å‡è®¾ç°åœ¨çš„è´¹ç”¨ç”³è¯·å¤„ç†æµç¨‹å¦‚ä¸‹ï¼šç”³è¯·äººæå‡ºçš„ç”³è¯·äº¤ç»™é¡¹ç›®ç»ç†å¤„ç†ï¼Œé¡¹ç›®ç»ç†çš„å¤„ç†æƒé™æ˜¯500å…ƒå†…ï¼Œè¶…è¿‡500å…ƒï¼ŒæŠŠç”³è¯·è½¬ç»™éƒ¨é—¨ç»ç†å¤„ç†ï¼Œéƒ¨é—¨ç»ç†çš„å¤„ç†æƒé™æ˜¯1000å…ƒä»¥å†…ï¼Œè¶…è¿‡1000å…ƒï¼ŒæŠŠç”³è¯·è½¬ç»™æ€»ç»ç†å¤„ç†ã€‚å…·ä½“å¤„ç†è€…ä»£ç å®ç°å¦‚ä¸‹ï¼š public class ProjectManager extends Handler { public String handleFeeRequest(String user,double fee) { String str=&quot;&quot;; //é¡¹ç›®ç»ç†å¤„ç†æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½å¤„ç†500å…ƒä»¥å†…çš„è´¹ç”¨ç”³è¯· if(fee&lt;500){ //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ç”³è¯· if(&quot;å°æ&quot;.equals(user)){ str=&quot;é¡¹ç›®ç»ç†åŒæ„&quot;+user+&quot;èšé¤è´¹ç”¨&quot;+fee+&quot;å…ƒçš„è¯·æ±‚...&quot;; } else{ //å…¶ä»–äººçš„ç”³è¯·ä¸€å¾‹ä¸åŒæ„ str=&quot;é¡¹ç›®ç»ç†ä¸åŒæ„&quot;+user+&quot;èšé¤è´¹ç”¨&quot;+fee+&quot;å…ƒçš„è¯·æ±‚...&quot;; } } else{ //è¶…è¿‡500å…ƒçš„è´¹ç”¨ç”³è¯·ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if(this.successor!=null){ return successor.handleFeeRequest(user, fee); } } return str; } } public class DeptManager extends Handler { public String handleFeeRequest(String user, double fee) { String str = &quot;&quot;; // éƒ¨é—¨ç»ç†åªèƒ½å¤„ç†500å…ƒä»¥å†…çš„è´¹ç”¨ç”³è¯· if (fee &lt; 1000) { // ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ç”³è¯· if (&quot;å°æ&quot;.equals(user)) { str = &quot;éƒ¨é—¨ç»ç†åŒæ„&quot; + user + &quot;èšé¤è´¹ç”¨&quot; + fee + &quot;å…ƒçš„è¯·æ±‚...&quot;; } else { // å…¶ä»–äººçš„ç”³è¯·ä¸€å¾‹ä¸åŒæ„ str = &quot;éƒ¨é—¨ç»ç†ä¸åŒæ„&quot; + user + &quot;èšé¤è´¹ç”¨&quot; + fee + &quot;å…ƒçš„è¯·æ±‚...&quot;; } } else { // è¶…è¿‡1000å…ƒçš„è´¹ç”¨ç”³è¯·ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return successor.handleFeeRequest(user, fee); } } return str; } } public class GeneralManager extends Handler { public String handleFeeRequest(String user,double fee) { String str=&quot;&quot;; //æ€»ç»ç†çš„æƒé™å¾ˆå¤§ï¼Œåªè¦è¯·æ±‚åˆ°äº†è¿™é‡Œï¼Œä»–éƒ½å¯ä»¥å¤„ç† if(fee&gt;=1000){ //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ç”³è¯· if(&quot;å°æ&quot;.equals(user)){ str=&quot;æ€»ç»ç†åŒæ„&quot;+user+&quot;èšé¤è´¹ç”¨&quot;+fee+&quot;å…ƒçš„è¯·æ±‚...&quot;; } else{ //å…¶ä»–äººçš„ç”³è¯·ä¸€å¾‹ä¸åŒæ„ str=&quot;æ€»ç»ç†ä¸åŒæ„&quot;+user+&quot;èšé¤è´¹ç”¨&quot;+fee+&quot;å…ƒçš„è¯·æ±‚...&quot;; } } else{ //å¦‚æœè¿˜æœ‰åç»§çš„å¤„ç†è€…å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if(this.successor!=null){ return successor.handleFeeRequest(user, fee); } } return str; } } å®¢æˆ·ç«¯ç¤ºæ„ä»£ç å¦‚ä¸‹ï¼š public class Client { public static void main(String[] args) { // å…ˆè¦ç»„è£…è´£ä»»é“¾ Handler h1 = new GeneralManager(); Handler h2 = new DeptManager(); Handler h3 = new ProjectManager(); h3.setSuccessor(h2); h2.setSuccessor(h1); // å¼€å§‹æµ‹è¯• String ret1 = h3.handleFeeRequest(&quot;å°æ&quot;, 300); System.out.println(&quot;the ret1 = &quot; + ret1); String ret2 = h3.handleFeeRequest(&quot;å°å¼ &quot;, 300); System.out.println(&quot;the ret2 = &quot; + ret2); System.out.println(&quot;ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥&quot;); String ret3 = h3.handleFeeRequest(&quot;å°æ&quot;, 700); System.out.println(&quot;the ret3 = &quot; + ret3); String ret4 = h3.handleFeeRequest(&quot;å°å¼ &quot;, 700); System.out.println(&quot;the ret4 = &quot; + ret4); System.out.println(&quot;ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥&quot;); String ret5 = h3.handleFeeRequest(&quot;å°æ&quot;, 1500); System.out.println(&quot;the ret5 = &quot; + ret5); String ret6 = h3.handleFeeRequest(&quot;å°å¼ &quot;, 1500); System.out.println(&quot;the ret6 = &quot; + ret6); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š the ret1 = é¡¹ç›®ç»ç†åŒæ„å°æèšé¤è´¹ç”¨300.0å…ƒçš„è¯·æ±‚â€¦the ret2 = é¡¹ç›®ç»ç†ä¸åŒæ„å°å¼ èšé¤è´¹ç”¨300.0å…ƒçš„è¯·æ±‚â€¦ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥the ret3 = éƒ¨é—¨ç»ç†åŒæ„å°æèšé¤è´¹ç”¨700.0å…ƒçš„è¯·æ±‚â€¦the ret4 = éƒ¨é—¨ç»ç†ä¸åŒæ„å°å¼ èšé¤è´¹ç”¨700.0å…ƒçš„è¯·æ±‚â€¦ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥ï¿¥the ret5 = æ€»ç»ç†åŒæ„å°æèšé¤è´¹ç”¨1500.0å…ƒçš„è¯·æ±‚â€¦the ret6 = æ€»ç»ç†ä¸åŒæ„å°å¼ èšé¤è´¹ç”¨1500.0å…ƒçš„è¯·æ±‚â€¦ å››ã€èŒè´£é“¾æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨èŒè´£é“¾æ¨¡å¼ï¼š æœ‰å¤šä¸ªçš„å¯¹è±¡å¯ä»¥å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šã€‚ ä½ æƒ³åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚ å¯å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„å¯¹è±¡é›†åˆåº”è¢«åŠ¨æ€æŒ‡å®šã€‚ äº”ã€èŒè´£é“¾æ¨¡å¼çš„ä¼˜ç¼ºç‚¹èŒè´£é“¾æ¨¡å¼æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š è´£ä»»çš„åˆ†æ‹…ã€‚æ¯ä¸ªç±»åªéœ€è¦å¤„ç†è‡ªå·±è¯¥å¤„ç†çš„å·¥ä½œï¼ˆä¸è¯¥å¤„ç†çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡å®Œæˆï¼‰ï¼Œæ˜ç¡®å„ç±»çš„è´£ä»»èŒƒå›´ï¼Œç¬¦åˆç±»çš„æœ€å°å°è£…åŸåˆ™ã€‚ å¯ä»¥æ ¹æ®éœ€è¦è‡ªç”±ç»„åˆèŒè´£æµç¨‹ã€‚å¦‚æœèŒè´£æµç¨‹å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥é€šè¿‡é‡æ–°ç»„è£…å¯¹è±¡é“¾ä¾¿å¯é€‚åº”æ–°çš„èŒè´£æµç¨‹ã€‚ è¯·æ±‚è€…å’Œå¤„ç†è€…æ¾æ•£è€¦åˆã€‚è¯·æ±‚è€…å¹¶ä¸çŸ¥é“ä»–å‘èµ·çš„è¯·æ±‚çš„å¤„ç†è€…æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“è¯·æ±‚æ˜¯å¦‚ä½•è¢«å¤„ç†çš„ï¼Œä»–åªæ˜¯è´Ÿè´£å‘èŒè´£é“¾å‘å‡ºè¯·æ±‚å°±å¯ä»¥äº†ï¼Œå®ç°äº†è¯·æ±‚è€…å’Œå¤„ç†è€…ä¹‹é—´çš„è§£è€¦ã€‚ èŒè´£é“¾æ¨¡å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š äº§ç”Ÿå¾ˆå¤šç»†ç²’åº¦èŒè´£å¯¹è±¡èŒè´£é“¾æ¨¡å¼æŠŠåŠŸèƒ½åˆ†æ•£åˆ°å•ç‹¬çš„å¤„ç†è€…å¯¹è±¡ä¸­ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå¤„ç†è€…åªå¤„ç†ä¸€éƒ¨åˆ†çš„è¯·æ±‚ï¼Œåœ¨è¯·æ±‚å¤„ç†æµç¨‹å¾ˆå¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·ä¼šäº§ç”Ÿå¤§é‡çš„ç»†ç²’åº¦èŒè´£å¯¹è±¡ã€‚ ä¸ä¸€å®šèƒ½è¢«å¤„ç†èŒè´£é“¾æ¨¡å¼çš„æ¯ä¸ªèŒè´£å¯¹è±¡åªè´Ÿè´£å¤„ç†è‡ªå·±èŒè´£èŒƒå›´å†…çš„è¯·æ±‚ï¼Œå› æ­¤å¯èƒ½ä¼šå‡ºç°æŸä¸ªè¯·æ±‚ï¼Œåœ¨æ•´ä¸ªèŒè´£é“¾ä¸Šä¼ é€’å®Œäº†ï¼Œéƒ½æ²¡æœ‰èŒè´£å¯¹è±¡å¤„ç†å®ƒã€‚ å½±å“æ‰§è¡Œæ•ˆç‡å› ä¸ºå¤„ç†æ—¶ä»¥é“¾çš„å½¢å¼åœ¨å¯¹è±¡é—´ä¼ é€’æ¶ˆæ¯ï¼Œæ ¹æ®å®ç°æ–¹å¼ä¸åŒï¼Œæœ‰å¯èƒ½ä¼šå½±å“å¤„ç†çš„é€Ÿåº¦ã€‚ å…­ã€æ€»ç»“èŒè´£é“¾æ¨¡å¼ä»¥åˆ†ç¦»èŒè´£ä¸ºå‰æï¼Œå°†å¤æ‚çš„è¯·æ±‚å¤„ç†è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶åˆ†é…ç»™ä¸€ä¸ªä¸ªçš„èŒè´£ç±»ã€‚æ¯ä¸ªèŒè´£ç±»åªè´Ÿè´£å¤„ç†è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿è¡ŒæœŸé—´èŒè´£ç±»è¿›è¡ŒåŠ¨æ€ç»„åˆï¼Œå½¢æˆä¸€ä¸ªèŒè´£é“¾ï¼Œè¯·æ±‚åœ¨é“¾ä¸Šè¿›è¡Œä¼ é€’å’Œå¤„ç†ã€‚ åŠ¨æ€ç»„åˆæ‰æ˜¯èŒè´£ç±»æ¨¡å¼çš„ç²¾åæ‰€åœ¨ï¼Œå› ä¸ºè¦å®ç°è¯·æ±‚è€…å’Œå¤„ç†è€…çš„è§£è€¦ï¼Œè¯·æ±‚è€…ä¸çŸ¥é“è°æ‰æ˜¯çœŸæ­£çš„å¤„ç†è€…ï¼Œå› æ­¤è¦åŠ¨æ€åœ°æŠŠå¯èƒ½çš„å¤„ç†è€…ç»„åˆèµ·æ¥ï¼Œç”±äºç»„åˆçš„æ–¹å¼æ˜¯åŠ¨æ€çš„ï¼Œè¿™å°±æ„å‘³ç€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¿®æ”¹å’Œæ·»åŠ æ–°çš„å¤„ç†è€…ï¼Œä»è€Œè®©ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"èŒè´£é“¾æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"èŒè´£é“¾æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/èŒè´£é“¾æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--æ¡¥æ¥æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--æ¡¥æ¥æ¨¡å¼","date":"2020-05-24T08:52:17.000Z","updated":"2023-04-30T10:21:41.358Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--æ¡¥æ¥æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--æ¡¥æ¥æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯æ¡¥æ¥æ¨¡å¼æ¡¥æ¥(Bridge)æ¨¡å¼æ˜¯æ„é€ å‹çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚æ¡¥æ¥æ¨¡å¼åŸºäºç±»çš„æœ€å°è®¾è®¡åŸåˆ™ï¼Œé€šè¿‡ä½¿ç”¨å°è£…ï¼Œèšåˆä»¥åŠç»§æ‰¿ç­‰è¡Œä¸ºæ¥è®©ä¸åŒçš„ç±»æ‰¿æ‹…ä¸åŒçš„è´£ä»»ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯æŠŠæŠ½è±¡(abstraction)ä¸è¡Œä¸ºå®ç°(implementation)åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œå¯ä»¥ä¿æŒå„éƒ¨åˆ†çš„ç‹¬ç«‹æ€§ä»¥åŠåº”å¯¹å®ƒä»¬çš„åŠŸèƒ½æ‰©å±•ã€‚ äºŒã€æ¡¥æ¥æ¨¡å¼çš„åº”ç”¨åœºæ™¯ã€Šç ”ç£¨è®¾è®¡æ¨¡å¼ã€‹ä¸­ç»™å‡ºè¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼šå‘é€æ¶ˆæ¯ã€‚ ä»æ¶ˆæ¯çš„é‡è¦ç¨‹åº¦ä¸Šæ¥çœ‹ï¼Œæ¶ˆæ¯å¯ä»¥åˆ†ä¸ºæ™®é€šæ¶ˆæ¯ã€åŠ æ€¥æ¶ˆæ¯ä¸¤ç§ï¼Œä¸¤ç§æ¶ˆæ¯çš„ä¸šåŠ¡åŠŸèƒ½å¤„ç†æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚æ™®é€šæ¶ˆæ¯ç›´æ¥å‘é€å³å¯ï¼Œè€ŒåŠ æ€¥æ¶ˆæ¯é™¤äº†éœ€åœ¨å‘é€çš„æ¶ˆæ¯ä¸Šæ·»åŠ åŠ æ€¥æ ‡è¯†å¤–ï¼Œè¿˜éœ€æä¾›ç›‘æ§åŠŸèƒ½ï¼Œä»¥æ–¹ä¾¿å®¢æˆ·ç«¯äº†è§£åŠ æ€¥æ¶ˆæ¯çš„å¤„ç†è¿›åº¦ã€‚ ä»å‘é€æ¶ˆæ¯çš„æ–¹å¼ä¸Šæ¥çœ‹ï¼Œæ¶ˆæ¯åˆå¯ä»¥åˆ†ä¸ºç«™å†…çŸ­æ¶ˆæ¯å’ŒE-Mailä¸¤ç§ã€‚ åœ¨ä¸ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè¿™ä¹ˆåšï¼šè€ƒè™‘åˆ°æ™®é€šæ¶ˆæ¯å’ŒåŠ æ€¥æ¶ˆæ¯éƒ½å„æœ‰ç«™å†…çŸ­æ¶ˆæ¯å’ŒE-Mailä¸¤ç§å‘é€æ–¹å¼ï¼Œä¸ºäº†è®©å¤–éƒ¨èƒ½ç»Ÿä¸€æ“ä½œï¼Œå› æ­¤æŠŠæ¶ˆæ¯è®¾è®¡æˆæ¥å£ï¼Œæ™®é€šæ¶ˆæ¯çš„ä¸¤ç§å‘é€æ–¹å¼åˆ†åˆ«ä½œä¸ºè¯¥æ¥å£çš„ä¸¤ä¸ªå®ç°ï¼Œä½†åŠ æ€¥æ¶ˆæ¯é™¤äº†æœ‰åŸºæœ¬çš„å‘é€æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦æ·»åŠ ç›‘æ§åŠŸèƒ½ï¼Œå› æ­¤å°†åŠ æ€¥æ¶ˆæ¯ä¹ŸæŠ½å–ä¸ºæ¥å£ï¼ŒåŠ æ€¥æ¶ˆæ¯çš„ä¸¤ç§å‘é€æ–¹å¼åšä¸ºæ¥å£çš„ä¸¤ä¸ªå®ç°ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œç³»ç»Ÿçš„ç±»å›¾ç»“æ„è®¾è®¡å¦‚ä¸‹ã€‚ ä»”ç»†è§‚å¯Ÿè¿™ä¸ªç±»å›¾ï¼Œä¼šå‘ç°ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œé€šè¿‡è¿™ç§ç»§æ‰¿çš„æ–¹å¼æ¥æ‰©å±•æ¶ˆæ¯å¤„ç†ï¼Œä¼šéå¸¸ä¸æ–¹ä¾¿ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘ä»¬è¦åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªç‰¹æ€¥æ¶ˆæ¯çš„å¤„ç†ï¼šç‰¹æ€¥æ¶ˆæ¯ä¸éœ€è¦è¿›è¡Œç›‘æ§ï¼Œåªè¦æ²¡æœ‰å®Œæˆï¼Œå°±ç›´æ¥å‚¬ä¿ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºç‰¹æ€¥æ¶ˆæ¯ï¼Œåœ¨æ™®é€šæ¶ˆæ¯çš„åŸºç¡€ä¸Šï¼Œéœ€è¦æ·»åŠ å‚¬ä¿ƒçš„åŠŸèƒ½ã€‚è€Œç‰¹æ€¥æ¶ˆæ¯çš„å‘é€æ–¹å¼è¿˜æ˜¯å‘é€ç«™å†…çŸ­æ¶ˆæ¯å’ŒE-Mailä¸¤ç§ï¼Œæ­¤æ—¶çš„ç±»å›¾ç»“æ„å¦‚ä¸‹ã€‚ ä»ä»¥ä¸Šè¿‡ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨å®ç°åŠ æ€¥æ¶ˆæ¯å¤„ç†çš„æ—¶å€™ï¼Œå¿…é¡»å®ç°ç«™å†…çŸ­æ¶ˆæ¯å’ŒE-Mailä¸¤ç§å¤„ç†æ–¹å¼ï¼›åœ¨å®ç°ç‰¹æ€¥æ¶ˆæ¯å¤„ç†çš„æ—¶å€™ï¼Œåˆå¿…é¡»å®ç°ç«™å†…çŸ­æ¶ˆæ¯å’ŒE-Mailä¸¤ç§å¤„ç†æ–¹å¼ã€‚ è¿™æ„å‘³ç€ï¼Œä»¥åæ¯æ¬¡æ‰©å±•ä¸€ç§æ¶ˆæ¯å¤„ç†ï¼Œéƒ½å¿…é¡»è¦å®ç°ç«™å†…çŸ­æ¶ˆæ¯å’ŒE-Mailä¸¤ç§å¤„ç†æ–¹å¼ï¼Œæ˜¯ä¸æ˜¯å¾ˆç—›è‹¦ï¼Ÿ è¿™è¿˜ä¸ç®—å®Œï¼Œå¦‚æœè¦æ·»åŠ æ–°çš„æ¶ˆæ¯å‘é€æ–¹å¼å‘¢ï¼Ÿç»§ç»­æ‰©å±•åŠŸèƒ½ï¼Œæ·»åŠ æ‰‹æœºçŸ­æ¶ˆæ¯çš„å‘é€æ–¹å¼ï¼Œç±»å›¾ç»“æ„æ‰©å±•å¦‚ä¸‹ã€‚ ä»”ç»†è§‚å¯Ÿç°åœ¨çš„å®ç°ï¼Œå¦‚æœæ­¤æ—¶å†æ·»åŠ ä¸€ç§æ¶ˆæ¯å¤„ç†ï¼Œåˆ™éœ€è¦æ·»åŠ ç³»ç»Ÿå†…çŸ­æ¶ˆæ¯ã€é‚®ä»¶å’Œæ‰‹æœºæ¶ˆæ¯ä¸‰ä¸ªå®ç°ã€‚æŒ‰ç…§è¿™ç§å®ç°æ–¹å¼ç»§ç»­æ‰©å±•ä¸‹å»ï¼Œæ¶ˆæ¯ç±»çš„æ•°é‡ä¼šæ€¥å‰§å¢åŠ ï¼Œææ˜“å‡ºç°â€œç±»è†¨èƒ€â€ã€‚ é‡åˆ°ç±»ä¼¼ä»¥ä¸Šè¿™ç§æƒ…å†µï¼Œåº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿç­”æ¡ˆï¼šä½¿ç”¨æ¡¥æ¥æ¨¡å¼ã€‚ ä¸‰ã€æ¡¥æ¥æ¨¡å¼çš„ç»“æ„ä»”ç»†åˆ†æä¸Šé¢çš„ç¤ºä¾‹ï¼Œä¼šå‘ç°ç¤ºä¾‹ä¸­æ¶ˆæ¯çš„å˜åŒ–å…·æœ‰ä¸¤ä¸ªç»´åº¦ï¼Œä¸€ä¸ªç»´åº¦æ˜¯æŠ½è±¡çš„æ¶ˆæ¯è¿™è¾¹ï¼ŒåŒ…æ‹¬æ™®é€šæ¶ˆæ¯ã€åŠ æ€¥æ¶ˆæ¯å’Œç‰¹æ€¥æ¶ˆæ¯ï¼›å¦ä¸€ä¸ªç»´åº¦æ˜¯åœ¨æ¶ˆæ¯çš„å‘é€æ–¹å¼ä¸Šï¼ŒåŒ…æ‹¬ç«™å†…çŸ­æ¶ˆæ¯ã€E-Mailå’Œæ‰‹æœºçŸ­æ¶ˆæ¯ã€‚è¿™ä¸¤ä¸ªç»´åº¦ä¸€å…±å¯ä»¥ç»„åˆå‡º9ç§ä¸åŒçš„å¯èƒ½æ€§æ¥ï¼Œå®ƒä»¬çš„å…³ç³»å¦‚ä¸‹ã€‚ ç°åœ¨å‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œå°±åœ¨äºæ¶ˆæ¯çš„æŠ½è±¡å’Œå®ç°æ˜¯æ··æ‚åœ¨ä¸€èµ·çš„ï¼Œè¿™å°±å¯¼è‡´ä¸€ä¸ªç»´åº¦çš„å˜åŒ–ä¼šå¼•èµ·å¦ä¸€ä¸ªç»´åº¦è¿›è¡Œç›¸åº”çš„å˜åŒ–ï¼Œä»è€Œä½¿å¾—ç¨‹åºæ‰©å±•èµ·æ¥éå¸¸å›°éš¾ã€‚ è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¿…é¡»æŠŠè¿™ä¸¤ä¸ªç»´åº¦åˆ†å¼€ï¼Œä¹Ÿå°±æ˜¯å°†æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†å¼€ï¼Œè®©å®ƒä»¬ç›¸äº’ç‹¬ç«‹ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ç‹¬ç«‹çš„å˜åŒ–ï¼Œä½¿æ‰©å±•å˜å¾—ç®€å•ã€‚æ¡¥æ¥æ¨¡å¼å°±å¯ä»¥è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œä»¥ä¸‹æ˜¯æ¡¥æ¥æ¨¡å¼çš„ç»“æ„ç¤ºæ„å›¾ã€‚ æ¡¥æ¥æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š Abstractionï¼šæŠ½è±¡éƒ¨åˆ†çš„æ¥å£ã€‚é€šå¸¸åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œè¦ç»´æŠ¤ä¸€ä¸ªå®ç°éƒ¨åˆ†çš„å¯¹è±¡å¼•ç”¨ï¼ŒæŠ½è±¡å¯¹è±¡é‡Œé¢çš„æ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨å®ç°éƒ¨åˆ†çš„å¯¹è±¡æ¥å®Œæˆï¼Œè¿™ä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œé€šå¸¸éƒ½æ˜¯å’Œå…·ä½“çš„ä¸šåŠ¡ç›¸å…³çš„æ–¹æ³•ã€‚ RefinedAbstractionï¼šæ‰©å±•æŠ½è±¡éƒ¨åˆ†çš„æ¥å£ã€‚é€šå¸¸åœ¨è¿™äº›å¯¹è±¡ä¸­ï¼Œå®šä¹‰è·Ÿå®é™…ä¸šåŠ¡ç›¸å…³çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å®ç°é€šå¸¸ä¼šä½¿ç”¨Abstractionä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä¹Ÿå¯èƒ½ä¼šè°ƒç”¨å®ç°éƒ¨åˆ†çš„å¯¹è±¡æ¥å®Œæˆã€‚ Implementorï¼šå®šä¹‰å®ç°éƒ¨åˆ†çš„æ¥å£ã€‚è¿™ä¸ªæ¥å£ä¸ç”¨å’ŒAbstractionä¸­å®šä¹‰çš„æ–¹æ³•ä¸€è‡´ï¼Œé€šå¸¸æ˜¯ç”±Implementoræ¥å£æä¾›åŸºæœ¬çš„æ“ä½œã€‚è€Œ Abstractionä¸­å®šä¹‰çš„æ˜¯åŸºäºè¿™äº›åŸºæœ¬æ“ä½œçš„ä¸šåŠ¡æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ Abstractionå®šä¹‰äº†åŸºäºè¿™äº›åŸºæœ¬æ“ä½œçš„è¾ƒé«˜å±‚æ¬¡çš„æ“ä½œã€‚ ConcreteImplementorï¼šçœŸæ­£å®ç° Implementoræ¥å£çš„å¯¹è±¡ã€‚ æ¡¥æ¥æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼š public abstract class Abstraction { /** * æŒæœ‰ä¸€ä¸ªå®ç°éƒ¨åˆ†çš„å¯¹è±¡ */ protected Implementor impl; /** * æ„é€ æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªå®ç°éƒ¨åˆ†çš„å¯¹è±¡ */ public Abstraction(Implementor impl) { this.impl = impl; } /** * ç¤ºä¾‹æ“ä½œï¼Œå®ç°ä¸€å®šçš„åŠŸèƒ½ï¼Œå¯èƒ½éœ€è¦è°ƒç”¨å®ç°éƒ¨åˆ†çš„å…·ä½“å®ç°æ–¹æ³• */ public void operation() { impl.operationImpl(); } } public interface Implementor { /** * ç¤ºä¾‹æ–¹æ³•ï¼Œå®ç°æŠ½è±¡éƒ¨åˆ†éœ€è¦çš„æŸäº›å…·ä½“åŠŸèƒ½ */ public void operationImpl(); } public class RefinedAbstraction extends Abstraction { public RefinedAbstraction(Implementor impl) { super(impl); } /** * ç¤ºä¾‹æ“ä½œï¼Œå®ç°ä¸€å®šçš„åŠŸèƒ½ */ public void otherOperation() { // å®ç°ä¸€å®šçš„åŠŸèƒ½ï¼Œå¯èƒ½ä¼šä½¿ç”¨å…·ä½“å®ç°éƒ¨åˆ†çš„å®ç°æ–¹æ³• // ä½†æ˜¯æœ¬æ–¹æ³•æ›´å¤§çš„å¯èƒ½æ˜¯ä½¿ç”¨Abstractionä¸­å®šä¹‰çš„æ–¹æ³• // é€šè¿‡ç»„åˆä½¿ç”¨Abstractionä¸­å®šä¹‰çš„æ–¹æ³•æ¥å®Œæˆæ›´å¤šçš„åŠŸèƒ½ } } public class ConcreteImplementorA implements Implementor { @Override public void operationImpl() { // çœŸæ­£çš„å®ç° } } public class ConcreteImplementorB implements Implementor { @Override public void operationImpl() { // çœŸæ­£çš„å®ç° } } å››ã€ä½¿ç”¨æ¡¥æ¥æ¨¡å¼é‡å†™æ¶ˆæ¯å…ˆå®ç°æ™®é€šæ¶ˆæ¯å’ŒåŠ æ€¥æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œå‘é€æ–¹å¼å…ˆå®ç°ç«™å†…çŸ­æ¶ˆæ¯å’ŒE-mailä¸¤ç§ï¼Œä½¿ç”¨æ¡¥æ¥æ¨¡å¼æ¥å®ç°è¿™äº›åŠŸèƒ½çš„ç±»å›¾ç»“æ„å¦‚ä¸‹ã€‚ ä¸‹é¢æ˜¯å„ä¸ªç±»çš„å®ç°ä»£ç ã€‚ /** * æŠ½è±¡çš„æ¶ˆæ¯å¯¹è±¡ */ public abstract class AbstractMessage { /** * æŒæœ‰ä¸€ä¸ªå®ç°éƒ¨åˆ†çš„å¯¹è±¡ */ protected MessageImplementor impl; /** * æ„é€ æ–¹æ³•ï¼Œä¼ å…¥å®ç°éƒ¨åˆ†çš„å¯¹è±¡ * @param impl å®ç°éƒ¨åˆ†çš„å¯¹è±¡ */ public AbstractMessage(MessageImplementor impl) { this.impl = impl; } /** * å‘é€æ¶ˆæ¯ï¼Œè½¬è°ƒå®ç°éƒ¨åˆ†çš„æ–¹æ³• * @param message æ¶ˆæ¯çš„å†…å®¹ * @param toUser æ¶ˆæ¯çš„æ¥æ”¶äºº */ public void sendMessage(String message, String toUser) { this.impl.send(message, toUser); } } /** * å®ç°å‘é€æ¶ˆæ¯çš„ç»Ÿä¸€æ¥å£ */ public interface MessageImplementor { /** * å‘é€æ¶ˆæ¯ * * @param message æ¶ˆæ¯çš„å†…å®¹ * @param toUser æ¶ˆæ¯çš„æ¥æ”¶äºº */ public void send(String message, String toUser); } public class CommonMessage extends AbstractMessage { public CommonMessage(MessageImplementor impl) { super(impl); } public void sendMessage(String message, String toUser){ //å¯¹äºæ™®é€šæ¶ˆæ¯ï¼Œä»€ä¹ˆéƒ½ä¸å¹²ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼ŒæŠŠæ¶ˆæ¯å‘é€å‡ºå» super.sendMessage(message, toUser); } } public class UrgencyMessage extends AbstractMessage { public UrgencyMessage(MessageImplementor impl) { super(impl); } public void sendMessage(String message, String toUser) { // å¯¹äºåŠ æ€¥æ¶ˆæ¯ï¼Œåœ¨æ¶ˆæ¯ä¸Šæ·»åŠ â€œåŠ æ€¥â€æ ‡è¯†ï¼Œå†è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼ŒæŠŠæ¶ˆæ¯å‘é€å‡ºå» message = &quot;[åŠ æ€¥]&quot; + message; super.sendMessage(message, toUser); } /** * æ‰©å±•è‡ªå·±çš„æ–°åŠŸèƒ½ï¼šç›‘æ§æŸæ¶ˆæ¯çš„å¤„ç†è¿‡ç¨‹ * @param message è¢«ç›‘æ§çš„æ¶ˆæ¯ * @return åŒ…å«ç›‘æ§åˆ°çš„æ•°æ®å¯¹è±¡ï¼Œæ­¤å¤„ç”¨Objectç¤ºæ„ */ public Object watch(AbstractMessage message) { return null; } } public class MessageSMS implements MessageImplementor { @Override public void send(String message, String toUser) { System.out.println(&quot;ä½¿ç”¨ç«™å†…çŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:&quot;+message+&quot;ç»™&quot;+toUser); } } public class MessageEmail implements MessageImplementor { @Override public void send(String message, String toUser) { System.out.println(&quot;ä½¿ç”¨E-mailçš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:&quot; + message + &quot;ç»™&quot; + toUser); } } ç»§ç»­æ·»åŠ å¯¹ç‰¹æ€¥æ¶ˆæ¯çš„å¤„ç†ï¼ŒåŒæ—¶æ·»åŠ å‘é€æ‰‹æœºæ¶ˆæ¯çš„æ–¹å¼ï¼Œè¯¥å¦‚ä½•å®ç°ï¼Ÿ å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æŠ½è±¡éƒ¨åˆ†å†æ·»åŠ ä¸€ä¸ªç‰¹æ€¥æ¶ˆæ¯çš„ç±»ï¼Œæ‰©å±•æŠ½è±¡æ¶ˆæ¯å°±å¯ä»¥æŠŠç‰¹æ€¥æ¶ˆæ¯çš„å¤„ç†åŠŸèƒ½åŠ å…¥åˆ°ç³»ç»Ÿä¸­ï¼›å¯¹äºæ·»åŠ æ‰‹æœºå‘é€æ¶ˆæ¯çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨å®ç°éƒ¨åˆ†æ–°å¢åŠ ä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°ä½¿ç”¨æ‰‹æœºå‘é€æ¶ˆæ¯çš„æ–¹å¼å°±å¯ä»¥äº†ã€‚ æ–°æ·»åŠ çš„ä¸¤ä¸ªç±»ï¼Œä»£ç å¦‚ä¸‹ã€‚ public class SpecialUrgencyMessage extends AbstractMessage { public SpecialUrgencyMessage(MessageImplementor impl) { super(impl); } public void hurry(AbstractMessage message) { // æ‰§è¡Œå‚¬ä¿ƒçš„åŠŸèƒ½ï¼Œå‘å‡ºå‚¬ä¿ƒçš„ä¿¡æ¯ } public void sendMessage(String message, String toUser) { // å¯¹äºç‰¹æ€¥æ¶ˆæ¯ï¼Œåœ¨æ¶ˆæ¯ä¸Šæ·»åŠ â€œç‰¹æ€¥â€æ ‡è¯†ï¼Œå†è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼ŒæŠŠæ¶ˆæ¯å‘é€å‡ºå» message = &quot;[ç‰¹æ€¥]&quot; + message; super.sendMessage(message, toUser); // è¿˜éœ€è¦å¢åŠ ä¸€æ¡å¾…å‚¬ä¿ƒçš„ä¿¡æ¯ } } public class MessageMobile implements MessageImplementor { @Override public void send(String message, String toUser) { System.out.println(&quot;ä½¿ç”¨æ‰‹æœºçŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:&quot; + message + &quot;ç»™&quot; + toUser); } } å†™ä¸ªå®¢æˆ·ç«¯ç±»æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // åˆ›å»ºå…·ä½“çš„å®ç°å¯¹è±¡ MessageImplementor impl = new MessageSMS(); // åˆ›å»ºä¸€ä¸ªæ™®é€šæ¶ˆæ¯å¯¹è±¡ AbstractMessage m = new CommonMessage(impl); m.sendMessage(&quot;ä»Šæ™š8ç‚¹ï¼Œæ—¶ä»£å¹¿åœºï¼Œä¸è§ä¸æ•£ï¼&quot;, &quot;å°ä¹”&quot;); // åˆ›å»ºä¸€ä¸ªç´§æ€¥æ¶ˆæ¯å¯¹è±¡ m = new UrgencyMessage(impl); m.sendMessage(&quot;åŠå°æ—¶åå¬å¼€ç´§æ€¥ä¼šè®®ï¼&quot;, &quot;å°å‘¨&quot;); // åˆ›å»ºä¸€ä¸ªç‰¹æ€¥æ¶ˆæ¯å¯¹è±¡ m = new SpecialUrgencyMessage(impl); m.sendMessage(&quot;é¢†å¯¼è¿‡æ¥è§†å¯Ÿäº†ï¼Œé€Ÿå›ï¼&quot;, &quot;å°æ˜&quot;); // æŠŠå‘é€æ–¹å¼åˆ‡æ¢æˆæ‰‹æœºçŸ­æ¶ˆæ¯ï¼Œå°†ä»¥ä¸Šå†…å®¹é‡å‘ä¸€é impl = new MessageMobile(); // åˆ›å»ºä¸€ä¸ªæ™®é€šæ¶ˆæ¯å¯¹è±¡ m = new CommonMessage(impl); m.sendMessage(&quot;ä»Šæ™š8ç‚¹ï¼Œæ—¶ä»£å¹¿åœºï¼Œä¸è§ä¸æ•£ï¼&quot;, &quot;å°ä¹”&quot;); // åˆ›å»ºä¸€ä¸ªç´§æ€¥æ¶ˆæ¯å¯¹è±¡ m = new UrgencyMessage(impl); m.sendMessage(&quot;åŠå°æ—¶åå¬å¼€ç´§æ€¥ä¼šè®®ï¼&quot;, &quot;å°å‘¨&quot;); // åˆ›å»ºä¸€ä¸ªç‰¹æ€¥æ¶ˆæ¯å¯¹è±¡ m = new SpecialUrgencyMessage(impl); m.sendMessage(&quot;é¢†å¯¼è¿‡æ¥è§†å¯Ÿäº†ï¼Œé€Ÿå›ï¼&quot;, &quot;å°æ˜&quot;); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š ä½¿ç”¨ç«™å†…çŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:ä»Šæ™š8ç‚¹ï¼Œæ—¶ä»£å¹¿åœºï¼Œä¸è§ä¸æ•£ï¼ç»™å°ä¹”ä½¿ç”¨ç«™å†…çŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:[åŠ æ€¥]åŠå°æ—¶åå¬å¼€ç´§æ€¥ä¼šè®®ï¼ç»™å°å‘¨ä½¿ç”¨ç«™å†…çŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:[ç‰¹æ€¥]é¢†å¯¼è¿‡æ¥è§†å¯Ÿäº†ï¼Œé€Ÿå›ï¼ç»™å°æ˜ä½¿ç”¨æ‰‹æœºçŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:ä»Šæ™š8ç‚¹ï¼Œæ—¶ä»£å¹¿åœºï¼Œä¸è§ä¸æ•£ï¼ç»™å°ä¹”ä½¿ç”¨æ‰‹æœºçŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:[åŠ æ€¥]åŠå°æ—¶åå¬å¼€ç´§æ€¥ä¼šè®®ï¼ç»™å°å‘¨ä½¿ç”¨æ‰‹æœºçŸ­æ¶ˆæ¯çš„æ–¹å¼ï¼Œå‘é€æ¶ˆæ¯:[ç‰¹æ€¥]é¢†å¯¼è¿‡æ¥è§†å¯Ÿäº†ï¼Œé€Ÿå›ï¼ç»™å°æ˜ äº”ã€æ¡¥æ¥æ¨¡å¼çš„é€‚ç”¨æ€§åœ¨ä»¥ä¸‹çš„æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ï¼š 1ï¼å¦‚æœä½ ä¸å¸Œæœ›åœ¨æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†é‡‡ç”¨å›ºå®šçš„ç»‘å®šå…³ç³»ï¼Œå¯ä»¥é‡‡ç”¨æ¡¥æ¥æ¨¡å¼ï¼Œæ¥æŠŠæŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†å¼€ï¼Œç„¶ååœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ¥åŠ¨æ€åœ°è®¾ç½®æŠ½è±¡éƒ¨åˆ†éœ€è¦ç”¨åˆ°çš„å…·ä½“çš„å®ç°ï¼Œè¿˜å¯ä»¥åŠ¨æ€åœ°åˆ‡æ¢å…·ä½“çš„å®ç°ã€‚ 2ï¼å¦‚æœå‡ºç°æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†éƒ½èƒ½å¤Ÿæ‰©å±•çš„æƒ…å†µï¼Œå¯ä»¥é‡‡ç”¨æ¡¥æ¥æ¨¡å¼ï¼Œè®©æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†ç‹¬ç«‹åœ°å˜åŒ–ï¼Œä»è€Œçµæ´»åœ°è¿›è¡Œå•ç‹¬æ‰©å±•ï¼Œè€Œä¸æ˜¯æ…åœ¨ä¸€èµ·ï¼Œæ‰©å±•ä¸€è¾¹å°±ä¼šå½±å“åˆ°å¦ä¸€è¾¹ã€‚ 3ï¼å¦‚æœå¸Œæœ›å®ç°éƒ¨åˆ†çš„ä¿®æ”¹ä¸ä¼šå¯¹å®¢æˆ·äº§ç”Ÿå½±å“ï¼Œå¯ä»¥é‡‡ç”¨æ¡¥æ¥æ¨¡å¼ã€‚ç”±äºå®¢æˆ·æ˜¯é¢å‘æŠ½è±¡çš„æ¥å£åœ¨è¿è¡Œï¼Œå®ç°éƒ¨åˆ†çš„ä¿®æ”¹å¯ä»¥ç‹¬ç«‹äºæŠ½è±¡éƒ¨åˆ†ï¼Œå¹¶ä¸ä¼šå¯¹å®¢æˆ·äº§ç”Ÿå½±å“ï¼Œä¹Ÿå¯ä»¥è¯´å¯¹å®¢æˆ·æ˜¯é€æ˜çš„ã€‚ 4ï¼å¦‚æœé‡‡ç”¨ç»§æ‰¿çš„å®ç°æ–¹æ¡ˆï¼Œä¼šå¯¼è‡´äº§ç”Ÿå¾ˆå¤šå­ç±»ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨æ¡¥æ¥æ¨¡å¼ï¼Œåˆ†æåŠŸèƒ½å˜åŒ–çš„åŸå› ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½åˆ†ç¦»æˆä¸åŒçš„ç»´åº¦ï¼Œç„¶åé€šè¿‡æ¡¥æ¥æ¨¡å¼æ¥åˆ†ç¦»å®ƒä»¬ï¼Œä»è€Œå‡å°‘å­ç±»çš„æ•°ç›®ã€‚ å…­ã€æ¡¥æ¥æ¨¡å¼çš„ç‰¹ç‚¹ åˆ†ç¦»æŠ½è±¡å’Œå®ç°éƒ¨åˆ† æ¡¥æ¥æ¨¡å¼åˆ†ç¦»äº†æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†ï¼Œä»è€Œæå¤§åœ°æé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ã€‚è®©æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†ç‹¬ç«‹å¼€æ¥ï¼Œåˆ†åˆ«å®šä¹‰æ¥å£ï¼Œè¿™æœ‰åŠ©äºå¯¹ç³»ç»Ÿè¿›è¡Œåˆ†å±‚ï¼Œä»è€Œäº§ç”Ÿæ›´å¥½çš„ç»“æ„åŒ–çš„ç³»ç»Ÿã€‚å¯¹äºç³»ç»Ÿçš„é«˜å±‚éƒ¨åˆ†ï¼Œåªéœ€è¦çŸ¥é“æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†çš„æ¥å£å°±å¯ä»¥äº†ã€‚ æ›´å¥½çš„æ‰©å±•æ€§ ç”±äºæ¡¥æ¥æ¨¡å¼æŠŠæŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†ç¦»å¼€äº†ï¼Œè€Œä¸”åˆ†åˆ«å®šä¹‰æ¥å£ï¼Œè¿™å°±ä½¿å¾—æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†å¯ä»¥åˆ†åˆ«ç‹¬ç«‹åœ°æ‰©å±•ï¼Œè€Œä¸ä¼šç›¸äº’å½±å“ï¼Œä»è€Œå¤§å¤§åœ°æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚ å¯åŠ¨æ€åœ°åˆ‡æ¢å®ç° æ¡¥æ¥æ¨¡å¼æŠŠæŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†ç¦»å¼€äº†ï¼Œæ‰€ä»¥åœ¨å®ç°æ¡¥æ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥å®ç°åŠ¨æ€åœ°é€‰æ‹©å’Œä½¿ç”¨å…·ä½“çš„å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå®ç°ä¸å†æ˜¯å›ºå®šåœ°ç»‘å®šåœ¨ä¸€ä¸ªæŠ½è±¡æ¥å£ä¸Šäº†ï¼Œå¯ä»¥å®ç°è¿è¡ŒæœŸé—´åŠ¨æ€åœ°åˆ‡æ¢ã€‚ å¯å‡å°‘å­ç±»çš„ä¸ªæ•° å¯¹äºæœ‰ä¸¤ä¸ªå˜åŒ–ç»´åº¦çš„æƒ…å†µï¼Œå¦‚æœé‡‡ç”¨ç»§æ‰¿çš„å®ç°æ–¹å¼ï¼Œå¤§çº¦éœ€è¦ä¸¤ä¸ªç»´åº¦ä¸Šçš„å¯å˜åŒ–æ•°é‡çš„ä¹˜ç§¯ä¸ªå­ç±»ï¼›è€Œé‡‡ç”¨æ¡¥æ¥æ¨¡å¼æ¥å®ç°ï¼Œå¤§çº¦éœ€è¦ä¸¤ä¸ªç»´åº¦ä¸Šçš„å¯å˜åŒ–æ•°é‡çš„å’Œä¸ªå­ç±»ã€‚å¯ä»¥æ˜æ˜¾åœ°å‡å°‘å­ç±»çš„ä¸ªæ•°ã€‚ ä¸ƒã€æ€»ç»“æ¡¥æ¥æ¨¡å¼å¾ˆå¥½åœ°å®ç°äº†é¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„å¼€é—­åŸåˆ™å’Œå¤šç”¨å¯¹è±¡ç»„åˆã€å°‘ç”¨å¯¹è±¡ç»§æ‰¿åŸåˆ™ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ï¼šåˆ†ç¦»æŠ½è±¡å’Œå®ç°ã€‚åªæœ‰æŠŠæŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†ç¦»å¼€äº†ï¼Œæ‰èƒ½å¤Ÿè®©å®ƒä»¬ç‹¬ç«‹åœ°å˜åŒ–ï¼›åªæœ‰æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ï¼Œç³»ç»Ÿæ‰ä¼šæœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"æ¡¥æ¥æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"æ¡¥æ¥æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/æ¡¥æ¥æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--è®¿é—®è€…æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--è®¿é—®è€…æ¨¡å¼","date":"2020-05-24T08:51:11.000Z","updated":"2023-04-30T10:21:41.362Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è®¿é—®è€…æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è®¿é—®è€…æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯è®¿é—®è€…æ¨¡å¼è®¿é—®è€…ï¼ˆVisitorï¼‰æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ã€‚åœ¨è®¿é—®è€…æ¨¡å¼é‡Œï¼Œæ¯ä¸ªè®¿é—®è€…è¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œã€‚å®ƒä½¿ä½ å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ çš„ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œã€‚ åœ¨é¢å‘å¯¹è±¡çš„ç³»ç»Ÿå¼€å‘å’Œè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œç»å¸¸é‡åˆ°çš„ä¸€ç§æƒ…å†µå°±æ˜¯éœ€æ±‚å˜æ›´ï¼Œé’ˆå¯¹å·²ç»å¼€å‘å®Œæˆçš„ç³»ç»Ÿï¼Œå®¢æˆ·åˆä¼šæå‡ºæ–°çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å»ä¿®æ”¹å·²æœ‰çš„è®¾è®¡ï¼Œæœ€å¸¸è§å°±æ˜¯è§£å†³æ–¹æ¡ˆå°±æ˜¯ç»™å·²ç»è®¾è®¡ã€å®ç°å¥½çš„ç±»æ·»åŠ æ–°çš„æ–¹æ³•å»å®ç°å®¢æˆ·æ–°çš„éœ€æ±‚ï¼Œè¿™æ ·å°±é™·å…¥äº†è®¾è®¡å˜æ›´çš„æ¢¦é­‡ï¼šä¸åœåœ°æ‰“è¡¥ä¸ï¼Œå…¶æœ€å¤§çš„é—®é¢˜å°±æ˜¯è®¾è®¡æ ¹æœ¬å°±ä¸å¯èƒ½å°é—­ã€‚ è®¿é—®è€…æ¨¡å¼åˆ™ä¸ºè¿™ç§æƒ…å†µæä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šå°†æ›´æ–°ï¼ˆå˜æ›´ï¼‰å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼ˆè®¿é—®æ“ä½œï¼‰ï¼Œå¹¶ç”±å¾…æ›´æ”¹ç±»æä¾›ä¸€ä¸ªæ¥æ”¶æ¥å£ï¼Œåˆ™å¯è¾¾åˆ°æ•ˆæœã€‚ äºŒã€è®¿é—®è€…æ¨¡å¼çš„ç»“æ„ è®¿é—®è€…æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡è®¿é—®è€…(Visitor)è§’è‰²ï¼šä¸ºè¯¥å¯¹è±¡ç»“æ„ä¸­å…·ä½“å…ƒç´ è§’è‰²å£°æ˜ä¸€ä¸ªè®¿é—®æ“ä½œæ¥å£ï¼Œç”¨æ¥ä»£è¡¨ä¸ºå¯¹è±¡ç»“æ„æ·»åŠ çš„æ–°åŠŸèƒ½ï¼Œç†è®ºä¸Šå¯ä»¥ä»£è¡¨ä»»æ„çš„åŠŸèƒ½ã€‚ å…·ä½“è®¿é—®è€…(ConcreteVisitor)è§’è‰²ï¼šå®ç°æ¯ä¸ªç”±æŠ½è±¡è®¿é—®è€…è§’è‰²ï¼ˆVisitorï¼‰å£°æ˜çš„æ“ä½œæ¥å£ã€‚ æŠ½è±¡å…ƒç´ (Element)è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªaccept()æ“ä½œï¼Œå®ƒä»¥ä¸€ä¸ªè®¿é—®è€…ï¼ˆVisitorï¼‰å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ å…·ä½“å…ƒç´ (ConcreteElement)è§’è‰²ï¼šå®ç°ç”±æŠ½è±¡å…ƒç´ (Element)è§’è‰²æä¾›çš„accept()æ“ä½œã€‚ å¯¹è±¡ç»“æ„(ObjectStructure)è§’è‰²ï¼šè¿™æ˜¯ä½¿ç”¨è®¿é—®è€…æ¨¡å¼å¿…å¤‡çš„è§’è‰²ã€‚ä¸€èˆ¬å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š èƒ½æšä¸¾å®ƒçš„å…ƒç´ ã€‚ å¯ä»¥æä¾›ä¸€ä¸ªé«˜å±‚çš„æ¥å£ä»¥å…è®¸è¯¥è®¿é—®è€…è®¿é—®å®ƒçš„å…ƒç´ ã€‚ å¯ä»¥æ˜¯ä¸€ä¸ªå¤åˆï¼ˆç»„åˆæ¨¡å¼ï¼‰æˆ–æ˜¯ä¸€ä¸ªé›†åˆï¼Œå¦‚ä¸€ä¸ªåˆ—è¡¨æˆ–ä¸€ä¸ªæ— åºé›†åˆã€‚ è®¿é—®è€…æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£æ¥ä»£è¡¨è¦æ–°åŠ å…¥çš„åŠŸèƒ½ï¼ŒæŠŠå®ƒç§°ä½œè®¿é—®è€…ï¼ˆVisitorï¼‰ï¼Œè®¿é—®è°å‘¢ï¼Ÿå½“ç„¶æ˜¯è®¿é—®å¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡äº†ã€‚ /** * è®¿é—®è€…æ¥å£ */ public interface Visitor { /** * è®¿é—®ConcreteElementAï¼Œç›¸å½“äºä¸ºConcreteElementAæ·»åŠ çš„æ–°åŠŸèƒ½ */ public void visitConcreteElementA(ConcreteElementA elementA); /** * è®¿é—®ConcreteElementBï¼Œç›¸å½“äºä¸ºConcreteElementBæ·»åŠ çš„æ–°åŠŸèƒ½ */ public void visitConcreteElementB(ConcreteElementB elementB); } ï¼ˆ2ï¼‰å†çœ‹çœ‹è®¿é—®è€…çš„å…·ä½“å®ç°(ConcreteVisitor)ã€‚ public class ConcreteVisitorA implements Visitor { @Override public void visitConcreteElementA(ConcreteElementA elementA) { /** * æŠŠè®¿é—®ConcreteElementAæ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„åŠŸèƒ½åœ¨è¿™é‡Œè¿›è¡Œå®ç° å¯èƒ½éœ€è¦è®¿é—®å…ƒç´ å·²æœ‰çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šoperationA() */ System.out.println(&quot;ConcreteVisitorA è®¿é—® ==&gt; ConcreteElementA å¯¹è±¡ã€‚&quot;); } @Override public void visitConcreteElementB(ConcreteElementB elementB) { /** * æŠŠè®¿é—®ConcreteElementBæ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„åŠŸèƒ½åœ¨è¿™é‡Œè¿›è¡Œå®ç° å¯èƒ½éœ€è¦è®¿é—®å…ƒç´ å·²æœ‰çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šoperationB() */ System.out.println(&quot;ConcreteVisitorA è®¿é—® ==&gt; ConcreteElementB å¯¹è±¡ã€‚&quot;); } } public class ConcreteVisitorB implements Visitor { @Override public void visitConcreteElementA(ConcreteElementA elementA) { /** * æŠŠè®¿é—®ConcreteElementAæ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„åŠŸèƒ½åœ¨è¿™é‡Œè¿›è¡Œå®ç° å¯èƒ½éœ€è¦è®¿é—®å…ƒç´ å·²æœ‰çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šoperationA() */ System.out.println(&quot;ConcreteVisitorB è®¿é—® ==&gt; ConcreteElementA å¯¹è±¡ã€‚&quot;); } @Override public void visitConcreteElementB(ConcreteElementB elementB) { /** * æŠŠè®¿é—®ConcreteElementBæ—¶ï¼Œéœ€è¦æ‰§è¡Œçš„åŠŸèƒ½åœ¨è¿™é‡Œè¿›è¡Œå®ç° å¯èƒ½éœ€è¦è®¿é—®å…ƒç´ å·²æœ‰çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šoperationB() */ System.out.println(&quot;ConcreteVisitorB è®¿é—® ==&gt; ConcreteElementB å¯¹è±¡ã€‚&quot;); } } ï¼ˆ3ï¼‰æŠ½è±¡å…ƒç´ (Element)çš„å®šä¹‰ã€‚ public abstract class Element { // æ¥å—è®¿é—®è€…çš„è®¿é—® public abstract void accept(Visitor visitor); } ï¼ˆ4ï¼‰å†çœ‹çœ‹å…ƒç´ å¯¹è±¡çš„å…·ä½“å®ç°(ConcreteElement)ã€‚ public class ConcreteElementA extends Element { @Override public void accept(Visitor visitor) { // å›è°ƒè®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³• visitor.visitConcreteElementA(this); } /** * ç¤ºä¾‹æ–¹æ³•ï¼Œè¡¨ç¤ºå…ƒç´ å·²æœ‰çš„åŠŸèƒ½å®ç° */ public void operationA() { System.out.println(&quot;æ‰§è¡ŒConcreteElementAå·²æœ‰çš„operationAæ–¹æ³•.&quot;); } } public class ConcreteElementB extends Element { @Override public void accept(Visitor visitor) { // å›è°ƒè®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³• visitor.visitConcreteElementB(this); } /** * ç¤ºä¾‹æ–¹æ³•ï¼Œè¡¨ç¤ºå…ƒç´ å·²æœ‰çš„åŠŸèƒ½å®ç° */ public void operationB() { System.out.println(&quot;æ‰§è¡ŒConcreteElementBå·²æœ‰çš„operationBæ–¹æ³•.&quot;); } } â€‹ï¼ˆ5ï¼‰å¯¹è±¡ç»“æ„(ObjectStructure)ç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ import java.util.ArrayList; import java.util.Collection; /** * å¯¹è±¡ç»“æ„ï¼Œé€šå¸¸åœ¨è¿™é‡Œå¯¹å…ƒç´ å¯¹è±¡è¿›è¡Œéå†ï¼Œè®©è®¿é—®è€…èƒ½å¤Ÿè®¿é—®åˆ°æ‰€æœ‰çš„å…ƒç´  */ public class ObjectStructure { /** * ç¤ºæ„,è¡¨ç¤ºå¯¹è±¡ç»“æ„ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç»„åˆç»“æ„æˆ–è€…é›†åˆ */ private Collection&lt;Element&gt; col = new ArrayList&lt;Element&gt;(); /** * ç¤ºæ„æ–¹æ³•ï¼Œæä¾›ç»™å®¢æˆ·ç«¯æ“ä½œçš„é«˜å±‚æ¥å£ï¼Œè®©è®¿é—®è€…å¯¹å¯¹è±¡ç»“æ„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œè®¿é—® */ public void handleRequest(Visitor visitor) { // å¾ªç¯å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ï¼Œè¿›è¡Œè®¿é—® for (Element element : col) { element.accept(visitor); } } /** * ç¤ºæ„æ–¹æ³•ï¼Œç»„å»ºå¯¹è±¡ç»“æ„ï¼Œå‘å¯¹è±¡ç»“æ„ä¸­æ·»åŠ å…ƒç´  */ public void addElement(Element element) { this.col.add(element); } } ï¼ˆ6ï¼‰æœ€ååœ¨å®¢æˆ·ç«¯æµ‹è¯•ä¸€ä¸‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { // åˆ›å»ºå¯¹è±¡ç»“æ„ ObjectStructure os = new ObjectStructure(); // ä¸ºå¯¹è±¡ç»“æ„ä¸­æ·»åŠ å…ƒç´ å¯¹è±¡ os.addElement(new ConcreteElementA()); os.addElement(new ConcreteElementB()); // åˆ›å»ºè®¿é—®è€… Visitor visitor = new ConcreteVisitorA(); // è°ƒç”¨å¯¹è±¡ç»“æ„çš„ä¸šåŠ¡å¤„ç†æ–¹æ³• os.handleRequest(visitor); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š ConcreteVisitorA è®¿é—® ==&gt; ConcreteElementA å¯¹è±¡ã€‚ConcreteVisitorA è®¿é—® ==&gt; ConcreteElementB å¯¹è±¡ã€‚ è®¿é—®è€…æ¨¡å¼ä¸­å¯¹è±¡ç»“æ„å­˜å‚¨äº†ä¸åŒç±»å‹çš„å…ƒç´ å¯¹è±¡ï¼Œä»¥ä¾›ä¸åŒè®¿é—®è€…è®¿é—®ã€‚è®¿é—®è€…æ¨¡å¼åŒ…æ‹¬ä¸¤ä¸ªå±‚æ¬¡ç»“æ„ï¼Œä¸€ä¸ªæ˜¯è®¿é—®è€…å±‚æ¬¡ç»“æ„ï¼Œæä¾›äº†æŠ½è±¡è®¿é—®è€…å’Œå…·ä½“è®¿é—®è€…ï¼Œä¸€ä¸ªæ˜¯å…ƒç´ å±‚æ¬¡ç»“æ„ï¼Œæä¾›äº†æŠ½è±¡å…ƒç´ å’Œå…·ä½“å…ƒç´ ã€‚ç›¸åŒçš„è®¿é—®è€…å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼è®¿é—®ä¸åŒçš„å…ƒç´ ï¼Œç›¸åŒçš„å…ƒç´ å¯ä»¥æ¥å—ä¸åŒè®¿é—®è€…ä»¥ä¸åŒè®¿é—®æ–¹å¼è®¿é—®ã€‚åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œå¢åŠ æ–°çš„è®¿é—®è€…æ— é¡»ä¿®æ”¹åŸæœ‰ç³»ç»Ÿï¼Œç³»ç»Ÿå…·æœ‰è¾ƒå¥½çš„å¯æ‰©å±•æ€§ã€‚ è®¿é—®è€…æ¨¡å¼åœ¨ä¸ç ´åç±»çš„å‰æä¸‹ï¼Œä¸ºç±»æä¾›å¢åŠ æ–°çš„æ–°æ“ä½œï¼Œå…¶å®ç°çš„å…³é”®æ˜¯åŒåˆ†æ´¾ï¼ˆ Double-Dispatchï¼‰çš„æŠ€æœ¯ã€‚ åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ accept()æ“ä½œæ˜¯ä¸€ä¸ªåŒåˆ†æ´¾çš„æ“ä½œã€‚å…·ä½“è°ƒç”¨å“ªä¸€ä¸ªå…·ä½“çš„accept()æ“ä½œï¼Œæœ‰ä¸¤ä¸ªå†³å®šå› ç´ ï¼š Elementçš„ç±»å‹ã€‚å› ä¸º accept()æ˜¯å¤šæ€çš„æ“ä½œï¼Œéœ€è¦å…·ä½“çš„ Element ç±»å‹çš„å­ç±»æ‰å¯ä»¥å†³å®šåˆ°åº•è°ƒç”¨å“ªä¸€ä¸ªaccept()å®ç°ï¼› Visitorçš„ç±»å‹ã€‚accept()æ“ä½œæœ‰ä¸€ä¸ªå‚æ•°ï¼ˆ Visitor visitorï¼‰ï¼Œè¦å†³å®šäº†å®é™…ä¼ è¿›æ¥çš„ Visitor çš„å®é™…ç±»åˆ«æ‰å¯ä»¥å†³å®šå…·ä½“æ˜¯è°ƒç”¨å“ªä¸ª VisitConcreteï¼ˆï¼‰å®ç°ã€‚ ä¸‰ã€è®¿é—®è€…æ¨¡å¼çš„é€‚ç”¨æ€§ä»è®¿é—®è€…æ¨¡å¼çš„å®šä¹‰å¯ä»¥çœ‹å‡ºå¯¹è±¡ç»“æ„æ˜¯ä½¿ç”¨è®¿é—®è€…æ¨¡å¼çš„å…ˆå†³æ¡ä»¶ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µå¯ä»¥è€ƒè™‘ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ï¼š å¯¹è±¡ç»“æ„å†…åŒ…å«å¤šç§ç±»å‹çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¿™äº›å¯¹è±¡å®æ–½ä¸€äº›ä¾èµ–äºå…¶å…·ä½“ç±»å‹çš„æ“ä½œã€‚ éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è®©è¿™äº›æ“ä½œâ€œæ±¡æŸ“â€è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨å¢åŠ æ–°æ“ä½œæ—¶ä¿®æ”¹è¿™äº›ç±»ã€‚ å¯¹è±¡ç»“æ„ä¸­å¯¹è±¡çš„ç±»å‹å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤å¯¹è±¡ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚ å››ã€ åœºæ™¯ä¸¾ä¾‹ä¸€ä¸ªå•†åœºï¼ˆSuperMarketï¼‰ï¼Œé€šå¸¸éƒ½ä¼šåŒ…æ‹¬ï¼ˆå½“ç„¶è¿˜ä¼šåŒ…å«ä¸€äº›å…¶ä»–çš„ç»„æˆéƒ¨åˆ†ï¼‰ï¼šå•†åº—ï¼ˆStoreï¼‰ã€ç›‘æ§å®¤ï¼ˆMonitoringRoomï¼‰ã€å«ç”Ÿé—´ï¼ˆWaterClosetï¼‰ã€‚å•†åœºçš„è®¿é—®è€…å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šé¡¾å®¢ï¼ˆCustomerï¼‰ã€å•†åœºå·¥ä½œäººå‘˜ï¼ˆMarketStaffï¼‰ã€‚é¡¾å®¢å¯ä»¥é€›å•†åº—ã€ä¸Šå«ç”Ÿé—´ï¼Œä½†å´ä¸èƒ½è¿›å…¥ç›‘æ§å®¤ï¼›å·¥ä½œäººå‘˜å¯ä»¥è¿›å…¥ç›‘æ§å®¤ã€ä¸Šå«ç”Ÿé—´ï¼Œä½†å´ä¸èƒ½åƒé¡¾å®¢ä¸€æ ·é€›å•†åº—ï¼ˆé™¤éä»–ä¸æƒ³å¹²äº†ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºå•†åœºçš„åŒä¸€ä¸ªåœ°ç‚¹ï¼Œä¸åŒçš„è®¿é—®è€…æœ‰ä¸åŒçš„è¡Œä¸ºæƒé™ï¼Œè€Œä¸”è®¿é—®è€…çš„ç§ç±»å¾ˆæœ‰å¯èƒ½éœ€è¦æ ¹æ®æ—¶é—´çš„æ¨ç§»å‘ç”Ÿå˜åŒ–ï¼ˆæ²¡å‡†å“ªå¤©ï¼Œå·¥å•†å±€çš„äººè¦æ¥è§†å¯Ÿå‘¢ï¼æ­¤æ—¶å°±éœ€è¦å¢åŠ å·¥å•†å±€äººå‘˜çš„è®¿é—®è€…äº†ã€‚ï¼‰ã€‚ ä½¿ç”¨è®¿é—®è€…æ¨¡å¼å®ç°ï¼Œå…¶ç±»å›¾å¦‚ä¸‹ï¼š Placeç›¸å½“äºè®¿é—®è€…æ¨¡å¼ä¸­çš„Elementã€‚ public abstract class Place { // æ¥å—è®¿é—®è€…çš„è®¿é—® public abstract void accept(Visitor visitor); } Placeçš„å…·ä½“å®ç°ç±»æœ‰ä¸‰ä¸ªï¼ŒWaterClosetã€Storeå’ŒMonitoringRoomã€‚ public class WaterCloset extends Place { @Override public void accept(Visitor visitor) { // å›è°ƒè®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³• visitor.visitWaterCloset(this); } public void washing() { // å«ç”Ÿé—´å·²æœ‰çš„æ–¹æ³• System.out.println(&quot;æ´—æ´—æ‰‹ã€‚ã€‚ã€‚*/&quot;); } } public class Store extends Place { @Override public void accept(Visitor visitor) { // å›è°ƒè®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³• visitor.visitStore(this); } public void shopping() { // å•†åº—å·²æœ‰çš„æ–¹æ³• System.out.println(&quot;æ¬¢è¿å…‰ä¸´ï¼Œç¥æ‚¨è´­ç‰©æ„‰å¿«ã€‚ã€‚ã€‚*/&quot;); } } public class MonitoringRoom extends Place { @Override public void accept(Visitor visitor) { // å›è°ƒè®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³• visitor.visitMonitoringRoom(this); } public void watching() { // ç›‘æ§å®¤å·²æœ‰çš„æ–¹æ³• System.out.println(&quot;æŸ¥çœ‹ç›‘æ§å½•åƒ...*/&quot;); } } æŠ½è±¡è®¿é—®è€…Visitorçš„ä»£ç å¦‚ä¸‹ã€‚ public interface Visitor { // è¿›å…¥å«ç”Ÿé—´ public void visitWaterCloset(WaterCloset wc); // è¿›å…¥ç›‘æ§å®¤ public void visitMonitoringRoom(MonitoringRoom mr); // è¿›å…¥å•†åº— public void visitStore(Store store); } Visitorçš„å…·ä½“å®ç°ç±»ï¼ŒMarketStaffå’ŒCustomerã€‚ public class MarketStaff implements Visitor { @Override public void visitWaterCloset(WaterCloset wc) { System.out.println(&quot;/*å·¥ä½œäººå‘˜æ¥åˆ°å«ç”Ÿé—´ã€‚ã€‚ã€‚&quot;); wc.washing(); System.out.println(); } @Override public void visitMonitoringRoom(MonitoringRoom mr) { System.out.println(&quot;/*å·¥ä½œäººå‘˜æ¥åˆ°ç›‘æ§å®¤ã€‚ã€‚ã€‚&quot;); mr.watching(); System.out.println(); } @Override public void visitStore(Store store) { System.out.println(&quot;/*å·¥ä½œäººå‘˜æ¥åˆ°å•†åº—ã€‚ã€‚ã€‚&quot;); System.out.println(&quot;ç°åœ¨æ˜¯å·¥ä½œæ—¶é—´ï¼Œè¯·ä¸“å¿ƒå·¥ä½œã€‚ã€‚ã€‚*/&quot;); System.out.println(); } } public class Customer implements Visitor { @Override public void visitWaterCloset(WaterCloset wc) { System.out.println(&quot;/*é¡¾å®¢æ¥åˆ°å«ç”Ÿé—´ã€‚ã€‚ã€‚&quot;); wc.washing(); System.out.println(); } @Override public void visitMonitoringRoom(MonitoringRoom mr) { System.out.println(&quot;/*é¡¾å®¢æ¥åˆ°ç›‘æ§å®¤ã€‚ã€‚ã€‚&quot;); System.out.println(&quot;éå·¥ä½œäººå‘˜ç¦æ­¢å…¥å†…ã€‚ã€‚ã€‚*/&quot;); System.out.println(); } @Override public void visitStore(Store store) { System.out.println(&quot;/*é¡¾å®¢æ¥åˆ°å•†åº—ã€‚ã€‚ã€‚&quot;); store.shopping(); System.out.println(); } } SuperMarketå°±æ˜¯ç»“æ„å¯¹è±¡ã€‚ import java.util.ArrayList; import java.util.Collection; public class SuperMarket { // ç¤ºæ„,è¡¨ç¤ºå¯¹è±¡ç»“æ„ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç»„åˆç»“æ„æˆ–è€…é›†åˆ private Collection&lt;Place&gt; col = new ArrayList&lt;Place&gt;(); public void handleRequest(Visitor visitor) { // å¾ªç¯å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ï¼Œè¿›è¡Œè®¿é—® for (Place place : col) { place.accept(visitor); } } // ç¤ºæ„æ–¹æ³•ï¼Œç»„å»ºå¯¹è±¡ç»“æ„ï¼Œå‘å¯¹è±¡ç»“æ„ä¸­æ·»åŠ å…ƒç´  public void addPlace(Place place) { this.col.add(place); } } Clientä¸­æµ‹è¯•ä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { SuperMarket superMarket = new SuperMarket(); superMarket.addPlace(new WaterCloset()); superMarket.addPlace(new Store()); superMarket.addPlace(new MonitoringRoom()); // åˆ›å»ºä¸€ä¸ªé¡¾å®¢è®¿é—®è€… Visitor customer = new Customer(); System.out.println(&quot;=====é¡¾å®¢æ¥åˆ°å•†åœº=====&quot;); superMarket.handleRequest(customer); System.out.println(&quot;=====é¡¾å®¢ç¦»å¼€å•†åœº=====&quot;); System.out.println(); // åˆ›å»ºä¸€ä¸ªå•†åœºå·¥ä½œäººå‘˜è®¿é—®è€… Visitor visitor = new MarketStaff(); System.out.println(&quot;=====å·¥ä½œäººå‘˜æ¥åˆ°å•†åœº=====&quot;); superMarket.handleRequest(visitor); System.out.println(&quot;=====å·¥ä½œäººå‘˜ç¦»å¼€å•†åœº=====&quot;); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š =====é¡¾å®¢æ¥åˆ°å•†åœº=====/é¡¾å®¢æ¥åˆ°å«ç”Ÿé—´ã€‚ã€‚ã€‚æ´—æ´—æ‰‹ã€‚ã€‚ã€‚/ /é¡¾å®¢æ¥åˆ°å•†åº—ã€‚ã€‚ã€‚æ¬¢è¿å…‰ä¸´ï¼Œç¥æ‚¨è´­ç‰©æ„‰å¿«ã€‚ã€‚ã€‚/ /é¡¾å®¢æ¥åˆ°ç›‘æ§å®¤ã€‚ã€‚ã€‚éå·¥ä½œäººå‘˜ç¦æ­¢å…¥å†…ã€‚ã€‚ã€‚/ =====é¡¾å®¢ç¦»å¼€å•†åœº===== =====å·¥ä½œäººå‘˜æ¥åˆ°å•†åœº=====/å·¥ä½œäººå‘˜æ¥åˆ°å«ç”Ÿé—´ã€‚ã€‚ã€‚æ´—æ´—æ‰‹ã€‚ã€‚ã€‚/ /å·¥ä½œäººå‘˜æ¥åˆ°å•†åº—ã€‚ã€‚ã€‚ç°åœ¨æ˜¯å·¥ä½œæ—¶é—´ï¼Œè¯·ä¸“å¿ƒå·¥ä½œã€‚ã€‚ã€‚/ /å·¥ä½œäººå‘˜æ¥åˆ°ç›‘æ§å®¤ã€‚ã€‚ã€‚æŸ¥çœ‹ç›‘æ§å½•åƒâ€¦/ =====å·¥ä½œäººå‘˜ç¦»å¼€å•†åœº===== äº”ã€è®¿é—®è€…æ¨¡å¼çš„ç‰¹ç‚¹è®¿é—®è€…æ¨¡å¼çš„ä¼˜ç‚¹ å¥½çš„æ‰©å±•æ€§ï¼šèƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ å¥½çš„å¤ç”¨æ€§ï¼šå¯ä»¥é€šè¿‡è®¿é—®è€…æ¥å®šä¹‰æ•´ä¸ªå¯¹è±¡ç»“æ„é€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜å¤ç”¨ç¨‹åº¦ã€‚ åˆ†ç¦»æ— å…³è¡Œä¸ºï¼šå¯ä»¥é€šè¿‡è®¿é—®è€…æ¥åˆ†ç¦»æ— å…³çš„è¡Œä¸ºï¼ŒæŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªè®¿é—®è€…ï¼Œè¿™æ ·æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚ è®¿é—®è€…æ¨¡å¼çš„ç¼ºç‚¹ å¢åŠ æ–°çš„å…ƒç´ ç±»å¾ˆå›°éš¾ï¼šåœ¨è®¿é—®è€…ç±»ä¸­ï¼Œæ¯ä¸€ä¸ªå…ƒç´ ç±»éƒ½æœ‰å®ƒå¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯å¢åŠ ä¸€ä¸ªå…ƒç´ ç±»éƒ½éœ€è¦ä¿®æ”¹è®¿é—®è€…ç±»ï¼ˆä¹ŸåŒ…æ‹¬è®¿é—®è€…ç±»çš„å­ç±»æˆ–è€…å®ç°ç±»ï¼‰ï¼Œä¿®æ”¹èµ·æ¥ç›¸å½“éº»çƒ¦ã€‚ ç ´åå°è£…ï¼šè®¿é—®è€…æ¨¡å¼é€šå¸¸éœ€è¦å¯¹è±¡ç»“æ„å¼€æ”¾å†…éƒ¨æ•°æ®ç»™è®¿é—®è€…å’ŒObjectStructrueï¼Œè¿™ç ´åäº†å¯¹è±¡çš„å°è£…æ€§ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"è®¿é—®è€…æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"è®¿é—®è€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/è®¿é—®è€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--äº«å…ƒæ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--äº«å…ƒæ¨¡å¼","date":"2020-05-24T08:50:10.000Z","updated":"2023-04-30T10:21:41.354Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--äº«å…ƒæ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--äº«å…ƒæ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯äº«å…ƒæ¨¡å¼äº«å…ƒFlyweightæ¨¡å¼æ˜¯æ„é€ å‹æ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒé€šè¿‡å…±äº«æ•°æ®ä½¿å¾—ç›¸åŒå¯¹è±¡åœ¨å†…å­˜ä¸­ä»…åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œä»¥é™ä½ç³»ç»Ÿåˆ›å»ºå¯¹è±¡å®ä¾‹çš„æ€§èƒ½æ¶ˆè€—ã€‚ ä»¥åšå®¢é‡Œå†™æ–‡ç« ä¸ºä¾‹æ¥è¯´å§ï¼ŒæŠŠæ–‡ç« å’Œæ–‡ç« ä¸­çš„æ–‡å­—çœ‹ä½œå¯¹è±¡ï¼Œæˆ‘ä»¬æ¯åœ¨åšå®¢é‡Œå†™ä¸€ä¸ªå­—å°±ç›¸å½“äºæ˜¯åˆ›å»ºä¸€ä¸ªæ–‡å­—å¯¹è±¡ï¼Œå‡å¦‚æˆ‘ä»¬å†™çš„æ–‡ç« æœ‰ä¸€ä¸‡ä¸ªå­—ï¼Œé‚£æˆ‘ä»¬å²‚ä¸æ˜¯è¦åˆ›å»ºä¸€ä¸‡æ¬¡æ–‡å­—å¯¹è±¡ï¼Œå¦‚æ­¤é¢‘ç¹çš„åˆ›å»ºå¯¹è±¡åŠ¿å¿…ä¼šä¸¥é‡æ‹–ç´¯ç³»ç»Ÿçš„æ€§èƒ½ã€‚ äº«å…ƒæ¨¡å¼é€šè¿‡æ•°æ®å…±äº«ä½¿å¾—é‡å¤ä½¿ç”¨çš„ç›¸åŒå¯¹è±¡åœ¨å†…å­˜ä¸­ä»…åˆ›å»ºä¸€æ¬¡ï¼šè¿™å°±å¥½æ¯”æ±‰å­—ä¸­çš„ â€œçš„â€ å­—è™½ç„¶åœ¨æ–‡ç« ä¸­åå¤å‡ºç°ï¼Œä½†å®ƒä»…åœ¨ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶å€™åˆ›å»º â€œçš„â€ (å…±äº«å¯¹è±¡)å¹¶ä¿å­˜èµ·æ¥ï¼Œä¹‹åå†ç”¨åˆ° â€œçš„â€ å­—çš„è¯ç›´æ¥è·å–ä¹‹å‰åˆ›å»ºå¥½çš„ â€œçš„â€ å¯¹è±¡å³å¯ï¼Œä¸éœ€è¦å†æ¬¡åˆ›å»ºäº†ã€‚ ä¸‹é¢æ˜¯ä¸¤å¼ ä½¿ç”¨äº«å…ƒæ¨¡å¼å‰åçš„å¯¹æ¯”å›¾ï¼Œçœ‹å®Œè¿™ä¸¤å¼ å›¾ç›¸ä¿¡å¤§å®¶å°±èƒ½ç†è§£äº«å…ƒæ¨¡å¼çš„ä½œç”¨äº†ã€‚ ä½¿ç”¨äº«å…ƒæ¨¡å¼å‰ï¼š ä½¿ç”¨äº«å…ƒæ¨¡å¼åï¼š äºŒã€äº«å…ƒæ¨¡å¼åœ¨Javaä¸­çš„å…¸å‹åº”ç”¨åœ¨Javaè¯­è¨€ä¸­ï¼ŒStringç±»å‹å°±ä½¿ç”¨äº†äº«å…ƒæ¨¡å¼ã€‚Stringå¯¹è±¡æ˜¯finalç±»å‹ï¼Œå¯¹è±¡ä¸€æ—¦åˆ›å»ºå°±ä¸å¯æ”¹å˜ï¼ŒåŒæ—¶JAVAä¼šç¡®ä¿ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼ˆä¾‹å¦‚ï¼šâ€Flyweightâ€ï¼‰åœ¨å¸¸é‡æ± ä¸­åªèƒ½å­˜åœ¨ä¸€ä»½æ‹·è´,ä¾‹å¦‚ä¸‹é¢è¿™æ®µç®€å•ä»£ç ï¼š String str1=&quot;Flyweight&quot;; String str2=&quot;Flyweight&quot;; if(str1==str2){ System.out.println(&quot;str1ä¸str2æŒ‡å‘åŒä¸€å¯¹è±¡&quot;); } else { System.out.println(&quot;str1ä¸str2æŒ‡å‘ä¸åŒå¯¹è±¡&quot;); } æ‰“å°ç»“æœï¼š str1ä¸str2æŒ‡å‘åŒä¸€å¯¹è±¡ åœ¨ä»¥ä¸Šä»£ç ä¸­ifè¯­å¥æ¯”è¾ƒçš„æ˜¯å¯¹è±¡str1å’Œstr2ä¸­å­˜å‚¨çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸åŒï¼Œä»æœ€ç»ˆçš„æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼šä¸¤æ¬¡åˆ›å»ºçš„å­—ç¬¦ä¸²å¸¸é‡â€Flyweightâ€å†…å­˜åœ°å€ç›¸åŒï¼Œå³ä¸¤ä¸ªå­—ç¬¦ä¸²å…¶å®æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ ä¸‰ã€äº«å…ƒæ¨¡å¼çš„ç»“æ„äº«å…ƒæ¨¡å¼åˆ†ä¸ºå•çº¯äº«å…ƒæ¨¡å¼å’Œå¤åˆäº«å…ƒæ¨¡å¼ä¸¤ç§ã€‚ å•çº¯äº«å…ƒæ¨¡å¼ å•çº¯äº«å…ƒæ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡äº«å…ƒ(Flyweight)è§’è‰²ï¼šæ‰€æœ‰å…·ä½“äº«å…ƒç±»çš„çˆ¶ç±»æˆ–å®ç°çš„æ¥å£ï¼Œä»¥è§„å®šæ‰€æœ‰å…·ä½“äº«å…ƒè§’è‰²éœ€è¦å®ç°çš„æ–¹æ³•ã€‚ å…·ä½“äº«å…ƒ(ConcreteFlyweight)è§’è‰²ï¼šåˆå«å•çº¯äº«å…ƒè§’è‰²ï¼Œæ˜¯æŠ½è±¡äº«å…ƒè§’è‰²çš„å…·ä½“å®ç°ç±»ï¼Œå¦‚æœæœ‰å†…è•´çŠ¶æ€çš„è¯ï¼Œå®ƒè´Ÿè´£ä¸ºå†…è•´çŠ¶æ€æä¾›å­˜å‚¨ç©ºé—´ã€‚å…·ä½“äº«å…ƒå¯¹è±¡çš„å†…è•´çŠ¶æ€å¿…é¡»ä¸å¯¹è±¡æ‰€å¤„çš„å‘¨å›´ç¯å¢ƒæ— å…³ï¼Œä»è€Œä½¿å¾—äº«å…ƒå¯¹è±¡å¯ä»¥åœ¨ç³»ç»Ÿå†…å…±äº«ã€‚ äº«å…ƒå·¥å‚(FlyweightFactory)è§’è‰²ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†äº«å…ƒè§’è‰²ã€‚æœ¬è§’è‰²å¿…é¡»ä¿è¯äº«å…ƒå¯¹è±¡å¯ä»¥è¢«ç³»ç»Ÿé€‚å½“åœ°å…±äº«ã€‚å½“å®¢æˆ·ç«¯è°ƒç”¨æŸä¸ªäº«å…ƒå¯¹è±¡çš„æ—¶å€™ï¼Œäº«å…ƒå·¥å‚è§’è‰²ä¼šæ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å·²ç»å­˜åœ¨ç¬¦åˆè¦æ±‚çš„äº«å…ƒå¯¹è±¡ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ç›´æ¥æä¾›ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ–°åˆ›å»ºä¸€ä¸ªã€‚ å•çº¯äº«å…ƒæ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šåœ¨å•çº¯çš„äº«å…ƒæ¨¡å¼ä¸­ï¼ŒFlyweightæ¥å£ç”¨ä»¥è§„å®šå‡ºæ‰€æœ‰å…·ä½“äº«å…ƒè§’è‰²éœ€è¦å®ç°çš„æ–¹æ³•ã€‚ public interface Flyweight { /** * ç”¨ä»¥è§„å®šæ‰€æœ‰å…·ä½“äº«å…ƒè§’è‰²éœ€è¦å®ç°çš„æ–¹æ³•. */ void operation(String extrinsicState); } å…·ä½“äº«å…ƒConcreteFlyweightä¸€æ–¹é¢è¦ä¿å­˜éœ€å…±äº«çš„å†…è•´çŠ¶æ€ï¼Œå¦ä¸€æ–¹é¢å°†å¤–è•´çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ å…¥operation()æ–¹æ³•ä¸­ï¼Œå¯æ”¹å˜æ–¹æ³•çš„è¡Œä¸ºï¼Œä½†å¹¶ä¸æ”¹å˜å¯¹è±¡çš„å†…è•´çŠ¶æ€ã€‚ public class ConcreteFlyweight implements Flyweight { private String intrinsicState = null; /** * æ„é€ å‡½æ•°ä¸­å†…è•´çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ å…¥. */ public ConcreteFlyweight(String intrinsicState) { this.intrinsicState = intrinsicState; } /** * å¤–è•´çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ å…¥æ–¹æ³•ä¸­ï¼Œå¯æ”¹å˜æ–¹æ³•çš„è¡Œä¸ºï¼Œä½†å¹¶ä¸æ”¹å˜å¯¹è±¡çš„å†…è•´çŠ¶æ€. */ @Override public void operation(String extrinsicState) { System.out.println(); System.out.println(&quot;å†…è•´çŠ¶æ€ï¼š&quot; + intrinsicState); System.out.println(&quot;å¤–è•´çŠ¶æ€ï¼š&quot; + extrinsicState); System.out.println(&quot;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&quot;); } public String toString() { return this.intrinsicState; } } äº«å…ƒå·¥å‚FlyweightFactoryè´Ÿè´£ç»´æŠ¤ä¸€ä¸ªäº«å…ƒå¯¹è±¡å­˜å‚¨æ± ï¼ˆFlyweight Poolï¼‰æ¥å­˜æ”¾å†…éƒ¨çŠ¶æ€çš„å¯¹è±¡ã€‚ä¸ºäº†è°ƒç”¨æ–¹ä¾¿ï¼Œè¯¥å·¥å‚ç±»ä¸€èˆ¬ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚ import java.util.HashMap; import java.util.Map; public class FlyweightFactory { // ç”¨æ¥ç™»è®°å’Œå­˜å‚¨å·²ç»åˆ›å»ºè¿‡çš„äº«å…ƒå¯¹è±¡ private Map&lt;String, Flyweight&gt; flyweightMap = new HashMap&lt;String, Flyweight&gt;(); // é‡‡ç”¨å•ä¾‹æ¨¡å¼ private static FlyweightFactory flyweightFactory = new FlyweightFactory(); // ç§æœ‰åŒ–äº«å…ƒå·¥å‚çš„æ„é€ æ–¹æ³• private FlyweightFactory() { } // è·å–å•ä¾‹äº«å…ƒå·¥å‚çš„å®ä¾‹ public static FlyweightFactory getFlyweightFactory() { return flyweightFactory; } public Flyweight getFlyweight(String intrinsicState) { Flyweight flyweight = flyweightMap.get(intrinsicState); if (null == flyweight) { flyweight = new ConcreteFlyweight(intrinsicState); flyweightMap.put(intrinsicState, flyweight); } return flyweight; } public Map&lt;String, Flyweight&gt; getFlyweightMap() { return flyweightMap; } } åœ¨Clientç±»ä¸­åˆ›å»ºçš„main()æ–¹æ³•ä¸­è¿›è¡Œæµ‹è¯•ã€‚ import java.util.Map.Entry; public class Client { public static void main(String[] args) { FlyweightFactory flyweightFactory = FlyweightFactory.getFlyweightFactory(); flyweightFactory.getFlyweight(&quot;çˆ±&quot;).operation(&quot;ä½ç½®1&quot;); flyweightFactory.getFlyweight(&quot;æˆ‘&quot;).operation(&quot;ä½ç½®2&quot;); flyweightFactory.getFlyweight(&quot;çš„&quot;).operation(&quot;ä½ç½®3&quot;); flyweightFactory.getFlyweight(&quot;äºº&quot;).operation(&quot;ä½ç½®4&quot;); flyweightFactory.getFlyweight(&quot;å’Œ&quot;).operation(&quot;ä½ç½®5&quot;); flyweightFactory.getFlyweight(&quot;æˆ‘&quot;).operation(&quot;ä½ç½®6&quot;); flyweightFactory.getFlyweight(&quot;çˆ±&quot;).operation(&quot;ä½ç½®7&quot;); flyweightFactory.getFlyweight(&quot;çš„&quot;).operation(&quot;ä½ç½®8&quot;); flyweightFactory.getFlyweight(&quot;äºº&quot;).operation(&quot;ä½ç½®9&quot;); System.out.println(&quot;å·²å­˜å‚¨çš„äº«å…ƒå¯¹è±¡ä¸ªæ•°ï¼š&quot;+flyweightFactory.getFlyweightMap().size()+&quot;ä¸ª&quot;); for (Entry&lt;String, Flyweight&gt; entry : flyweightFactory.getFlyweightMap().entrySet()) { System.out.println(entry.getValue()); } } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š å†…è•´çŠ¶æ€ï¼šçˆ±å¤–è•´çŠ¶æ€ï¼šä½ç½®1&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šæˆ‘å¤–è•´çŠ¶æ€ï¼šä½ç½®2&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šçš„å¤–è•´çŠ¶æ€ï¼šä½ç½®3&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šäººå¤–è•´çŠ¶æ€ï¼šä½ç½®4&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šå’Œå¤–è•´çŠ¶æ€ï¼šä½ç½®5&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šæˆ‘å¤–è•´çŠ¶æ€ï¼šä½ç½®6&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šçˆ±å¤–è•´çŠ¶æ€ï¼šä½ç½®7&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šçš„å¤–è•´çŠ¶æ€ï¼šä½ç½®8&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šäººå¤–è•´çŠ¶æ€ï¼šä½ç½®9&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;å·²å­˜å‚¨çš„äº«å…ƒå¯¹è±¡ä¸ªæ•°ï¼š5ä¸ªçˆ±æˆ‘çš„äººå’Œ ä»ä»¥ä¸Šç¨‹åºçš„è¿è¡Œç»“æœä¸éš¾çœ‹å‡ºï¼Œè™½ç„¶æˆ‘ä»¬æ–°å»ºäº†9ä¸ªFlyweightå¯¹è±¡ï¼Œä½†åœ¨å†…å­˜æ± ä¸­å®é™…ä¸Šåªæœ‰5ä¸ªï¼Œè¿™å°±æ˜¯å…±äº«çš„å«ä¹‰ã€‚ å¤åˆäº«å…ƒæ¨¡å¼åœ¨å•çº¯äº«å…ƒæ¨¡å¼ä¸­ï¼Œæ‰€æœ‰çš„äº«å…ƒå¯¹è±¡éƒ½æ˜¯å•çº¯äº«å…ƒå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´éƒ½æ˜¯å¯ä»¥ç›´æ¥å…±äº«çš„ã€‚è¿˜æœ‰ä¸€ç§è¾ƒä¸ºå¤æ‚çš„æƒ…å†µï¼Œå°†ä¸€äº›å•çº¯äº«å…ƒå¯¹è±¡ä½¿ç”¨åˆæˆæ¨¡å¼åŠ ä»¥ç»„åˆï¼Œå½¢æˆå¤åˆäº«å…ƒå¯¹è±¡ã€‚è¿™æ ·çš„å¤åˆäº«å…ƒå¯¹è±¡æœ¬èº«ä¸èƒ½å…±äº«ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥åˆ†è§£æˆå•çº¯äº«å…ƒå¯¹è±¡ï¼Œè€Œåè€…åˆ™å¯ä»¥å…±äº«ã€‚ ä¸å•çº¯äº«å…ƒæ¨¡å¼ç›¸æ¯”ï¼Œå¤åˆäº«å…ƒæ¨¡å¼å¢åŠ äº†ä¸€ä¸ªå¤åˆäº«å…ƒ(UnsharedConcreteFlyweight)è§’è‰²ï¼Œå¤åˆäº«å…ƒè§’è‰²æ‰€ä»£è¡¨çš„å¯¹è±¡æ˜¯ä¸å¯ä»¥å…±äº«çš„ï¼Œåˆç§°ä½œä¸å¯å…±äº«çš„äº«å…ƒå¯¹è±¡ã€‚ å¤åˆäº«å…ƒè§’è‰²å®ç°äº†æŠ½è±¡äº«å…ƒè§’è‰²æ‰€è§„å®šçš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯operation()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨å¤åˆäº«å…ƒå¯¹è±¡çš„å¤–è•´çŠ¶æ€ã€‚ä¸€ä¸ªå¤åˆäº«å…ƒå¯¹è±¡çš„æ‰€æœ‰å•çº¯äº«å…ƒå¯¹è±¡çš„å¤–è•´çŠ¶æ€éƒ½æ˜¯ä¸å¤åˆäº«å…ƒå¯¹è±¡çš„å¤–è•´çŠ¶æ€ç›¸ç­‰çš„ï¼›è€Œä¸€ä¸ªå¤åˆäº«å…ƒå¯¹è±¡æ‰€å«æœ‰çš„å•çº¯äº«å…ƒå¯¹è±¡çš„å†…è•´çŠ¶æ€ä¸€èˆ¬æ˜¯ä¸ç›¸ç­‰çš„ï¼Œä¸ç„¶å°±æ²¡æœ‰ä½¿ç”¨ä»·å€¼äº†ã€‚ å¤åˆäº«å…ƒæ¨¡å¼æœ¬è´¨ä¸Šå°±ç›¸å½“äºå°†åŸæœ¬æºæ‚åœ¨ä¸€èµ·çš„å•çº¯äº«å…ƒå¯¹è±¡ï¼Œæ ¹æ®ä¸åŒçš„å¤–è•´çŠ¶æ€é‡æ–°è¿›è¡Œäº†äºŒæ¬¡åˆ†ç»„ã€‚è¿™å°±å¥½æ¯”åœ¨é¥­åº—ç‚¹é¤æ—¶ï¼Œé¥­åº—ä¼šå°†ä¸åŒé¡¾å®¢ç‚¹çš„èœè®°å½•åœ¨é¡¾å®¢è‡ªå·±çš„ç‚¹èœå•(è´¦å•)ä¸Šä¸€æ ·ï¼Œä¸å°†æ‰€æœ‰é¡¾å®¢ç‚¹çš„èœéƒ½è®°å½•åˆ°ä¸€ä¸ªç‚¹èœå•ä¸Šç›¸æ¯”ï¼Œåˆ†å¼€è®°å½•å¾ˆæ˜æ˜¾æ›´ä¾¿äºç®¡ç†ã€ä¸€ç›®äº†ç„¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»¥ç‚¹é¤ä¸ºä¾‹æ¥å­¦ä¹ å¤åˆäº«å…ƒæ¨¡å¼ã€‚ å¤åˆäº«å…ƒæ¨¡å¼ä¸å•çº¯äº«å…ƒæ¨¡å¼çš„å·®å¼‚ä»£ç å¦‚ä¸‹ï¼šé¦–å…ˆå¤åˆäº«å…ƒæ¨¡å¼å¢åŠ äº†ä¸€ä¸ªä¸å¯å…±äº«çš„å¤åˆäº«å…ƒ(UnsharedConcreteFlyweight)è§’è‰²ã€‚ import java.util.HashMap; import java.util.Map; public class UnsharedConcreteFlyweight implements Flyweight { //ç”¨æ¥ç™»è®°å’Œå­˜å‚¨å·²ç»åˆ›å»ºè¿‡çš„äº«å…ƒå¯¹è±¡ private Map&lt;String, Flyweight&gt; flyweightMap = new HashMap&lt;String, Flyweight&gt;(); //æŒ‡å®šæ‰€æœ‰äº«å…ƒå¯¹è±¡çš„å¤–è•´çŠ¶æ€ private String extrinsicState = null; // å¢åŠ ä¸€ä¸ªæ–°çš„å•çº¯äº«å…ƒå¯¹è±¡åˆ°é›†åˆä¸­ public void add(String intrinsicState, Flyweight flyweight) { flyweightMap.put(intrinsicState, flyweight); } @Override public void operation(String extrinsicState) { this.extrinsicState = extrinsicState; } public void getFlyweight(String intrinsicState){ Flyweight flyweight=flyweightMap.get(intrinsicState); if(null!=flyweight){ flyweight.operation(extrinsicState); } else{ System.out.println(); System.out.println(extrinsicState+&quot;æœªç‚¹è¿‡:&quot;+intrinsicState); System.out.println(&quot;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&quot;); } } public Map&lt;String, Flyweight&gt; getFlyweightMap() { return flyweightMap; } } äº«å…ƒå·¥å‚FlyweightFactoryä»…éœ€æ·»åŠ ä¸€ä¸ªç”¨äºè·å–å¤åˆäº«å…ƒå¯¹è±¡çš„getUnsharedFlyweight()æ–¹æ³•ï¼Œå…¶ä»–ä»£ç æ— éœ€ä¿®æ”¹ã€‚ public class FlyweightFactory { /** * æ­¤å¤„çœç•¥å•çº¯äº«å…ƒæ¨¡å¼ä¸­äº«å…ƒå·¥å‚å·²æœ‰ä»£ç  * ... * ... * åŸæœ‰ä»£ç ä¸å˜ï¼Œä»…æ–°å¢ä¸€ä¸ªgetUnsharedFlyweight()æ–¹æ³•. */ public UnsharedConcreteFlyweight getUnsharedFlyweight(List&lt;String&gt; intrinsicStates) { UnsharedConcreteFlyweight unsharedFlyweight = new UnsharedConcreteFlyweight(); for (String intrinsicState : intrinsicStates) { unsharedFlyweight.add(intrinsicState, getFlyweight(intrinsicState)); } return unsharedFlyweight; } } åœ¨Clientå®¢æˆ·ç«¯ç±»è¿›è¡Œæµ‹è¯•ï¼Œå…¶ä¿®æ”¹åä»£ç å¦‚ä¸‹ã€‚ import java.util.ArrayList; import java.util.List; public class Client { public static void main(String[] args) { List&lt;String&gt; intrinsicStates = new ArrayList&lt;String&gt;(); intrinsicStates.add(&quot;æœ¨é¡»è‚‰&quot;); intrinsicStates.add(&quot;åœ°ä¸‰é²œ&quot;); intrinsicStates.add(&quot;å­œç„¶ç‰›è‚‰&quot;); FlyweightFactory flyFactory =FlyweightFactory.getFlyweightFactory(); UnsharedConcreteFlyweight unsharedFlyweight1 = flyFactory.getUnsharedFlyweight(intrinsicStates); UnsharedConcreteFlyweight unsharedFlyweight2 = flyFactory.getUnsharedFlyweight(intrinsicStates); System.out.println(&quot;å¤åˆäº«å…ƒå¯¹è±¡æ˜¯å¦å¯ä»¥å…±äº«ï¼š&quot; + (unsharedFlyweight1 == unsharedFlyweight2)); unsharedFlyweight1.operation(&quot;ä¸€å·æ¡Œ&quot;); unsharedFlyweight2.operation(&quot;äº”å·æ¡Œ&quot;); //å¼€å§‹ç»™ä¸€å·æ¡Œä¸Šèœäº† unsharedFlyweight1.getFlyweight(&quot;æœ¨é¡»è‚‰&quot;); unsharedFlyweight1.getFlyweight(&quot;åœ°ä¸‰é²œ&quot;); unsharedFlyweight1.getFlyweight(&quot;å­œç„¶ç‰›è‚‰&quot;); unsharedFlyweight1.getFlyweight(&quot;éœ¸ç‹é¤&quot;); System.out.println(); String intrinsicState =&quot;æœ¨é¡»è‚‰&quot;; Flyweight flyweight1 = unsharedFlyweight1.getFlyweightMap().get(intrinsicState); Flyweight flyweight2 = unsharedFlyweight2.getFlyweightMap().get(intrinsicState); System.out.println(&quot;ä¸åŒå¤åˆäº«å…ƒå¯¹è±¡ä¸­çš„å•çº¯äº«å…ƒå¯¹è±¡æ˜¯å¦å¯ä»¥å…±äº«ï¼š&quot; + (flyweight1 == flyweight2)); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š å¤åˆäº«å…ƒå¯¹è±¡æ˜¯å¦å¯ä»¥å…±äº«ï¼šfalse å†…è•´çŠ¶æ€ï¼šæœ¨é¡»è‚‰å¤–è•´çŠ¶æ€ï¼šä¸€å·æ¡Œ&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šåœ°ä¸‰é²œå¤–è•´çŠ¶æ€ï¼šä¸€å·æ¡Œ&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; å†…è•´çŠ¶æ€ï¼šå­œç„¶ç‰›è‚‰å¤–è•´çŠ¶æ€ï¼šä¸€å·æ¡Œ&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; ä¸€å·æ¡Œæœªç‚¹è¿‡:éœ¸ç‹é¤&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; ä¸åŒå¤åˆäº«å…ƒå¯¹è±¡ä¸­çš„å•çº¯äº«å…ƒå¯¹è±¡æ˜¯å¦å¯ä»¥å…±äº«ï¼štrue å››ã€äº«å…ƒæ¨¡å¼åº”ç”¨ä¸¾ä¾‹åœºæ™¯ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬è¦åšä¸€ä¸ªç”»å›¾ç¨‹åºï¼Œä¸ºç®€å•èµ·è§ï¼Œå‡è®¾è¯¥ç”»å›¾ç¨‹åºä»…èƒ½ç”»ç›¸åŒå¤§å°(ç›´å¾„20mm)çš„åœ†ï¼Œä½†åœ†çš„é¢œè‰²å’Œä½ç½®å¯ä»¥ä¸åŒã€‚ å¦‚æœæƒ³è¦ä½¿ç”¨äº«å…ƒæ¨¡å¼æ¥å¯¹è¯¥ç”»å›¾ç¨‹åºè¿›è¡Œè®¾è®¡çš„è¯ï¼Œé¦–å…ˆè¦æå–å‡ºäº«å…ƒå¯¹è±¡(åœ†)çš„å†…è•´çŠ¶æ€å’Œå¤–è•´çŠ¶æ€ã€‚ å†…è•´çŠ¶æ€ï¼šåœ†çš„é¢œè‰²ã€‚ å¤–è•´çŠ¶æ€ï¼šåœ†çš„ä½ç½®ã€‚ æ¥ä¸‹æ¥ï¼Œé¦–å…ˆå®šä¹‰äº«å…ƒå¯¹è±¡çš„æŠ½è±¡æ¥å£Circleï¼Œåªå«æœ‰ä¸€ä¸ªdraw()æ–¹æ³•ã€‚ public interface Circle { //ç”»åœ†æ–¹æ³•ï¼Œéœ€ä¼ å…¥ç»˜åˆ¶çš„åæ ‡x,y void draw(int x,int y); } ç„¶åå†å®šä¹‰å…·ä½“äº«å…ƒè§’è‰²ç±»ConcreteCircleã€‚ import java.awt.Color; public class ConcreteCircle implements Circle { //å†…è•´çŠ¶æ€ï¼Œåœ†çš„é¢œè‰² private Color color; //æ„é€ å‡½æ•°ä¸­å†…è•´çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ å…¥. public ConcreteCircle(Color color){ super(); this.color=color; } // å¤–è•´çŠ¶æ€ä½œä¸ºå‚æ•°ä¼ å…¥ç»˜å›¾æ–¹æ³•ä¸­ï¼Œç”¨ä»¥æŒ‡å®šç»˜å›¾ä½ç½®. @Override public void draw(int x, int y) { System.out.println(&quot;åœ†çš„é¢œè‰²ï¼š&quot;+this.color+&quot;ï¼Œåæ ‡ï¼šX &quot;+x+&quot;,Y &quot;+y+&quot;ã€‚&quot;); } } å†å®šä¹‰äº«å…ƒå·¥å‚ç±»CircleFactoryã€‚ import java.awt.Color; import java.util.HashMap; import java.util.Map; public class CircleFactory { private Map&lt;Color, Circle&gt; circleMap = new HashMap&lt;Color, Circle&gt;(); // é‡‡ç”¨å•ä¾‹æ¨¡å¼ private static CircleFactory circleFactory = new CircleFactory(); // ç§æœ‰åŒ–äº«å…ƒå·¥å‚çš„æ„é€ æ–¹æ³• private CircleFactory() { } // è·å–å•ä¾‹äº«å…ƒå·¥å‚çš„å®ä¾‹ public static CircleFactory getCircleFactory() { return circleFactory; } public Circle getCircle(Color color) { Circle circle = circleMap.get(color); if (null == circle) { circle = new ConcreteCircle(color); circleMap.put(color, circle); } return circle; } } æœ€ååˆ›å»ºå®¢æˆ·ç«¯Clientç±»ã€‚ import java.awt.Color; public class Client { public static void main(String[] args) { /** * 7ä¸ªçº¢è‰²åœ†çš„åæ ‡ï¼š(0,0) (0,25) (0,50) (0,75) (0,100) (25,100) (50,100) * 11ä¸ªè“è‰²åœ†çš„åæ ‡ï¼š(100,0) (125,0) (150,0) (100,25) (100,50) (125,50) (150,50) (100,75) (100,100) (125,100) (150,100) * 11ä¸ªç»¿è‰²åœ†çš„åæ ‡ï¼š(200,0) (225,0) (250,0) (200,25) (200,50) (225,50) (250,50) (200,75) (200,100) (225,100) (250,100) */ CircleFactory circleFactory=CircleFactory.getCircleFactory(); circleFactory.getCircle(Color.RED).draw(0, 0); circleFactory.getCircle(Color.RED).draw(0, 25); circleFactory.getCircle(Color.RED).draw(0, 50); circleFactory.getCircle(Color.RED).draw(0, 75); circleFactory.getCircle(Color.RED).draw(0, 100); circleFactory.getCircle(Color.RED).draw(25, 100); circleFactory.getCircle(Color.RED).draw(50, 100); /** * ...ç¯‡å¹…æ‰€é™ï¼Œè“è‰²åœ†å’Œç»¿è‰²åœ†çš„ç»˜åˆ¶ä»£ç æ­¤å¤„çœç•¥... */ } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š åœ†çš„é¢œè‰²ï¼šjava.awt.Color[r=255,g=0,b=0]ï¼Œåæ ‡ï¼šX 0,Y 0ã€‚åœ†çš„é¢œè‰²ï¼šjava.awt.Color[r=255,g=0,b=0]ï¼Œåæ ‡ï¼šX 0,Y 25ã€‚åœ†çš„é¢œè‰²ï¼šjava.awt.Color[r=255,g=0,b=0]ï¼Œåæ ‡ï¼šX 0,Y 50ã€‚åœ†çš„é¢œè‰²ï¼šjava.awt.Color[r=255,g=0,b=0]ï¼Œåæ ‡ï¼šX 0,Y 75ã€‚åœ†çš„é¢œè‰²ï¼šjava.awt.Color[r=255,g=0,b=0]ï¼Œåæ ‡ï¼šX 0,Y 100ã€‚åœ†çš„é¢œè‰²ï¼šjava.awt.Color[r=255,g=0,b=0]ï¼Œåæ ‡ï¼šX 25,Y 100ã€‚åœ†çš„é¢œè‰²ï¼šjava.awt.Color[r=255,g=0,b=0]ï¼Œåæ ‡ï¼šX 50,Y 100ã€‚ äº”ã€äº«å…ƒæ¨¡å¼çš„é€‚ç”¨æ€§Flyweightæ¨¡å¼çš„æœ‰æ•ˆæ€§å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå¦‚ä½•ä½¿ç”¨å®ƒä»¥åŠåœ¨ä½•å¤„ä½¿ç”¨å®ƒã€‚å½“å‡ºç°ä¸‹åˆ—æƒ…å½¢æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨Flyweightæ¨¡å¼ã€‚ ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤§é‡çš„å¯¹è±¡ã€‚ å®Œå…¨ç”±äºä½¿ç”¨å¤§é‡çš„å¯¹è±¡ï¼Œé€ æˆå¾ˆå¤§çš„å­˜å‚¨å¼€é”€ã€‚ å¯¹è±¡çš„å¤§å¤šæ•°çŠ¶æ€éƒ½å¯å˜ä¸ºå¤–éƒ¨çŠ¶æ€ã€‚ å¦‚æœåˆ é™¤å¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ç›¸å¯¹è¾ƒå°‘çš„å…±äº«å¯¹è±¡å–ä»£å¾ˆå¤šç»„å¯¹è±¡ã€‚ åº”ç”¨ç¨‹åºä¸ä¾èµ–å¯¹è±¡æ ‡è¯†ã€‚ å…­ã€äº«å…ƒæ¨¡å¼çš„ç‰¹ç‚¹äº«å…ƒæ¨¡å¼çš„ä¼˜ç‚¹ï¼šå‡å°‘å¯¹è±¡æ•°é‡ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚äº«å…ƒæ¨¡å¼çš„ç¼ºç‚¹ï¼š äº«å…ƒæ¨¡å¼ä½¿å¾—ç³»ç»Ÿæ›´åŠ å¤æ‚ã€‚ä¸ºäº†ä½¿å¯¹è±¡å¯ä»¥å…±äº«ï¼Œéœ€è¦å°†ä¸€äº›çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œè¿™ä½¿å¾—ç¨‹åºçš„é€»è¾‘å¤æ‚åŒ–ã€‚ äº«å…ƒæ¨¡å¼å°†äº«å…ƒå¯¹è±¡çš„çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œè€Œè¯»å–å¤–éƒ¨çŠ¶æ€ä½¿å¾—è¿è¡Œæ—¶é—´ç¨å¾®å˜é•¿ã€‚ äº«å…ƒæ¨¡å¼çš„æœ¬è´¨ï¼šåˆ†ç¦»ä¸å…±äº« ä¸ƒã€æ€»ç»“äº«å…ƒæ¨¡å¼æ˜¯ä¸€ä¸ªè€ƒè™‘ç³»ç»Ÿæ€§èƒ½çš„è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡ä½¿ç”¨äº«å…ƒæ¨¡å¼å¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚äº«å…ƒæ¨¡å¼çš„æ ¸å¿ƒåœ¨äºäº«å…ƒå·¥å‚ç±»ï¼Œäº«å…ƒå·¥å‚ç±»çš„ä½œç”¨åœ¨äºæä¾›ä¸€ä¸ªç”¨äºå­˜å‚¨äº«å…ƒå¯¹è±¡çš„äº«å…ƒæ± ï¼Œç”¨æˆ·éœ€è¦å¯¹è±¡æ—¶ï¼Œé¦–å…ˆä»äº«å…ƒæ± ä¸­è·å–ï¼Œå¦‚æœäº« å…ƒæ± ä¸­ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº«å…ƒå¯¹è±¡è¿”å›ç»™ç”¨æˆ·ï¼Œå¹¶åœ¨äº«å…ƒæ± ä¸­ä¿å­˜è¯¥æ–°å¢å¯¹è±¡ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"äº«å…ƒæ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"äº«å…ƒæ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/äº«å…ƒæ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--é€‚é…å™¨æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--é€‚é…å™¨æ¨¡å¼","date":"2020-05-24T08:48:43.000Z","updated":"2023-04-30T10:21:41.363Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--é€‚é…å™¨æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--é€‚é…å™¨æ¨¡å¼/","excerpt":"","text":"1ã€ä»€ä¹ˆæ˜¯é€‚é…å™¨æ¨¡å¼é€‚é…å™¨(Adapter)æ¨¡å¼åˆå«åšåŒ…è£…( Wrapper )æ¨¡å¼ï¼Œæ˜¯ç”±GOFæå‡ºçš„23ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼ŒAdapteræ¨¡å¼çš„è®¾è®¡æ„å›¾ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥åœ¨ä¸€èµ·å·¥ä½œã€‚ 2ã€é€‚é…å™¨æ¨¡å¼çš„é€‚ç”¨åœºæ™¯ å¦‚å›¾æ‰€ç¤ºï¼Œæœ‰æ—¶ï¼Œä¸ºå¤ç”¨è€Œè®¾è®¡çš„å·¥å…·ç±»å¸¸å¸¸ä¼šå› ä¸ºå®ƒçš„æ¥å£ä¸ä¸“ä¸šåº”ç”¨é¢†åŸŸæ‰€éœ€è¦çš„æ¥å£ä¸åŒ¹é…è€Œä¸èƒ½å¤Ÿè¢«å¤ç”¨ã€‚ å†ä¸¾ä¸ªJavaç•Œé¢ç¨‹åºå¼€å‘ä¸­çš„çœŸå®æ¡ˆä¾‹ï¼šæˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªç»˜å›¾ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªç¼–è¾‘å™¨å…è®¸ç”¨æˆ·ç»˜åˆ¶å’Œæ’åˆ—åŸºæœ¬å›¾å…ƒ(çº¿ã€å¤šè¾¹å½¢ã€æ­£æ–‡ç­‰)ï¼Œå›¾å…ƒå¯¹è±¡çš„æŠ½è±¡æˆ‘ä»¬ç”¨ä¸€ä¸ª Shape æ¥å£æ¥å®šä¹‰ï¼Œæ‰€æœ‰çš„å…·ä½“å›¾å…ƒç±»å‹éƒ½è¦å®ç° Shape æ¥å£ï¼šLineShapeç±»å¯¹åº”äºç›´çº¿ï¼ŒPolygonShapeç±»å¯¹åº”äºå¤šè¾¹å½¢ï¼ŒTextShapeç±»å¯¹åº”äºæ­£æ–‡ï¼Œç­‰ç­‰ã€‚ å¯¹äºåƒLineShapeå’ŒPolygonShapeè¿™æ ·çš„åŸºæœ¬å›¾å…ƒç±»ç”±äºå®ƒä»¬çš„ç¼–è¾‘åŠŸèƒ½æœ¬æ¥å°±å¾ˆæœ‰é™ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½å¤Ÿå®ç°ã€‚ä½†æ˜¯å¯¹äºå¯ä»¥æ˜¾ç¤ºå’Œç¼–è¾‘æ­£æ–‡çš„TextShapeå­ç±»æ¥è¯´ï¼Œå®ç°ç›¸å½“å›°éš¾ï¼Œå› ä¸ºå³ä½¿æ˜¯åŸºæœ¬çš„æ­£æ–‡ç¼–è¾‘ä¹Ÿè¦æ¶‰åŠåˆ°å¤æ‚çš„å±å¹•åˆ·æ–°å’Œç¼“å†²åŒºç®¡ç†ã€‚åŒæ—¶ï¼Œå¤–ç•Œå¯èƒ½å·²ç»å­˜åœ¨äº†ä¸€ä¸ªç°æˆçš„å·¥å…·ç±»TextViewå¯ä»¥ç”¨äºæ˜¾ç¤ºå’Œç¼–è¾‘æ­£æ–‡ã€‚ç†æƒ³çš„æƒ…å†µæ˜¯æˆ‘ä»¬å¯ä»¥å¤ç”¨è¿™ä¸ªTextViewç±»ä»¥å®ç°TextShapeç±»çš„åŠŸèƒ½ï¼Œä¸å·§çš„æ˜¯è¿™ä¸ªTextViewç±»çš„è®¾è®¡è€…å½“æ—¶å¹¶æ²¡æœ‰è€ƒè™‘ Shape çš„å­˜åœ¨ï¼Œå¯¼è‡´TextViewç±»å’Œ Shapeçš„æ¥å£äº’ä¸å…¼å®¹ã€‚ ç±»ä¼¼åœ°ï¼Œåƒä¸Šé¢è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¤ç”¨TextViewè¿™æ ·å·²ç»å­˜åœ¨çš„ç±»ï¼Œä½†æ­¤ç±»ä¸æˆ‘ä»¬ç³»ç»Ÿè¦æ±‚çš„æ¥å£ä¸åŒ¹é…ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥æ”¹å˜TextViewç±»ä½¿å®ƒå…¼å®¹Shapeæ¥å£ï¼Œä½†å‰ææ˜¯å¿…é¡»æœ‰è¿™ä¸ªTextViewç±»çš„æºä»£ç ã€‚ç„¶è€Œå³ä½¿æˆ‘ä»¬å¾—åˆ°äº†è¿™äº›æºä»£ç ï¼Œä¿®æ”¹TextViewä¹Ÿæ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„ï¼šå› ä¸ºä¸åº”è¯¥ä»…ä»…ä¸ºäº†å®ç°ä¸€ä¸ªåº”ç”¨ï¼Œå°±å»ä¿®æ”¹é‚£äº›ä¸ºå¤ç”¨è€Œè®¾è®¡çš„å·¥å…·ç®±ç±»ï¼Œè¿«ä½¿å®ƒä»¬å®ç°ä¸ç‰¹å®šé¢†åŸŸç›¸å…³çš„æ¥å£(æ­¤å¤„æ˜¯ Shape æ¥å£)ã€‚ æˆ‘ä»¬å¯ä»¥ä¸ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œè½¬è€Œå®šä¹‰ä¸€ä¸ªTextShapeç±»ï¼Œç”±å®ƒæ¥é€‚é…TextViewçš„æ¥å£å’ŒShapeçš„æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢ä¸¤ç§æ–¹æ³•åšæˆè¿™ä»¶äº‹ï¼š å°†TextShapeç»§æ‰¿TextViewå¹¶å®ç°Shapeæ¥å£ å°†ä¸€ä¸ªTextViewå®ä¾‹ä½œä¸ºTextShapeçš„ç»„æˆéƒ¨åˆ†ï¼Œå¹¶ä¸”ä½¿ç”¨TextViewçš„æ¥å£å»å®ç°TextShapeæ¥å£ã€‚ ä»¥ä¸Šä¸¤ç§æ–¹æ³•æ°æ°å¯¹åº”äºAdapteræ¨¡å¼çš„ä¸¤ä¸ªç‰ˆæœ¬ï¼šç±»çš„é€‚é…å™¨æ¨¡å¼å’Œå¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ã€‚æˆ‘ä»¬å°†TextShapeç§°ä¹‹ä¸ºé€‚é…å™¨Adapterã€‚ ä»ä»¥ä¸Šæ¡ˆä¾‹å¯ä»¥çœ‹å‡ºï¼Œé€‚é…å™¨æ¨¡å¼å…¶å®æ˜¯ä¸€ç§è¡¥å¿å‹æ¨¡å¼ï¼Œåœ¨è¿›è¡Œå…¨æ–°ç³»ç»Ÿè®¾è®¡çš„æ—¶å€™å¾ˆå°‘ä¼šç”¨åˆ°ã€‚è€Œå½“ä½ é‡åˆ°ä»¥ä¸‹æƒ…å†µï¼Œä½ æˆ–è®¸å¯ä»¥è€ƒè™‘ä½¿ç”¨Adapteræ¨¡å¼ã€‚ ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»ï¼Œè€Œå®ƒçš„æ¥å£ä¸ç¬¦åˆä½ çš„éœ€æ±‚ã€‚ ä½ æƒ³åˆ›å»ºä¸€ä¸ªå¯ä»¥å¤ç”¨çš„ç±»ï¼Œè¯¥ç±»å¯ä»¥ä¸å…¶ä»–ä¸ç›¸å…³çš„ç±»æˆ–ä¸å¯é¢„è§çš„ç±»ï¼ˆå³é‚£äº›æ¥å£å¯èƒ½ä¸ä¸€å®šå…¼å®¹çš„ç±»ï¼‰ååŒå·¥ä½œã€‚ ï¼ˆä»…é€‚ç”¨äºå¯¹è±¡Adapterï¼‰ä½ æƒ³ä½¿ç”¨ä¸€äº›å·²ç»å­˜åœ¨çš„å­ç±»ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ¯ä¸€ä¸ªéƒ½è¿›è¡Œå­ç±»åŒ–ä»¥åŒ¹é…å®ƒä»¬çš„æ¥å£ã€‚ 3ã€é€‚é…å™¨æ¨¡å¼çš„ç»“æ„é€‚é…å™¨æ¨¡å¼åˆ†ä¸ºç±»çš„é€‚é…å™¨æ¨¡å¼(é‡‡ç”¨ç»§æ‰¿å®ç°)ã€å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼(é‡‡ç”¨å¯¹è±¡ç»„åˆæ–¹å¼å®ç°)å’Œæ¥å£çš„é€‚é…å™¨æ¨¡å¼ä¸‰ç§ã€‚ ç±»é€‚é…å™¨é€šè¿‡ç»§æ‰¿å¯¹ä¸€ä¸ªç±»ä¸å¦ä¸€ä¸ªæ¥å£è¿›è¡ŒåŒ¹é…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ç±»é€‚é…å™¨æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯(Client)ç±»ï¼šè¯¥ç±»éœ€è¦ä¸ç¬¦åˆæ¡ä»¶çš„ç‰¹å®šçš„æ¥å£ååŒå·¥ä½œã€‚ ç›®æ ‡(Target)æ¥å£ç±»ï¼šå®¢æˆ·ç«¯æ‰€éœ€è¦çš„æ¥å£ï¼Œåœ¨ç±»é€‚é…å™¨æ¨¡å¼ä¸‹è¯¥è§’è‰²åªèƒ½æ˜¯æ¥å£ã€‚ é€‚é…è€…(Adaptee)ç±»ï¼šéœ€è¦è¢«é€‚é…çš„ç±»ï¼Œé€‚é…è€…ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“ç±»ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯å¸Œæœ›ä½¿ç”¨çš„æŸäº›ä¸šåŠ¡æ–¹æ³•ã€‚ é€‚é…å™¨(Adapter)ç±»ï¼šè¯¥ç±»å¯¹é€‚é…è€…ç±»å’Œç›®æ ‡æ¥å£ç±»è¿›è¡Œé€‚é…ï¼Œåœ¨ç±»é€‚é…å™¨æ¨¡å¼ä¸‹é€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ï¼Œå³ï¼šAdapter ç»§æ‰¿ Adaptee å¹¶å®ç° Target æ¥å£ã€‚ ç±»é€‚é…å™¨æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šTargetç±»åŒ…å«Clientç±»æ‰€éœ€è¦çš„ä¸ç‰¹å®šé¢†åŸŸç›¸å…³çš„æ¥å£ã€‚ public interface Target { // Adapteeé€‚é…è€…æœ‰æ­¤æ–¹æ³•çš„å®ç°ï¼Œä½†æ–¹æ³•åå¯ä»¥ä¸åŒ void specificOperation(); // Adapteeé€‚é…è€…æ²¡æœ‰çš„å…¶ä»–æ–¹æ³• void otherOperation(); } Adapteeç±»åŒ…å«äº†å®¢æˆ·ç«¯å¸Œæœ›ä½¿ç”¨çš„æŸäº›ä¸šåŠ¡æ–¹æ³•ï¼Œä½†Adapteeç±»ä¸ç¬¦åˆClientç±»æ‰€éœ€æ¥å£çš„è¦æ±‚ã€‚ public class Adaptee { public void operation() { System.out.println(&quot;æ‰§è¡ŒAdapteeçš„operation()æ–¹æ³•...&quot;); } } Adapterç±»ç»§æ‰¿Adapteeå¹¶å®ç°Targetæ¥å£ï¼Œè¿™æ ·Adapterç±»æ—¢ç¬¦åˆClientç±»æ‰€éœ€æ¥å£çš„è¦æ±‚ï¼ŒåˆåŒ…å«äº†Clientç±»å¸Œæœ›ä½¿ç”¨çš„è€ŒåŸå±äºAdapteeç±»çš„ä¸šåŠ¡æ–¹æ³•ã€‚ public class Adapter extends Adaptee implements Target { @Override public void specificOperation() { this.operation(); } @Override public void otherOperation() { System.out.println(&quot;æ‰§è¡ŒAdapterçš„otherOperation()æ–¹æ³•...&quot;); } } ä¸ºç®€å•èµ·è§æˆ‘ä»¬ä¸ºClientç±»æ·»åŠ ä¸€ä¸ªclientOperation()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªTargetæ¥å£å¯¹è±¡ï¼Œåœ¨è¯¥Targetæ¥å£å¯¹è±¡ä¸­æˆ‘ä»¬è¦å¤ç”¨ç°æœ‰çš„Adapteeç±»çš„æ–¹æ³•ã€‚ public class Client { public static void clientOperation(Target target) { target.specificOperation(); target.otherOperation(); } public static void main(String[] args) { Adapter adapter = new Adapter(); clientOperation(adapter); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ‰§è¡ŒAdapteeçš„operation()æ–¹æ³•â€¦æ‰§è¡ŒAdapterçš„otherOperation()æ–¹æ³•â€¦ å¯¹è±¡é€‚é…å™¨é€šè¿‡ç»„åˆå¯¹ä¸€ä¸ªç±»åŠå…¶å­ç±»ä¸å¦ä¸€ä¸ªæ¥å£è¿›è¡ŒåŒ¹é…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ é€‚é…å™¨æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯(Client)ç±»ï¼šè¯¥ç±»éœ€è¦ä¸ç¬¦åˆæ¡ä»¶çš„ç‰¹å®šçš„æ¥å£ååŒå·¥ä½œã€‚ ç›®æ ‡(Target)æ¥å£ç±»ï¼šå®¢æˆ·ç«¯æ‰€éœ€è¦çš„æ¥å£ï¼Œåœ¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä¸‹è¯¥è§’è‰²å¯ä»¥æ˜¯æ¥å£ã€æŠ½è±¡ç±»æˆ–è€…éfinalçš„å…·ä½“ç±»ã€‚ é€‚é…è€…(Adaptee)ç±»ï¼šéœ€è¦è¢«é€‚é…çš„ç±»ï¼Œé€‚é…è€…ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“ç±»ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯å¸Œæœ›ä½¿ç”¨çš„æŸäº›ä¸šåŠ¡æ–¹æ³•ã€‚ é€‚é…å™¨(Adapter)ç±»ï¼šè¯¥ç±»å¯¹é€‚é…è€…ç±»å’Œç›®æ ‡æ¥å£ç±»è¿›è¡Œé€‚é…ï¼Œåœ¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä¸‹é€šè¿‡ç»„åˆæ–¹å¼å®ç°ï¼Œå³ï¼šAdapterç±»ç»§æ‰¿Targetç±»æˆ–è€…å®ç°Targetæ¥å£ï¼Œå¹¶åœ¨å…¶å†…éƒ¨åŒ…å«ä¸€ä¸ªAdapteeå¯¹è±¡çš„å¼•ç”¨ï¼Œé€šè¿‡å¯¹å…¶å†…éƒ¨çš„Adapteeå¯¹è±¡çš„è°ƒç”¨å®ç°å®¢æˆ·ç«¯æ‰€éœ€è¦çš„æ¥å£ã€‚ æ¥ä¸‹æ¥ä»¥Targetä¸ºæ¥å£ä¸¾ä¾‹ï¼Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šTargetç±»åŒ…å«Clientç±»æ‰€éœ€è¦çš„ä¸ç‰¹å®šé¢†åŸŸç›¸å…³çš„æ¥å£ã€‚ public interface Target { // Adapteeé€‚é…è€…æœ‰æ­¤æ–¹æ³•çš„å®ç°ï¼Œä½†æ–¹æ³•åå¯ä»¥ä¸åŒ void specificOperation(); // Adapteeé€‚é…è€…æ²¡æœ‰çš„å…¶ä»–æ–¹æ³• void otherOperation(); } Adaptee åŒ…å«äº† Client å¸Œæœ›ä½¿ç”¨çš„æŸäº›ä¸šåŠ¡æ–¹æ³•ï¼Œä½† Adaptee ä¸ç¬¦åˆ Client çš„æ¥å£è¦æ±‚ã€‚ public class Adaptee { public void operation() { System.out.println(&quot;æ‰§è¡ŒAdapteeçš„operation()æ–¹æ³•...&quot;); } } Adapter å®ç° Target æ¥å£ï¼Œå¹¶åœ¨å…¶å†…éƒ¨åŒ…å«ä¸€ä¸ª Adaptee å¯¹è±¡çš„å¼•ç”¨ï¼Œé€šè¿‡å¯¹å…¶å†…éƒ¨çš„ Adaptee å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ¥å®ç°å®¢æˆ·ç«¯æ‰€éœ€è¦çš„æ¥å£ã€‚ public class Adapter implements Target { private Adaptee adaptee; public Adapter(Adaptee adaptee) { super(); this.adaptee = adaptee; } @Override public void specificOperation() { this.adaptee.operation(); } @Override public void otherOperation() { System.out.println(&quot;æ‰§è¡ŒAdapterçš„otherOperation()æ–¹æ³•...&quot;); } } åŒæ ·çš„ï¼ŒClient ä¾æ—§è¦ä¸ä¸€ä¸ª Target æ¥å£ååŒå·¥ä½œï¼Œå¯¹Clientè¿›è¡Œç®€å•ä¿®æ”¹ã€‚ public class Client { public static void clientOperation(Target target){ target.specificOperation(); target.otherOperation(); } public static void main(String[] args) { Adapter adapter = new Adapter(new Adaptee()); clientOperation(adapter); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ‰§è¡ŒAdapteeçš„operation()æ–¹æ³•â€¦æ‰§è¡ŒAdapterçš„otherOperation()æ–¹æ³•â€¦ æ¥å£é€‚é…å™¨æ¨¡å¼åˆè¢«å«ä½œç¼ºçœé€‚é…å™¨(DefaultAdapter)æ¨¡å¼ï¼ŒDefaultAdapter ä¸ºä¸€ä¸ªæ¥å£æä¾›ç¼ºçœå®ç°ï¼Œè¿™æ ·éœ€å®ç°è¯¥æ¥å£çš„ç±»å°±å¯ä»¥ç›´æ¥ä» DefaultAdapter è¿›è¡Œæ‰©å±•ï¼Œè€Œä¸å¿…å†ä»åŸæœ‰æ¥å£è¿›è¡Œæ‰©å±•ã€‚å½“åŸæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•å¾ˆå¤šï¼Œè€Œå…¶ä¸­å¤§éƒ¨åˆ†æ–¹æ³•åˆä¸è¢«éœ€è¦æ—¶ï¼Œè¿™ç§æ¨¡å¼éå¸¸å®ç”¨ã€‚ç”±ç¼ºçœé€‚é…å™¨ç±»ï¼ˆç”±äºè¯¥ç±»ä¸€èˆ¬éƒ½åªä¸ºæ¥å£æä¾›ç¼ºçœçš„ç©ºå®ç°ï¼Œæ‰€ä»¥è¯¥ç±»ä¸€èˆ¬éƒ½è¢«å®šä¹‰ä¸ºæŠ½è±¡ç±»ï¼‰ç›´æ¥å®ç°æ¥å£ï¼Œå¹¶ä¸ºæ‰€æœ‰æ–¹æ³•æä¾›ç¼ºçœå®ç°ã€‚è¿™æ ·ï¼Œå¦‚æœæœ‰ç”¨æˆ·ç±»éœ€è¦å®ç°è¯¥æ¥å£å°±å¯ä»¥ç›´æ¥ç»§æ‰¿é€‚é…å™¨ç±»ï¼Œå¹¶åªéœ€å®ç°æ„Ÿå…´è¶£çš„æ–¹æ³•å°±å¯ä»¥äº†ã€‚ ç¼ºçœé€‚é…å™¨æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š ç›®æ ‡(Target)æ¥å£ç±»ï¼šç”¨æˆ·ç±»æ‰€éœ€è¦å®ç°çš„æ¥å£ï¼Œå®šä¹‰æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•ä¸ä¸€å®šå…¨éƒ½è¢«ç”¨æˆ·ç±»æ‰€éœ€è¦ã€‚ ç¼ºçœé€‚é…å™¨(DefaultAdapter)ç±»ï¼šå®ç°ç›®æ ‡æ¥å£ï¼Œå¹¶ä¸ºæ‰€æœ‰æ¥å£æ–¹æ³•æä¾›ç¼ºçœå®ç°ã€‚ å…·ä½“(ConcreteClass)ç”¨æˆ·ç±»ï¼šç”¨æˆ·ç±»è¦å®ç°æŸä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯åˆç”¨ä¸åˆ°æ¥å£æ‰€è§„å®šçš„æ‰€æœ‰çš„æ–¹æ³•ã€‚ ç±»é€‚é…å™¨æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼šTargetæ¥å£ç±»æ˜¯ç”¨æˆ·ç±»æ‰€éœ€è¦å®ç°çš„æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰æœ‰å¾ˆå¤šæ–¹æ³•ã€‚ public interface Target { public void operation1(); public void operation2(); public void operation3(); public void operation4(); public void operation5(); public void operation6(); } DefaultAdapterç±»å®ç°Targetæ¥å£ï¼Œå¹¶ä¸ºæ‰€æœ‰æ¥å£æ–¹æ³•æä¾›ç¼ºçœå®ç°ã€‚ public class DefaultAdapter implements Target { public void operation1() { System.out.println(&quot;æ‰§è¡Œç¼ºçœé€‚é…å™¨çš„operation1()æ–¹æ³•...&quot;); } public void operation2() { System.out.println(&quot;æ‰§è¡Œç¼ºçœé€‚é…å™¨çš„operation2()æ–¹æ³•...&quot;); } public void operation3() { System.out.println(&quot;æ‰§è¡Œç¼ºçœé€‚é…å™¨çš„operation3()æ–¹æ³•...&quot;); } public void operation4() { System.out.println(&quot;æ‰§è¡Œç¼ºçœé€‚é…å™¨çš„operation4()æ–¹æ³•...&quot;); } public void operation5() { System.out.println(&quot;æ‰§è¡Œç¼ºçœé€‚é…å™¨çš„operation5()æ–¹æ³•...&quot;); } public void operation6() { System.out.println(&quot;æ‰§è¡Œç¼ºçœé€‚é…å™¨çš„operation6()æ–¹æ³•...&quot;); } } æ¥ä¸‹æ¥å°±è¦å®šä¹‰ç”¨æˆ·ç±»äº†ï¼Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå…·ä½“ç”¨æˆ·ç±» ConcreteClassA å’Œ ConcreteClassB ï¼Œä¸¤ä¸ªç±»éƒ½åªå®ç° Target æ¥å£ä¸­çš„éƒ¨åˆ†æ–¹æ³•ã€‚ public class ConcreteClassA extends DefaultAdapter { public void operation3() { System.out.println(&quot;æ‰§è¡ŒConcreteClassAçš„operation3()æ–¹æ³•...&quot;); } } public class ConcreteClassB extends DefaultAdapter { public void operation4() { System.out.println(&quot;æ‰§è¡ŒConcreteClassBçš„operation4()æ–¹æ³•...&quot;); } public void operation5() { System.out.println(&quot;æ‰§è¡ŒConcreteClassBçš„operation5()æ–¹æ³•...&quot;); } } åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”¨æˆ·ç±»ä¼šéœ€è¦å®ç°æŸä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯åˆç”¨ä¸åˆ°æ¥å£æ‰€è§„å®šçš„æ‰€æœ‰çš„æ–¹æ³•ã€‚é€šå¸¸çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œç”¨æˆ·ç±»è¦å®ç°æ‰€æœ‰çš„æ–¹æ³•ï¼Œä¸ºé‚£äº›æœ‰ç”¨çš„æ–¹æ³•æ·»åŠ å®ç°ï¼Œä¸ºé‚£äº›æ²¡æœ‰ç”¨çš„æ–¹æ³•æ·»åŠ ç©ºçš„ã€å¹³åº¸çš„å®ç°ã€‚ä¸ºä¸éœ€è¦çš„æ–¹æ³•æ·»åŠ ç©ºå®ç°å…¶å®æ˜¯ä¸€ç§æµªè´¹ï¼Œæœ‰æ—¶ä¹Ÿæ˜¯ä¸€ç§æ··ä¹±ã€‚é™¤éçœ‹è¿‡è¿™äº›æ–¹æ³•çš„æºä»£ç æˆ–æ–‡æ¡£ï¼Œç¨‹åºå‘˜å¯èƒ½ä¼šä»¥ä¸ºè¿™äº›æ–¹æ³•ä¸æ˜¯ç©ºçš„ã€‚å³ä¾¿ä»–çŸ¥é“å…¶ä¸­æœ‰ä¸€äº›æ–¹æ³•æ˜¯ç©ºçš„ï¼Œä¹Ÿä¸ä¸€å®šçŸ¥é“å“ªäº›æ–¹æ³•æ˜¯ç©ºçš„ï¼Œå“ªäº›æ–¹æ³•ä¸æ˜¯ç©ºçš„ã€‚ç¼ºçœé€‚é…æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„å¤„ç†è¿™ä¸€æƒ…å†µã€‚ ä»ä»¥ä¸Šä¸¤ä¸ªå…·ä½“ç”¨æˆ·ç±» ConcreteClassA å’Œ ConcreteClassBçš„ä»£ç å¯ä»¥çœ‹å‡ºï¼šä¸¤ä¸ªç”¨æˆ·ç±»é€šè¿‡ç»§æ‰¿ç¼ºçœé€‚é…å™¨ç±»ï¼Œè€Œæ— éœ€å†ä¸ºæ¥å£ä¸­çš„å…¨éƒ¨æ–¹æ³•æ·»åŠ å®ç°ã€‚ 4ã€é€‚é…å™¨æ¨¡å¼åº”ç”¨ä¸¾ä¾‹åº”ç”¨åœºæ™¯ï¼šSDå†…å­˜å¡æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„æ‰‹æœºå¤–ç½®å­˜å‚¨è®¾å¤‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™æ‰‹æœºæ’å…¥ä¸€ä¸ªSDå¡æ¥æ‰©å±•æ‰‹æœºçš„å­˜å‚¨ç©ºé—´ï¼Œ å½“SDå¡ä¸­å­˜å‚¨çš„æ–‡ä»¶å¾ˆå¤šéœ€è¦æ•´ç†çš„æ—¶å€™é—®é¢˜æ¥äº†ï¼Œç›´æ¥åœ¨æ‰‹æœºä¸Šå¯¹SDå¡ä¸­çš„æ–‡ä»¶è¿›è¡Œæ•´ç†(æ‹·è´ã€åˆ é™¤ã€ç§»åŠ¨ã€ä¿®æ”¹ç­‰ç­‰)æ“ä½œèµ·æ¥å¾ˆä¸æ–¹ä¾¿ï¼Œäºæ˜¯æˆ‘ä»¬æƒ³å¦‚æœèƒ½å¤Ÿå°†SDå¡æ’å…¥ç”µè„‘ï¼Œç„¶åé€šè¿‡ç”µè„‘å¯¹SDå¡ä¸Šçš„æ–‡ä»¶è¿›è¡Œæ•´ç†è¯¥å¤šæ–¹ä¾¿ã€‚å¯ä¸å¹¸çš„æ˜¯ï¼Œå¤§å¤šæ•°çš„ç”µè„‘ä»…èƒ½è¿æ¥å…·æœ‰USBæ¥å£çš„è®¾å¤‡ï¼Œæ˜¾ç„¶ï¼ŒSDå¡å¹¶ä¸å…·å¤‡USBæ¥å£ã€‚ ä»¥ä¸Šæ˜¯é€‚é…å™¨æ¨¡å¼çš„ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼ŒSDå¡æ˜¯ä¸“é—¨ä¸ºæ‰‹æœºè€Œè®¾è®¡çš„ï¼Œåœ¨è®¾è®¡ä¹‹åˆä¹Ÿå¹¶æœªæƒ³è¿‡è¦å»æŠŠå®ƒæ’å…¥ç”µè„‘ã€‚ç°åœ¨æˆ‘ä»¬æƒ³è¦æŠŠSDå¡æ’å…¥åˆ°ç”µè„‘äº†ï¼Œå´å‘ç°SDå¡å› ä¸å…·æœ‰USBæ’å¤´è€Œä¸èƒ½æ’å…¥ç”µè„‘ã€‚æ­¤æ—¶ï¼Œå†å»é‡æ–°è®¾è®¡å’Œç”Ÿäº§ä¸€ç§æ–°å‹çš„å…·æœ‰USBæ¥å£çš„SDå¡æ˜¾ç„¶ä¹Ÿå¹¶ä¸åˆç†ã€‚ä½†æ˜¯ï¼Œå¾ˆæ˜æ˜¾SDå¡ä¸Uç›˜ç­‰USBæ¥å£è®¾å¤‡éƒ½æ˜¯å­˜å‚¨è®¾å¤‡ï¼ŒäºŒè€…å¹¶æ— æœ¬è´¨åŒºåˆ«ï¼Œç†è®ºä¸Šæ¥è¯´æ˜¯å®Œå…¨å¯ä»¥æ’å…¥ç”µè„‘çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ°åº•è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ ä»¥ä¸Šé—®é¢˜çš„è§£å†³æ–¹æ³•å…¶å®å¾ˆç®€å•ï¼šæ‰¾ä¸€ä¸ªUSBæ¥å£çš„è¯»å¡å™¨ï¼Œå°†SDå¡æ’å…¥åˆ°è¯»å¡å™¨ï¼Œå†å°†è¯»å¡å™¨æ’å…¥ç”µè„‘ï¼Œæ­¤æ—¶ä½ ä¼šå‘ç°SDå¡è¿ä¸Šç”µè„‘äº†ã€‚ ä¸Šä¾‹ä¸­çš„è¯»å¡å™¨å…¶å®å°±æ˜¯ä¸€ä¸ªé€‚é…SDå¡å’ŒUSBæ¥å£çš„é€‚é…å™¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨Javaä»£ç æ¥è¿›è¡Œæ¼”ç¤ºè¯´æ˜ã€‚ é¦–å…ˆï¼Œä¸ºäº†ä½¿æ¼”ç¤ºæ›´åŠ æ¸…æ™°ï¼Œæˆ‘ä»¬é‡æ–°å®šä¹‰ä¸€ä¸ªFileç±»ï¼Œç”¨æ¥è¡¨ç¤ºSDå¡ä¸­å­˜å‚¨çš„æ–‡ä»¶ã€‚ public class File { //æ–‡ä»¶å private String fileName; //æ–‡ä»¶å¤§å° private Double fileSize; //æ„é€ æ–¹æ³•ä¸­æŒ‡å®šæ–‡ä»¶åå’Œæ–‡ä»¶å¤§å° public File(String fileName, Double fileSize) { super(); this.fileName = fileName; this.fileSize = fileSize; } public String getFileName() { return fileName; } public Double getFileSize() { return fileSize; } } æˆ‘ä»¬çš„SDå¡ç±»æä¾›äº†åŸºæœ¬çš„æ–‡ä»¶æ·»åŠ ã€æ–‡ä»¶åˆ é™¤ã€æ˜¾ç¤ºå·²å­˜å‚¨æ–‡ä»¶çš„åŠŸèƒ½ï¼Œå…¶å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚ import java.util.HashMap; import java.util.Map; import java.util.Map.Entry; public class SDCard { // SDå¡çš„å­˜å‚¨ç©ºé—´æ€»å¤§å° private Double volume; // SDå¡çš„å¯ç”¨å­˜å‚¨ç©ºé—´å¤§å° private Double vacantVolume; // å°†SDå¡ä¸­å­˜å‚¨çš„æ–‡ä»¶ä¿å­˜åˆ°ä¸€ä¸ªMapé‡Œé¢ private Map&lt;String, File&gt; fileMap = new HashMap&lt;String, File&gt;(); public SDCard(Double volume) { super(); this.volume = volume; this.vacantVolume = volume; } public Double getVacantVolume() { return vacantVolume; } public void setVacantVolume(Double vacantVolume) { this.vacantVolume = vacantVolume; } public Double getVolume() { return volume; } public Map&lt;String, File&gt; getFileMap() { return fileMap; } public void addFile(File file) { File tempFile = this.fileMap.get(file.getFileName()); if (null != tempFile) { System.out.println(&quot;æ–‡ä»¶ã€Š&quot; + file.getFileName() + &quot;ã€‹å·²å­˜åœ¨ï¼Œæ·»åŠ å¤±è´¥...&quot;); } else { if (this.vacantVolume &gt; file.getFileSize()) { this.fileMap.put(file.getFileName(), file); this.vacantVolume = this.vacantVolume - file.getFileSize(); System.out.println(&quot;æ·»åŠ æ–‡ä»¶ã€Š&quot; + file.getFileName() + &quot;ã€‹æˆåŠŸ...&quot;); } else { System.out.println(&quot;å‰©ä½™å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œæ–‡ä»¶ã€Š&quot; + file.getFileName() + &quot;ã€‹æ·»åŠ å¤±è´¥...&quot;); } } } public void deleteFile(String fileName) { File tempFile = this.fileMap.get(fileName); if (null == tempFile) { System.out.println(&quot;æ–‡ä»¶ã€Š&quot; + fileName + &quot;ã€‹ä¸å­˜åœ¨ï¼Œåˆ é™¤å¤±è´¥...&quot;); } else { this.fileMap.remove(fileName); this.vacantVolume = this.vacantVolume + tempFile.getFileSize(); System.out.println(&quot;åˆ é™¤æ–‡ä»¶ã€Š&quot; + fileName + &quot;ã€‹æˆåŠŸ...&quot;); } } public void listFiles() { if (fileMap.size() &gt; 0) { System.out.println(); System.out .println(&quot;$$$$$$$$$$$$$$$$$$$$æ–‡ä»¶åˆ—è¡¨$$$$$$$$$$$$$$$$$$$$&quot;); int i = 1; for (Entry&lt;String, File&gt; entry : fileMap.entrySet()) { System.out.println(i + &quot;. æ–‡ä»¶åï¼šã€Š&quot; + entry.getValue().getFileName() + &quot;ã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š&quot; + entry.getValue().getFileSize() + &quot;å…†ã€‚&quot;); i++; } System.out.println(); } } } æ¥ä¸‹æ¥å®šä¹‰ä¸€ä¸ªUSBå­˜å‚¨è®¾å¤‡çš„æ¥å£ç±» USBDeviceï¼Œå…¶å£°æ˜çš„æ–¹æ³•å¦‚ä¸‹ã€‚ import java.util.List; public interface USBDevice { //è¿”å›USBå­˜å‚¨è®¾å¤‡çš„æ€»å®¹é‡ public Double getUSBVolume(); //è¿”å›USBå­˜å‚¨è®¾å¤‡çš„å‰©ä½™å¯ç”¨ç©ºé—´ public Double getUSBVacantVolume(); //åˆ—å‡ºUSBå­˜å‚¨è®¾å¤‡ä¸­çš„æ–‡ä»¶ä¿¡æ¯ public void listUSBFiles(); //æ·»åŠ æ–‡ä»¶åˆ°USBå­˜å‚¨è®¾å¤‡ public void addToUSB(File file); //ä»USBå­˜å‚¨è®¾å¤‡åˆ é™¤å•ä¸ªæ–‡ä»¶ public void deleteFromUSB(String fileName); //ä»USBå­˜å‚¨è®¾å¤‡æ‰¹é‡åˆ é™¤æ–‡ä»¶ public void deleteFromUSB(List&lt;String&gt; fileNames); } æ¥ä¸‹æ¥è¯¥å®šä¹‰æˆ‘ä»¬çš„é€‚é…å™¨ç±»äº†ï¼Œè¯¥ç±»åä¸º CardReader (è¯»å¡å™¨),å®ƒé€šè¿‡è°ƒç”¨SDå¡ç±»ä¸­çš„æ–¹æ³•å®ç°äº†åœ¨ USBDevice ä¸­å£°æ˜çš„æ¥å£æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ã€‚ import java.util.List; public class CardReader implements USBDevice{ private SDCard sdCard; public CardReader(SDCard sdCard) { super(); this.sdCard = sdCard; } @Override public Double getUSBVolume() { return this.sdCard.getVolume(); } @Override public Double getUSBVacantVolume() { return this.sdCard.getVacantVolume(); } @Override public void listUSBFiles() { this.sdCard.listFiles(); } @Override public void addToUSB(File file) { this.sdCard.addFile(file); } @Override public void deleteFromUSB(String fileName) { this.sdCard.deleteFile(fileName); } @Override public void deleteFromUSB(List&lt;String&gt; fileNames) { if(null!=fileNames &amp;&amp; fileNames.size()&gt;0){ for(String fileName:fileNames){ this.sdCard.deleteFile(fileName); } } } } æœ€åå®šä¹‰ç”µè„‘ Computer ç±»ï¼Œè¯¥ç±»ä»…æ”¯æŒæ’å…¥å…·æœ‰USBæ¥å£çš„è®¾å¤‡(å³å®ç°äº† USBDevice æ¥å£çš„å¯¹è±¡)ï¼Œæˆ‘ä»¬åœ¨æ­¤ä¸ºå…¶æ·»åŠ äº†ä¸€ä¸ª USBDevice çš„å†…éƒ¨å±æ€§ä»£è¡¨è¿æ¥åˆ°ç”µè„‘çš„USBè®¾å¤‡ï¼Œåœ¨ Computer ç±»ä¸­åˆ›å»ºä¸€ä¸ªMainæ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚ import java.util.ArrayList; public class Computer { private USBDevice usbDevice; private USBDevice getUsbDevice() { return usbDevice; } private void setUsbDevice(USBDevice usbDevice) { this.usbDevice = usbDevice; } public static void main(String[] args) { // æ–°å»ºä¸€ä¸ªå¤§å°ä¸º1024Mçš„SDå¡ SDCard sdCard = new SDCard(1024D); // åœ¨SDå¡ä¸­å­˜å…¥ä¸¤ä¸ªæ–‡ä»¶ sdCard.addFile(new File(&quot;Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdf&quot;, 10D)); sdCard.addFile(new File(&quot;ä¸è‰¯äººä¹‹çµä¸».avi&quot;, 68D)); // æ‹·å…¥é‡å¤æ–‡ä»¶æµ‹è¯• sdCard.addFile(new File(&quot;ä¸è‰¯äººä¹‹çµä¸».avi&quot;, 68D)); // åˆ—å‡ºSDå¡ä¸­æ–‡ä»¶ä¿¡æ¯ sdCard.listFiles(); // æ¥ä¸‹æ¥å°†SDå¡æ’å…¥åˆ°è¯»å¡å™¨ CardReader cardReader = new CardReader(sdCard); Computer computer = new Computer(); // å†å°†è¯»å¡å™¨æ’å…¥ç”µè„‘ computer.setUsbDevice(cardReader); computer.getUsbDevice().addToUSB(new File(&quot;å”ä¼¯è™ç‚¹ç§‹é¦™.rmvb&quot;, 600D)); computer.getUsbDevice().addToUSB(new File(&quot;C++åŸºç¡€ç®—æ³•.txt&quot;, 0.01D)); computer.getUsbDevice().addToUSB(new File(&quot;å†°æ²³ä¸–çºª4.rmvb&quot;, 888D)); computer.getUsbDevice().listUSBFiles(); computer.getUsbDevice().deleteFromUSB(&quot;Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdf&quot;); computer.getUsbDevice().listUSBFiles(); computer.getUsbDevice().deleteFromUSB(new ArrayList&lt;String&gt;() { { add(&quot;Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdf&quot;); add(&quot;ä¸è‰¯äººä¹‹çµä¸».avi&quot;); } }); computer.getUsbDevice().listUSBFiles(); } } è¿è¡Œç¨‹åºç»“æœæ‰“å°å¦‚ä¸‹ï¼š æ·»åŠ æ–‡ä»¶ã€ŠJavaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdfã€‹æˆåŠŸâ€¦æ·»åŠ æ–‡ä»¶ã€Šä¸è‰¯äººä¹‹çµä¸».aviã€‹æˆåŠŸâ€¦æ–‡ä»¶ã€Šä¸è‰¯äººä¹‹çµä¸».aviã€‹å·²å­˜åœ¨ï¼Œæ·»åŠ å¤±è´¥â€¦ $$$$$$$$$$$$$$$$$$$$æ–‡ä»¶åˆ—è¡¨$$$$$$$$$$$$$$$$$$$$ æ–‡ä»¶åï¼šã€ŠJavaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdfã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š10.0å…†ã€‚ æ–‡ä»¶åï¼šã€Šä¸è‰¯äººä¹‹çµä¸».aviã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š68.0å…†ã€‚ æ·»åŠ æ–‡ä»¶ã€Šå”ä¼¯è™ç‚¹ç§‹é¦™.rmvbã€‹æˆåŠŸâ€¦æ·»åŠ æ–‡ä»¶ã€ŠC++åŸºç¡€ç®—æ³•.txtã€‹æˆåŠŸâ€¦å‰©ä½™å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œæ–‡ä»¶ã€Šå†°æ²³ä¸–çºª4.rmvbã€‹æ·»åŠ å¤±è´¥â€¦ $$$$$$$$$$$$$$$$$$$$æ–‡ä»¶åˆ—è¡¨$$$$$$$$$$$$$$$$$$$$ æ–‡ä»¶åï¼šã€Šå”ä¼¯è™ç‚¹ç§‹é¦™.rmvbã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š600.0å…†ã€‚ æ–‡ä»¶åï¼šã€ŠJavaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdfã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š10.0å…†ã€‚ æ–‡ä»¶åï¼šã€ŠC++åŸºç¡€ç®—æ³•.txtã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š0.01å…†ã€‚ æ–‡ä»¶åï¼šã€Šä¸è‰¯äººä¹‹çµä¸».aviã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š68.0å…†ã€‚ åˆ é™¤æ–‡ä»¶ã€ŠJavaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdfã€‹æˆåŠŸâ€¦ $$$$$$$$$$$$$$$$$$$$æ–‡ä»¶åˆ—è¡¨$$$$$$$$$$$$$$$$$$$$ æ–‡ä»¶åï¼šã€Šå”ä¼¯è™ç‚¹ç§‹é¦™.rmvbã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š600.0å…†ã€‚ æ–‡ä»¶åï¼šã€ŠC++åŸºç¡€ç®—æ³•.txtã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š0.01å…†ã€‚ æ–‡ä»¶åï¼šã€Šä¸è‰¯äººä¹‹çµä¸».aviã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š68.0å…†ã€‚ æ–‡ä»¶ã€ŠJavaä»å…¥é—¨åˆ°æ”¾å¼ƒ.pdfã€‹ä¸å­˜åœ¨ï¼Œåˆ é™¤å¤±è´¥â€¦åˆ é™¤æ–‡ä»¶ã€Šä¸è‰¯äººä¹‹çµä¸».aviã€‹æˆåŠŸâ€¦ $$$$$$$$$$$$$$$$$$$$æ–‡ä»¶åˆ—è¡¨$$$$$$$$$$$$$$$$$$$$ æ–‡ä»¶åï¼šã€Šå”ä¼¯è™ç‚¹ç§‹é¦™.rmvbã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š600.0å…†ã€‚ æ–‡ä»¶åï¼šã€ŠC++åŸºç¡€ç®—æ³•.txtã€‹ï¼Œæ–‡ä»¶å¤§å°ï¼š0.01å…†ã€‚ 5ã€é€‚é…å™¨æ¨¡å¼çš„é€‰æ‹©é€šè¿‡ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è¾¾åˆ°ä»¥ä¸‹ç›®çš„ï¼š å¤ç”¨ç°æœ‰çš„ç±»ï¼Œè§£å†³ç°æœ‰ç±»å’Œå¤ç”¨ç¯å¢ƒè¦æ±‚ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ å°†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»è§£è€¦ï¼Œé€šè¿‡å¼•å…¥ä¸€ä¸ªé€‚é…å™¨ç±»é‡ç”¨ç°æœ‰çš„é€‚é…è€…ç±»ï¼Œè€Œæ— éœ€ä¿®æ”¹åŸæœ‰ä»£ç ã€‚ ä¸€ä¸ªå¯¹è±¡é€‚é…å™¨å¯ä»¥æŠŠé€‚é…è€…ç±»å’Œå®ƒçš„å­ç±»éƒ½é€‚é…åˆ°ç›®æ ‡æ¥å£ã€‚ ç±»é€‚é…å™¨æ¨¡å¼å’Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼æ¯”è¾ƒï¼š ç±»é€‚é…å™¨é€šè¿‡ç»§æ‰¿æ–¹å¼æ¥å®ç°ï¼Œæ˜¯é™æ€çš„ï¼›è€Œå¯¹è±¡é€‚é…å™¨é€šè¿‡ç»„åˆæ–¹å¼æ¥å®ç°ï¼Œæ˜¯åŠ¨æ€çš„ã€‚ å¯¹äºç±»é€‚é…å™¨ï¼Œé€‚é…å™¨ç›´æ¥ç»§æ‰¿è‡ª Adaptee ï¼Œè¿™ä½¿å¾—é€‚é…å™¨ä¸èƒ½å’Œ Adaptee çš„å­ç±»ä¸€èµ·å·¥ä½œã€‚ å¯¹äºå¯¹è±¡é€‚é…å™¨ï¼ŒåŒä¸€ä¸ªé€‚é…å™¨å¯ä»¥æŠŠ Adaptee å’Œå®ƒçš„å­ç±»éƒ½é€‚é…åˆ°ç›®æ ‡æ¥å£ã€‚ å¯¹äºç±»é€‚é…å™¨ï¼Œé€‚é…å™¨å¯ä»¥é‡å®šä¹‰ Adaptee çš„éƒ¨åˆ†è¡Œä¸ºï¼Œç›¸å½“äºå­ç±»è¦†ç›–çˆ¶ç±»çš„éƒ¨åˆ†å®ç°æ–¹æ³•ã€‚ å¯¹äºå¯¹è±¡é€‚é…å™¨ï¼Œè¦é‡å®šä¹‰ Adaptee çš„è¡Œä¸ºæ¯”è¾ƒå›°éš¾ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦å®šä¹‰ Adaptee çš„å­ç±»æ¥å®ç°é‡å®šä¹‰ï¼Œç„¶åè®©é€‚é…å™¨ç»„åˆå­ç±»ã€‚ å‚è€ƒæ–‡ç« &lt; GoFç»å…¸çš„è‘—ä½œã€Š Design Patterns: Elements of Reusable Object-Oriented Software ã€‹ï¼ˆã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ï¼‰&gt; https://www.ibm.com/developerworks/cn/java/j-lo-adapter-pattern/index.html https://blog.csdn.net/name_110/article/details/6903819 https://www.cnblogs.com/xwdreamer/archive/2012/03/29/2424008.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"é€‚é…å™¨æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"é€‚é…å™¨æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/é€‚é…å™¨æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸‹ï¼‰","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸‹ï¼‰","date":"2020-05-24T08:47:47.000Z","updated":"2023-04-30T10:21:41.355Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸‹ï¼‰/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸‹ï¼‰/","excerpt":"","text":"ä¸€ã€å‰ç« å›é¡¾åœ¨å‰ä¸€ç« åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸Šï¼‰ä¸­æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨JDKè‡ªå¸¦çš„åŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ä¸ºæ•°æ®åº“å¢åŠ äº†æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ç„¶è€Œï¼Œç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆæ ·å­å‘¢ï¼Ÿæœ¬ç« æˆ‘ä»¬å°±ä¸€èµ·æ¥æ­å¼€å®ƒçš„åºå±±çœŸé¢ç›®ã€‚ äºŒã€æ·±å…¥å‰–æJAVAåŠ¨æ€ä»£ç†ç±»æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå¯¹å‰ä¸€ç« ç¬¬äºŒèŠ‚ä¸­ç¤ºä¾‹çš„å®¢æˆ·ç«¯è¿›è¡Œå¦‚ä¸‹ç®€å•ä¿®æ”¹ï¼Œå°†ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»å®ä¾‹çš„ç±»å‹æ‰“å°åˆ°æ§åˆ¶å°ã€‚ import java.lang.reflect.Proxy; public class MainClass { public static void main(String[] args) { // åˆ›å»ºç”¨æ¥å¤„ç†ä»£ç†å¯¹è±¡è¯·æ±‚çš„è°ƒç”¨å¤„ç†ç¨‹åºuserHandler UserDao userDao = new ImpUserDao(); DataBaseLogHandler userHandler = new DataBaseLogHandler(userDao); // åˆ›å»ºç”¨æ¥å¤„ç†ä»£ç†å¯¹è±¡è¯·æ±‚çš„è°ƒç”¨å¤„ç†ç¨‹åºdocumentHandler DocumentDao doucumentDao = new ImpDocumentDao(); DataBaseLogHandler documentHandler = new DataBaseLogHandler(doucumentDao); // å¼€å§‹åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œåˆ†åˆ«å®ç°æ¥å£UserDaoå’ŒDocumentDao UserDao userProxy = (UserDao) Proxy.newProxyInstance(UserDao.class.getClassLoader(), new Class[] { UserDao.class }, userHandler); DocumentDao documentProxy = (DocumentDao) Proxy.newProxyInstance(DocumentDao.class.getClassLoader(), new Class[] { DocumentDao.class }, documentHandler); // å°†ä¸¤ä¸ªä»£ç†ç±»çš„ç±»å‹æ‰“å°åˆ°æ§åˆ¶å° System.out.println(&quot;å®ç°äº†UserDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼š&quot; + userProxy.getClass()); System.out.println(&quot;å®ç°äº†DocumentDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼š&quot; + documentProxy.getClass()); // æ¥ä¸‹æ¥æˆ‘ä»¬å†åˆ›å»ºä¸¤ä¸ªåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ï¼ŒäºŒè€…éƒ½å®ç°UserDaoå’ŒDocumentDaoä¸¤ä¸ªæ¥å£ï¼Œåªæ˜¯æ¥å£å®ç°çš„å…ˆåé¡ºåºä¸åŒ UserDao udProxy = (UserDao) Proxy.newProxyInstance(UserDao.class.getClassLoader(), new Class[] { UserDao.class, DocumentDao.class }, userHandler); DocumentDao duProxy = (DocumentDao) Proxy.newProxyInstance(DocumentDao.class.getClassLoader(), new Class[] { DocumentDao.class, UserDao.class }, documentHandler); // å°†è¿™ä¸¤ä¸ªä»£ç†ç±»çš„ç±»å‹ä¹Ÿæ‰“å°åˆ°æ§åˆ¶å° System.out.println(&quot;å®ç°äº†UserDaoå’ŒDocumentDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼š&quot; + udProxy.getClass()); System.out.println(&quot;å®ç°äº†DocumentDaoå’ŒUserDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼š&quot; + duProxy.getClass()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼šå®ç°äº†UserDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy0å®ç°äº†DocumentDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy1å®ç°äº†UserDaoå’ŒDocumentDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy2å®ç°äº†DocumentDaoå’ŒUserDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy3 åŸæ¥ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»éƒ½æ˜¯å½¢ä¼¼ $Proxy0ã€$Proxy1ã€$Proxy2ã€$Proxy3 è¿™ç§ç±»å‹ï¼ŒåŒæ—¶ï¼Œè²Œä¼¼ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»çš„ç±»å‹ä¸ä¼ å…¥æ–¹æ³•newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) ä¸­çš„interfacesæ¥å£æ•°ç»„å‚æ•°æœ‰å…³ï¼Œè€Œä¸”æ¥å£æ•°ç»„ä¸­æ¥å£çš„å…ˆåé¡ºåºä¹Ÿä¼šå¯¹æœ€åç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»çš„ç±»å‹äº§ç”Ÿå½±å“ï¼ˆè¿™ä¸€ç‚¹è²Œä¼¼sunåšå¾—ä¸æ˜¯å¾ˆå¥½ï¼‰ã€‚ çŸ¥æ™“äº†è¿™ä¸€ç‚¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†åˆ¨æ·±ç‚¹ï¼Œçœ‹çœ‹è¿™äº›ä»£ç†ç±»åˆ°åº•é•¿ä»€ä¹ˆæ ·å­ï¼Œå¯¹MainClasså†è¿›è¡Œä¿®æ”¹ã€‚ import java.lang.reflect.Field; import java.lang.reflect.Method; import java.lang.reflect.Modifier; import java.lang.reflect.Proxy; public class MainClass { public static void main(String[] args) { UserDao userDao = new ImpUserDao(); DataBaseLogHandler userHandler = new DataBaseLogHandler(userDao); UserDao userProxy = (UserDao) Proxy.newProxyInstance(UserDao.class.getClassLoader(), new Class[] { UserDao.class }, userHandler); System.out.println(&quot;å®ç°äº†UserDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»çš„ç±»å‹ä¸ºï¼š&quot; + userProxy.getClass()); // æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨åˆ›å»ºä¸¤ä¸ªåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ï¼ŒäºŒè€…éƒ½å®ç°UserDaoå’ŒDocumentDaoä¸¤ä¸ªæ¥å£ï¼Œåªæ˜¯æ¥å£å®ç°çš„å…ˆåé¡ºåºä¸åŒ UserDao udProxy = (UserDao) Proxy.newProxyInstance(UserDao.class.getClassLoader(), new Class[] { UserDao.class, DocumentDao.class }, userHandler); System.out.println(&quot;å®ç°äº†UserDaoå’ŒDocumentDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»çš„ç±»å‹ä¸ºï¼š&quot; + udProxy.getClass()); System.out.println(&quot;&quot;); Class userProxyClass = userProxy.getClass(); Class udProxyClass = udProxy.getClass(); printClassDefinition(userProxyClass); printClassDefinition(udProxyClass); } public static String getModifier(int modifier) { String result = &quot;&quot;; switch (modifier) { case Modifier.PRIVATE: result = &quot;private&quot;; case Modifier.PUBLIC: result = &quot;public&quot;; case Modifier.PROTECTED: result = &quot;protected&quot;; case Modifier.ABSTRACT: result = &quot;abstract&quot;; case Modifier.FINAL: result = &quot;final&quot;; case Modifier.NATIVE: result = &quot;native&quot;; case Modifier.STATIC: result = &quot;static&quot;; case Modifier.SYNCHRONIZED: result = &quot;synchronized&quot;; case Modifier.STRICT: result = &quot;strict&quot;; case Modifier.TRANSIENT: result = &quot;transient&quot;; case Modifier.VOLATILE: result = &quot;volatile&quot;; case Modifier.INTERFACE: result = &quot;interface&quot;; } return result; } public static void printClassDefinition(Class clz) { String clzModifier = getModifier(clz.getModifiers()); if (clzModifier != null &amp;&amp; !clzModifier.equals(&quot;&quot;)) { clzModifier = clzModifier + &quot; &quot;; } String superClz = clz.getSuperclass().getName(); if (superClz != null &amp;&amp; !superClz.equals(&quot;&quot;)) { superClz = &quot;extends &quot; + superClz; } Class[] interfaces = clz.getInterfaces(); String inters = &quot;&quot;; for (int i = 0; i &lt; interfaces.length; i++) { if (i == 0) { inters += &quot;implements &quot; + interfaces[i].getName(); } else { inters += &quot;,&quot; + interfaces[i].getName(); } } System.out.println(clzModifier + clz.getName() + &quot; &quot; + superClz + &quot; &quot; + inters); System.out.println(&quot;{&quot;); Field[] fields = clz.getDeclaredFields(); for (int i = 0; i &lt; fields.length; i++) { String modifier = getModifier(fields[i].getModifiers()); if (modifier != null &amp;&amp; !modifier.equals(&quot;&quot;)) { modifier = modifier + &quot; &quot;; } String fieldName = fields[i].getName(); String fieldType = fields[i].getType().getName(); System.out.println(&quot; &quot; + modifier + fieldType + &quot; &quot; + fieldName + &quot;;&quot;); } System.out.println(); Method[] methods = clz.getDeclaredMethods(); for (int i = 0; i &lt; methods.length; i++) { Method method = methods[i]; String modifier = getModifier(method.getModifiers()); if (modifier != null &amp;&amp; !modifier.equals(&quot;&quot;)) { modifier = modifier + &quot; &quot;; } String methodName = method.getName(); Class returnClz = method.getReturnType(); String retrunType = returnClz.getName(); Class[] clzs = method.getParameterTypes(); String paraList = &quot;(&quot;; for (int j = 0; j &lt; clzs.length; j++) { paraList += clzs[j].getName(); if (j != clzs.length - 1) { paraList += &quot;, &quot;; } } paraList += &quot;)&quot;; clzs = method.getExceptionTypes(); String exceptions = &quot;&quot;; for (int j = 0; j &lt; clzs.length; j++) { if (j == 0) { exceptions += &quot;throws &quot;; } exceptions += clzs[j].getName(); if (j != clzs.length - 1) { exceptions += &quot;, &quot;; } } exceptions += &quot;;&quot;; String methodPrototype = modifier + retrunType + &quot; &quot; + methodName + paraList + exceptions; System.out.println(&quot; &quot; + methodPrototype); } System.out.println(&quot;}&quot;); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼šå®ç°äº†UserDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy0å®ç°äº†UserDaoå’ŒDocumentDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy1å®ç°äº†UserDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy0å®ç°äº†UserDaoå’ŒDocumentDaoæ¥å£çš„åŠ¨æ€ä»£ç†ç±»å‹ä¸ºï¼šclass $Proxy1 $Proxy0 extends java.lang.reflect.Proxy implements UserDao { java.lang.reflect.Method m1; java.lang.reflect.Method m3; java.lang.reflect.Method m4; java.lang.reflect.Method m0; java.lang.reflect.Method m2; java.lang.String login(java.lang.Long, java.lang.String); java.lang.String logout(); boolean equals(java.lang.Object); java.lang.String toString(); int hashCode(); } $Proxy1 extends java.lang.reflect.Proxy implements UserDaoï¼ŒDocumentDao { java.lang.reflect.Method m1; java.lang.reflect.Method m6; java.lang.reflect.Method m3; java.lang.reflect.Method m5; java.lang.reflect.Method m4; java.lang.reflect.Method m0; java.lang.reflect.Method m2; java.lang.String login(java.lang.Long, java.lang.String); java.lang.String logout(); java.lang.String add(Document); boolean equals(java.lang.Object); java.lang.String toString(); int hashCode(); java.lang.String delete(Document); } è¿™ä¸‹å­ä¼¼ä¹æ˜¯æ¸…æ™°äº†ä¸€ç‚¹ï¼Œç”Ÿæˆçš„ä»£ç†ç±»ç»§æ‰¿äº†java.lang.reflect.Proxyç±»ï¼Œå¹¶å®ç°äº†ä½œä¸ºå‚æ•°ä¼ å…¥newProxyInstance()æ–¹æ³•ä¸­çš„ Class&lt;?&gt;[] interfaces æ¥å£æ•°ç»„ï¼Œä½†ç”±äºJavaçš„åå°„æœºåˆ¶å¹¶ä¸èƒ½è·å–åˆ°æ–¹æ³•ä½“çš„å…·ä½“å†…å®¹ï¼Œæ‰€ä»¥åŠ¨æ€ä»£ç†ç±»æ–¹æ³•ä½“çš„å…·ä½“å†…å®¹æˆ‘ä»¬è¿˜ä¸å¾—è€ŒçŸ¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å¦è¾Ÿè¹Šå¾„ï¼šä½¿ç”¨classå­—èŠ‚ç æ–‡ä»¶åç¼–è¯‘æ–¹æ³•ï¼Œä»¥æœŸå¾…èƒ½å¤Ÿçœ‹åˆ°åŠ¨æ€ä»£ç†ç±»ä¸­æ–¹æ³•ä½“çš„å…·ä½“å†…å®¹ã€‚ ç”±äº Proxy.newProxyInstance()æ–¹æ³•åœ¨ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å­—èŠ‚ç æ–‡ä»¶çš„æ—¶å€™ä¼šè°ƒç”¨åˆ° sun.misc.ProxyGenerator.generateProxyClass()æ–¹æ³•ï¼Œåœ¨ Proxy.newProxyInstance()æ–¹æ³•è°ƒç”¨ä¹‹å‰å¯ä»¥è¿›è¡Œè®¾ç½®,å°†generateProxyClass()ç”Ÿæˆçš„ä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ä»¥ .class æ–‡ä»¶çš„å½¢å¼å¤‡ä»½åˆ°å½“å‰Javaé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹,é…ç½®ä»£ç å¦‚ä¸‹ï¼š System.getProperties().put(â€œsun.misc.ProxyGenerator.saveGeneratedFilesâ€, â€œtrueâ€);ä½¿ç”¨è½¯ä»¶å¯¹ä¸Šä¾‹ä¸­å®ç°äº†UserDaoæ¥å£çš„ä»£ç†ç±» $Proxy0 çš„å­—èŠ‚ç æ–‡ä»¶è¿›è¡Œåç¼–è¯‘ï¼Œå…¶å®Œæ•´å†…å®¹å¦‚ä¸‹ã€‚ import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.lang.reflect.UndeclaredThrowableException; public final class $Proxy0 extends Proxy implements UserDao { private static Method m1; private static Method m3; private static Method m4; private static Method m0; private static Method m2; public $Proxy0(InvocationHandler invocationHandler) throws { super(invocationHandler); } public final boolean equals(Object object) throws { try { return (Boolean)this.h.invoke(this, m1, new Object[]{object}); } catch (Error | RuntimeException v0) { throw v0; } catch (Throwable var2_2) { throw new UndeclaredThrowableException(var2_2); } } public final String login(Long l) throws { try { return (String)this.h.invoke(this, m3, new Object[]{l}); } catch (Error | RuntimeException v0) { throw v0; } catch (Throwable var2_2) { throw new UndeclaredThrowableException(var2_2); } } public final String logout() throws { try { return (String)this.h.invoke(this, m4, null); } catch (Error | RuntimeException v0) { throw v0; } catch (Throwable var1_1) { throw new UndeclaredThrowableException(var1_1); } } public final int hashCode() throws { try { return (Integer)this.h.invoke(this, m0, null); } catch (Error | RuntimeException v0) { throw v0; } catch (Throwable var1_1) { throw new UndeclaredThrowableException(var1_1); } } public final String toString() throws { try { return (String)this.h.invoke(this, m2, null); } catch (Error | RuntimeException v0) { throw v0; } catch (Throwable var1_1) { throw new UndeclaredThrowableException(var1_1); } } static { try { m1 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;equals&quot;, Class.forName(&quot;java.lang.Object&quot;)); m3 = Class.forName(&quot;UserDao&quot;).getMethod(&quot;login&quot;, Class.forName(&quot;java.lang.Long&quot;)); m4 = Class.forName(&quot;UserDao&quot;).getMethod(&quot;logout&quot;, new Class[0]); m0 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;hashCode&quot;, new Class[0]); m2 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;toString&quot;, new Class[0]); return; } catch (NoSuchMethodException var1) { throw new NoSuchMethodError(var1.getMessage()); } catch (ClassNotFoundException var1_1) { throw new NoClassDefFoundError(var1_1.getMessage()); } } } é€šè¿‡å¯¹ä»¥ä¸ŠåŠ¨æ€ä»£ç†ç±»å­—èŠ‚ç æ–‡ä»¶åç¼–è¯‘çš„å†…å®¹çš„è§‚å¯Ÿï¼Œæˆ‘ä»¬ä¸éš¾å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼šæ‰€è°“åŠ¨æ€ä»£ç†ï¼Œå…¶å®å°±æ˜¯java.lang.reflect.Proxyç±»åŠ¨æ€åœ°æ ¹æ®ä½ æ‰€æŒ‡å®šçš„æ¥å£ç”Ÿæˆä¸€ä¸ªclass å­—èŠ‚ç æ–‡ä»¶ï¼Œè¯¥ class ä¼šç»§æ‰¿ Proxy ç±»ï¼Œå¹¶å®ç°æ‰€æœ‰ä½ æŒ‡å®šçš„æ¥å£ï¼ˆæ‚¨åœ¨newProxyInstance()æ–¹æ³•çš„å‚æ•°ä¸­ä¼ å…¥çš„ Class&lt;?&gt;[] interfaces æ¥å£æ•°ç»„ï¼‰ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒæ—¶ï¼Œè¿˜ä¼šä»java.lang.Objectç»§æ‰¿equals()ã€toString()ã€hashCode()ä¸‰ä¸ªæ–¹æ³•ï¼›ç„¶åå†åˆ©ç”¨ä½ æŒ‡å®šçš„ç±»åŠ è½½å™¨ï¼ˆæ‚¨åœ¨newProxyInstance()æ–¹æ³•çš„å‚æ•°ä¸­ä¼ å…¥çš„ ClassLoader loaderï¼‰å°† class å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›ç³»ç»Ÿï¼Œæœ€åç”Ÿæˆè¿™æ ·ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–è¯¥å¯¹è±¡çš„ä¸€äº›å€¼ã€ä»¥åŠæ‰€æœ‰çš„ Method æˆå‘˜ï¼Œ åˆå§‹åŒ–ä¹‹åå°†å¯¹è±¡è¿”å›ç»™è°ƒç”¨çš„å®¢æˆ·ç«¯ï¼Œè¿™æ ·å®¢æˆ·ç«¯æ‹¿åˆ°çš„å°±æ˜¯ä¸€ä¸ªå®ç°ä½ æŒ‡å®šçš„æ‰€æœ‰æ¥å£çš„Proxyå¯¹è±¡äº†ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯åœ¨è°ƒç”¨è¯¥åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ä¼šé€šè¿‡åŠ¨æ€ä»£ç†ç±»ä¸­çš„ this.h.invoke()æ–¹æ³•è‡ªåŠ¨å°†è¯·æ±‚è½¬å‘ç»™ä¸åŠ¨æ€ä»£ç†å¯¹è±¡å…³è”çš„InvocationHandlerå¯¹è±¡(æ‚¨åœ¨newProxyInstance()æ–¹æ³•çš„å‚æ•°ä¸­ä¼ å…¥çš„ InvocationHandler h)çš„invoke()æ–¹æ³•ï¼Œç”±invoke()æ–¹æ³•æ¥å®ç°å¯¹è¯·æ±‚çš„ç»Ÿä¸€å¤„ç†å¹¶è¿”å›å¤„ç†ç»“æœã€‚ å‚è€ƒæ–‡ç« https://www.cnblogs.com/xiaoluo501395377/p/3383130.html https://www.ibm.com/developerworks/cn/java/j-lo-proxy-pattern/ http://www.lxway.com/4445954962.htm https://blog.csdn.net/lovelion/article/details/8116704 https://blog.csdn.net/hejingyuan6/article/details/36203505 https://blog.csdn.net/rokii/article/details/4046098","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"ä»£ç†æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼,åŠ¨æ€","slug":"ä»£ç†æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼-åŠ¨æ€","permalink":"/tags/ä»£ç†æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼-åŠ¨æ€/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸Šï¼‰","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸Šï¼‰","date":"2020-05-24T08:46:29.000Z","updated":"2023-04-30T10:21:41.355Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸Šï¼‰/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--åŠ¨æ€ä»£ç†æ¨¡å¼ï¼ˆä¸Šï¼‰/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†åœ¨é™æ€ä»£ç†(Static Proxy)æ¨¡å¼ä¸­ï¼Œä»£ç†ç±»éƒ½æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œç”±ç¨‹åºå‘˜æå‰åˆ›å»ºå¥½çš„javaç±»ï¼Œæ˜¯é™æ€çš„ï¼Œæ¯ä¸€ä¸ªä»£ç†ç±»åœ¨ç¼–è¯‘ä¹‹åéƒ½ä¼šç”Ÿæˆä¸€ä¸ª.classå­—èŠ‚ç æ–‡ä»¶ï¼Œé™æ€ä»£ç†ç±»æ‰€å®ç°çš„æ¥å£å’Œæ‰€ä»£ç†çš„æ–¹æ³•æ—©åœ¨ç¼–è¯‘æœŸéƒ½å·²è¢«å›ºå®šäº†ã€‚ åŠ¨æ€ä»£ç†(Dynamic Proxy)åˆ™ä¸åŒï¼šåŠ¨æ€ä»£ç†ä½¿ç”¨å­—èŠ‚ç åŠ¨æ€ç”Ÿæˆå’ŒåŠ è½½æŠ€æœ¯ï¼Œåœ¨ç³»ç»Ÿè¿è¡Œæ—¶åŠ¨æ€åœ°ç”Ÿæˆå’ŒåŠ è½½ä»£ç†ç±»ã€‚ ä¸é™æ€ä»£ç†ç›¸æ¯”ï¼ŒåŠ¨æ€ä»£ç†æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š é¦–å…ˆï¼Œæ— éœ€å†ä¸ºæ¯ä¸€ä¸ªçœŸå®ä¸»é¢˜å†™ä¸€ä¸ªå½¢å¼ä¸Šå®Œå…¨ä¸€æ ·çš„ä»£ç†ç±»ï¼Œå‡å¦‚æŠ½è±¡ä¸»é¢˜æ¥å£ä¸­çš„æ–¹æ³•å¾ˆå¤šçš„è¯ï¼Œä¸ºæ¯ä¸€ä¸ªæ¥å£æ–¹æ³•å†™ä¸€ä¸ªä»£ç†æ–¹æ³•ä¹Ÿå¾ˆéº»çƒ¦ï¼ŒåŒæ ·åœ°ï¼Œå¦‚æœåæœŸæŠ½è±¡ä¸»é¢˜æ¥å£å‘ç”Ÿå˜åŠ¨ï¼Œåˆ™çœŸå®ä¸»é¢˜å’Œä»£ç†ç±»éƒ½è¦ä¿®æ”¹ï¼Œä¸åˆ©äºç³»ç»Ÿç»´æŠ¤ï¼› å…¶æ¬¡ï¼ŒåŠ¨æ€ä»£ç†å¯ä»¥è®©ç³»ç»Ÿæ ¹æ®å®é™…éœ€è¦æ¥åŠ¨æ€åˆ›å»ºä»£ç†ç±»ï¼ŒåŒä¸€ä¸ªä»£ç†ç±»èƒ½å¤Ÿä»£ç†å¤šä¸ªä¸åŒçš„çœŸå®ä¸»é¢˜ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä»£ç†å¤šä¸ªä¸åŒçš„æ–¹æ³•ã€‚ äºŒã€Javaå¯¹åŠ¨æ€ä»£ç†çš„æ”¯æŒä»JDK 1.3ç‰ˆæœ¬å¼€å§‹ï¼ŒJavaè¯­è¨€æä¾›äº†å¯¹åŠ¨æ€ä»£ç†çš„æ”¯æŒï¼Œåœ¨Javaä¸­å®ç°åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œéœ€è¦ç”¨åˆ° java.lang.reflect åŒ…ä¸­çš„ InvocationHandler æ¥å£å’Œ Proxy ç±»,æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹javaçš„APIå¸®åŠ©æ–‡æ¡£æ˜¯æ€ä¹ˆæ ·å¯¹è¿™ä¸¤ä¸ªç±»è¿›è¡Œæè¿°çš„ï¼š InvocationHandlerInvocationHandler is the interface implemented by the invocation handler of a proxy instance. Each proxy instance has an associated invocation handler. When a method is invoked on a proxy instance, the method invocation is encoded and dispatched to the invoke method of its invocation handler. å¤§è‡´çš„æ„æ€æ˜¯ï¼š InvocationHandler æ˜¯ä»£ç†å®ä¾‹çš„è°ƒç”¨å¤„ç†ç¨‹åºå®ç°çš„æ¥å£ã€‚ æ¯ä¸ªä»£ç†å®ä¾‹éƒ½å…·æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚å¯¹ä»£ç†å®ä¾‹è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå°†å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œç¼–ç å¹¶å°†å…¶æŒ‡æ´¾åˆ°å®ƒçš„è°ƒç”¨å¤„ç†ç¨‹ åºçš„ invoke() æ–¹æ³•ã€‚ invoke() æ–¹æ³•å½¢å¼å¦‚ä¸‹ï¼š Object invoke(Object proxy,Method method,Object[] args) throws Throwable InvocationHandler æ¥å£åªåŒ…å«invoke()è¿™å”¯ä¸€ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºå¤„ç†å¯¹ä»£ç†ç±»å®ä¾‹çš„æ–¹æ³•è°ƒç”¨å¹¶è¿”å›ç›¸åº”çš„ç»“æœï¼Œå½“ä¸€ä¸ªä»£ç†å®ä¾‹ä¸­çš„ä¸šåŠ¡æ–¹æ³•è¢«è°ƒç”¨æ—¶å°†è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚invoke()æ–¹æ³•åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°proxyè¡¨ç¤ºä»£ç†ç±»çš„å®ä¾‹ï¼Œç¬¬äºŒä¸ªå‚æ•°methodè¡¨ç¤ºéœ€è¦ä»£ç†çš„æ–¹æ³•ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°argsè¡¨ç¤ºä»£ç†æ–¹æ³•çš„å‚æ•°æ•°ç»„ã€‚ ProxyProxy provides static methods for creating dynamic proxy classes and instances, and it is also the superclass of all dynamic proxy classes created by those methods. å¤§è‡´çš„æ„æ€æ˜¯ï¼š Proxy æä¾›ç”¨äºåˆ›å»ºåŠ¨æ€ä»£ç†ç±»å’Œå®ä¾‹çš„é™æ€æ–¹æ³•ï¼Œå®ƒè¿˜æ˜¯ç”±è¿™äº›æ–¹æ³•åˆ›å»ºçš„æ‰€æœ‰åŠ¨æ€ä»£ç†ç±»çš„è¶…ç±»ã€‚Proxyæä¾›ç»™æˆ‘ä»¬çš„é™æ€æ–¹æ³•æœ‰ä»¥ä¸‹å››ä¸ªï¼š //è¿”å›æŒ‡å®šä»£ç†å®ä¾‹çš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚ static InvocationHandler getInvocationHandler(Object proxy) //è¿”å›ä»£ç†ç±»çš„ java.lang.Class å¯¹è±¡ï¼Œå¹¶å‘å…¶æä¾›ç±»åŠ è½½å™¨å’Œæ¥å£æ•°ç»„ã€‚ static Class&lt;?&gt; getProxyClass(ClassLoader loader, Class&lt;?&gt;[] interfaces) //å½“ä¸”ä»…å½“æŒ‡å®šçš„ç±»é€šè¿‡ getProxyClass æ–¹æ³•æˆ– newProxyInstance æ–¹æ³•åŠ¨æ€ç”Ÿæˆä¸ºä»£ç†ç±»æ—¶ï¼Œè¿”å› trueã€‚ static boolean isProxyClass(Class&lt;?&gt; cl) //è¿”å›ä¸€ä¸ªæŒ‡å®šæ¥å£çš„ä»£ç†ç±»å®ä¾‹ï¼Œè¯¥æ¥å£å¯ä»¥å°†æ–¹æ³•è°ƒç”¨æŒ‡æ´¾åˆ°æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚ //æ–¹æ³•ä¸­çš„ ClassLoader loader å‚æ•°ç”¨æ¥æŒ‡å®šåŠ¨æ€ä»£ç†ç±»çš„ç±»åŠ è½½å™¨ï¼ŒClass&lt;?&gt;[] interfacesç”¨æ¥æŒ‡å®šåŠ¨æ€ä»£ç†ç±»è¦å®ç°çš„æ¥å£ã€‚ //InvocationHandler h ç”¨æ¥æŒ‡å®šä¸å³å°†ç”Ÿæˆçš„åŠ¨æ€ä»£ç†å¯¹è±¡ç›¸å…³è”çš„è°ƒç”¨å¤„ç†ç¨‹åº static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) ä¸‹é¢æˆ‘ä»¬ä»¥ä¸ºæ•°æ®åº“å¢åŠ æ—¥å¿—è®°å½•åŠŸèƒ½ï¼ˆä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»…è®°å½•ä¸‹æ‰€æœ‰æ“ä½œçš„æ‰§è¡Œæ—¶é—´åŠæ“ä½œæ‰§è¡Œçš„ç»“æœï¼‰ä¸ºä¾‹æ¥çœ‹ä¸€çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªç±»å®ç°åŠ¨æ€ä»£ç†ï¼š ä¸ºäº†ä½¿æ¼”ç¤ºæ›´æ¸…æ™°ï¼Œåœ¨æ­¤å…ˆå®šä¹‰ä¸¤ä¸ªç®€å•ç±»ï¼Œä¸€ä¸ªUserç±»å’Œä¸€ä¸ªDocumentç±»åˆ†åˆ«è¡¨ç¤ºæ•°æ®åº“ä¸­çš„ç”¨æˆ·è®°å½•å’Œæ–‡æ¡£è®°å½•ï¼Œå…¶ä»£ç å¦‚ä¸‹ã€‚ public class User { // ç”¨æˆ·åœ¨æ•°æ®åº“ä¸­çš„ID private Long id; // ç”¨æˆ·çš„å§“å private String name; public User(Long id, String name) { super(); this.id = id; this.name = name; } public Long getId() { return id; } public void setId(Long id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } } public class Document { // æ–‡æ¡£åœ¨æ•°æ®åº“ä¸­çš„ID private Long id; // æ–‡æ¡£çš„æ ‡é¢˜ private String title; public Document(Long id, String title) { super(); this.id = id; this.title = title; } public Long getId() { return id; } public void setId(Long id) { this.id = id; } public String getTitle() { return title; } public void setTitle(String title) { this.title = title; } } å¦å¤–è¿˜éœ€å®šä¹‰ä¸€ä¸ªDataBaseç±»ç”¨æ¥æ‰®æ¼”æ•°æ®åº“çš„åŠŸèƒ½ï¼Œåœ¨æ­¤ä¸ºç®€å•èµ·è§ï¼Œå°†æ•°æ®åº“ä¸­çš„ç”¨æˆ·è®°å½•å’Œæ–‡æ¡£è®°å½•åˆ†åˆ«å­˜å‚¨åœ¨ä¸€ä¸ªMapä¸­ï¼Œä»£ç å¦‚ä¸‹ã€‚ import java.util.HashMap; import java.util.Map; public class DataBase { private static Map&lt;Long, User&gt; userMap = null; private static Map&lt;Long, Document&gt; documentMap = null; // ç”¨æ¥è®°å½•å½“å‰ç™»é™†ç”¨æˆ·ä¿¡æ¯ private static User currentUser = null; private DataBase() { // æ•°æ®åˆå§‹åŒ–ï¼Œä¸ºæ•°æ®åº“ä¸­å¢åŠ å‡ æ¡ç”¨æˆ·è®°å½•ã€‚ã€‚ã€‚ userMap = new HashMap&lt;Long, User&gt;(); userMap.put(20160708L, new User(20160708L, &quot;ç‡•å‡Œå¨‡&quot;)); userMap.put(20160709L, new User(20160709L, &quot;å§¬å¦‚é›ª&quot;)); userMap.put(20160710L, new User(20160710L, &quot;ç™¾é‡Œç™»é£&quot;)); // æ•°æ®åˆå§‹åŒ–ï¼Œä¸ºæ•°æ®åº“ä¸­å¢åŠ å‡ æ¡æ–‡æ¡£è®°å½•ã€‚ã€‚ã€‚ documentMap = new HashMap&lt;Long, Document&gt;(); documentMap.put(30160708L, new Document(30160708L, &quot;C++å¸¸ç”¨ç®—æ³•æ‰‹å†Œ&quot;)); documentMap.put(30160709L, new Document(30160709L, &quot;æ·±å…¥ç†è§£Androidå†…æ ¸è®¾è®¡æ€æƒ³&quot;)); documentMap.put(30160710L, new Document(30160710L, &quot;Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;)); } public User getCurrentUser() { return currentUser; } public void setCurrentUser(User currentUser) { DataBase.currentUser = currentUser; } public Map&lt;Long, User&gt; getUserMap() { return userMap; } public Map&lt;Long, Document&gt; getDocumentMap() { return documentMap; } public static DataBase getDataBaseInstance() { return DataBaseHolder.dataBase; } public static class DataBaseHolder { private static DataBase dataBase = new DataBase(); } } æ•°æ®åº“å¸ƒç½®å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å¼€å§‹å†™åŠ¨æ€ä»£ç†ç›¸å…³ä»£ç äº†ï¼Œä¸ºäº†ä¸é™æ€ä»£ç†è¿›è¡Œæ¯”è¾ƒï¼Œåœ¨æ­¤æˆ‘ä»¬æ¥åˆ›å»ºä¸¤ä¸ªæ¥å£ï¼ˆæŠ½è±¡ä¸»é¢˜è§’è‰²ï¼‰ã€‚ public interface UserDao { // ç™»é™†æ•°æ®åº“ï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿å°†å­—ç¬¦ä¸²ä½œä¸ºæ‰§è¡Œç»“æœè¿”å› String login(Long id); // é€€å‡ºæ•°æ®åº“ï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿å°†å­—ç¬¦ä¸²ä½œä¸ºæ‰§è¡Œç»“æœè¿”å› String logout(); } public interface DocumentDao { // æ–°å¢æ–‡æ¡£ï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿å°†å­—ç¬¦ä¸²ä½œä¸ºæ‰§è¡Œç»“æœè¿”å› String add(Document document); // åˆ é™¤æ–‡æ¡£ï¼Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿å°†å­—ç¬¦ä¸²ä½œä¸ºæ‰§è¡Œç»“æœè¿”å› String delete(Document document); } æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªçœŸå®ä¸»é¢˜è§’è‰²ï¼ŒImpUserDao ç±»å’ŒImpDocumentDaoç±»ï¼Œä¸ºäº†ä½¿ç¤ºä¾‹ç»“æœæ¸…æ™°ï¼Œæ­¤å¤„å°†æ¥å£çš„æ‰§è¡Œç»“æœç›´æ¥ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ã€‚ public class ImpUserDao implements UserDao { @Override public String login(Long id) { User user = DataBase.getDataBaseInstance().getUserMap().get(id); if (null != user) { // æ•°æ®åº“æœ‰æ­¤ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåˆ™å…è®¸ç™»é™†... DataBase.getDataBaseInstance().setCurrentUser(user); return &quot;ç”¨æˆ·[&quot; + user.getName() + &quot;]ç™»é™†æˆåŠŸ...&quot;; } else { // æ•°æ®åº“æ²¡æœ‰æ­¤ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ™ä¸è®©ç™»é™†... return &quot;ç™»é™†å¤±è´¥ï¼ŒIDä¸º\\&quot;&quot; + id + &quot;\\&quot;çš„ç”¨æˆ·ä¸å­˜åœ¨ï¼&quot;; } } @Override public String logout() { User user = DataBase.getDataBaseInstance().getCurrentUser(); if (null != user) { // è‹¥å½“å‰æœ‰ç”¨æˆ·ç™»é™†ï¼Œåˆ™é€€å‡ºæˆåŠŸ... DataBase.getDataBaseInstance().setCurrentUser(null); return &quot;ç”¨æˆ·[&quot; + user.getName() + &quot;]é€€å‡ºç™»é™†æˆåŠŸ...&quot;; } else { // è‹¥å½“å‰æ— ç”¨æˆ·ç™»é™†ï¼Œåˆ™é€€å‡ºå¤±è´¥... return &quot;é€€å‡ºç™»é™†å¤±è´¥ï¼Œå½“å‰æ— ç™»é™†ç”¨æˆ·ï¼&quot;; } } } public class ImpDocumentDao implements DocumentDao { @Override public String add(Document document) { User user = DataBase.getDataBaseInstance().getCurrentUser(); if (null == user) { // è‹¥å½“å‰ç”¨æˆ·æœªç™»é™†ï¼Œåˆ™æ–°å¢æ–‡æ¡£å¤±è´¥... return &quot;ä¿å­˜å¤±è´¥ï¼Œæœªè·å–åˆ°ç™»é™†ä¿¡æ¯ï¼&quot;; } else { Document dbDocument = DataBase.getDataBaseInstance().getDocumentMap().get(document.getId()); if (null != dbDocument) { // è‹¥æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨è¯¥IDçš„æ–‡æ¡£ï¼Œåˆ™æ–°å¢æ–‡æ¡£å¤±è´¥... return &quot;æ·»åŠ æ–‡æ¡£ã€Š&quot; + document.getTitle() + &quot;ã€‹å¤±è´¥ï¼Œæ–‡æ¡£å·²å­˜åœ¨ï¼&quot;; } else { // è‹¥è¯¥IDçš„æ–‡æ¡£åœ¨æ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢æ–‡æ¡£æˆåŠŸ... DataBase.getDataBaseInstance().getDocumentMap().put(document.getId(), document); return &quot;æ·»åŠ æ–‡æ¡£ã€Š&quot; + document.getTitle() + &quot;ã€‹æˆåŠŸ...&quot;; } } } @Override public String delete(Document document) { User user = DataBase.getDataBaseInstance().getCurrentUser(); if (null == user) { // è‹¥å½“å‰ç”¨æˆ·æœªç™»é™†ï¼Œåˆ™æ–°å¢æ–‡æ¡£å¤±è´¥... return &quot;ä¿å­˜å¤±è´¥ï¼Œæœªè·å–åˆ°ç™»é™†ä¿¡æ¯ï¼&quot;; } else { Document dbDocument = DataBase.getDataBaseInstance().getDocumentMap().get(document.getId()); if (null == dbDocument) { // è‹¥æ•°æ®åº“ä¸­è¯¥æ–‡æ¡£ä¸å­˜åœ¨ï¼Œåˆ™åˆ é™¤æ–‡æ¡£å¤±è´¥... return &quot;åˆ é™¤æ–‡æ¡£ã€Š&quot; + document.getTitle() + &quot;ã€‹å¤±è´¥ï¼Œæ–‡æ¡£ä¸å­˜åœ¨ï¼&quot;; } else { // è‹¥æ•°æ®åº“ä¸­è¯¥æ–‡æ¡£å­˜åœ¨ï¼Œåˆ™åˆ é™¤æ–‡æ¡£æˆåŠŸ... DataBase.getDataBaseInstance().getDocumentMap().remove(document.getId()); return &quot;åˆ é™¤æ–‡æ¡£ã€Š&quot; + document.getTitle() + &quot;ã€‹æˆåŠŸ...&quot;; } } } } æœ€åï¼Œæˆ‘ä»¬å°±è¦å®šä¹‰åŠ¨æ€ä»£ç†ç±»äº†ï¼Œå‰é¢è¯´è¿‡ï¼Œæ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»è¦å®ç° InvocationHandler è¿™ä¸ªæ¥å£ï¼Œå› æ­¤æˆ‘ä»¬è¿™ä¸ªåŠ¨æ€ä»£ç†ç±»ä¹Ÿä¸ä¾‹å¤–ã€‚ import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.util.Calendar; import java.util.GregorianCalendar; public class DataBaseLogHandler implements InvocationHandler { private Object object; private Calendar calendar; public DataBaseLogHandler(Object object) { super(); this.object = object; } // invoke()æ–¹æ³•ç”¨äºå¤„ç†å¯¹ä»£ç†ç±»å®ä¾‹çš„æ–¹æ³•è°ƒç”¨å¹¶è¿”å›ç›¸åº”çš„ç»“æœ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { before(method); // ç»§ç»­è½¬å‘è¯·æ±‚ç»™å†…éƒ¨çœŸå®ä¸»é¢˜è§’è‰² Object result = method.invoke(object, args); after(result); if (method.getName().equalsIgnoreCase(&quot;logout&quot;)) { System.out.println(&quot;$$$$$$$$$$$$$$$$$$$$$$$$&quot;); System.out.println(&quot;&quot;); } return result; } public void before(Method method) { calendar = new GregorianCalendar(); int year = calendar.get(Calendar.YEAR); int month = calendar.get(Calendar.MONTH); int date = calendar.get(Calendar.DATE); int hour = calendar.get(Calendar.HOUR_OF_DAY); int minute = calendar.get(Calendar.MINUTE); int second = calendar.get(Calendar.SECOND); String time = hour + &quot;æ—¶&quot; + minute + &quot;åˆ†&quot; + second + &quot;ç§’&quot;; System.out.println(&quot;åŒ—äº¬æ—¶é—´ï¼š&quot; + year + &quot;å¹´&quot; + month + &quot;æœˆ&quot; + date + &quot;æ—¥&quot; + time + &quot;,æ‰§è¡Œæ–¹æ³•\\&quot;&quot; + method.getName() + &quot;\\&quot;&quot;); } public void after(Object object) { System.out.println(&quot;æ‰§è¡Œç»“æœ:&quot; + object); } } è‡³æ­¤ï¼ŒåŠ¨æ€ä»£ç†æ‰€éœ€è¦çš„ç±»å°±ç®—åˆ›å»ºå®Œæˆäº†ï¼Œæ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªClientå……å½“å®¢æˆ·ç«¯æ¥æµ‹è¯•ä¸€ä¸‹ã€‚ import java.lang.reflect.Proxy; public class MainClass { public static void main(String[] args) { // æ­¤å¤„æ¥åˆ›å»ºäº†ä¸¤ä¸ªåŠ¨æ€ä»£ç†ç±»å¯¹è±¡... UserDao userDao = new ImpUserDao(); DataBaseLogHandler userHandler = new DataBaseLogHandler(userDao); DocumentDao doucumentDao = new ImpDocumentDao(); DataBaseLogHandler documentHandler = new DataBaseLogHandler(doucumentDao); UserDao userProxy = (UserDao) Proxy.newProxyInstance(UserDao.class.getClassLoader(), new Class[] { UserDao.class }, userHandler); DocumentDao documentProxy = (DocumentDao) Proxy.newProxyInstance(DocumentDao.class.getClassLoader(), new Class[] { DocumentDao.class }, documentHandler); // å…ˆè¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·Idç™»é™†è¯•è¯•... userProxy.login(20160718L); documentProxy.add(new Document(30160711L, &quot;è½¬è§’é‡è§å¹¸ç¦&quot;)); userProxy.logout(); // å†ç”¨ä¸€ä¸ªçœŸå®ç”¨æˆ·Idç™»é™†è¯•è¯•... userProxy.login(20160708L); documentProxy.add(new Document(30160711L, &quot;è½¬è§’é‡è§å¹¸ç¦&quot;)); documentProxy.add(new Document(30160711L, &quot;è½¬è§’é‡è§å¹¸ç¦&quot;)); userProxy.logout(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ11æ—¥19æ—¶33åˆ†46ç§’,æ‰§è¡Œæ–¹æ³•â€loginâ€æ‰§è¡Œç»“æœ:ç™»é™†å¤±è´¥ï¼ŒIDä¸ºâ€20160718â€çš„ç”¨æˆ·ä¸å­˜åœ¨ï¼åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ11æ—¥19æ—¶33åˆ†46ç§’,æ‰§è¡Œæ–¹æ³•â€addâ€æ‰§è¡Œç»“æœ:ä¿å­˜å¤±è´¥ï¼Œæœªè·å–åˆ°ç™»é™†ä¿¡æ¯ï¼åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ11æ—¥19æ—¶33åˆ†46ç§’,æ‰§è¡Œæ–¹æ³•â€logoutâ€æ‰§è¡Œç»“æœ:é€€å‡ºç™»é™†å¤±è´¥ï¼Œå½“å‰æ— ç™»é™†ç”¨æˆ·ï¼$$$$$$$$$$$$$$$$$$$$$$$$ åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ11æ—¥19æ—¶33åˆ†46ç§’,æ‰§è¡Œæ–¹æ³•â€loginâ€æ‰§è¡Œç»“æœ:ç”¨æˆ·[ç‡•å‡Œå¨‡]ç™»é™†æˆåŠŸâ€¦åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ11æ—¥19æ—¶33åˆ†46ç§’,æ‰§è¡Œæ–¹æ³•â€addâ€æ‰§è¡Œç»“æœ:æ·»åŠ æ–‡æ¡£ã€Šè½¬è§’é‡è§å¹¸ç¦ã€‹æˆåŠŸâ€¦åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ11æ—¥19æ—¶33åˆ†46ç§’,æ‰§è¡Œæ–¹æ³•â€addâ€æ‰§è¡Œç»“æœ:æ·»åŠ æ–‡æ¡£ã€Šè½¬è§’é‡è§å¹¸ç¦ã€‹å¤±è´¥ï¼Œæ–‡æ¡£å·²å­˜åœ¨ï¼åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ11æ—¥19æ—¶33åˆ†46ç§’,æ‰§è¡Œæ–¹æ³•â€logoutâ€æ‰§è¡Œç»“æœ:ç”¨æˆ·[ç‡•å‡Œå¨‡]é€€å‡ºç™»é™†æˆåŠŸâ€¦$$$$$$$$$$$$$$$$$$$$$$$$ ä»ä»¥ä¸Šç¨‹åºçš„æœ€ç»ˆè¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼šé€šè¿‡ä½¿ç”¨JDKè‡ªå¸¦çš„åŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬åŒæ—¶å®ç°äº†å¯¹ImpUserDaoå’ŒImpDocumentDaoä¸¤ä¸ªçœŸå®ä¸»é¢˜ç±»çš„ç»Ÿä¸€ä»£ç†å’Œé›†ä¸­æ§åˆ¶ã€‚è‡³äºè¯¥åŠ¨æ€ä»£ç†ç±»æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ï¼Ÿå°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¯¦ç»†è®¨è®ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•ä½¿ç”¨CGLIBå®ç°åŠ¨æ€ä»£ç†ã€‚ ä¸‰ã€ä½¿ç”¨CGLIBå®ç°åŠ¨æ€ä»£ç†ç”ŸæˆåŠ¨æ€ä»£ç†ç±»çš„æ–¹æ³•å¾ˆå¤šï¼Œå¦‚ä¸Šä¾‹ä¸­JDKè‡ªå¸¦çš„åŠ¨æ€ä»£ç†ã€CGLIBã€Javassist æˆ–è€… ASM åº“ã€‚JDK çš„åŠ¨æ€ä»£ç†ä½¿ç”¨ç®€å•ï¼Œå®ƒå†…ç½®åœ¨ JDK ä¸­ï¼Œå› æ­¤ä¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹ Jar åŒ…ï¼Œä½†ç›¸å¯¹åŠŸèƒ½æ¯”è¾ƒå¼±ã€‚CGLIB å’Œ Javassist éƒ½æ˜¯é«˜çº§çš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œæ€»ä½“æ€§èƒ½æ¯” JDK è‡ªå¸¦çš„åŠ¨æ€ä»£ç†å¥½ï¼Œè€Œä¸”åŠŸèƒ½ååˆ†å¼ºå¤§ã€‚ASM æ˜¯ä½çº§çš„å­—èŠ‚ç ç”Ÿæˆå·¥å…·ï¼Œä½¿ç”¨ ASM å·²ç»è¿‘ä¹äºåœ¨ä½¿ç”¨ Java bytecode ç¼–ç¨‹ï¼Œå¯¹å¼€å‘äººå‘˜è¦æ±‚æœ€é«˜ï¼Œå½“ç„¶ï¼Œä¹Ÿæ˜¯æ€§èƒ½æœ€å¥½çš„ä¸€ç§åŠ¨æ€ä»£ç†ç”Ÿæˆå·¥å…·ã€‚ä½† ASM çš„ä½¿ç”¨å¾ˆç¹çï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿæ²¡æœ‰æ•°é‡çº§çš„æå‡ï¼Œä¸ CGLIB ç­‰é«˜çº§å­—èŠ‚ç ç”Ÿæˆå·¥å…·ç›¸æ¯”ï¼ŒASM ç¨‹åºçš„ç»´æŠ¤æ€§è¾ƒå·®ï¼Œå¦‚æœä¸æ˜¯åœ¨å¯¹æ€§èƒ½æœ‰è‹›åˆ»è¦æ±‚çš„åœºåˆï¼Œè¿˜æ˜¯æ¨è CGLIB æˆ–è€… Javassistã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­ç”¨ä¸Šé¢çš„ä¾‹å­æ¥ä½“éªŒä¸€ä¸‹å¦‚ä½•ä½¿ç”¨CGLIBå®ç°åŠ¨æ€ä»£ç†ã€‚ é¦–å…ˆï¼Œä½¿ç”¨CGLIBæ¥å®ç°åŠ¨æ€ä»£ç†éœ€å¼•å…¥â€œasm.jarâ€(CGLIBçš„åº•å±‚æ˜¯ä½¿ç”¨ASMå®ç°çš„)å’Œâ€œcglib.jarâ€ä¸¤ä¸ªç¬¬ä¸‰æ–¹jaråŒ…,å¼•å…¥ä¸¤ä¸ªjaråŒ…æ—¶éœ€æ³¨æ„å…¶ç‰ˆæœ¬ï¼Œè‹¥ç‰ˆæœ¬æœ‰å†²çªä¼šå‡ºç°ä»¥ä¸‹å¼‚å¸¸ï¼š Exception in thread â€œmainâ€ java.lang.NoSuchMethodError: org.objectweb.asm.ClassWriter.(I)V æ¥ä¸‹æ¥å¼€å§‹å†™ä»£ç ï¼Œå»¶ç”¨ä¸Šä¾‹ä¸­çš„ï¼šUserç±»ã€Documentç±»ã€DataBaseç±»ã€ä¸¤ä¸ªæŠ½è±¡ä¸»é¢˜æ¥å£UserDaoå’ŒDocumentDaoã€ä¸¤ä¸ªçœŸå®ä¸»é¢˜è§’è‰²ç±»ImpUserDaoå’ŒImpDocumentDaoï¼Œè¿™å‡ ä¸ªç±»æ— éœ€åšä»»ä½•ä¿®æ”¹ï¼Œæ­¤å¤„ä¸å†é‡å¤è´´å‡ºã€‚ å»æ‰ä¸Šä¾‹ä¸­çš„ DataBaseLogHandler ç±»ï¼Œæ–°å¢ä¸€ä¸ª CglibProxy ç±»ï¼Œè¯¥ç±»éœ€å®ç°CGLIBçš„ MethodInterceptor(æ–¹æ³•æ‹¦æˆª) æ¥å£ã€‚ import java.lang.reflect.Method; import java.util.Calendar; import java.util.GregorianCalendar; import net.sf.cglib.proxy.Enhancer; import net.sf.cglib.proxy.MethodInterceptor; import net.sf.cglib.proxy.MethodProxy; public class CglibProxy implements MethodInterceptor { private Calendar calendar; /** * åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ * * @param clazz * éœ€è¦åˆ›å»ºå­ç±»ä»£ç†çš„çˆ¶ç±»çš„ç±»å‹ * * @return */ public Object getProxyInstance(Class&lt;?&gt; clazz) { Enhancer enhancer = new Enhancer(); // è®¾ç½®è¦åˆ›å»ºçš„åŠ¨æ€ä»£ç†ç±»çš„çˆ¶ç±» enhancer.setSuperclass(clazz); // è®¾ç½®å›è°ƒçš„å¯¹è±¡ï¼Œæ­¤å¥ä¼šå¯¼è‡´è°ƒç”¨åŠ¨æ€ä»£ç†ç±»å¯¹è±¡çš„æ–¹æ³•ä¼šè¢«æŒ‡æ´¾åˆ°CglibProxyå¯¹è±¡çš„intercept()æ–¹æ³• enhancer.setCallback(this); // é€šè¿‡å­—èŠ‚ç æŠ€æœ¯åŠ¨æ€åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®ä¾‹ return enhancer.create(); } @Override // å›è°ƒæ–¹æ³• public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable { before(method); // é€šè¿‡åŠ¨æ€å­ç±»ä»£ç†å®ä¾‹è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³• Object result = proxy.invokeSuper(obj, args); after(result); if (method.getName().equalsIgnoreCase(&quot;logout&quot;)) { System.out.println(&quot;**********************************&quot;); System.out.println(&quot;&quot;); } return result; } public void before(Method method) { calendar = new GregorianCalendar(); int year = calendar.get(Calendar.YEAR); int month = calendar.get(Calendar.MONTH); int date = calendar.get(Calendar.DATE); int hour = calendar.get(Calendar.HOUR_OF_DAY); int minute = calendar.get(Calendar.MINUTE); int second = calendar.get(Calendar.SECOND); String time = hour + &quot;æ—¶&quot; + minute + &quot;åˆ†&quot; + second + &quot;ç§’&quot;; System.out .println(&quot;åŒ—äº¬æ—¶é—´ï¼š&quot; + year + &quot;å¹´&quot; + month + &quot;æœˆ&quot; + date + &quot;æ—¥&quot; + time + &quot;,æ‰§è¡Œæ–¹æ³•\\&quot;&quot; + method.getName() + &quot;\\&quot;&quot;); } public void after(Object object) { System.out.println(&quot;æ‰§è¡Œç»“æœ:&quot; + object); } } å¯¹å®¢æˆ·ç«¯è¿›è¡Œç›¸åº”ä¿®æ”¹ï¼Œå¦‚ä¸‹ã€‚ public class MainClass { public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªCglibProxyä»£ç†ç±»å¯¹è±¡ï¼Œç”¨æ¥åˆ›å»ºå­ç±»ä»£ç†å®ä¾‹ CglibProxy cglib = new CglibProxy(); // ä¸ºImpUserDaoç±»æ·»åŠ ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ï¼Œå³å­ç±»ä»£ç†å¯¹è±¡ UserDao userProxy = (UserDao) cglib.getProxyInstance(ImpUserDao.class); // ä¸ºImpDocumentDaoç±»æ·»åŠ ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ï¼Œå³å­ç±»ä»£ç†å¯¹è±¡ DocumentDao documentProxy = (DocumentDao) cglib.getProxyInstance(ImpDocumentDao.class); // å…ˆè¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·Idç™»é™†è¯•è¯•... userProxy.login(20160718L); documentProxy.add(new Document(30160711L, &quot;è½¬è§’é‡è§å¹¸ç¦&quot;)); userProxy.logout(); // å†ç”¨ä¸€ä¸ªçœŸå®ç”¨æˆ·Idç™»é™†è¯•è¯•... userProxy.login(20160708L); documentProxy.add(new Document(30160711L, &quot;è½¬è§’é‡è§å¹¸ç¦&quot;)); documentProxy.add(new Document(30160711L, &quot;è½¬è§’é‡è§å¹¸ç¦&quot;)); userProxy.logout(); } } è¿è¡Œç¨‹åºç»“æœæ‰“å°å¦‚ä¸‹ï¼Œä¸ä¹‹å‰ä½¿ç”¨JDKè‡ªå¸¦åŠ¨æ€ä»£ç†ç¨‹åºè¿è¡Œç»“æœå®Œå…¨ç›¸åŒï¼š åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ12æ—¥20æ—¶22åˆ†35ç§’,æ‰§è¡Œæ–¹æ³•â€loginâ€æ‰§è¡Œç»“æœ:ç™»é™†å¤±è´¥ï¼ŒIDä¸ºâ€20160718â€çš„ç”¨æˆ·ä¸å­˜åœ¨ï¼åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ12æ—¥20æ—¶22åˆ†35ç§’,æ‰§è¡Œæ–¹æ³•â€addâ€æ‰§è¡Œç»“æœ:ä¿å­˜å¤±è´¥ï¼Œæœªè·å–åˆ°ç™»é™†ä¿¡æ¯ï¼åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ12æ—¥20æ—¶22åˆ†35ç§’,æ‰§è¡Œæ–¹æ³•â€logoutâ€æ‰§è¡Œç»“æœ:é€€å‡ºç™»é™†å¤±è´¥ï¼Œå½“å‰æ— ç™»é™†ç”¨æˆ·ï¼$$$$$$$$$$$$$$$$$$$$$$$$åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ12æ—¥20æ—¶22åˆ†35ç§’,æ‰§è¡Œæ–¹æ³•â€loginâ€æ‰§è¡Œç»“æœ:ç”¨æˆ·[ç‡•å‡Œå¨‡]ç™»é™†æˆåŠŸâ€¦åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ12æ—¥20æ—¶22åˆ†35ç§’,æ‰§è¡Œæ–¹æ³•â€addâ€æ‰§è¡Œç»“æœ:æ·»åŠ æ–‡æ¡£ã€Šè½¬è§’é‡è§å¹¸ç¦ã€‹æˆåŠŸâ€¦åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ12æ—¥20æ—¶22åˆ†35ç§’,æ‰§è¡Œæ–¹æ³•â€addâ€æ‰§è¡Œç»“æœ:æ·»åŠ æ–‡æ¡£ã€Šè½¬è§’é‡è§å¹¸ç¦ã€‹å¤±è´¥ï¼Œæ–‡æ¡£å·²å­˜åœ¨ï¼åŒ—äº¬æ—¶é—´ï¼š2016å¹´6æœˆ12æ—¥20æ—¶22åˆ†35ç§’,æ‰§è¡Œæ–¹æ³•â€logoutâ€æ‰§è¡Œç»“æœ:ç”¨æˆ·[ç‡•å‡Œå¨‡]é€€å‡ºç™»é™†æˆåŠŸâ€¦$$$$$$$$$$$$$$$$$$$$$$$$ PS:CGLibåˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡æ€§èƒ½æ¯”JDKåˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ€§èƒ½é«˜ä¸å°‘ï¼Œä½†æ˜¯CGLibåœ¨åˆ›å»ºä»£ç†å¯¹è±¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å´æ¯”JDKå¤šå¾—å¤šï¼Œæ‰€ä»¥å¯¹äºå•ä¾‹çš„å¯¹è±¡ï¼Œå› ä¸ºæ— éœ€é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œç”¨CGLibåˆé€‚ï¼Œåä¹‹ï¼Œä½¿ç”¨JDKæ–¹å¼è¦æ›´ä¸ºåˆé€‚ä¸€äº›ã€‚åŒæ—¶ï¼Œç”±äºCGLibé‡‡ç”¨åŠ¨æ€åˆ›å»ºå­ç±»çš„æ–¹æ³•æ¥å¯¹è¢«ä»£ç†çš„çˆ¶ç±»çš„åŠŸèƒ½è¿›è¡Œå¢å¼ºå’Œä»£ç†ï¼Œæ‰€ä»¥ï¼Œæ— æ³•å¯¹è¢«å£°æ˜ä¸ºfinalçš„ç±»æˆ–æ–¹æ³•è¿›è¡Œä»£ç†ã€‚ å››ã€åŠ¨æ€ä»£ç†æ¨¡å¼çš„ç‰¹ç‚¹åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨å­—èŠ‚ç åŠ¨æ€ç”ŸæˆåŠ è½½æŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶ç”Ÿæˆå¹¶åŠ è½½ä»£ç†ç±»ã€‚ä¸é™æ€ä»£ç†ç›¸æ¯”ï¼ŒåŠ¨æ€ä»£ç†å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š æ— éœ€å•ç‹¬ä¸ºæ¯ä¸€ä¸ªæ¥å£æ·»åŠ ä¸€ä¸ªä»£ç†ç±»ï¼Œä½¿ç”¨åŠ¨æ€ä»£ç†å¯ä»¥ä¸€æ¬¡æ€§ä¸ºå¤šä¸ªæ¥å£å®ç°ä»£ç†ã€‚ æ— éœ€é€ä¸ªä¸ºæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•æ·»åŠ å®ç°ï¼Œä½¿ç”¨åŠ¨æ€ä»£ç†å¯ä»¥ä¸€æ¬¡æ€§ä¸ºå¤šä¸ªæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•å®ç°ä»£ç†ï¼Œåœ¨æ¥å£æ–¹æ³•æ•°é‡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¯ä»¥é¿å…å‡ºç°å¤§é‡çš„é‡å¤ä»£ç ã€‚ åŠ¨æ€ä»£ç†çš„ç¼ºç‚¹ï¼š ç›®å‰ï¼ŒJDKä¸­æä¾›çš„åŠ¨æ€ä»£ç†åªèƒ½å¯¹æ¥å£å®ç°ä»£ç†ï¼Œæ— æ³•ä»£ç†æœªå®ç°æ¥å£çš„ç±»ã€‚å¦‚æœéœ€è¦åŠ¨æ€ä»£ç†æœªå®ç°æ¥å£çš„ç±»ï¼Œå¿…é¡»å€ŸåŠ©ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚ï¼šCGLib(Code Generation Library)ç­‰ã€‚ å‚è€ƒæ–‡ç« https://www.cnblogs.com/xiaoluo501395377/p/3383130.html https://www.ibm.com/developerworks/cn/java/j-lo-proxy-pattern/ http://www.lxway.com/4445954962.htm https://blog.csdn.net/lovelion/article/details/8116704 https://blog.csdn.net/hejingyuan6/article/details/36203505 https://blog.csdn.net/rokii/article/details/4046098","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"ä»£ç†æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼,åŠ¨æ€","slug":"ä»£ç†æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼-åŠ¨æ€","permalink":"/tags/ä»£ç†æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼-åŠ¨æ€/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--é™æ€ä»£ç†æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--é™æ€ä»£ç†æ¨¡å¼","date":"2020-05-24T08:44:45.000Z","updated":"2023-04-30T10:21:41.363Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--é™æ€ä»£ç†æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--é™æ€ä»£ç†æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ï¼ˆåŸæ–‡ï¼šThe Proxy Pattern Provide a surrogate or placeholder for another object to control access to it.ï¼‰ ä»£ç†æ¨¡å¼çš„ä½œç”¨ï¼šåœ¨å®¢æˆ·ç«¯å’Œè¢«ä»£ç†å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹ä½œç”¨ï¼Œé€šè¿‡ä»£ç†å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶å®¢æˆ·ç«¯å¯¹è¢«ä»£ç†å¯¹è±¡çš„ç›´æ¥è®¿é—®ï¼Œè¿›è€Œå¯ä»¥å¾ˆå¥½åœ°éšè—å’Œä¿æŠ¤è¢«ä»£ç†å¯¹è±¡ã€‚ ä»£ç†æ¨¡å¼æŒ‰ç…§å…¶ä»£ç†ç±»ç”Ÿæˆæ–¹å¼çš„ä¸åŒåˆå¯ä»¥åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸¤ç§ï¼Œæœ¬ç« å…ˆè·Ÿå¤§å®¶æ¥èŠèŠé™æ€ä»£ç†ã€‚ äºŒã€é™æ€ä»£ç†æ¨¡å¼çš„ç»“æ„ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œåœ¨ä»£ç†æ¨¡å¼ä¸­ï¼Œä»£ç†ä¸è¢«ä»£ç†çš„å¯¹è±¡é€šå¸¸è¦å®ç°ç›¸åŒçš„æ¥å£ï¼Œä»¥ä¾¿åœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ä»£ç†æ¥æ›¿ä»£è¢«ä»£ç†å¯¹è±¡ï¼Œå®¢æˆ·ç«¯å¿…é¡»é€šè¿‡ä»£ç†ä¸è¢«ä»£ç†å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸”å¯ä»¥åœ¨äº¤äº’çš„è¿‡ç¨‹ä¸­ï¼ˆäº¤äº’å‰åï¼‰æ·»åŠ ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚ é™æ€ä»£ç†æ¨¡å¼çš„UMLç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ã€‚ é™æ€ä»£ç†æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£ï¼š æŠ½è±¡ä¸»é¢˜(Subject)è§’è‰²ï¼šè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡è§’è‰²ï¼Œé€šå¸¸è¢«å®šä¹‰ä¸ºæ¥å£ï¼ŒçœŸå®ä¸»é¢˜è§’è‰²å’Œä»£ç†ä¸»é¢˜è§’è‰²éƒ½éœ€å®ç°æ­¤æ¥å£ï¼Œä»¥ä¾¿å°†æ¥å¯ä»¥ä½¿ç”¨ä»£ç†ä¸»é¢˜å¯¹è±¡æ¥æ›¿ä»£çœŸå®ä¸»é¢˜å¯¹è±¡ã€‚ çœŸå®ä¸»é¢˜(RealSubject)è§’è‰²ï¼šä¹Ÿå«è¢«ä»£ç†è§’è‰²ï¼Œæ˜¯ä»£ç†ä¸»é¢˜è§’è‰²æ‰€ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œæ˜¯ä¸šåŠ¡é€»è¾‘çš„å®é™…æ‰§è¡Œè€…ã€‚ ä»£ç†ä¸»é¢˜(Proxy)è§’è‰²ï¼šä¹Ÿå«ä»£ç†è§’è‰²ï¼Œè¯¥è§’è‰²å†…éƒ¨å«æœ‰å¯¹çœŸå®ä¸»é¢˜å¯¹è±¡çš„å¼•ç”¨ï¼Œä»è€Œå¯ä»¥æ“ä½œçœŸå®ä¸»é¢˜å¯¹è±¡ï¼ŒåŒæ—¶ä»£ç†å¯¹è±¡æä¾›ä¸çœŸå®ä¸»é¢˜å¯¹è±¡ç›¸åŒçš„æ¥å£ä»¥ä¾¿åœ¨ä»»ä½•æ—¶åˆ»éƒ½èƒ½ä»£æ›¿çœŸå®ä¸»é¢˜å¯¹è±¡ã€‚é€šå¸¸ä»£ç†è§’è‰²ä¼šåœ¨å°†å®¢æˆ·ç«¯è°ƒç”¨ä¼ é€’ç»™çœŸå®ä¸»é¢˜å¯¹è±¡ä¹‹å‰æˆ–è€…ä¹‹åæ‰§è¡ŒæŸäº›æ“ä½œï¼Œè€Œä¸æ˜¯å•çº¯åœ°å°†è°ƒç”¨ä¼ é€’ç»™çœŸå®ä¸»é¢˜å¯¹è±¡ã€‚ é™æ€ä»£ç†æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼š æŠ½è±¡ä¸»é¢˜(Subject)è§’è‰² public interface Subject { // å£°æ˜çœŸå®ä¸»é¢˜è§’è‰²å’Œä»£ç†ä¸»é¢˜è§’è‰²éƒ½éœ€å®ç°çš„æ–¹æ³• public void operation(); } çœŸå®ä¸»é¢˜(RealSubject)è§’è‰² public class RealSubject implements Subject { //å®ç°äº†æŠ½è±¡ä¸»é¢˜è§’è‰²å®šä¹‰çš„æ¥å£ @Override public void operation() { System.out.println(&quot;è°ƒç”¨çœŸå®ä¸»é¢˜å¯¹è±¡æ‰§è¡Œæ“ä½œè¿›è¡Œä¸­...&quot;); } } ä»£ç†ä¸»é¢˜(Proxy)è§’è‰² public class Proxy implements Subject { //åŒ…å«ä¸€ä¸ªçœŸå®ä¸»é¢˜å¯¹è±¡çš„å¼•ç”¨ private Subject realSubject; public Proxy(Subject realSubject) { this.realSubject = realSubject; } public void before() { System.out.println(&quot;è°ƒç”¨çœŸå®ä¸»é¢˜å¯¹è±¡ä¹‹å‰è¿›è¡Œçš„ç›¸å…³æ“ä½œ...&quot;); } public void after() { System.out.println(&quot;è°ƒç”¨çœŸå®ä¸»é¢˜å¯¹è±¡ä¹‹åè¿›è¡Œçš„ç›¸å…³æ“ä½œ...&quot;); } //é€šè¿‡è°ƒç”¨å†…éƒ¨çœŸå®ä¸»é¢˜å¯¹è±¡çš„å¼•ç”¨å®ç°äº†æŠ½è±¡ä¸»é¢˜è§’è‰²å®šä¹‰çš„æ¥å£ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›é¢å¤–å¤„ç†åŠŸèƒ½ @Override public void operation() { before(); realSubject.operation(); after(); } } åœ¨MainClassä¸­æµ‹ä¸€ä¸‹ï¼š public class MainClass { public static void main(String[] args) { Subject realSubject=new RealSubject(); Proxy proxy= new Proxy(realSubject); proxy.operation(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š è°ƒç”¨çœŸå®ä¸»é¢˜å¯¹è±¡ä¹‹å‰è¿›è¡Œçš„ç›¸å…³æ“ä½œâ€¦è°ƒç”¨çœŸå®ä¸»é¢˜å¯¹è±¡æ‰§è¡Œæ“ä½œè¿›è¡Œä¸­â€¦è°ƒç”¨çœŸå®ä¸»é¢˜å¯¹è±¡ä¹‹åè¿›è¡Œçš„ç›¸å…³æ“ä½œâ€¦ ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºä»£ç†å¯¹è±¡å°†å®¢æˆ·ç«¯çš„è°ƒç”¨å§”æ´¾ç»™è¢«ä»£ç†å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ä¹‹å‰å’Œä¹‹åæ‰§è¡Œäº†ä¸€äº›ç‰¹æ®Šæ“ä½œï¼Œæ­¤ç§æ¨¡å¼ä¸è£…é¥°æ¨¡å¼æœ‰ç‚¹ç›¸ä¼¼ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼šä»£ç†æ¨¡å¼çš„ç›®çš„åœ¨äºæ§åˆ¶è®¿é—®ï¼Œè£…é¥°æ¨¡å¼çš„ç›®çš„åœ¨äºæ·»åŠ åŠŸèƒ½ã€‚ PSï¼šä¸ç†è§£ä»£ç†æ¨¡å¼ä¸è£…é¥°æ¨¡å¼ä¹‹é—´åŒºåˆ«ï¼Ÿæ²¡å…³ç³»ï¼Œå¾…æˆ‘ä»¬è®²å®Œæ¥ä¸‹æ¥æ•°æ®åº“è¿æ¥æ± çš„ä¾‹å­ï¼Œç›¸ä¿¡ä½ ä¸€å®šä¼šæœ‰æ‰€é¢†æ‚Ÿã€‚ ä¸‰ã€é™æ€ä»£ç†æ¨¡å¼åº”ç”¨ä¸¾ä¾‹åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œä½¿ç”¨ä»£ç†æ¨¡å¼çš„æ„å›¾å¾ˆå¤šï¼Œæ¯”å¦‚å› ä¸ºå®‰å…¨åŸå› éœ€è¦å±è”½å®¢æˆ·ç«¯ç›´æ¥è®¿é—®çœŸå®å¯¹è±¡ï¼Œæˆ–è€…åœ¨è¿œç¨‹è°ƒç”¨ä¸­éœ€è¦ä½¿ç”¨ä»£ç†ç±»å¤„ç†è¿œç¨‹æ–¹æ³•è°ƒç”¨çš„æŠ€æœ¯ç»†èŠ‚ (å¦‚ RMI)ï¼Œä¹Ÿå¯èƒ½ä¸ºäº†æå‡ç³»ç»Ÿæ€§èƒ½ï¼Œå¯¹çœŸå®å¯¹è±¡è¿›è¡Œå°è£…ï¼Œä»è€Œè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„ç›®çš„ã€‚ åº”ç”¨ä¸€æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªç®€å•çš„æ•°æ®åº“åº”ç”¨ï¼Œç”±äºå¯¹äºæ•°æ®åº“çš„è®¿é—®ä¸æ˜¯å¾ˆé¢‘ç¹ã€‚è¿™æ—¶å¯ä»¥ç®€å•åœ°åœ¨éœ€è¦è®¿é—®æ•°æ®åº“æ—¶ï¼Œå°±æ–°åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œç”¨å®Œåå°±å…³é—­å®ƒï¼Œè¿™æ ·åšä¹Ÿä¸ä¼šå¸¦æ¥ä»€ä¹ˆæ˜æ˜¾çš„æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªå¤æ‚çš„æ•°æ®åº“åº”ç”¨ï¼Œæƒ…å†µå°±å®Œå…¨ä¸åŒäº†ï¼Œé¢‘ç¹çš„å»ºç«‹ã€å…³é—­æ•°æ®åº“è¿æ¥ï¼Œä¼šæå¤§çš„é™ä½ç³»ç»Ÿçš„æ€§èƒ½ï¼Œæ­¤æ—¶ï¼Œå¯¹äºè¿æ¥çš„ä½¿ç”¨å°±æˆäº†ç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆã€‚ ç”±äºå­˜åœ¨ä»¥ä¸Šå¼Šç—…ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± æ¥è§£å†³è¿æ¥é—®é¢˜ï¼Œå³åˆ›é€ ä¸€å †ç­‰å¾…è¢«ä½¿ç”¨çš„è¿æ¥ï¼Œç­‰åˆ°ç”¨çš„æ—¶å€™å°±ä»è¿æ¥æ± é‡Œå–ä¸€ä¸ªï¼Œä¸ç”¨äº†å†æ”¾å›å»ï¼Œæ•°æ®åº“è¿æ¥åœ¨æ•´ä¸ªåº”ç”¨å¯åŠ¨æœŸé—´ï¼Œå‡ ä¹æ˜¯ä¸å…³é—­çš„ã€‚ ä½†æ˜¯åœ¨ç¨‹åºå‘˜ç¼–å†™ç¨‹åºçš„æ—¶å€™ï¼Œä¼šç»å¸¸ä½¿ç”¨connection.close()è¿™æ ·çš„æ–¹æ³•ï¼Œå»å…³é—­æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸”è¿™æ ·åšæ˜¯å¯¹çš„ï¼Œæ‰€ä»¥ä½ å¹¶ä¸èƒ½å‘Šè¯‰ç¨‹åºå‘˜ä»¬è¯´ï¼Œä½ ä»¬ä½¿ç”¨è¿æ¥éƒ½ä¸è¦å…³äº†ï¼Œå»è°ƒç”¨ä¸€ä¸ªå…¶ä»–çš„ç±»ä¼¼æ–¹æ³•å°†è¿æ¥é‡æ–°å½’è¿˜ç»™è¿æ¥æ± å§ã€‚è¿™æ˜¯ä¸ç¬¦åˆç¨‹åºå‘˜çš„ç¼–ç¨‹æ€ç»´çš„ï¼Œä¹Ÿå¾ˆå‹‰å¼ºï¼Œè€Œä¸”å…·æœ‰é£é™©æ€§ï¼Œå› ä¸ºç¨‹åºå‘˜ä¼šå¿˜çš„ã€‚ è§£å†³è¿™ä¸€é—®é¢˜çš„åŠæ³•å°±æ˜¯ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œå› ä¸ºé€šè¿‡ä»£ç†å¯ä»¥æœ‰æ•ˆæ§åˆ¶å®¢æˆ·ç«¯å¯¹è¢«ä»£ç†å¯¹è±¡çš„ç›´æ¥è®¿é—®ï¼Œå®¢æˆ·ç«¯åªèƒ½é€šè¿‡ä»£ç†ä¸è¢«ä»£ç†å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œè¿™æ ·ä»£ç†å¯ä»¥å¾ˆè½»æ˜“å¯¹è¢«ä»£ç†å¯¹è±¡çš„è¡Œä¸ºè¿›è¡Œæ‰©å±•æˆ–è€…ä¿®æ”¹ï¼Œè€Œæˆ‘ä»¬åœ¨è¿™é‡Œè¦åšçš„å°±æ˜¯æ›¿æ¢æ‰connectionçš„close()æ–¹æ³•ã€‚ ä¸ºæ¸…æ™°èµ·è§ï¼Œæˆ‘åœ¨æ­¤é‡æ–°åˆ›å»ºäº†ä¸€ä¸ªè¿æ¥æ¥å£åä¸ºIConnectionï¼Œå®ƒåŒ…å«query()å’Œclose()ä¸¤ä¸ªæ–¹æ³•ã€‚ public interface IConnection { // æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥ void query(); // å…³é—­è¿æ¥ void close(); } æ¥ä¸‹æ¥å†™ä¸€ä¸ªå®ç°çš„IConnectionæ¥å£çš„ImpConnectionç±»ï¼Œå®ƒæ‰®æ¼”äº†ä»£ç†æ¨¡å¼ä¸­çš„çœŸå®ä¸»é¢˜è§’è‰²ã€‚ public class ImpConnection implements IConnection { @Override public void query() { System.out.println(&quot;æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥...&quot;); } @Override public void close() { System.out.println(&quot;å…³é—­è¿æ¥...&quot;); } } æ¥ä¸‹æ¥æˆ‘ä»¬è¦å†™ä»£ç†ç±»ConnectionProxyï¼Œä»£ç†ç±»ä¹Ÿè¦å®ç°IConnectionè¿™ä¸ªæ¥å£ï¼Œç”±äºé€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†æ¨¡å¼ä¸å¤Ÿçµæ´»ï¼Œæ¨èä½¿ç”¨ç»„åˆæ–¹å¼ã€‚ public class ConnectionProxy implements IConnection { private IConnection iConnection; public ConnectionProxy(IConnection iConnection) { super(); this.iConnection = iConnection; } @Override public void query() { //å¯¹äºæˆ‘ä»¬ä¸å…³å¿ƒçš„æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨çœŸå®å¯¹è±¡å»å¤„ç† iConnection.query(); } @Override public void close() { // ä¸çœŸæ­£å…³é—­è¿æ¥ï¼Œè€Œæ˜¯å°†è¿æ¥å½’è¿˜ç»™è¿æ¥æ±  ConnectionPool.getInstance().returnConnection(iConnection); } } æ¥ä¸‹æ¥æ˜¯è¿æ¥æ± çš„ç®€å•ä»£ç  import java.util.LinkedList; public class ConnectionPool { private static LinkedList&lt;IConnection&gt; connectionList = new LinkedList&lt;IConnection&gt;(); private static IConnection createNewConnection() { return new ImpConnection(); } private ConnectionPool() { if (connectionList == null || connectionList.size() == 0) { for (int i = 0; i &lt; 10;) { System.out.println(&quot;åˆ›å»ºç¬¬ &quot; + (++i) + &quot; ä¸ªè¿æ¥...&quot;); connectionList.add(createNewConnection()); } System.out.println(&quot;è¿æ¥æ± åˆå§‹åŒ–å®Œæˆ...&quot;); showConnectionCount(); } } public static void showConnectionCount() { System.out.println(&quot;å½“å‰è¿æ¥æ± å¯ç”¨è¿æ¥æ•°ä¸ºï¼š &quot; + connectionList.size()); } public IConnection getConnection() { if (connectionList.size() &gt; 0) { // return connectionList.remove(); // è¿™æ˜¯åŸæœ‰çš„æ–¹å¼ï¼Œç›´æ¥è¿”å›è¿æ¥ï¼Œè¿™æ ·å¯èƒ½ä¼šå‡ºç°ç¨‹åºå‘˜æŠŠè¿æ¥ç»™å…³é—­æ‰çš„æƒ…å†µ // ä¸‹é¢æ˜¯ä½¿ç”¨ä»£ç†çš„æ–¹å¼ï¼Œç¨‹åºå‘˜å†è°ƒç”¨closeæ—¶ï¼Œå°±ä¼šè°ƒç”¨ä»£ç†çš„close()æ–¹æ³•æŠŠè¿æ¥å½’è¿˜åˆ°è¿æ¥æ±  IConnection iConnection = null; iConnection = connectionList.remove(); System.out.println(&quot;ä»è¿æ¥æ± è·å–ä¸€æ¡è¿æ¥...&quot;); showConnectionCount(); return new ConnectionProxy(iConnection); } return null; } public void returnConnection(IConnection connection) { System.out.println(&quot;å°†è¿æ¥å½’è¿˜ç»™è¿æ¥æ± ã€‚ã€‚ã€‚&quot;); connectionList.add(connection); showConnectionCount(); } public static ConnectionPool getInstance() { return ConnectionPoolInstance.connectionPool; } private static class ConnectionPoolInstance { private static ConnectionPool connectionPool = new ConnectionPool(); } } åœ¨MainClassé‡Œé¢æµ‹è¯•ä¸€ä¸‹ã€‚ public class MainClass { public static void main(String[] args) { // æ­¤æ¡è¯­å¥ç”¨æ¥æµ‹è¯•å•ä¾‹ConnectionPoolæ˜¯å¦å®ç°å»¶è¿ŸåŠ è½½ // ç”±äºæœªä½¿ç”¨è¿æ¥ï¼Œæ­¤æ¡è¯­å¥ä¸ä¼šå¯¼è‡´æ•°æ®åº“è¿æ¥æ± å†…è¿æ¥åˆå§‹åŒ– ConnectionPool.showConnectionCount(); System.out.println(&quot;----------æ¥ä¸‹æ¥è¦ä»è¿æ¥æ± å–è¿æ¥äº†----------&quot;); IConnection connection = ConnectionPool.getInstance().getConnection(); System.out.println(&quot;----------å¯ä»¥ä½¿ç”¨è¿æ¥è¿›è¡Œæ•°æ®åº“æ“ä½œäº†----------&quot;); // ä½¿ç”¨è¿æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ connection.query(); connection.query(); System.out.println(&quot;----------è¿æ¥ç”¨å®Œäº†ä¹‹åï¼Œè¯¥å½’è¿˜è¿æ¥äº†----------&quot;); connection.close(); } } è¿è¡Œç¨‹åºç»“æœæ‰“å°ï¼šå½“å‰è¿æ¥æ± å¯ç”¨è¿æ¥æ•°ä¸ºï¼š 0â€”â€”â€”-æ¥ä¸‹æ¥è¦ä»è¿æ¥æ± å–è¿æ¥äº†â€”â€”â€”-åˆ›å»ºç¬¬ 1 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 2 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 3 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 4 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 5 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 6 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 7 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 8 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 9 ä¸ªè¿æ¥â€¦åˆ›å»ºç¬¬ 10 ä¸ªè¿æ¥â€¦ è¿æ¥æ± åˆå§‹åŒ–å®Œæˆâ€¦å½“å‰è¿æ¥æ± å¯ç”¨è¿æ¥æ•°ä¸ºï¼š 10 ä»è¿æ¥æ± è·å–ä¸€æ¡è¿æ¥â€¦å½“å‰è¿æ¥æ± å¯ç”¨è¿æ¥æ•°ä¸ºï¼š 9 â€”â€”â€”-å¯ä»¥ä½¿ç”¨è¿æ¥è¿›è¡Œæ•°æ®åº“æ“ä½œäº†â€”â€”â€”-æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥â€¦æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥â€¦ â€”â€”â€”-è¿æ¥ç”¨å®Œäº†ä¹‹åï¼Œè¯¥å½’è¿˜è¿æ¥äº†â€”â€”â€”-å°†è¿æ¥å½’è¿˜ç»™è¿æ¥æ± ã€‚ã€‚ã€‚ å½“å‰è¿æ¥æ± å¯ç”¨è¿æ¥æ•°ä¸ºï¼š 10 å¥½äº†ï¼Œè¿™ä¸‹æˆ‘ä»¬çš„è¿æ¥æ± è¿”å›çš„è¿æ¥å…¨æ˜¯ä»£ç†ï¼Œå°±ç®—ç¨‹åºå‘˜è°ƒç”¨äº†closeæ–¹æ³•ä¹Ÿåªä¼šæŠŠè¿æ¥å½’è¿˜ç»™è¿æ¥æ± äº†ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿æ¥æ± getConnection()æ–¹æ³•ä¸­è¢«æ³¨é‡Šæ‰çš„è¯­å¥ â€œreturn connectionList.remove();â€œ ï¼Œç›´æ¥è¿”å›è¿æ¥å¯¹è±¡ï¼Œé‚£ä¹ˆä»¥ä¸ŠMainClassä¸­è¿æ¥ç”¨å®Œäº†ä¹‹åè¿æ¥æ± ä¸­çš„å¯ç”¨è¿æ¥æ•°å°†å˜ä¸ºï¼š9ï¼Œå³è¿æ¥è¢«çœŸæ­£å…³é—­äº†ã€‚ æˆ‘ä»¬ä½¿ç”¨ä»£ç†æ¨¡å¼è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œä»é™æ€ä»£ç†çš„ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯è¿™ä¹ˆåšçš„ã€‚ ä»£ç†ç±»ä¸€èˆ¬è¦æŒæœ‰ä¸€ä¸ªè¢«ä»£ç†çš„å¯¹è±¡çš„å¼•ç”¨ã€‚ å¯¹äºæˆ‘ä»¬ä¸å…³å¿ƒçš„æ–¹æ³•ï¼Œå…¨éƒ¨å§”æ‰˜ç»™è¢«ä»£ç†çš„å¯¹è±¡å¤„ç†ã€‚ æˆ‘ä»¬åªå¤„ç†æˆ‘ä»¬å…³å¿ƒçš„æ–¹æ³•ã€‚ åº”ç”¨äºŒä»¥ä¸Šç¤ºä¾‹ä½¿ç”¨å•ä¾‹æ¨¡å¼å®ç°äº†ConnectionPoolå¯¹è±¡çš„å»¶è¿ŸåŠ è½½ï¼Œç¤ºä¾‹ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†ä»¥ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥æ„Ÿå—ä¸€ä¸‹ä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°å»¶è¿ŸåŠ è½½çš„æ–¹æ³•åŠå…¶æ„ä¹‰ã€‚ å»¶è¿ŸåŠ è½½(lazy load)(ä¹Ÿç§°ä¸ºæ‡’åŠ è½½)æ˜¯ä¸ºäº†é¿å…ä¸€äº›æ— è°“çš„æ€§èƒ½å¼€é”€è€Œæå‡ºæ¥çš„ï¼Œæ‰€è°“å»¶è¿ŸåŠ è½½å°±æ˜¯å½“åœ¨çœŸæ­£éœ€è¦æ•°æ®çš„æ—¶å€™ï¼Œæ‰å»æ‰§è¡Œæ•°æ®åŠ è½½æ“ä½œã€‚å»¶è¿ŸåŠ è½½çš„å®é™…åº”ç”¨å¾ˆå¤šï¼šæ¯”å¦‚ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ç½‘ç«™ï¼Œæµè§ˆå™¨ä¸€èˆ¬æ€»æ˜¯å…ˆåŠ è½½æ–‡æœ¬ï¼Œå¾…æ–‡æœ¬æ˜¾ç¤ºå‡ºæ¥ä»¥åå†åŠ è½½å›¾ç‰‡ã€è§†é¢‘ç­‰è€—æ—¶è¾ƒå¤šçš„èµ„æºï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ç”¨æˆ·ä¸å¿…éè¦ç­‰åˆ°æ‰€æœ‰ä¸œè¥¿éƒ½ä¸‹è½½å®Œæˆä»¥åæ‰èƒ½çœ‹åˆ°é¡µé¢ï¼Œå¯ä»¥æå¤§åœ°å‡å°‘ç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ï¼›åˆæ¯”å¦‚Windowsæ“ä½œç³»ç»Ÿçš„å¯åŠ¨è¿‡ç¨‹ï¼Œè‹¥æˆ‘ä»¬å°†ç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡é¡¹éƒ½è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯æ¬¡å¯åŠ¨è®¡ç®—æœºéƒ½éœ€è¦ç­‰å¾…éå¸¸é•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å°†ç³»ç»Ÿå¿…é¡»çš„æœåŠ¡å’Œä¸€äº›å¸¸ç”¨æœåŠ¡è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼Œå¯¹äºé‚£äº›ä¸å¸¸ç”¨çš„æœåŠ¡æˆ‘ä»¬åªåœ¨ç”¨åˆ°çš„æ—¶å€™å†å»å¼€å¯ï¼Œè¿™æ ·åšå¯ä»¥å‡å°‘æ¯æ¬¡å¼€æœºæ—¶ç³»ç»Ÿå¯åŠ¨æ‰€éœ€æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦ã€‚ æ¥ä¸‹æ¥è¯¥å¼•å‡ºæˆ‘ä»¬çš„ç¬¬äºŒä¸ªä¾‹å­äº†ï¼š å‡è®¾æŸå®¢æˆ·ç«¯è½¯ä»¶æœ‰æ ¹æ®ç”¨æˆ·è¯·æ±‚å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„åŠŸèƒ½ï¼Œåœ¨æŸ¥è¯¢æ•°æ®å‰ï¼Œéœ€è¦è·å¾—æ•°æ®åº“è¿æ¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è½¯ä»¶å¼€å¯æ—¶å°±å»åˆå§‹åŒ–å¹¶è·å¾—æ•°æ®åº“è¿æ¥ï¼Œä¼šå­˜åœ¨ä»¥ä¸‹å¼Šç«¯ï¼šè½¯ä»¶å¼€å¯æ—¶éœ€åˆå§‹åŒ–ç³»ç»Ÿçš„æ‰€æœ‰ç±»ï¼Œå¦‚æœç³»ç»Ÿè¿˜æœ‰å¤§é‡ç±»ä¼¼èµ„æºè€—è´¹è¾ƒå¤šçš„æ“ä½œ(æ¯”å¦‚ XML è§£æï¼Œæœ¬åœ°æˆ–è¿œç¨‹æ–‡ä»¶èµ„æºåŠ è½½)ä¹Ÿéœ€åœ¨æ­¤æ—¶è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€æœ‰è¿™äº›åˆå§‹åŒ–æ“ä½œçš„å åŠ ä¼šä½¿å¾—ç³»ç»Ÿçš„å¯åŠ¨é€Ÿåº¦å˜å¾—éå¸¸ç¼“æ…¢ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»£ç†æ¨¡å¼çš„ä»£ç†ç±»å¯¹æ•°æ®åº“æŸ¥è¯¢ç±»çš„åˆå§‹åŒ–æ“ä½œè¿›è¡Œå°è£…ï¼Œå½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–è¿™ä¸ªä»£ç†ç±»ï¼Œè€ŒéçœŸå®çš„æ•°æ®åº“æŸ¥è¯¢ç±»ï¼Œç”±äºæ­¤æ—¶ä»£ç†ç±»ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼Œå› æ­¤ï¼Œå®ƒçš„æ„é€ æ˜¯ç›¸å½“è¿…é€Ÿçš„ã€‚åœ¨ç”¨æˆ·çœŸæ­£åšæŸ¥è¯¢æ“ä½œæ—¶å†ç”±ä»£ç†ç±»å•ç‹¬å»åŠ è½½çœŸå®çš„æ•°æ®åº“æŸ¥è¯¢ç±»ï¼Œå®Œæˆç”¨æˆ·çš„è¯·æ±‚ï¼Œè¿™æ ·å°±ä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°äº†å»¶è¿ŸåŠ è½½ã€‚ æºä»£ç å¦‚ä¸‹ï¼š å®šä¹‰ä¸€ä¸ªæ¥å£ IConnection ä½œä¸ºæŠ½è±¡ä¸»é¢˜è§’è‰²ï¼Œè¯¥æ¥å£ç”¨æ¥å®šä¹‰ä»£ç†ç±»å’ŒçœŸå®ä¸»é¢˜ç±»éœ€è¦å¯¹å¤–æä¾›çš„æœåŠ¡ï¼Œæœ¬ä¾‹åªåœ¨å…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªç”¨æ¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢çš„ query()æ–¹æ³•ã€‚ public interface IConnection { void query(); } ImpConnection æ˜¯çœŸå®ä¸»é¢˜è§’è‰²ï¼Œè´Ÿè´£å®é™…çš„ä¸šåŠ¡æ“ä½œã€‚ public class ImpConnection implements IConnection { ImpConnection() { try { for (int i = 0; i &lt; 3; i++) { System.out.println(&quot;ImpConnectionå¯¹è±¡åˆ›å»ºä¸­...&quot;); Thread.sleep(1000);// å‡è®¾æ•°æ®åº“è¿æ¥ç­‰è€—æ—¶æ“ä½œ } System.out.println(&quot;ImpConnectionå¯¹è±¡åˆ›å»ºå®Œæˆ...&quot;); } catch (InterruptedException ex) { ex.printStackTrace(); } } @Override public void query() { System.out.println(&quot;æ‰§è¡Œä¸€æ¬¡æ•°æ®åº“æŸ¥è¯¢æ“ä½œ...&quot;); } } ConnectionProxy æ˜¯ ImpConnection çš„ä»£ç†ç±»ã€‚ public class ConnectionProxy implements IConnection { private ImpConnection connection = null; @Override public void query() { // åœ¨çœŸæ­£éœ€è¦çš„æ—¶å€™æ‰èƒ½åˆ›å»ºçœŸå®å¯¹è±¡ï¼Œåˆ›å»ºè¿‡ç¨‹å¯èƒ½å¾ˆæ…¢ if (connection == null) { connection = new ImpConnection(); } connection.query(); } } åœ¨MainClassä¸­è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æµ‹è¯•ã€‚ public class MainClass { public static void main(String[] args) { IConnection connection = new ConnectionProxy(); // ä½¿ç”¨ä»£ç† connection.query(); // åœ¨çœŸæ­£ä½¿ç”¨æ—¶æ‰åˆ›å»ºçœŸå®ä¸»é¢˜å¯¹è±¡ } } è¿è¡Œç¨‹åºç»“æœæ‰“å°ï¼šImpConnectionå¯¹è±¡åˆ›å»ºä¸­â€¦ImpConnectionå¯¹è±¡åˆ›å»ºä¸­â€¦ImpConnectionå¯¹è±¡åˆ›å»ºä¸­â€¦ImpConnectionå¯¹è±¡åˆ›å»ºå®Œæˆâ€¦æ‰§è¡Œä¸€æ¬¡æ•°æ®åº“æŸ¥è¯¢æ“ä½œâ€¦ å°†MainClassä¸­çš„ â€œconnection.query();â€ ä¸€è¡Œåˆ é™¤ä¹‹åï¼Œå°†å†æ²¡æœ‰ä»»ä½•ç»“æœæ‰“å°åˆ°æ§åˆ¶å°ï¼Œç”±æ­¤è¯æ˜ï¼šè‹¥æ²¡æœ‰å‘ç”Ÿè¯·æ±‚ï¼Œå°†ä¸ä¼šåˆ›å»ºImpConnectionå¯¹è±¡ï¼Œä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°äº†è¢«ä»£ç†å¯¹è±¡å»¶è¿ŸåŠ è½½çš„åŠŸèƒ½ã€‚ ä½¿ç”¨ä»£ç†æ¨¡å¼å®ç°å»¶è¿ŸåŠ è½½çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¦‚æœå½“å‰å¹¶æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªç»„ä»¶ï¼Œåˆ™ä¸éœ€è¦çœŸæ­£åœ°åˆå§‹åŒ–å®ƒï¼Œä½¿ç”¨ä¸€ä¸ªä»£ç†å¯¹è±¡æ›¿ä»£å®ƒçš„åŸæœ‰çš„ä½ç½®ï¼Œåªåœ¨çœŸæ­£éœ€è¦çš„æ—¶å€™æ‰å¯¹å®ƒè¿›è¡ŒåŠ è½½ã€‚ä½¿ç”¨ä»£ç†æ¨¡å¼çš„å»¶è¿ŸåŠ è½½æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œé¦–å…ˆï¼Œå®ƒå¯ä»¥åœ¨æ—¶é—´è½´ä¸Šåˆ†æ•£ç³»ç»Ÿå‹åŠ›ï¼Œå°¤å…¶åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œä¸å¿…å®Œæˆæ‰€æœ‰çš„åˆå§‹åŒ–å·¥ä½œï¼Œä»è€ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦ï¼›å…¶æ¬¡ï¼Œå¯¹å¾ˆå¤šçœŸå®ä¸»é¢˜è€Œè¨€ï¼Œåœ¨è½¯ä»¶å¯åŠ¨ç›´åˆ°è¢«å…³é—­çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æ ¹æœ¬ä¸ä¼šè¢«è°ƒç”¨ï¼Œåˆå§‹åŒ–è¿™äº›æ•°æ®æ— ç–‘æ˜¯ä¸€ç§èµ„æºæµªè´¹ã€‚ä¾‹å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œè‹¥ç³»ç»Ÿä¸ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œåˆ™åœ¨å¯åŠ¨æ—¶å°±è¦åˆå§‹åŒ– ImpConnection å¯¹è±¡ï¼Œè€Œä½¿ç”¨ä»£ç†æ¨¡å¼åï¼Œå¯åŠ¨æ—¶åªéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªè½»é‡çº§çš„ ConnectionProxyå¯¹è±¡ã€‚ å››ã€ä»£ç†æ¨¡å¼çš„åº”ç”¨åœºæ™¯ä»£ç†æ¨¡å¼ä¸»è¦åº”ç”¨äºä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š è¿œç¨‹ä»£ç†ï¼Œä¹Ÿå°±æ˜¯ä¸ºä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçš„åœ°å€ç©ºé—´æä¾›å±€éƒ¨ä»£è¡¨ï¼Œè¿™æ ·å¯ä»¥éšè—ä¸€ä¸ªå¯¹è±¡å­˜åœ¨äºä¸åŒåœ°å€ç©ºé—´çš„äº‹å®ã€‚æ¯”å¦‚è¯´ WebServiceï¼Œå½“æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºçš„é¡¹ç›®ä¸­åŠ å…¥ä¸€ä¸ª Web å¼•ç”¨ï¼Œå¼•ç”¨ä¸€ä¸ª WebServiceï¼Œæ­¤æ—¶ä¼šåœ¨é¡¹ç›®ä¸­å£°ç§°ä¸€ä¸ª WebReference çš„æ–‡ä»¶å¤¹å’Œä¸€äº›æ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯èµ·ä»£ç†ä½œç”¨çš„ï¼Œè¿™æ ·å¯ä»¥è®©é‚£ä¸ªå®¢æˆ·ç«¯ç¨‹åºè°ƒç”¨ä»£ç†è§£å†³è¿œç¨‹è®¿é—®çš„é—®é¢˜ï¼› è™šæ‹Ÿä»£ç†ï¼Œæ˜¯æ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œé€šè¿‡å®ƒæ¥å­˜æ”¾å®ä¾‹åŒ–éœ€è¦å¾ˆé•¿æ—¶é—´çš„çœŸå®å¯¹è±¡ã€‚è¿™æ ·å°±å¯ä»¥è¾¾åˆ°æ€§èƒ½çš„æœ€ä¼˜åŒ–ï¼Œæ¯”å¦‚æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µé‡Œé¢åŒ…å«äº†å¤§é‡çš„æ–‡å­—å’Œå›¾ç‰‡ï¼Œä½†æˆ‘ä»¬å¯ä»¥å¾ˆå¿«çœ‹åˆ°æ–‡å­—ï¼Œä½†æ˜¯å›¾ç‰‡å´æ˜¯ä¸€å¼ ä¸€å¼ åœ°ä¸‹è½½åæ‰èƒ½çœ‹åˆ°ï¼Œé‚£äº›æœªæ‰“å¼€çš„å›¾ç‰‡æ¡†ï¼Œå°±æ˜¯é€šè¿‡è™šæ‹Ÿä»£ç†æ¥æ›¿æ¢äº†çœŸå®çš„å›¾ç‰‡ï¼Œæ­¤æ—¶ä»£ç†å­˜å‚¨äº†çœŸå®å›¾ç‰‡çš„è·¯å¾„å’Œå°ºå¯¸ï¼› å®‰å…¨ä»£ç†ï¼Œç”¨æ¥æ§åˆ¶çœŸå®å¯¹è±¡è®¿é—®æ—¶çš„æƒé™ã€‚ä¸€èˆ¬ç”¨äºå¯¹è±¡åº”è¯¥æœ‰ä¸åŒçš„è®¿é—®æƒé™çš„æ—¶å€™ï¼› æŒ‡é’ˆå¼•ç”¨ï¼Œæ˜¯æŒ‡å½“è°ƒç”¨çœŸå®å¯¹è±¡æ—¶ï¼Œä»£ç†å¤„ç†å¦å¤–ä¸€äº›äº‹ã€‚æ¯”å¦‚è®¡ç®—çœŸå®å¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼Œè¿™æ ·å½“è¯¥å¯¹è±¡æ²¡æœ‰å¼•ç”¨æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é‡Šæ”¾å®ƒï¼Œæˆ–å½“ç¬¬ä¸€æ¬¡å¼•ç”¨ä¸€ä¸ªæŒä¹…å¯¹è±¡æ—¶ï¼Œå°†å®ƒè£…å…¥å†…å­˜ï¼Œæˆ–æ˜¯åœ¨è®¿é—®ä¸€ä¸ªå®é™…å¯¹è±¡å‰ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»é‡Šæ”¾å®ƒï¼Œä»¥ç¡®ä¿å…¶ä»–å¯¹è±¡ä¸èƒ½æ”¹å˜å®ƒã€‚è¿™äº›éƒ½æ˜¯é€šè¿‡ä»£ç†åœ¨è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶é™„åŠ ä¸€äº›äº‹åŠ¡å¤„ç†ï¼› å»¶è¿ŸåŠ è½½ï¼Œç”¨ä»£ç†æ¨¡å¼å®ç°å»¶è¿ŸåŠ è½½çš„ä¸€ä¸ªç»å…¸åº”ç”¨å°±åœ¨ Hibernate æ¡†æ¶é‡Œé¢ã€‚å½“ Hibernate åŠ è½½å®ä½“ bean æ—¶ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§å°†æ•°æ®åº“æ‰€æœ‰çš„æ•°æ®éƒ½è£…è½½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šé‡‡å–å»¶è¿ŸåŠ è½½çš„æœºåˆ¶ï¼Œä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚Hibernate ä¸­çš„å»¶è¿ŸåŠ è½½ä¸»è¦åˆ†ä¸ºå±æ€§çš„å»¶è¿ŸåŠ è½½å’Œå…³è”è¡¨çš„å»¶æ—¶åŠ è½½ä¸¤ç±»ã€‚å®ç°åŸç†æ˜¯ä½¿ç”¨ä»£ç†æ‹¦æˆªåŸæœ‰çš„ getter æ–¹æ³•ï¼Œåœ¨çœŸæ­£ä½¿ç”¨å¯¹è±¡æ•°æ®æ—¶æ‰å»æ•°æ®åº“æˆ–è€…å…¶ä»–ç¬¬ä¸‰æ–¹ç»„ä»¶åŠ è½½å®é™…çš„æ•°æ®ï¼Œä»è€Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚ PSï¼šæ­¤å¤–è¿˜æœ‰é˜²ç«å¢™ä»£ç†ï¼Œæ™ºèƒ½å¼•ç”¨ä»£ç†ï¼Œç¼“å­˜ä»£ç†ï¼ŒåŒæ­¥ä»£ç†ï¼Œå¤æ‚éšè—ä»£ç†ï¼Œå†™å…¥æ—¶å¤åˆ¶ä»£ç†ç­‰ç­‰ï¼Œéƒ½æœ‰å„è‡ªç‰¹æ®Šçš„ç”¨é€”ã€‚ äº”ã€é™æ€ä»£ç†æ¨¡å¼çš„ç‰¹ç‚¹é™æ€ä»£ç†çš„ä¼˜ç‚¹ï¼š è¢«ä»£ç†å¯¹è±¡åªè¦å’Œä»£ç†ç±»å®ç°äº†åŒä¸€æ¥å£å³å¯ï¼Œä»£ç†ç±»æ— é¡»çŸ¥é“è¢«ä»£ç†å¯¹è±¡å…·ä½“æ˜¯ä»€ä¹ˆç±»ã€æ€ä¹ˆåšçš„ï¼Œè€Œå®¢æˆ·ç«¯åªéœ€çŸ¥é“ä»£ç†å³å¯ï¼Œå®ç°äº†ç±»ä¹‹é—´çš„è§£è€¦åˆã€‚ é™æ€ä»£ç†çš„ç¼ºç‚¹ï¼š ä»£ç†ç±»å’Œè¢«ä»£ç†ç±»å®ç°äº†ç›¸åŒçš„æ¥å£ï¼Œä»£ç†ç±»é€šè¿‡è¢«ä»£ç†ç±»å®ç°äº†ç›¸åŒçš„æ–¹æ³•ï¼Œè¿™æ ·å°±å‡ºç°äº†å¤§é‡çš„ä»£ç é‡å¤ã€‚å¦‚æœæ¥å£å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†æ‰€æœ‰å®ç°ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•å¤–ï¼Œæ‰€æœ‰ä»£ç†ç±»ä¹Ÿéœ€è¦å®ç°æ­¤æ–¹æ³•ï¼Œå¢åŠ äº†ä»£ç ç»´æŠ¤çš„å¤æ‚åº¦ã€‚ æ¯ä¸ªä»£ç†ç±»åªèƒ½ä¸ºä¸€ä¸ªæ¥å£æœåŠ¡ï¼Œå¦‚æœç¨‹åºå¼€å‘ä¸­è¦ä½¿ç”¨ä»£ç†çš„æ¥å£å¾ˆå¤šçš„è¯ï¼Œå¿…ç„¶ä¼šäº§ç”Ÿè®¸å¤šçš„ä»£ç†ç±»ï¼Œé€ æˆç±»è†¨èƒ€ã€‚ å‚è€ƒæ–‡ç« http://http//www.lxway.com/4445954962.htm https://blog.csdn.net/lovelion/article/details/8116704 https://www.ibm.com/developerworks/cn/java/j-lo-proxy-pattern/","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"ä»£ç†æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼,é™æ€","slug":"ä»£ç†æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼-é™æ€","permalink":"/tags/ä»£ç†æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼-é™æ€/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--è§‚å¯Ÿè€…æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--è§‚å¯Ÿè€…æ¨¡å¼","date":"2020-05-24T08:43:06.000Z","updated":"2023-04-30T10:21:41.361Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è§‚å¯Ÿè€…æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è§‚å¯Ÿè€…æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ è§‚å¯Ÿè€…(Observer)æ¨¡å¼æ˜¯è¡Œä¸ºæ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒçš„ä½œç”¨æ˜¯å½“ä¸€ä¸ªè¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œèƒ½å¤Ÿè‡ªåŠ¨é€šçŸ¥ç›¸å…³çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œè‡ªåŠ¨æ›´æ–°è§‚å¯Ÿè€…å¯¹è±¡ä¸­è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€ã€‚å®ƒæä¾›ç»™å…³è”å¯¹è±¡ä¸€ç§åŒæ­¥é€šä¿¡çš„æ‰‹æ®µï¼Œä½¿æŸä¸ªå¯¹è±¡ä¸ä¾èµ–å®ƒçš„å…¶ä»–å¯¹è±¡ä¹‹é—´ä¿æŒçŠ¶æ€åŒæ­¥ã€‚ äºŒã€è§‚å¯Ÿè€…æ¨¡å¼çš„å…¸å‹åº”ç”¨è§‚å¯Ÿè€…(Observer)æ¨¡å¼å¤šè¢«åº”ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š ä¾¦å¬äº‹ä»¶é©±åŠ¨ç¨‹åºè®¾è®¡ä¸­çš„å¤–éƒ¨äº‹ä»¶ ä¾¦å¬/ç›‘è§†æŸä¸ªå¯¹è±¡çš„çŠ¶æ€å˜åŒ– å‘å¸ƒè€…/è®¢é˜…è€…(publisher/subscriber)æ¨¡å‹ä¸­ï¼Œå½“ä¸€ä¸ªå¤–éƒ¨äº‹ä»¶ï¼ˆæ–°çš„äº§å“ï¼Œæ¶ˆæ¯çš„å‡ºç°ç­‰ç­‰ï¼‰è¢«è§¦å‘æ—¶ï¼Œé€šçŸ¥é‚®ä»¶åˆ—è¡¨ä¸­çš„è®¢é˜…è€… ä¸‰ã€è§‚å¯Ÿè€…æ¨¡å¼çš„ç»“æ„ è§‚å¯Ÿè€…æ¨¡å¼ä¸­çš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼ˆSubjectï¼‰è§’è‰² è¢«è§‚å¯Ÿå¯¹è±¡çš„æŠ½è±¡ç±»ï¼Œä¸ºæ‰€æœ‰å…·ä½“è¢«è§‚å¯Ÿè€…è§’è‰²æä¾›äº†ä¸€ä¸ªç»Ÿä¸€æ¥å£ï¼Œä¸»è¦åŒ…æ‹¬æ·»åŠ ã€åˆ é™¤ã€é€šçŸ¥è§‚å¯Ÿè€…å¯¹è±¡æ–¹æ³•ï¼Œå…¶å†…åŒ…å«ä¸€ä¸ªç”¨ä»¥å‚¨å­˜æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡çš„å®¹å™¨ï¼ˆCollectionï¼‰ï¼Œå½“è¢«è§‚å¯Ÿè€…çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦é€šçŸ¥å®¹å™¨ä¸­æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¹¶ç»´æŠ¤ï¼ˆæ·»åŠ ï¼Œåˆ é™¤ï¼Œé€šçŸ¥ï¼‰è§‚å¯Ÿè€…å¯¹è±¡åˆ—è¡¨ã€‚ å…·ä½“è¢«è§‚å¯Ÿè€…ï¼ˆConcreteSubjectï¼‰è§’è‰² è¢«è§‚å¯Ÿè€…çš„å…·ä½“å®ç°ï¼ŒåŒ…å«ä¸€äº›åŸºæœ¬çš„å±æ€§çŠ¶æ€åŠå…¶ä»–æ“ä½œï¼Œå½“å…·ä½“è¢«è§‚å¯Ÿè€…çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šç»™æ³¨å†Œçš„æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡å‘é€é€šçŸ¥ï¼Œä»¥æç¤ºè§‚å¯Ÿè€…å¯¹è±¡ä»¬å¯¹å…¶å†…è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚ æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰è§’è‰² è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡è§’è‰²ï¼Œé€šå¸¸è¢«å®šä¹‰ä¸ºæ¥å£ï¼Œä¸ºæ‰€æœ‰çš„å…·ä½“è§‚å¯Ÿè€…å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå½“æ”¶åˆ°è¢«è§‚å¯Ÿå¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±ã€‚ å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcreteObserverï¼‰è§’è‰² è§‚å¯Ÿè€…çš„å…·ä½“å®ç°ï¼Œå¾—åˆ°é€šçŸ¥åå°†å¯¹å†…éƒ¨è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œå¹¶å®Œæˆä¸€äº›å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼š æŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼ˆSubjectï¼‰è§’è‰² public abstract class Subject { //ç”¨æ¥ä¿å­˜æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€… private List&lt;Observer&gt; observers=new ArrayList&lt;Observer&gt;(); //æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€… public void registerObserver(Observer observer){ this.observers.add(observer); } //åˆ é™¤ä¸€ä¸ªè§‚å¯Ÿè€… public void unregisterObserver(Observer observer){ this.observers.remove(observer); } //é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…è¿›è¡ŒçŠ¶æ€æ›´æ–° public void notifyObservers(Subject subject){ for(Observer o:observers){ o.update(subject); } } } å…·ä½“è¢«è§‚å¯Ÿè€…ï¼ˆConcreteSubjectï¼‰è§’è‰² public class ConcreteSubject extends Subject { //å…·ä½“è¢«è§‚å¯Ÿè€…ç±»å¯ä»¥å…·æœ‰è‡ªå·±çš„å±æ€§æˆ–çŠ¶æ€ private String state; public String getState() { return state; } public void setState(String newState){ this.state = newState; System.out.println(&quot;è¢«è§‚å¯Ÿè€…è‡ªèº«çŠ¶æ€æ›´æ–°ä¸ºï¼š&quot; + this.state); //çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€… this.notifyObservers(this); } } æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰è§’è‰² public interface Observer{ //æ›´æ–°è§‚å¯Ÿè€…çš„çŠ¶æ€ public void update(Subject subject); } å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcreteObserverï¼‰è§’è‰² public class ConcreteObserverA implements Observer { private ConcreteSubject subject; public ConcreteSubject getSubject() { return subject; } public void setSubject(ConcreteSubject subject) { this.subject = subject; } @Override public void update(Subject subject) { this.subject=(ConcreteSubject)subject; System.out.println(&quot;è§‚å¯Ÿè€…Aä¸­è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€æ›´æ–°ä¸ºï¼š&quot;+this.subject.getState()); } } public class ConcreteObserverB implements Observer { private ConcreteSubject subject; public ConcreteSubject getSubject() { return subject; } public void setSubject(ConcreteSubject subject) { this.subject = subject; } @Override public void update(Subject subject) { this.subject=(ConcreteSubject)subject; System.out.println(&quot;è§‚å¯Ÿè€…Bä¸­è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€æ›´æ–°ä¸ºï¼š&quot;+this.subject.getState()); } } ç¼–å†™ä¸€ä¸ªMainClassç±»æ¥æµ‹è¯•ä¸€ç•ªã€‚ public class MainClass { public static void main(String[] args) { //åˆ›å»ºè¢«è§‚å¯Ÿè€…å¯¹è±¡ ConcreteSubject subject=new ConcreteSubject(); //åˆ›å»ºè§‚å¯Ÿè€…å¯¹è±¡ ConcreteObserverA observerA=new ConcreteObserverA(); ConcreteObserverB observerB=new ConcreteObserverB(); //ä¸ºè¢«è§‚å¯Ÿè€…å¯¹è±¡æ³¨å†Œè§‚å¯Ÿè€… subject.registerObserver(observerA); subject.registerObserver(observerB); subject.setState(&quot;å¤æ´»ä¸­...&quot;); System.out.println(); System.out.println(&quot;----------ä¸€åƒå¹´ä»¥å...----------&quot;); System.out.println(); subject.setState(&quot;ç–¯ç‹‚æ€æˆ®ä¸­...&quot;); } } è¿è¡ŒMainClassæ‰“å°ç»“æœå¦‚ä¸‹ï¼š è¢«è§‚å¯Ÿè€…è‡ªèº«çŠ¶æ€æ›´æ–°ä¸ºï¼šå¤æ´»ä¸­â€¦è§‚å¯Ÿè€…Aä¸­è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€æ›´æ–°ä¸ºï¼šå¤æ´»ä¸­â€¦è§‚å¯Ÿè€…Bä¸­è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€æ›´æ–°ä¸ºï¼šå¤æ´»ä¸­â€¦â€”â€”â€”-ä¸€åƒå¹´ä»¥åâ€¦â€”â€”â€”-è¢«è§‚å¯Ÿè€…è‡ªèº«çŠ¶æ€æ›´æ–°ä¸ºï¼šç–¯ç‹‚æ€æˆ®ä¸­â€¦è§‚å¯Ÿè€…Aä¸­è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€æ›´æ–°ä¸ºï¼šç–¯ç‹‚æ€æˆ®ä¸­â€¦è§‚å¯Ÿè€…Bä¸­è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€æ›´æ–°ä¸ºï¼šç–¯ç‹‚æ€æˆ®ä¸­â€¦ å››ã€Javaå¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„æ”¯æŒåœ¨JAVAè¯­è¨€çš„java.utilåº“é‡Œé¢æœ‰ä¸€ä¸ªObservableç±»å’Œä¸€ä¸ªObserveræ¥å£ï¼Œé€šè¿‡ä¸¤è€…é…åˆä½¿ç”¨å¯ä»¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼ã€‚ Observableç±»ï¼š Observableä¸­æ–‡æ„æ€â€œå¯ä»¥è¢«è§‚å¯Ÿçš„â€ï¼Œå³Observableç±»æ˜¯å¯ä»¥è¢«è§‚å¯Ÿçš„ï¼Œæƒ³è¦å®ç°è§‚å¯Ÿè€…æ¨¡å¼åªéœ€å°†ä½ æƒ³è¦è¢«è§‚å¯Ÿçš„ç±»ç»§æ‰¿è‡ªObservableç±»å³å¯ã€‚ ä¸€ä¸ª Observableå¯¹è±¡å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè§‚å¯Ÿè€…ï¼Œè§‚å¯Ÿè€…å¯ä»¥æ˜¯å®ç°äº†Observeræ¥å£çš„ä»»æ„å¯¹è±¡ã€‚ä¸€ä¸ªObservableå¯¹è±¡çŠ¶æ€æ”¹å˜å,ä¼šè°ƒç”¨notifyObservers()æ–¹æ³•æ¥é€šçŸ¥è§‚å¯Ÿè€…ã€‚ ä»¥ä¸‹æ˜¯Observableç±»æä¾›çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼š public void addObserver(Observer o) //å‘è§‚å¯Ÿè€…é›†åˆä¸­æ·»åŠ è§‚å¯Ÿè€… public void deleteObserver(Observer o) //ä»è§‚å¯Ÿè€…é›†åˆä¸­åˆ é™¤æŸä¸€ä¸ªè§‚å¯Ÿè€… public void notifyObservers(Object arg) //å¦‚æœhasChangedæ–¹æ³•æŒ‡ç¤ºå¯¹è±¡å·²æ”¹å˜ï¼Œåˆ™é€šçŸ¥å…¶æ‰€æœ‰è§‚å¯Ÿè€…ï¼Œå¹¶è°ƒç”¨ clearChanged æ–¹æ³•æ¥æ¸…é™¤å¯¹è±¡çš„å·²æ”¹å˜æ ‡è®°ã€‚æ­¤æ–¹æ³•å¯ä¸å¸¦å‚æ•°ï¼Œä»…å°†Observableå¯¹è±¡ä¼ é€’ç»™update()æ–¹æ³•ï¼Œæ­¤æ—¶updateæ–¹æ³•ä¸­argå‚æ•°ä¸ºNullã€‚ public void deleteObservers() //æ¸…é™¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œä½¿æ­¤å¯¹è±¡ä¸å†æœ‰ä»»ä½•è§‚å¯Ÿè€… protected void setChanged() //æ ‡è®°Observableå¯¹è±¡å·²ç»æ”¹å˜ protected void clearChanged() //æ¸…é™¤Observableå¯¹è±¡å·²æ”¹å˜æ ‡è®° public boolean hasChanged() //æµ‹è¯•å¯¹è±¡æ˜¯å¦æ”¹å˜ public int countObservers() //è¿”å›Observableå¯¹è±¡çš„è§‚å¯Ÿè€…æ•°ç›® Observeræ¥å£ï¼š Observeræ¥å£åªåŒ…å«ä¸€ä¸ªupdate()æ–¹æ³•,è¯¥æ–¹æ³•ä»…æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç»§æ‰¿è‡ªObservableç±»çš„è¢«è§‚å¯Ÿå¯¹è±¡å’Œä¼ é€’ç»™notifyObservers() æ–¹æ³•çš„å‚æ•°ã€‚å½“Observable(è¢«è§‚å¯Ÿè€…)å¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶å°†é€šè¿‡notifyObservers()æ–¹æ³•å‘æ‰€æœ‰çš„Observer(è§‚å¯Ÿè€…)å‘é€æ›´æ–°é€šçŸ¥ï¼ŒObserver(è§‚å¯Ÿè€…)å¯¹è±¡åœ¨æ”¶åˆ°é€šçŸ¥åå³è°ƒç”¨æ­¤æ–¹æ³•å®ŒæˆçŠ¶æ€æ›´æ–°ã€‚ void update(Observable o, Object arg) æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Observableç±»å’ŒObserveræ¥å£å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå»å¹´2015å¹´æ˜¯ç‰›å¸‚ï¼Œç‚’è‚¡çš„åŸºæœ¬éƒ½å‘å®¶äº†ï¼Œåœ¨æ­¤æˆ‘ä»¬ä»¥ç‚’è‚¡ä¸ºä¾‹ã€‚ åœ¨ç‚’è‚¡è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸ç”¨æˆ‘è¯´ï¼Œç›¸ä¿¡ä½ ä¹Ÿæƒ³çš„åˆ°ï¼šè‚¡ç¥¨Stockå°±æ˜¯æˆ‘ä»¬çš„è¢«è§‚å¯Ÿè€…ã€‚ import java.util.Observable; public class Stock extends Observable{ //ä¸ºè‚¡ç¥¨çš„çŠ¶æ€åˆ›å»ºä¸€ä¸ªæšä¸¾ç±»ï¼šRISE æ¶¨,FALL è·Œ public enum StockState{ RISE,FALL } //è‚¡ç¥¨æ¶¨è·ŒçŠ¶æ€ private StockState state; //è‚¡ç¥¨çš„ä»·æ ¼ private double price; //è‚¡ç¥¨çš„å†å²æœ€ä½ä»·æ ¼ private double LowestPrice; //è‚¡ç¥¨æ— å‚çš„æ„é€ æ–¹æ³• public Stock(){ } //è‚¡ç¥¨çš„å¸¦å‚æ•°æ„é€ æ–¹æ³• public Stock(StockState state, double price, double lowestPrice) { super(); this.state = state; this.price = price; LowestPrice = lowestPrice; } public StockState getState() { return state; } private void setState(StockState state) { this.state = state; } public double getPrice() { return price; } public void setPrice(double price) { if(price&lt;this.price){ setState(StockState.FALL); } else{ setState(StockState.RISE); } if(price&lt;this.LowestPrice){ setLowestPrice(price); } this.price = price; //æ›´æ–°è‚¡ç¥¨çŠ¶æ€æ ‡è®°ä¸ºå·²æ”¹å˜ this.setChanged(); //é€šçŸ¥è§‚å¯Ÿè€… notifyObservers(); } public double getLowestPrice() { return LowestPrice; } private void setLowestPrice(double lowestPrice) { LowestPrice = lowestPrice; } } æˆ‘ä»¬è¿™äº›åªæœ‰éŸ­èœå‘½çš„è‚¡æ°‘è‡ªç„¶å°±æ˜¯è§‚å¯Ÿè€…äº†ã€‚ import java.util.Observable; import java.util.Observer; import com.ibeifeng.news.Stock.StockState; public class Investor implements Observer { public void update(Observable o, Object arg) { Stock stock=(Stock)o; if(stock.getPrice()==stock.getLowestPrice()) { System.out.println(&quot;è‚¡ç¥¨å·²ç»è·Œåˆ°å†å²æœ€ä½äº†ï¼Œæˆ‘å¾—èµ¶ç´§æŠ„åº•...&quot;); } else{ if(stock.getState().equals(StockState.RISE)){ System.out.println(&quot;è‚¡ç¥¨åœ¨æ¶¨ï¼Œç›®å‰ä»·æ ¼ï¼š&quot;+stock.getPrice()); } else{ System.out.println(&quot;è‚¡ç¥¨åœ¨è·Œï¼Œç›®å‰ä»·æ ¼ï¼š&quot;+stock.getPrice()); } } } } åœ¨å®¢æˆ·ç«¯é‡Œé¢æµ‹è¯•ä¸€ä¸‹ã€‚ public class Client{ public static void main(String[] args) { Stock stock=new Stock(StockState.FALL,14.7D,13.2D); stock.addObserver(new Investor()); stock.setPrice(13.7); stock.setPrice(12.6); stock.setPrice(14.0); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š è‚¡ç¥¨åœ¨è·Œï¼Œç›®å‰ä»·æ ¼ï¼š13.7è‚¡ç¥¨å·²ç»è·Œåˆ°å†å²æœ€ä½äº†ï¼Œæˆ‘å¾—èµ¶ç´§æŠ„åº•â€¦è‚¡ç¥¨åœ¨æ¶¨ï¼Œç›®å‰ä»·æ ¼ï¼š14.0 äº”ã€è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç‚¹è§‚å¯Ÿè€…Observeræ¨¡å¼è§£å†³äº†å¯¹è±¡ä¹‹é—´ä¸€å¯¹å¤šçš„å¤æ‚ä¾èµ–å…³ç³»é—®é¢˜ï¼Œå¤§å¤§åœ°æé«˜äº†ç¨‹åºçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¹Ÿå¾ˆå¥½çš„ç¬¦åˆäº†å¼€æ”¾-å°é—­åŸåˆ™ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"è§‚å¯Ÿè€…æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"è§‚å¯Ÿè€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/è§‚å¯Ÿè€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--ç­–ç•¥æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--ç­–ç•¥æ¨¡å¼","date":"2020-05-24T08:41:38.000Z","updated":"2023-04-30T10:21:41.359Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ç­–ç•¥æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ç­–ç•¥æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ç­–ç•¥ï¼ˆStrategyï¼‰æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—çš„ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸€ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œè€Œä¸”ä½¿å®ƒä»¬è¿˜å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œç‹¬ç«‹å˜åŒ–ã€‚ï¼ˆåŸæ–‡ï¼šThe Strategy Pattern defines a family of algorithms,encapsulates each one,and makes them interchangeable. Strategy lets the algorithm vary independently from clients that use it.ï¼‰ äºŒã€ç­–ç•¥æ¨¡å¼çš„ç»“æ„ åœ¨ç­–ç•¥æ¨¡å¼ä¸­çš„è§’è‰²æœ‰ï¼š æŠ½è±¡ç­–ç•¥(Strategy)è§’è‰²:è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡è§’è‰²ï¼Œé€šå¸¸ç”±ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»å®ç°,ç”¨ä»¥å£°æ˜æ‰€æœ‰å…·ä½“ç­–ç•¥ç±»è¦å®ç°çš„æ–¹æ³•ã€‚ å…·ä½“ç­–ç•¥(ConcreteStrategy)è§’è‰²:å„ç§ç­–ç•¥ï¼ˆç®—æ³•ï¼‰çš„å…·ä½“å®ç°ã€‚ ç¯å¢ƒ(Context)è§’è‰²:ç­–ç•¥çš„å¤–éƒ¨å°è£…ç±»ï¼Œæˆ–è€…è¯´ç­–ç•¥çš„å®¹å™¨ç±»ï¼Œå®ƒæŒæœ‰ä¸€ä¸ªStrategyçš„å¼•ç”¨ï¼ŒStrategyç­–ç•¥ç”±å®¢æˆ·ç«¯å†³å®šï¼Œä¸åŒStrategyç­–ç•¥å¯ä»¥æ‰§è¡Œä¸åŒçš„è¡Œä¸ºã€‚ ç­–ç•¥æ¨¡å¼ç»“æ„ç¤ºæ„æºä»£ç å¦‚ä¸‹ï¼š æŠ½è±¡ç­–ç•¥(Strategy)è§’è‰² public interface Strategy { // æŠ½è±¡ç­–ç•¥è§’è‰² public void strategyInterface(); } å…·ä½“ç­–ç•¥(ConcreteStrategy)è§’è‰² public class ConcreteStrategyA implements Strategy { // å…·ä½“ç­–ç•¥è§’è‰² @Override public void strategyInterface() { // ç›¸å…³çš„ä¸šåŠ¡ } } public class ConcreteStrategyB implements Strategy { // å…·ä½“ç­–ç•¥è§’è‰² @Override public void strategyInterface() { // ç›¸å…³çš„ä¸šåŠ¡ } } public class ConcreteStrategyC implements Strategy { // å…·ä½“ç­–ç•¥è§’è‰² @Override public void strategyInterface() { // ç›¸å…³çš„ä¸šåŠ¡ } } ç¯å¢ƒ(Context)è§’è‰² public class Context { // æŒæœ‰ä¸€ä¸ªå…·ä½“ç­–ç•¥çš„å¯¹è±¡ private Strategy strategy; public Context(Strategy strategy) { this.strategy = strategy; } // ç¯å¢ƒè§’è‰²ç­–ç•¥æ–¹æ³• public void contextInterface() { strategy.strategyInterface(); } } ä»ç­–ç•¥æ¨¡å¼ä¸­ç¯å¢ƒ(Context)è§’è‰²çš„åŠŸèƒ½å¯ä»¥çœ‹å‡ºï¼Œç­–ç•¥æ¨¡å¼çš„é‡å¿ƒä¸æ˜¯å¦‚ä½•å®ç°ç®—æ³•ï¼Œè€Œæ˜¯å¦‚ä½•ç»„ç»‡ã€è°ƒç”¨è¿™äº›ç®—æ³•ï¼Œä»è€Œè®©ç¨‹åºç»“æ„æ›´çµæ´»ï¼Œå…·æœ‰æ›´å¥½çš„ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œå®ƒä½“ç°äº†é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­ä¸¤ä¸ªéå¸¸é‡è¦çš„åŸåˆ™ï¼š å°è£…å˜åŒ– æŠŠä¸€ä¸ªç±»ä¸­ç»å¸¸æ”¹å˜æˆ–è€…å°†æ¥å¯èƒ½æ”¹å˜çš„éƒ¨åˆ†æå–å‡ºæ¥ï¼Œä½œä¸ºä¸€ä¸ªæ¥å£ï¼ˆä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼‰ï¼Œç„¶ååœ¨ç±»ä¸­åŒ…å«å®ç°äº†è¿™ä¸ªæ¥å£çš„å®ä¾‹ï¼Œè¿™æ ·è¿™ä¸ªç±»å°±å¯ä»¥é€šè¿‡å…¶å†…åŒ…å«çš„å®ä¾‹æ¥å®ç°æ¥å£çš„è¡Œä¸ºã€‚ ä¾èµ–å€’è½¬(Dependence Inversion Principle ) ç¼–ç¨‹ä¸­æ›´å¤šåœ°ä½¿ç”¨æŠ½è±¡ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°ã€‚ ä¸‰ã€ç­–ç•¥æ¨¡å¼åº”ç”¨åœºæ™¯è¶…å¸‚å‡ºå”®å•†å“çš„æŠ˜æ‰£æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„é—®é¢˜ï¼Œå¯¹äºä¸åŒç±»å‹çš„é¡¾å®¢ä¼šæœ‰ä¸åŒçš„æŠ˜æ‰£ï¼Œåœ¨ä¸åŒçš„æ—¶é—´è´­ä¹°å•†å“ä¹Ÿæœ‰å¯èƒ½æŠ˜æ‰£ä¸åŒï¼Œæˆ‘ä»¬å‡è®¾è¶…å¸‚çš„æŠ˜æ‰£æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š å¯¹æ™®é€šé¡¾å®¢ï¼Œæ²¡æœ‰æŠ˜æ‰£ã€‚ å¯¹æ™®é€šä¼šå‘˜ï¼Œæ‰€æœ‰å•†å“9.5æŠ˜ã€‚ å¯¹VIPä¼šå‘˜ï¼Œæ‰€æœ‰å•†å“9.0æŠ˜ã€‚ ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¨¡æ‹Ÿä»¥ä¸ŠæŠ˜æ‰£çš„ç®—æ³•ï¼š æŠ½è±¡ç­–ç•¥ï¼ˆStrategyï¼‰è§’è‰² public interface DiscountStrategy { /** * è®¡ç®—æ‰“æŠ˜åçš„ä»·æ ¼ * * @param num * å•†å“åŸä»· * @return æŠ˜åä»·æ ¼ */ public double calcPrice(double num); } å®ç°DiscountStrategyï¼ˆæŠ˜æ‰£ç­–ç•¥ï¼‰æ¥å£çš„å…·ä½“ç­–ç•¥è§’è‰²ã€‚ æ™®é€šé¡¾å®¢ç­–ç•¥ç±» public class CommonCustomerStrategy implements DiscountStrategy { @Override public double calcPrice(double num) { // æ™®é€šä¼šå‘˜æ²¡æœ‰æŠ˜æ‰£ return num; } } æ™®é€šä¼šå‘˜ç­–ç•¥ç±» public class CommonMemberStrategy implements DiscountStrategy { @Override public double calcPrice(double num) { // æ™®é€šä¼šå‘˜9.5æŠ˜ return num * 0.95; } } VIPä¼šå‘˜ç­–ç•¥ç±» public class VipMemberStrategy implements DiscountStrategy { @Override public double calcPrice(double num) { // æ™®é€šä¼šå‘˜9.0æŠ˜ return num * 0.9; } } ç¯å¢ƒè§’è‰²ç±» public class Price { // æŒæœ‰ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥å¯¹è±¡ private DiscountStrategy strategy; // æ„é€ æ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥å¯¹è±¡ public Price(DiscountStrategy strategy) { this.strategy = strategy; } public double calcPrice(double num) { // è°ƒç”¨å†…éƒ¨åŒ…å«çš„ç­–ç•¥å¯¹è±¡æ–¹æ³•è®¡ç®—ä»·æ ¼ return this.strategy.calcPrice(num); } } åˆ›å»ºä¸€ä¸ªMainClassç±»æµ‹è¯•ä¸€ç•ª public class MainClass { public static void main(String[] args) { // å•†å“åŸä»· double num = 200; // æ™®é€šé¡¾å®¢ç­–ç•¥è®¡ç®—æŠ˜åä»·æ ¼ Price price = new Price(new CommonCustomerStrategy()); double newPrice = price.calcPrice(num); System.out.println(&quot;æ™®é€šé¡¾å®¢è´­ä¹°è¯¥å•†å“çš„æŠ˜åä»·æ ¼æ˜¯ï¼š&quot; + newPrice); // æ™®é€šä¼šå‘˜ç­–ç•¥è®¡ç®—æŠ˜åä»·æ ¼ price = new Price(new CommonMemberStrategy()); newPrice = price.calcPrice(num); System.out.println(&quot;æ™®é€šä¼šå‘˜è´­ä¹°è¯¥å•†å“çš„æŠ˜åä»·æ ¼æ˜¯ï¼š&quot; + newPrice); // VIPä¼šå‘˜ç­–ç•¥è®¡ç®—æŠ˜åä»·æ ¼ price = new Price(new VipMemberStrategy()); newPrice = price.calcPrice(num); System.out.println(&quot;VIPä¼šå‘˜è´­ä¹°è¯¥å•†å“çš„æŠ˜åä»·æ ¼æ˜¯ï¼š&quot; + newPrice); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœï¼š æ™®é€šé¡¾å®¢è´­ä¹°è¯¥å•†å“çš„æŠ˜åä»·æ ¼æ˜¯ï¼š200.0æ™®é€šä¼šå‘˜è´­ä¹°è¯¥å•†å“çš„æŠ˜åä»·æ ¼æ˜¯ï¼š190.0VIPä¼šå‘˜è´­ä¹°è¯¥å•†å“çš„æŠ˜åä»·æ ¼æ˜¯ï¼š180.0 ä»ä»¥ä¸Šç¤ºä¾‹å¯ä»¥çœ‹å‡ºç­–ç•¥æ¨¡å¼çš„æ„å›¾æ˜¯é’ˆå¯¹ä¸€ç»„ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…åˆ°å…·æœ‰å…±åŒæ¥å£çš„ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä»è€Œä½¿å¾—å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è‡ªèº«å¹¶ä¸èƒ½å†³å®šä½•æ—¶è¯¥é‡‡ç”¨å“ªç§ç­–ç•¥ç®—æ³•ï¼Œè¯¥ä½¿ç”¨ä½•ç§ç®—æ³•æ˜¯ç”±å®¢æˆ·ç«¯æ¥å†³å®šçš„ã€‚ å››ã€ç­–ç•¥æ¨¡å¼çš„ç‰¹ç‚¹ä¼˜ç‚¹ï¼š ç­–ç•¥æ¨¡å¼æä¾›äº†ç®¡ç†ç›¸å…³çš„ç®—æ³•æ—çš„åŠæ³•ã€‚ç­–ç•¥ç±»çš„ç­‰çº§ç»“æ„å®šä¹‰äº†ä¸€ä¸ªç®—æ³•æˆ–è¡Œä¸ºæ—ã€‚æ°å½“ä½¿ç”¨ç»§æ‰¿å¯ä»¥æŠŠå…¬å…±çš„ä»£ç ç§»åˆ°çˆ¶ç±»é‡Œé¢ï¼Œä»è€Œé¿å…ä»£ç é‡å¤ã€‚ ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨ï¼ˆif-elseï¼‰å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ã€‚å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ä¸æ˜“ç»´æŠ¤ï¼Œå®ƒæŠŠé‡‡å–å“ªä¸€ç§ç®—æ³•æˆ–é‡‡å–å“ªä¸€ç§è¡Œä¸ºçš„é€»è¾‘ä¸ç®—æ³•æˆ–è¡Œä¸ºçš„é€»è¾‘æ··åˆåœ¨ä¸€èµ·ï¼Œç»Ÿç»Ÿåˆ—åœ¨ä¸€ä¸ªå¤šé‡è½¬ç§»è¯­å¥é‡Œé¢ï¼Œæ¯”ä½¿ç”¨ç»§æ‰¿çš„åŠæ³•è¿˜è¦åŸå§‹å’Œè½åã€‚ ç¼ºç‚¹ï¼š å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚è¿™å°±æ„å‘³ç€å®¢æˆ·ç«¯å¿…é¡»ç†è§£è¿™äº›ç®—æ³•çš„åŒºåˆ«ï¼Œä»¥ä¾¿é€‚æ—¶é€‰æ‹©æ°å½“çš„ç®—æ³•ç±»ã€‚æ¢è¨€ä¹‹ï¼Œç­–ç•¥æ¨¡å¼åªé€‚ç”¨äºå®¢æˆ·ç«¯çŸ¥é“ç®—æ³•æˆ–è¡Œä¸ºçš„æƒ…å†µã€‚ ç”±äºç­–ç•¥æ¨¡å¼æŠŠæ¯ä¸ªå…·ä½“çš„ç­–ç•¥å®ç°éƒ½å•ç‹¬å°è£…æˆä¸ºç±»ï¼Œå¦‚æœå¤‡é€‰çš„ç­–ç•¥å¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆå…·ä½“ç­–ç•¥ç±»çš„æ•°ç›®å°±ä¼šå¾ˆå¯è§‚ã€‚ å‚è€ƒæ–‡ç« http://www.cnblogs.com/java-my-life/archive/2012/04/20/2455726.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"ç­–ç•¥æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"ç­–ç•¥æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/ç­–ç•¥æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--è£…é¥°æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--è£…é¥°æ¨¡å¼","date":"2020-05-24T08:36:36.000Z","updated":"2023-04-30T10:21:41.361Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è£…é¥°æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--è£…é¥°æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯è£…é¥°æ¨¡å¼è£…é¥°ï¼ˆ Decorator ï¼‰æ¨¡å¼åˆå«åšåŒ…è£…( Wrapper )æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä¸€ç§å¯¹å®¢æˆ·ç«¯é€æ˜çš„æ–¹å¼æ¥æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ï¼Œæ˜¯ç»§æ‰¿å…³ç³»çš„ä¸€ä¸ªæ›¿æ¢æ–¹æ¡ˆã€‚ äºŒã€è£…é¥°æ¨¡å¼å®ç°è£…é¥°æ¨¡å¼é€šè¿‡ä¸€ç§å¯¹å®¢æˆ·ç«¯é€æ˜çš„æ–¹å¼åŠ¨æ€åœ°ä¸ºä¸€ä¸ªå¯¹è±¡é™„åŠ ä¸Šæ–°çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ä½¿å®¢æˆ·ç«¯åœ¨ä¸éœ€è¦åˆ›å»ºæ›´å¤šå­ç±»çš„æƒ…å†µä¸‹ï¼Œè‡ªç”±åœ°å¯¹åˆ›å»ºå¯¹è±¡çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•ï¼Œè£…é¥°æ¨¡å¼æ˜¯ç»§æ‰¿å…³ç³»çš„ä¸€ä¸ªæ›¿æ¢æ–¹æ¡ˆã€‚ ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šæ²™å‘å¯ä»¥åã€å¯ä»¥èººï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºå®ƒæ·»åŠ ä¸ŠæŒ‰æ‘©åŠŸèƒ½ä½¿å®ƒæˆä¸ºä¿å¥æ²™å‘ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºå®ƒæ·»åŠ ä¸Šå¯ä»¥å±•å¼€ä¾›äººç¡è§‰çš„åŠŸèƒ½è®©å®ƒå˜æˆæ²™å‘åºŠï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨å­ç±»ç»§æ‰¿æ–¹å¼æ¥æ¨¡æ‹Ÿä¸ºæ²™å‘æ·»åŠ ä¸Šè¿™äº›æ–°åŠŸèƒ½ã€‚ é¦–å…ˆæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªæ²™å‘Sofaçš„æ¥å£ç”¨ä»¥å£°æ˜æ‰€æœ‰æ²™å‘éƒ½åº”è¯¥å…·æœ‰çš„åŠŸèƒ½ï¼Œæ­¤å¤„é¢å¤–å¢åŠ äº†ä¸€ä¸ªshow()æ–¹æ³•ç”¨æ¥å±•ç¤ºæ²™å‘çš„åŠŸèƒ½ã€‚ public interface Sofa { // æµ‹è¯•æ–¹æ³•ï¼Œç”¨ä»¥å±•ç¤ºæ²™å‘å…·æœ‰çš„åŠŸèƒ½ public void show(); // å public void sit(); // èºº public void lie(); } æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å£°æ˜æ™®é€šæ²™å‘CommonSofaã€SofaBedå’ŒHealthCareSofaä¸‰ç§æ²™å‘äº†ã€‚ æ™®é€šæ²™å‘åªèƒ½åå’Œèººã€‚ public class CommonSofa implements Sofa { @Override public void show() { this.sit(); this.lie(); } @Override public void sit() { System.out.println(&quot;å¯ä»¥å&quot;); } @Override public void lie() { System.out.println(&quot;å¯ä»¥èºº&quot;); } } æ²™å‘åºŠé™¤äº†èƒ½åå’Œèººå¤–ï¼Œè¿˜å¯ä»¥ç¡è§‰ã€‚ public class SofaBed implements Sofa { @Override public void show() { this.sit(); this.lie(); this.sleep(); } @Override public void sit() { System.out.println(&quot;å¯ä»¥å&quot;); } @Override public void lie() { System.out.println(&quot;å¯ä»¥èºº&quot;); } public void sleep() { System.out.println(&quot;å¯ä»¥ç¡è§‰&quot;); } } ä¿å¥æ²™å‘é™¤äº†åå’Œèººå¤–ï¼Œè¿˜å¯ä»¥æŒ‰æ‘©ã€‚ public class HealthCareSofa implements Sofa { @Override public void show() { this.sit(); this.lie(); this.massage(); } @Override public void sit() { System.out.println(&quot;å¯ä»¥å&quot;); } @Override public void lie() { System.out.println(&quot;å¯ä»¥èºº&quot;); } public void massage() { System.out.println(&quot;å¯ä»¥æŒ‰æ‘©&quot;); } } åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¥è¿›è¡Œæµ‹è¯•ã€‚ public class Client { public static void main(String[] args) { System.out.println(&quot;---------æ™®é€šæ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼š---------&quot;); Sofa commonSofa = new CommonSofa(); commonSofa.show(); System.out.println(); System.out.println(&quot;---------æ²™å‘åºŠåŠŸèƒ½å¦‚ä¸‹ï¼š---------&quot;); Sofa sofaBed = new SofaBed(); sofaBed.show(); System.out.println(); System.out.println(&quot;---------ä¿å¥æ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼š---------&quot;); Sofa healthCareSofa = new HealthCareSofa(); healthCareSofa.show(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š â€”â€”â€”æ™®é€šæ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼šâ€”â€”â€”å¯ä»¥å å¯ä»¥èººâ€”â€”â€”æ²™å‘åºŠåŠŸèƒ½å¦‚ä¸‹ï¼šâ€”â€”â€”å¯ä»¥å å¯ä»¥èºº å¯ä»¥ç¡è§‰â€”â€”â€”ä¿å¥æ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼šâ€”â€”â€”å¯ä»¥å å¯ä»¥èºº å¯ä»¥æŒ‰æ‘© ä»¥ä¸Šæ˜¯é€šè¿‡ç»§æ‰¿æ¥å®ç°æ²™å‘SofaåŠŸèƒ½çš„æ‰©å±•ï¼ŒåŠŸèƒ½å®ç°äº†ä½†å´æœ‰ä¸ªä¸¥é‡çš„ç¼ºé™·ï¼šé€šè¿‡ç»§æ‰¿å®ç°çš„åŠŸèƒ½æ‰©å±•æ˜¯é™æ€çš„ï¼Œæˆ‘ä»¬å¿…é¡»æå‰é¢„çŸ¥éœ€è¦ä¸ºå¯¹è±¡æ·»åŠ å“ªäº›åŠŸèƒ½ï¼Œå¹¶åˆ›å»ºå¥½ç›¸åº”çš„å­ç±»ï¼Œå¯¹è±¡èƒ½å¤Ÿæ‰©å±•å“ªäº›åŠŸèƒ½è¿™æ˜¯åœ¨javaè™šæ‹Ÿæœºå¯¹ç±»è¿›è¡ŒåŠ è½½ç¼–è¯‘æ—¶å°±å·²ç»å†³å®šäº†çš„ï¼Œå› è€Œæ˜¯é™æ€çš„ã€‚è¿˜æ˜¯ä»¥æ²™å‘Sofaä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ—¢èƒ½ç¡è§‰åˆèƒ½æŒ‰æ‘©çš„ä¿å¥æ²™å‘åºŠå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸å†æ–°æ·»åŠ ä¸€ä¸ªSofaçš„å­ç±»ï¼ˆä¿å¥æ²™å‘åºŠï¼‰å¹¶ä¸ºå…¶é™„åŠ ä¸Šsleep()å’Œmassage()ä¸¤ä¸ªæ–¹æ³•ï¼Œå€˜è‹¥ä»¥åæ²™å‘åˆå¢åŠ ä¸Šå¯æ‹†æ´—çš„åŠŸèƒ½ï¼Œå¯¹å„ä¸ªåŠŸèƒ½è¿›è¡Œç»„åˆæˆ‘ä»¬å°±è¦å†å¢åŠ å¯æ‹†æ´—æ²™å‘ã€å¯æ‹†æ´—æ²™å‘åºŠã€å¯æ‹†æ´—ä¿å¥æ²™å‘ã€å¯æ‹†æ´—ä¿å¥æ²™å‘åºŠå››ä¸ªå­ç±»ï¼ŒåŠŸèƒ½è‹¥ç»§ç»­å¢åŠ åŠ¿å¿…é€ æˆå­ç±»æ•°é‡çš„æˆå€å¢åŠ ï¼Œå‡ºç°â€ç±»è†¨èƒ€â€æƒ…å†µã€‚ è£…é¥°æ¨¡å¼çš„è®¾è®¡åˆè¡·ï¼šä»¥ä¸€ç§æ›´ä¸ºçµæ´»çš„æ–¹å¼åŠ¨æ€åœ°ä¸ºå¯¹è±¡é™„åŠ ä¸€äº›æ–°åŠŸèƒ½ï¼Œè£…é¥°æ¨¡å¼çš„å®ç°ç»“æ„å›¾å¦‚ä¸‹ï¼š è£…é¥°æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š æŠ½è±¡ç»„ä»¶(Component)è§’è‰²ï¼š ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œæ˜¯è¢«è£…é¥°ç±»ï¼ˆConcreteComponentï¼‰å’Œè£…é¥°ç±»ï¼ˆDecoratorï¼‰çš„çˆ¶æ¥å£ã€‚ å…·ä½“ç»„ä»¶(ConcreteComponent)è§’è‰²ï¼šæŠ½è±¡ç»„ä»¶çš„å®ç°ç±»ã€‚ æŠ½è±¡è£…é¥°(Decorator)è§’è‰²ï¼šåŒ…å«ä¸€ä¸ªç»„ä»¶çš„å¼•ç”¨ï¼Œå¹¶å®šä¹‰äº†ä¸æŠ½è±¡ç»„ä»¶ä¸€è‡´çš„æ¥å£ã€‚ å…·ä½“è£…é¥°(ConcreteDecorator)è§’è‰²ï¼šä¸ºæŠ½è±¡è£…é¥°è§’è‰²çš„å®ç°ç±»ï¼Œè´Ÿè´£å…·ä½“çš„è£…é¥°(ä¸ºç»„ä»¶é™„åŠ ä¸Šæ–°çš„åŠŸèƒ½)ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è£…é¥°æ¨¡å¼æ¥å®ç°æ²™å‘çš„åŠŸèƒ½æ‰©å±•ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªæ²™å‘Sofaçš„æ¥å£åŒä¸Šï¼Œæ‹…å½“è£…é¥°æ¨¡å¼ä¸­çš„æŠ½è±¡ç»„ä»¶è§’è‰²ã€‚ public interface Sofa { // æµ‹è¯•æ–¹æ³•ï¼Œç”¨ä»¥å±•ç¤ºæ²™å‘æ‰€å…·æœ‰çš„åŠŸèƒ½ public void show(); // å public void sit(); // èºº public void lie(); } å†å®šä¹‰ä¸€ä¸ªSofaæ¥å£çš„å®ç°ç±»ï¼Œæ‰®æ¼”è£…é¥°æ¨¡å¼ä¸­çš„å…·ä½“ç»„ä»¶è§’è‰²ã€‚ public class CommonSofa implements Sofa { @Override public void show() { this.sit(); this.lie(); } @Override public void sit() { System.out.println(&quot;å¯ä»¥å&quot;); } @Override public void lie() { System.out.println(&quot;å¯ä»¥èºº&quot;); } } å†å®šä¹‰ä¸€ä¸ªæŠ½è±¡è£…é¥°è§’è‰²ï¼Œå…¶å†…éƒ¨è¦åŒ…å«ä¸€ä¸ªè¢«è£…é¥°å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶å®ç°æŠ½è±¡ç»„ä»¶çš„æ‰€æœ‰æ¥å£ public class SofaDecorator implements Sofa { // ç§æœ‰çš„è¢«è£…é¥°å¯¹è±¡çš„å¼•ç”¨ private Sofa sofa; // å…¬æœ‰çš„è·å–è¢«è£…é¥°å¯¹è±¡çš„æ–¹æ³• public Sofa getSofa() { return sofa; } public void setSofa(Sofa sofa) { this.sofa = sofa; } public SofaDecorator(Sofa sofa) { this.sofa = sofa; } public void show() { this.sit(); this.lie(); } @Override public void sit() { System.out.println(&quot;å¯ä»¥å&quot;); } @Override public void lie() { System.out.println(&quot;å¯ä»¥èºº&quot;); } } æœ€ååˆ›å»ºå…·ä½“è£…é¥°è§’è‰²ï¼Œä¸ºè¢«è£…é¥°å¯¹è±¡é™„ä»¶ä¸Šæ–°åŠŸèƒ½ public class BedDecorator extends SofaDecorator { public BedDecorator(Sofa sofa) { super(sofa); } public void show() { this.getSofa().show(); this.sleep(); } // ä¸ºæ²™å‘æ·»åŠ ç¡è§‰åŠŸèƒ½ public void sleep() { System.out.println(&quot;å¯ä»¥ç¡è§‰&quot;); } } public class HealthCareDecorator extends SofaDecorator { public HealthCareDecorator(Sofa sofa) { super(sofa); } public void show() { this.getSofa().show(); this.massage(); } // ä¸ºæ²™å‘æ·»åŠ æŒ‰æ‘©åŠŸèƒ½ public void massage() { System.out.println(&quot;å¯ä»¥æŒ‰æ‘©&quot;); } } åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æµ‹è¯•ä¸€ä¸‹ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š public class MainClass { public static void main(String[] args) { // å…ˆåˆ›å»ºä¸€ä¸ªè¦è¢«è£…é¥°çš„æ™®é€šæ²™å‘å¯¹è±¡ Sofa sofa = new CommonSofa(); System.out.println(&quot;---------æ™®é€šæ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼š---------&quot;); sofa.show(); System.out.println(); // ç”¨BedDecoratorå¯¹åˆ›å»ºå¥½çš„æ™®é€šæ²™å‘å¯¹è±¡è¿›è¡Œè£…é¥°ï¼Œä¸ºå…¶å¢åŠ ç¡è§‰åŠŸèƒ½ System.out.println(&quot;---------æ²™å‘åºŠåŠŸèƒ½å¦‚ä¸‹ï¼š---------&quot;); Sofa sofaBed = new BedDecorator(sofa); sofaBed.show(); System.out.println(); // ç”¨HealthCareDecoratorå¯¹åˆ›å»ºå¥½çš„æ™®é€šæ²™å‘å¯¹è±¡è¿›è¡Œè£…é¥°ï¼Œä¸ºå…¶å¢åŠ æŒ‰æ‘©åŠŸèƒ½ System.out.println(&quot;---------ä¿å¥æ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼š---------&quot;); Sofa healthCareSofa = new HealthCareDecorator(sofa); healthCareSofa.show(); System.out.println(); // ç”¨HealthCareDecoratorå¯¹åˆ›å»ºå¥½çš„æ²™å‘åºŠå¯¹è±¡è¿›è¡Œè£…é¥°ï¼Œä¸ºå…¶å¢åŠ æŒ‰æ‘©åŠŸèƒ½ System.out.println(&quot;---------ä¿å¥æ²™å‘åºŠåŠŸèƒ½å¦‚ä¸‹ï¼š---------&quot;); Sofa healthCareSofaBed = new HealthCareDecorator(sofaBed); healthCareSofaBed.show(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š â€”â€”â€”æ™®é€šæ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼šâ€”â€”â€”å¯ä»¥å å¯ä»¥èººâ€”â€”â€”æ²™å‘åºŠåŠŸèƒ½å¦‚ä¸‹ï¼šâ€”â€”â€”å¯ä»¥å å¯ä»¥èºº å¯ä»¥ç¡è§‰â€”â€”â€”ä¿å¥æ²™å‘åŠŸèƒ½å¦‚ä¸‹ï¼šâ€”â€”â€”å¯ä»¥å å¯ä»¥èºº å¯ä»¥æŒ‰æ‘©â€”â€”â€”ä¿å¥æ²™å‘åºŠåŠŸèƒ½å¦‚ä¸‹ï¼šâ€”â€”â€”å¯ä»¥å å¯ä»¥èºº å¯ä»¥ç¡è§‰ å¯ä»¥æŒ‰æ‘© è£…é¥°æ¨¡å¼é€šè¿‡å¯¹æ™®é€šæ²™å‘çš„åŠŸèƒ½è¿›è¡Œå±‚å±‚è£…é¥°ï¼Œæœ€ç»ˆè¿å…·æœ‰ä¿å¥å’Œç¡è§‰åŠŸèƒ½çš„æ²™å‘ä¹Ÿåˆ›å»ºæˆåŠŸäº†ã€‚ ä¸‰ã€è£…é¥°æ¨¡å¼çš„ç‰¹ç‚¹ è£…é¥°å¯¹è±¡å’ŒçœŸå®å¯¹è±¡æœ‰ç›¸åŒçš„æ¥å£ã€‚ è£…é¥°å¯¹è±¡åŒ…å«ä¸€ä¸ªçœŸå®å¯¹è±¡çš„å¼•ç”¨ï¼ˆreferenceï¼‰ è£…é¥°å¯¹è±¡æ¥å—æ‰€æœ‰çš„æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å®ƒæŠŠè¿™äº›è¯·æ±‚è½¬å‘ç»™çœŸå®çš„å¯¹è±¡ã€‚ è£…é¥°å¯¹è±¡å¯ä»¥åœ¨è½¬å‘è¿™äº›è¯·æ±‚ä»¥å‰æˆ–ä»¥åå¢åŠ ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚è¿™æ ·å°±ç¡®ä¿äº†åœ¨è¿è¡Œæ—¶ï¼Œä¸ç”¨ä¿®æ”¹ç»™å®šå¯¹è±¡çš„ç»“æ„å°±å¯ä»¥åœ¨å¤–éƒ¨å¢åŠ é™„åŠ çš„åŠŸèƒ½ã€‚ å‚è€ƒæ–‡ç« http://www.cnblogs.com/java-my-life/archive/2012/04/20/2455726.html","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"è£…é¥°æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"è£…é¥°æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/è£…é¥°æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--å»ºé€ è€…æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--å»ºé€ è€…æ¨¡å¼","date":"2020-05-24T08:35:22.000Z","updated":"2023-04-30T10:21:41.357Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å»ºé€ è€…æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å»ºé€ è€…æ¨¡å¼/","excerpt":"","text":"å‰è¨€åœ¨å¬å®Œå‰é£è¡Œè€å¸ˆã€Šè®¾è®¡æ¨¡å¼ç³»åˆ—è¯¾ç¨‹ã€‹ä¸­çš„å»ºé€ è€…æ¨¡å¼ä¸€èŠ‚åé¡¿æ—¶æ„Ÿè§‰æœ‰ç‚¹å¤´å¤§ï¼Œæ„Ÿè§‰å®ƒæœ‰ç‚¹åƒå·¥å‚æ–¹æ³•æ¨¡å¼ï¼ŒæŸ¥çœ‹äº†ç½‘ä¸Šå¾ˆå¤šæ–‡ç« ä¹Ÿæ˜¯ä¼—è¯´çº·çº­ï¼Œçœ‹åˆ°äº†cornçš„è¿™ç¯‡æ–‡ç« æ‰æœ‰ç‚¹æ‹¨å¼€äº‘é›¾è§æ™´å¤©çš„æ„Ÿè§‰ã€‚ ä¸€ã€ä»€ä¹ˆæ˜¯å»ºé€ è€…æ¨¡å¼å»ºé€ è€…ï¼ˆBuilderï¼‰æ¨¡å¼ä¹Ÿå«ç”Ÿæˆå™¨æ¨¡å¼ï¼Œæ˜¯ç”±GoFæå‡ºçš„23ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå…¶è®¾è®¡æ„å›¾æ˜¯ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ GoFç»™å‡ºçš„æè¿°å¾ˆç®€çŸ­ï¼Œä¸æ˜“ç†è§£ï¼Œæˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼šæˆ‘ä»¬è¦åˆ›å»ºçš„å¯¹è±¡ä¼šåŒ…å«æœ‰å„ç§å„æ ·çš„å±æ€§ï¼ˆå¯ä»¥æ˜¯å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯å¯¹è±¡ï¼Œå°±å¥½æ¯”æ±½è½¦çš„é›¶é…ä»¶ï¼‰ï¼Œè¿™äº›å±æ€§å°±å«åšè¿™ä¸ªå¯¹è±¡çš„è¡¨ç¤ºï¼Œæœ‰äº†å±æ€§ä¹‹åæˆ‘ä»¬è¿˜éœ€è¦å°†è¿™äº›å±æ€§æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æˆ–è€…é¡ºåºç»„è£…èµ·æ¥æ‰èƒ½åˆ›é€ å‡ºå¯¹è±¡æ¥ï¼ˆè¿™å°±å¥½æ¯”ç”¨æ±½è½¦é›¶ä»¶ç»„è£…æ±½è½¦ï¼‰ï¼Œè€Œè¿™ä¸ªç»„è£…çš„è¿‡ç¨‹å°±æ˜¯å¯¹è±¡çš„æ„å»ºï¼ŒBuilderæ¨¡å¼å°†å¯¹è±¡çš„è¡¨ç¤ºä¸å¯¹è±¡çš„æ„å»ºåˆ†åˆ«äº¤ç”±å»ºé€ è€…å’ŒæŒ‡æŒ¥è€…å»è´Ÿè´£ï¼Œæ•´ä¸ªå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å¯¹å®¢æˆ·ç«¯æ˜¯éšè—çš„ï¼Œå®¢æˆ·ç«¯åªéœ€è¦å»è°ƒç”¨å»ºé€ è€…å’ŒæŒ‡æŒ¥è€…å»åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸å¿…å…³ç³»è¿™ä¸ªå¯¹è±¡éƒ½æœ‰å“ªäº›å±æ€§ï¼Œä»¥åŠå„ä¸ªå±æ€§ä¹‹é—´æ˜¯æ€ä¹ˆæ ·è¿›è¡Œç»„è£…çš„ï¼Œè¾¾åˆ°äº†è´£ä»»åˆ’åˆ†å’Œå°è£…çš„ç›®çš„ã€‚ äºŒã€å»ºé€ è€…æ¨¡å¼çš„ç»“æ„å»ºé€ è€…æ¨¡å¼é€‚åˆäºåˆ›å»ºæ¯”è¾ƒå¤æ‚çš„å¯¹è±¡ï¼Œæ‰€è°“å¤æ‚æœ‰ä¸¤ä¸ªæ–¹å‘ï¼š åˆ›å»ºè¿‡ç¨‹å¤æ‚ï¼Œåˆ›å»ºçš„æ­¥éª¤æœ‰ä¸¥æ ¼çš„é¡ºåºã€‚ åˆ›å»ºå¯¹è±¡çš„ç»“æ„å¤æ‚ï¼Œåˆ›å»ºå¯¹è±¡åŒ…å«çš„å±æ€§æ•°é‡å¤šã€‚ é’ˆå¯¹ä»¥ä¸Šä¸¤ç±»çš„å¤æ‚å¯¹è±¡Builderæ¨¡å¼ä¹Ÿåˆ†åˆ«æ¼”åŒ–å‡ºäº†ä¸¤ç§è¡¨ç°å½¢å¼ã€‚ ç¬¬ä¸€ç§ï¼šé€šè¿‡Productã€ConcreteBuilderã€Builderå’ŒDirectorå½¢æˆçš„å»ºé€ è€…æ¨¡å¼ã€‚ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¿™ç§Builderæ¨¡å¼åŒ…å«4ä¸ªè§’è‰²ï¼šäº§å“(Product)ï¼Œå…·ä½“å»ºé€ è€…(ConcreteBuilder)ï¼Œå»ºé€ è€…(Builder)ï¼ŒæŒ‡æŒ¥è€…(Director) äº§å“ï¼šéœ€è¦åˆ›å»ºçš„å¯¹è±¡äº§å“ å»ºé€ è€…ï¼šæœ¬è´¨ä¸ºæŠ½è±¡ç±»ï¼Œé‡Œé¢çš„æŠ½è±¡æ–¹æ³•ä¾›å…·ä½“å»ºé€ è€…é‡å†™ã€‚ å…·ä½“å»ºé€ è€…ï¼šåˆ›å»ºäº§å“çš„å®ä¾‹å¹¶ä¸”å®ç°å»ºé€ è€…å¤šä¸ªæ–¹æ³•å¯¹äº§å“è¿›è¡Œè£…é…ã€‚ æŒ‡æŒ¥è€…ï¼šæœ‰æ¡ä¸ç´Šçš„æŒ‰é¡ºåºè°ƒç”¨å»ºé€ è€…æŠ½è±¡ç±»åŠå…¶æ–¹æ³•ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“è®¡ç®—æœºé‡è£…ç³»ç»Ÿæ˜¯ä¸€ä»¶å¾ˆå¤æ‚çš„äº‹æƒ…ï¼Œé¦–å…ˆä½ è¦å¤‡ä»½é‡è¦æ•°æ®ã€æ ¼å¼åŒ–ç¡¬ç›˜ï¼Œå®‰è£…æ“ä½œç³»ç»Ÿï¼Œç„¶åå†æ‹·è´æ•°æ®ï¼Œå®‰è£…é©±åŠ¨ï¼Œå®‰è£…å¸¸ç”¨è½¯ä»¶ï¼Œç­‰ç­‰â€¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»¥é‡è£…è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸ºä¾‹æ¥ä½“ä¼šä¸€ä¸‹Builderæ¨¡å¼çš„ä½œç”¨ã€‚ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç±»æ¥è¯´æ˜å®‰è£…åçš„ç³»ç»Ÿè¦åŒ…å«å“ªäº›ä¸œè¥¿ï¼Œè¿™ä¸ªç±»å°±æ˜¯æˆ‘ä»¬è¦åˆ›å»ºçš„äº§å“ç±»ã€‚ public class SysApplication { // ç³»ç»Ÿä¸­çš„æ–‡ä»¶æ•°æ® private String data; // æ“ä½œç³»ç»Ÿ private String operationSystem; // é©±åŠ¨ private String driver; // åŒ…å«å“ªäº›æœ‰ç”¨çš„è½¯ä»¶ private String usefulSoftware; public String getData() { return data; } public void setData(String data) { this.data = data; } public String getOperationSystem() { return operationSystem; } public void setOperationSystem(String operationSystem) { this.operationSystem = operationSystem; } public String getDriver() { return driver; } public void setDriver(String driver) { this.driver = driver; } public String getUsefulSoftware() { return usefulSoftware; } public void setUsefulSoftware(String usefulSoftware) { this.usefulSoftware = usefulSoftware; } } å†åˆ›å»ºä¸€ä¸ªISysInstallBuilderæ¥å£æŠŠé‡è£…ç³»ç»Ÿè¿‡ç¨‹ä¸­æˆ‘ä»¬è¦åšçš„äº‹æƒ…éƒ½ç½—åˆ—å‡ºæ¥ï¼Œè¿™ä¸ªæ¥å£å°±æ‰®æ¼”äº†Builderæ¨¡å¼ä¸­çš„å»ºé€ è€…è§’è‰²ã€‚ public interface ISysInstallBuilder { // å¤‡ä»½æ•°æ® public void backupdata(); // æ ¼å¼åŒ–ç¡¬ç›˜ public void formatDisk(); // å¤åˆ¶æ•°æ® public void copyData(); // å®‰è£…æ“ä½œç³»ç»Ÿ public void installOperationSystem(); // å®‰è£…é©±åŠ¨ public void installDriver(); // å®‰è£…æœ‰ç”¨çš„è½¯ä»¶ public void installUsefulSoftware(); // è·å–å®‰è£…å¥½çš„ç³»ç»Ÿ public SysApplication getSystemApplication(); } æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°å®‰è£…Windows XPç³»ç»Ÿçš„å…·ä½“å»ºé€ è€…ç±»WinXpInstallBuilderï¼Œä»¥åéœ€è¦å®‰è£…Windows XPç³»ç»Ÿå°±ç”¨å®ƒã€‚ public class WinXpInstallBuilder implements ISysInstallBuilder { private SysApplication systemApplication = new SysApplication(); @Override public void backupdata() { // æ­¤å¤„å¡«å†™æ•°æ®å¤‡ä»½ç›¸å…³ä»£ç  System.out.println(&quot;å¤‡ä»½æ•°æ®&quot;); } @Override public void formatDisk() { // æ­¤å¤„å¡«å†™ç¡¬ç›˜æ ¼å¼åŒ–ç›¸å…³ä»£ç  System.out.println(&quot;æ ¼å¼åŒ–ç¡¬ç›˜&quot;); } @Override public void copyData() { // æ­¤å¤„å¡«å†™å¤åˆ¶æ•°æ®ç›¸å…³ä»£ç  System.out.println(&quot;å¤åˆ¶æ•°æ®&quot;); this.systemApplication.setData(&quot;åŸç³»ç»Ÿå¤‡ä»½çš„æ•°æ®&quot;); } @Override public void installOperationSystem() { // æ­¤å¤„å¡«å†™å®‰è£…Windows XPæ“ä½œç³»ç»Ÿç›¸å…³ä»£ç  System.out.println(&quot;å®‰è£…Windows XPæ“ä½œç³»ç»Ÿ&quot;); this.systemApplication.setOperationSystem(&quot;Windows XP&quot;); } @Override public void installDriver() { // æ­¤å¤„å¡«å†™å®‰è£…Windows XPé©±åŠ¨ç›¸å…³ä»£ç  System.out.println(&quot;å®‰è£…Windows XPé©±åŠ¨&quot;); this.systemApplication.setDriver(&quot;Windows XPé©±åŠ¨&quot;); } @Override public void installUsefulSoftware() { // æ­¤å¤„å¡«å†™å®‰è£…Windows XPæ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶ç›¸å…³ä»£ç  System.out.println(&quot;å®‰è£…Windows XPæ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶&quot;); this.systemApplication.setUsefulSoftware(&quot;Windows XPæ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶&quot;); } @Override public SysApplication getSystemApplication() { // å°†å®‰è£…å¥½çš„ç³»ç»Ÿè¿”å› return this.systemApplication; } } ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå…·ä½“å»ºé€ è€…ç±»WinXpInstallBuilderï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ç€ç”¨å®ƒæ¥é‡è£…ä¸€ä¸‹ç³»ç»Ÿã€‚ public class MainClass { public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªWinXpInstallBuilder ISysInstallBuilder builder = new WinXpInstallBuilder(); // è°ƒç”¨WinXpInstallBuilderï¼Œå¼€å§‹è£…ç³»ç»Ÿäº† builder.backupdata(); builder.copyData(); builder.formatDisk(); builder.installDriver(); builder.installOperationSystem(); builder.installUsefulSoftware(); // è·å–åˆ°å®‰è£…å¥½çš„ç³»ç»Ÿ SysApplication sysApplication = builder.getSystemApplication(); System.out.println(&quot;----------ç³»ç»Ÿä¿¡æ¯å¦‚ä¸‹----------&quot;); System.out.println(&quot;æ•°æ®ï¼š&quot; + sysApplication.getData()); System.out.println(&quot;é©±åŠ¨ï¼š&quot; + sysApplication.getDriver()); System.out.println(&quot;æ“ä½œç³»ç»Ÿï¼š&quot; + sysApplication.getOperationSystem()); System.out.println(&quot;è½¯ä»¶ï¼š&quot; + sysApplication.getUsefulSoftware()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š å¤‡ä»½æ•°æ®å¤åˆ¶æ•°æ®æ ¼å¼åŒ–ç¡¬ç›˜å®‰è£…Windows XPé©±åŠ¨å®‰è£…Windows XPæ“ä½œç³»ç»Ÿå®‰è£…Windows XPæ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶â€”â€”â€”-ç³»ç»Ÿä¿¡æ¯å¦‚ä¸‹â€”â€”â€”-æ•°æ®ï¼šåŸç³»ç»Ÿå¤‡ä»½çš„æ•°æ®é©±åŠ¨ï¼šWindows XPé©±åŠ¨æ“ä½œç³»ç»Ÿï¼šWindows XPè½¯ä»¶ï¼šWindows XPæ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶ ç»†å¿ƒçš„ä½ å¯èƒ½å‘ç°äº†ï¼Œæˆ‘å®‰è£…çš„è¿™ä¸ªç³»ç»Ÿæ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘æŠŠç³»ç»Ÿå®‰è£…æ­¥éª¤çš„é¡ºåºæä¹±äº†ï¼Œå¤åˆ¶æ•°æ®åº”è¯¥æ”¾åœ¨æ ¼å¼åŒ–ç¡¬ç›˜å¹¶å®‰è£…å¥½æ“ä½œç³»ç»Ÿä¹‹åï¼Œå®‰è£…é©±åŠ¨åº”è¯¥æ”¾åœ¨å®‰è£…æ“ä½œç³»ç»Ÿä¹‹åã€‚ç”±äºå®‰è£…ç³»ç»Ÿçš„æ­¥éª¤æ¯”è¾ƒå¤æ‚ï¼Œè™½ç„¶æˆ‘å·²ç»å¾ˆå°å¿ƒç¿¼ç¿¼å¯è¿˜æ˜¯æŠŠå®‰è£…æ­¥éª¤ç»™æé”™äº†ï¼Œæ€æ ·æ‰èƒ½è®©ç³»ç»ŸæŒ‰ç…§æ­£ç¡®çš„æ­¥éª¤å®‰è£…è€Œä¸ä¼šæä¹±é¡ºåºå‘¢ï¼Ÿåˆ°äº†æŒ‡æŒ¥è€…å‡ºåœºçš„æ—¶åˆ»äº†ã€‚ public class SysInstallDirector { private ISysInstallBuilder builder; public SysInstallDirector(ISysInstallBuilder builder) { this.builder = builder; } public void installSystem() { builder.backupdata(); builder.formatDisk(); builder.installOperationSystem(); builder.installDriver(); builder.installUsefulSoftware(); builder.copyData(); } } æ¥ä¸‹æ¥æˆ‘ä»¬å†ä½¿ç”¨æŒ‡æŒ¥è€…è£…ä¸€æ¬¡ç³»ç»Ÿè¯•è¯•ã€‚ public class Client{ public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªWinXpInstallBuilder ISysInstallBuilder builder = new WinXpInstallBuilder(); //åˆ›å»ºä¸€ä¸ªæŒ‡æŒ¥è€… SysInstallDirector director = new SysInstallDirector(builder); //å»ºé€ è€…åœ¨æŒ‡æŒ¥è€…çš„æŒ‡æŒ¥ä¸‹å¼€å§‹å®‰è£…ç³»ç»Ÿäº† director.installSystem(); // ä»å»ºé€ è€…æ‰‹é‡Œè·å–åˆ°å®‰è£…å¥½çš„ç³»ç»Ÿ SysApplication sysApplication = builder.getSystemApplication(); System.out.println(&quot;----------ç³»ç»Ÿä¿¡æ¯å¦‚ä¸‹----------&quot;); System.out.println(&quot;æ•°æ®ï¼š&quot; + sysApplication.getData()); System.out.println(&quot;é©±åŠ¨ï¼š&quot; + sysApplication.getDriver()); System.out.println(&quot;æ“ä½œç³»ç»Ÿï¼š&quot; + sysApplication.getOperationSystem()); System.out.println(&quot;è½¯ä»¶ï¼š&quot; + sysApplication.getUsefulSoftware()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ•°æ®å¤‡ä»½ç¡¬ç›˜æ ¼å¼åŒ–å®‰è£…Windows XPæ“ä½œç³»ç»Ÿå®‰è£…Windows XPé©±åŠ¨å®‰è£…Windows XPæ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶å¤åˆ¶æ•°æ®â€”â€”â€”-ç³»ç»Ÿä¿¡æ¯å¦‚ä¸‹â€”â€”â€”-æ•°æ®ï¼šåŸç³»ç»Ÿå¤‡ä»½çš„æ•°æ®é©±åŠ¨ï¼šWindows XPé©±åŠ¨æ“ä½œç³»ç»Ÿï¼šWindows XPè½¯ä»¶ï¼šWindows XPæ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶ åœ¨æœ‰äº†æŒ‡æŒ¥è€…çš„å¸®å¿™åï¼Œç³»ç»ŸæŒ‰ç…§æ­£ç¡®çš„é¡ºåºå®‰è£…å®Œæˆäº†ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å†å®ç°ä¸€ä¸ªå®‰è£…Win7ç³»ç»Ÿçš„å…·ä½“å»ºé€ è€…ç±»Win7InstallBuilderã€‚ public class Win7InstallBuilder implements ISysInstallBuilder { private SysApplication systemApplication = new SysApplication(); @Override public void backupdata() { // æ­¤å¤„å¡«å†™æ•°æ®å¤‡ä»½ç›¸å…³ä»£ç  System.out.println(&quot;æ•°æ®å¤‡ä»½&quot;); } @Override public void formatDisk() { // æ­¤å¤„å¡«å†™ç¡¬ç›˜æ ¼å¼åŒ–ç›¸å…³ä»£ç  System.out.println(&quot;ç¡¬ç›˜æ ¼å¼åŒ–&quot;); } @Override public void copyData() { // æ­¤å¤„å¡«å†™å¤åˆ¶æ•°æ®ç›¸å…³ä»£ç  System.out.println(&quot;å¤åˆ¶æ•°æ®&quot;); this.systemApplication.setData(&quot;åŸç³»ç»Ÿå¤‡ä»½çš„æ•°æ®&quot;); } @Override public void installOperationSystem() { // æ­¤å¤„å¡«å†™å®‰è£…å®‰è£…Win7æ“ä½œç³»ç»Ÿç›¸å…³ä»£ç  System.out.println(&quot;å®‰è£…Win7æ“ä½œç³»ç»Ÿ&quot;); this.systemApplication.setOperationSystem(&quot;Win7&quot;); } @Override public void installDriver() { // æ­¤å¤„å¡«å†™å®‰è£…å®‰è£…Win7é©±åŠ¨ç›¸å…³ä»£ç  System.out.println(&quot;å®‰è£…Win7é©±åŠ¨&quot;); this.systemApplication.setDriver(&quot;Win7é©±åŠ¨&quot;); } @Override public void installUsefulSoftware() { // æ­¤å¤„å¡«å†™å®‰è£…å®‰è£…Win7æ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶ç›¸å…³ä»£ç  System.out.println(&quot;å®‰è£…Win7æ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶&quot;); this.systemApplication.setUsefulSoftware(&quot;Win7æ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶&quot;); } @Override public SysApplication getSystemApplication() { // å°†å®‰è£…å¥½çš„ç³»ç»Ÿè¿”å› return this.systemApplication; } } åœ¨å®¢æˆ·ç«¯ä¸­æµ‹è¯•ä¸€ä¸‹å®‰è£…Win7ç³»ç»Ÿã€‚ public class Client{ public static void main(String[] args) { // åˆ›å»ºä¸€ä¸ªWin7InstallBuilder ISysInstallBuilder builder = new Win7InstallBuilder(); // åˆ›å»ºä¸€ä¸ªæŒ‡æŒ¥è€… SysInstallDirector director = new SysInstallDirector(builder); // å»ºé€ è€…åœ¨æŒ‡æŒ¥è€…çš„æŒ‡æŒ¥ä¸‹å¼€å§‹å®‰è£…ç³»ç»Ÿäº† director.installSystem(); // ä»å»ºé€ è€…æ‰‹é‡Œè·å–åˆ°å®‰è£…å¥½çš„ç³»ç»Ÿ SysApplication sysApplication = builder.getSystemApplication(); System.out.println(&quot;----------ç³»ç»Ÿä¿¡æ¯å¦‚ä¸‹----------&quot;); System.out.println(&quot;æ•°æ®ï¼š&quot; + sysApplication.getData()); System.out.println(&quot;é©±åŠ¨ï¼š&quot; + sysApplication.getDriver()); System.out.println(&quot;æ“ä½œç³»ç»Ÿï¼š&quot; + sysApplication.getOperationSystem()); System.out.println(&quot;è½¯ä»¶ï¼š&quot; + sysApplication.getUsefulSoftware()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š æ•°æ®å¤‡ä»½ç¡¬ç›˜æ ¼å¼åŒ–å®‰è£…Win7æ“ä½œç³»ç»Ÿå®‰è£…Win7é©±åŠ¨å®‰è£…Win7æ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶å¤åˆ¶æ•°æ®â€”â€”â€”-ç³»ç»Ÿä¿¡æ¯å¦‚ä¸‹â€”â€”â€”-æ•°æ®ï¼šåŸç³»ç»Ÿå¤‡ä»½çš„æ•°æ®é©±åŠ¨ï¼šWin7é©±åŠ¨æ“ä½œç³»ç»Ÿï¼šWin7è½¯ä»¶ï¼šWin7æ“ä½œç³»ç»Ÿä¸‹å¸¸ç”¨è½¯ä»¶ Win7ç³»ç»Ÿä¹Ÿè¢«æ­£ç¡®å®‰è£…ï¼ŒBuilderæ¨¡å¼é€šè¿‡æŒ‡æŒ¥è€…å’Œå»ºé€ è€…å°†è¦åˆ›å»ºçš„å¯¹è±¡å±æ€§å’Œå±æ€§çš„è£…é…è¿‡ç¨‹è¿›è¡Œåˆ†ç¦»ï¼Œä¸€æ ·çš„åˆ›å»ºè¿‡ç¨‹ç”±äºä¼ å…¥çš„å…·ä½“å»ºé€ è€…ä¸åŒæœ€ç»ˆåˆ›å»ºå‡ºäº†å®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼Œè€Œä¸”æ— éœ€å†æ‹…å¿§æŠŠç»„è£…é¡ºåºææ··äº†ã€‚ ç¬¬äºŒç§ï¼šé€šè¿‡é™æ€å†…éƒ¨ç±»å®ç°å¤æ‚å¯¹è±¡çš„æ— åºæ„é€ ã€‚ åˆ›å»ºä¸€ä¸ªä¸ªäººä¿¡æ¯ç±»PersonalInfoï¼Œå…¶ä¸­åŒ…å«ä¸ªäººä¿¡æ¯åŒ…æ‹¬ï¼šç”µè¯å·ç ï¼Œåœ°å€ï¼Œå§“åï¼Œå¹´é¾„ï¼Œæ€§åˆ«ï¼Œèº«ä»½è¯å·ã€‚ public class PersonalInfo { private String name; private int age; private String gender; private String address; private String iDNumber; private String phoneNumber; public String getPhoneNumber() { return phoneNumber; } public String getAddress() { return address; } public String getName() { return name; } public int getAge() { return age; } public String getGender() { return gender; } public String getIDNumber() { return iDNumber; } public static class Builder { private String name; private int age; private String gender; private String address; private String iDNumber; private String phoneNumber; public Builder(String name) { this.name = name; } public Builder phoneNumber(String phoneNumber) { this.phoneNumber = phoneNumber; return this; } public Builder address(String address) { this.address = address; return this; } public Builder age(int age) { this.age = age; return this; } public Builder gender(String gender) { this.gender = gender; return this; } public Builder iDNumber(String iDNumber) { this.iDNumber = iDNumber; return this; } public PersonalInfo build() { return new PersonalInfo(this); } } private PersonalInfo(Builder builder) { this.address = builder.address; this.age = builder.age; this.gender = builder.gender; this.iDNumber = builder.iDNumber; this.name = builder.name; this.phoneNumber = builder.phoneNumber; } } åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨æ­¤ç±»åˆ›å»ºä¸ªäººä¿¡æ¯æµ‹è¯•ä¸€ä¸‹ã€‚ public class Client{ public static void main(String[] args) { PersonalInfo personalInfo = new PersonalInfo.Builder(&quot;å§¬å¦‚é›ª&quot;) .address(&quot;å¹»éŸ³åŠ&quot;).age(19).gender(&quot;å¥³&quot;).build(); System.out.println(&quot;------------ä¸ªäººä¿¡æ¯----------------&quot;); System.out.println(&quot;å§“åï¼š&quot;+personalInfo.getName()); System.out.println(&quot;ä½å€ï¼š&quot;+personalInfo.getAddress()); System.out.println(&quot;å¹´é¾„ï¼š&quot;+personalInfo.getAge()); System.out.println(&quot;æ€§åˆ«ï¼š&quot;+personalInfo.getGender()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š â€”â€”â€”â€”ä¸ªäººä¿¡æ¯â€”â€”â€”â€”â€”-å§“åï¼šå§¬å¦‚é›ªä½å€ï¼šå¹»éŸ³åŠå¹´é¾„ï¼š19æ€§åˆ«ï¼šå¥³ æ­¤ç§æ–¹å¼é€šè¿‡çº§è”æ–¹å¼å»åˆ›å»ºå¯¹è±¡ï¼Œå¯è‡ªç”±æ§åˆ¶åˆ›å»ºå¯¹è±¡çš„å±æ€§ä¸ªæ•°ï¼Œå‡å°‘äº†é‡å¤ä»£ç ï¼Œä½¿å¯¹è±¡çš„åˆ›å»ºæ›´åŠ å½¢è±¡ç›´è§‚ã€‚ ä¸‰ã€å»ºé€ è€…æ¨¡å¼åº”ç”¨åœºæ™¯å¦‚æœç¢°åˆ°ä»¥ä¸‹æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼š å½“åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•åº”è¯¥ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼æ—¶ã€‚ å½“æ„é€ è¿‡ç¨‹å¿…é¡»å…è®¸è¢«æ„é€ çš„å¯¹è±¡æœ‰ä¸åŒçš„è¡¨ç¤ºæ—¶ã€‚ åˆ›å»ºçš„æ˜¯ä¸€ä¸ªå¤åˆå¯¹è±¡ï¼šè¢«åˆ›å»ºçš„å¯¹è±¡ä¸ºä¸€ä¸ªå…·æœ‰å¤åˆå±æ€§çš„å¤åˆå¯¹è±¡","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å»ºé€ è€…æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å»ºé€ è€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å»ºé€ è€…æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--åŸå‹æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--åŸå‹æ¨¡å¼","date":"2020-05-24T08:33:59.000Z","updated":"2023-04-30T10:21:41.356Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--åŸå‹æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--åŸå‹æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯åŸå‹æ¨¡å¼åŸå‹ï¼ˆPrototypeï¼‰æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒé€šè¿‡åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶é‡‡ç”¨æ‹·è´åŸå‹å®ä¾‹çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼åˆ›å»ºçš„å®ä¾‹ï¼Œå…·æœ‰ä¸åŸå‹å®ä¾‹ä¸€æ ·çš„æ•°æ®ã€‚ äºŒã€åŸå‹æ¨¡å¼å®ç°åŸå‹æ¨¡å¼ä¸»è¦ç”¨äºå¯¹è±¡çš„å¤åˆ¶ï¼ŒPrototypeç±»éœ€è¦å…·å¤‡ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶()ï¼š å®ç°Cloneableæ¥å£ã€‚åœ¨javaè¯­è¨€æœ‰ä¸€ä¸ªCloneableæ¥å£ï¼Œå®ƒçš„ä½œç”¨åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯åœ¨è¿è¡Œæ—¶é€šçŸ¥è™šæ‹Ÿæœºå¯ä»¥å®‰å…¨åœ°åœ¨å®ç°äº†æ­¤æ¥å£çš„ç±»ä¸Šä½¿ç”¨cloneæ–¹æ³•ã€‚åœ¨javaè™šæ‹Ÿæœºä¸­ï¼Œåªæœ‰å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»æ‰å¯ä»¥è¢«æ‹·è´ï¼Œå¦åˆ™åœ¨è¿è¡Œæ—¶ä¼šæŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸ã€‚ é‡å†™Objectç±»ä¸­çš„cloneæ–¹æ³•ã€‚Javaä¸­ï¼Œæ‰€æœ‰ç±»çš„çˆ¶ç±»éƒ½æ˜¯Objectç±»ï¼ŒObjectç±»ä¸­æœ‰ä¸€ä¸ªcloneæ–¹æ³•ï¼Œä½œç”¨æ˜¯è¿”å›å¯¹è±¡çš„ä¸€ä¸ªæ‹·è´ï¼Œä½†æ˜¯å…¶ä½œç”¨åŸŸprotectedç±»å‹çš„ï¼Œä¸€èˆ¬çš„ç±»æ— æ³•è°ƒç”¨ï¼Œå› æ­¤ï¼ŒPrototypeç±»éœ€é‡å†™cloneæ–¹æ³•å¹¶å°†çš„æ–¹æ³•çš„ä½œç”¨åŸŸä¿®æ”¹ä¸ºpublicç±»å‹ã€‚ åŸå‹æ¨¡å¼æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„æ¨¡å¼ï¼Œä¹Ÿéå¸¸å®¹æ˜“ç†è§£ï¼Œå®ç°ä¸€ä¸ªæ¥å£ï¼Œé‡å†™ä¸€ä¸ªæ–¹æ³•å³å®Œæˆäº†åŸå‹æ¨¡å¼ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒåŸå‹æ¨¡å¼å¾ˆå°‘å•ç‹¬å‡ºç°ï¼Œç»å¸¸ä¸å…¶ä»–æ¨¡å¼æ··ç”¨ï¼Œä»–çš„åŸå‹ç±»Prototypeä¹Ÿå¸¸ç”¨æŠ½è±¡ç±»æ¥æ›¿ä»£ã€‚ åŸå‹æ¨¡å¼çš„è¡¨ç°å½¢å¼ï¼š ç®€å•å½¢å¼ ç™»è®°å½¢å¼ ç®€å•å½¢å¼Prototypeç±»ä¸ºæŠ½è±¡æ—¶ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚æŠ½è±¡åŸå‹è§’è‰²ï¼šéœ€å®ç°Cloneableæ¥å£ï¼Œå¹¶ä¸ºå­ç±»æä¾›å…¬å…±æ–¹æ³•ã€‚ public abstract class Prototype implements Cloneable { /** * ä¸ºå­ç±»æä¾›ä¸€ä¸ªå¤åˆ¶æ–¹æ³• */ protected abstract Prototype clone(); /** * ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ä¸ºæµ‹è¯•ç”¨ï¼Œä¸ºæ¯ä¸€ä¸ªPrototypeå–ä¸Šåå­—ï¼Œæ–¹ä¾¿åŒºåˆ† */ protected abstract String getName(); protected abstract void setName(String name); } å…·ä½“åŸå‹è§’è‰²ï¼šéœ€ç»§æ‰¿è‡ªæŠ½è±¡åŸå‹ç±»ï¼Œå¹¶å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ã€‚ public class ConcretePrototypeA extends Prototype { /** * ä¸ºConcretePrototypeAçš„å®ä¾‹å¢åŠ ä¸€ä¸ªnameå±æ€§ï¼Œæ–¹ä¾¿åŒºåˆ† */ protected String name; @Override public String getName() { return name; } @Override public void setName(String name) { this.name = name; } /** * å®ç°cloneæ–¹æ³• */ @Override public Prototype clone() { Prototype prototype = new ConcretePrototypeA(); prototype.setName(this.name); System.out.println(&quot;ConcretePrototypeAåˆ›å»ºå®Œæˆï¼&quot;); return prototype; } } public class ConcretePrototypeB extends Prototype { /** * ä¸ºConcretePrototypeAçš„å®ä¾‹å¢åŠ ä¸€ä¸ªnameå±æ€§ï¼Œæ–¹ä¾¿åŒºåˆ† */ protected String name; @Override public String getName() { return name; } @Override public void setName(String name) { this.name = name; } /** * å®ç°cloneæ–¹æ³• */ @Override protected Prototype clone() { Prototype prototype = new ConcretePrototypeB(); prototype.setName(this.name); System.out.println(&quot;ConcretePrototypeBåˆ›å»ºå®Œæˆï¼&quot;); return prototype; } } åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æµ‹è¯•ä¸€ä¸‹ï¼š public class Client{ public static void main(String[] args) { /** * æµ‹è¯•ä»£ç ï¼Œé¦–å…ˆåˆ›å»ºå¥½ä¸¤ä¸ªåŸå‹å®ä¾‹ï¼Œä»¥ååˆ›å»ºæ–°çš„Prototypeå¯¹è±¡å°±é å¤åˆ¶å®ƒäº† */ Prototype prototypeA=null; Prototype prototypeB=null; /** * ä¸ºåŸå‹å®ä¾‹èµ·ä¸ªåå­— */ prototypeA=new ConcretePrototypeA(); prototypeA.setName(&quot;A1&quot;); /** * ä¸ºåŸå‹å®ä¾‹èµ·ä¸ªåå­— */ prototypeB=new ConcretePrototypeB(); prototypeB.setName(&quot;B1&quot;); /** * å¤åˆ¶å®ä¾‹ */ Prototype copyA=prototypeA.clone(); Prototype copyB=prototypeB.clone(); /** * çœ‹çœ‹æ–°å¤åˆ¶çš„å®ä¾‹åå­—æ˜¯å¦å’ŒåŸå‹ä¸€æ · */ System.out.println(&quot;åŸå‹Açš„åå­—ï¼š&quot;+prototypeA.getName()); System.out.println(&quot;åŸå‹Bçš„åå­—ï¼š&quot;+prototypeB.getName()); System.out.println(&quot;æ‹·è´Açš„åå­—ï¼š&quot;+copyA.getName()); System.out.println(&quot;æ‹·è´Bçš„åå­—ï¼š&quot;+copyB.getName()); /** * çœ‹çœ‹æ˜¯ä¸æ˜¯çœŸæ­£çš„å¤åˆ¶äº†ä¸€ä»½ */ copyA.setName(&quot;å¤‡ä»½A1&quot;); System.out.println(&quot;æ‹·è´Açš„åå­—ï¼š&quot;+copyA.getName()); System.out.println(&quot;åŸå‹Açš„åå­—ï¼š&quot;+prototypeA.getName()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š ConcretePrototypeAåˆ›å»ºå®Œæˆï¼ConcretePrototypeBåˆ›å»ºå®Œæˆï¼åŸå‹Açš„åå­—ï¼šA1åŸå‹Bçš„åå­—ï¼šB1æ‹·è´Açš„åå­—ï¼šA1æ‹·è´Bçš„åå­—ï¼šB1æ‹·è´Açš„åå­—ï¼šå¤‡ä»½A1åŸå‹Açš„åå­—ï¼šA1 ç”±æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨å¯¹æ‹·è´Açš„nameå±æ€§è¿›è¡Œä¿®æ”¹å¹¶æœªå½±å“åŸå‹å¯¹è±¡ï¼Œæ‹·è´Aç¡®å®æ˜¯å¤åˆ¶è€Œæ¥çš„æ–°å¯¹è±¡ã€‚ ä½¿ç”¨åŸå‹æ¨¡å¼åˆ›å»ºå¯¹è±¡æ— éœ€å…³å¿ƒè¿™ä¸ªå®ä¾‹æœ¬èº«çš„ç±»å‹ï¼Œåªè¦å®ƒå®ç°äº†cloneæ–¹æ³•ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–æ–°çš„å¯¹è±¡ï¼Œè€Œæ— é¡»å†å»é€šè¿‡newæ¥åˆ›å»ºã€‚ ç™»è®°å½¢å¼è¯¥å½¢å¼ä¸ç®€å•å½¢å¼çš„åŒºåˆ«åœ¨äºå¤šå¢åŠ äº†ä¸€ä¸ªPrototypeManager(åŸå‹ç®¡ç†å™¨)è§’è‰²ï¼Œè¯¥è§’è‰²å¯¹è¦å¤åˆ¶çš„åŸå‹å¯¹è±¡è¿›è¡Œç™»è®°ç®¡ç†ï¼Œè¿™ä¸ªè§’è‰²æä¾›å¿…è¦çš„æ–¹æ³•ä¾›å¤–ç•Œå¢åŠ æ–°çš„åŸå‹å¯¹è±¡å’Œå–å¾—å·²ç»ç™»è®°è¿‡çš„åŸå‹å¯¹è±¡ã€‚ è¯¥å½¢å¼çš„æŠ½è±¡åŸå‹è§’è‰²Prototypeã€å…·ä½“åŸå‹è§’è‰²ConcretePrototypeAã€å…·ä½“åŸå‹è§’è‰²ConcretePrototypeBä¸ç®€å•å½¢å¼å®Œå…¨ç›¸åŒã€‚ åŸå‹ç®¡ç†å™¨è§’è‰²ï¼šæ­¤å¤„ä»¥Mapä¸ºå®¹å™¨å¯¹è¦å¤åˆ¶çš„åŸå‹è¿›è¡Œå­˜å‚¨ç™»è®°ï¼ŒPrototypeManagerç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ import java.util.HashMap; import java.util.Map; public class PrototypeManager { /** * æ­¤å¤„ä»¥Mapä¸ºä¾‹ï¼Œä¸ºæ¯ä¸€ä¸ªè¦å¤åˆ¶çš„åŸå‹å®ä¾‹è¿›è¡Œå­˜å‚¨ç™»è®° */ private static Map&lt;String, Prototype&gt; map = new HashMap&lt;String, Prototype&gt;(); /** * ç§æœ‰åŒ–æ„é€ æ–¹æ³•ï¼Œé¿å…å¤–éƒ¨åˆ›å»ºç®¡ç†å™¨ */ private PrototypeManager() { } /** * å‘åŸå‹ç®¡ç†å™¨é‡Œé¢ç™»è®°åŸå‹å¯¹è±¡æˆ–æ˜¯ä¿®æ”¹æŸä¸ªåŸå‹å¯¹è±¡ç™»è®°ä¿¡æ¯ * * @param prototypeIndex * åŸå‹ç´¢å¼• * @param prototype * åŸå‹å®ä¾‹ */ public synchronized static void setPrototype(String prototypeIndex, Prototype prototype) { map.put(prototypeIndex, prototype); } /** * ä»åŸå‹ç®¡ç†å™¨é‡Œé¢åˆ é™¤æŸä¸ªç™»è®°å¥½çš„åŸå‹å¯¹è±¡ * * @param prototypeIndex * åŸå‹ç´¢å¼• */ public synchronized static void removePrototype(String prototypeIndex) { map.remove(prototypeIndex); } /** * è·å–æŸä¸ªåŸå‹ç´¢å¼•å¯¹åº”çš„åŸå‹å®ä¾‹ * * @param prototypeIndex * åŸå‹ç´¢å¼• * @return åŸå‹ç´¢å¼•å¯¹åº”çš„åŸå‹å®ä¾‹ * @throws Exception * å¦‚æœåŸå‹ç´¢å¼•å¯¹åº”çš„å®ä¾‹ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ */ public synchronized static Prototype getPrototype(String prototypeIndex) throws Exception { Prototype prototype = map.get(prototypeIndex); if (prototype == null) { throw new Exception(&quot;è¯¥åŸå‹å®ä¾‹ä¸å­˜åœ¨ï¼&quot;); } return prototype; } } å†åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯æ¥æµ‹è¯•ä¸€ä¸‹ï¼š public class MainClass { public static void main(String[] args) throws Exception { /** * æµ‹è¯•ä»£ç ï¼Œé¦–å…ˆåˆ›å»ºå¥½ä¸¤ä¸ªåŸå‹å®ä¾‹ï¼Œä»¥ååˆ›å»ºæ–°çš„Prototypeå¯¹è±¡å°±é å¤åˆ¶å®ƒäº† */ Prototype prototypeA = null; Prototype prototypeB = null; /** * ä¸ºåŸå‹å®ä¾‹èµ·ä¸ªåå­— */ prototypeA = new ConcretePrototypeA(); prototypeA.setName(&quot;A&quot;); /** * ä¸ºåŸå‹å®ä¾‹èµ·ä¸ªåå­— */ prototypeB = new ConcretePrototypeB(); prototypeB.setName(&quot;B&quot;); /** * å°†åˆ›å»ºå¥½çš„åŸå‹å®ä¾‹åœ¨PrototypeManagerä¸­è¿›è¡Œç™»è®° */ PrototypeManager.setPrototype(&quot;A&quot;, prototypeA); PrototypeManager.setPrototype(&quot;B&quot;, prototypeB); /** * ä½¿ç”¨PrototypeManageræ¥å¯¹ç™»è®°å¥½çš„åŸå‹è¿›è¡Œé€‰æ‹©å¤åˆ¶ æˆ‘æƒ³è¦ä»¥ name ä¸º &quot;A&quot; çš„åŸå‹ä¸ºæ¨¡æ¿è¿›è¡Œå¤åˆ¶ */ Prototype copyA = PrototypeManager.getPrototype(&quot;A&quot;).clone(); /** * ä½¿ç”¨PrototypeManageræ¥å¯¹ç™»è®°å¥½çš„åŸå‹è¿›è¡Œé€‰æ‹©å¤åˆ¶ æˆ‘æƒ³è¦ä»¥ name ä¸º &quot;B&quot; çš„åŸå‹ä¸ºæ¨¡æ¿è¿›è¡Œå¤åˆ¶ */ Prototype copyB = PrototypeManager.getPrototype(&quot;B&quot;).clone(); /** * çœ‹çœ‹æ–°å¤åˆ¶çš„å®ä¾‹åå­—æ˜¯å¦å’Œä½ æƒ³è¦çš„ä¸€æ · */ System.out.println(&quot;åŸå‹Açš„åå­—ï¼š&quot; + prototypeA.getName()); System.out.println(&quot;åŸå‹Bçš„åå­—ï¼š&quot; + prototypeB.getName()); System.out.println(&quot;æ‹·è´Açš„åå­—ï¼š&quot; + copyA.getName()); System.out.println(&quot;æ‹·è´Bçš„åå­—ï¼š&quot; + copyB.getName()); /** * çœ‹çœ‹æ˜¯ä¸æ˜¯çœŸæ­£çš„å¤åˆ¶äº†ä¸€ä»½ */ copyA.setName(&quot;å¤‡ä»½A1&quot;); System.out.println(&quot;æ‹·è´Açš„åå­—ï¼š&quot; + copyA.getName()); System.out.println(&quot;åŸå‹Açš„åå­—ï¼š&quot; + prototypeA.getName()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š ConcretePrototypeAåˆ›å»ºå®Œæˆï¼ConcretePrototypeBåˆ›å»ºå®Œæˆï¼åŸå‹Açš„åå­—ï¼šAåŸå‹Bçš„åå­—ï¼šBæ‹·è´Açš„åå­—ï¼šAæ‹·è´Bçš„åå­—ï¼šBæ‹·è´Açš„åå­—ï¼šå¤‡ä»½A1åŸå‹Açš„åå­—ï¼šA ä½¿ç”¨ç™»è®°å½¢å¼åŸå‹æ¨¡å¼åœ¨è¦å¤åˆ¶çš„åŸå‹å®ä¾‹ç§ç±»æ¯”è¾ƒå¤šè€Œä¸”è¦ä½¿ç”¨çš„åŸå‹å®ä¾‹ç»å¸¸å˜åŒ–çš„æƒ…å†µä¸‹æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½ åªè¦å†™å¥½åŸå‹å®ä¾‹å¹¶åœ¨åŸå‹ç®¡ç†å™¨ä¸­ç™»è®°å¥½(èµ·ä¸€ä¸ªè‡ªå·±èƒ½å¤ŸåŒºåˆ†çš„åå­—ä½œç´¢å¼•)ï¼Œè¦å¤åˆ¶å“ªä¸ªåŸå‹å°±ä»ç®¡ç†å™¨ç›´æ¥è·å–ã€‚ ä¸‰ã€Javaä¸­çš„æ·±æ‹·è´ä¸æµ…æ‹·è´(æˆ–æ·±åº¦å…‹éš†ä¸æµ…åº¦å…‹éš†)Javaçš„æ‰€æœ‰ç±»éƒ½æ˜¯ä»java.lang.Objectç±»ç»§æ‰¿è€Œæ¥çš„ï¼Œè€ŒObjectç±»æä¾›protected Object clone()æ–¹æ³•å¯¹å¯¹è±¡è¿›è¡Œå¤åˆ¶ï¼Œä½†Objectç±»çš„cloneæ–¹æ³•åªä¼šæ‹·è´å¯¹è±¡ä¸­çš„åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¯¹äºæ•°ç»„ã€å®¹å™¨å¯¹è±¡ã€å¼•ç”¨ç±»å‹å¯¹è±¡ç­‰éƒ½ä¸ä¼šæ‹·è´ï¼Œè¿™å°±æ˜¯æ‰€è°“æµ…æ‹·è´ã€‚å¦‚æœè¦å®ç°æ·±æ‹·è´ï¼Œå¿…é¡»å°†åŸå‹æ¨¡å¼ä¸­çš„æ•°ç»„ã€å®¹å™¨å¯¹è±¡ã€å¼•ç”¨å¯¹è±¡ç­‰å¦è¡Œæ‹·è´ã€‚ æ³¨æ„äº‹é¡¹: Javaè¯­è¨€æä¾›çš„Cloneableæ¥å£åªèµ·ä¸€ä¸ªä½œç”¨ï¼Œå°±æ˜¯åœ¨è¿è¡Œæ—¶æœŸé€šçŸ¥Javaè™šæ‹Ÿæœºå¯ä»¥å®‰å…¨åœ°åœ¨è¿™ä¸ªç±»ä¸Šä½¿ç”¨clone()æ–¹æ³•ã€‚é€šè¿‡è°ƒç”¨è¿™ä¸ªclone()æ–¹æ³•å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯¹è±¡çš„å¤åˆ¶ã€‚ç”±äºObjectç±»æœ¬èº«å¹¶ä¸å®ç°Cloneableæ¥å£ï¼Œå› æ­¤å¦‚æœæ‰€è€ƒè™‘çš„ç±»æ²¡æœ‰å®ç°Cloneableæ¥å£æ—¶ï¼Œè°ƒç”¨clone()æ–¹æ³•ä¼šæŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸ã€‚ ä½¿ç”¨åŸå‹æ¨¡å¼å¤åˆ¶å¯¹è±¡ä¸ä¼šè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ã€‚å› ä¸ºå¯¹è±¡çš„å¤åˆ¶æ˜¯é€šè¿‡è°ƒç”¨Objectç±»çš„cloneæ–¹æ³•æ¥å®Œæˆçš„ï¼Œå®ƒç›´æ¥åœ¨å†…å­˜ä¸­å¤åˆ¶æ•°æ®ï¼Œå› æ­¤ä¸ä¼šè°ƒç”¨åˆ°ç±»çš„æ„é€ æ–¹æ³•ã€‚ä¸ä½†æ„é€ æ–¹æ³•ä¸­çš„ä»£ç ä¸ä¼šæ‰§è¡Œï¼Œç”šè‡³è¿è®¿é—®æƒé™éƒ½å¯¹åŸå‹æ¨¡å¼æ— æ•ˆã€‚è¿˜è®°å¾—å•ä¾‹æ¨¡å¼å—ï¼Ÿå•ä¾‹æ¨¡å¼ä¸­ï¼Œåªè¦å°†æ„é€ æ–¹æ³•çš„è®¿é—®æƒé™è®¾ç½®ä¸ºprivateå‹ï¼Œå°±å¯ä»¥å®ç°å•ä¾‹ã€‚ä½†æ˜¯cloneæ–¹æ³•ç›´æ¥æ— è§†æ„é€ æ–¹æ³•çš„æƒé™ï¼Œæ‰€ä»¥ï¼Œå•ä¾‹æ¨¡å¼ä¸åŸå‹æ¨¡å¼æ˜¯å†²çªçš„ï¼Œåœ¨ä½¿ç”¨æ—¶è¦ç‰¹åˆ«æ³¨æ„ã€‚ æŠŠå¯¹è±¡å†™åˆ°æµé‡Œçš„è¿‡ç¨‹æ˜¯åºåˆ—åŒ–(Serialization)è¿‡ç¨‹ï¼›è€ŒæŠŠå¯¹è±¡ä»æµä¸­è¯»å‡ºæ¥çš„è¿‡ç¨‹åˆ™å«ååºåˆ—åŒ–(Deserialization)è¿‡ç¨‹ã€‚åº”å½“æŒ‡å‡ºçš„æ˜¯ï¼Œå†™åˆ°æµé‡Œçš„æ˜¯å¯¹è±¡çš„ä¸€ä¸ªæ‹·è´ï¼Œè€ŒåŸå¯¹è±¡ä»ç„¶å­˜åœ¨äºJVMé‡Œé¢ã€‚ åœ¨Javaè¯­è¨€é‡Œæ·±åº¦å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼Œå¸¸å¸¸å¯ä»¥å…ˆä½¿å¯¹è±¡å®ç°Serializableæ¥å£ï¼Œç„¶åæŠŠå¯¹è±¡ï¼ˆå®é™…ä¸Šåªæ˜¯å¯¹è±¡çš„æ‹·è´ï¼‰å†™åˆ°ä¸€ä¸ªæµé‡Œï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œå†ä»æµé‡Œè¯»å›æ¥ï¼ˆååºåˆ—åŒ–ï¼‰ï¼Œä¾¿å¯ä»¥é‡å»ºå¯¹è±¡ã€‚ åˆ©ç”¨åºåˆ—åŒ–å®ç°æ·±åº¦å…‹éš†ï¼šå…ˆåˆ›å»ºä¸€ä¸ªPersonç±»ï¼Œè¯¥ç±»éœ€å®ç°Serializableæ¥å£ï¼Œä¸ºæµ‹è¯•å…¶æ˜¯å¦ä¸ºæ·±æ‹·è´ä¸ºå…¶æ·»åŠ ä¸€ä¸ªListå®¹å™¨å±æ€§familyï¼Œä»£ç å¦‚ä¸‹ã€‚ import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.IOException; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.io.Serializable; import java.util.List; @SuppressWarnings(&quot;serial&quot;) public class Person implements Serializable{ // å§“å private String name; // å®¶åº­æˆå‘˜ private List&lt;String&gt; family; public String getName() { return name; } public void setName(String name) { this.name = name; } public List&lt;String&gt; getFamily() { return family; } public void setFamily(List&lt;String&gt; family) { this.family = family; } public Person serializationClone() throws IOException, ClassNotFoundException { // å°†å¯¹è±¡å†™åˆ°æµé‡Œ ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(bos); oos.writeObject(this); // ä»æµé‡Œè¯»å›æ¥ ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bis); return (Person) ois.readObject(); } } ä¾æ—§åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ç±»æ¥æµ‹è¯•ã€‚ import java.util.ArrayList; import java.util.List; public class MainClass { public static void main(String[] args) throws Exception { /** * åˆ›å»ºä¸€ä¸ªåŸå‹å®ä¾‹å¯¹è±¡ï¼Œä»¥åå¤åˆ¶å®ƒ */ Person person = new Person(); /** * ä¸ºåŸå‹å®ä¾‹å¯¹è±¡èµ·ä¸ªåå­— */ person.setName(&quot;demo&quot;); /** * ç»™åŸå‹å®ä¾‹å¯¹è±¡æ·»åŠ å¥½å®¶äººï¼Œä»¥æµ‹è¯•serializationClone()æ–¹æ³•æ˜¯å¦å¯¹å¼•ç”¨ç±»å‹å¯¹è±¡è¿›è¡Œå¤åˆ¶ */ List&lt;String&gt; family = new ArrayList&lt;String&gt;(); family.add(&quot;wife&quot;); family.add(&quot;child&quot;); person.setFamily(family); /** * ä½¿ç”¨serializationClone()æ–¹æ³•è¿›è¡Œå¤åˆ¶ */ Person copyPerson=person.serializationClone(); /** * æŸ¥çœ‹å¤åˆ¶å¥½çš„å¯¹è±¡æ˜¯å¦å’ŒåŸå‹å®ä¾‹ç›¸åŒ */ System.out.println(&quot;åŸå‹å®ä¾‹çš„åå­—:&quot;+person.getName()); System.out.println(&quot;åŸå‹å®ä¾‹çš„å®¶äºº:&quot;+person.getFamily()); System.out.println(&quot;å¤åˆ¶å¯¹è±¡çš„åå­—:&quot;+copyPerson.getName()); System.out.println(&quot;å¤åˆ¶å¯¹è±¡çš„å®¶äºº:&quot;+copyPerson.getFamily()); /** * å¯¹å¤åˆ¶å¥½çš„å¯¹è±¡å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œè¿›ä¸€æ­¥æµ‹è¯•è¯¥å¯¹è±¡æ˜¯å¦æ˜¯çœŸæ­£çš„å¤‡ä»½ */ copyPerson.setName(&quot;copy-demo&quot;); List&lt;String&gt; copyFamily = new ArrayList&lt;String&gt;(); copyFamily.add(&quot;copy-wife&quot;); copyFamily.add(&quot;copy-child&quot;); copyPerson.setFamily(copyFamily); /** * æ‰“å°ä¿®æ”¹åçš„å¤åˆ¶å¯¹è±¡å’ŒåŸå‹å¯¹è±¡ */ System.out.println(&quot;å¤åˆ¶å¯¹è±¡ä¿®æ”¹åçš„åå­—:&quot;+copyPerson.getName()); System.out.println(&quot;å¤åˆ¶å¯¹è±¡ä¿®æ”¹åçš„å®¶äºº:&quot;+copyPerson.getFamily()); System.out.println(&quot;åŸå‹å®ä¾‹çš„åå­—:&quot;+person.getName()); System.out.println(&quot;åŸå‹å®ä¾‹çš„å®¶äºº:&quot;+person.getFamily()); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š åŸå‹å®ä¾‹çš„åå­—:demoåŸå‹å®ä¾‹çš„å®¶äºº:[wife, child]å¤åˆ¶å¯¹è±¡çš„åå­—:demoå¤åˆ¶å¯¹è±¡çš„å®¶äºº:[wife, child]å¤åˆ¶å¯¹è±¡ä¿®æ”¹åçš„åå­—:copy-demoå¤åˆ¶å¯¹è±¡ä¿®æ”¹åçš„å®¶äºº:[copy-wife, copy-child]åŸå‹å®ä¾‹çš„åå­—:demoåŸå‹å®ä¾‹çš„å®¶äºº:[wife, child] å¤§åŠŸå‘Šæˆï¼ŒpersonåŸå‹å¯¹è±¡è¢«å®Œç¾æ·±åº¦å¤åˆ¶äº†ã€‚ è¿™æ ·åšçš„å‰æå°±æ˜¯å¯¹è±¡ä»¥åŠå¯¹è±¡å†…éƒ¨æ‰€æœ‰å¼•ç”¨åˆ°çš„å¯¹è±¡éƒ½æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™ï¼Œå°±éœ€è¦ä»”ç»†è€ƒå¯Ÿé‚£äº›ä¸å¯åºåˆ—åŒ–çš„å¯¹è±¡å¯å¦è®¾æˆtransientï¼Œä»è€Œå°†ä¹‹æ’é™¤åœ¨å¤åˆ¶è¿‡ç¨‹ä¹‹å¤–ã€‚ æµ…æ‹·è´æ˜¾ç„¶æ¯”æ·±æ‹·è´æ›´å®¹æ˜“å®ç°ï¼Œå› ä¸ºJavaè¯­è¨€çš„æ‰€æœ‰ç±»éƒ½ä¼šç»§æ‰¿ä¸€ä¸ªclone()æ–¹æ³•ï¼Œè€Œè¿™ä¸ªclone()æ–¹æ³•æ‰€åšçš„æ­£æ˜¯æµ…æ‹·è´ã€‚ æœ‰ä¸€äº›å¯¹è±¡ï¼Œæ¯”å¦‚çº¿ç¨‹(Thread)å¯¹è±¡æˆ–Socketå¯¹è±¡ï¼Œæ˜¯ä¸èƒ½ç®€å•å¤åˆ¶æˆ–å…±äº«çš„ã€‚ä¸ç®¡æ˜¯ä½¿ç”¨æµ…åº¦å…‹éš†è¿˜æ˜¯æ·±åº¦å…‹éš†ï¼Œåªè¦æ¶‰åŠè¿™æ ·çš„é—´æ¥å¯¹è±¡ï¼Œå°±å¿…é¡»æŠŠé—´æ¥å¯¹è±¡è®¾æˆtransientè€Œä¸äºˆå¤åˆ¶ï¼›æˆ–è€…ç”±ç¨‹åºè‡ªè¡Œåˆ›å»ºå‡ºç›¸å½“çš„åŒç§å¯¹è±¡ï¼Œæƒä¸”å½“åšå¤åˆ¶ä»¶ä½¿ç”¨ã€‚ å››ã€åŸå‹æ¨¡å¼åº”ç”¨åœºæ™¯åœ¨ä»¥ä¸‹æƒ…å†µå¯ä»¥è€ƒè™‘ä½¿ç”¨åŸå‹æ¨¡å¼ï¼š åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åªæ˜¯å¸Œæœ›è¢«åˆ›å»ºçš„å¯¹è±¡ç»§æ‰¿å…¶åŸºç±»çš„åŸºæœ¬ç»“æ„ï¼Œè¿˜å¸Œæœ›ç»§æ‰¿åŸå‹å¯¹è±¡çš„æ•°æ®ã€‚ å¸Œæœ›å¯¹ç›®æ ‡å¯¹è±¡çš„ä¿®æ”¹ä¸å½±å“æ—¢æœ‰çš„åŸå‹å¯¹è±¡ï¼ˆæ·±åº¦å…‹éš†çš„æ—¶å€™å¯ä»¥å®Œå…¨äº’ä¸å½±å“ï¼‰ã€‚ éšè—å…‹éš†æ“ä½œçš„ç»†èŠ‚ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå¯¹å¯¹è±¡æœ¬èº«çš„å…‹éš†éœ€è¦æ¶‰åŠåˆ°ç±»æœ¬èº«çš„æ•°æ®ç»†èŠ‚ã€‚ äº”ã€åŸå‹æ¨¡å¼çš„ç‰¹ç‚¹ ç”±åŸå‹å¯¹è±¡è‡ªèº«åˆ›å»ºç›®æ ‡å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡åˆ›å»ºè¿™ä¸€åŠ¨ä½œå‘è‡ªåŸå‹å¯¹è±¡æœ¬èº«ã€‚ ç›®æ ‡å¯¹è±¡æ˜¯åŸå‹å¯¹è±¡çš„ä¸€ä¸ªå…‹éš†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡Prototypeæ¨¡å¼åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸ä»…ä»…ä¸åŸå‹å¯¹è±¡å…·æœ‰ç›¸åŒçš„ç»“æ„ï¼Œè¿˜ä¸åŸå‹å¯¹è±¡å…·æœ‰ç›¸åŒçš„å€¼ã€‚ æ ¹æ®å¯¹è±¡å…‹éš†æ·±åº¦å±‚æ¬¡çš„ä¸åŒï¼Œæœ‰æµ…åº¦å…‹éš†ä¸æ·±åº¦å…‹éš†ã€‚ ä¼˜ç‚¹ï¼š ä½¿ç”¨åŸå‹æ¨¡å¼åˆ›å»ºå¯¹è±¡æ¯”ç›´æ¥newä¸€ä¸ªå¯¹è±¡åœ¨æ€§èƒ½ä¸Šè¦å¥½çš„å¤šï¼Œå› ä¸ºObjectç±»çš„cloneæ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ƒç›´æ¥æ“ä½œå†…å­˜ä¸­çš„äºŒè¿›åˆ¶æµï¼Œç‰¹åˆ«æ˜¯å¤åˆ¶å¤§å¯¹è±¡æ—¶ï¼Œæ€§èƒ½çš„å·®åˆ«éå¸¸æ˜æ˜¾ã€‚ ä½¿ç”¨åŸå‹æ¨¡å¼çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºï¼Œä½¿å¾—åˆ›å»ºå¯¹è±¡å°±åƒæˆ‘ä»¬åœ¨ç¼–è¾‘æ–‡æ¡£æ—¶çš„å¤åˆ¶ç²˜è´´ä¸€æ ·ç®€å•ã€‚ å› ä¸ºä»¥ä¸Šä¼˜ç‚¹ï¼Œæ‰€ä»¥åœ¨éœ€è¦é‡å¤åœ°åˆ›å»ºç›¸ä¼¼å¯¹è±¡æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨åŸå‹æ¨¡å¼ã€‚æ¯”å¦‚éœ€è¦åœ¨ä¸€ä¸ªå¾ªç¯ä½“å†…åˆ›å»ºå¯¹è±¡ï¼Œå‡å¦‚å¯¹è±¡åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚æˆ–è€…å¾ªç¯æ¬¡æ•°å¾ˆå¤šçš„è¯ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼ä¸ä½†å¯ä»¥ç®€åŒ–åˆ›å»ºè¿‡ç¨‹ï¼Œè€Œä¸”å¯ä»¥ä½¿ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½æé«˜å¾ˆå¤šã€‚ ç¼ºç‚¹ï¼š åŸå‹æ¨¡å¼æœ€ä¸»è¦çš„ç¼ºç‚¹æ˜¯æ¯ä¸€ä¸ªç±»éƒ½å¿…é¡»é…å¤‡ä¸€ä¸ªå…‹éš†æ–¹æ³•ã€‚é…å¤‡å…‹éš†æ–¹æ³•éœ€è¦å¯¹ç±»çš„åŠŸèƒ½è¿›è¡Œé€šç›˜è€ƒè™‘ï¼Œè¿™å¯¹äºå…¨æ–°çš„ç±»æ¥è¯´ä¸æ˜¯å¾ˆéš¾ï¼Œè€Œå¯¹äºå·²ç»æœ‰çš„ç±»ä¸ä¸€å®šå¾ˆå®¹æ˜“ï¼Œç‰¹åˆ«æ˜¯å½“ä¸€ä¸ªç±»å¼•ç”¨ä¸æ”¯æŒåºåˆ—åŒ–çš„é—´æ¥å¯¹è±¡ï¼Œæˆ–è€…å¼•ç”¨å«æœ‰å¾ªç¯ç»“æ„çš„æ—¶å€™ã€‚ å‚è€ƒæ–‡ç« http://www.cnblogs.com/java-my-life/archive/2012/04/11/2439387.html http://blog.csdn.net/jason0539/article/details/23158081","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"åŸå‹æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"åŸå‹æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/åŸå‹æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--å•ä¾‹æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--å•ä¾‹æ¨¡å¼","date":"2020-05-24T08:32:06.000Z","updated":"2023-04-30T10:21:41.355Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å•ä¾‹æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å•ä¾‹æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼å•ä¾‹ï¼ˆSingletonï¼‰æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ï¼Œä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼ŒåŒæ—¶è¯¥ç±»æä¾›èƒ½å¯¹è¯¥å®ä¾‹åŠ ä»¥è®¿é—®çš„å…¨å±€è®¿é—®æ–¹æ³•ã€‚ å•ä¾‹æ¨¡å¼çš„æœ¬è´¨ï¼šæ§åˆ¶å®ä¾‹ä¸ªæ•° è®¾è®¡æ„å›¾ï¼šä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œå¯ä»¥ä¿è¯ä¸ºä¸€ä¸ªç±»åªç”Ÿæˆå”¯ä¸€çš„å®ä¾‹å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•´ä¸ªç¨‹åºç©ºé—´ä¸­ï¼Œè¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚ äºŒã€å•ä¾‹æ¨¡å¼çš„åº”ç”¨åœºæ™¯å¦‚æœç¢°åˆ°ä»¥ä¸‹æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼š åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œæ¯”å¦‚servletç¯å¢ƒï¼Œéœ€å…±äº«åŒä¸€ä¸ªèµ„æºæˆ–è€…æ“ä½œåŒä¸€ä¸ªå¯¹è±¡ã€‚ åœ¨æ•´ä¸ªç¨‹åºç©ºé—´ä½¿ç”¨çš„å…¨å±€å˜é‡ï¼Œå…±äº«èµ„æºç­‰ã€‚ å¤§è§„æ¨¡ç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ€§èƒ½çš„è€ƒè™‘ï¼Œéœ€è¦èŠ‚çœå¯¹è±¡çš„åˆ›å»ºæ—¶é—´ï¼Œç­‰ç­‰â€¦ã€‚ ä¸‰ã€å•ä¾‹æ¨¡å¼å®ç° é¥¿æ±‰å¼ã€‚ æ‡’æ±‰å¼ã€‚ åŒé‡æ£€æŸ¥ã€‚ é¥¿æ±‰å¼ä¸ºä¿è¯å•ä¾‹ç±»åªèƒ½åˆ›å»ºå”¯ä¸€å®ä¾‹éœ€å°†è¯¥ç±»çš„æ„é€ æ–¹æ³•ç§æœ‰åŒ–ä»¥é˜²æ­¢å…¶ä»–ç±»é€šè¿‡æ„é€ æ–¹æ³•æ˜¾å¼åˆ›å»ºå•ä¾‹ç±»å®ä¾‹ï¼Œå¦å¤–å•ä¾‹ç±»éœ€å¯¹å¤–æä¾›ä¸€ä¸ªå…¬å…±çš„å…¨å±€è®¿é—®æ–¹æ³•ä»¥ä½¿å…¶ä»–ç±»å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•è·å–åˆ°å•ä¾‹ç±»çš„å”¯ä¸€å®ä¾‹ï¼Œé¥¿æ±‰å¼ç®€å•ç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚ public class Singleton { private static Singleton singleton= new Singleton(); /** * ç§æœ‰æ„é€ æ–¹æ³• */ private Singleton(){} /** * é™æ€çš„å…¨å±€è®¿é—®æ–¹æ³• */ public static Singleton getSingleton(){ return singleton; } } åœ¨é¥¿æ±‰å¼ä¸­ï¼Œåœ¨ç±»åŠ è½½æ—¶ï¼Œé™æ€å˜é‡singletonä¼šè°ƒç”¨ç±»çš„ç§æœ‰æ„é€ æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™æ—¶å€™ï¼Œå•ä¾‹ç±»çš„å”¯ä¸€å®ä¾‹å°±è¢«åˆ›å»ºå‡ºæ¥äº†ã€‚ é¥¿æ±‰å¼æ˜¯å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´ï¼Œå½“ç±»è£…è½½çš„æ—¶å€™å°±ä¼šåˆ›å»ºç±»çš„å®ä¾‹ï¼Œä¸ç®¡ä½ ç”¨ä¸ç”¨ï¼Œå…ˆåˆ›å»ºå‡ºæ¥ï¼Œç„¶åæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å†åˆ¤æ–­ï¼ŒèŠ‚çœäº†è¿è¡Œæ—¶é—´ã€‚ æ‡’æ±‰å¼ä¸é¥¿æ±‰å¼ä¸åŒï¼Œæ‡’æ±‰å¼å”¯ä¸€å®ä¾‹é‡‡å–äº†å»¶è¿Ÿå®ä¾‹åŒ–çš„æ–¹æ³•ï¼Œå…ˆä¸åˆ›å»ºå®ä¾‹ï¼Œç­‰åˆ°éœ€è¦ç”¨åˆ°å®ä¾‹çš„æ—¶å€™å†åˆ›å»ºã€‚çœŸçš„å¾ˆæ‡’ï¼Œæœ‰æœ¨æœ‰ï¼Ÿå…¶ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚ public class Singleton { private static Singleton singleton = null; /** * ç§æœ‰é»˜è®¤æ„é€ æ–¹æ³• */ private Singleton() { } /** * é™æ€çš„å…¨å±€è®¿é—®æ–¹æ³• */ public static Singleton getSingleton() { if (null == singleton) { singleton = new Singleton(); } return singleton; } } æ‡’æ±‰å¼æ˜¯å…¸å‹çš„æ—¶é—´æ¢ç©ºé—´,å°±æ˜¯æ¯æ¬¡è·å–å®ä¾‹éƒ½ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œçœ‹æ˜¯å¦éœ€è¦åˆ›å»ºå®ä¾‹ï¼Œæµªè´¹æ—¶é—´å»åˆ¤æ–­ã€‚å½“ç„¶ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰äººä½¿ç”¨çš„è¯ï¼Œé‚£å°±ä¸ä¼šåˆ›å»ºå®ä¾‹ï¼Œåˆ™èŠ‚çº¦å†…å­˜ç©ºé—´ã€‚ ä¸Šè¿°æ‡’æ±‰å¼Singletonç±»åœ¨å•çº¿ç¨‹ä¸­æ˜¯å®‰å…¨çš„ï¼Œä½†åœ¨å¤šçº¿ç¨‹ä¸­å­˜åœ¨éšæ‚£ï¼šé¦–æ¬¡è¿è¡Œ singleton=null æ—¶ï¼Œå½“æœ‰çº¿ç¨‹ Aã€B éœ€è°ƒç”¨ getSingleton() è·å–singletonå®ä¾‹æ—¶ï¼Œçº¿ç¨‹Aè¿è¡Œâ€“&gt;è¿›è¡Œåˆ¤æ–­if (null == singleton)*â€“&gt;è¿›å…¥ifè¯­å¥å—ä¸­ï¼Œè¿˜æœªæ¥å¾—åŠåˆå§‹åŒ–æ­¤æ—¶çº¿ç¨‹Açš„è¿è¡Œæ—¶é—´çªç„¶ç»“æŸï¼Œçº¿ç¨‹Bå¼€å§‹è¿è¡Œï¼Œçº¿ç¨‹Bä¹Ÿè¿›è¡Œåˆ¤æ–­if (null == singleton)æ­¤æ—¶çº¿ç¨‹Aè¿˜æœªå¯¹singletonå®Œæˆåˆå§‹åŒ–ï¼Œsingletonä»ä¸ºnullï¼Œçº¿ç¨‹Bä¹Ÿè¿›å…¥ifè¯­å¥å—ä¸­ï¼Œçº¿ç¨‹Bå¯¹singletonè¿›è¡Œåˆå§‹åŒ–å¹¶è·å–åˆ°singletonå®ä¾‹ï¼Œåœ¨çº¿ç¨‹Bç»“æŸè¿è¡Œä¹‹åçº¿ç¨‹Aåˆè¢«å”¤é†’ï¼Œçº¿ç¨‹Aç»§ç»­æ‰§è¡Œå®ƒä¹‹å‰æœªå®Œæˆçš„singletonåˆå§‹åŒ–å·¥ä½œï¼Œåˆå§‹åŒ–å®Œæˆåçº¿ç¨‹Aä¹Ÿè·å¾—äº†singletonå®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹çº¿ç¨‹Aï¼ŒBè·å–åˆ°çš„singletonå®ä¾‹å°±ä¼šæŒ‡å‘ä¸¤ä¸ªä¸åŒçš„Singletonå¯¹è±¡è€Œä¸æ˜¯åŒä¸€å®ä¾‹ã€‚ æ—¢ç„¶ä¸Šè¿°æ‡’æ±‰å¼Singletonç±»åœ¨å¤šçº¿ç¨‹ä¸­æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯ä»¥é€šè¿‡å°†getSingleton()æ–¹æ³•åŒæ­¥åŒ–æ¥è§£å†³ï¼Œä»£ç å¦‚ä¸‹ï¼š public class Singleton { private static Singleton singleton = null; /** * ç§æœ‰é»˜è®¤æ„é€ æ–¹æ³• */ private Singleton() { } /** * é™æ€çš„å…¨å±€è®¿é—®æ–¹æ³• */ public static synchronized Singleton getSingleton() { if (null == singleton) { singleton = new Singleton(); } return singleton; } } è¿™æ ·Singletonç±»è™½ç„¶è§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯åˆå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œç”±äºgetSingleton()æ–¹æ³•è¢«åŒæ­¥åŒ–ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶éœ€è¦è·å–singletonå®ä¾‹æ—¶åªèƒ½ä¸€ä¸ªä¸€ä¸ªçº¿ç¨‹æ’é˜Ÿæ‰§è¡Œï¼Œè¿™æ ·ä¼šé™ä½æ•´ä¸ªè®¿é—®çš„é€Ÿåº¦ã€‚ é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å¯ä»¥æ—¢å¯ä»¥å®ç°æ‡’æ±‰å¼çš„å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œåˆçº¿ç¨‹å®‰å…¨ä¸”ä¸ä¼šé™ä½æ•´ä¸ªç³»ç»Ÿçš„è®¿é—®é€Ÿåº¦å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šåŒé‡æ£€æŸ¥ã€‚ åŒé‡æ£€æŸ¥åŒé‡æ£€æŸ¥å•ä¾‹æ¨¡å¼çš„äº§ç”Ÿæ˜¯ä¸ºäº†è§£å†³æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼åŒæ­¥åŒ–åç³»ç»Ÿæ‰§è¡Œæ•ˆç‡æ…¢çš„é—®é¢˜ï¼Œå…¶ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼Œ public class Singleton { private volatile static Singleton singleton = null; /** * ç§æœ‰é»˜è®¤æ„é€ æ–¹æ³• */ private Singleton() { } /** * é™æ€çš„å…¨å±€è®¿é—®æ–¹æ³• */ public static Singleton getSingleton() { //å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å·²åˆ›å»ºï¼Œå¦‚æœæœªåˆ›å»ºæ‰è¿›å…¥åŒæ­¥å— if (null == singleton) { synchronized (Singleton.class) { //å†æ¬¡æ£€æŸ¥å®ä¾‹æ˜¯å¦å·²åˆ›å»ºï¼Œå¦‚æœçœŸçš„æœªåˆ›å»ºæ‰åˆ›å»ºå®ä¾‹ if (null == singleton) { singleton = new Singleton(); } } } return singleton; } } æ‰€è°“çš„åŒé‡æ£€æŸ¥å³ï¼šè°ƒç”¨getSingleton()æ–¹æ³•æ—¶å…ˆæ£€æŸ¥singletonå®ä¾‹æ˜¯å¦å·²è¢«åˆ›å»ºï¼Œå¦‚æœæœªåˆ›å»ºæ‰è¿›å…¥åŒæ­¥å—ï¼Œè¿™æ˜¯ç¬¬ä¸€é‡æ£€æŸ¥ï¼Œè¿›å…¥åŒæ­¥å—ä¹‹åå†æ¬¡æ£€æŸ¥ç¡®è®¤singletonå®ä¾‹æ˜¯å¦å·²è¢«åˆ›å»ºï¼Œå¦‚æœçœŸçš„æœªè¢«åˆ›å»ºæ‰åˆ›å»ºå®ä¾‹ï¼Œè¿™æ˜¯ç¬¬äºŒé‡æ£€æŸ¥ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŒæ­¥åªåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getSingleton()æ–¹æ³•singleton==nullæ—¶è¿›è¡Œï¼Œä¹‹åæ¯æ¬¡è·å–å®ä¾‹éƒ½æ— éœ€è¿›è¡ŒåŒæ­¥åˆ¤æ–­ï¼Œå‡å°‘äº†åŒæ­¥åˆ¤æ–­æµªè´¹çš„æ—¶é—´ã€‚ â€œåŒé‡æ£€æŸ¥â€æœºåˆ¶çš„å®ç°ä½¿ç”¨äº†å…³é”®å­—volatileï¼Œå®ƒçš„æ„æ€æ˜¯ï¼šè¢«volatileä¿®é¥°çš„å˜é‡çš„å€¼ï¼Œå°†ä¸ä¼šè¢«æœ¬åœ°çº¿ç¨‹ç¼“å­˜ï¼Œæ‰€æœ‰å¯¹è¯¥å˜é‡çš„è¯»å†™éƒ½æ˜¯ç›´æ¥æ“ä½œå…±äº«å†…å­˜ï¼Œä»è€Œç¡®ä¿å¤šä¸ªçº¿ç¨‹èƒ½æ­£ç¡®çš„å¤„ç†è¯¥å˜é‡ã€‚ å››ã€å•ä¾‹æ¨¡å¼çš„ç‰¹ç‚¹ å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚ å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚ å•ä¾‹ç±»å¿…é¡»å‘æ•´ä¸ªç³»ç»Ÿæä¾›å¯¹è¯¥å®ä¾‹åŠ ä»¥è®¿é—®çš„å…¨å±€è®¿é—®æ–¹æ³•ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å•ä¾‹æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å•ä¾‹æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å•ä¾‹æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--æŠ½è±¡å·¥å‚æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--æŠ½è±¡å·¥å‚æ¨¡å¼","date":"2020-05-24T08:25:42.000Z","updated":"2023-04-30T10:21:41.358Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--æŠ½è±¡å·¥å‚æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--æŠ½è±¡å·¥å‚æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯æ‰€æœ‰å½¢æ€çš„å·¥å‚æ¨¡å¼ä¸­æœ€ä¸ºæŠ½è±¡å’Œæœ€å…·ä¸€èˆ¬æ€§çš„ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼å¯ä»¥å‘å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—å®¢æˆ·ç«¯åœ¨ä¸å¿…æŒ‡å®šäº§å“çš„å…·ä½“ç±»å‹çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿåˆ›å»ºå¤šä¸ªäº§å“æ—çš„äº§å“å¯¹è±¡ã€‚ æ­¤å¤„å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µäº§å“æ—ï¼Œé‚£ä»€ä¹ˆæ˜¯äº§å“æ—å‘¢ï¼Ÿç™¾åº¦ä¸€ä¸‹ï¼šäº§å“æ—æ˜¯ä»¥äº§å“å¹³å°ä¸ºåŸºç¡€ï¼Œé€šè¿‡æ·»åŠ ä¸åŒçš„ä¸ªæ€§æ¨¡å—ï¼Œä»¥æ»¡è¶³ä¸åŒå®¢æˆ·ä¸ªæ€§åŒ–éœ€æ±‚çš„ä¸€ç»„ç›¸å…³äº§å“ã€‚ æ‰€è°“äº§å“æ—é€šä¿—æ¥è¯´å³æ˜¯ï¼šå…·æœ‰æŸä¸€å…±æ€§çš„ä¸€ç³»åˆ—ç›¸å…³äº§å“.ä»¥å‰é¢çš„Apple(è‹¹æœ),Banana(é¦™è•‰),Pear(æ¢¨)ä¸ºä¾‹ï¼ŒApple(è‹¹æœ),Banana(é¦™è•‰),Pear(æ¢¨)è¿™ä¸‰ç§æ°´æœå¯¹åº”ä¸Šå›¾ä¸­çš„äº§å“ç­‰çº§ç»“æ„ã€‚ è¿™ä¸‰ç§æ°´æœæœ‰äº§è‡ªå—æ–¹çš„ï¼Œä¹Ÿæœ‰äº§è‡ªåŒ—æ–¹çš„ï¼ŒåŒ—æ–¹å’Œå—æ–¹åˆ™å¯¹åº”ä¸Šå›¾ä¸­çš„äº§å“æ—ï¼Œäº§è‡ªåŒ—æ–¹çš„Apple(è‹¹æœ),Banana(é¦™è•‰),Pear(æ¢¨)å°±æ„æˆä¸€ä¸ªäº§å“æ—ï¼Œå®ƒä»¬çš„å…±æ€§æ˜¯äº§è‡ªåŒ—æ–¹ï¼ŒåŒæ ·äº§è‡ªå—æ–¹çš„Apple(è‹¹æœ),Banana(é¦™è•‰),Pear(æ¢¨)ä¹Ÿæ„æˆäº†ä¸€ä¸ªäº§å“æ—ã€‚ äºŒã€æ¨¡å¼ä¸­åŒ…å«çš„è§’è‰²åŠå…¶èŒè´£ æŠ½è±¡å·¥å‚ï¼ˆFactoryï¼‰è§’è‰²ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒï¼ŒåŒ…å«å¯¹å¤šä¸ªäº§å“ç­‰çº§ç»“æ„çš„å£°æ˜ï¼Œä»»ä½•å·¥å‚ç±»éƒ½å¿…é¡»å®ç°è¿™ä¸ªæ¥å£ã€‚ å…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰è§’è‰²ï¼šå…·ä½“å·¥å‚ç±»æ˜¯æŠ½è±¡å·¥å‚çš„ä¸€ä¸ªå®ç°ï¼Œè´Ÿè´£å®ä¾‹åŒ–æŸä¸ªäº§å“æ—ä¸­çš„äº§å“å¯¹è±¡ã€‚ æŠ½è±¡ï¼ˆProductï¼‰è§’è‰²ï¼šæŠ½è±¡æ¨¡å¼æ‰€åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ï¼Œæˆ–å£°æ˜æ‰€æœ‰å…·ä½“äº§å“æ‰€å…±æœ‰çš„å…¬å…±æ¥å£ã€‚ å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰è§’è‰²ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼æ‰€åˆ›å»ºçš„çœŸæ­£å®ä¾‹ã€‚ æ€»ç»“ï¼šæŠ½è±¡å·¥å‚ä¸­çš„æ–¹æ³•å¯¹åº”äº§å“ç­‰çº§ç»“æ„ï¼Œå…·ä½“å·¥å‚å¯¹åº”äº§å“æ—ã€‚ æ¥ä¸‹æ¥ç”¨ä»£ç è¿›è¡Œè¯´æ˜ï¼šä¿ç•™ä¹‹å‰å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­çš„Fruitæ¥å£ï¼Œç”¨æ¥è´Ÿè´£æè¿°æ‰€æœ‰æ°´æœå®ä¾‹åº”è¯¥å…±æœ‰çš„æ–¹æ³•ã€‚ public interface Fruit { /* * é‡‡é›† */ public void get(); } æ­¤æ—¶Apple(è‹¹æœ)å’ŒBanana(é¦™è•‰)å°†ä¸å†æ˜¯å…·ä½“çš„äº§å“ç±»è€Œæ˜¯æŠ½è±¡ç±»ï¼Œå› ä¸ºå®ƒä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥åˆ’åˆ†åŒ—æ–¹å’Œå—æ–¹ä¸¤ä¸ªäº§å“æ—ã€‚ public abstract class Apple implements Fruit{ /* * é‡‡é›† */ public abstract void get(); } public abstract class Banana implements Fruit{ /* * é‡‡é›† */ public abstract void get(); } å†è¿›ä¸€æ­¥ç»†åˆ†ï¼Œè‹¹æœï¼ˆAppleï¼‰è¢«å…·ä½“åŒ–ä¸ºåŒ—æ–¹è‹¹æœ(NorthApple)å’Œå—æ–¹è‹¹æœ(SouthApple)ã€‚ public class NorthApple extends Apple { public void get() { System.out.println(&quot;é‡‡é›†åŒ—æ–¹è‹¹æœ&quot;); } } public class SouthApple extends Apple { public void get() { System.out.println(&quot;é‡‡é›†å—æ–¹è‹¹æœ&quot;); } } é¦™è•‰(Banana)è¢«å…·ä½“åŒ–ä¸ºåŒ—æ–¹é¦™è•‰(NorthBanana)å’Œå—æ–¹é¦™è•‰(SouthBanana). public class NorthBanana extends Banana { public void get() { System.out.println(&quot;é‡‡é›†åŒ—æ–¹é¦™è•‰&quot;); } } public class SouthBanana extends Banana { public void get() { System.out.println(&quot;é‡‡é›†å—æ–¹é¦™è•‰&quot;); } } ç»§ç»­å†™å·¥å‚ï¼Œä¸ä¹‹å‰çš„FruitFactoryæœ‰æ‰€ä¸åŒï¼Œæ­¤æ—¶çš„FruitFactoryéœ€ä¸ºæ¯ä¸€ä¸ªäº§å“ç­‰çº§ç»“æ„æ·»åŠ è·å–æ–¹æ³•å£°æ˜ã€‚ public interface FruitFactory { //å®ä¾‹åŒ–Apple public Fruit getApple(); //å®ä¾‹åŒ–Banana public Fruit getBanana(); } ä¸ºæ¯ä¸€ä¸ªäº§å“æ—æ·»åŠ ç›¸åº”çš„å·¥å‚ï¼ŒNorthFruitFactoryè´Ÿè´£ç”Ÿäº§æ‰€æœ‰åŒ—æ–¹çš„æ°´æœï¼ŒSouthFruitFactoryè´Ÿè´£ç”Ÿäº§æ‰€æœ‰å—æ–¹çš„æ°´æœã€‚ public class NorthFruitFactory implements FruitFactory { public Fruit getApple() { return new NorthApple(); } public Fruit getBanana() { return new NorthBanana(); } } public class SouthFruitFactory implements FruitFactory { public Fruit getApple() { return new SouthApple(); } public Fruit getBanana() { return new SouthBanana(); } } åœ¨å®¢æˆ·ç«¯ä¸­è¿›è¡Œæµ‹è¯•ï¼Œä»£ç å¦‚ä¸‹ã€‚ public class Client { public static void main(String[] args) { FruitFactory ff1 = new NorthFruitFactory(); Fruit apple1 = ff1.getApple(); apple1.get(); Fruit banana1 = ff1.getBanana(); banana1.get(); FruitFactory ff2 = new SouthFruitFactory(); Fruit apple2 = ff2.getApple(); apple2.get(); Fruit banana2 = ff2.getBanana(); banana2.get(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š é‡‡é›†åŒ—æ–¹è‹¹æœé‡‡é›†åŒ—æ–¹é¦™è•‰é‡‡é›†å—æ–¹è‹¹æœé‡‡é›†å—æ–¹é¦™è•‰ ä¸‰ã€æŠ½è±¡å·¥å‚æ¨¡å¼çš„ä¼˜ç¼ºç‚¹æŠ½è±¡å·¥å‚æ¨¡å¼æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š æŠ½è±¡å·¥å‚æ¨¡å¼éš”ç¦»äº†å…·ä½“äº§å“ç±»çš„ç”Ÿäº§ï¼Œä½¿å¾—å®¢æˆ·å¹¶ä¸éœ€è¦çŸ¥é“å³å°†åˆ›å»ºçš„å¯¹è±¡çš„å…·ä½“ç±»å‹ã€‚ å½“ä¸€ä¸ªäº§å“æ—ä¸­çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œæ—¶ï¼Œå®ƒèƒ½ä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“æ—ä¸­çš„å¯¹è±¡ã€‚ å¢åŠ æ–°çš„å…·ä½“å·¥å‚å’Œäº§å“æ—å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹å·²æœ‰ç³»ç»Ÿï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„å¾ˆå¤æ‚ï¼Œéœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚å’Œæ‰€æœ‰çš„å…·ä½“å·¥å‚ç±»ï¼Œå¯¹â€œå¼€é—­åŸåˆ™â€çš„æ”¯æŒå‘ˆç°å€¾æ–œæ€§ã€‚ ä¼˜ç‚¹ä»£ç ä¸¾ä¾‹ï¼šéœ€æ±‚æ›´æ”¹éœ€è¦å¢åŠ æ¸©å®¤äº§å“æ—ã€‚ å…ˆå¢åŠ æ¸©å®¤è‹¹æœå’Œæ¸©å®¤é¦™è•‰ä¸¤ä¸ªç±»ã€‚ public class WenshiApple extends Apple { public void get() { System.out.println(&quot;é‡‡é›†æ¸©å®¤è‹¹æœ&quot;); } } public class WenshiBanana extends Banana { public void get() { System.out.println(&quot;é‡‡é›†æ¸©å®¤é¦™è•‰&quot;); } } å†å¢åŠ ç”Ÿäº§æ¸©å®¤æ°´æœçš„æ¸©å®¤å·¥å‚ã€‚ public class WenshiFruitFactory implements FruitFactory { public Fruit getApple() { return new WenshiApple(); } public Fruit getBanana() { return new WenshiBanana(); } } åœ¨å®¢æˆ·ç«¯ä¸­æµ‹è¯•ä¸€ä¸‹ï¼Œåˆ›å»ºæ¸©å®¤æ°´æœæµ‹è¯•ã€‚ public class Client{ public static void main(String[] args) { FruitFactory ff3 = new WenshiFruitFactory(); Fruit apple3 = ff3.getApple(); apple3.get(); Fruit banana3 = ff3.getBanana(); banana3.get(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š é‡‡é›†æ¸©å®¤è‹¹æœé‡‡é›†æ¸©å®¤é¦™è•‰ äº§è‡ªæ¸©å®¤çš„è‹¹æœå’Œé¦™è•‰è¢«æ­£ç¡®åˆ›å»ºï¼Œåªæ˜¯å¢åŠ äº†æ–°äº§å“æ—çš„å…·ä½“äº§å“ç±»å’Œè´Ÿè´£ç”Ÿäº§è¯¥äº§å“æ—æ‰€æœ‰äº§å“çš„å·¥å‚ï¼Œæ— éœ€å¯¹ç°æœ‰ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå¾ˆå¥½çš„ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å·¥å‚æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å·¥å‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å·¥å‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"10åˆ†é’ŸæŒæ¡Markdown","slug":"10åˆ†é’ŸæŒæ¡Markdown","date":"2020-05-24T03:56:03.000Z","updated":"2023-04-30T10:21:41.340Z","comments":true,"path":"2020/05/24/10åˆ†é’ŸæŒæ¡Markdown/","link":"","permalink":"/2020/05/24/10åˆ†é’ŸæŒæ¡Markdown/","excerpt":"","text":"å‰è¨€&emsp;&emsp;å†™è¿‡åšå®¢æˆ–è€…githubä¸Šé¢çš„æ–‡æ¡£çš„ï¼Œåº”è¯¥çŸ¥é“Markdownè¯­æ³•çš„é‡è¦æ€§ï¼Œä¸çŸ¥é“çš„æœ‹å‹ä»¬ä¹Ÿåˆ«ç€æ€¥ï¼Œä¸€ç¯‡åšå®¢å¸¦ä½ è½»æ¾æå®šMarkdownè¯­æ³•ã€‚ å¿«æ·é”® åŠŸèƒ½ å¿«æ·é”® åŠ ç²— Ctrl + B æ–œä½“ Ctrl + I å¼•ç”¨ Ctrl + Q æ’å…¥é“¾æ¥ Ctrl + L æ’å…¥ä»£ç  Ctrl + K æ’å…¥å›¾ç‰‡ Ctrl + G æå‡æ ‡é¢˜ Ctrl + H æœ‰åºåˆ—è¡¨ Ctrl + O æ— åºåˆ—è¡¨ Ctrl + U æ¨ªçº¿ Ctrl + R æ’¤é”€ Ctrl + Z é‡åš Ctrl + Y å¸¸ç”¨è¯­æ³•æ–‡æœ¬ ç¤ºä¾‹ æ•ˆæœ æ­£å¸¸æ–‡å­— æ­£å¸¸æ–‡å­— *æ–œä½“æ–‡å­—* æ–œä½“æ–‡å­— _æ–œä½“æ–‡å­—_ æ–œä½“æ–‡å­— **ç²—ä½“æ–‡å­—** ç²—ä½“æ–‡å­— ***æ–œä½“åŠ ç²—*** æ–œä½“åŠ ç²— æ ‡é¢˜&emsp;&emsp;ä¸€çº§æ ‡é¢˜ï¼š# ä¸€çº§æ ‡é¢˜&emsp;&emsp;äºŒçº§æ ‡é¢˜ï¼š## äºŒçº§æ ‡é¢˜&emsp;&emsp;ä¸‰çº§æ ‡é¢˜ï¼š### ä¸‰çº§æ ‡é¢˜&emsp;&emsp;å››çº§æ ‡é¢˜ï¼š#### å››çº§æ ‡é¢˜&emsp;&emsp;äº”çº§æ ‡é¢˜ï¼š##### äº”çº§æ ‡é¢˜&emsp;&emsp;å…­çº§æ ‡é¢˜ï¼š###### å…­çº§æ ‡é¢˜ é“¾æ¥ ç¤ºä¾‹ æ•ˆæœ [CSDN](https://www.csdn.net/ &quot;CSDNæŠ€æœ¯è®ºå›&quot;) CSDN [CSDN][csdn-addr][csdn-addr]:https://www.csdn.net/ &quot;CSDNæŠ€æœ¯è®ºå›&quot; CSDN &lt;https://www.csdn.net/&gt; https://www.csdn.net/ å›¾ç‰‡&emsp;&emsp;ç¤ºä¾‹1:![CSDNå¤´åƒ](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw &quot;æˆ‘çš„å¤´åƒ&quot;)&emsp;&emsp;æˆ–è€…ï¼š![CSDNå¤´åƒ][csdn-image][csdn-image]:https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw &quot;æˆ‘çš„å¤´åƒ&quot;&emsp;&emsp;æ•ˆæœï¼š &emsp;&emsp;ç¤ºä¾‹2ï¼šè°ƒæ•´å¤§å°&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw&quot; width=&quot;100px&quot; height=&quot;100px&quot; /&gt;&emsp;&emsp;ç¤ºä¾‹3ï¼šå±…ä¸­&lt;div align=center&gt;![CSDNå¤´åƒ](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw &quot;æˆ‘çš„å¤´åƒ&quot;) &emsp;&emsp;ç¤ºä¾‹4ï¼šå¼•ç”¨æœ¬åœ°å›¾ç‰‡![CSDNå¤´åƒ](./imgs/csdn.jpg &quot;æˆ‘çš„å¤´åƒ&quot;) åˆ†å‰²çº¿&emsp;&emsp;åœ¨ä¸€è¡Œä¸­ä½¿ç”¨ *** æˆ–è€… --- æˆ–è€… ___ éƒ½å¯ä»¥æ’å…¥ä¸€ä¸ªåˆ†å‰²çº¿ï¼Œè¡Œå†…ä¸å…è®¸æœ‰å…¶ä»–å†…å®¹ã€‚ ä»£ç å—&emsp;&emsp;è¡Œå†…ä»£ç å—ï¼ˆä½¿ç”¨ESCé”®ä¸Šçš„è‹±æ–‡å­—ç¬¦ ` åŒ…è£¹ä»£ç ï¼‰ï¼š `var foo = &#39;bar&#39;;` ä»£ç å—ï¼ˆç¼©è¿› 4 ä¸ªç©ºæ ¼æˆ–æ˜¯ 1 ä¸ªåˆ¶è¡¨ç¬¦ï¼‰ï¼š &lt;table&gt; &lt;tr&gt; &lt;th&gt;å§“å&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;å°æ˜&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; å¤šè¡Œä»£ç å—ï¼ˆä½¿ç”¨è¿ç»­3ä¸ªESCé”®ä¸Šçš„è‹±æ–‡å­—ç¬¦ ` åŒ…è£¹ä»£ç ï¼‰ï¼š ``` &lt;table&gt; &lt;tr&gt; &lt;th&gt;å§“å&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;å°æ˜&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; ``` å¼•ç”¨&emsp;&emsp;å•å±‚å¼•ç”¨ï¼šåœ¨è¢«å¼•ç”¨çš„æ–‡æœ¬å‰åŠ ä¸Š &gt; ç¬¦å·ï¼Œä¾‹å¦‚ï¼š&gt; è¯­å‡ºã€Šè®ºè¯­ã€‹ è¯­å‡ºã€Šè®ºè¯­ã€‹ &emsp;&emsp;åµŒå¥—å¼•ç”¨ï¼š &gt; #å¼•ç”¨1 &gt;&gt; ##å¼•ç”¨2 åˆ—è¡¨&emsp;&emsp;æ— åºåˆ—è¡¨ï¼ˆä½¿ç”¨ *ï¼Œ+ï¼Œ- è¡¨ç¤ºï¼‰: + 1. item1 - 2. item2 * 3. item3 &emsp;&emsp;æ•ˆæœï¼š item1 item2 item3 &emsp;&emsp;æœ‰åºåˆ—è¡¨ï¼ˆä½¿ç”¨æ•°å­—ç´§è·Ÿä¸€ä¸ªè‹±æ–‡å¥ç‚¹è¡¨ç¤ºï¼‰ï¼š 1. item1 2. item2 3. item3 item1 item2 item3 &emsp;&emsp;æ— åºåˆ—è¡¨å’Œæœ‰åºåˆ—è¡¨çš„åˆ—è¡¨åºå·å’Œåˆ—è¡¨å†…å®¹ä¹‹é—´å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ è¡¨æ ¼| Column 1 | Column 2 |Column 2 | |:--------:| -------------:|:-------------| | centered æ–‡æœ¬å±…ä¸­ | right-aligned æ–‡æœ¬å±…å³ | left-aligned æ–‡æœ¬å±…å·¦ | &emsp;&emsp;ç¤ºä¾‹ï¼š |é¡¹ç›® | Value | |:--------|:--------| |ç”µè„‘ | $1600 | |æ‰‹æœº | $12 | |å¯¼ç®¡ | $1 | &emsp;&emsp;æ•ˆæœï¼š é¡¹ç›® Value ç”µè„‘ $1600 æ‰‹æœº $12 å¯¼ç®¡ $1 å¸¸ç”¨æŠ€å·§æ¢è¡Œ è¿ç»­ä¸¤ä¸ªä»¥ä¸Šç©ºæ ¼+å›è½¦ ä½¿ç”¨htmlè¯­è¨€æ¢è¡Œæ ‡ç­¾ï¼š&lt;br/&gt; ç¼©è¿› &amp;nbsp;ï¼šç¼©è¿›1/4ä¸­æ–‡å­—ç¬¦ &amp;ensp;ï¼šç¼©è¿›1/2ä¸­æ–‡å­—ç¬¦,1è‹±æ–‡å­—ç¬¦ &amp;emsp;ï¼šç¼©è¿›1ä¸­æ–‡å­—ç¬¦,2è‹±æ–‡å­—ç¬¦","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"/categories/æŠ€æœ¯/"}],"tags":[{"name":"Markdown","slug":"Markdown","permalink":"/tags/Markdown/"}],"keywords":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"/categories/æŠ€æœ¯/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--å·¥å‚æ–¹æ³•æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--å·¥å‚æ–¹æ³•æ¨¡å¼","date":"2020-05-24T03:56:03.000Z","updated":"2023-04-30T10:21:41.357Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å·¥å‚æ–¹æ³•æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--å·¥å‚æ–¹æ³•æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼å·¥å‚æ–¹æ³•æ¨¡å¼åŒæ ·å±äºç±»çš„åˆ›å»ºå‹æ¨¡å¼åˆè¢«ç§°ä¸ºå¤šæ€å·¥å‚æ¨¡å¼ ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ„ä¹‰æ˜¯å®šä¹‰ä¸€ä¸ªåˆ›å»ºäº§å“å¯¹è±¡çš„å·¥å‚æ¥å£ï¼Œå°†å®é™…åˆ›å»ºå·¥ä½œæ¨è¿Ÿåˆ°å­ç±»å½“ä¸­ã€‚æ ¸å¿ƒå·¥å‚ç±»ä¸å†è´Ÿè´£äº§å“çš„åˆ›å»ºï¼Œè¿™æ ·æ ¸å¿ƒç±»æˆä¸ºä¸€ä¸ªæŠ½è±¡å·¥å‚è§’è‰²ï¼Œä»…è´Ÿè´£å£°æ˜å…·ä½“å·¥å‚å­ç±»å¿…é¡»å®ç°çš„æ¥å£ï¼Œè¿™æ ·è¿›ä¸€æ­¥æŠ½è±¡åŒ–çš„å¥½å¤„æ˜¯ä½¿å¾—å·¥å‚æ–¹æ³•æ¨¡å¼å¯ä»¥ä½¿ç³»ç»Ÿåœ¨ä¸ä¿®æ”¹å…·ä½“å·¥å‚è§’è‰²çš„æƒ…å†µä¸‹å¼•è¿›æ–°çš„äº§å“ã€‚ äºŒã€æ¨¡å¼ä¸­åŒ…å«çš„è§’è‰²åŠå…¶èŒè´£æŠ½è±¡å·¥å‚ï¼ˆFactoryï¼‰è§’è‰²ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒï¼Œæ‰€æœ‰å…·ä½“å·¥å‚ç±»éƒ½å¿…é¡»å®ç°è¿™ä¸ªæ¥å£ã€‚ å…·ä½“å·¥å‚ï¼ˆ ConcreteFactoryï¼‰è§’è‰²ï¼šå…·ä½“å·¥å‚ç±»æ˜¯æŠ½è±¡å·¥å‚çš„ä¸€ä¸ªå®ç°ï¼Œè´Ÿè´£å®ä¾‹åŒ–å…·ä½“çš„äº§å“ã€‚ æŠ½è±¡äº§å“ï¼ˆProductï¼‰è§’è‰²ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼æ‰€åˆ›å»ºçš„æ‰€æœ‰å…·ä½“äº§å“çš„çˆ¶ç±»ï¼Œæˆ–çº¦å®šæ‰€æœ‰å…·ä½“äº§å“ç±»éƒ½åº”å®ç°çš„å…¬å…±æ¥å£ã€‚ å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰è§’è‰²ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼æ‰€åˆ›å»ºçš„çœŸæ­£å¯¹è±¡ã€‚ åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­æˆ‘ä»¬äº†è§£äº†ç®€å•å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å…·ä½“çš„å·¥å‚FruitFactoryå¯¹æ‰€æœ‰çš„æ°´æœå¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ï¼Œç¼ºç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šå½“æœ‰æ–°å“ç§çš„æ°´æœéœ€è¦äº§ç”Ÿæ—¶å°±éœ€è¦ä¿®æ”¹å·¥å‚çš„getFruit()æ–¹æ³•ï¼ŒåŠ å…¥æ–°å“ç§æ°´æœçš„é€»è¾‘åˆ¤æ–­å’Œä¸šåŠ¡ä»£ç ï¼Œè¿™æä¸ç¬¦åˆjavaâ€œå¼€æ”¾â€“å°é—­â€åŸåˆ™ã€‚ public class FruitFactory { /* * getæ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰äº§å“å¯¹è±¡ */ public static Fruit getFruit(String type) throws InstantiationException, IllegalAccessException, ClassNotFoundException { if(type.equalsIgnoreCase(&quot;apple&quot;)) { return Apple.class.newInstance(); } else if(type.equalsIgnoreCase(&quot;banana&quot;)) { return Banana.class.newInstance(); } /* * å¦‚æœæœ‰æ–°å“ç§çš„æ°´æœéœ€è¦ç”Ÿäº§éœ€åœ¨æ­¤å¤„å¢åŠ ç›¸åº”é€»è¾‘åˆ¤æ–­åŠä¸šåŠ¡ä»£ç ï¼Œä¾‹å¦‚ï¼š * else if(type.equalsIgnoreCase(&quot;pear&quot;)) { * return Pear.class.newInstance(); * } */ else { System.out.println(&quot;æ‰¾ä¸åˆ°ç›¸åº”çš„å®ä¾‹åŒ–ç±»&quot;); return null; } } } æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å¯¹ä»¥ä¸Šå·¥å‚è¿›è¡Œæ”¹è¿›ï¼Œé¦–å…ˆå·¥å‚æ–¹æ³•æ¨¡å¼ä¸­FruitFactoryè¢«è®¾è®¡ä¸ºäº†æŠ½è±¡å·¥å‚(å¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–è€…æ¥å£),å®ƒä¸å†è´Ÿè´£å…·ä½“çš„äº§å“åˆ›å»ºï¼Œè€Œæ˜¯å°†äº§å“çš„åˆ›å»ºå·¥ä½œæ¨è¿Ÿåˆ°äº†ç”±å®ƒçš„å­ç±»æ¥å®ç°ï¼Œæ¥ä¸‹æ¥ä»¥å…·ä½“çš„ä»£ç ä¸ºä¾‹ã€‚ æŠ½è±¡åçš„FruitFactoryä»…ç”¨æ¥å£°æ˜å…¶æ‰€æœ‰å­ç±»éœ€å®ç°çš„æ¥å£ã€‚ public interface FruitFactory { public Fruit getFruit(); } æœ‰äº†è¿™ä¸ªæŠ½è±¡å·¥å‚ä»¥åï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦è‹¹æœäº†è¯¥æ€ä¹ˆåŠï¼Ÿå¾ˆç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªç”Ÿäº§è‹¹æœçš„å·¥å‚AppleFactoryå³å¯ã€‚ public class AppleFactory implements FruitFactory{ public Fruit getFruit(){ return new Apple(); } } å‡å¦‚æˆ‘ä»¬åˆéœ€è¦è·å–é¦™è•‰äº†è¯¥æ€ä¹ˆåŠï¼Ÿä¾æ—§ç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªç”Ÿäº§é¦™è•‰çš„å·¥å‚BananaFactoryå³å¯ã€‚ public class BananaFactory implements FruitFactory{ public Fruit getFruit(){ return new Banana(); } } å¦‚æœä»¥åè¿˜æœ‰å…¶ä»–æ›´å¤šæ–°å“ç§çš„æ°´æœåŠ å…¥ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªç”Ÿäº§ç›¸åº”æ°´æœçš„å·¥å‚å¹¶è®©è¯¥å·¥å‚å®ç°æŠ½è±¡å·¥å‚FruitFactory çš„æ¥å£ï¼Œéœ€è¦å“ªç§æ°´æœæˆ‘ä»¬å°±è°ƒç”¨ç›¸åº”å·¥å‚çš„getFruit()æ–¹æ³•å¾—åˆ°æ°´æœï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæ— è®ºæˆ‘ä»¬å¢åŠ å¤šå°‘ç§æ°´æœï¼Œæˆ‘ä»¬åªéœ€å¢åŠ ä¸€ä¸ªç”Ÿäº§ç›¸åº”æ°´æœçš„å·¥å‚å³å¯ï¼Œæ— éœ€å¯¹ç°æœ‰çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œè¿™å°±å¾ˆå¥½çš„ç¬¦åˆäº†â€å¼€æ”¾â€“å°é—­â€åŸåˆ™ã€‚ ä¸‰ã€å·¥å‚æ–¹æ³•æ¨¡å¼å’Œç®€å•å·¥å‚æ¨¡å¼æ¯”è¾ƒå·¥å‚æ–¹æ³•æ¨¡å¼ä¸ç®€å•å·¥å‚æ¨¡å¼åœ¨ç»“æ„ä¸Šçš„ä¸åŒä¸æ˜¯å¾ˆæ˜æ˜¾ã€‚å·¥å‚æ–¹æ³•ç±»çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œè€Œç®€å•å·¥å‚æ¨¡å¼æŠŠæ ¸å¿ƒæ”¾åœ¨ä¸€ä¸ªå…·ä½“ç±»ä¸Šã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼ä¹‹æ‰€ä»¥æœ‰ä¸€ä¸ªåˆ«åå«å¤šæ€æ€§å·¥å‚æ¨¡å¼æ˜¯å› ä¸ºå…·ä½“å·¥å‚ç±»éƒ½æœ‰å…±åŒçš„æ¥å£ï¼Œæˆ–è€…æœ‰å…±åŒçš„æŠ½è±¡çˆ¶ç±»ã€‚å½“ç³»ç»Ÿæ‰©å±•éœ€è¦æ·»åŠ æ–°çš„äº§å“å¯¹è±¡æ—¶ï¼Œä»…ä»…éœ€è¦æ·»åŠ ä¸€ä¸ªå…·ä½“å¯¹è±¡ä»¥åŠä¸€ä¸ªå…·ä½“å·¥å‚å¯¹è±¡ï¼ŒåŸæœ‰å·¥å‚å¯¹è±¡ä¸éœ€è¦è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œä¹Ÿä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ï¼Œå¾ˆå¥½çš„ç¬¦åˆäº†â€œå¼€æ”¾ï¼å°é—­â€åŸåˆ™ã€‚è€Œç®€å•å·¥å‚æ¨¡å¼åœ¨æ·»åŠ æ–°äº§å“å¯¹è±¡åä¸å¾—ä¸ä¿®æ”¹å·¥å‚æ–¹æ³•ï¼Œæ‰©å±•æ€§ä¸å¥½ã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼é€€åŒ–åå¯ä»¥æ¼”å˜æˆç®€å•å·¥å‚æ¨¡å¼ã€‚","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å·¥å‚æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å·¥å‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å·¥å‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹--ç®€å•å·¥å‚æ¨¡å¼","slug":"Javaè®¾è®¡æ¨¡å¼ä¹‹--ç®€å•å·¥å‚æ¨¡å¼","date":"2020-05-24T03:56:03.000Z","updated":"2023-04-30T10:21:41.359Z","comments":true,"path":"2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ç®€å•å·¥å‚æ¨¡å¼/","link":"","permalink":"/2020/05/24/Javaè®¾è®¡æ¨¡å¼ä¹‹--ç®€å•å·¥å‚æ¨¡å¼/","excerpt":"","text":"ä¸€ã€ä»€ä¹ˆæ˜¯ç®€å•å·¥å‚æ¨¡å¼ç®€å•å·¥å‚æ¨¡å¼å±äºç±»çš„åˆ›å»ºå‹æ¨¡å¼ã€‚æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡å®ä¾‹çš„åŠŸèƒ½ï¼Œè€Œæ— é¡»å…³å¿ƒå…¶å…·ä½“å®ç°ã€‚è¢«åˆ›å»ºå®ä¾‹çš„ç±»å‹å¯ä»¥æ˜¯æ¥å£ã€æŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“çš„ç±»ã€‚ ç®€å•å·¥å‚æ¨¡å¼çš„æœ¬è´¨ï¼šé€‰æ‹©å®ç° è®¾è®¡æ„å›¾ï¼š é€šè¿‡ä¸“é—¨å®šä¹‰ä¸€ä¸ªç±»æ¥è´Ÿè´£åˆ›å»ºå…¶ä»–ç±»çš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„å®ä¾‹é€šå¸¸éƒ½å…·æœ‰å…±åŒçš„çˆ¶ç±»ã€‚ äºŒã€ç®€å•å·¥å‚æ¨¡å¼çš„ç»“æ„ç®€å•å·¥å‚æ¨¡å¼æ¶‰åŠçš„è§’è‰²åŠå…¶èŒè´£å¦‚ä¸‹ï¼š å·¥å‚ï¼ˆFactoryï¼‰è§’è‰²ï¼šç®€å•å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£å®ç°åˆ›å»ºæ‰€æœ‰å®ä¾‹çš„å†…éƒ¨é€»è¾‘ï¼Œè¯¥ç±»å¯ä»¥è¢«å¤–ç•Œç›´æ¥è°ƒç”¨ï¼Œåˆ›å»ºæ‰€éœ€çš„äº§å“å¯¹è±¡ã€‚ æŠ½è±¡ï¼ˆProductï¼‰è§’è‰²ï¼šç®€å•å·¥å‚æ¨¡å¼æ‰€åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ï¼Œå®ƒè´Ÿè´£çº¦å®šæ‰€æœ‰å…·ä½“äº§å“ç±»æ‰€å…±æœ‰çš„å…¬å…±æ¥å£ã€‚ å…·ä½“äº§å“ï¼ˆConcreteProductï¼‰è§’è‰²ï¼šç®€å•å·¥å‚æ¨¡å¼æ‰€åˆ›å»ºçš„çœŸæ­£å®ä¾‹å¯¹è±¡ã€‚ ä»¥å…·ä½“ä»£ç ä¸ºä¾‹ï¼šç°åœ¨æœ‰ä¸¤ç§æ°´æœï¼šè‹¹æœ(Apple)å’Œé¦™è•‰(Banana)ï¼Œä¸ºäº†æ¼”ç¤ºï¼Œä¸ºè¿™ä¸¤ç§æ°´æœæ·»åŠ ä¸€ä¸ªé‡‡é›†get()æ–¹æ³•ã€‚ public class Apple{ /* * é‡‡é›† */ public void get(){ System.out.println(&quot;é‡‡é›†è‹¹æœ&quot;); } } public class Banana{ /* * é‡‡é›† */ public void get(){ System.out.println(&quot;é‡‡é›†é¦™è•‰&quot;); } } å¦‚æœè¦é‡‡é›†æ°´æœï¼Œåœ¨ä¸ä½¿ç”¨ä»»ä½•è®¾è®¡æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šè¿™æ ·åšã€‚ public class Client { public static void main(String[] args){ //å®ä¾‹åŒ–ä¸€ä¸ªApple Apple apple = new Apple(); //å®ä¾‹åŒ–ä¸€ä¸ªBanana Banana banana = new Banana(); apple.get(); banana.get(); } } å®¢æˆ·ç«¯åˆ†åˆ«åˆ›å»ºè‹¹æœå’Œé¦™è•‰ä¸¤ä¸ªå…·ä½“äº§å“çš„å®ä¾‹å¹¶è°ƒç”¨å…¶é‡‡é›†çš„æ–¹æ³•ï¼Œè¿™æ ·åšå­˜åœ¨çš„é—®é¢˜æ˜¯ï¼šå®¢æˆ·ç«¯éœ€è¦çŸ¥é“æ‰€æœ‰çš„å…·ä½“æ°´æœç§ç±»ï¼Œå³å®¢æˆ·ç«¯ä¸æ‰€æœ‰çš„æ°´æœç±»éƒ½å­˜åœ¨äº†è€¦åˆå…³ç³»ï¼Œä¸ç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„â€œä½è€¦åˆâ€åŸåˆ™ã€‚ ä»¥ä¸Šé—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿç­”æ¡ˆï¼šä½¿ç”¨ç®€å•å·¥å‚ï¼Œåˆ©ç”¨æ¥å£è¿›è¡Œâ€œå°è£…éš”ç¦»â€ã€‚ Appleå’ŒBananaç±»æ—¢ç„¶éƒ½æ˜¯æ°´æœï¼Œä¸”å…±æœ‰ä¸€ä¸ªé‡‡é›†çš„get()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶æ·»åŠ ä¸€ä¸ªçˆ¶ç±»æˆ–è®©å…¶å®ç°ä¸€ä¸ªå…±åŒçš„æ¥å£ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªFruitæ¥å£ã€‚ public interface Fruit { /* * é‡‡é›† */ public void get(); } è®©Appleå’ŒBananaç±»éƒ½å®ç°Fruitæ¥å£ã€‚ public class Apple implements Fruit{ /* * é‡‡é›† */ public void get(){ System.out.println(&quot;é‡‡é›†è‹¹æœ&quot;); } } public class Banana implements Fruit{ /* * é‡‡é›† */ public void get(){ System.out.println(&quot;é‡‡é›†é¦™è•‰&quot;); } } æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªæ°´æœå·¥å‚ç±»FruitFactoryï¼Œåœ¨å·¥å‚ä¸­å®ç°å¯¹Appleå’ŒBananaç±»çš„å®ä¾‹åŒ–ã€‚ public class FruitFactory { /* * è·å¾—Appleç±»çš„å®ä¾‹ */ public static Fruit getApple(){ return new Apple(); } /* * è·å¾—Bananaç±»å®ä¾‹ */ public static Fruit getBanana(){ return new Banana(); } } è‹¥FruitFactoryä¸­getXXX()æ–¹æ³•æœªå£°æ˜ä¸ºstaticçš„è¯ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•éœ€åˆ›å»ºFruitFactoryå®ä¾‹æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬ç›´æ¥å£°æ˜æ–¹æ³•ä¸ºstaticã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä½¿ç”¨FruitFactoryåˆ›å»ºAppleå’ŒBananaå®ä¾‹å¯¹è±¡äº†ã€‚ public class Client{ public static void main(String[] args){ //å®ä¾‹åŒ–ä¸€ä¸ªApple Fruit apple = FruitFactory.getApple(); Fruit banana = FruitFactory.getBanana(); apple.get(); banana.get(); } } è§‚å¯Ÿä»¥ä¸Šå·¥å‚ï¼Œå…¶ä¸ºæ¯ä¸€ä¸ªæ°´æœå…·ä½“ç±»éƒ½æ·»åŠ äº†ä¸€ä¸ªgetXXX()æ–¹æ³•ï¼Œå½“æ°´æœç§ç±»å¢å¤šæ—¶æ–¹æ³•æ•°é‡ä¹Ÿä¼šå¢åŠ å¯¼è‡´FruitFactoryç±»æ¯”è¾ƒè‡ƒè‚¿ï¼Œè€Œä¸”å„ä¸ªæ–¹æ³•ä¹‹é—´å…³ç³»ä¹Ÿä¸å¤Ÿç´§å¯†ä¸ç¬¦åˆâ€œé«˜å†…èšâ€åŸåˆ™ï¼Œæˆ‘ä»¬å†å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚ public class FruitFactory { /* * getFruitæ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰äº§å“å¯¹è±¡ */ public static Fruit getFruit(String type) throws InstantiationException, IllegalAccessException{ if(type.equalsIgnoreCase(&quot;apple&quot;)) { return Apple.class.newInstance(); } elseif(type.equalsIgnoreCase(&quot;banana&quot;)) { return Banana.class.newInstance(); } else{ System.out.println(&quot;æ‰¾ä¸åˆ°ç›¸åº”çš„å®ä¾‹åŒ–ç±»&quot;); return null; } } } åœ¨å®¢æˆ·ç«¯ï¼Œä½¿ç”¨æ”¹è‰¯åçš„FruitFactoryæ¥åˆ›å»ºAppleå’ŒBananaå®ä¾‹å¯¹è±¡ã€‚ public class Client{ public static void main(String[] args){ Fruit apple = FruitFactory.getFruit(&quot;apple&quot;); Fruit banana = FruitFactory.getFruit(&quot;banana&quot;); apple.get(); banana.get(); } } è¿è¡Œç¨‹åºæ‰“å°ç»“æœå¦‚ä¸‹ï¼š é‡‡é›†è‹¹æœé‡‡é›†é¦™è•‰ ä¸‰ã€ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç¼ºç‚¹åœ¨è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œå·¥å‚ç±»æ˜¯æ•´ä¸ªæ¨¡å¼çš„å…³é”®æ‰€åœ¨ã€‚å®ƒåŒ…å«å¿…è¦çš„åˆ¤æ–­é€»è¾‘ï¼Œèƒ½å¤Ÿæ ¹æ®å¤–ç•Œç»™å®šçš„ä¿¡æ¯ï¼Œå†³å®šç©¶ç«Ÿåº”è¯¥åˆ›å»ºå“ªä¸ªå…·ä½“ç±»çš„å¯¹è±¡ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥æ ¹æ®å·¥å‚ç±»å»åˆ›å»ºæ‰€éœ€çš„å®ä¾‹ï¼Œè€Œæ— éœ€äº†è§£è¿™äº›å¯¹è±¡æ˜¯å¦‚ä½•åˆ›å»ºä»¥åŠå¦‚ä½•ç»„ç»‡çš„ã€‚æœ‰åˆ©äºæ•´ä¸ªè½¯ä»¶ä½“ç³»ç»“æ„çš„ä¼˜åŒ–ã€‚ä¸éš¾å‘ç°ï¼Œç®€å•å·¥å‚æ¨¡å¼çš„ç¼ºç‚¹ä¹Ÿæ­£ä½“ç°åœ¨å…¶å·¥å‚ç±»ä¸Šï¼Œç”±äºå·¥å‚ç±»é›†ä¸­äº†æ‰€æœ‰å®ä¾‹çš„åˆ›å»ºé€»è¾‘ï¼Œæ‰€ä»¥â€œé«˜å†…èšâ€æ–¹é¢åšçš„å¹¶ä¸å¥½ã€‚å¦å¤–ï¼Œå½“ç³»ç»Ÿä¸­çš„å…·ä½“äº§å“ç±»ä¸æ–­å¢å¤šæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¦æ±‚å·¥å‚ç±»ä¹Ÿè¦åšç›¸åº”çš„ä¿®æ”¹ï¼Œæ‰©å±•æ€§å¹¶ä¸å¾ˆå¥½ã€‚ä¾‹å¦‚æ–°å¢ä¸€ä¸ªPear(æ¢¨)ç±»æ—¶ï¼ŒFruitFactoryéœ€åœ¨getFruit()æ–¹æ³•ä¸­å¢åŠ type==â€Pearâ€çš„é€»è¾‘åˆ¤æ–­ï¼Œæ­¤æ—¶ä¸ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ FruitFactoryå¯é€šè¿‡åå°„æ¥è§£å†³æ‰©å±•æ€§å’Œé«˜å†…èšç¼ºé™·ï¼Œä»£ç å¦‚ä¸‹ã€‚ public class FruitFactory{ /* * getFruitæ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰äº§å“å¯¹è±¡ */ public static Fruit getFruit(String type)throws ClassNotFoundException, InstantiationException,IllegalAccessException { Class fruit = Class.forName(type); return (Fruit) fruit.newInstance(); } } å®¢æˆ·ç«¯ä½¿ç”¨FruitFactoryåˆ›å»ºAppleå’ŒBananaå®ä¾‹å¯¹è±¡ï¼Œæ­¤æ—¶getFruit()æ–¹æ³•ä¼ å…¥çš„å‚æ•°éœ€æ³¨æ„åŒºåˆ†å¤§å°å†™ï¼Œå¦åˆ™ä¼šæŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼Œå†™æ³•å‘†æ¿ï¼Œä½†å¯ä»¥è§£å†³æ‰©å±•æ€§å’Œé«˜å†…èšç¼ºé™·ã€‚ public class Client{ public static void main(String[] args){ Fruit apple = FruitFactory.getFruit(&quot;Apple&quot;); Fruit banana = FruitFactory.getFruit(&quot;Banana&quot;); apple.get(); banana.get(); } }","categories":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}],"tags":[{"name":"å·¥å‚æ¨¡å¼,Java,è®¾è®¡æ¨¡å¼","slug":"å·¥å‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼","permalink":"/tags/å·¥å‚æ¨¡å¼-Java-è®¾è®¡æ¨¡å¼/"}],"keywords":[{"name":"ç¼–ç¨‹","slug":"ç¼–ç¨‹","permalink":"/categories/ç¼–ç¨‹/"}]},{"title":"hexo-theme-sakuraä¸»é¢˜ä½¿ç”¨è¯´æ˜","slug":"Hexo-Theme-Sakura","date":"2020-05-20T03:56:03.000Z","updated":"2023-04-30T10:21:41.340Z","comments":true,"path":"2020/05/20/Hexo-Theme-Sakura/","link":"","permalink":"/2020/05/20/Hexo-Theme-Sakura/","excerpt":"","text":"hexo-theme-sakuraä¸»é¢˜ English document åŸºäºWordPressä¸»é¢˜Sakuraä¿®æ”¹æˆHexoçš„ä¸»é¢˜ã€‚ demoé¢„è§ˆ æ­£åœ¨å¼€å‘ä¸­â€¦â€¦ äº¤æµç¾¤è‹¥ä½ æ˜¯ä½¿ç”¨è€…ï¼ŒåŠ ç¾¤QQ: 801511924 è‹¥ä½ æ˜¯åˆ›ä½œè€…ï¼ŒåŠ ç¾¤QQ: 194472590 ä¸»é¢˜ç‰¹æ€§ é¦–é¡µå¤§å±è§†é¢‘ é¦–é¡µéšæœºå°é¢ å›¾ç‰‡æ‡’åŠ è½½ valineè¯„è®º fancy-boxç›¸å†Œ pjaxæ”¯æŒï¼ŒéŸ³ä¹ä¸é—´æ–­ aplayeréŸ³ä¹æ’­æ”¾å™¨ å¤šçº§å¯¼èˆªèœå•ï¼ˆæŒ‰ç°åœ¨å¤§éƒ¨åˆ†hexoä¸»é¢˜æ¥è¯´ï¼Œè¿™ä¹Ÿç®—æ˜¯ä¸ªç‰¹æ€§äº†ï¼‰ èµèµä½œè€…å¦‚æœå–œæ¬¢hexo-theme-sakuraä¸»é¢˜ï¼Œå¯ä»¥è€ƒè™‘èµ„åŠ©ä¸€ä¸‹å“¦~éå¸¸æ„Ÿæ¿€ï¼ paypal | Alipay æ”¯ä»˜å® | WeChat Pay å¾®ä¿¡æ”¯ä»˜ æœªå®Œå–„çš„ä½¿ç”¨æ•™ç¨‹é‚£å•¥ï¼Ÿè€å®è¯´æˆ‘ç›®å‰ä¹Ÿä¸æ˜¯å¾ˆæœ‰æ¡ç†233333333~ 1ã€ä¸»é¢˜ä¸‹è½½å®‰è£…hexo-theme-sakuraå»ºè®®ä¸‹è½½å‹ç¼©åŒ…æ ¼å¼ï¼Œå› ä¸ºé™¤äº†ä¸»é¢˜å†…å®¹è¿˜æœ‰äº›sourceçš„é…ç½®å¯¹æ–°æ‰‹æ¥è¯´æ¯”è¾ƒå¤ªéº»çƒ¦ï¼Œç›´æ¥ä¸‹è½½è§£å‹å°±çœå»è¿™äº›éº»çƒ¦å’¯ã€‚ ä¸‹è½½å¥½åè§£å‹åˆ°åšå®¢æ ¹ç›®å½•ï¼ˆä¸æ˜¯ä¸»é¢˜ç›®å½•å“¦ï¼Œé‡å¤çš„é€‰æ‹©æ›¿æ¢ï¼‰ã€‚æ¥ç€åœ¨å‘½ä»¤è¡Œï¼ˆcmdã€bashï¼‰è¿è¡Œnpm iå®‰è£…ä¾èµ–ã€‚ 2ã€ä¸»é¢˜é…ç½®åšå®¢æ ¹ç›®å½•ä¸‹çš„_configé…ç½®ç«™ç‚¹ # Site title: ä½ çš„ç«™ç‚¹å subtitle: description: ç«™ç‚¹ç®€ä»‹ keywords: author: ä½œè€…å language: zh-cn timezone: éƒ¨ç½² deploy: type: git repo: github: ä½ çš„githubä»“åº“åœ°å€ # coding: ä½ çš„codingä»“åº“åœ°å€ branch: master å¤‡ä»½ ï¼ˆä½¿ç”¨hexo bå‘å¸ƒå¤‡ä»½åˆ°è¿œç¨‹ä»“åº“ï¼‰ backup: type: git message: backup my blog of https://honjun.github.io/ repository: # ä½ çš„githubä»“åº“åœ°å€,å¤‡ä»½åˆ†æ”¯å ï¼ˆå»ºè®®æ–°å»ºbackupåˆ†æ”¯ï¼‰ github: https://github.com/honjun/honjun.github.io.git,backup # coding: https://git.coding.net/hojun/hojun.git,backup ä¸»é¢˜ç›®å½•ä¸‹çš„_configé…ç½®å…¶ä¸­æ ‡æ˜ã€æ”¹ã€‘çš„æ˜¯éœ€è¦ä¿®æ”¹éƒ¨é—¨ï¼Œæ ‡æ˜ã€é€‰ã€‘æ˜¯å¯æ”¹å¯ä¸æ”¹ï¼Œæ ‡æ˜ã€éã€‘æ˜¯ä¸ç”¨æ”¹çš„éƒ¨åˆ† # site name # ç«™ç‚¹å ã€æ”¹ã€‘ prefixName: ã•ãã‚‰è˜ãã® siteName: hojun # favicon and site master avatar # ç«™ç‚¹çš„faviconå’Œå¤´åƒ è¾“å…¥å›¾ç‰‡è·¯å¾„ï¼ˆä¸‹é¢çš„é…ç½®æ˜¯éƒ½æ˜¯cdnçš„ç›¸å¯¹è·¯å¾„ï¼Œæ²¡æœ‰cdnè¯·å¡«å†™å®Œæ•´è·¯å¾„ï¼Œå»ºè®®ä½¿ç”¨jsdeliveræ­å»ºä¸€ä¸ªcdnå•¦ï¼Œå…ˆå»ä¸‹è½½æˆ‘çš„cdnæ›¿æ¢ä¸‹å›¾ç‰‡å°±è¡Œäº†ï¼Œç®€å•æ–¹ä¾¿~ï¼‰ã€æ”¹ã€‘ favicon: /images/favicon.ico avatar: /img/custom/avatar.jpg # ç«™ç‚¹url ã€æ”¹ã€‘ url: https://sakura.hojun.cn # ç«™ç‚¹ä»‹ç»ï¼ˆæˆ–è€…è¯´æ˜¯ä¸ªäººç­¾åï¼‰ã€æ”¹ã€‘ description: Live your life with passion! With some drive! # ç«™ç‚¹cdnï¼Œæ²¡æœ‰å°±ä¸ºç©º ã€æ”¹ã€‘ è‹¥æ˜¯cdnä¸ºç©ºï¼Œä¸€äº›å›¾ç‰‡åœ°å€å°±è¦å¡«å®Œæ•´åœ°å€äº†ï¼Œæ¯”å¦‚ä¹‹å‰avatarå°±è¦å¡«https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/avatar.jpg cdn: https://cdn.jsdelivr.net/gh/honjun/cdn@1.6 # å¼€å¯pjax ã€é€‰ã€‘ pjax: 1 # ç«™ç‚¹é¦–é¡µçš„å…¬å‘Šä¿¡æ¯ ã€æ”¹ã€‘ notice: hexo-Sakuraä¸»é¢˜å·²ç»å¼€æºï¼Œç›®å‰æ­£åœ¨å¼€å‘ä¸­... # æ‡’åŠ è½½çš„åŠ è½½ä¸­å›¾ç‰‡ ã€é€‰ã€‘ lazyloadImg: https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg # ç«™ç‚¹èœå•é…ç½® ã€é€‰ã€‘ menus: é¦–é¡µ: { path: /, fa: fa-fort-awesome faa-shake } å½’æ¡£: { path: /archives, fa: fa-archive faa-shake, submenus: { æŠ€æœ¯: {path: /categories/æŠ€æœ¯/, fa: fa-code }, ç”Ÿæ´»: {path: /categories/ç”Ÿæ´»/, fa: fa-file-text-o }, èµ„æº: {path: /categories/èµ„æº/, fa: fa-cloud-download }, éšæƒ³: {path: /categories/éšæƒ³/, fa: fa-commenting-o }, è½¬è½½: {path: /categories/è½¬è½½/, fa: fa-book } } } æ¸…å•: { path: javascript:;, fa: fa-list-ul faa-vertical, submenus: { ä¹¦å•: {path: /tags/æ‚¦è¯»/, fa: fa-th-list faa-bounce }, ç•ªç»„: {path: /bangumi/, fa: fa-film faa-vertical }, æ­Œå•: {path: /music/, fa: fa-headphones }, å›¾é›†: {path: /tags/å›¾é›†/, fa: fa-photo } } } ç•™è¨€æ¿: { path: /comment/, fa: fa-pencil-square-o faa-tada } å‹äººå¸: { path: /links/, fa: fa-link faa-shake } èµèµ: { path: /donate/, fa: fa-heart faa-pulse } å…³äº: { path: /, fa: fa-leaf faa-wrench , submenus: { æˆ‘ï¼Ÿ: {path: /about/, fa: fa-meetup}, ä¸»é¢˜: {path: /theme-sakura/, fa: iconfont icon-sakura }, Lab: {path: /lab/, fa: fa-cogs }, } } å®¢æˆ·ç«¯: { path: /client/, fa: fa-android faa-vertical } RSS: { path: /atom.xml, fa: fa-rss faa-pulse } # Home page sort type: -1: newer firstï¼Œ1: older first. ã€éã€‘ homePageSortType: -1 # Home page article shown number) ã€éã€‘ homeArticleShown: 10 # èƒŒæ™¯å›¾ç‰‡ ã€é€‰ã€‘ bgn: 8 # startdashé¢æ¿ url, title, desc img ã€æ”¹ã€‘ startdash: - {url: /theme-sakura/, title: Sakura, desc: æœ¬ç«™ hexo ä¸»é¢˜, img: /img/startdash/sakura.md.png} - {url: http://space.bilibili.com/271849279, title: Bilibili, desc: åšä¸»çš„bç«™è§†é¢‘, img: /img/startdash/bilibili.jpg} - {url: /, title: hojunçš„ä¸‡äº‹å±‹, desc: æŠ€æœ¯æœåŠ¡, img: /img/startdash/wangshiwu.jpg} # your site build time or founded date # ä½ çš„ç«™ç‚¹å»ºç«‹æ—¥æœŸ ã€æ”¹ã€‘ siteBuildingTime: 07/17/2018 # ç¤¾äº¤æŒ‰é’®(social) url, img PCç«¯é…ç½® ã€æ”¹ã€‘ social: github: {url: http://github.com/honjun, img: /img/social/github.png} sina: {url: http://weibo.com/mashirozx?is_all=1, img: /img/social/sina.png} wangyiyun: {url: http://weibo.com/mashirozx?is_all=1, img: /img/social/wangyiyun.png} zhihu: {url: http://weibo.com/mashirozx?is_all=1, img: /img/social/zhihu.png} email: {url: http://weibo.com/mashirozx?is_all=1, img: /img/social/email.svg} wechat: {url: /#, qrcode: /img/custom/wechat.jpg, img: /img/social/wechat.png} # ç¤¾äº¤æŒ‰é’®(msocial) url, img ç§»åŠ¨ç«¯é…ç½® ã€æ”¹ã€‘ msocial: github: {url: http://github.com/honjun, fa: fa-github, color: 333} weibo: {url: http://weibo.com/mashirozx?is_all=1, fa: fa-weibo, color: dd4b39} qq: {url: https://wpa.qq.com/msgrd?v=3&amp;uin=954655431&amp;site=qq&amp;menu=yes, fa: fa-qq, color: 25c6fe} # èµèµäºŒç»´ç ï¼ˆå…¶ä¸­wechatSQæ˜¯èµèµå•é¡µé¢çš„èµèµç å›¾ç‰‡ï¼‰ã€æ”¹ã€‘ donate: alipay: /img/custom/donate/AliPayQR.jpg wechat: /img/custom/donate/WeChanQR.jpg wechatSQ: /img/custom/donate/WeChanSQ.jpg # é¦–é¡µè§†é¢‘åœ°å€ä¸ºhttps://cdn.jsdelivr.net/gh/honjun/hojun@1.2/Unbroken.mp4ï¼Œé…ç½®å¦‚ä¸‹ ã€æ”¹ã€‘ movies: url: https://cdn.jsdelivr.net/gh/honjun/hojun@1.2 # å¤šä¸ªè§†é¢‘ç”¨é€—å·éš”å¼€ï¼Œéšæœºè·å–ã€‚æ”¯æŒçš„æ ¼å¼ç›®å‰å·²çŸ¥MP4,Flvã€‚å…¶ä»–çš„å¯ä»¥è¯•ä¸‹ï¼Œä¸ä¿è¯æœ‰ç”¨ name: Unbroken.mp4 # å·¦ä¸‹è§’aplayeræ’­æ”¾å™¨é…ç½® ä¸»è¦æ”¹idå’Œserverè¿™ä¸¤é¡¹ï¼Œä¿®æ”¹è¯¦è§[aplayeræ–‡æ¡£] ã€æ”¹ã€‘ aplayer: id: 2660651585 server: netease type: playlist fixed: true mini: false autoplay: false loop: all order: random preload: auto volume: 0.7 mutex: true # Valineè¯„è®ºé…ç½®ã€æ”¹ã€‘ valine: true v_appId: GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz v_appKey: mgOpfzbkHYqU92CV4IDlAUHQ åˆ†ç±»é¡µå’Œæ ‡ç­¾é¡µé…ç½®åˆ†ç±»é¡µ æ ‡ç­¾é¡µ é…ç½®é¡¹åœ¨\\themes\\Sakura\\languages\\zh-cn.ymlé‡Œã€‚æ–°å¢ä¸€ä¸ªåˆ†ç±»æˆ–æ ‡ç­¾æœ€å¥½åŠ ä¸‹å“¦ï¼Œå½“ç„¶å«Œéº»çƒ¦å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸€å¼ é»˜è®¤å›¾ç‰‡ï¼ˆå¯ä»¥æ”¹ä¸»é¢˜æˆ–è€…ç›´æ¥æŠŠ404å›¾ç‰‡æ›¿æ¢ä¸‹ï¼Œå¾æ±‚ä¸‹æ„è§è¦ä¸è¦ç»™è¿™ä¸ªåœ¨é…ç½®æ–‡ä»¶ä¸­åŠ ä¸ªå¼€å…³ï¼Œå¯ä»¥issueæˆ–ç¾¤é‡Œæå‡ºæ¥ï¼‰ï¼Œç°åœ¨æ˜¯æ²¡è®¾ç½®çš„è¯ä¼šä½¿ç”¨é‚£ç§å€’ç«‹å°ç‹—404å“¦ã€‚ #category # æŒ‰åˆ†ç±»ååˆ›å»º æŠ€æœ¯: #ä¸­æ–‡æ ‡é¢˜ zh: é‡ç”ŸæŠ€æœ¯åä¼š # è‹±æ–‡æ ‡é¢˜ en: Geek â€“ Only for Love # å°é¢å›¾ç‰‡ img: https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/banner/coding.jpg ç”Ÿæ´»: zh: ç”Ÿæ´» en: live img: https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/banner/writing.jpg #tag # æ ‡ç­¾åå³æ˜¯æ ‡é¢˜ æ‚¦è¯»: # å°é¢å›¾ç‰‡ img: https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/banner/reading.jpg å•é¡µé¢å°é¢é…ç½®å¦‚ç•™è¨€æ¿é¡µé¢é¡µé¢ï¼Œä½äºsourceä¸‹çš„commentä¸‹ï¼Œæ‰“å¼€index.mdå¦‚ä¸‹ï¼š --- title: comment date: 2018-12-20 23:13:48 keywords: ç•™è¨€æ¿ description: comments: true # åœ¨è¿™é‡Œé…ç½®å•é¡µé¢å¤´éƒ¨å›¾ç‰‡ï¼Œè‡ªå®šä¹‰æ›¿æ¢å“¦~ photos: https://cdn.jsdelivr.net/gh/honjun/cdn@1.4/img/banner/comment.jpg --- å•é¡µé¢é…ç½®ç•ªç»„è®¡åˆ’é¡µ ï¼ˆè¯·ç›´æ¥åœ¨ä¸‹è½½åçš„æ–‡ä»¶ä¸­æ”¹ï¼Œä¸‹é¢çš„æ·»åŠ äº†æ³¨é‡Šå¯èƒ½ä¼šæœ‰äº›å½±å“ï¼‰ --- layout: bangumi title: bangumi comments: false date: 2019-02-10 21:32:48 keywords: description: bangumis: # ç•ªç»„å›¾ç‰‡ - img: https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg # ç•ªç»„å title: æœèŠ±å¤•èª“â€”â€”äºç¦»åˆ«ä¹‹æœæŸèµ·çº¦å®šä¹‹èŠ± # è¿½ç•ªçŠ¶æ€ ï¼ˆè¿½ç•ªing/å·²è¿½å®Œï¼‰ status: å·²è¿½å®Œ # è¿½ç•ªè¿›åº¦ progress: 100 # ç•ªå‰§æ—¥æ–‡åç§° jp: ã•ã‚ˆãªã‚‰ã®æœã«ç´„æŸã®èŠ±ã‚’ã‹ã–ã‚ã† # æ”¾é€æ—¶é—´ time: æ”¾é€æ—¶é—´: 2018-02-24 SUN. # ç•ªå‰§ä»‹ç» desc: ä½åœ¨è¿œç¦»å°˜åš£çš„åœŸåœ°ï¼Œä¸€è¾¹å°†æ¯å¤©çš„äº‹æƒ…ç¼–ç»‡æˆåä¸ºå¸Œæ¯”æ¬§çš„å¸ƒï¼Œä¸€è¾¹é™é™ç”Ÿæ´»çš„ä¼Šæ¬§å¤«äººæ°‘ã€‚åœ¨15å²å·¦å³å¤–è¡¨å°±åœæ­¢æˆé•¿ï¼Œæ‹¥æœ‰æ•°ç™¾å¹´å¯¿å‘½çš„ä»–ä»¬ï¼Œè¢«ç§°ä¸ºâ€œç¦»åˆ«çš„ä¸€æ—â€ï¼Œå¹¶è¢«è§†ä¸ºæ´»ç€çš„ä¼ è¯´ã€‚æ²¡æœ‰åŒäº²çš„ä¼Šæ¬§å¤«å°‘å¥³ç›å¥‡äºšï¼Œè¿‡ç€è¢«ä¼™ä¼´åŒ…å›´çš„å¹³ç¨³æ—¥å­ï¼Œå´æ€»æ„Ÿè§‰â€œå­¤èº«ä¸€äººâ€ã€‚ä»–ä»¬çš„è¿™ç§æ—¥å¸¸ï¼Œä¸€ç¬é—´å°±å´©æºƒæ¶ˆå¤±ã€‚è¿½æ±‚ä¼Šæ¬§å¤«çš„é•¿å¯¿ä¹‹è¡€ï¼Œæ¢…è¨è’‚å†›ä¹˜åç€åä¸ºé›·çº³ç‰¹çš„å¤ä»£å…½å‘åŠ¨äº†è¿›æ”»ã€‚åœ¨ç»æœ›ä¸æ··ä¹±ä¹‹ä¸­ï¼Œä¼Šæ¬§å¤«çš„ç¬¬ä¸€ç¾å¥³è•¾è‰äºšè¢«æ¢…è¨è’‚å¸¦èµ°ï¼Œè€Œç›å¥‡äºšæš—æ‹çš„å°‘å¹´å…‹é‡Œå§†ä¹Ÿå¤±è¸ªäº†ã€‚ç›å¥‡äºšè™½ç„¶æ€»ç®—é€ƒè„±äº†ï¼Œå´å¤±å»äº†ä¼™ä¼´å’Œå½’å»ä¹‹åœ°â€¦â€¦ã€‚ - img: https://lain.bgm.tv/pic/cover/l/0e/1e/218971_2y351.jpg title: æœèŠ±å¤•èª“â€”â€”äºç¦»åˆ«ä¹‹æœæŸèµ·çº¦å®šä¹‹èŠ± status: å·²è¿½å®Œ progress: 50 jp: ã•ã‚ˆãªã‚‰ã®æœã«ç´„æŸã®èŠ±ã‚’ã‹ã–ã‚ã† time: æ”¾é€æ—¶é—´: 2018-02-24 SUN. desc: ä½åœ¨è¿œç¦»å°˜åš£çš„åœŸåœ°ï¼Œä¸€è¾¹å°†æ¯å¤©çš„äº‹æƒ…ç¼–ç»‡æˆåä¸ºå¸Œæ¯”æ¬§çš„å¸ƒï¼Œä¸€è¾¹é™é™ç”Ÿæ´»çš„ä¼Šæ¬§å¤«äººæ°‘ã€‚åœ¨15å²å·¦å³å¤–è¡¨å°±åœæ­¢æˆé•¿ï¼Œæ‹¥æœ‰æ•°ç™¾å¹´å¯¿å‘½çš„ä»–ä»¬ï¼Œè¢«ç§°ä¸ºâ€œç¦»åˆ«çš„ä¸€æ—â€ï¼Œå¹¶è¢«è§†ä¸ºæ´»ç€çš„ä¼ è¯´ã€‚æ²¡æœ‰åŒäº²çš„ä¼Šæ¬§å¤«å°‘å¥³ç›å¥‡äºšï¼Œè¿‡ç€è¢«ä¼™ä¼´åŒ…å›´çš„å¹³ç¨³æ—¥å­ï¼Œå´æ€»æ„Ÿè§‰â€œå­¤èº«ä¸€äººâ€ã€‚ä»–ä»¬çš„è¿™ç§æ—¥å¸¸ï¼Œä¸€ç¬é—´å°±å´©æºƒæ¶ˆå¤±ã€‚è¿½æ±‚ä¼Šæ¬§å¤«çš„é•¿å¯¿ä¹‹è¡€ï¼Œæ¢…è¨è’‚å†›ä¹˜åç€åä¸ºé›·çº³ç‰¹çš„å¤ä»£å…½å‘åŠ¨äº†è¿›æ”»ã€‚åœ¨ç»æœ›ä¸æ··ä¹±ä¹‹ä¸­ï¼Œä¼Šæ¬§å¤«çš„ç¬¬ä¸€ç¾å¥³è•¾è‰äºšè¢«æ¢…è¨è’‚å¸¦èµ°ï¼Œè€Œç›å¥‡äºšæš—æ‹çš„å°‘å¹´å…‹é‡Œå§†ä¹Ÿå¤±è¸ªäº†ã€‚ç›å¥‡äºšè™½ç„¶æ€»ç®—é€ƒè„±äº†ï¼Œå´å¤±å»äº†ä¼™ä¼´å’Œå½’å»ä¹‹åœ°â€¦â€¦ã€‚ --- å‹é“¾é¡µ ï¼ˆè¯·ç›´æ¥åœ¨ä¸‹è½½åçš„æ–‡ä»¶ä¸­æ”¹ï¼Œä¸‹é¢çš„æ·»åŠ äº†æ³¨é‡Šå¯èƒ½ä¼šæœ‰äº›å½±å“ï¼‰ --- layout: links title: links # åˆ›å»ºæ—¥æœŸï¼Œå¯ä»¥æ”¹ä¸‹ date: 2018-12-19 23:11:06 # å›¾ç‰‡ä¸Šçš„æ ‡é¢˜ï¼Œè‡ªå®šä¹‰ä¿®æ”¹ keywords: å‹äººå¸ description: # true/false å¼€å¯/å…³é—­è¯„è®º comments: true # é¡µé¢å¤´éƒ¨å›¾ç‰‡ï¼Œè‡ªå®šä¹‰ä¿®æ”¹ photos: https://cdn.jsdelivr.net/gh/honjun/cdn@1.4/img/banner/links.jpg # å‹é“¾é…ç½® links: # ç±»å‹åˆ†ç»„ - group: ä¸ªäººé¡¹ç›® # ç±»å‹ç®€ä»‹ desc: å……åˆ†è¯´æ˜è¿™å®¶ä¼™æ˜¯æ¡å’¸é±¼ &lt; (ï¿£ï¸¶ï¿£)&gt; items: # å‹é“¾é“¾æ¥ - url: https://shino.cc/fgvf # å‹é“¾å¤´åƒ img: https://cloud.moezx.cc/Picture/svg/landscape/fields.svg # å‹é“¾ç«™ç‚¹å name: Google # å‹é“¾ä»‹ç» ä¸‹é¢é›·åŒ desc: Google é•œåƒ - url: https://shino.cc/fgvf img: https://cloud.moezx.cc/Picture/svg/landscape/fields.svg name: Google desc: Google é•œåƒ # ç±»å‹åˆ†ç»„... - group: å°ä¼™ä¼´ä»¬ desc: æ¬¢è¿äº¤æ¢å‹é“¾ ê‰‚(ËŠá—œË‹) items: - url: https://shino.cc/fgvf img: https://cloud.moezx.cc/Picture/svg/landscape/fields.svg name: Google desc: Google é•œåƒ - url: https://shino.cc/fgvf img: https://cloud.moezx.cc/Picture/svg/landscape/fields.svg name: Google desc: Google é•œåƒ --- å†™æ–‡ç« é…ç½®ä¸»é¢˜é›†æˆäº†ä¸ªäººæ’ä»¶hexo-tag-biliå’Œhexo-tag-fancybox_imgã€‚å…¶ä¸­hexo-tag-biliç”¨æ¥åœ¨æ–‡ç« æˆ–å•é¡µé¢ä¸­æ’å…¥Bç«™å¤–é“¾è§†é¢‘ï¼Œä½¿ç”¨è¯­æ³•å¦‚ä¸‹ï¼š {% bili video_id [page] %} è¯¦ç»†ä½¿ç”¨æ•™ç¨‹è¯¦è§hexo-tag-biliã€‚ hexo-tag-fancybox_imgç”¨æ¥åœ¨æ–‡ç« æˆ–å•é¡µé¢ä¸­å›¾ç‰‡ï¼Œä½¿ç”¨è¯­æ³•å¦‚ä¸‹ï¼š {% fb_img src [caption] %} è¯¦ç»†ä½¿ç”¨æ•™ç¨‹è¯¦è§hexo-tag-fancybox_img è¿˜æœ‰å•¥ï¼Œä¸€æ—¶æƒ³ä¸èµ·æ¥â€¦â€¦To be continuedâ€¦","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"/categories/æŠ€æœ¯/"}],"tags":[{"name":"ä¸»é¢˜,æ¨±èŠ±","slug":"ä¸»é¢˜-æ¨±èŠ±","permalink":"/tags/ä¸»é¢˜-æ¨±èŠ±/"}],"keywords":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"/categories/æŠ€æœ¯/"}]},{"title":"Hexoå¿«é€Ÿå…¥é—¨","slug":"hello-world","date":"2020-05-20T03:56:03.000Z","updated":"2023-04-30T10:21:41.368Z","comments":true,"path":"2020/05/20/hello-world/","link":"","permalink":"/2020/05/20/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post$ hexo new &quot;My New Post&quot; More info: Writing Run server$ hexo server More info: Server Generate static files$ hexo generate More info: Generating Deploy to remote sites$ hexo deploy More info: Deployment","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"/categories/æŠ€æœ¯/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"/tags/Hexo/"}],"keywords":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"/categories/æŠ€æœ¯/"}]}]}